This file is a merged representation of a subset of the codebase, containing files not matching ignore patterns, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching these patterns are excluded: node_modules
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.env.example
.gitignore
components.json
eslint.config.js
index.html
jsconfig.json
package.json
public/firebase-messaging-sw.js
public/vite.svg
README.md
render.html
src/App.jsx
src/assets/react.svg
src/components/background/AnimatedBackground.jsx
src/components/background/backgroundConfig.js
src/components/background/GradientOverlay.jsx
src/components/background/index.js
src/components/background/ParticleSystem.js
src/components/background/useAnimatedBackground.js
src/components/billing/CreditHistoryFilters.jsx
src/components/billing/CreditHistoryList.jsx
src/components/billing/CreditSummary.jsx
src/components/billing/RechargeHistory.jsx
src/components/buildCV/__tests__/SectionOrderManager.test.jsx
src/components/buildCV/CVBuilder.jsx
src/components/buildCV/ImprovedSectionOrderManager.jsx
src/components/buildCV/SampleDataSpotlight.jsx
src/components/buildCV/SampleDataSuggestion.jsx
src/components/buildCV/SectionManagerDemo.jsx
src/components/buildCV/SectionOrderManager.jsx
src/components/buildCV/SimpleSectionOrderManager.jsx
src/components/buildCV/SortableList.jsx
src/components/buildCV/TemplateGallery.jsx
src/components/buildCV/TemplateSelector_new.jsx
src/components/chat/ChatInterface.jsx
src/components/chat/ConversationList.jsx
src/components/chat/MessageThread.jsx
src/components/common/AutocompleteDropdown.jsx
src/components/common/EmptyState.jsx
src/components/common/ErrorBoundary.jsx
src/components/common/ErrorState.jsx
src/components/common/FallbackUI.jsx
src/components/common/HomeAutocompleteDropdown.jsx
src/components/common/HomeSearchAutocomplete.jsx
src/components/common/JobDetail/Header.jsx
src/components/common/JobDetail/Sidebar.jsx
src/components/common/JobLocationMap.jsx
src/components/common/LocationPermissionAlert.jsx
src/components/common/LocationPermissionDemo.jsx
src/components/common/LocationPermissionGuide.jsx
src/components/common/LocationPicker.jsx
src/components/common/MicrophonePermissionAlert.jsx
src/components/common/MicrophonePermissionGuide.jsx
src/components/common/NotificationPermissionAlert.jsx
src/components/common/NotificationPermissionGuide.jsx
src/components/common/PRELOADER_README.md
src/components/common/Preloader.jsx
src/components/common/ProfileCompletion.jsx
src/components/common/README_LOCATION_PERMISSION.md
src/components/common/SalaryVisualization.jsx
src/components/common/ScrollToTop.jsx
src/components/common/ScrollToTopOnRouteChange.jsx
src/components/common/SearchAutocomplete.jsx
src/components/common/SectionHeader.jsx
src/components/common/ShareButtons.jsx
src/components/common/SuggestionItem.jsx
src/components/common/ThemeToggle.jsx
src/components/common/TikTokPreloader.jsx
src/components/common/ViewHistoryWidget.jsx
src/components/common/VoiceSearchButton.jsx
src/components/cv/CVPreview.jsx
src/components/cv/PDFViewer.jsx
src/components/cv/UploadedCVManager.jsx
src/components/CVPreview/CVPaginatedPreview.jsx
src/components/CVPreview/CVPreview.jsx
src/components/CVPreview/PaginatedCVPreview.jsx
src/components/CVPreview/templates/ClassicWhiteTemplate.jsx
src/components/CVPreview/templates/CompactDenseTemplate.jsx
src/components/CVPreview/templates/CreativeGradientTemplate.jsx
src/components/CVPreview/templates/CreativeSplitTemplate.jsx
src/components/CVPreview/templates/ElegantSerifTemplate.jsx
src/components/CVPreview/templates/ExecutiveFormalTemplate.jsx
src/components/CVPreview/templates/MinimalGrayTemplate.jsx
src/components/CVPreview/templates/ModernBlueTemplate.jsx
src/components/CVPreview/templates/ModernSansTemplate.jsx
src/components/CVPreview/templates/TwoColumnSidebarTemplate.jsx
src/components/dashboard/FeaturedCompanies.jsx
src/components/dashboard/README.md
src/components/debug/LogoDebugger.jsx
src/components/forms/CertificatesForm.jsx
src/components/forms/EducationForm.jsx
src/components/forms/PersonalInfoForm.jsx
src/components/forms/ProjectsForm.jsx
src/components/forms/SkillsForm.jsx
src/components/forms/WorkExperienceForm.jsx
src/components/HomePage.jsx
src/components/interview/ConnectionStatus.jsx
src/components/interview/ErrorDialog.jsx
src/components/interview/PermissionGuard.jsx
src/components/interview/ReconnectionHandler.jsx
src/components/interviews/ChatPanel.jsx
src/components/interviews/ConnectionQualityIndicator.jsx
src/components/interviews/DeviceTest.jsx
src/components/interviews/HelpPanel.jsx
src/components/interviews/InterviewInvitation.jsx
src/components/jobs/AutocompleteDropdown.jsx
src/components/jobs/JobAlertDialog.jsx
src/components/jobs/JobMapDemo.jsx
src/components/jobs/JobMapLeaflet.jsx
src/components/jobs/JobMapView.jsx
src/components/jobs/SearchHistoryDropdown.jsx
src/components/layout/CVDropdownMenu.jsx
src/components/layout/DashboardLayout.jsx
src/components/layout/Footer.jsx
src/components/layout/Header.jsx
src/components/layout/JobsDropdownMenu.jsx
src/components/layout/MainLayout.jsx
src/components/layout/NotificationDropdown.jsx
src/components/onboarding/ErrorState.jsx
src/components/onboarding/index.js
src/components/onboarding/LoadingState.jsx
src/components/onboarding/OnboardingBackground.jsx
src/components/onboarding/OnboardingErrorBoundary.jsx
src/components/onboarding/OnboardingLayout.jsx
src/components/onboarding/OnboardingPreview.jsx
src/components/onboarding/OnboardingWrapper.jsx
src/components/onboarding/ProfileCompletenessBar.jsx
src/components/onboarding/ProgressIndicator.jsx
src/components/onboarding/README.md
src/components/onboarding/SkipConfirmationModal.jsx
src/components/onboarding/steps/BasicInfoStep.jsx
src/components/onboarding/steps/CertificatesProjectsStep.jsx
src/components/onboarding/steps/ExperienceEducationStep.jsx
src/components/onboarding/steps/index.js
src/components/onboarding/steps/SalaryPreferencesStep.jsx
src/components/onboarding/steps/SkillsExperienceStep.jsx
src/components/onboarding/steps/SkillsStep.jsx
src/components/profile/BasicInfoSection.jsx
src/components/profile/CategoryUpdatePrompt.jsx
src/components/profile/CertificatesSection.jsx
src/components/profile/CVSection.jsx
src/components/profile/EducationFormItem.jsx
src/components/profile/EducationSection.jsx
src/components/profile/ExperienceFormItem.jsx
src/components/profile/ExperienceSection.jsx
src/components/profile/index.js
src/components/profile/PreferencesSection.jsx
src/components/profile/ProfileCompletenessCard.jsx
src/components/profile/ProfileCompletenessTest.jsx
src/components/profile/ProfileCompletionBadge.jsx
src/components/profile/ProfileCompletionBanner.jsx
src/components/profile/ProfileCompletionReminder.jsx
src/components/profile/ProjectsSection.jsx
src/components/profile/SkillLevelIndicator.jsx
src/components/profile/SkillsSection.jsx
src/components/profile/SocialLinksSection.jsx
src/components/recommendations/index.js
src/components/recommendations/JobRecommendationCard.jsx
src/components/recommendations/JobRecommendations.jsx
src/components/sections/CareerGuideSection.jsx
src/components/sections/FeaturedJobs.jsx
src/components/sections/HeroSection.jsx
src/components/sections/HowItWorks.jsx
src/components/sections/JobCategoriesSection.jsx
src/components/sections/JobSearchIntegratedSection.jsx
src/components/sections/JobSearchSection.jsx
src/components/sections/NewsletterBanner.jsx
src/components/sections/NewsletterSection.jsx
src/components/sections/PopularCategories.jsx
src/components/sections/RecommendedJobs.jsx
src/components/sections/StatsSection.jsx
src/components/sections/Testimonials.jsx
src/components/sections/TopCompanies.jsx
src/components/sections/TRENDING_COMPANIES_EXAMPLES.md
src/components/sections/TRENDING_COMPANIES_GUIDE.md
src/components/sections/TrendingCompanies.jsx
src/components/ui/accordion.jsx
src/components/ui/alert-dialog.jsx
src/components/ui/alert.jsx
src/components/ui/avatar.jsx
src/components/ui/badge.jsx
src/components/ui/button.jsx
src/components/ui/card.jsx
src/components/ui/checkbox.jsx
src/components/ui/dialog.jsx
src/components/ui/dropdown-menu.jsx
src/components/ui/input.jsx
src/components/ui/label.jsx
src/components/ui/pagination.jsx
src/components/ui/progress.jsx
src/components/ui/radio-group.jsx
src/components/ui/scroll-area.jsx
src/components/ui/select.jsx
src/components/ui/separator.jsx
src/components/ui/sheet.jsx
src/components/ui/skeleton.jsx
src/components/ui/slider.jsx
src/components/ui/sonner.jsx
src/components/ui/switch.jsx
src/components/ui/table.jsx
src/components/ui/tabs.jsx
src/components/ui/textarea.jsx
src/components/ui/tooltip.jsx
src/constants/creditTransaction.js
src/constants/jobAlertEnums.js
src/constants/jobCategories.js
src/constants/locations.js
src/constants/skills.js
src/contexts/backgroundConfig.js
src/contexts/BackgroundContext.jsx
src/contexts/ThemeContext.jsx
src/data/notifications.js
src/data/oldtree.json
src/data/sampleData.js
src/data/templates.js
src/docs/JOB_ALERTS_FEATURE.md
src/docs/JOB_ALERTS_TOGGLE_FIX.md
src/examples/VoiceSearchExamples.jsx
src/hooks/useAutocomplete.js
src/hooks/useDebounce.js
src/hooks/useFirebaseMessaging.js
src/hooks/useFormSubmitWithRetry.js
src/hooks/useHeaderTheme.js
src/hooks/useNotifications.js
src/hooks/useOnboardingStatus.js
src/hooks/usePayment.js
src/hooks/useRechargeHistory.js
src/hooks/useRetry.js
src/hooks/useSectionManager.js
src/hooks/useSonioxSearch.js
src/hooks/useTheme.js
src/hooks/useVoiceSearch.js
src/hooks/useWallet.js
src/index.css
src/lib/utils.js
src/main.jsx
src/pages/auth/ForgotPassword.jsx
src/pages/auth/Login.jsx
src/pages/auth/Register.jsx
src/pages/auth/ResetPassword.jsx
src/pages/billing/Billing.jsx
src/pages/billing/CreditHistory.jsx
src/pages/company/CompanyDetail.jsx
src/pages/company/CompanyList.jsx
src/pages/cv/CV.jsx
src/pages/cv/CVBuilderPage.jsx
src/pages/cv/CVListPage.jsx
src/pages/cv/CVManagementPage.jsx
src/pages/cv/CVRenderOnlyPage.jsx
src/pages/cv/UploadedCVPage.jsx
src/pages/dashboard/Dashboard.jsx
src/pages/dashboard/JobSuggestion.jsx
src/pages/dashboard/settings/JobAlertSettings.jsx
src/pages/dashboard/settings/PrivacySettings.jsx
src/pages/interviews/InterviewRoom.jsx
src/pages/interviews/MyInterviews.jsx
src/pages/JobMapPage.jsx
src/pages/jobs/ApplicationDetailPage.jsx
src/pages/jobs/Applications.jsx
src/pages/jobs/components/ApplyJobDialog.jsx
src/pages/jobs/components/MapView/index.js
src/pages/jobs/components/MapView/JobMapView_NEW.jsx
src/pages/jobs/components/MapView/JobMapView_OLD.jsx
src/pages/jobs/components/MapView/JobMapView.jsx
src/pages/jobs/components/MapView/JobMarkerPopup.jsx
src/pages/jobs/components/MapView/MAP_VIEW_IMPLEMENTATION.md
src/pages/jobs/components/MapView/QUICK_REFERENCE.md
src/pages/jobs/components/MapView/README.md
src/pages/jobs/components/MapView/testData.js
src/pages/jobs/components/SearchInterface/DistanceFilter.jsx
src/pages/jobs/components/SearchInterface/FilterGroup.jsx
src/pages/jobs/components/SearchInterface/JobSearchBar.jsx
src/pages/jobs/components/SearchInterface/LocationFilter.jsx
src/pages/jobs/components/SearchInterface/SalaryRangeFilter.jsx
src/pages/jobs/components/SearchInterface/SalaryRangeSlider.jsx
src/pages/jobs/components/SearchInterface/SearchBar.jsx
src/pages/jobs/components/SearchInterface/SearchFilters.jsx
src/pages/jobs/components/SearchResults/JobResultCard.jsx
src/pages/jobs/components/SearchResults/JobResultsList.jsx
src/pages/jobs/components/SearchResults/ResultsPagination.jsx
src/pages/jobs/components/SearchResults/SearchResultsHeader.jsx
src/pages/jobs/components/SearchStates/SearchEmpty.jsx
src/pages/jobs/components/SearchStates/SearchError.jsx
src/pages/jobs/components/SearchStates/SearchLoading.jsx
src/pages/jobs/JobDetail.jsx
src/pages/jobs/JobSearch.jsx
src/pages/jobs/SavedJobs.jsx
src/pages/jobs/ViewHistory.jsx
src/pages/messages/MessagesPage.jsx
src/pages/news/News.jsx
src/pages/NotFound.jsx
src/pages/notification/components/CreateJobAlertDialog.jsx
src/pages/notification/components/EditJobAlertDialog.jsx
src/pages/notification/NotificationsPage.jsx
src/pages/notification/useJobAlerts.jsx
src/pages/onboarding/OnboardingPage.jsx
src/pages/OnboardingPage.jsx
src/pages/payment/PaymentFailure.jsx
src/pages/payment/PaymentSuccess.jsx
src/pages/profile/Profile.jsx
src/pages/profile/ProfilePage.jsx
src/pages/recommendations/RecommendationsPage.jsx
src/pages/RecommendedJobsPage.jsx
src/pages/ThemeDemo.jsx
src/redux/authSlice.js
src/redux/notificationSlice.js
src/redux/searchHistorySlice.js
src/redux/slices/onboardingSlice.js
src/redux/slices/onboardingThunks.js
src/redux/store.js
src/render.jsx
src/routes/AppRouter.jsx
src/schemas/onboardingSchemas.js
src/schemas/searchSchemas.js
src/services/api.js
src/services/apiClient.js
src/services/apiRefreshClient.js
src/services/authService.js
src/services/chatService.js
src/services/companyService.js
src/services/creditHistoryService.js
src/services/cvService.js
src/services/firebase.js
src/services/interviewService.js
src/services/interviewSocket.service.js
src/services/jobAlertService.js
src/services/jobNotificationService.js
src/services/jobService.js
src/services/notificationService.js
src/services/onboardingService.js
src/services/paymentService.js
src/services/profileService.js
src/services/recommendationService.js
src/services/savedJobService.js
src/services/searchHistoryService.js
src/services/socketService.js
src/services/sonioxService.js
src/services/viewHistoryService.js
src/services/walletService.js
src/services/webrtc-native.service.js
src/services/webrtc.service.js
src/styles/onboarding.css
src/styles/preloader.css
src/styles/voice-search-animations.css
src/utils/dataMapper.js
src/utils/errorHandling.js
src/utils/formatters.js
src/utils/interviewErrorHandler.js
src/utils/templateHelpers.js
src/utils/token.js
tailwind.config.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="jsconfig.json">
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/sections/JobSearchSection.jsx">
import { Briefcase, Building2, LucideMapPin, Clock, DollarSign, BarChart } from 'lucide-react';
import { Card, CardContent } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../ui/select';

const categories = [
  { icon: Briefcase, name: 'Lập trình & IT', count: 1523 },
  { icon: Building2, name: 'Kinh doanh & Bán hàng', count: 876 },
  { icon: BarChart, name: 'Marketing & Digital', count: 654 },
  { icon: DollarSign, name: 'Tài chính & Kế toán', count: 321 },
];

const JobSearchSection = () => {
  return (
    <section className="py-20 bg-background">
      <div className="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6">
        <div className="text-center mb-16">
          <h2 className="text-3xl md:text-4xl font-bold mb-4 text-foreground">
            Tìm kiếm <span className="text-gradient-primary">cơ hội nghề nghiệp</span>
          </h2>
          <p className="text-lg text-muted-foreground max-w-3xl mx-auto">
            Khám phá việc làm trong các lĩnh vực phổ biến hoặc tìm kiếm theo địa điểm và mức lương mong muốn
          </p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
          <Card className="p-6 hover:shadow-xl transition-all duration-300 border-0 shadow-md bg-background">
            <CardContent className="p-0 space-y-4">
              <div className="inline-flex items-center justify-center h-14 w-14 rounded-full bg-primary/10 text-primary">
                <LucideMapPin className="h-6 w-6" />
              </div>
              <h3 className="text-xl font-semibold text-foreground">Tìm theo địa điểm</h3>
              <p className="text-muted-foreground">
                Tìm việc làm gần nơi bạn sống hoặc nơi bạn muốn đến
              </p>
              <div className="pt-2">
                <Select>
                  <SelectTrigger>
                    <SelectValue placeholder="Chọn địa điểm" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="hanoi">Hà Nội</SelectItem>
                    <SelectItem value="hcm">TP. Hồ Chí Minh</SelectItem>
                    <SelectItem value="danang">Đà Nẵng</SelectItem>
                    <SelectItem value="other">Các tỉnh khác</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </CardContent>
          </Card>

          <Card className="p-6 hover:shadow-xl transition-all duration-300 border-0 shadow-md bg-background">
            <CardContent className="p-0 space-y-4">
              <div className="inline-flex items-center justify-center h-14 w-14 rounded-full bg-primary/10 text-primary">
                <Briefcase className="h-6 w-6" />
              </div>
              <h3 className="text-xl font-semibold text-foreground">Tìm theo ngành nghề</h3>
              <p className="text-muted-foreground">
                Khám phá cơ hội việc làm trong lĩnh vực chuyên môn của bạn
              </p>
              <div className="pt-2">
                <Select>
                  <SelectTrigger>
                    <SelectValue placeholder="Chọn ngành nghề" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="it">Công nghệ thông tin</SelectItem>
                    <SelectItem value="marketing">Marketing</SelectItem>
                    <SelectItem value="finance">Tài chính</SelectItem>
                    <SelectItem value="other">Ngành khác</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </CardContent>
          </Card>

          <Card className="p-6 hover:shadow-xl transition-all duration-300 border-0 shadow-md bg-background">
            <CardContent className="p-0 space-y-4">
              <div className="inline-flex items-center justify-center h-14 w-14 rounded-full bg-primary/10 text-primary">
                <Clock className="h-6 w-6" />
              </div>
              <h3 className="text-xl font-semibold text-foreground">Tìm theo hình thức</h3>
              <p className="text-muted-foreground">
                Lựa chọn hình thức làm việc phù hợp với lối sống của bạn
              </p>
              <div className="pt-2">
                <Select>
                  <SelectTrigger>
                    <SelectValue placeholder="Chọn hình thức" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="fulltime">Toàn thời gian</SelectItem>
                    <SelectItem value="parttime">Bán thời gian</SelectItem>
                    <SelectItem value="remote">Từ xa</SelectItem>
                    <SelectItem value="freelance">Freelance</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </CardContent>
          </Card>
        </div>

        <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
          {categories.map((category, index) => (
            <Card key={index} className="hover:shadow-xl transition-all duration-300 cursor-pointer border-0 shadow-md bg-background group">
              <CardContent className="p-6">
                <div className="flex items-center space-x-4">
                  <div className="inline-flex items-center justify-center h-12 w-12 rounded-full bg-primary/10 group-hover:bg-gradient-primary transition-all duration-300">
                    <category.icon className="h-6 w-6 text-primary group-hover:text-primary-foreground transition-colors duration-300" />
                  </div>
                  <div className="flex-1">
                    <h3 className="font-medium text-lg text-foreground group-hover:text-primary transition-colors">{category.name}</h3>
                    <div className="flex items-center justify-between mt-1">
                      <Badge variant="secondary">{category.count} việc làm</Badge>
                      <Button variant="ghost" size="sm" className="h-7 w-7 p-0 group-hover:text-primary">
                        <span className="sr-only">Xem chi tiết</span>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          strokeWidth="2"
                          strokeLinecap="round"
                          strokeLinejoin="round"
                          className="h-4 w-4"
                        >
                          <path d="M5 12h14" />
                          <path d="m12 5 7 7-7 7" />
                        </svg>
                      </Button>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>
    </section>
  );
};

export default JobSearchSection;
</file>

<file path="src/components/ui/alert.jsx">
import * as React from "react"
import { cva } from "class-variance-authority";

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Alert({
  className,
  variant,
  ...props
}) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props} />
  );
}

function AlertTitle({
  className,
  ...props
}) {
  return (
    <div
      data-slot="alert-title"
      className={cn("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight", className)}
      {...props} />
  );
}

function AlertDescription({
  className,
  ...props
}) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className
      )}
      {...props} />
  );
}

export { Alert, AlertTitle, AlertDescription }
</file>

<file path="src/components/ui/avatar.jsx">
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

function Avatar({
  className,
  ...props
}) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn("relative flex size-8 shrink-0 overflow-hidden rounded-full", className)}
      {...props} />
  );
}

function AvatarImage({
  className,
  ...props
}) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props} />
  );
}

function AvatarFallback({
  className,
  ...props
}) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className
      )}
      {...props} />
  );
}

export { Avatar, AvatarImage, AvatarFallback }
</file>

<file path="src/components/ui/badge.jsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva } from "class-variance-authority";

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}) {
  const Comp = asChild ? Slot : "span"

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props} />
  );
}

export { Badge, badgeVariants }
</file>

<file path="src/components/ui/input.jsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({
  className,
  type,
  ...props
}) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props} />
  );
}

export { Input }
</file>

<file path="src/components/ui/sheet.jsx">
import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Sheet({
  ...props
}) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />;
}

function SheetTrigger({
  ...props
}) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />;
}

function SheetClose({
  ...props
}) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />;
}

function SheetPortal({
  ...props
}) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />;
}

function SheetOverlay({
  className,
  ...props
}) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props} />
  );
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className
        )}
        {...props}>
        {children}
        <SheetPrimitive.Close
          className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  );
}

function SheetHeader({
  className,
  ...props
}) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props} />
  );
}

function SheetFooter({
  className,
  ...props
}) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props} />
  );
}

function SheetTitle({
  className,
  ...props
}) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props} />
  );
}

function SheetDescription({
  className,
  ...props
}) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props} />
  );
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}
</file>

<file path="src/components/ui/skeleton.jsx">
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props} />
  );
}

export { Skeleton }
</file>

<file path="src/lib/utils.js">
import { clsx } from "clsx";
import { twMerge } from "tailwind-merge"

export function cn(...inputs) {
  return twMerge(clsx(inputs));
}
</file>

<file path="src/services/apiRefreshClient.js">
// src/services/apiRefreshClient.js
import axios from 'axios';

// Instance này CHỈ dùng để refresh token
// Nó không có request interceptor để gắn Authorization header
const apiRefreshClient = axios.create({
  baseURL: import.meta.env.VITE_API_URL,
  timeout: 10000,
  // Rất quan trọng: để gửi httpOnly cookie chứa refresh token
  withCredentials: true, 
});

// Chúng ta có thể thêm response interceptor để xử lý data trả về nếu cần,
// nhưng không cần request interceptor.
apiRefreshClient.interceptors.response.use(
  (res) => res.data, // Trả về thẳng `data` cho tiện
  (error) => Promise.reject(error) // Ném lỗi ra ngoài
);

export default apiRefreshClient;
</file>

<file path="src/utils/token.js">
// cách 1: luu accessToken trong ram

// let accessToken = null;

// export const getAccessToken = () => accessToken;
// export const saveAccessToken = (token) => {
//   accessToken = token;
// };
// export const clearAccessToken = () => {
//   accessToken = null;
// };

// cách 2: Tên key để lưu trong localStorage
const ACCESS_TOKEN_KEY = 'accessToken';

/**
 * Lấy accessToken từ localStorage.
 * @returns {string | null}
 */
export const getAccessToken = () => {
  try {
    return localStorage.getItem(ACCESS_TOKEN_KEY);
  } catch (error) {
    console.error("Failed to get access token from localStorage", error);
    return null;
  }
};

/**
 * Lưu accessToken vào localStorage.
 * @param {string} token
 */
export const saveAccessToken = (token) => {
  try {
    console.log("Saving access token to localStorage:", token);
    if (token) {
      localStorage.setItem(ACCESS_TOKEN_KEY, token);
    } else {
      // Nếu token là null hoặc undefined, hãy xóa nó đi
      localStorage.removeItem(ACCESS_TOKEN_KEY);
    }
  } catch (error) {
    console.error("Failed to save access token to localStorage", error);
  }
};

/**
 * Xóa accessToken khỏi localStorage.
 */
export const clearAccessToken = () => {
  try {
    localStorage.removeItem(ACCESS_TOKEN_KEY);
  } catch (error) {
    console.error("Failed to clear tokens from localStorage", error);
  }
};
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": false,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/index.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },]
    },
      plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
  },
])
</file>

<file path="public/firebase-messaging-sw.js">
/* global importScripts, firebase, clients */
// Scripts for firebase and firebase messaging
importScripts("https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js");
importScripts("https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging-compat.js");

const firebaseConfig = {
  apiKey: "AIzaSyAz6_sm6rkwgMjSWlXpiFOqOAmW-pBlwR0",
  authDomain: "careerzone-53619.firebaseapp.com",
  projectId: "careerzone-53619",
  storageBucket: "careerzone-53619.firebasestorage.app",
  messagingSenderId: "911786085213",
  appId: "1:911786085213:web:0d19671640b5aa6cfcb6b4"
};

firebase.initializeApp(firebaseConfig);

const messaging = firebase.messaging();

// Nhận background message
messaging.onBackgroundMessage(function (payload) {
  console.log("Received background message ", payload);

  const notificationTitle = payload.notification.title;
  const notificationOptions = {
    body: payload.notification.body,
    data: payload.data, // gắn data.url để xử lý khi click
  };

  self.registration.showNotification(notificationTitle, notificationOptions);
});

// Lắng nghe sự kiện click vào notification (phải khai báo ngay khi SW khởi tạo)
self.addEventListener("notificationclick", function (event) {
  console.log("On notification click: ", event.notification);
  event.notification.close();

  const targetUrl = "https://careerzone.vn";;

  event.waitUntil(
    clients.matchAll({ type: "window", includeUncontrolled: true }).then(windowClients => {
      for (let client of windowClients) {
        if (client.url.includes(self.location.origin)) {
          client.navigate(targetUrl);
          return client.focus();
        }
      }
      return clients.openWindow(targetUrl);
    })
  );
});
</file>

<file path="render.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CV Render</title>
    <style>
      /* Basic print-specific styles */
      @media print {
        body {
          margin: 0;
          -webkit-print-color-adjust: exact; /* Ensures background colors and images are printed */
          print-color-adjust: exact;
        }
        @page {
          margin: 0;
          size: A4;
        }
        /* Hide scrollbars during print */
        ::-webkit-scrollbar {
          display: none;
        }
      }
      body {
        margin: 0;
        font-family: sans-serif;
      }
      #root {
        width: 210mm; /* A4 width */
        min-height: 297mm; /* A4 height */
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/render.jsx"></script>
  </body>
</html>
</file>

<file path="src/components/background/AnimatedBackground.jsx">
import React, { useEffect, useState } from 'react';
import { cn } from '@/lib/utils';
import { useAnimatedBackground } from './useAnimatedBackground';
import GradientOverlay from './GradientOverlay';
import { useBackground } from '@/contexts/BackgroundContext';

/**
 * AnimatedBackground component - Main orchestrator for the background system
 */
const AnimatedBackground = ({
  className,
  children
}) => {
  const [theme, setTheme] = useState('light');
  const { config, updatePerformance } = useBackground();

  // Detect theme changes
  useEffect(() => {
    const detectTheme = () => {
      const isDark = document.documentElement.classList.contains('dark');
      setTheme(isDark ? 'dark' : 'light');
    };

    // Initial detection
    detectTheme();

    // Watch for theme changes
    const observer = new MutationObserver(detectTheme);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['class']
    });

    return () => observer.disconnect();
  }, []);

  const {
    canvasRef,
    isAnimating,
    performance,
    updateConfig
  } = useAnimatedBackground({
    particleDensity: config.particleDensity,
    animationSpeed: config.animationSpeed,
    gradientIntensity: config.gradientIntensity,
    theme,
    respectReducedMotion: true
  });

  // Update performance in context
  useEffect(() => {
    if (updatePerformance && performance) {
      updatePerformance(performance);
    }
  }, [performance.fps, performance.particleCount, performance.averageFPS]);

  // Update config when context config changes
  useEffect(() => {
    if (updateConfig) {
      updateConfig({
        density: config.particleDensity,
        speed: config.animationSpeed,
        gradientIntensity: config.gradientIntensity,
        theme
      });
    }
  }, [config.particleDensity, config.animationSpeed, config.gradientIntensity, theme]);

  // Don't render if disabled
  if (!config.enabled) {
    return children;
  }

  return (
    <div 
      className={cn(
        "fixed inset-0 pointer-events-none z-[-1]",
        "transition-opacity duration-1000",
        className
      )}
      aria-hidden="true"
    >
      {/* Gradient Layer */}
      <GradientOverlay 
        intensity={config.gradientIntensity}
        theme={theme}
        className="opacity-80"
      />
      
      {/* Particle Canvas */}
      <canvas
        ref={canvasRef}
        className={cn(
          "absolute inset-0 w-full h-full",
          "opacity-60 transition-opacity duration-500",
          isAnimating ? "opacity-60" : "opacity-30"
        )}
        style={{
          width: '100vw',
          height: '100vh'
        }}
      />

      {children}
    </div>
  );
};

export default AnimatedBackground;
</file>

<file path="src/components/background/backgroundConfig.js">
/**
 * Configuration constants for the animated background system
 */

export const BackgroundConfig = {
  particles: {
    density: {
      low: 0.15,           // Static noise density - low
      medium: 0.25,        // Static noise density - medium  
      high: 0.35           // Static noise density - high
    },
    speed: {
      slow: 0,             // No movement for static noise
      normal: 0,           // No movement for static noise
      fast: 0              // No movement for static noise
    },
    size: {
      min: 1,              // Pixel size for noise
      max: 1,              // Single pixel noise
      variance: 0          // No size variation
    },
    opacity: {
      min: 0.05,           // Very subtle noise
      max: 0.15,           // Subtle noise intensity
      decay: {
        min: 0,
        max: 0
      }
    },
    colors: {
      light: [
        'rgba(75, 85, 99, 0.6)',     // Darker gray for better contrast
        'rgba(107, 114, 128, 0.5)',  // Medium gray
        'rgba(156, 163, 175, 0.4)',  // Light gray
        'rgba(59, 130, 246, 0.35)',  // Blue accent
        'rgba(16, 185, 129, 0.3)'    // Green accent
      ],
      dark: [
        'rgba(255, 255, 255, 0.4)',  // Bright white for dark backgrounds
        'rgba(209, 213, 219, 0.5)',  // Light gray-white
        'rgba(156, 163, 175, 0.4)',  // Medium gray
        'rgba(96, 165, 250, 0.3)',   // Blue accent for dark mode
        'rgba(52, 211, 153, 0.25)'   // Green accent for dark mode
      ]
    }
  },
  gradients: {
    intensity: {
      subtle: 0.02,
      medium: 0.04,
      strong: 0.08          // Increased from 0.06 for stronger gradients
    },
    positions: [
      { x: 20, y: 30 },
      { x: 80, y: 70 },
      { x: 40, y: 80 },
      { x: 60, y: 20 },
      { x: 10, y: 90 },
      { x: 75, y: 15 },     // Additional gradient positions
      { x: 25, y: 65 },     // for richer visual effects
      { x: 90, y: 45 },
      { x: 5, y: 55 },
      { x: 65, y: 85 }
    ]
  },
  performance: {
    targetFPS: 60,
    minFPS: 30,
    maxParticles: 300,          // Increased from 200 for more particles
    performanceCheckInterval: 1000, // ms
    adaptiveQuality: true
  },
  responsive: {
    mobile: {
      densityMultiplier: 0.6,     // Increased from 0.5
      maxParticles: 150           // Increased from 100
    },
    tablet: {
      densityMultiplier: 0.85,    // Increased from 0.75
      maxParticles: 200           // Increased from 150
    },
    desktop: {
      densityMultiplier: 1.2,     // Increased from 1 for more dramatic effect
      maxParticles: 300           // Increased from 200
    }
  }
};

export const getResponsiveConfig = () => {
  const width = window.innerWidth;
  
  if (width < 768) {
    return BackgroundConfig.responsive.mobile;
  } else if (width < 1024) {
    return BackgroundConfig.responsive.tablet;
  } else {
    return BackgroundConfig.responsive.desktop;
  }
};

export const shouldRespectReducedMotion = () => {
  return window.matchMedia('(prefers-reduced-motion: reduce)').matches;
};
</file>

<file path="src/components/background/index.js">
/**
 * Animated Background System - Export Index
 * 
 * This file exports all components and utilities related to the animated background system.
 * The system provides noise particle animations with subtle gradients that integrate
 * seamlessly with the existing UI components.
 */

// Core Components
export { default as AnimatedBackground } from './AnimatedBackground';
export { default as GradientOverlay } from './GradientOverlay';
export { ParticleSystem } from './ParticleSystem';

// UI Controls
export { default as BackgroundControls } from './BackgroundControls';
export { default as PerformanceMonitor } from './PerformanceMonitor';

// Hooks and Utilities
export { useAnimatedBackground } from './useAnimatedBackground';
export { BackgroundConfig, getResponsiveConfig, shouldRespectReducedMotion } from './backgroundConfig';

// Context
export { BackgroundProvider, useBackground } from '../../contexts/BackgroundContext';

/**
 * Usage Examples:
 * 
 * 1. Basic Setup:
 * ```jsx
 * import { BackgroundProvider, AnimatedBackground } from '@/components/background';
 * 
 * function App() {
 *   return (
 *     <BackgroundProvider>
 *       <AnimatedBackground />
 *       <YourAppContent />
 *     </BackgroundProvider>
 *   );
 * }
 * ```
 * 
 * 2. With Controls (Development):
 * ```jsx
 * import { BackgroundControls, PerformanceMonitor } from '@/components/background';
 * 
 * function App() {
 *   return (
 *     <>
 *       <AnimatedBackground />
 *       {process.env.NODE_ENV === 'development' && (
 *         <>
 *           <BackgroundControls />
 *           <PerformanceMonitor />
 *         </>
 *       )}
 *     </>
 *   );
 * }
 * ```
 * 
 * 3. Custom Configuration:
 * ```jsx
 * import { useBackground } from '@/components/background';
 * 
 * function CustomComponent() {
 *   const { config, updateConfig } = useBackground();
 *   
 *   const handleConfigChange = () => {
 *     updateConfig({
 *       particleDensity: 'high',
 *       animationSpeed: 'fast'
 *     });
 *   };
 * }
 * ```
 */
</file>

<file path="src/components/background/ParticleSystem.js">
/**
 * Particle class representing individual animated particles
 */
class Particle {
  constructor(x, y, canvas, theme = 'light') {
    this.canvas = canvas;
    this.x = x;
    this.y = y;
    this.vx = (Math.random() - 0.5) * 0.5;
    this.vy = (Math.random() - 0.5) * 0.5;
    this.radius = Math.random() * 1.5 + 0.5;
    this.alpha = Math.random() * 0.3 + 0.1;
    this.decay = Math.random() * 0.01 + 0.005;
    this.maxAlpha = this.alpha;
    this.age = 0;
    this.maxAge = Math.random() * 300 + 200;
    
    // Theme-aware colors
    const colors = theme === 'dark' 
      ? ['rgba(209, 213, 219, 0.2)', 'rgba(156, 163, 175, 0.15)', 'rgba(107, 114, 128, 0.1)']
      : ['rgba(156, 163, 175, 0.3)', 'rgba(107, 114, 128, 0.25)', 'rgba(75, 85, 99, 0.2)'];
    
    this.color = colors[Math.floor(Math.random() * colors.length)];
  }

  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.age++;

    // Fade in/out lifecycle
    if (this.age < 60) {
      this.alpha = (this.age / 60) * this.maxAlpha;
    } else if (this.age > this.maxAge - 60) {
      this.alpha = ((this.maxAge - this.age) / 60) * this.maxAlpha;
    }

    // Boundary wrapping
    if (this.x < 0) this.x = this.canvas.width;
    if (this.x > this.canvas.width) this.x = 0;
    if (this.y < 0) this.y = this.canvas.height;
    if (this.y > this.canvas.height) this.y = 0;

    return this.age < this.maxAge && this.alpha > 0;
  }

  render(ctx) {
    ctx.save();
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  }
}

/**
 * ParticleSystem manages the creation, animation, and rendering of particles
 */
export class ParticleSystem {
  constructor(canvas, options = {}) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d');
    this.particles = [];
    this.animationId = null;
    this.isRunning = false;
    
    // Configuration
    this.options = {
      density: options.density || 0.00012,
      speed: options.speed || 0.5,
      maxParticles: options.maxParticles || 200,
      theme: options.theme || 'light',
      respectReducedMotion: options.respectReducedMotion || false,
      ...options
    };

    // Performance monitoring
    this.performance = {
      fps: 60,
      frameCount: 0,
      lastTime: performance.now(),
      fpsHistory: []
    };

    this.init();
  }

  init() {
    this.resize();
    this.createInitialParticles();
    
    // Handle reduced motion preference
    if (this.options.respectReducedMotion && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      this.options.density *= 0.3;
      this.options.speed *= 0.5;
    }
  }

  createInitialParticles() {
    const particleCount = Math.min(
      Math.floor(this.canvas.width * this.canvas.height * this.options.density),
      this.options.maxParticles
    );

    for (let i = 0; i < particleCount; i++) {
      this.createParticle();
    }
  }

  createParticle() {
    if (this.particles.length >= this.options.maxParticles) return;

    const x = Math.random() * this.canvas.width;
    const y = Math.random() * this.canvas.height;
    const particle = new Particle(x, y, this.canvas, this.options.theme);
    this.particles.push(particle);
  }

  updateParticles() {
    // Update existing particles and remove dead ones
    this.particles = this.particles.filter(particle => particle.update());

    // Maintain particle count
    while (this.particles.length < Math.min(
      Math.floor(this.canvas.width * this.canvas.height * this.options.density),
      this.options.maxParticles
    )) {
      this.createParticle();
    }
  }

  renderParticles() {
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    
    this.particles.forEach(particle => {
      particle.render(this.ctx);
    });
  }

  updatePerformance() {
    const now = performance.now();
    const delta = now - this.performance.lastTime;
    
    if (delta >= 1000) {
      this.performance.fps = Math.round((this.performance.frameCount * 1000) / delta);
      this.performance.fpsHistory.push(this.performance.fps);
      
      // Keep only last 10 FPS measurements
      if (this.performance.fpsHistory.length > 10) {
        this.performance.fpsHistory.shift();
      }

      // Auto-adjust quality if performance is poor
      if (this.options.adaptiveQuality && this.performance.fps < 30) {
        this.adjustQuality();
      }

      this.performance.frameCount = 0;
      this.performance.lastTime = now;
    }
    
    this.performance.frameCount++;
  }

  adjustQuality() {
    // Reduce particle density if performance is poor
    if (this.options.density > 0.00008) {
      this.options.density *= 0.8;
      console.log('Reducing particle density for better performance:', this.options.density);
    }
  }

  animate() {
    if (!this.isRunning) return;

    this.updateParticles();
    this.renderParticles();
    this.updatePerformance();

    this.animationId = requestAnimationFrame(() => this.animate());
  }

  start() {
    if (this.isRunning) return;
    
    this.isRunning = true;
    this.animate();
  }

  stop() {
    this.isRunning = false;
    if (this.animationId) {
      cancelAnimationFrame(this.animationId);
      this.animationId = null;
    }
  }

  resize() {
    const rect = this.canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    
    this.canvas.width = rect.width * dpr;
    this.canvas.height = rect.height * dpr;
    
    this.ctx.scale(dpr, dpr);
    this.canvas.style.width = rect.width + 'px';
    this.canvas.style.height = rect.height + 'px';
  }

  updateTheme(theme) {
    this.options.theme = theme;
    // Update existing particles with new theme colors
    this.particles.forEach(particle => {
      const colors = theme === 'dark' 
        ? ['rgba(209, 213, 219, 0.2)', 'rgba(156, 163, 175, 0.15)', 'rgba(107, 114, 128, 0.1)']
        : ['rgba(156, 163, 175, 0.3)', 'rgba(107, 114, 128, 0.25)', 'rgba(75, 85, 99, 0.2)'];
      
      particle.color = colors[Math.floor(Math.random() * colors.length)];
    });
  }

  updateConfig(newOptions) {
    this.options = { ...this.options, ...newOptions };
    
    // Recreate particles if density changed significantly
    const targetCount = Math.min(
      Math.floor(this.canvas.width * this.canvas.height * this.options.density),
      this.options.maxParticles
    );
    
    if (Math.abs(this.particles.length - targetCount) > targetCount * 0.2) {
      this.particles = [];
      this.createInitialParticles();
    }
  }

  destroy() {
    this.stop();
    this.particles = [];
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
  }

  getPerformanceStats() {
    return {
      fps: this.performance.fps,
      particleCount: this.particles.length,
      averageFPS: this.performance.fpsHistory.length > 0 
        ? Math.round(this.performance.fpsHistory.reduce((a, b) => a + b, 0) / this.performance.fpsHistory.length)
        : 60
    };
  }
}
</file>

<file path="src/components/background/useAnimatedBackground.js">
import { useRef, useEffect, useState, useCallback } from 'react';
import { ParticleSystem } from './ParticleSystem';
import { BackgroundConfig, getResponsiveConfig, shouldRespectReducedMotion } from './backgroundConfig';

/**
 * Custom hook for managing animated background state and lifecycle
 */
export const useAnimatedBackground = (options = {}) => {
  const canvasRef = useRef(null);
  const particleSystemRef = useRef(null);
  const resizeTimeoutRef = useRef(null);
  const isMountedRef = useRef(true);
  
  const [isAnimating, setIsAnimating] = useState(false);
  const [performance, setPerformance] = useState({
    fps: 60,
    particleCount: 0,
    averageFPS: 60
  });
  const [config, setConfig] = useState(() => ({
    density: options.particleDensity || 'medium',
    speed: options.animationSpeed || 'normal',
    gradientIntensity: options.gradientIntensity || 'subtle',
    theme: options.theme || 'light'
  }));

  // Initialize particle system
  const initializeParticleSystem = useCallback(() => {
    if (!canvasRef.current) return;

    const canvas = canvasRef.current;
    const responsiveConfig = getResponsiveConfig();
    const densityValue = BackgroundConfig.particles.density[config.density];
    const speedValue = BackgroundConfig.particles.speed[config.speed];

    const particleOptions = {
      density: densityValue * responsiveConfig.densityMultiplier,
      speed: speedValue,
      maxParticles: responsiveConfig.maxParticles,
      theme: config.theme,
      respectReducedMotion: shouldRespectReducedMotion(),
      adaptiveQuality: BackgroundConfig.performance.adaptiveQuality
    };

    // Clean up existing system
    if (particleSystemRef.current) {
      particleSystemRef.current.destroy();
    }

    // Create new particle system
    particleSystemRef.current = new ParticleSystem(canvas, particleOptions);
    
    return particleSystemRef.current;
  }, [config]);

  // Start animation
  const startAnimation = useCallback(() => {
    if (!particleSystemRef.current) {
      const system = initializeParticleSystem();
      if (!system) return;
    }

    particleSystemRef.current.start();
    setIsAnimating(true);

    // Performance monitoring interval
    const performanceInterval = setInterval(() => {
      if (particleSystemRef.current && isMountedRef.current) {
        const stats = particleSystemRef.current.getPerformanceStats();
        setPerformance(prevStats => {
          // Only update if there's a significant change
          if (
            Math.abs(prevStats.fps - stats.fps) > 2 ||
            Math.abs(prevStats.particleCount - stats.particleCount) > 5 ||
            Math.abs(prevStats.averageFPS - stats.averageFPS) > 2
          ) {
            return stats;
          }
          return prevStats;
        });
      }
    }, BackgroundConfig.performance.performanceCheckInterval);

    return () => clearInterval(performanceInterval);
  }, [initializeParticleSystem]);

  // Stop animation
  const stopAnimation = useCallback(() => {
    if (particleSystemRef.current) {
      particleSystemRef.current.stop();
    }
    setIsAnimating(false);
  }, []);

  // Handle resize with debouncing
  const handleResize = useCallback(() => {
    if (resizeTimeoutRef.current) {
      clearTimeout(resizeTimeoutRef.current);
    }

    resizeTimeoutRef.current = setTimeout(() => {
      if (particleSystemRef.current) {
        particleSystemRef.current.resize();
        
        // Reinitialize if screen size category changed significantly
        const newResponsiveConfig = getResponsiveConfig();
        const currentParticleCount = particleSystemRef.current.particles.length;
        const targetParticleCount = Math.min(
          Math.floor(canvasRef.current.width * canvasRef.current.height * 
            BackgroundConfig.particles.density[config.density] * newResponsiveConfig.densityMultiplier),
          newResponsiveConfig.maxParticles
        );

        if (Math.abs(currentParticleCount - targetParticleCount) > targetParticleCount * 0.3) {
          initializeParticleSystem();
          if (isAnimating) {
            startAnimation();
          }
        }
      }
    }, 250);
  }, [config.density, initializeParticleSystem, isAnimating, startAnimation]);

  // Update configuration
  const updateConfig = useCallback((newConfig) => {
    setConfig(prevConfig => {
      const updatedConfig = { ...prevConfig, ...newConfig };
      
      // Update particle system if it exists
      if (particleSystemRef.current) {
        const responsiveConfig = getResponsiveConfig();
        const densityValue = BackgroundConfig.particles.density[updatedConfig.density];
        const speedValue = BackgroundConfig.particles.speed[updatedConfig.speed];

        particleSystemRef.current.updateConfig({
          density: densityValue * responsiveConfig.densityMultiplier,
          speed: speedValue,
          maxParticles: responsiveConfig.maxParticles,
          theme: updatedConfig.theme
        });

        // Update theme if changed
        if (newConfig.theme && newConfig.theme !== prevConfig.theme) {
          particleSystemRef.current.updateTheme(updatedConfig.theme);
        }
      }
      
      return updatedConfig;
    });
  }, []);

  // Handle visibility change (pause when tab is not visible)
  const handleVisibilityChange = useCallback(() => {
    if (document.hidden) {
      stopAnimation();
    } else if (canvasRef.current && !shouldRespectReducedMotion()) {
      startAnimation();
    }
  }, [startAnimation, stopAnimation]);

  // Initialize on mount
  useEffect(() => {
    if (canvasRef.current && !shouldRespectReducedMotion()) {
      const cleanup = startAnimation();
      return cleanup;
    }
  }, [startAnimation]);

  // Handle resize events
  useEffect(() => {
    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
      if (resizeTimeoutRef.current) {
        clearTimeout(resizeTimeoutRef.current);
      }
    };
  }, [handleResize]);

  // Handle visibility change
  useEffect(() => {
    document.addEventListener('visibilitychange', handleVisibilityChange);
    return () => document.removeEventListener('visibilitychange', handleVisibilityChange);
  }, [handleVisibilityChange]);

  // Handle reduced motion preference changes
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
    
    const handleMotionPreferenceChange = (e) => {
      if (e.matches) {
        stopAnimation();
      } else if (canvasRef.current) {
        startAnimation();
      }
    };

    mediaQuery.addEventListener('change', handleMotionPreferenceChange);
    return () => mediaQuery.removeEventListener('change', handleMotionPreferenceChange);
  }, [startAnimation, stopAnimation]);

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      isMountedRef.current = false;
      if (particleSystemRef.current) {
        particleSystemRef.current.destroy();
      }
      if (resizeTimeoutRef.current) {
        clearTimeout(resizeTimeoutRef.current);
      }
    };
  }, []);

  return {
    canvasRef,
    isAnimating,
    performance,
    config,
    updateConfig,
    startAnimation,
    stopAnimation
  };
};
</file>

<file path="src/components/billing/CreditHistoryFilters.jsx">
import React, { useMemo } from 'react';
import { useSelector } from 'react-redux';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { X, Filter } from 'lucide-react';
import { TRANSACTION_TYPES, TRANSACTION_CATEGORIES, CATEGORY_LABELS, TRANSACTION_TYPE_LABELS } from '@/constants/creditTransaction';

const CreditHistoryFilters = ({ filters, onFilterChange, onClearFilters }) => {
  const user = useSelector((state) => state.auth.user?.user);
  const userRole = user?.role;

  // Filter categories based on user role
  const availableCategories = useMemo(() => {
    const allCategories = Object.values(TRANSACTION_CATEGORIES);
    
    // Candidate-specific filtering
    if (userRole === 'candidate') {
      return allCategories.filter(category => 
        // Exclude recruiter-only categories
        category !== TRANSACTION_CATEGORIES.JOB_POST
      );
    }
    
    // Recruiter-specific filtering
    if (userRole === 'recruiter') {
      return allCategories.filter(category =>
        // Exclude candidate-only categories (if any in the future)
        category !== TRANSACTION_CATEGORIES.PROFILE_BOOST
      );
    }
    
    // Admin sees all categories
    return allCategories;
  }, [userRole]);
  const handleTypeChange = (value) => {
    onFilterChange({ type: value === 'all' ? '' : value });
  };

  const handleCategoryChange = (value) => {
    onFilterChange({ category: value === 'all' ? '' : value });
  };

  const handleStartDateChange = (e) => {
    onFilterChange({ startDate: e.target.value });
  };

  const handleEndDateChange = (e) => {
    onFilterChange({ endDate: e.target.value });
  };

  const hasActiveFilters = filters.type || filters.category || filters.startDate || filters.endDate;

  return (
    <Card>
      <CardContent className="p-4">
        <div className="flex items-center gap-2 mb-4">
          <Filter className="h-5 w-5 text-muted-foreground" />
          <h3 className="font-semibold">Bộ lọc</h3>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          {/* Transaction Type Filter */}
          <div className="space-y-2">
            <Label htmlFor="type-filter">Loại giao dịch</Label>
            <Select
              value={filters.type || 'all'}
              onValueChange={handleTypeChange}
            >
              <SelectTrigger id="type-filter" className="w-full">
                <SelectValue placeholder="Tất cả" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">Tất cả</SelectItem>
                <SelectItem value={TRANSACTION_TYPES.DEPOSIT}>
                  {TRANSACTION_TYPE_LABELS[TRANSACTION_TYPES.DEPOSIT]}
                </SelectItem>
                <SelectItem value={TRANSACTION_TYPES.USAGE}>
                  {TRANSACTION_TYPE_LABELS[TRANSACTION_TYPES.USAGE]}
                </SelectItem>
              </SelectContent>
            </Select>
          </div>

          {/* Category Filter */}
          <div className="space-y-2">
            <Label htmlFor="category-filter">Danh mục</Label>
            <Select
              value={filters.category || 'all'}
              onValueChange={handleCategoryChange}
            >
              <SelectTrigger id="category-filter" className="w-full">
                <SelectValue placeholder="Tất cả" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">Tất cả</SelectItem>
                {availableCategories.map((category) => (
                  <SelectItem key={category} value={category}>
                    {CATEGORY_LABELS[category]}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Start Date Filter */}
          <div className="space-y-2">
            <Label htmlFor="start-date">Từ ngày</Label>
            <Input
              id="start-date"
              type="date"
              value={filters.startDate || ''}
              onChange={handleStartDateChange}
              max={filters.endDate || undefined}
            />
          </div>

          {/* End Date Filter */}
          <div className="space-y-2">
            <Label htmlFor="end-date">Đến ngày</Label>
            <Input
              id="end-date"
              type="date"
              value={filters.endDate || ''}
              onChange={handleEndDateChange}
              min={filters.startDate || undefined}
            />
          </div>
        </div>

        {/* Clear Filters Button */}
        {hasActiveFilters && (
          <div className="mt-4 flex justify-end">
            <Button
              variant="outline"
              size="sm"
              onClick={onClearFilters}
              className="gap-2"
            >
              <X className="h-4 w-4" />
              Xóa bộ lọc
            </Button>
          </div>
        )}
      </CardContent>
    </Card>
  );
};

export default CreditHistoryFilters;
</file>

<file path="src/components/billing/CreditHistoryList.jsx">
import React from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Skeleton } from '@/components/ui/skeleton';
import { ChevronLeft, ChevronRight, TrendingUp, TrendingDown, Coins } from 'lucide-react';
import { TRANSACTION_TYPES, CATEGORY_LABELS } from '@/constants/creditTransaction';

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleString('vi-VN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const formatAmount = (amount, type) => {
  const sign = type === TRANSACTION_TYPES.DEPOSIT ? '+' : '';
  return `${sign}${amount.toLocaleString('vi-VN')}`;
};

const TransactionItem = ({ transaction }) => {
  const isDeposit = transaction.type === TRANSACTION_TYPES.DEPOSIT;
  
  return (
    <div className="flex items-center justify-between p-4 border-b last:border-b-0 hover:bg-muted/50 transition-colors">
      <div className="flex items-start gap-3 flex-1">
        <div className={`p-2 rounded-full ${isDeposit ? 'bg-green-100' : 'bg-red-100'}`}>
          {isDeposit ? (
            <TrendingUp className="h-5 w-5 text-green-600" />
          ) : (
            <TrendingDown className="h-5 w-5 text-red-600" />
          )}
        </div>
        
        <div className="flex-1">
          <div className="font-medium">
            {CATEGORY_LABELS[transaction.category] || transaction.category}
          </div>
          {transaction.description && (
            <div className="text-sm text-muted-foreground mt-1">
              {transaction.description}
            </div>
          )}
          <div className="text-xs text-muted-foreground mt-1">
            {formatDate(transaction.createdAt)}
          </div>
        </div>
      </div>
      
      <div className="text-right ml-4">
        <div className={`text-lg font-semibold ${isDeposit ? 'text-green-600' : 'text-red-600'}`}>
          {formatAmount(transaction.amount, transaction.type)}
        </div>
        <div className="text-sm text-muted-foreground flex items-center justify-end gap-1 mt-1">
          <Coins className="h-3 w-3" />
          <span>{transaction.balanceAfter?.toLocaleString('vi-VN')}</span>
        </div>
      </div>
    </div>
  );
};

const LoadingSkeleton = () => (
  <div className="space-y-4">
    {[1, 2, 3, 4, 5].map((i) => (
      <div key={i} className="flex items-center justify-between p-4 border-b">
        <div className="flex items-start gap-3 flex-1">
          <Skeleton className="h-10 w-10 rounded-full" />
          <div className="flex-1 space-y-2">
            <Skeleton className="h-4 w-32" />
            <Skeleton className="h-3 w-48" />
            <Skeleton className="h-3 w-24" />
          </div>
        </div>
        <div className="text-right space-y-2">
          <Skeleton className="h-6 w-20" />
          <Skeleton className="h-4 w-16" />
        </div>
      </div>
    ))}
  </div>
);

const EmptyState = () => (
  <div className="flex flex-col items-center justify-center py-12 text-center">
    <div className="p-4 bg-muted rounded-full mb-4">
      <Coins className="h-12 w-12 text-muted-foreground" />
    </div>
    <h3 className="text-lg font-semibold mb-2">Chưa có giao dịch</h3>
    <p className="text-muted-foreground">
      Lịch sử giao dịch của bạn sẽ hiển thị ở đây
    </p>
  </div>
);

const CreditHistoryList = ({ transactions, pagination, isLoading, isLoadingMore, onLoadMore }) => {
  if (isLoading) {
    return (
      <Card>
        <CardContent className="p-0">
          <LoadingSkeleton />
        </CardContent>
      </Card>
    );
  }

  if (!transactions || transactions.length === 0) {
    return (
      <Card>
        <CardContent className="p-0">
          <EmptyState />
        </CardContent>
      </Card>
    );
  }

  return (
    <div className="space-y-4">
      <Card>
        <CardContent className="p-0">
          {transactions.map((transaction) => (
            <TransactionItem key={transaction._id} transaction={transaction} />
          ))}
        </CardContent>
      </Card>

      {/* Load More Button */}
      {pagination && pagination.hasNextPage && (
        <div className="flex flex-col items-center gap-3">
          <div className="text-sm text-muted-foreground">
            Đang hiển thị {transactions.length} / {pagination.totalRecords} giao dịch
          </div>
          
          <Button
            variant="outline"
            onClick={onLoadMore}
            disabled={isLoadingMore}
            className="w-full md:w-auto"
          >
            {isLoadingMore ? (
              <>
                <div className="h-4 w-4 mr-2 animate-spin rounded-full border-2 border-primary border-t-transparent" />
                Đang tải...
              </>
            ) : (
              <>
                <ChevronRight className="h-4 w-4 mr-2 rotate-90" />
                Xem thêm
              </>
            )}
          </Button>
        </div>
      )}

      {/* Show total when all loaded */}
      {pagination && !pagination.hasNextPage && transactions.length > 0 && (
        <div className="text-center text-sm text-muted-foreground py-4">
          Đã hiển thị tất cả {pagination.totalRecords} giao dịch
        </div>
      )}
    </div>
  );
};

export default CreditHistoryList;
</file>

<file path="src/components/billing/CreditSummary.jsx">
import React from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { Coins, TrendingUp, TrendingDown, PieChart } from 'lucide-react';
import { CATEGORY_LABELS } from '@/constants/creditTransaction';

const formatNumber = (value) => {
  return value?.toLocaleString('vi-VN') || '0';
};

const StatCard = ({ title, value, icon: Icon, color, isLoading }) => {
  if (isLoading) {
    return (
      <Card>
        <CardContent className="p-6">
          <div className="flex items-center justify-between">
            <div className="space-y-2 flex-1">
              <Skeleton className="h-4 w-24" />
              <Skeleton className="h-8 w-32" />
            </div>
            <Skeleton className="h-12 w-12 rounded-full" />
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardContent className="p-6">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm text-muted-foreground mb-1">{title}</p>
            <p className={`text-2xl font-bold ${color}`}>
              {formatNumber(value)}
            </p>
          </div>
          <div className={`p-3 rounded-full ${color.replace('text-', 'bg-')}/10`}>
            <Icon className={`h-6 w-6 ${color}`} />
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

const CategoryBreakdownItem = ({ category, count, totalAmount }) => {
  const isPositive = totalAmount >= 0;
  
  return (
    <div className="flex items-center justify-between py-3 border-b last:border-b-0">
      <div className="flex items-center gap-3">
        <div className={`p-2 rounded-full ${isPositive ? 'bg-green-100' : 'bg-red-100'}`}>
          <PieChart className={`h-4 w-4 ${isPositive ? 'text-green-600' : 'text-red-600'}`} />
        </div>
        <div>
          <div className="font-medium">{CATEGORY_LABELS[category] || category}</div>
          <div className="text-sm text-muted-foreground">{count} giao dịch</div>
        </div>
      </div>
      <div className={`text-lg font-semibold ${isPositive ? 'text-green-600' : 'text-red-600'}`}>
        {isPositive ? '+' : ''}{formatNumber(totalAmount)}
      </div>
    </div>
  );
};

const CreditSummary = ({ summary, isLoading }) => {
  if (isLoading) {
    return (
      <div className="space-y-4">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <StatCard isLoading={true} />
          <StatCard isLoading={true} />
          <StatCard isLoading={true} />
        </div>
        <Card>
          <CardHeader>
            <Skeleton className="h-6 w-48" />
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {[1, 2, 3].map((i) => (
                <div key={i} className="flex items-center justify-between py-3">
                  <div className="flex items-center gap-3">
                    <Skeleton className="h-8 w-8 rounded-full" />
                    <div className="space-y-2">
                      <Skeleton className="h-4 w-24" />
                      <Skeleton className="h-3 w-16" />
                    </div>
                  </div>
                  <Skeleton className="h-6 w-20" />
                </div>
              ))}
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  const {
    currentBalance = 0,
    totalDeposits = 0,
    totalUsage = 0,
    categoryBreakdown = []
  } = summary || {};

  return (
    <div className="space-y-4">
      {/* Summary Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <StatCard
          title="Số dư hiện tại"
          value={currentBalance}
          icon={Coins}
          color="text-blue-600"
        />
        <StatCard
          title="Tổng nạp"
          value={totalDeposits}
          icon={TrendingUp}
          color="text-green-600"
        />
        <StatCard
          title="Tổng sử dụng"
          value={Math.abs(totalUsage)}
          icon={TrendingDown}
          color="text-red-600"
        />
      </div>

      {/* Category Breakdown */}
      {categoryBreakdown && categoryBreakdown.length > 0 && (
        <Card>
          <CardHeader>
            <CardTitle className="text-lg">Phân loại theo danh mục</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="space-y-0">
              {categoryBreakdown.map((item) => (
                <CategoryBreakdownItem
                  key={item.category}
                  category={item.category}
                  count={item.count}
                  totalAmount={item.totalAmount}
                />
              ))}
            </div>
          </CardContent>
        </Card>
      )}
    </div>
  );
};

export default CreditSummary;
</file>

<file path="src/components/billing/RechargeHistory.jsx">
import { useState } from 'react';
import { useRechargeHistory } from '@/hooks/useRechargeHistory';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Skeleton } from '@/components/ui/skeleton';
import { RefreshCw, Clock, CheckCircle, XCircle, AlertCircle } from 'lucide-react';
import { cn } from '@/lib/utils';

const formatCurrency = (value) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);

const formatDate = (dateString) => {
  return new Date(dateString).toLocaleString('vi-VN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit'
  });
};

const getStatusConfig = (status) => {
  switch (status) {
    case 'SUCCESS':
      return {
        label: 'Thành công',
        variant: 'default',
        icon: CheckCircle,
        className: 'bg-green-100 text-green-800 border-green-200'
      };
    case 'PENDING':
      return {
        label: 'Đang xử lý',
        variant: 'secondary',
        icon: Clock,
        className: 'bg-yellow-100 text-yellow-800 border-yellow-200'
      };
    case 'FAILED':
      return {
        label: 'Thất bại',
        variant: 'destructive',
        icon: XCircle,
        className: 'bg-red-100 text-red-800 border-red-200'
      };
    default:
      return {
        label: 'Không xác định',
        variant: 'outline',
        icon: AlertCircle,
        className: 'bg-gray-100 text-gray-800 border-gray-200'
      };
  }
};

const getPaymentMethodLabel = (method) => {
  switch (method) {
    case 'ZALOPAY':
      return 'ZaloPay';
    case 'VNPAY':
      return 'VNPAY';
    default:
      return method;
  }
};

const RechargeHistoryItem = ({ transaction }) => {
  const statusConfig = getStatusConfig(transaction.status);
  const StatusIcon = statusConfig.icon;

  return (
    <div className="flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors">
      <div className="flex items-center gap-4">
        <div className={cn("p-2 rounded-full", statusConfig.className)}>
          <StatusIcon className="h-4 w-4" />
        </div>
        <div className="space-y-1">
          <div className="flex items-center gap-2">
            <span className="font-medium">{transaction.coinAmount} xu</span>
            <Badge variant="outline" className="text-xs">
              {getPaymentMethodLabel(transaction.paymentMethod)}
            </Badge>
          </div>
          <div className="text-sm text-muted-foreground">
            {formatDate(transaction.createdAt)}
          </div>
          {transaction.transactionCode && (
            <div className="text-xs text-muted-foreground">
              Mã GD: {transaction.transactionCode}
            </div>
          )}
        </div>
      </div>
      <div className="text-right space-y-1">
        <div className="font-semibold">
          {formatCurrency(transaction.amountPaid)}
        </div>
        <Badge className={cn("text-xs", statusConfig.className)}>
          {statusConfig.label}
        </Badge>
      </div>
    </div>
  );
};

const RechargeHistorySkeleton = () => (
  <div className="space-y-4">
    {[...Array(3)].map((_, index) => (
      <div key={index} className="flex items-center justify-between p-4 border rounded-lg">
        <div className="flex items-center gap-4">
          <Skeleton className="h-10 w-10 rounded-full" />
          <div className="space-y-2">
            <Skeleton className="h-4 w-32" />
            <Skeleton className="h-3 w-24" />
            <Skeleton className="h-3 w-20" />
          </div>
        </div>
        <div className="text-right space-y-2">
          <Skeleton className="h-4 w-20" />
          <Skeleton className="h-5 w-16" />
        </div>
      </div>
    ))}
  </div>
);

const RechargeHistory = () => {
  const { history, loading, pagination, loadMore, refresh } = useRechargeHistory();
  const [isRefreshing, setIsRefreshing] = useState(false);

  const handleRefresh = async () => {
    setIsRefreshing(true);
    await refresh();
    setIsRefreshing(false);
  };

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            <Clock className="h-5 w-5" />
            Lịch sử nạp xu
          </CardTitle>
          <Button
            variant="outline"
            size="sm"
            onClick={handleRefresh}
            disabled={isRefreshing}
            className="gap-2"
          >
            <RefreshCw className={cn("h-4 w-4", isRefreshing && "animate-spin")} />
            Làm mới
          </Button>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        {loading && history.length === 0 ? (
          <RechargeHistorySkeleton />
        ) : history.length === 0 ? (
          <div className="text-center py-8 text-muted-foreground">
            <Clock className="h-12 w-12 mx-auto mb-4 opacity-50" />
            <p>Chưa có lịch sử nạp xu nào</p>
            <p className="text-sm">Hãy thực hiện giao dịch nạp xu đầu tiên của bạn</p>
          </div>
        ) : (
          <>
            <div className="space-y-3">
              {history.map((transaction) => (
                <RechargeHistoryItem key={transaction._id} transaction={transaction} />
              ))}
            </div>
            
            {pagination.page < pagination.totalPages && (
              <div className="text-center pt-4">
                <Button
                  variant="outline"
                  onClick={loadMore}
                  disabled={loading}
                  className="gap-2"
                >
                  {loading ? (
                    <>
                      <RefreshCw className="h-4 w-4 animate-spin" />
                      Đang tải...
                    </>
                  ) : (
                    `Xem thêm (${pagination.total - history.length} còn lại)`
                  )}
                </Button>
              </div>
            )}
            
            <div className="text-center text-sm text-muted-foreground pt-2">
              Hiển thị {history.length} / {pagination.total} giao dịch
            </div>
          </>
        )}
      </CardContent>
    </Card>
  );
};

export default RechargeHistory;
</file>

<file path="src/components/buildCV/__tests__/SectionOrderManager.test.jsx">
import { describe, it, expect, beforeEach } from 'vitest';
import { renderHook, act } from '@testing-library/react';
import { useSectionManager } from '../../../hooks/useSectionManager';
import { 
  isTwoColumnTemplate, 
  splitSectionsByColumn,
  validateSectionOrder,
  getDefaultSectionOrder,
  moveSectionInColumn
} from '../../../utils/templateHelpers';

describe('Template Helpers', () => {
  describe('isTwoColumnTemplate', () => {
    it('should return true for two-column templates', () => {
      expect(isTwoColumnTemplate('two-column-sidebar')).toBe(true);
      expect(isTwoColumnTemplate('creative-split')).toBe(true);
    });

    it('should return false for single-column templates', () => {
      expect(isTwoColumnTemplate('modern-blue')).toBe(false);
      expect(isTwoColumnTemplate('classic-white')).toBe(false);
    });
  });

  describe('splitSectionsByColumn', () => {
    it('should split sections correctly for two-column-sidebar', () => {
      const sections = ['summary', 'experience', 'skills', 'education'];
      const result = splitSectionsByColumn(sections, 'two-column-sidebar');
      
      expect(result.sidebar).toContain('skills');
      expect(result.sidebar).toContain('education');
      expect(result.main).toContain('summary');
      expect(result.main).toContain('experience');
    });

    it('should return all sections in main for single-column template', () => {
      const sections = ['summary', 'experience', 'skills'];
      const result = splitSectionsByColumn(sections, 'modern-blue');
      
      expect(result.sidebar).toEqual([]);
      expect(result.main).toEqual(sections);
    });
  });

  describe('validateSectionOrder', () => {
    it('should validate correct section order', () => {
      const order = ['summary', 'experience', 'education', 'skills'];
      expect(validateSectionOrder(order, 'modern-blue')).toBe(true);
    });

    it('should reject invalid section names', () => {
      const order = ['summary', 'invalid-section', 'experience'];
      expect(validateSectionOrder(order, 'modern-blue')).toBe(false);
    });
  });

  describe('getDefaultSectionOrder', () => {
    it('should return default order for single-column template', () => {
      const order = getDefaultSectionOrder('modern-blue');
      expect(order).toContain('summary');
      expect(order).toContain('experience');
      expect(order).toContain('education');
    });

    it('should return correct order for two-column template', () => {
      const order = getDefaultSectionOrder('two-column-sidebar');
      expect(order.length).toBeGreaterThan(0);
    });
  });

  describe('moveSectionInColumn', () => {
    it('should move section up in single-column template', () => {
      const order = ['summary', 'experience', 'education'];
      const result = moveSectionInColumn(order, 'modern-blue', 'education', 'up');
      
      expect(result.indexOf('education')).toBe(1);
      expect(result.indexOf('experience')).toBe(2);
    });

    it('should move section down in single-column template', () => {
      const order = ['summary', 'experience', 'education'];
      const result = moveSectionInColumn(order, 'modern-blue', 'summary', 'down');
      
      expect(result.indexOf('summary')).toBe(1);
      expect(result.indexOf('experience')).toBe(0);
    });
  });
});

describe('useSectionManager Hook', () => {
  const initialOrder = ['summary', 'experience', 'education', 'skills'];
  const initialHidden = [];
  const templateId = 'modern-blue';

  it('should initialize with correct values', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    expect(result.current.sectionOrder).toEqual(initialOrder);
    expect(result.current.hiddenSections).toEqual(initialHidden);
  });

  it('should move section up', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    act(() => {
      result.current.moveSection('education', 'up');
    });

    const educationIndex = result.current.sectionOrder.indexOf('education');
    const experienceIndex = result.current.sectionOrder.indexOf('experience');
    expect(educationIndex).toBeLessThan(experienceIndex);
  });

  it('should move section down', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    act(() => {
      result.current.moveSection('summary', 'down');
    });

    const summaryIndex = result.current.sectionOrder.indexOf('summary');
    expect(summaryIndex).toBe(1);
  });

  it('should toggle section visibility', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    act(() => {
      result.current.toggleSectionVisibility('skills');
    });

    expect(result.current.hiddenSections).toContain('skills');

    act(() => {
      result.current.toggleSectionVisibility('skills');
    });

    expect(result.current.hiddenSections).not.toContain('skills');
  });

  it('should hide section', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    act(() => {
      result.current.hideSection('experience');
    });

    expect(result.current.hiddenSections).toContain('experience');
  });

  it('should show section', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, ['experience'], templateId)
    );

    act(() => {
      result.current.showSection('experience');
    });

    expect(result.current.hiddenSections).not.toContain('experience');
  });

  it('should reset to default', () => {
    const { result } = renderHook(() =>
      useSectionManager(['skills', 'summary'], ['experience'], templateId)
    );

    act(() => {
      result.current.resetToDefault();
    });

    expect(result.current.sectionOrder.length).toBeGreaterThan(0);
    expect(result.current.hiddenSections).toEqual([]);
  });

  it('should get visible sections', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, ['skills'], templateId)
    );

    const visible = result.current.getVisibleSections();
    expect(visible).not.toContain('skills');
    expect(visible).toContain('summary');
    expect(visible).toContain('experience');
  });

  it('should check if section is hidden', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, ['skills'], templateId)
    );

    expect(result.current.isSectionHidden('skills')).toBe(true);
    expect(result.current.isSectionHidden('summary')).toBe(false);
  });

  it('should check if can move up', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    expect(result.current.canMoveUp('summary')).toBe(false); // First item
    expect(result.current.canMoveUp('experience')).toBe(true);
  });

  it('should check if can move down', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    expect(result.current.canMoveDown('skills')).toBe(false); // Last item
    expect(result.current.canMoveDown('summary')).toBe(true);
  });

  it('should reorder sections', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    const newOrder = ['skills', 'summary', 'experience', 'education'];

    act(() => {
      result.current.reorderSections(newOrder);
    });

    expect(result.current.sectionOrder).toEqual(newOrder);
  });

  it('should hide multiple sections', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, initialHidden, templateId)
    );

    act(() => {
      result.current.hideSections(['skills', 'education']);
    });

    expect(result.current.hiddenSections).toContain('skills');
    expect(result.current.hiddenSections).toContain('education');
  });

  it('should show multiple sections', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, ['skills', 'education'], templateId)
    );

    act(() => {
      result.current.showSections(['skills', 'education']);
    });

    expect(result.current.hiddenSections).not.toContain('skills');
    expect(result.current.hiddenSections).not.toContain('education');
  });
});

describe('Two-Column Template Behavior', () => {
  const initialOrder = ['summary', 'experience', 'skills', 'education'];
  const templateId = 'two-column-sidebar';

  it('should move section within sidebar column only', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, [], templateId)
    );

    // Skills and Education are in sidebar
    act(() => {
      result.current.moveSection('education', 'up');
    });

    const { sidebar } = splitSectionsByColumn(result.current.sectionOrder, templateId);
    const educationIndex = sidebar.indexOf('education');
    const skillsIndex = sidebar.indexOf('skills');
    
    expect(educationIndex).toBeLessThan(skillsIndex);
  });

  it('should not allow moving section to different column', () => {
    const { result } = renderHook(() =>
      useSectionManager(initialOrder, [], templateId)
    );

    const initialSidebar = splitSectionsByColumn(result.current.sectionOrder, templateId).sidebar;

    act(() => {
      result.current.moveSection('skills', 'up');
    });

    const finalSidebar = splitSectionsByColumn(result.current.sectionOrder, templateId).sidebar;
    
    // Skills should still be in sidebar
    expect(finalSidebar).toContain('skills');
  });
});
</file>

<file path="src/components/buildCV/ImprovedSectionOrderManager.jsx">
import React, { useState } from 'react';
import { 
  Settings, GripVertical, ChevronUp, ChevronDown, 
  FileText, Briefcase, GraduationCap, Award, FolderOpen, 
  AlignCenterVertical as Certificate, Eye, EyeOff, 
  Columns2, LayoutList, RotateCcw, Info, AlertCircle 
} from 'lucide-react';
import { useSectionManager } from '@/hooks/useSectionManager';
import { isTwoColumnTemplate, splitSectionsByColumn } from '@/utils/templateHelpers';

const ImprovedSectionOrderManager = ({ 
  sectionOrder: initialSectionOrder, 
  onChange, 
  hiddenSections: initialHiddenSections, 
  onHiddenChange, 
  currentTemplate 
}) => {
  const {
    sectionOrder,
    hiddenSections,
    moveSection,
    toggleSectionVisibility,
    resetToDefault,
    canMoveUp,
    canMoveDown,
    setSectionOrder,
    setHiddenSections
  } = useSectionManager(initialSectionOrder, initialHiddenSections, currentTemplate);

  // Sync với parent component ngay lập tức
  React.useEffect(() => {
    if (JSON.stringify(sectionOrder) !== JSON.stringify(initialSectionOrder)) {
      onChange(sectionOrder);
    }
  }, [sectionOrder]);

  React.useEffect(() => {
    if (JSON.stringify(hiddenSections) !== JSON.stringify(initialHiddenSections)) {
      onHiddenChange(hiddenSections);
    }
  }, [hiddenSections]);

  // Sync từ parent xuống khi parent thay đổi (ví dụ: đổi template)
  React.useEffect(() => {
    if (JSON.stringify(initialSectionOrder) !== JSON.stringify(sectionOrder)) {
      setSectionOrder(initialSectionOrder);
    }
  }, [initialSectionOrder]);

  React.useEffect(() => {
    if (JSON.stringify(initialHiddenSections) !== JSON.stringify(hiddenSections)) {
      setHiddenSections(initialHiddenSections);
    }
  }, [initialHiddenSections]);

  const [dragOverIndex, setDragOverIndex] = useState(null);
  const [dragOverColumn, setDragOverColumn] = useState(null);

  const sectionConfig = {
    summary: {
      id: 'summary',
      name: 'Professional Summary',
      icon: FileText,
      description: 'Brief overview of your professional background',
      color: 'blue'
    },
    experience: {
      id: 'experience',
      name: 'Work Experience',
      icon: Briefcase,
      description: 'Your work history and achievements',
      color: 'purple'
    },
    education: {
      id: 'education',
      name: 'Education',
      icon: GraduationCap,
      description: 'Your educational background',
      color: 'green'
    },
    skills: {
      id: 'skills',
      name: 'Skills',
      icon: Award,
      description: 'Technical and soft skills',
      color: 'orange'
    },
    projects: {
      id: 'projects',
      name: 'Projects',
      icon: FolderOpen,
      description: 'Personal and professional projects',
      color: 'indigo'
    },
    certificates: {
      id: 'certificates',
      name: 'Certificates',
      icon: Certificate,
      description: 'Professional certifications and achievements',
      color: 'pink'
    }
  };

  const isTwoColumn = isTwoColumnTemplate(currentTemplate);
  const { sidebar: sidebarSections, main: mainSections } = isTwoColumn 
    ? splitSectionsByColumn(sectionOrder, currentTemplate)
    : { sidebar: [], main: sectionOrder };

  const handleDragStart = (e, index, column = null) => {
    e.dataTransfer.setData('text/plain', JSON.stringify({ index, column }));
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex, dropColumn = null) => {
    e.preventDefault();
    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
    const dragIndex = data.index;
    const dragColumn = data.column;

    if (dragIndex === dropIndex && dragColumn === dropColumn) {
      setDragOverIndex(null);
      setDragOverColumn(null);
      return;
    }

    let newFullOrder;

    if (dropColumn) {
      const columnSections = dropColumn === 'sidebar' ? sidebarSections : mainSections;
      const newColumnOrder = [...columnSections];
      const [draggedItem] = newColumnOrder.splice(dragIndex, 1);
      const newDropIndex = dragIndex < dropIndex ? dropIndex - 1 : dropIndex;
      newColumnOrder.splice(newDropIndex, 0, draggedItem);

      const otherColumn = dropColumn === 'sidebar' ? mainSections : sidebarSections;
      newFullOrder = dropColumn === 'sidebar' 
        ? [...newColumnOrder, ...otherColumn]
        : [...otherColumn, ...newColumnOrder];
    } else {
      newFullOrder = [...sectionOrder];
      const [draggedItem] = newFullOrder.splice(dragIndex, 1);
      const newDropIndex = dragIndex < dropIndex ? dropIndex - 1 : dropIndex;
      newFullOrder.splice(newDropIndex, 0, draggedItem);
    }

    setSectionOrder(newFullOrder);
    onChange(newFullOrder); // Gọi onChange ngay lập tức

    setDragOverIndex(null);
    setDragOverColumn(null);
  };

  const renderSectionItem = (sectionId, index, columnSections = null, columnName = null) => {
    const section = sectionConfig[sectionId];
    const Icon = section.icon;
    const isHidden = hiddenSections.includes(sectionId);
    const isDraggingOver = dragOverIndex === index && dragOverColumn === columnName;
    const sectionsArray = columnSections || sectionOrder;

    const colorClasses = {
      blue: 'border-blue-500 bg-blue-50',
      purple: 'border-purple-500 bg-purple-50',
      green: 'border-green-500 bg-green-50',
      orange: 'border-orange-500 bg-orange-50',
      indigo: 'border-indigo-500 bg-indigo-50',
      pink: 'border-pink-500 bg-pink-50'
    };

    return (
      <div
        key={sectionId}
        className={`p-4 border-l-4 rounded-lg transition-all relative ${
          isHidden 
            ? 'bg-gray-50 border-gray-200 opacity-60' 
            : `${colorClasses[section.color]} border-${section.color}-500 hover:shadow-md`
        }`}
        draggable={!isHidden}
        onDragStart={(e) => handleDragStart(e, index, columnName)}
        onDragOver={handleDragOver}
        onDrop={(e) => handleDrop(e, index, columnName)}
        onDragEnter={() => {
          setDragOverIndex(index);
          setDragOverColumn(columnName);
        }}
        onDragEnd={() => {
          setDragOverIndex(null);
          setDragOverColumn(null);
        }}
      >
        {isDraggingOver && <div className="absolute top-0 left-0 w-full h-0.5 bg-blue-500" />}
        
        <div className="flex items-center space-x-3">
          <div className="flex flex-col items-center space-y-1">
            <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
            <div className="flex flex-col space-y-1">
              <button
                onClick={() => {
                  moveSection(sectionId, 'up');
                  // Force update ngay
                  setTimeout(() => {
                    const newOrder = [...sectionOrder];
                    onChange(newOrder);
                  }, 0);
                }}
                disabled={!canMoveUp(sectionId)}
                className={`p-1 rounded ${
                  !canMoveUp(sectionId)
                    ? 'text-gray-300 cursor-not-allowed' 
                    : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                }`}
                title="Move up"
              >
                <ChevronUp className="w-3 h-3" />
              </button>
              <button
                onClick={() => {
                  moveSection(sectionId, 'down');
                  // Force update ngay
                  setTimeout(() => {
                    const newOrder = [...sectionOrder];
                    onChange(newOrder);
                  }, 0);
                }}
                disabled={!canMoveDown(sectionId)}
                className={`p-1 rounded ${
                  !canMoveDown(sectionId)
                    ? 'text-gray-300 cursor-not-allowed' 
                    : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                }`}
                title="Move down"
              >
                <ChevronDown className="w-3 h-3" />
              </button>
            </div>
          </div>

          <div className={`flex items-center space-x-3 flex-1 p-2 rounded ${isHidden ? '' : 'bg-white'}`}>
            <Icon className={`w-5 h-5 ${isHidden ? 'text-gray-400' : `text-${section.color}-600`}`} />
            <div className="flex-1">
              <div className={`font-medium ${isHidden ? 'text-gray-500' : 'text-gray-800'}`}>
                {section.name}
              </div>
              <div className="text-sm text-gray-500">{section.description}</div>
            </div>
          </div>

          <div className="flex items-center space-x-2">
            <span className={`text-xs px-2 py-1 rounded-full ${
              isHidden 
                ? 'bg-gray-200 text-gray-500' 
                : `bg-${section.color}-100 text-${section.color}-700`
            }`}>
              #{index + 1}
            </span>
            <button
              onClick={() => toggleSectionVisibility(sectionId)}
              className={`p-2 rounded-full transition-colors ${
                isHidden 
                  ? 'text-gray-400 hover:text-gray-600 hover:bg-gray-100' 
                  : `text-${section.color}-600 hover:text-${section.color}-700 hover:bg-${section.color}-100`
              }`}
              title={isHidden ? 'Show section' : 'Hide section'}
            >
              {isHidden ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
            </button>
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center space-x-2">
          <Settings className="w-5 h-5 text-blue-600" />
          <h3 className="text-lg font-semibold text-gray-800">CV Layout & Section Order</h3>
        </div>
        <button
          onClick={resetToDefault}
          className="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors"
        >
          <RotateCcw className="w-4 h-4" />
          <span>Reset to Default</span>
        </button>
      </div>

      {/* Template Layout Info */}
      {isTwoColumn && (
        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4">
          <div className="flex items-start space-x-3">
            <Columns2 className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
            <div>
              <h4 className="font-medium text-blue-900 mb-1">Two-Column Layout Active</h4>
              <p className="text-sm text-blue-700">
                This template uses a two-column layout. Sections are organized into{' '}
                <strong>Sidebar</strong> (left column) and <strong>Main Content</strong> (right column).
                You can reorder sections within each column independently.
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Info Box */}
      <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <div className="flex items-start space-x-2">
          <Info className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
          <div className="text-sm text-yellow-800">
            <strong>Tips:</strong> Drag and drop sections to reorder them, or use the arrow buttons.{' '}
            {isTwoColumn && 'Each column can be reordered independently. '}
            Click the eye icon to hide/show sections in your CV.
          </div>
        </div>
      </div>

      {/* Section Reordering */}
      <div>
        <h4 className="font-medium text-gray-800 mb-3">
          {isTwoColumn ? 'Customize Column Sections' : 'Customize Section Order'}
        </h4>

        {isTwoColumn ? (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
            {/* Sidebar Column */}
            <div className="space-y-3">
              <div className="flex items-center space-x-2 mb-2 p-2 bg-purple-50 rounded-lg">
                <LayoutList className="w-4 h-4 text-purple-600" />
                <h5 className="font-semibold text-gray-700">Sidebar (Left Column)</h5>
                <span className="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full">
                  {sidebarSections.length} sections
                </span>
              </div>
              {sidebarSections.map((sectionId, index) => 
                renderSectionItem(sectionId, index, sidebarSections, 'sidebar')
              )}
            </div>

            {/* Main Content Column */}
            <div className="space-y-3">
              <div className="flex items-center space-x-2 mb-2 p-2 bg-green-50 rounded-lg">
                <FileText className="w-4 h-4 text-green-600" />
                <h5 className="font-semibold text-gray-700">Main Content (Right Column)</h5>
                <span className="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">
                  {mainSections.length} sections
                </span>
              </div>
              {mainSections.map((sectionId, index) => 
                renderSectionItem(sectionId, index, mainSections, 'main')
              )}
            </div>
          </div>
        ) : (
          <div className="space-y-3">
            {sectionOrder.map((sectionId, index) => renderSectionItem(sectionId, index))}
          </div>
        )}
      </div>

      {/* Layout Preview */}
      <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
        <h4 className="font-medium text-gray-800 mb-3 flex items-center">
          <Eye className="w-4 h-4 mr-2" />
          Layout Preview
        </h4>
        
        {isTwoColumn ? (
          <div className="grid grid-cols-2 gap-4">
            <div>
              <h5 className="text-xs font-semibold text-purple-600 mb-2 uppercase tracking-wide">Sidebar</h5>
              <div className="space-y-2">
                {sidebarSections.map((sectionId, index) => {
                  const section = sectionConfig[sectionId];
                  const isHidden = hiddenSections.includes(sectionId);
                  if (isHidden) return null;
                  return (
                    <div key={sectionId} className="flex items-center space-x-2 text-sm bg-white p-2 rounded">
                      <span className="text-purple-600 font-medium">{index + 1}.</span>
                      <span className="text-gray-700">{section.name}</span>
                    </div>
                  );
                })}
              </div>
            </div>
            <div>
              <h5 className="text-xs font-semibold text-green-600 mb-2 uppercase tracking-wide">Main Content</h5>
              <div className="space-y-2">
                {mainSections.map((sectionId, index) => {
                  const section = sectionConfig[sectionId];
                  const isHidden = hiddenSections.includes(sectionId);
                  if (isHidden) return null;
                  return (
                    <div key={sectionId} className="flex items-center space-x-2 text-sm bg-white p-2 rounded">
                      <span className="text-green-600 font-medium">{index + 1}.</span>
                      <span className="text-gray-700">{section.name}</span>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        ) : (
          <div className="space-y-2">
            {sectionOrder.map((sectionId, index) => {
              const section = sectionConfig[sectionId];
              const isHidden = hiddenSections.includes(sectionId);
              if (isHidden) return null;
              return (
                <div key={sectionId} className="flex items-center space-x-2 text-sm bg-white p-2 rounded">
                  <span className="text-blue-600 font-medium">{index + 1}.</span>
                  <span className="text-gray-700">{section.name}</span>
                </div>
              );
            })}
          </div>
        )}
      </div>

      {/* Hidden Sections Alert */}
      {hiddenSections.length > 0 && (
        <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
          <div className="flex items-start space-x-2">
            <AlertCircle className="w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5" />
            <div>
              <h5 className="font-medium text-orange-900 mb-1">Hidden Sections</h5>
              <p className="text-sm text-orange-700 mb-2">
                The following sections are hidden and won't appear in your CV:
              </p>
              <div className="flex flex-wrap gap-2">
                {hiddenSections.map(sectionId => {
                  const section = sectionConfig[sectionId];
                  return (
                    <span key={sectionId} className="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded-full">
                      {section.name}
                    </span>
                  );
                })}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default ImprovedSectionOrderManager;
</file>

<file path="src/components/buildCV/SampleDataSpotlight.jsx">
import React, { useEffect, useRef, useState } from 'react';
import { X, Sparkles, Zap, Coffee, ArrowDown } from 'lucide-react';
import { Button } from '@/components/ui/button';

const SampleDataSpotlight = ({ onSelectSample, onDismiss }) => {
  const [targetRect, setTargetRect] = useState(null);
  const spotlightRef = useRef(null);

  useEffect(() => {
    // Tìm element "Dùng dữ liệu mẫu" trong sidebar
    const findSampleDataSection = () => {
      // Thử nhiều cách tìm element
      let targetElement = null;
      
      // Cách 1: Tìm theo class gradient
      const gradientElements = document.querySelectorAll('.bg-gradient-to-r');
      for (let el of gradientElements) {
        if (el.textContent.includes('Dùng dữ liệu mẫu')) {
          targetElement = el;
          break;
        }
      }
      
      // Cách 2: Tìm theo text content trực tiếp
      if (!targetElement) {
        const allElements = document.querySelectorAll('*');
        for (let el of allElements) {
          if (el.textContent.trim().startsWith('Dùng dữ liệu mẫu') && 
              el.children.length > 0) {
            targetElement = el;
            break;
          }
        }
      }
      
      if (targetElement) {
        const rect = targetElement.getBoundingClientRect();
        setTargetRect({
          top: rect.top,
          left: rect.left,
          width: rect.width,
          height: rect.height,
        });
      }
    };

    // Thử tìm nhiều lần với delay tăng dần
    const timers = [
      setTimeout(findSampleDataSection, 100),
      setTimeout(findSampleDataSection, 300),
      setTimeout(findSampleDataSection, 500),
    ];
    
    // Update khi resize
    window.addEventListener('resize', findSampleDataSection);
    
    return () => {
      timers.forEach(timer => clearTimeout(timer));
      window.removeEventListener('resize', findSampleDataSection);
    };
  }, []);

  const handleSampleSelect = (sampleType) => {
    onSelectSample(sampleType);
  };

  return (
    <div className="fixed inset-0 z-50 animate-in fade-in duration-300">
      {/* Dark overlay - block clicks everywhere except spotlight */}
      <div 
        className="absolute inset-0"
        onClick={onDismiss}
        style={{ pointerEvents: 'auto' }}
      >
        {/* SVG mask để tạo spotlight effect */}
        <svg className="absolute inset-0 w-full h-full pointer-events-none">
          <defs>
            <mask id="spotlight-mask">
              {/* White background */}
              <rect x="0" y="0" width="100%" height="100%" fill="white" />
              {/* Black cutout cho spotlight area */}
              {targetRect && (
                <rect
                  x={targetRect.left - 8}
                  y={targetRect.top - 8}
                  width={targetRect.width + 16}
                  height={targetRect.height + 16}
                  rx="12"
                  fill="black"
                />
              )}
            </mask>
          </defs>
          {/* Apply mask */}
          <rect
            x="0"
            y="0"
            width="100%"
            height="100%"
            fill="rgba(0, 0, 0, 0.75)"
            mask="url(#spotlight-mask)"
          />
        </svg>

        {/* Highlight border cho spotlight area */}
        {targetRect && (
          <div
            className="absolute border-4 border-blue-500 rounded-xl shadow-2xl pointer-events-none"
            style={{
              top: targetRect.top - 8,
              left: targetRect.left - 8,
              width: targetRect.width + 16,
              height: targetRect.height + 16,
              boxShadow: '0 0 0 4px rgba(59, 130, 246, 0.3), 0 0 60px rgba(59, 130, 246, 0.5)',
              animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            }}
          />
        )}
      </div>

      {/* Transparent clickable area over spotlight - allows clicks to pass through */}
      {targetRect && (
        <div
          className="absolute"
          style={{
            top: targetRect.top - 8,
            left: targetRect.left - 8,
            width: targetRect.width + 16,
            height: targetRect.height + 16,
            pointerEvents: 'none', // Allow clicks to pass through to elements below
            zIndex: 1,
          }}
        />
      )}

      {/* Instruction card */}
      {targetRect && (
        <div
          className="absolute bg-white rounded-xl shadow-2xl p-6 max-w-md animate-in slide-in-from-bottom-4 duration-500"
          style={{
            top: Math.min(targetRect.top + targetRect.height + 24, window.innerHeight - 400),
            left: Math.max(16, Math.min(targetRect.left, window.innerWidth - 400)),
            maxHeight: 'calc(100vh - 100px)',
            overflowY: 'auto',
            zIndex: 10,
            pointerEvents: 'auto', // Ensure card is clickable
          }}
          onClick={(e) => e.stopPropagation()} // Prevent closing when clicking inside card
        >
          {/* Close button */}
          <button
            onClick={onDismiss}
            className="absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition-colors"
          >
            <X className="w-5 h-5" />
          </button>

          {/* Content */}
          <div className="space-y-4">
            {/* Header */}
            <div className="flex items-start gap-3">
              <div className="flex-shrink-0 w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                <Sparkles className="w-5 h-5 text-blue-600" />
              </div>
              <div>
                <h3 className="text-lg font-bold text-gray-900">
                  Bắt đầu nhanh với dữ liệu mẫu! 🚀
                </h3>
                <p className="text-sm text-gray-600 mt-1">
                  Chọn một trong các mẫu dữ liệu để xem CV của bạn sẽ trông như thế nào
                </p>
              </div>
            </div>

            {/* Arrow pointing up */}
            <div className="flex justify-center py-2">
              <div className="flex flex-col items-center text-blue-600 animate-bounce">
                <ArrowDown className="w-6 h-6 rotate-180" />
                <span className="text-xs font-medium mt-1">Click vào vùng sáng phía trên</span>
              </div>
            </div>
            
            {/* Info tip */}
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
              <p className="text-xs text-blue-800">
                <strong>💡 Mẹo:</strong> Bạn có thể click trực tiếp vào các nút trong vùng được tô sáng ở trên, 
                hoặc chọn nhanh bên dưới.
              </p>
            </div>

            {/* Quick sample buttons */}
            <div className="space-y-2">
              <p className="text-xs font-medium text-gray-500 uppercase tracking-wide">
                Hoặc chọn nhanh:
              </p>
              <div className="grid grid-cols-3 gap-2">
                <button
                  onClick={() => handleSampleSelect('default')}
                  className="flex flex-col items-center gap-1 p-3 rounded-lg border-2 border-blue-200 hover:border-blue-400 hover:bg-blue-50 transition-all group"
                >
                  <Zap className="w-5 h-5 text-blue-600 group-hover:scale-110 transition-transform" />
                  <span className="text-xs font-medium text-gray-700">Kỹ sư</span>
                </button>
                <button
                  onClick={() => handleSampleSelect('creative')}
                  className="flex flex-col items-center gap-1 p-3 rounded-lg border-2 border-purple-200 hover:border-purple-400 hover:bg-purple-50 transition-all group"
                >
                  <Sparkles className="w-5 h-5 text-purple-600 group-hover:scale-110 transition-transform" />
                  <span className="text-xs font-medium text-gray-700">Thiết kế</span>
                </button>
                <button
                  onClick={() => handleSampleSelect('minimal')}
                  className="flex flex-col items-center gap-1 p-3 rounded-lg border-2 border-orange-200 hover:border-orange-400 hover:bg-orange-50 transition-all group"
                >
                  <Coffee className="w-5 h-5 text-orange-600 group-hover:scale-110 transition-transform" />
                  <span className="text-xs font-medium text-gray-700">Marketing</span>
                </button>
              </div>
            </div>

            {/* Skip button */}
            <div className="pt-2 border-t border-gray-200">
              <Button
                variant="ghost"
                onClick={onDismiss}
                className="w-full text-gray-600 hover:text-gray-900"
              >
                Bỏ qua, tôi sẽ tự điền
              </Button>
            </div>
          </div>
        </div>
      )}

      {/* Fallback: nếu không tìm thấy target, hiển thị message */}
      {!targetRect && (
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md text-center">
            <Sparkles className="w-12 h-12 text-blue-600 mx-auto mb-4" />
            <h3 className="text-xl font-bold text-gray-900 mb-2">
              Dùng dữ liệu mẫu
            </h3>
            <p className="text-gray-600 mb-6">
              Chọn một mẫu dữ liệu để bắt đầu nhanh:
            </p>
            <div className="space-y-2">
              <Button
                onClick={() => handleSampleSelect('default')}
                className="w-full"
                variant="outline"
              >
                <Zap className="w-4 h-4 mr-2" />
                Kỹ sư phần mềm
              </Button>
              <Button
                onClick={() => handleSampleSelect('creative')}
                className="w-full"
                variant="outline"
              >
                <Sparkles className="w-4 h-4 mr-2" />
                Nhà thiết kế
              </Button>
              <Button
                onClick={() => handleSampleSelect('minimal')}
                className="w-full"
                variant="outline"
              >
                <Coffee className="w-4 h-4 mr-2" />
                Marketing
              </Button>
            </div>
            <Button
              variant="ghost"
              onClick={onDismiss}
              className="w-full mt-4"
            >
              Bỏ qua
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default SampleDataSpotlight;
</file>

<file path="src/components/buildCV/SampleDataSuggestion.jsx">
import React from 'react';
import { X, Sparkles, Zap, Coffee, ArrowRight } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';

const SampleDataSuggestion = ({ onSelectSample, onDismiss }) => {
  const samples = [
    {
      id: 'default',
      title: 'Kỹ sư phần mềm',
      description: 'Phù hợp cho vị trí lập trình viên, developer',
      icon: Zap,
      color: 'blue',
      gradient: 'from-blue-500 to-cyan-500'
    },
    {
      id: 'creative',
      title: 'Nhà thiết kế',
      description: 'Dành cho designer, UX/UI, creative',
      icon: Sparkles,
      color: 'purple',
      gradient: 'from-purple-500 to-pink-500'
    },
    {
      id: 'minimal',
      title: 'Marketing',
      description: 'Cho vị trí marketing, sales, business',
      icon: Coffee,
      color: 'orange',
      gradient: 'from-orange-500 to-red-500'
    }
  ];

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
      <Card className="max-w-3xl w-full shadow-2xl animate-in slide-in-from-bottom-4 duration-300">
        <CardContent className="p-6">
          {/* Header */}
          <div className="flex items-start justify-between mb-6">
            <div>
              <h2 className="text-2xl font-bold text-gray-900 mb-2">
                🎉 Chào mừng đến với CV Builder!
              </h2>
              <p className="text-gray-600">
                Bắt đầu nhanh với dữ liệu mẫu hoặc tự tạo từ đầu
              </p>
            </div>
            <Button
              variant="ghost"
              size="sm"
              onClick={onDismiss}
              className="text-gray-400 hover:text-gray-600"
            >
              <X className="h-5 w-5" />
            </Button>
          </div>

          {/* Sample Options */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            {samples.map((sample) => {
              const Icon = sample.icon;
              return (
                <button
                  key={sample.id}
                  onClick={() => onSelectSample(sample.id)}
                  className="group relative overflow-hidden rounded-xl border-2 border-gray-200 hover:border-transparent hover:shadow-xl transition-all duration-300 p-6 text-left bg-white hover:scale-105"
                >
                  {/* Gradient Background on Hover */}
                  <div className={`absolute inset-0 bg-gradient-to-br ${sample.gradient} opacity-0 group-hover:opacity-10 transition-opacity duration-300`} />
                  
                  {/* Content */}
                  <div className="relative">
                    <div className={`inline-flex items-center justify-center w-12 h-12 rounded-lg bg-${sample.color}-100 text-${sample.color}-600 mb-4 group-hover:scale-110 transition-transform duration-300`}>
                      <Icon className="w-6 h-6" />
                    </div>
                    
                    <h3 className="font-semibold text-gray-900 mb-2 group-hover:text-gray-900">
                      {sample.title}
                    </h3>
                    
                    <p className="text-sm text-gray-600 mb-4">
                      {sample.description}
                    </p>
                    
                    <div className="flex items-center text-sm font-medium text-blue-600 group-hover:text-blue-700">
                      Sử dụng mẫu này
                      <ArrowRight className="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" />
                    </div>
                  </div>
                </button>
              );
            })}
          </div>

          {/* Skip Button */}
          <div className="flex items-center justify-center pt-4 border-t border-gray-200">
            <Button
              variant="ghost"
              onClick={onDismiss}
              className="text-gray-600 hover:text-gray-900"
            >
              Bỏ qua, tôi sẽ tự điền thông tin
            </Button>
          </div>

          {/* Tips */}
          <div className="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
            <p className="text-sm text-blue-800">
              <strong>💡 Mẹo:</strong> Bạn có thể chỉnh sửa mọi thông tin sau khi chọn mẫu. 
              Dữ liệu mẫu giúp bạn hình dung cách CV sẽ trông như thế nào!
            </p>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default SampleDataSuggestion;
</file>

<file path="src/components/buildCV/SectionManagerDemo.jsx">
import React, { useState } from 'react';
import ImprovedSectionOrderManager from './ImprovedSectionOrderManager';
import { Play, Code, Eye } from 'lucide-react';

/**
 * Demo component để test Section Order Manager
 * Có thể dùng để development và testing
 */
const SectionManagerDemo = () => {
  const [cvData, setCVData] = useState({
    sectionOrder: ['summary', 'experience', 'education', 'skills', 'projects', 'certificates'],
    hiddenSections: [],
    template: 'modern-blue'
  });

  const [showCode, setShowCode] = useState(false);

  const templates = [
    { id: 'modern-blue', name: 'Modern Blue', type: 'Single Column' },
    { id: 'classic-white', name: 'Classic White', type: 'Single Column' },
    { id: 'two-column-sidebar', name: 'Two Column Sidebar', type: 'Two Column' },
    { id: 'creative-split', name: 'Creative Split', type: 'Two Column' },
    { id: 'minimal-gray', name: 'Minimal Gray', type: 'Single Column' }
  ];

  const handleTemplateChange = (newTemplate) => {
    setCVData(prev => ({ ...prev, template: newTemplate }));
  };

  const handleSectionOrderChange = (newOrder) => {
    setCVData(prev => ({ ...prev, sectionOrder: newOrder }));
  };

  const handleHiddenSectionsChange = (newHidden) => {
    setCVData(prev => ({ ...prev, hiddenSections: newHidden }));
  };

  const codeExample = `import ImprovedSectionOrderManager from '@/components/buildCV/ImprovedSectionOrderManager';

function CVBuilder() {
  const [cvData, setCVData] = useState({
    sectionOrder: ${JSON.stringify(cvData.sectionOrder, null, 2)},
    hiddenSections: ${JSON.stringify(cvData.hiddenSections, null, 2)},
    template: '${cvData.template}'
  });

  return (
    <ImprovedSectionOrderManager
      sectionOrder={cvData.sectionOrder}
      hiddenSections={cvData.hiddenSections}
      currentTemplate={cvData.template}
      onChange={(newOrder) => 
        setCVData(prev => ({ ...prev, sectionOrder: newOrder }))
      }
      onHiddenChange={(newHidden) => 
        setCVData(prev => ({ ...prev, hiddenSections: newHidden }))
      }
    />
  );
}`;

  return (
    <div className="min-h-screen bg-gray-50 p-8">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h1 className="text-3xl font-bold text-gray-900 flex items-center">
                <Play className="w-8 h-8 mr-3 text-blue-600" />
                Section Order Manager Demo
              </h1>
              <p className="text-gray-600 mt-2">
                Test and preview the section order manager with different templates
              </p>
            </div>
            <button
              onClick={() => setShowCode(!showCode)}
              className="flex items-center space-x-2 px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors"
            >
              <Code className="w-4 h-4" />
              <span>{showCode ? 'Hide' : 'Show'} Code</span>
            </button>
          </div>

          {/* Template Selector */}
          <div className="border-t pt-4">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Select Template to Test:
            </label>
            <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
              {templates.map(template => (
                <button
                  key={template.id}
                  onClick={() => handleTemplateChange(template.id)}
                  className={`p-3 rounded-lg border-2 transition-all ${
                    cvData.template === template.id
                      ? 'border-blue-500 bg-blue-50 text-blue-700'
                      : 'border-gray-200 hover:border-gray-300 text-gray-700'
                  }`}
                >
                  <div className="font-medium text-sm">{template.name}</div>
                  <div className="text-xs text-gray-500 mt-1">{template.type}</div>
                </button>
              ))}
            </div>
          </div>
        </div>

        {/* Code Example */}
        {showCode && (
          <div className="bg-gray-900 rounded-lg shadow-lg p-6 mb-6 overflow-x-auto">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-white font-semibold flex items-center">
                <Code className="w-5 h-5 mr-2" />
                Usage Example
              </h3>
              <button
                onClick={() => {
                  navigator.clipboard.writeText(codeExample);
                  alert('Code copied to clipboard!');
                }}
                className="text-sm px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
              >
                Copy Code
              </button>
            </div>
            <pre className="text-green-400 text-sm font-mono">
              <code>{codeExample}</code>
            </pre>
          </div>
        )}

        {/* Main Demo Area */}
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Section Manager */}
          <div className="lg:col-span-2">
            <div className="bg-white rounded-lg shadow-sm p-6">
              <ImprovedSectionOrderManager
                sectionOrder={cvData.sectionOrder}
                hiddenSections={cvData.hiddenSections}
                currentTemplate={cvData.template}
                onChange={handleSectionOrderChange}
                onHiddenChange={handleHiddenSectionsChange}
              />
            </div>
          </div>

          {/* State Preview */}
          <div className="space-y-6">
            {/* Current State */}
            <div className="bg-white rounded-lg shadow-sm p-6">
              <h3 className="font-semibold text-gray-900 mb-4 flex items-center">
                <Eye className="w-5 h-5 mr-2 text-blue-600" />
                Current State
              </h3>
              
              <div className="space-y-4">
                <div>
                  <label className="text-sm font-medium text-gray-700">Template:</label>
                  <div className="mt-1 p-2 bg-blue-50 rounded text-blue-700 font-mono text-sm">
                    {cvData.template}
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium text-gray-700">
                    Section Order ({cvData.sectionOrder.length}):
                  </label>
                  <div className="mt-1 p-2 bg-gray-50 rounded">
                    <ol className="text-sm space-y-1">
                      {cvData.sectionOrder.map((section, index) => (
                        <li key={section} className="flex items-center">
                          <span className="text-gray-500 mr-2">{index + 1}.</span>
                          <span className={`font-mono ${
                            cvData.hiddenSections.includes(section) 
                              ? 'text-gray-400 line-through' 
                              : 'text-gray-700'
                          }`}>
                            {section}
                          </span>
                          {cvData.hiddenSections.includes(section) && (
                            <span className="ml-2 text-xs text-orange-600 bg-orange-100 px-2 py-0.5 rounded">
                              hidden
                            </span>
                          )}
                        </li>
                      ))}
                    </ol>
                  </div>
                </div>

                <div>
                  <label className="text-sm font-medium text-gray-700">
                    Hidden Sections ({cvData.hiddenSections.length}):
                  </label>
                  <div className="mt-1 p-2 bg-orange-50 rounded">
                    {cvData.hiddenSections.length === 0 ? (
                      <p className="text-sm text-gray-500 italic">No hidden sections</p>
                    ) : (
                      <div className="flex flex-wrap gap-2">
                        {cvData.hiddenSections.map(section => (
                          <span key={section} className="text-xs px-2 py-1 bg-orange-200 text-orange-800 rounded font-mono">
                            {section}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>

            {/* JSON Output */}
            <div className="bg-white rounded-lg shadow-sm p-6">
              <h3 className="font-semibold text-gray-900 mb-4">JSON Output</h3>
              <div className="bg-gray-900 rounded p-4 overflow-x-auto">
                <pre className="text-green-400 text-xs font-mono">
                  {JSON.stringify(cvData, null, 2)}
                </pre>
              </div>
              <button
                onClick={() => {
                  navigator.clipboard.writeText(JSON.stringify(cvData, null, 2));
                  alert('JSON copied to clipboard!');
                }}
                className="mt-3 w-full text-sm px-3 py-2 bg-gray-900 text-white rounded hover:bg-gray-800 transition-colors"
              >
                Copy JSON
              </button>
            </div>

            {/* Quick Actions */}
            <div className="bg-white rounded-lg shadow-sm p-6">
              <h3 className="font-semibold text-gray-900 mb-4">Quick Actions</h3>
              <div className="space-y-2">
                <button
                  onClick={() => handleHiddenSectionsChange([])}
                  className="w-full px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors text-sm"
                >
                  Show All Sections
                </button>
                <button
                  onClick={() => handleHiddenSectionsChange(['projects', 'certificates'])}
                  className="w-full px-3 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 transition-colors text-sm"
                >
                  Hide Optional Sections
                </button>
                <button
                  onClick={() => {
                    const reversed = [...cvData.sectionOrder].reverse();
                    handleSectionOrderChange(reversed);
                  }}
                  className="w-full px-3 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors text-sm"
                >
                  Reverse Order
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* Footer */}
        <div className="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <p className="text-sm text-blue-800">
            <strong>💡 Tip:</strong> Try switching between different templates to see how the section manager 
            adapts to single-column and two-column layouts. Drag sections, hide/show them, and observe 
            the state changes in real-time.
          </p>
        </div>
      </div>
    </div>
  );
};

export default SectionManagerDemo;
</file>

<file path="src/components/buildCV/SectionOrderManager.jsx">
import React from 'react';
import { Settings, GripVertical, ChevronUp, ChevronDown, FileText, Briefcase, GraduationCap, Award, FolderOpen, AlignCenterVertical as Certificate, Eye, EyeOff } from 'lucide-react';

const SectionOrderManager = ({ sectionOrder, onChange, hiddenSections, onHiddenChange }) => {
  const sectionConfig = {
    summary: {
      id: 'summary',
      name: 'Professional Summary',
      icon: FileText,
      description: 'Brief overview of your professional background'
    },
    experience: {
      id: 'experience',
      name: 'Work Experience',
      icon: Briefcase,
      description: 'Your work history and achievements'
    },
    education: {
      id: 'education',
      name: 'Education',
      icon: GraduationCap,
      description: 'Your educational background'
    },
    skills: {
      id: 'skills',
      name: 'Skills',
      icon: Award,
      description: 'Technical and soft skills'
    },
    projects: {
      id: 'projects',
      name: 'Projects',
      icon: FolderOpen,
      description: 'Personal and professional projects'
    },
    certificates: {
      id: 'certificates',
      name: 'Certificates',
      icon: Certificate,
      description: 'Professional certifications and achievements'
    }
  };

  const [dragOverIndex, setDragOverIndex] = React.useState(null);

  const moveSection = (index, direction) => {
    const newOrder = [...sectionOrder];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    
    if (targetIndex >= 0 && targetIndex < newOrder.length) {
      [newOrder[index], newOrder[targetIndex]] = [newOrder[targetIndex], newOrder[index]];
      onChange(newOrder);
    }
  };

  const handleDragStart = (e, index) => {
    e.dataTransfer.setData('text/plain', index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex) => {
    e.preventDefault();
    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));

    if (dragIndex === dropIndex) {
      setDragOverIndex(null);
      return;
    }

    const newOrder = [...sectionOrder];
    const [draggedItem] = newOrder.splice(dragIndex, 1);
    
    const newDropIndex = dragIndex < dropIndex ? dropIndex - 1 : dropIndex;
    
    newOrder.splice(newDropIndex, 0, draggedItem);
    onChange(newOrder);

    setDragOverIndex(null);
  };

  const toggleSectionVisibility = (sectionId) => {
    const newHiddenSections = hiddenSections.includes(sectionId)
      ? hiddenSections.filter(id => id !== sectionId)
      : [...hiddenSections, sectionId];
    onHiddenChange(newHiddenSections);
  };

  const resetToDefault = () => {
    onChange(['summary', 'experience', 'education', 'skills', 'projects', 'certificates']);
    onHiddenChange([]);
  };


  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold text-gray-800 flex items-center">
          <Settings className="w-5 h-5 mr-2 text-blue-600" />
          CV Layout & Section Order
        </h3>
        <button
          onClick={resetToDefault}
          className="text-sm text-blue-600 hover:text-blue-700 font-medium"
        >
          Reset to Default
        </button>
      </div>


      {/* Section Reordering */}
      <div>
        <h4 className="font-medium text-gray-800 mb-3">Customize Section Order</h4>
        <div className="text-sm text-gray-600 bg-yellow-50 p-3 rounded-lg mb-4">
          💡 <strong>Tip:</strong> Drag and drop sections to reorder them, or use the arrow buttons. 
          The order here will be reflected in your CV preview and PDF export.
        </div>
        
        <div className="space-y-3">
          {sectionOrder.map((sectionId, index) => {
            const section = sectionConfig[sectionId];
            const Icon = section.icon;
            const isHidden = hiddenSections.includes(sectionId);
            const isDraggingOver = dragOverIndex === index;
            
            return (
              <div
                key={sectionId}
                className={`p-4 border rounded-lg transition-all relative ${
                  isHidden ? 'bg-gray-50 border-gray-200 opacity-60' : 'bg-white border-gray-200 hover:shadow-md'
                }`}
                draggable={!isHidden}
                onDragStart={(e) => handleDragStart(e, index)}
                onDragOver={handleDragOver}
                onDrop={(e) => handleDrop(e, index)}
                onDragEnter={() => setDragOverIndex(index)}
                onDragEnd={() => setDragOverIndex(null)}
              >
                {isDraggingOver && <div className="absolute top-0 left-0 w-full h-0.5 bg-black" />}
                <div className="flex items-center space-x-3">
                  {/* Drag Handle */}
                  <div className="flex flex-col items-center space-y-1">
                    <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
                    <div className="flex flex-col space-y-1">
                      <button
                        onClick={() => moveSection(index, 'up')}
                        disabled={index === 0}
                        className={`p-1 rounded ${
                          index === 0 
                            ? 'text-gray-300 cursor-not-allowed' 
                            : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                        }`}
                        title="Move up"
                      >
                        <ChevronUp className="w-3 h-3" />
                      </button>
                      <button
                        onClick={() => moveSection(index, 'down')}
                        disabled={index === sectionOrder.length - 1}
                        className={`p-1 rounded ${
                          index === sectionOrder.length - 1 
                            ? 'text-gray-300 cursor-not-allowed' 
                            : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                        }`}
                        title="Move down"
                      >
                        <ChevronDown className="w-3 h-3" />
                      </button>
                    </div>
                  </div>

                  {/* Section Info */}
                  <div className="flex items-center space-x-3 flex-1">
                    <Icon className={`w-5 h-5 ${isHidden ? 'text-gray-400' : 'text-blue-600'}`} />
                    <div className="flex-1">
                      <div className={`font-medium ${isHidden ? 'text-gray-500' : 'text-gray-800'}`}>
                        {section.name}
                      </div>
                      <div className="text-sm text-gray-500">{section.description}</div>
                    </div>
                  </div>

                  {/* Position Badge */}
                  <div className="flex items-center space-x-2">
                    <span className={`text-xs px-2 py-1 rounded-full ${
                      isHidden 
                        ? 'bg-gray-200 text-gray-500' 
                        : 'bg-blue-100 text-blue-700'
                    }`}>
                      Position {index + 1}
                    </span>
                    
                    {/* Visibility Toggle */}
                    <button
                      onClick={() => toggleSectionVisibility(sectionId)}
                      className={`p-1 rounded ${
                        isHidden 
                          ? 'text-gray-400 hover:text-gray-600' 
                          : 'text-blue-600 hover:text-blue-700'
                      }`}
                      title={isHidden ? 'Show section' : 'Hide section'}
                    >
                      {isHidden ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
                    </button>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {/* Layout Preview */}
      <div className="bg-gray-50 rounded-lg p-4">
        <h4 className="font-medium text-gray-800 mb-3">Layout Preview</h4>
        <div className="space-y-2">
          {sectionOrder.map((sectionId, index) => {
            const section = sectionConfig[sectionId];
            const isHidden = hiddenSections.includes(sectionId);
            
            if (isHidden) return null;
            
            return (
              <div key={sectionId} className="flex items-center space-x-2 text-sm">
                <span className="text-blue-600 font-medium">{index + 1}.</span>
                <span className="text-gray-700">{section.name}</span>
              </div>
            );
          })}
        </div>
      </div>

      {/* Tips */}
      <div className="bg-green-50 rounded-lg p-4">
        <h4 className="font-medium text-gray-800 mb-2">💡 Layout Tips</h4>
        <ul className="text-sm text-gray-700 space-y-1">
          <li>• Put your strongest sections first (usually Experience or Skills)</li>
          <li>• Recent graduates should consider Education before Experience</li>
          <li>• Developers and creatives often benefit from Projects section early</li>
          <li>• Keep Professional Summary at the top for best impact</li>
          <li>• Hide sections you don't need to keep your CV focused</li>
        </ul>
      </div>
    </div>
  );
};

export default SectionOrderManager;
</file>

<file path="src/components/buildCV/SimpleSectionOrderManager.jsx">
import React, { useState } from 'react';
import { 
  Settings, GripVertical, ChevronUp, ChevronDown, 
  FileText, Briefcase, GraduationCap, Award, FolderOpen, 
  AlignCenterVertical as Certificate, Eye, EyeOff, 
  Columns2, LayoutList, RotateCcw, Info, AlertCircle 
} from 'lucide-react';
import { 
  isTwoColumnTemplate, 
  splitSectionsByColumn, 
  moveSectionInColumn,
  getDefaultSectionOrder 
} from '@/utils/templateHelpers';

/**
 * Simplified Section Order Manager - Không dùng internal state
 * Tất cả state được quản lý bởi parent component
 */
const SimpleSectionOrderManager = ({ 
  sectionOrder, 
  onChange, 
  hiddenSections, 
  onHiddenChange, 
  currentTemplate 
}) => {
  const [dragOverIndex, setDragOverIndex] = useState(null);
  const [dragOverColumn, setDragOverColumn] = useState(null);

  const sectionConfig = {
    summary: {
      id: 'summary',
      name: 'Professional Summary',
      icon: FileText,
      description: 'Brief overview of your professional background',
      color: 'blue'
    },
    experience: {
      id: 'experience',
      name: 'Work Experience',
      icon: Briefcase,
      description: 'Your work history and achievements',
      color: 'purple'
    },
    education: {
      id: 'education',
      name: 'Education',
      icon: GraduationCap,
      description: 'Your educational background',
      color: 'green'
    },
    skills: {
      id: 'skills',
      name: 'Skills',
      icon: Award,
      description: 'Technical and soft skills',
      color: 'orange'
    },
    projects: {
      id: 'projects',
      name: 'Projects',
      icon: FolderOpen,
      description: 'Personal and professional projects',
      color: 'indigo'
    },
    certificates: {
      id: 'certificates',
      name: 'Certificates',
      icon: Certificate,
      description: 'Professional certifications and achievements',
      color: 'pink'
    }
  };

  const isTwoColumn = isTwoColumnTemplate(currentTemplate);
  const { sidebar: sidebarSections, main: mainSections } = isTwoColumn 
    ? splitSectionsByColumn(sectionOrder, currentTemplate)
    : { sidebar: [], main: sectionOrder };

  // Move section up/down
  const handleMoveSection = (sectionId, direction) => {
    const newOrder = moveSectionInColumn(sectionOrder, currentTemplate, sectionId, direction);
    onChange(newOrder);
  };

  // Check if can move
  const canMoveUp = (sectionId) => {
    if (isTwoColumn) {
      const { sidebar, main } = splitSectionsByColumn(sectionOrder, currentTemplate);
      const columnSections = sidebar.includes(sectionId) ? sidebar : main;
      const index = columnSections.indexOf(sectionId);
      return index > 0;
    }
    return sectionOrder.indexOf(sectionId) > 0;
  };

  const canMoveDown = (sectionId) => {
    if (isTwoColumn) {
      const { sidebar, main } = splitSectionsByColumn(sectionOrder, currentTemplate);
      const columnSections = sidebar.includes(sectionId) ? sidebar : main;
      const index = columnSections.indexOf(sectionId);
      return index < columnSections.length - 1;
    }
    return sectionOrder.indexOf(sectionId) < sectionOrder.length - 1;
  };

  // Toggle visibility
  const handleToggleVisibility = (sectionId) => {
    if (hiddenSections.includes(sectionId)) {
      onHiddenChange(hiddenSections.filter(id => id !== sectionId));
    } else {
      onHiddenChange([...hiddenSections, sectionId]);
    }
  };

  // Reset to default
  const handleReset = () => {
    const defaultOrder = getDefaultSectionOrder(currentTemplate);
    onChange(defaultOrder);
    onHiddenChange([]);
  };

  // Drag & Drop handlers
  const handleDragStart = (e, index, column = null) => {
    e.dataTransfer.setData('text/plain', JSON.stringify({ index, column }));
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex, dropColumn = null) => {
    e.preventDefault();
    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
    const dragIndex = data.index;
    const dragColumn = data.column;

    if (dragIndex === dropIndex && dragColumn === dropColumn) {
      setDragOverIndex(null);
      setDragOverColumn(null);
      return;
    }

    let newFullOrder;

    if (dropColumn) {
      const columnSections = dropColumn === 'sidebar' ? sidebarSections : mainSections;
      const newColumnOrder = [...columnSections];
      const [draggedItem] = newColumnOrder.splice(dragIndex, 1);
      const newDropIndex = dragIndex < dropIndex ? dropIndex - 1 : dropIndex;
      newColumnOrder.splice(newDropIndex, 0, draggedItem);

      const otherColumn = dropColumn === 'sidebar' ? mainSections : sidebarSections;
      newFullOrder = dropColumn === 'sidebar' 
        ? [...newColumnOrder, ...otherColumn]
        : [...otherColumn, ...newColumnOrder];
    } else {
      newFullOrder = [...sectionOrder];
      const [draggedItem] = newFullOrder.splice(dragIndex, 1);
      const newDropIndex = dragIndex < dropIndex ? dropIndex - 1 : dropIndex;
      newFullOrder.splice(newDropIndex, 0, draggedItem);
    }

    onChange(newFullOrder);
    setDragOverIndex(null);
    setDragOverColumn(null);
  };

  const renderSectionItem = (sectionId, index, columnSections = null, columnName = null) => {
    const section = sectionConfig[sectionId];
    const Icon = section.icon;
    const isHidden = hiddenSections.includes(sectionId);
    const isDraggingOver = dragOverIndex === index && dragOverColumn === columnName;

    const colorClasses = {
      blue: 'border-blue-500 bg-blue-50',
      purple: 'border-purple-500 bg-purple-50',
      green: 'border-green-500 bg-green-50',
      orange: 'border-orange-500 bg-orange-50',
      indigo: 'border-indigo-500 bg-indigo-50',
      pink: 'border-pink-500 bg-pink-50'
    };

    return (
      <div
        key={sectionId}
        className={`p-4 border-l-4 rounded-lg transition-all relative ${
          isHidden 
            ? 'bg-gray-50 border-gray-200 opacity-60' 
            : `${colorClasses[section.color]} hover:shadow-md`
        }`}
        draggable={!isHidden}
        onDragStart={(e) => handleDragStart(e, index, columnName)}
        onDragOver={handleDragOver}
        onDrop={(e) => handleDrop(e, index, columnName)}
        onDragEnter={() => {
          setDragOverIndex(index);
          setDragOverColumn(columnName);
        }}
        onDragEnd={() => {
          setDragOverIndex(null);
          setDragOverColumn(null);
        }}
      >
        {isDraggingOver && <div className="absolute top-0 left-0 w-full h-0.5 bg-blue-500" />}
        
        <div className="flex items-center space-x-3">
          <div className="flex flex-col items-center space-y-1">
            <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
            <div className="flex flex-col space-y-1">
              <button
                onClick={() => handleMoveSection(sectionId, 'up')}
                disabled={!canMoveUp(sectionId)}
                className={`p-1 rounded ${
                  !canMoveUp(sectionId)
                    ? 'text-gray-300 cursor-not-allowed' 
                    : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                }`}
                title="Move up"
              >
                <ChevronUp className="w-3 h-3" />
              </button>
              <button
                onClick={() => handleMoveSection(sectionId, 'down')}
                disabled={!canMoveDown(sectionId)}
                className={`p-1 rounded ${
                  !canMoveDown(sectionId)
                    ? 'text-gray-300 cursor-not-allowed' 
                    : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                }`}
                title="Move down"
              >
                <ChevronDown className="w-3 h-3" />
              </button>
            </div>
          </div>

          <div className={`flex items-center space-x-3 flex-1 p-2 rounded ${isHidden ? '' : 'bg-white'}`}>
            <Icon className={`w-5 h-5 ${isHidden ? 'text-gray-400' : `text-${section.color}-600`}`} />
            <div className="flex-1">
              <div className={`font-medium ${isHidden ? 'text-gray-500' : 'text-gray-800'}`}>
                {section.name}
              </div>
              <div className="text-sm text-gray-500">{section.description}</div>
            </div>
          </div>

          <div className="flex items-center space-x-2">
            <span className={`text-xs px-2 py-1 rounded-full ${
              isHidden 
                ? 'bg-gray-200 text-gray-500' 
                : `bg-${section.color}-100 text-${section.color}-700`
            }`}>
              #{index + 1}
            </span>
            <button
              onClick={() => handleToggleVisibility(sectionId)}
              className={`p-2 rounded-full transition-colors ${
                isHidden 
                  ? 'text-gray-400 hover:text-gray-600 hover:bg-gray-100' 
                  : `text-${section.color}-600 hover:text-${section.color}-700 hover:bg-${section.color}-100`
              }`}
              title={isHidden ? 'Show section' : 'Hide section'}
            >
              {isHidden ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
            </button>
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center space-x-2">
          <Settings className="w-5 h-5 text-blue-600" />
          <h3 className="text-lg font-semibold text-gray-800">Bố cục & Thứ tự Sections</h3>
        </div>
        <button
          onClick={handleReset}
          className="flex items-center space-x-1 px-3 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-md transition-colors"
        >
          <RotateCcw className="w-4 h-4" />
          <span>Reset mặc định</span>
        </button>
      </div>

      {/* Template Layout Info */}
      {isTwoColumn && (
        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4">
          <div className="flex items-start space-x-3">
            <Columns2 className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
            <div>
              <h4 className="font-medium text-blue-900 mb-1">Template 2 cột đang được sử dụng</h4>
              <p className="text-sm text-blue-700">
                Template này sử dụng bố cục 2 cột. Sections được chia thành{' '}
                <strong>Sidebar</strong> (cột trái) và <strong>Nội dung chính</strong> (cột phải).
                Bạn có thể sắp xếp lại sections trong mỗi cột độc lập.
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Info Box */}
      <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <div className="flex items-start space-x-2">
          <Info className="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" />
          <div className="text-sm text-yellow-800">
            <strong>Mẹo:</strong> Kéo thả sections để sắp xếp lại, hoặc dùng nút mũi tên.{' '}
            {isTwoColumn && 'Mỗi cột có thể sắp xếp độc lập. '}
            Click icon mắt để ẩn/hiện sections trong CV của bạn.
          </div>
        </div>
      </div>

      {/* Section Reordering */}
      <div>
        <h4 className="font-medium text-gray-800 mb-3">
          {isTwoColumn ? 'Tùy chỉnh Sections theo cột' : 'Tùy chỉnh thứ tự Sections'}
        </h4>

        {isTwoColumn ? (
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
            {/* Sidebar Column */}
            <div className="space-y-3">
              <div className="flex items-center space-x-2 mb-2 p-2 bg-purple-50 rounded-lg">
                <LayoutList className="w-4 h-4 text-purple-600" />
                <h5 className="font-semibold text-gray-700">Sidebar (Cột trái)</h5>
                <span className="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full">
                  {sidebarSections.length} sections
                </span>
              </div>
              {sidebarSections.map((sectionId, index) => 
                renderSectionItem(sectionId, index, sidebarSections, 'sidebar')
              )}
            </div>

            {/* Main Content Column */}
            <div className="space-y-3">
              <div className="flex items-center space-x-2 mb-2 p-2 bg-green-50 rounded-lg">
                <FileText className="w-4 h-4 text-green-600" />
                <h5 className="font-semibold text-gray-700">Nội dung chính (Cột phải)</h5>
                <span className="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">
                  {mainSections.length} sections
                </span>
              </div>
              {mainSections.map((sectionId, index) => 
                renderSectionItem(sectionId, index, mainSections, 'main')
              )}
            </div>
          </div>
        ) : (
          <div className="space-y-3">
            {sectionOrder.map((sectionId, index) => renderSectionItem(sectionId, index))}
          </div>
        )}
      </div>

      {/* Layout Preview */}
      <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
        <h4 className="font-medium text-gray-800 mb-3 flex items-center">
          <Eye className="w-4 h-4 mr-2" />
          Xem trước bố cục
        </h4>
        
        {isTwoColumn ? (
          <div className="grid grid-cols-2 gap-4">
            <div>
              <h5 className="text-xs font-semibold text-purple-600 mb-2 uppercase tracking-wide">Sidebar</h5>
              <div className="space-y-2">
                {sidebarSections.map((sectionId, index) => {
                  const section = sectionConfig[sectionId];
                  const isHidden = hiddenSections.includes(sectionId);
                  if (isHidden) return null;
                  return (
                    <div key={sectionId} className="flex items-center space-x-2 text-sm bg-white p-2 rounded">
                      <span className="text-purple-600 font-medium">{index + 1}.</span>
                      <span className="text-gray-700">{section.name}</span>
                    </div>
                  );
                })}
              </div>
            </div>
            <div>
              <h5 className="text-xs font-semibold text-green-600 mb-2 uppercase tracking-wide">Nội dung chính</h5>
              <div className="space-y-2">
                {mainSections.map((sectionId, index) => {
                  const section = sectionConfig[sectionId];
                  const isHidden = hiddenSections.includes(sectionId);
                  if (isHidden) return null;
                  return (
                    <div key={sectionId} className="flex items-center space-x-2 text-sm bg-white p-2 rounded">
                      <span className="text-green-600 font-medium">{index + 1}.</span>
                      <span className="text-gray-700">{section.name}</span>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        ) : (
          <div className="space-y-2">
            {sectionOrder.map((sectionId, index) => {
              const section = sectionConfig[sectionId];
              const isHidden = hiddenSections.includes(sectionId);
              if (isHidden) return null;
              return (
                <div key={sectionId} className="flex items-center space-x-2 text-sm bg-white p-2 rounded">
                  <span className="text-blue-600 font-medium">{index + 1}.</span>
                  <span className="text-gray-700">{section.name}</span>
                </div>
              );
            })}
          </div>
        )}
      </div>

      {/* Hidden Sections Alert */}
      {hiddenSections.length > 0 && (
        <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
          <div className="flex items-start space-x-2">
            <AlertCircle className="w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5" />
            <div>
              <h5 className="font-medium text-orange-900 mb-1">Sections đang ẩn</h5>
              <p className="text-sm text-orange-700 mb-2">
                Các sections sau đang bị ẩn và sẽ không xuất hiện trong CV:
              </p>
              <div className="flex flex-wrap gap-2">
                {hiddenSections.map(sectionId => {
                  const section = sectionConfig[sectionId];
                  return (
                    <span key={sectionId} className="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded-full">
                      {section.name}
                    </span>
                  );
                })}
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default SimpleSectionOrderManager;
</file>

<file path="src/components/buildCV/SortableList.jsx">
import React from 'react';
import { GripVertical, ChevronUp, ChevronDown, Trash2 } from 'lucide-react';

const SortableList = ({ 
  items, 
  onReorder, 
  onRemove, 
  renderItem, 
  itemKey = 'id',
  className = '',
  showMoveButtons = true,
  showDragHandle = true 
}) => {
  const [dragOverIndex, setDragOverIndex] = React.useState(null);

  // Move item up/down
  const moveItem = (index, direction) => {
    const newArray = [...items];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    
    if (targetIndex >= 0 && targetIndex < newArray.length) {
      [newArray[index], newArray[targetIndex]] = [newArray[targetIndex], newArray[index]];
      onReorder(newArray);
    }
  };

  // Drag and drop handlers
  const handleDragStart = (e, index) => {
    e.dataTransfer.setData('text/plain', index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex) => {
    e.preventDefault();
    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));

    if (dragIndex === dropIndex) {
      setDragOverIndex(null);
      return;
    }

    const newArray = [...items];
    const [draggedItem] = newArray.splice(dragIndex, 1);
    
    const newDropIndex = dragIndex < dropIndex ? dropIndex - 1 : dropIndex;
    
    newArray.splice(newDropIndex, 0, draggedItem);
    onReorder(newArray);

    setDragOverIndex(null);
  };

  if (items.length === 0) {
    return null;
  }

  return (
    <div className={`space-y-3 ${className}`}>
      {items.map((item, index) => {
        const isDraggingOver = dragOverIndex === index;
        return (
        <div
          key={item[itemKey]}
          className="relative group bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow"
          draggable={showDragHandle}
          onDragStart={(e) => handleDragStart(e, index)}
          onDragOver={handleDragOver}
          onDrop={(e) => handleDrop(e, index)}
          onDragEnter={() => setDragOverIndex(index)}
          onDragEnd={() => setDragOverIndex(null)}
        >
          {isDraggingOver && <div className="absolute top-0 left-0 w-full h-0.5 bg-black" />}
          {/* Controls */}
          <div className="absolute left-2 top-4 flex flex-col items-center space-y-1">
            {showDragHandle && (
              <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
            )}
            
            {showMoveButtons && (
              <div className="flex flex-col space-y-1">
                <button
                  onClick={() => moveItem(index, 'up')}
                  disabled={index === 0}
                  className={`p-1 rounded ${
                    index === 0 
                      ? 'text-gray-300 cursor-not-allowed' 
                      : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                  }`}
                  title="Move up"
                >
                  <ChevronUp className="w-3 h-3" />
                </button>
                <button
                  onClick={() => moveItem(index, 'down')}
                  disabled={index === items.length - 1}
                  className={`p-1 rounded ${
                    index === items.length - 1 
                      ? 'text-gray-300 cursor-not-allowed' 
                      : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'
                  }`}
                  title="Move down"
                >
                  <ChevronDown className="w-3 h-3" />
                </button>
              </div>
            )}
          </div>

          {/* Remove button */}
          {onRemove && (
            <button
              onClick={() => onRemove(item[itemKey])}
              className="absolute right-2 top-4 text-red-500 hover:text-red-700 transition-colors opacity-0 group-hover:opacity-100"
              title="Remove item"
            >
              <Trash2 className="w-4 h-4" />
            </button>
          )}

          {/* Content */}
          <div className="ml-8 mr-8">
            <div className="flex items-center space-x-2 mb-2">
              <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">
                Position {index + 1}
              </span>
            </div>
            {renderItem(item, index)}
          </div>
        </div>
      )})}
    </div>
  );
};

export default SortableList;
</file>

<file path="src/components/chat/ChatInterface.jsx">
import { useState, useEffect, useCallback, useRef } from 'react';
import { useSelector } from 'react-redux';
import { X, MessageCircle, Wifi, WifiOff, Loader2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { toast } from 'sonner';
import ConversationList from './ConversationList';
import MessageThread from './MessageThread';
import socketService from '@/services/socketService';
import { cn } from '@/lib/utils';
import { getAccessToken } from '@/utils/token';

/**
 * ChatInterface Component
 * Main chat interface with conversation list sidebar and message thread
 * Manages Socket.io connection lifecycle and conversation selection
 * 
 * @param {Object} props
 * @param {boolean} props.isOpen - Whether the chat interface is open
 * @param {Function} props.onClose - Callback to close the chat interface
 * @param {string} props.conversationId - Initial conversation ID to open (optional)
 */
const ChatInterface = ({ 
  isOpen, 
  onClose, 
  conversationId: initialConversationId = null
}) => {
  const [selectedConversation, setSelectedConversation] = useState(null);
  const [connectionStatus, setConnectionStatus] = useState('disconnected'); // 'connected', 'connecting', 'reconnecting', 'disconnected'
  const [reconnectAttempt, setReconnectAttempt] = useState(0);
  const [nextRetryDelay, setNextRetryDelay] = useState(0);
  const [showMobileThread, setShowMobileThread] = useState(false);
  
  // Get current user and token from Redux
  const currentUser = useSelector((state) => state.auth.user?.user);
  const token = getAccessToken();
  
  // Use ref to track if we've already initiated connection
  const isConnectionInitiatedRef = useRef(false);

  /**
   * Establish Socket connection on mount
   */
  useEffect(() => {
    if (!isOpen || !token) {
      return;
    }

    // If already connected, don't reconnect
    const isSocketConnected = socketService.getConnectionStatus();
    if (isSocketConnected) {
      console.log('[ChatInterface] Socket already connected');
      setConnectionStatus('connected');
      return;
    }

    // If already initiating connection, don't do it again
    if (isConnectionInitiatedRef.current) {
      console.log('[ChatInterface] Connection already in progress, waiting...');
      return;
    }

    // Disconnect any stale instance
    console.log('[ChatInterface] Disconnecting any stale socket instance...');
    socketService.disconnect();

    // Start connection once
    console.log('[ChatInterface] Establishing Socket connection...');
    isConnectionInitiatedRef.current = true;
    setConnectionStatus('connecting');

    const connectSocket = async () => {
      try {
        await socketService.connect(token);
        console.log('[ChatInterface] Socket.connect() call successful');
        
        if (socketService.getConnectionStatus()) {
          setConnectionStatus('connected');
        }
      } catch (error) {
        console.error('[ChatInterface] Socket.connect() call failed immediately:', error.message);
        setConnectionStatus('disconnected');
        isConnectionInitiatedRef.current = false;
      }
    };

    connectSocket();

    return () => {
      console.log('[ChatInterface] Component unmounting, keeping socket connected');
      isConnectionInitiatedRef.current = false;
    };
  }, [isOpen, token]);

  /**
   * Handle connection status events
   */
  useEffect(() => {
    if (!isOpen) return;

    // Connection established
    const handleConnect = () => {
      console.log('[ChatInterface] Socket connected');
      setConnectionStatus('connected');
      setReconnectAttempt(0);
    };

    // Connection lost
    const handleDisconnect = (reason) => {
      console.log('[ChatInterface] Socket disconnected:', reason);
      setConnectionStatus('disconnected');
    };

    // Connection error
    const handleConnectionError = (data) => {
      console.error('[ChatInterface] Socket connection error:', data);
      setConnectionStatus('disconnected');
      if (data?.attempt) {
        setReconnectAttempt(data.attempt);
      }
      if (data?.nextDelay) {
        setNextRetryDelay(data.nextDelay);
      }
    };

    // Reconnecting
    const handleReconnecting = (attemptNumber) => {
      console.log('[ChatInterface] Socket reconnecting, attempt:', attemptNumber);
      setConnectionStatus('reconnecting');
      setReconnectAttempt(attemptNumber);
    };

    // Reconnected successfully
    const handleReconnect = (attemptNumber) => {
      console.log('[ChatInterface] Socket reconnected after', attemptNumber, 'attempts');
      setConnectionStatus('connected');
      setReconnectAttempt(0);
    };

    // Reconnection failed
    const handleReconnectFailed = () => {
      console.error('[ChatInterface] Socket reconnection failed');
      setConnectionStatus('disconnected');
    };

    // Register event handlers
    socketService.onConnect(handleConnect);
    socketService.onDisconnect(handleDisconnect);
    socketService.onConnectionError(handleConnectionError);
    socketService.onReconnecting(handleReconnecting);
    socketService.onReconnect(handleReconnect);
    socketService.onReconnectFailed(handleReconnectFailed);

    // Cleanup
    return () => {
      socketService.off('onConnect', handleConnect);
      socketService.off('onDisconnect', handleDisconnect);
      socketService.off('onConnectionError', handleConnectionError);
      socketService.off('onReconnecting', handleReconnecting);
      socketService.off('onReconnect', handleReconnect);
      socketService.off('onReconnectFailed', handleReconnectFailed);
    };
  }, [isOpen]);

  /**
   * Handle initial conversation selection
   */
  useEffect(() => {
    if (!isOpen || connectionStatus !== 'connected' || !initialConversationId) {
      return;
    }

    console.log('[ChatInterface] Selecting initial conversationId:', initialConversationId);
    setSelectedConversation({
      _id: initialConversationId,
    });
    setShowMobileThread(true);
  }, [isOpen, initialConversationId, connectionStatus]);

  /**
   * Handle conversation selection from list
   */
  const handleConversationSelect = useCallback((conversation) => {
    console.log('[ChatInterface] Conversation selected:', conversation._id);
    setSelectedConversation(conversation);
    setShowMobileThread(true);
  }, []);

  /**
   * Handle back button on mobile
   */
  const handleBackToList = useCallback(() => {
    setShowMobileThread(false);
  }, []);

  /**
   * Handle close button
   */
  const handleClose = useCallback(() => {
    setSelectedConversation(null);
    setShowMobileThread(false);
    onClose();
  }, [onClose]);

  /**
   * Get other participant from conversation
   */
  const getOtherParticipant = (conversation) => {
    if (!conversation || !currentUser) return null;
    
    if (conversation.participant1?._id === currentUser._id) {
      return conversation.participant2;
    }
    return conversation.participant1;
  };

  /**
   * Render connection status indicator
   */
  const renderConnectionStatus = () => {
    if (connectionStatus === 'connected') {
      return (
        <div className="flex items-center gap-2 text-xs text-green-600">
          <Wifi className="h-3 w-3" />
          <span>Đã kết nối</span>
        </div>
      );
    }

    if (connectionStatus === 'connecting') {
      return (
        <div className="flex items-center gap-2 text-xs text-muted-foreground">
          <Loader2 className="h-3 w-3 animate-spin" />
          <span>Đang kết nối...</span>
        </div>
      );
    }

    if (connectionStatus === 'reconnecting') {
      const delaySeconds = Math.round(nextRetryDelay / 1000);
      return (
        <div className="flex items-center gap-2 text-xs text-amber-600">
          <Loader2 className="h-3 w-3 animate-spin" />
          <span>
            Đang kết nối lại... (lần {reconnectAttempt}
            {delaySeconds > 0 && `, thử lại sau ${delaySeconds}s`})
          </span>
        </div>
      );
    }

    return (
      <div className="flex items-center gap-2 text-xs text-destructive">
        <WifiOff className="h-3 w-3" />
        <span>Mất kết nối</span>
      </div>
    );
  };

  // Don't render if not open
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 bg-background/80 backdrop-blur-sm">
      <div className="fixed inset-4 md:inset-auto md:right-4 md:bottom-4 md:top-4 md:w-[900px] md:max-w-[calc(100vw-2rem)] bg-background border rounded-lg shadow-lg flex flex-col">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b">
          <div className="flex items-center gap-3">
            <MessageCircle className="h-5 w-5 text-primary" />
            <div>
              <h2 className="text-lg font-semibold">Tin nhắn</h2>
              {renderConnectionStatus()}
            </div>
          </div>
          <Button
            variant="ghost"
            size="icon"
            onClick={handleClose}
            className="flex-shrink-0"
          >
            <X className="h-5 w-5" />
          </Button>
        </div>

        {/* Connection error alert */}
        {connectionStatus === 'disconnected' && (
          <Alert variant="destructive" className="m-4 mb-0">
            <WifiOff className="h-4 w-4" />
            <AlertDescription className="flex items-center justify-between">
              <span>Mất kết nối với máy chủ. Đang thử kết nối lại...</span>
              <Button
                variant="outline"
                size="sm"
                className="ml-2 h-7"
                onClick={async () => {
                  console.log('[ChatInterface] Manual reconnect triggered');
                  socketService.disconnect();
                  isConnectionInitiatedRef.current = false;
                  
                  setConnectionStatus('connecting');
                  isConnectionInitiatedRef.current = true;
                  
                  try {
                    await socketService.connect(token);
                    console.log('[ChatInterface] Manual reconnect successful');
                    setConnectionStatus('connected');
                  } catch (error) {
                    console.error('[ChatInterface] Manual reconnect failed:', error);
                  }
                }}
              >
                Thử lại
              </Button>
            </AlertDescription>
          </Alert>
        )}
        
        {/* Reconnecting alert */}
        {connectionStatus === 'reconnecting' && (
          <Alert className="m-4 mb-0 border-amber-500 bg-amber-50 text-amber-900">
            <Loader2 className="h-4 w-4 animate-spin" />
            <AlertDescription>
              Đang kết nối lại với máy chủ... (lần thử {reconnectAttempt})
            </AlertDescription>
          </Alert>
        )}

        {/* Main content area */}
        <div className="flex-1 flex overflow-hidden">
          {/* Conversation List - Sidebar */}
          <div className={cn(
            "w-full md:w-80 border-r flex-shrink-0",
            showMobileThread && "hidden md:block"
          )}>
            <ConversationList
              selectedConversationId={selectedConversation?._id}
              onConversationSelect={handleConversationSelect}
            />
          </div>

          {/* Message Thread - Main area */}
          <div className={cn(
            "flex-1 flex flex-col",
            !showMobileThread && "hidden md:flex"
          )}>
            {selectedConversation ? (
              <>
                {/* Mobile back button */}
                <div className="md:hidden flex items-center gap-2 p-2 border-b">
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={handleBackToList}
                  >
                    ← Quay lại
                  </Button>
                </div>
                
                {/* Show loading state while connecting */}
                {connectionStatus === 'connecting' ? (
                  <div className="flex flex-col items-center justify-center h-full p-6 text-center">
                    <Loader2 className="h-12 w-12 text-primary animate-spin mb-4" />
                    <h3 className="text-lg font-semibold mb-2">
                      Đang kết nối...
                    </h3>
                    <p className="text-sm text-muted-foreground max-w-sm">
                      Vui lòng đợi trong giây lát
                    </p>
                  </div>
                ) : (
                  /* Message thread */
                  <MessageThread
                    conversationId={selectedConversation._id}
                    recipientId={getOtherParticipant(selectedConversation)?._id}
                    recipientName={getOtherParticipant(selectedConversation)?.fullName || 'Nhà tuyển dụng'}
                    recipientAvatar={getOtherParticipant(selectedConversation)?.avatar}
                  />
                )}
              </>
            ) : (
              // Empty state - no conversation selected
              <div className="flex flex-col items-center justify-center h-full p-6 text-center">
                <MessageCircle className="h-16 w-16 text-muted-foreground mb-4" />
                <h3 className="text-lg font-semibold mb-2">
                  Chọn một cuộc trò chuyện
                </h3>
                <p className="text-sm text-muted-foreground max-w-sm">
                  Chọn một cuộc trò chuyện từ danh sách bên trái để xem tin nhắn
                </p>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default ChatInterface;
</file>

<file path="src/components/chat/ConversationList.jsx">
import { useState, useEffect, useCallback } from 'react';
import { useQuery } from '@tanstack/react-query';
import { useSelector } from 'react-redux';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Skeleton } from '@/components/ui/skeleton';
import { MessageCircle } from 'lucide-react';
import { getConversations } from '@/services/chatService';
import socketService from '@/services/socketService';
import { cn } from '@/lib/utils';
import { formatDistanceToNow } from 'date-fns';
import { vi } from 'date-fns/locale';

/**
 * ConversationList Component
 * Displays all conversations sorted by lastMessageAt with real-time updates
 * 
 * @param {Object} props
 * @param {string} props.selectedConversationId - Currently selected conversation ID
 * @param {Function} props.onConversationSelect - Callback when conversation is clicked
 */
const ConversationList = ({ selectedConversationId, onConversationSelect }) => {
  const [conversations, setConversations] = useState([]);
  
  // Get current user from Redux
  const currentUser = useSelector((state) => state.auth.user?.user);

  // Fetch conversations using React Query
  const { 
    data: conversationsData, 
    isLoading, 
    isError,
    error,
    refetch 
  } = useQuery({
    queryKey: ['conversations'],
    queryFn: getConversations,
    refetchOnWindowFocus: true,
    staleTime: 30000, // 30 seconds
  });

  // Update local state when data changes
  useEffect(() => {
    if (conversationsData) {
      // Sort by lastMessageAt (most recent first)
      const sorted = [...conversationsData].sort((a, b) => {
        const dateA = new Date(a.lastMessageAt || a.createdAt);
        const dateB = new Date(b.lastMessageAt || b.createdAt);
        return dateB - dateA;
      });
      setConversations(sorted);
    }
  }, [conversationsData]);

  // Handle new message event from Socket.io
  const handleNewMessage = useCallback((message) => {
    console.log('[ConversationList] New message received:', message);
    
    setConversations(prevConversations => {
      // Find the conversation that received the message
      const conversationIndex = prevConversations.findIndex(
        conv => conv._id === message.conversationId
      );

      if (conversationIndex === -1) {
        // New conversation, refetch to get full data
        refetch();
        return prevConversations;
      }

      // Update the conversation with new message
      const updatedConversations = [...prevConversations];
      const conversation = { ...updatedConversations[conversationIndex] };
      
      // Update last message info
      conversation.lastMessage = {
        _id: message._id,
        content: message.content,
        senderId: message.senderId,
        createdAt: message.sentAt || message.createdAt
      };
      conversation.lastMessageAt = message.sentAt || message.createdAt;
      
      // Increment unread count if message is from other user
      if (message.senderId !== currentUser?._id) {
        conversation.unreadCount = (conversation.unreadCount || 0) + 1;
      }

      // Remove from current position
      updatedConversations.splice(conversationIndex, 1);
      
      // Add to top
      updatedConversations.unshift(conversation);

      return updatedConversations;
    });
  }, [refetch, currentUser]);

  // Handle message read event
  const handleMessageRead = useCallback((data) => {
    console.log('[ConversationList] Messages marked as read:', data);
    
    setConversations(prevConversations => {
      return prevConversations.map(conv => {
        if (conv._id === data.conversationId) {
          return {
            ...conv,
            unreadCount: 0
          };
        }
        return conv;
      });
    });
  }, []);

  // Subscribe to Socket.io events
  useEffect(() => {
    socketService.onNewMessage(handleNewMessage);
    socketService.onMessageRead(handleMessageRead);

    // Cleanup
    return () => {
      socketService.off('onNewMessage', handleNewMessage);
      socketService.off('onMessageRead', handleMessageRead);
    };
  }, [handleNewMessage, handleMessageRead]);

  /**
   * Get initials from name for avatar fallback
   */
  const getInitials = (name) => {
    if (!name) return '?';
    const parts = name.trim().split(' ');
    if (parts.length >= 2) {
      return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
    }
    return name.substring(0, 2).toUpperCase();
  };

  /**
   * Format timestamp to relative time
   */
  const formatTimestamp = (timestamp) => {
    if (!timestamp) return '';
    
    try {
      return formatDistanceToNow(new Date(timestamp), {
        addSuffix: true,
        locale: vi
      });
    } catch (error) {
      console.error('Error formatting timestamp:', error);
      return '';
    }
  };

  /**
   * Truncate message preview
   */
  const truncateMessage = (message, maxLength = 50) => {
    if (!message) return 'Chưa có tin nhắn';
    if (message.length <= maxLength) return message;
    return message.substring(0, maxLength) + '...';
  };

  /**
   * Get other participant info from conversation
   */
  const getOtherParticipant = (conversation) => {
    // Assuming conversation has participant1 and participant2
    // and one of them is the current user
    if (conversation.participant1?._id === currentUser?._id) {
      return conversation.participant2;
    }
    return conversation.participant1;
  };

  // Loading state
  if (isLoading) {
    return (
      <div className="space-y-2 p-2">
        {[1, 2, 3, 4, 5].map((i) => (
          <div key={i} className="flex items-center gap-3 p-3">
            <Skeleton className="h-12 w-12 rounded-full" />
            <div className="flex-1 space-y-2">
              <Skeleton className="h-4 w-3/4" />
              <Skeleton className="h-3 w-1/2" />
            </div>
          </div>
        ))}
      </div>
    );
  }

  // Error state
  if (isError) {
    return (
      <div className="flex flex-col items-center justify-center h-full p-6 text-center">
        <MessageCircle className="h-12 w-12 text-muted-foreground mb-3" />
        <p className="text-sm text-muted-foreground mb-2">
          Không thể tải danh sách cuộc trò chuyện
        </p>
        <p className="text-xs text-muted-foreground">
          {error?.message || 'Đã xảy ra lỗi'}
        </p>
      </div>
    );
  }

  // Empty state
  if (!conversations || conversations.length === 0) {
    return (
      <div className="flex flex-col items-center justify-center h-full p-6 text-center">
        <MessageCircle className="h-12 w-12 text-muted-foreground mb-3" />
        <p className="text-sm font-medium mb-1">Chưa có cuộc trò chuyện</p>
        <p className="text-xs text-muted-foreground">
          Nhà tuyển dụng sẽ liên hệ với bạn qua tin nhắn
        </p>
      </div>
    );
  }

  return (
    <ScrollArea className="h-full">
      <div className="space-y-1 p-2">
        {conversations.map((conversation) => {
          const otherParticipant = getOtherParticipant(conversation);
          const isSelected = conversation._id === selectedConversationId;
          const hasUnread = conversation.unreadCount > 0;

          return (
            <button
              key={conversation._id}
              onClick={() => onConversationSelect(conversation)}
              className={cn(
                "w-full flex items-start gap-3 p-3 rounded-lg transition-colors",
                "hover:bg-accent focus:outline-none focus:ring-2 focus:ring-ring",
                isSelected && "bg-accent",
                hasUnread && "bg-muted/50"
              )}
            >
              {/* Avatar */}
              <div className="relative flex-shrink-0">
                <Avatar className="h-12 w-12">
                  <AvatarImage 
                    src={otherParticipant?.avatar} 
                    alt={otherParticipant?.fullName || 'User'} 
                  />
                  <AvatarFallback>
                    {getInitials(otherParticipant?.fullName)}
                  </AvatarFallback>
                </Avatar>
              </div>

              {/* Content */}
              <div className="flex-1 min-w-0 text-left">
                {/* Name and timestamp */}
                <div className="flex items-start justify-between gap-2 mb-1">
                  <h4 className={cn(
                    "text-sm font-medium truncate",
                    hasUnread && "font-semibold"
                  )}>
                    {otherParticipant?.fullName || 'Nhà tuyển dụng'}
                  </h4>
                  <span className="text-xs text-muted-foreground flex-shrink-0">
                    {formatTimestamp(conversation.lastMessageAt || conversation.createdAt)}
                  </span>
                </div>

                {/* Last message preview */}
                <div className="flex items-center justify-between gap-2">
                  <p className={cn(
                    "text-sm text-muted-foreground truncate",
                    hasUnread && "font-medium text-foreground"
                  )}>
                    {truncateMessage(conversation.lastMessage?.content)}
                  </p>
                  
                  {/* Unread badge */}
                  {hasUnread && (
                    <Badge 
                      variant="default" 
                      className="h-5 min-w-[20px] px-1.5 text-xs flex-shrink-0"
                    >
                      {conversation.unreadCount > 99 ? '99+' : conversation.unreadCount}
                    </Badge>
                  )}
                </div>
              </div>
            </button>
          );
        })}
      </div>
    </ScrollArea>
  );
};

export default ConversationList;
</file>

<file path="src/components/chat/MessageThread.jsx">
import { useState, useEffect, useRef, useCallback } from 'react';
import { useQuery, useQueryClient } from '@tanstack/react-query';
import { useSelector } from 'react-redux';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Skeleton } from '@/components/ui/skeleton';
import { Send, Check, CheckCheck, AlertCircle, RefreshCw, Loader2 } from 'lucide-react';
import { getConversationMessages, markConversationAsRead } from '@/services/chatService';
import socketService from '@/services/socketService';
import { cn } from '@/lib/utils';
import { format, isToday, isYesterday } from 'date-fns';
import { vi } from 'date-fns/locale';

/**
 * MessageThread Component
 * Displays messages in a conversation with real-time updates and infinite scroll
 * 
 * @param {Object} props
 * @param {string} props.conversationId - Conversation ID
 * @param {string} props.recipientId - Recipient user ID
 * @param {string} props.recipientName - Recipient name
 * @param {string} props.recipientAvatar - Recipient avatar URL
 */
const MessageThread = ({ 
  conversationId, 
  recipientId, 
  recipientName, 
  recipientAvatar 
}) => {
  const [messages, setMessages] = useState([]);
  const [messageInput, setMessageInput] = useState('');
  const [isSending, setIsSending] = useState(false);
  const [failedMessages, setFailedMessages] = useState(new Map());
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);
  const [isLoadingMore, setIsLoadingMore] = useState(false);
  const [isTyping, setIsTyping] = useState(false);
  const [isOnline, setIsOnline] = useState(false);
  const [isSyncing, setIsSyncing] = useState(false);
  
  const scrollAreaRef = useRef(null);
  const messagesEndRef = useRef(null);
  const typingTimeoutRef = useRef(null);
  const shouldScrollRef = useRef(true);
  const previousScrollHeightRef = useRef(0);
  
  const queryClient = useQueryClient();
  
  // Get current user from Redux
  const currentUser = useSelector((state) => state.auth.user?.user);

  // Fetch initial messages
  const { 
    data: messagesData, 
    isLoading, 
    isError,
    error 
  } = useQuery({
    queryKey: ['messages', conversationId, page],
    queryFn: () => getConversationMessages(conversationId, page, 50),
    enabled: !!conversationId,
    staleTime: 30000,
  });

  // Update messages when data changes
  useEffect(() => {
    if (messagesData?.data) {
      setMessages(prevMessages => {
        if (page === 1) {
          // First page, replace all messages
          return messagesData.data;
        } else {
          // Append older messages to the beginning
          const newMessages = messagesData.data.filter(
            newMsg => !prevMessages.some(msg => msg._id === newMsg._id)
          );
          return [...newMessages, ...prevMessages];
        }
      });
      
      // Check if there are more messages
      setHasMore(messagesData.data.length === 50);
    }
  }, [messagesData, page]);

  // Auto-scroll to bottom on new messages
  useEffect(() => {
    if (shouldScrollRef.current && messagesEndRef.current) {
      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, [messages]);

  // Join conversation room on mount - wait for socket connection
  useEffect(() => {
    if (!conversationId) return;

    let hasJoined = false;
    let joinTimeout = null;

    // Function to join conversation
    const joinConversation = () => {
      if (hasJoined) return;
      
      console.log('[MessageThread] Joining conversation:', conversationId);
      socketService.joinConversation(conversationId);
      hasJoined = true;
      
      // Mark messages as read
      markConversationAsRead(conversationId).catch(err => {
        console.error('Failed to mark conversation as read:', err);
      });
    };

    // If already connected, join immediately
    if (socketService.getConnectionStatus()) {
      joinConversation();
    } else {
      // Otherwise, wait for connection
      console.log('[MessageThread] Socket not connected yet, waiting for connection...');
      
      const handleConnect = () => {
        console.log('[MessageThread] Socket connected, now joining conversation');
        // Add small delay to ensure connection is fully established
        joinTimeout = setTimeout(() => {
          joinConversation();
        }, 100);
      };

      socketService.onConnect(handleConnect);

      // Also try to join after a timeout as fallback
      joinTimeout = setTimeout(() => {
        if (!hasJoined && socketService.getConnectionStatus()) {
          console.log('[MessageThread] Timeout reached, attempting to join conversation');
          joinConversation();
        }
      }, 2000);

      // Cleanup: remove listener
      return () => {
        if (joinTimeout) clearTimeout(joinTimeout);
        socketService.off('onConnect', handleConnect);
        if (hasJoined && socketService.getConnectionStatus()) {
          socketService.leaveConversation(conversationId);
        }
      };
    }

    // Cleanup for immediate join case
    return () => {
      if (joinTimeout) clearTimeout(joinTimeout);
      if (hasJoined && socketService.getConnectionStatus()) {
        socketService.leaveConversation(conversationId);
      }
    };
  }, [conversationId]);

  // Handle new message from Socket.io
  const handleNewMessage = useCallback((message) => {
    if (message.conversationId !== conversationId) return;
    
    console.log('[MessageThread] New message received:', message);
    
    setMessages(prevMessages => {
      // Check if message already exists (avoid duplicates)
      const exists = prevMessages.some(msg => msg._id === message._id);
      if (exists) return prevMessages;
      
      return [...prevMessages, message];
    });
    
    // Auto-scroll to bottom for new messages
    shouldScrollRef.current = true;
    
    // Mark as read if from other user
    if (message.senderId !== currentUser?._id) {
      markConversationAsRead(conversationId).catch(err => {
        console.error('Failed to mark message as read:', err);
      });
    }
  }, [conversationId, currentUser]);

  // Handle message read receipt
  const handleMessageRead = useCallback((data) => {
    if (data.conversationId !== conversationId) return;
    
    console.log('[MessageThread] Messages marked as read:', data);
    
    setMessages(prevMessages => {
      return prevMessages.map(msg => {
        if (data.messageIds.includes(msg._id)) {
          return { ...msg, isRead: true, readAt: new Date().toISOString() };
        }
        return msg;
      });
    });
  }, [conversationId]);

  // Handle typing indicators
  const handleTypingStart = useCallback((data) => {
    if (data.conversationId !== conversationId) return;
    if (data.userId === currentUser?._id) return;
    
    console.log('[MessageThread] User started typing:', data.userId);
    setIsTyping(true);
  }, [conversationId, currentUser]);

  const handleTypingStop = useCallback((data) => {
    if (data.conversationId !== conversationId) return;
    if (data.userId === currentUser?._id) return;
    
    console.log('[MessageThread] User stopped typing:', data.userId);
    setIsTyping(false);
  }, [conversationId, currentUser]);

  // Handle user presence (online status)
  const handleUserPresence = useCallback((data) => {
    // Check if the presence update is for the recipient
    if (data.userId === recipientId) {
      console.log('[MessageThread] User presence update:', data);
      setIsOnline(data.isOnline || data.status === 'online');
    }
  }, [recipientId]);

  // Handle reconnection - sync missed messages
  const handleReconnect = useCallback(async () => {
    console.log('[MessageThread] Socket reconnected, syncing missed messages...');
    
    // Get the timestamp of the last message
    if (messages.length === 0) return;
    
    const lastMessage = messages[messages.length - 1];
    const lastTimestamp = lastMessage.sentAt || lastMessage.createdAt;
    
    if (!lastTimestamp) return;
    
    setIsSyncing(true);
    
    try {
      const missedMessages = await socketService.syncMissedMessages(
        conversationId,
        lastTimestamp
      );
      
      if (missedMessages && missedMessages.length > 0) {
        console.log('[MessageThread] Synced', missedMessages.length, 'missed messages');
        
        setMessages(prevMessages => {
          // Filter out duplicates
          const newMessages = missedMessages.filter(
            newMsg => !prevMessages.some(msg => msg._id === newMsg._id)
          );
          
          return [...prevMessages, ...newMessages];
        });
        
        // Auto-scroll to show new messages
        shouldScrollRef.current = true;
      }
    } catch (error) {
      console.error('[MessageThread] Failed to sync missed messages:', error);
    } finally {
      setIsSyncing(false);
    }
  }, [conversationId, messages]);

  // Subscribe to Socket.io events
  useEffect(() => {
    socketService.onNewMessage(handleNewMessage);
    socketService.onMessageRead(handleMessageRead);
    socketService.onTypingStart(handleTypingStart);
    socketService.onTypingStop(handleTypingStop);
    socketService.onUserPresence(handleUserPresence);
    socketService.onReconnect(handleReconnect);

    return () => {
      socketService.off('onNewMessage', handleNewMessage);
      socketService.off('onMessageRead', handleMessageRead);
      socketService.off('onTypingStart', handleTypingStart);
      socketService.off('onTypingStop', handleTypingStop);
      socketService.off('onUserPresence', handleUserPresence);
      socketService.off('onReconnect', handleReconnect);
    };
  }, [handleNewMessage, handleMessageRead, handleTypingStart, handleTypingStop, handleUserPresence, handleReconnect]);

  // Handle input change with typing indicator
  const handleInputChange = (e) => {
    const value = e.target.value;
    setMessageInput(value);
    
    // Send typing indicator
    if (value.trim() && !typingTimeoutRef.current) {
      socketService.startTyping(conversationId);
    }
    
    // Clear previous timeout
    if (typingTimeoutRef.current) {
      clearTimeout(typingTimeoutRef.current);
    }
    
    // Stop typing after 3 seconds of inactivity
    typingTimeoutRef.current = setTimeout(() => {
      socketService.stopTyping(conversationId);
      typingTimeoutRef.current = null;
    }, 3000);
  };

  // Send message
  const handleSendMessage = async () => {
    const content = messageInput.trim();
    if (!content || isSending) return;
    
    // Clear typing indicator
    if (typingTimeoutRef.current) {
      clearTimeout(typingTimeoutRef.current);
      typingTimeoutRef.current = null;
    }
    socketService.stopTyping(conversationId);
    
    // Generate temporary message ID
    const tempMessageId = `temp_${Date.now()}_${Math.random()}`;
    
    // Create optimistic message
    const optimisticMessage = {
      _id: tempMessageId,
      conversationId,
      senderId: currentUser?._id,
      recipientId,
      content,
      sentAt: new Date().toISOString(),
      isRead: false,
      status: 'sending',
      isOptimistic: true
    };
    
    // Add optimistic message to UI
    setMessages(prev => [...prev, optimisticMessage]);
    setMessageInput('');
    setIsSending(true);
    shouldScrollRef.current = true;
    
    try {
      // Send message via Socket.io
      const response = await socketService.sendMessage(
        conversationId,
        content,
        tempMessageId
      );
      
      console.log('[MessageThread] Message sent successfully:', response);
      
      // Update optimistic message with real data
      setMessages(prev => prev.map(msg => {
        if (msg._id === tempMessageId) {
          return {
            ...response.message,
            status: 'sent'
          };
        }
        return msg;
      }));
      
      // Remove from failed messages if it was there
      setFailedMessages(prev => {
        const newMap = new Map(prev);
        newMap.delete(tempMessageId);
        return newMap;
      });
      
    } catch (error) {
      console.error('[MessageThread] Failed to send message:', error);
      
      // Mark message as failed
      setMessages(prev => prev.map(msg => {
        if (msg._id === tempMessageId) {
          return { ...msg, status: 'failed' };
        }
        return msg;
      }));
      
      // Store failed message for retry
      setFailedMessages(prev => new Map(prev).set(tempMessageId, content));
      
    } finally {
      setIsSending(false);
    }
  };

  // Retry failed message
  const handleRetryMessage = async (messageId) => {
    const content = failedMessages.get(messageId);
    if (!content) return;
    
    console.log('[MessageThread] Retrying failed message:', messageId);
    
    // Update message status to sending
    setMessages(prev => prev.map(msg => {
      if (msg._id === messageId) {
        return { ...msg, status: 'sending' };
      }
      return msg;
    }));
    
    try {
      // Resend message via Socket.io
      const response = await socketService.sendMessage(
        conversationId,
        content,
        messageId
      );
      
      console.log('[MessageThread] Retry successful:', response);
      
      // Update message with real data
      setMessages(prev => prev.map(msg => {
        if (msg._id === messageId) {
          return {
            ...response.message,
            status: 'sent'
          };
        }
        return msg;
      }));
      
      // Remove from failed messages
      setFailedMessages(prev => {
        const newMap = new Map(prev);
        newMap.delete(messageId);
        return newMap;
      });
      
    } catch (error) {
      console.error('[MessageThread] Retry failed:', error);
      
      // Mark as failed again
      setMessages(prev => prev.map(msg => {
        if (msg._id === messageId) {
          return { ...msg, status: 'failed' };
        }
        return msg;
      }));
    }
  };

  // Handle scroll for infinite loading
  const handleScroll = useCallback((e) => {
    const target = e.target;
    const scrollTop = target.scrollTop;
    
    // Check if scrolled to top
    if (scrollTop === 0 && hasMore && !isLoadingMore) {
      console.log('[MessageThread] Loading more messages...');
      setIsLoadingMore(true);
      previousScrollHeightRef.current = target.scrollHeight;
      shouldScrollRef.current = false;
      
      // Load next page
      setPage(prev => prev + 1);
      
      setTimeout(() => {
        setIsLoadingMore(false);
      }, 500);
    }
  }, [hasMore, isLoadingMore]);

  // Restore scroll position after loading more messages
  useEffect(() => {
    if (page > 1 && scrollAreaRef.current) {
      const viewport = scrollAreaRef.current.querySelector('[data-radix-scroll-area-viewport]');
      if (viewport && previousScrollHeightRef.current) {
        const newScrollHeight = viewport.scrollHeight;
        const scrollDiff = newScrollHeight - previousScrollHeightRef.current;
        viewport.scrollTop = scrollDiff;
      }
    }
  }, [messages, page]);

  // Handle Enter key to send
  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSendMessage();
    }
  };

  /**
   * Format message timestamp
   */
  const formatMessageTime = (timestamp) => {
    if (!timestamp) return '';
    
    try {
      const date = new Date(timestamp);
      
      if (isToday(date)) {
        return format(date, 'HH:mm', { locale: vi });
      } else if (isYesterday(date)) {
        return `Hôm qua ${format(date, 'HH:mm', { locale: vi })}`;
      } else {
        return format(date, 'dd/MM/yyyy HH:mm', { locale: vi });
      }
    } catch (error) {
      console.error('Error formatting timestamp:', error);
      return '';
    }
  };

  /**
   * Get message status icon
   */
  const getStatusIcon = (message) => {
    if (message.status === 'sending') {
      return <Loader2 className="h-3 w-3 animate-spin text-muted-foreground" />;
    }
    if (message.status === 'failed') {
      return <AlertCircle className="h-3 w-3 text-destructive" />;
    }
    if (message.isRead) {
      return <CheckCheck className="h-3 w-3 text-blue-500" />;
    }
    return <Check className="h-3 w-3 text-muted-foreground" />;
  };

  /**
   * Get initials for avatar
   */
  const getInitials = (name) => {
    if (!name) return '?';
    const parts = name.trim().split(' ');
    if (parts.length >= 2) {
      return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
    }
    return name.substring(0, 2).toUpperCase();
  };

  // Loading state
  if (isLoading) {
    return (
      <div className="flex flex-col h-full">
        {/* Header skeleton */}
        <div className="flex items-center gap-3 p-4 border-b">
          <Skeleton className="h-10 w-10 rounded-full" />
          <div className="flex-1 space-y-2">
            <Skeleton className="h-4 w-32" />
            <Skeleton className="h-3 w-20" />
          </div>
        </div>
        
        {/* Messages skeleton */}
        <div className="flex-1 p-4 space-y-4">
          {[1, 2, 3, 4].map((i) => (
            <div key={i} className={cn("flex gap-2", i % 2 === 0 ? "justify-end" : "justify-start")}>
              {i % 2 !== 0 && <Skeleton className="h-8 w-8 rounded-full flex-shrink-0" />}
              <Skeleton className={cn("h-16 rounded-lg", i % 2 === 0 ? "w-2/3" : "w-1/2")} />
            </div>
          ))}
        </div>
      </div>
    );
  }

  // Error state
  if (isError) {
    return (
      <div className="flex flex-col items-center justify-center h-full p-6 text-center">
        <AlertCircle className="h-12 w-12 text-destructive mb-3" />
        <p className="text-sm font-medium mb-1">Không thể tải tin nhắn</p>
        <p className="text-xs text-muted-foreground mb-4">
          {error?.message || 'Đã xảy ra lỗi'}
        </p>
        <Button 
          variant="outline" 
          size="sm"
          onClick={() => queryClient.invalidateQueries(['messages', conversationId])}
        >
          <RefreshCw className="h-4 w-4 mr-2" />
          Thử lại
        </Button>
      </div>
    );
  }

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="flex items-center gap-3 p-4 border-b bg-background">
        <div className="relative">
          <Avatar className="h-10 w-10">
            <AvatarImage src={recipientAvatar} alt={recipientName} />
            <AvatarFallback>{getInitials(recipientName)}</AvatarFallback>
          </Avatar>
          {/* Online status indicator */}
          {isOnline && (
            <span className="absolute bottom-0 right-0 h-3 w-3 rounded-full bg-green-500 border-2 border-background" />
          )}
        </div>
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-semibold truncate">{recipientName}</h3>
            {isOnline && (
              <span className="text-xs text-green-600 font-medium">● Online</span>
            )}
          </div>
          {isTyping && (
            <p className="text-xs text-muted-foreground">Đang nhập...</p>
          )}
        </div>
      </div>

      {/* Messages */}
      <ScrollArea 
        ref={scrollAreaRef}
        className="flex-1 p-4"
        onScroll={handleScroll}
      >
        {/* Loading more indicator */}
        {isLoadingMore && (
          <div className="flex justify-center mb-4">
            <Loader2 className="h-5 w-5 animate-spin text-muted-foreground" />
          </div>
        )}
        
        {/* Syncing missed messages indicator */}
        {isSyncing && (
          <div className="flex justify-center mb-4">
            <div className="flex items-center gap-2 text-xs text-muted-foreground bg-muted px-3 py-1.5 rounded-full">
              <Loader2 className="h-3 w-3 animate-spin" />
              <span>Đang đồng bộ tin nhắn...</span>
            </div>
          </div>
        )}
        
        {/* Messages list */}
        <div className="space-y-4">
          {messages.map((message) => {
            const isSentByMe = message.senderId === currentUser?._id;
            const isFailed = message.status === 'failed';
            
            return (
              <div
                key={message._id}
                className={cn(
                  "flex gap-2 items-end",
                  isSentByMe ? "justify-end" : "justify-start"
                )}
              >
                {/* Avatar for received messages */}
                {!isSentByMe && (
                  <Avatar className="h-8 w-8 flex-shrink-0">
                    <AvatarImage src={recipientAvatar} alt={recipientName} />
                    <AvatarFallback className="text-xs">
                      {getInitials(recipientName)}
                    </AvatarFallback>
                  </Avatar>
                )}
                
                {/* Message bubble */}
                <div className={cn(
                  "flex flex-col gap-1 max-w-[70%]",
                  isSentByMe && "items-end"
                )}>
                  <div className={cn(
                    "rounded-lg px-3 py-2 break-words",
                    isSentByMe 
                      ? "bg-primary text-primary-foreground" 
                      : "bg-muted",
                    isFailed && "bg-destructive/10 border border-destructive"
                  )}>
                    <p className="text-sm whitespace-pre-wrap">{message.content}</p>
                  </div>
                  
                  {/* Timestamp and status */}
                  <div className="flex items-center gap-1 px-1">
                    <span className="text-xs text-muted-foreground">
                      {formatMessageTime(message.sentAt || message.createdAt)}
                    </span>
                    
                    {isSentByMe && (
                      <span className="flex items-center">
                        {getStatusIcon(message)}
                      </span>
                    )}
                    
                    {/* Retry button for failed messages */}
                    {isFailed && (
                      <Button
                        variant="ghost"
                        size="sm"
                        className="h-5 px-2 text-xs"
                        onClick={() => handleRetryMessage(message._id)}
                      >
                        <RefreshCw className="h-3 w-3 mr-1" />
                        Thử lại
                      </Button>
                    )}
                  </div>
                </div>
              </div>
            );
          })}
          
          {/* Scroll anchor */}
          <div ref={messagesEndRef} />
        </div>
      </ScrollArea>

      {/* Input area */}
      <div className="p-4 border-t bg-background">
        <div className="flex items-end gap-2">
          <Input
            value={messageInput}
            onChange={handleInputChange}
            onKeyPress={handleKeyPress}
            placeholder="Nhập tin nhắn..."
            disabled={isSending}
            className="flex-1"
          />
          <Button
            onClick={handleSendMessage}
            disabled={!messageInput.trim() || isSending}
            size="icon"
          >
            {isSending ? (
              <Loader2 className="h-4 w-4 animate-spin" />
            ) : (
              <Send className="h-4 w-4" />
            )}
          </Button>
        </div>
      </div>
    </div>
  );
};

export default MessageThread;
</file>

<file path="src/components/common/EmptyState.jsx">
import { Button } from '@/components/ui/button';
import { Inbox } from 'lucide-react';

/**
 * @param {{
 *  message?: string;
 *  actionText?: string;
 *  onAction?: () => void;
 * }} props
 */
export const EmptyState = ({ message = 'Không tìm thấy dữ liệu.', actionText, onAction }) => {
  return (
    <div className="flex flex-col items-center justify-center text-center py-10 px-4">
      <Inbox className="h-12 w-12 text-muted-foreground mb-4" />
      <h3 className="text-lg font-semibold text-foreground mb-2">Không có gì ở đây</h3>
      <p className="text-sm text-muted-foreground mb-6 max-w-md">{message}</p>
      {onAction && actionText && (
        <Button onClick={onAction}>
          {actionText}
        </Button>
      )}
    </div>
  );
};
</file>

<file path="src/components/common/ErrorBoundary.jsx">
import React from 'react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { AlertTriangle, RefreshCw, Home } from 'lucide-react';
import { logError } from '@/utils/errorHandling';

/**
 * Error Boundary Component
 * Catches JavaScript errors anywhere in the child component tree
 */
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      hasError: false,
      error: null,
      errorInfo: null,
      errorCount: 0
    };
  }

  static getDerivedStateFromError(error) {
    // Update state so the next render will show the fallback UI
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    // Log error to console and error tracking service
    logError(error, {
      context: this.props.context || 'ErrorBoundary',
      componentStack: errorInfo.componentStack,
      errorBoundary: true
    });

    this.setState(prevState => ({
      error,
      errorInfo,
      errorCount: prevState.errorCount + 1
    }));

    // Call custom error handler if provided
    if (this.props.onError) {
      this.props.onError(error, errorInfo);
    }
  }

  handleReset = () => {
    this.setState({
      hasError: false,
      error: null,
      errorInfo: null
    });

    // Call custom reset handler if provided
    if (this.props.onReset) {
      this.props.onReset();
    }
  };

  handleGoHome = () => {
    window.location.href = '/';
  };

  render() {
    if (this.state.hasError) {
      // Custom fallback UI if provided
      if (this.props.fallback) {
        return this.props.fallback({
          error: this.state.error,
          errorInfo: this.state.errorInfo,
          resetError: this.handleReset
        });
      }

      // Default fallback UI
      return (
        <div className="min-h-screen flex items-center justify-center p-4 bg-background">
          <Card className="max-w-2xl w-full">
            <CardHeader>
              <div className="flex items-center gap-3">
                <div className="p-2 bg-destructive/10 rounded-full">
                  <AlertTriangle className="w-6 h-6 text-destructive" />
                </div>
                <div>
                  <CardTitle>Đã xảy ra lỗi</CardTitle>
                  <CardDescription>
                    {this.props.errorMessage || 'Ứng dụng gặp sự cố không mong muốn'}
                  </CardDescription>
                </div>
              </div>
            </CardHeader>
            <CardContent className="space-y-4">
              {/* Error Details (only in development) */}
              {process.env.NODE_ENV === 'development' && this.state.error && (
                <Alert variant="destructive">
                  <AlertTitle className="text-sm font-mono">
                    {this.state.error.toString()}
                  </AlertTitle>
                  {this.state.errorInfo && (
                    <AlertDescription className="mt-2">
                      <details className="text-xs">
                        <summary className="cursor-pointer font-semibold mb-2">
                          Stack Trace
                        </summary>
                        <pre className="whitespace-pre-wrap overflow-auto max-h-40 p-2 bg-muted rounded">
                          {this.state.errorInfo.componentStack}
                        </pre>
                      </details>
                    </AlertDescription>
                  )}
                </Alert>
              )}

              {/* User-friendly message */}
              <div className="text-sm text-muted-foreground space-y-2">
                <p>
                  Chúng tôi rất xin lỗi vì sự bất tiện này. Vui lòng thử một trong các cách sau:
                </p>
                <ul className="list-disc list-inside space-y-1 ml-2">
                  <li>Tải lại trang để thử lại</li>
                  <li>Xóa cache trình duyệt và thử lại</li>
                  <li>Quay về trang chủ và thử lại</li>
                  {this.state.errorCount > 2 && (
                    <li className="text-destructive font-medium">
                      Nếu lỗi vẫn tiếp diễn, vui lòng liên hệ hỗ trợ
                    </li>
                  )}
                </ul>
              </div>

              {/* Action Buttons */}
              <div className="flex gap-3 pt-4">
                <Button
                  onClick={this.handleReset}
                  className="flex-1"
                  variant="default"
                >
                  <RefreshCw className="w-4 h-4 mr-2" />
                  Thử lại
                </Button>
                <Button
                  onClick={this.handleGoHome}
                  className="flex-1"
                  variant="outline"
                >
                  <Home className="w-4 h-4 mr-2" />
                  Về trang chủ
                </Button>
              </div>

              {/* Error Count Warning */}
              {this.state.errorCount > 2 && (
                <Alert>
                  <AlertTriangle className="h-4 w-4" />
                  <AlertDescription className="text-xs">
                    Lỗi đã xảy ra {this.state.errorCount} lần. Vui lòng liên hệ hỗ trợ nếu vấn đề vẫn tiếp diễn.
                  </AlertDescription>
                </Alert>
              )}
            </CardContent>
          </Card>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;

/**
 * Hook to use error boundary programmatically
 */
export const useErrorHandler = () => {
  const [error, setError] = React.useState(null);

  React.useEffect(() => {
    if (error) {
      throw error;
    }
  }, [error]);

  return setError;
};
</file>

<file path="src/components/common/ErrorState.jsx">
import { Button } from '@/components/ui/button';
import { AlertTriangle } from 'lucide-react';

/**
 * @param {{
 *  message?: string;
 *  onRetry: () => void;
 * }} props
 */
export const ErrorState = ({ message = 'Đã có lỗi xảy ra. Vui lòng thử lại.', onRetry }) => {
  return (
    <div className="flex flex-col items-center justify-center text-center py-10 px-4">
      <AlertTriangle className="h-12 w-12 text-destructive mb-4" />
      <h3 className="text-lg font-semibold text-destructive mb-2">Oops! Có lỗi xảy ra</h3>
      <p className="text-sm text-muted-foreground mb-6 max-w-md">{message}</p>
      <Button onClick={onRetry} variant="outline">
        Thử lại
      </Button>
    </div>
  );
};
</file>

<file path="src/components/common/FallbackUI.jsx">
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { 
  AlertCircle, 
  RefreshCw, 
  WifiOff, 
  ServerCrash, 
  Clock,
  ShieldAlert,
  FileQuestion
} from 'lucide-react';

/**
 * Generic Error Fallback
 */
export const ErrorFallback = ({ 
  title = 'Đã xảy ra lỗi',
  message = 'Không thể tải dữ liệu. Vui lòng thử lại.',
  onRetry,
  showRetry = true,
  icon: Icon = AlertCircle,
  variant = 'default'
}) => {
  return (
    <div className="flex items-center justify-center min-h-[300px] p-4">
      <Card className="max-w-md w-full">
        <CardHeader>
          <div className="flex items-center gap-3">
            <div className={`p-2 rounded-full ${
              variant === 'destructive' 
                ? 'bg-destructive/10' 
                : 'bg-muted'
            }`}>
              <Icon className={`w-6 h-6 ${
                variant === 'destructive' 
                  ? 'text-destructive' 
                  : 'text-muted-foreground'
              }`} />
            </div>
            <CardTitle className="text-lg">{title}</CardTitle>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <CardDescription>{message}</CardDescription>
          {showRetry && onRetry && (
            <Button onClick={onRetry} className="w-full">
              <RefreshCw className="w-4 h-4 mr-2" />
              Thử lại
            </Button>
          )}
        </CardContent>
      </Card>
    </div>
  );
};

/**
 * Network Error Fallback
 */
export const NetworkErrorFallback = ({ onRetry }) => {
  return (
    <ErrorFallback
      title="Không có kết nối mạng"
      message="Vui lòng kiểm tra kết nối internet và thử lại."
      onRetry={onRetry}
      icon={WifiOff}
      variant="destructive"
    />
  );
};

/**
 * Server Error Fallback
 */
export const ServerErrorFallback = ({ onRetry }) => {
  return (
    <ErrorFallback
      title="Lỗi máy chủ"
      message="Máy chủ đang gặp sự cố. Vui lòng thử lại sau ít phút."
      onRetry={onRetry}
      icon={ServerCrash}
      variant="destructive"
    />
  );
};

/**
 * Timeout Error Fallback
 */
export const TimeoutErrorFallback = ({ onRetry }) => {
  return (
    <ErrorFallback
      title="Yêu cầu quá thời gian chờ"
      message="Yêu cầu mất quá nhiều thời gian. Vui lòng thử lại."
      onRetry={onRetry}
      icon={Clock}
      variant="destructive"
    />
  );
};

/**
 * Unauthorized Error Fallback
 */
export const UnauthorizedFallback = ({ onLogin }) => {
  return (
    <ErrorFallback
      title="Phiên đăng nhập hết hạn"
      message="Vui lòng đăng nhập lại để tiếp tục."
      onRetry={onLogin}
      icon={ShieldAlert}
      variant="destructive"
    />
  );
};

/**
 * Not Found Fallback
 */
export const NotFoundFallback = ({ message, onGoBack }) => {
  return (
    <ErrorFallback
      title="Không tìm thấy"
      message={message || 'Nội dung bạn tìm kiếm không tồn tại.'}
      onRetry={onGoBack}
      icon={FileQuestion}
      showRetry={!!onGoBack}
    />
  );
};

/**
 * Loading Fallback with Skeleton
 */
export const LoadingFallback = ({ 
  title = 'Đang tải...',
  rows = 3 
}) => {
  return (
    <div className="space-y-4 p-4">
      {title && (
        <div className="flex items-center gap-2 mb-4">
          <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-primary"></div>
          <span className="text-sm text-muted-foreground">{title}</span>
        </div>
      )}
      {Array.from({ length: rows }).map((_, i) => (
        <Card key={i}>
          <CardHeader>
            <Skeleton className="h-6 w-3/4" />
            <Skeleton className="h-4 w-1/2 mt-2" />
          </CardHeader>
          <CardContent className="space-y-2">
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-5/6" />
            <Skeleton className="h-4 w-4/6" />
          </CardContent>
        </Card>
      ))}
    </div>
  );
};

/**
 * Inline Error Alert
 */
export const InlineErrorAlert = ({ 
  message, 
  onRetry,
  onDismiss,
  variant = 'destructive'
}) => {
  if (!message) return null;

  return (
    <Alert variant={variant} className="mb-4">
      <AlertCircle className="h-4 w-4" />
      <AlertTitle>Lỗi</AlertTitle>
      <AlertDescription className="flex items-center justify-between gap-4">
        <span className="flex-1">{message}</span>
        <div className="flex gap-2">
          {onRetry && (
            <Button
              variant="outline"
              size="sm"
              onClick={onRetry}
              className="flex-shrink-0"
            >
              <RefreshCw className="w-3 h-3 mr-1" />
              Thử lại
            </Button>
          )}
          {onDismiss && (
            <Button
              variant="ghost"
              size="sm"
              onClick={onDismiss}
              className="flex-shrink-0"
            >
              Đóng
            </Button>
          )}
        </div>
      </AlertDescription>
    </Alert>
  );
};

/**
 * Empty State Fallback
 */
export const EmptyStateFallback = ({ 
  title = 'Không có dữ liệu',
  message = 'Chưa có dữ liệu để hiển thị.',
  action,
  actionLabel = 'Thêm mới',
  icon: Icon = FileQuestion
}) => {
  return (
    <div className="flex flex-col items-center justify-center min-h-[300px] p-8 text-center">
      <div className="p-4 bg-muted rounded-full mb-4">
        <Icon className="w-8 h-8 text-muted-foreground" />
      </div>
      <h3 className="text-lg font-semibold mb-2">{title}</h3>
      <p className="text-sm text-muted-foreground mb-6 max-w-md">
        {message}
      </p>
      {action && (
        <Button onClick={action}>
          {actionLabel}
        </Button>
      )}
    </div>
  );
};

/**
 * Retry Button Component
 */
export const RetryButton = ({ 
  onRetry, 
  isRetrying = false,
  label = 'Thử lại',
  variant = 'outline',
  size = 'default'
}) => {
  return (
    <Button
      onClick={onRetry}
      disabled={isRetrying}
      variant={variant}
      size={size}
    >
      <RefreshCw className={`w-4 h-4 mr-2 ${isRetrying ? 'animate-spin' : ''}`} />
      {isRetrying ? 'Đang thử lại...' : label}
    </Button>
  );
};
</file>

<file path="src/components/common/HomeAutocompleteDropdown.jsx">
import React, { useRef, useEffect } from 'react';
import { Loader2, AlertCircle } from 'lucide-react';
import { cn } from '@/lib/utils';
import SuggestionItem from './SuggestionItem';
import { Skeleton } from '@/components/ui/skeleton';

/**
 * Component dropdown chứa autocomplete suggestions với keyboard navigation (phiên bản cho trang Home)
 * 
 * @param {Object} props
 * @param {Array} props.suggestions - Mảng suggestions
 * @param {string} props.query - Query string hiện tại
 * @param {boolean} props.isLoading - Trạng thái loading
 * @param {string} props.error - Error message nếu có
 * @param {number} props.selectedIndex - Index của item được chọn
 * @param {boolean} props.isVisible - Có hiển thị dropdown không
 * @param {function} props.onSuggestionClick - Handler khi click suggestion
 * @param {function} props.onSuggestionHover - Handler khi hover suggestion
 * @param {function} props.onClose - Handler để đóng dropdown
 * @param {function} props.onRetry - Handler để retry khi có lỗi
 * @param {string} props.className - Additional CSS classes
 */
const HomeAutocompleteDropdown = ({
  suggestions = [],
  query = '',
  isLoading = false,
  error = null,
  selectedIndex = -1,
  isVisible = false,
  onSuggestionClick,
  onSuggestionHover,
  onClose,
  onRetry,
  className
}) => {
  const dropdownRef = useRef(null);

  /**
   * Đóng dropdown khi click outside
   */
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        onClose?.();
      }
    };

    if (isVisible) {
      document.addEventListener('mousedown', handleClickOutside);
      return () => {
        document.removeEventListener('mousedown', handleClickOutside);
      };
    }
  }, [isVisible, onClose]);

  /**
   * Auto scroll để đảm bảo selected item visible
   */
  useEffect(() => {
    if (selectedIndex >= 0 && dropdownRef.current) {
      const selectedElement = dropdownRef.current.querySelector(
        `[data-index="${selectedIndex}"]`
      );
      if (selectedElement) {
        selectedElement.scrollIntoView({
          block: 'nearest',
          behavior: 'smooth'
        });
      }
    }
  }, [selectedIndex]);

 // Không render nếu không visible
  if (!isVisible) return null;

  return (
    <div
      ref={dropdownRef}
      className={cn(
        "absolute top-full left-0 z-50 mt-1",
        "bg-background border border-border rounded-lg shadow-lg",
        "max-h-[300px] overflow-hidden",
        "animate-in fade-in-0 zoom-in-95 duration-200",
        // Mobile: full available width
        "w-full",
        // Desktop: span across the entire search row (input + location + button)
        "lg:w-[calc(200%+2rem)]", // Double width + gaps to cover all 3 grid sections
        className
      )}
    >
      {/* Error State - Show above suggestions if there are any */}
      {error && (
        <div className="px-4 py-3 border-b border-border">
          <div className="flex items-start space-x-3">
            <AlertCircle className="h-4 w-4 text-destructive flex-shrink-0 mt-0.5" />
            <div className="space-y-1 flex-1">
              <p className="text-xs font-medium text-destructive">
                Không thể tải gợi ý mới
              </p>
              {onRetry && (
                <button
                  onClick={onRetry}
                  className="text-xs text-primary hover:text-primary/80 font-medium underline-offset-4 hover:underline"
                >
                  Thử lại
                </button>
              )}
            </div>
          </div>
        </div>
      )}

      {/* Suggestions List - Show even when loading */}
      {!error && suggestions.length > 0 && (
        <div className="max-h-[240px] overflow-y-auto">
          <ul
            role="listbox"
            aria-label="Gợi ý tiêu đề công việc"
            className="py-1"
          >
            {suggestions.map((suggestion, index) => (
              <div key={suggestion.title + index} data-index={index}>
                <SuggestionItem
                  suggestion={suggestion}
                  query={query}
                  isSelected={index === selectedIndex}
                  onClick={onSuggestionClick}
                  onMouseEnter={onSuggestionHover}
                  index={index}
                />
              </div>
            ))}
          </ul>
          
          {/* Footer với keyboard shortcuts hint */}
          <div className="border-t border-border px-4 py-2 bg-muted/30">
            <div className="flex items-center justify-between text-xs text-muted-foreground">
              <span>
                <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">↑↓</kbd> điều hướng
              </span>
              <span>
                <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">Enter</kbd> chọn
              </span>
              <span>
                <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">Esc</kbd> đóng
              </span>
            </div>
          </div>
        </div>
      )}

      {/* Loading State - Only show when no suggestions */}
      {isLoading && suggestions.length === 0 && (
        <div className="px-4 py-8">
          <div className="flex items-center space-x-2 text-muted-foreground">
            <Loader2 className="h-4 w-4 animate-spin" />
            <span className="text-sm">Đang tìm kiếm...</span>
          </div>
          
          {/* Loading Skeleton */}
          <div className="mt-4 space-y-2">
            {[...Array(3)].map((_, index) => (
              <div key={index} className="px-4 py-3 flex items-center space-x-3">
                <Skeleton className="w-4 h-4 rounded" />
                <Skeleton className="h-4 flex-1" />
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Empty State - Only show when not loading and no suggestions */}
      {!isLoading && !error && suggestions.length === 0 && query.length > 0 && (
        <div className="px-4 py-6">
          <div className="flex items-start space-x-3">
            <div className="w-5 h-5 rounded-full bg-muted flex items-center justify-center flex-shrink-0 mt-0.5">
              <svg
                className="w-3 h-3 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
            <div className="space-y-1 flex-1">
              <p className="text-sm font-medium text-foreground">
                Không tìm thấy gợi ý nào
              </p>
              <p className="text-xs text-muted-foreground">
                Thử tìm kiếm với từ khóa khác
              </p>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default HomeAutocompleteDropdown;
</file>

<file path="src/components/common/LocationPermissionAlert.jsx">
import React from 'react';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { AlertCircle, ExternalLink } from 'lucide-react';

/**
 * LocationPermissionAlert - Inline alert hiển thị khi quyền vị trí bị từ chối
 * Component nhỏ gọn để nhúng trực tiếp trong filter
 */
const LocationPermissionAlert = ({ onShowGuide }) => {
  return (
    <Alert variant="destructive" className="border-amber-200 bg-amber-50">
      <AlertCircle className="h-4 w-4 text-amber-600" />
      <AlertDescription className="text-amber-900">
        <div className="space-y-2">
          <p className="text-sm font-semibold">
            Quyền truy cập vị trí bị từ chối
          </p>
          <p className="text-xs">
            Để sử dụng tính năng lọc theo khoảng cách, bạn cần cho phép website 
            truy cập vị trí của bạn trong cài đặt trình duyệt.
          </p>
          <Button
            onClick={onShowGuide}
            variant="outline"
            size="sm"
            className="w-full mt-2 border-amber-300 bg-white hover:bg-amber-100 text-amber-900"
          >
            <ExternalLink className="h-3 w-3 mr-2" />
            Xem hướng dẫn chi tiết
          </Button>
        </div>
      </AlertDescription>
    </Alert>
  );
};

export default LocationPermissionAlert;
</file>

<file path="src/components/common/LocationPermissionDemo.jsx">
import React, { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { MapPin, Navigation, HelpCircle, CheckCircle2, XCircle } from 'lucide-react';
import { toast } from 'sonner';
import LocationPermissionGuide from './LocationPermissionGuide';
import LocationPermissionAlert from './LocationPermissionAlert';

/**
 * LocationPermissionDemo - Component demo để test Location Permission components
 * Chỉ dùng cho development/testing, không deploy lên production
 */
const LocationPermissionDemo = () => {
  const [showGuide, setShowGuide] = useState(false);
  const [permissionDenied, setPermissionDenied] = useState(false);
  const [location, setLocation] = useState(null);
  const [isGetting, setIsGetting] = useState(false);
  const [error, setError] = useState(null);

  const getLocation = () => {
    if (!navigator.geolocation) {
      toast.error('Trình duyệt không hỗ trợ định vị');
      return;
    }

    setIsGetting(true);
    setPermissionDenied(false);
    setError(null);
    setLocation(null);

    navigator.geolocation.getCurrentPosition(
      (position) => {
        setLocation({
          latitude: position.coords.latitude,
          longitude: position.coords.longitude,
          accuracy: position.coords.accuracy
        });
        setIsGetting(false);
        toast.success('Đã lấy vị trí thành công!');
      },
      (error) => {
        setIsGetting(false);
        console.error('Geolocation error:', error);

        let errorMessage = 'Không thể lấy vị trí của bạn.';
        let showGuideAuto = false;

        if (error.code === error.PERMISSION_DENIED) {
          errorMessage = 'Quyền truy cập vị trí bị từ chối. Nhấn "Xem hướng dẫn" để biết cách bật.';
          showGuideAuto = true;
          setPermissionDenied(true);
        } else if (error.code === error.POSITION_UNAVAILABLE) {
          errorMessage = 'Thông tin vị trí không khả dụng. Vui lòng kiểm tra cài đặt thiết bị.';
        } else if (error.code === error.TIMEOUT) {
          errorMessage = 'Yêu cầu lấy vị trí đã hết thời gian. Vui lòng thử lại.';
        }

        setError({
          code: error.code,
          message: errorMessage
        });

        toast.error(errorMessage, {
          duration: 5000,
          action: showGuideAuto ? {
            label: 'Xem hướng dẫn',
            onClick: () => setShowGuide(true)
          } : undefined
        });

        // Auto show guide for permission denied
        if (showGuideAuto) {
          setTimeout(() => setShowGuide(true), 1500);
        }
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  };

  const reset = () => {
    setPermissionDenied(false);
    setLocation(null);
    setError(null);
  };

  return (
    <div className="container max-w-4xl mx-auto p-6 space-y-6">
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <MapPin className="h-5 w-5 text-primary" />
            Location Permission Components Demo
          </CardTitle>
          <CardDescription>
            Test và demo các components hỗ trợ quyền truy cập vị trí
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Permission Denied Alert */}
          {permissionDenied && (
            <LocationPermissionAlert 
              onShowGuide={() => setShowGuide(true)}
            />
          )}

          {/* Action Buttons */}
          <div className="flex flex-wrap gap-3">
            <Button
              onClick={getLocation}
              disabled={isGetting}
              className="btn-gradient"
            >
              <Navigation className={`h-4 w-4 mr-2 ${isGetting ? 'animate-pulse' : ''}`} />
              {isGetting ? 'Đang lấy vị trí...' : 'Lấy vị trí của tôi'}
            </Button>

            <Button
              onClick={() => setShowGuide(true)}
              variant="outline"
            >
              <HelpCircle className="h-4 w-4 mr-2" />
              Xem hướng dẫn
            </Button>

            <Button
              onClick={reset}
              variant="ghost"
            >
              Reset
            </Button>
          </div>

          {/* Status Display */}
          <div className="space-y-4">
            {/* Success State */}
            {location && (
              <Card className="border-green-200 bg-green-50">
                <CardContent className="pt-6">
                  <div className="flex items-start gap-3">
                    <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                    <div className="space-y-2 flex-1">
                      <p className="font-semibold text-green-900">
                        Vị trí đã được lấy thành công!
                      </p>
                      <div className="text-sm text-green-800 space-y-1">
                        <p>
                          <strong>Latitude:</strong> {location.latitude.toFixed(6)}
                        </p>
                        <p>
                          <strong>Longitude:</strong> {location.longitude.toFixed(6)}
                        </p>
                        <p>
                          <strong>Accuracy:</strong> ±{location.accuracy.toFixed(0)}m
                        </p>
                      </div>
                    </div>
                  </div>
                </CardContent>
              </Card>
            )}

            {/* Error State */}
            {error && (
              <Card className="border-red-200 bg-red-50">
                <CardContent className="pt-6">
                  <div className="flex items-start gap-3">
                    <XCircle className="h-5 w-5 text-red-600 flex-shrink-0 mt-0.5" />
                    <div className="space-y-2 flex-1">
                      <p className="font-semibold text-red-900">
                        Lỗi khi lấy vị trí
                      </p>
                      <div className="text-sm text-red-800 space-y-1">
                        <p>
                          <strong>Error Code:</strong> {error.code}
                        </p>
                        <p>
                          <strong>Message:</strong> {error.message}
                        </p>
                      </div>
                      {error.code === 1 && (
                        <Button
                          onClick={() => setShowGuide(true)}
                          size="sm"
                          variant="outline"
                          className="mt-2 border-red-300 bg-white hover:bg-red-100 text-red-900"
                        >
                          <HelpCircle className="h-3 w-3 mr-2" />
                          Xem hướng dẫn bật quyền
                        </Button>
                      )}
                    </div>
                  </div>
                </CardContent>
              </Card>
            )}
          </div>

          {/* Info */}
          <Card className="border-blue-200 bg-blue-50">
            <CardContent className="pt-6">
              <div className="text-sm text-blue-900 space-y-2">
                <p className="font-semibold">Hướng dẫn test:</p>
                <ol className="list-decimal list-inside space-y-1 ml-2">
                  <li>Nhấn "Lấy vị trí của tôi" để test flow bình thường</li>
                  <li>Từ chối quyền khi trình duyệt hỏi để test error flow</li>
                  <li>Nhấn "Xem hướng dẫn" để xem modal hướng dẫn</li>
                  <li>Sau khi bật quyền, nhấn "Thử lại" trong modal</li>
                </ol>
                <p className="mt-3 text-xs text-blue-700">
                  <strong>Lưu ý:</strong> Component này chỉ dùng để test, không deploy lên production.
                </p>
              </div>
            </CardContent>
          </Card>
        </CardContent>
      </Card>

      {/* Permission Guide Modal */}
      <LocationPermissionGuide
        isOpen={showGuide}
        onClose={() => setShowGuide(false)}
        onRetry={getLocation}
      />
    </div>
  );
};

export default LocationPermissionDemo;
</file>

<file path="src/components/common/LocationPermissionGuide.jsx">
import React from 'react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { 
  MapPin, 
  Chrome, 
  Globe, 
  Settings, 
  Lock,
  CheckCircle2,
  AlertCircle,
  ExternalLink,
  Navigation
} from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * LocationPermissionGuide - Modal hướng dẫn user bật quyền vị trí
 * Hiển thị hướng dẫn chi tiết cho từng trình duyệt phổ biến
 */
const LocationPermissionGuide = ({ isOpen, onClose, onRetry }) => {
  // Detect browser
  const getBrowserInfo = () => {
    const userAgent = navigator.userAgent;
    
    if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
      return { name: 'Chrome', icon: Chrome };
    } else if (userAgent.includes('Firefox')) {
      return { name: 'Firefox', icon: Globe };
    } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
      return { name: 'Safari', icon: Globe };
    } else if (userAgent.includes('Edg')) {
      return { name: 'Edge', icon: Globe };
    }
    return { name: 'Browser', icon: Globe };
  };

  const browser = getBrowserInfo();
  const BrowserIcon = browser.icon;

  // Browser-specific instructions
  const getInstructions = () => {
    switch (browser.name) {
      case 'Chrome':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 hoặc thông tin ⓘ bên trái thanh địa chỉ',
            'Tìm mục "Vị trí" (Location) trong danh sách quyền',
            'Chọn "Cho phép" (Allow) từ menu thả xuống',
            'Tải lại trang và thử lại'
          ],
          alternative: [
            'Vào Chrome Settings (chrome://settings/content/location)',
            'Tìm website này trong danh sách "Đã chặn"',
            'Nhấp vào biểu tượng thùng rác để xóa',
            'Quay lại trang và thử lại'
          ]
        };
      
      case 'Firefox':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 bên trái thanh địa chỉ',
            'Chọn "Connection secure" > "More information"',
            'Vào tab "Permissions"',
            'Bỏ chọn "Use default" cho "Access Your Location"',
            'Chọn "Allow" và đóng cửa sổ',
            'Tải lại trang và thử lại'
          ],
          alternative: [
            'Vào Firefox Settings > Privacy & Security',
            'Cuộn xuống phần "Permissions" > "Location"',
            'Nhấp "Settings..." và tìm website này',
            'Thay đổi trạng thái thành "Allow"'
          ]
        };
      
      case 'Safari':
        return {
          steps: [
            'Mở Safari > Settings (hoặc Preferences)',
            'Chọn tab "Websites"',
            'Chọn "Location" từ sidebar bên trái',
            'Tìm website này trong danh sách',
            'Chọn "Allow" từ menu thả xuống',
            'Đóng Settings và tải lại trang'
          ],
          alternative: [
            'Trên macOS: System Settings > Privacy & Security > Location Services',
            'Đảm bảo Safari được bật',
            'Quay lại Safari và thử lại'
          ]
        };
      
      case 'Edge':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 bên trái thanh địa chỉ',
            'Chọn "Permissions for this site"',
            'Tìm "Location" và chọn "Allow"',
            'Tải lại trang và thử lại'
          ],
          alternative: [
            'Vào Edge Settings (edge://settings/content/location)',
            'Kiểm tra website này trong danh sách "Block"',
            'Di chuyển sang danh sách "Allow"'
          ]
        };
      
      default:
        return {
          steps: [
            'Tìm biểu tượng khóa 🔒 hoặc cài đặt trang web trên thanh địa chỉ',
            'Tìm cài đặt quyền "Vị trí" (Location)',
            'Thay đổi thành "Cho phép" (Allow)',
            'Tải lại trang và thử lại'
          ],
          alternative: []
        };
    }
  };

  const instructions = getInstructions();

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <div className="flex items-center gap-3 mb-2">
            <div className="p-2 rounded-lg bg-primary/10">
              <MapPin className="h-6 w-6 text-primary" />
            </div>
            <DialogTitle className="text-xl">
              Cách bật quyền truy cập vị trí
            </DialogTitle>
          </div>
          <DialogDescription>
            Để sử dụng tính năng lọc công việc theo khoảng cách, bạn cần cho phép 
            website truy cập vị trí của bạn.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-6 mt-4">
          {/* Browser Detection */}
          <Alert>
            <BrowserIcon className="h-4 w-4" />
            <AlertDescription>
              Chúng tôi phát hiện bạn đang dùng <strong>{browser.name}</strong>. 
              Dưới đây là hướng dẫn chi tiết.
            </AlertDescription>
          </Alert>

          {/* Main Instructions */}
          <div className="space-y-3">
            <div className="flex items-center gap-2 text-sm font-semibold">
              <Settings className="h-4 w-4 text-primary" />
              <span>Cách 1: Cài đặt nhanh từ thanh địa chỉ</span>
            </div>
            
            <ol className="space-y-3 ml-6">
              {instructions.steps.map((step, index) => (
                <li key={index} className="flex gap-3 text-sm">
                  <span className="flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full bg-primary/10 text-primary font-semibold text-xs">
                    {index + 1}
                  </span>
                  <span className="pt-0.5">{step}</span>
                </li>
              ))}
            </ol>
          </div>

          {/* Alternative Method */}
          {instructions.alternative.length > 0 && (
            <div className="space-y-3">
              <div className="flex items-center gap-2 text-sm font-semibold">
                <Lock className="h-4 w-4 text-primary" />
                <span>Cách 2: Từ cài đặt trình duyệt</span>
              </div>
              
              <ol className="space-y-3 ml-6">
                {instructions.alternative.map((step, index) => (
                  <li key={index} className="flex gap-3 text-sm">
                    <span className="flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full bg-primary/10 text-primary font-semibold text-xs">
                      {index + 1}
                    </span>
                    <span className="pt-0.5">{step}</span>
                  </li>
                ))}
              </ol>
            </div>
          )}

          {/* Important Notes */}
          <Alert variant="default" className="border-amber-200 bg-amber-50">
            <AlertCircle className="h-4 w-4 text-amber-600" />
            <AlertDescription className="text-amber-900">
              <strong>Lưu ý quan trọng:</strong>
              <ul className="mt-2 space-y-1 text-sm list-disc list-inside">
                <li>Vị trí của bạn chỉ được sử dụng để tìm công việc gần bạn</li>
                <li>Chúng tôi không lưu trữ vị trí của bạn trên server</li>
                <li>Bạn có thể tắt quyền này bất cứ lúc nào</li>
                <li>Nếu dùng VPN, vị trí có thể không chính xác</li>
              </ul>
            </AlertDescription>
          </Alert>

          {/* Success Tips */}
          <div className="p-4 rounded-lg bg-green-50 border border-green-200">
            <div className="flex items-start gap-3">
              <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
              <div className="space-y-2">
                <p className="text-sm font-semibold text-green-900">
                  Sau khi bật quyền thành công:
                </p>
                <ul className="text-sm text-green-800 space-y-1 list-disc list-inside">
                  <li>Nhấn nút "Thử lại" bên dưới</li>
                  <li>Hoặc tải lại trang và bật lại bộ lọc khoảng cách</li>
                  <li>Trình duyệt sẽ nhớ lựa chọn của bạn cho lần sau</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Troubleshooting */}
          <details className="group">
            <summary className="cursor-pointer text-sm font-semibold flex items-center gap-2 hover:text-primary transition-colors">
              <AlertCircle className="h-4 w-4" />
              <span>Vẫn không được? Xem thêm cách khắc phục</span>
            </summary>
            <div className="mt-3 ml-6 space-y-2 text-sm text-muted-foreground">
              <p>• <strong>Kiểm tra cài đặt hệ thống:</strong> Đảm bảo Location Services được bật trong cài đặt máy tính/điện thoại</p>
              <p>• <strong>Thử chế độ ẩn danh:</strong> Mở trang trong cửa sổ ẩn danh để kiểm tra xung đột extension</p>
              <p>• <strong>Xóa cache:</strong> Xóa cache và cookies của website rồi thử lại</p>
              <p>• <strong>Cập nhật trình duyệt:</strong> Đảm bảo bạn dùng phiên bản mới nhất</p>
              <p>• <strong>HTTPS:</strong> Tính năng vị trí chỉ hoạt động trên kết nối bảo mật (HTTPS)</p>
            </div>
          </details>

          {/* External Resources */}
          <div className="pt-4 border-t">
            <p className="text-xs text-muted-foreground mb-2">
              Tài liệu chính thức từ nhà phát triển:
            </p>
            <div className="flex flex-wrap gap-2">
              {browser.name === 'Chrome' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.google.com/chrome/answer/142065', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Chrome Help
                </Button>
              )}
              {browser.name === 'Firefox' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.mozilla.org/kb/permissions-request-access-camera-microphone-location', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Firefox Support
                </Button>
              )}
              {browser.name === 'Safari' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.apple.com/guide/safari/websites-ibrwe2159f50/mac', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Safari Guide
                </Button>
              )}
            </div>
          </div>
        </div>

        {/* Action Buttons */}
        <div className="flex gap-3 mt-6 pt-4 border-t">
          <Button
            onClick={onClose}
            variant="outline"
            className="flex-1"
          >
            Đóng
          </Button>
          <Button
            onClick={() => {
              onClose();
              onRetry();
            }}
            className="flex-1 btn-gradient"
          >
            <Navigation className="h-4 w-4 mr-2" />
            Thử lại
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
};

export default LocationPermissionGuide;
</file>

<file path="src/components/common/MicrophonePermissionAlert.jsx">
import React from 'react';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { AlertCircle, ExternalLink } from 'lucide-react';

/**
 * MicrophonePermissionAlert - Inline alert hiển thị khi quyền microphone bị từ chối
 * Component nhỏ gọn để nhúng trực tiếp trong UI
 */
const MicrophonePermissionAlert = ({ onShowGuide }) => {
  return (
    <Alert variant="destructive" className="border-red-200 bg-red-50">
      <AlertCircle className="h-4 w-4 text-red-600" />
      <AlertDescription className="text-red-900">
        <div className="space-y-2">
          <p className="text-sm font-semibold">
            Quyền truy cập microphone bị từ chối
          </p>
          <p className="text-xs">
            Để sử dụng tính năng tìm kiếm bằng giọng nói, bạn cần cho phép website 
            truy cập microphone của bạn trong cài đặt trình duyệt.
          </p>
          <Button
            onClick={onShowGuide}
            variant="outline"
            size="sm"
            className="w-full mt-2 border-red-300 bg-white hover:bg-red-100 text-red-900"
          >
            <ExternalLink className="h-3 w-3 mr-2" />
            Xem hướng dẫn chi tiết
          </Button>
        </div>
      </AlertDescription>
    </Alert>
  );
};

export default MicrophonePermissionAlert;
</file>

<file path="src/components/common/MicrophonePermissionGuide.jsx">
import React from 'react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { 
  Mic,
  Chrome, 
  Globe, 
  Settings, 
  Lock,
  CheckCircle2,
  AlertCircle,
  ExternalLink,
  Volume2
} from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * MicrophonePermissionGuide - Modal hướng dẫn user bật quyền microphone
 * Hiển thị hướng dẫn chi tiết cho từng trình duyệt phổ biến
 */
const MicrophonePermissionGuide = ({ isOpen, onClose, onRetry }) => {
  // Detect browser
  const getBrowserInfo = () => {
    const userAgent = navigator.userAgent;
    
    if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
      return { name: 'Chrome', icon: Chrome };
    } else if (userAgent.includes('Firefox')) {
      return { name: 'Firefox', icon: Globe };
    } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
      return { name: 'Safari', icon: Globe };
    } else if (userAgent.includes('Edg')) {
      return { name: 'Edge', icon: Globe };
    }
    return { name: 'Browser', icon: Globe };
  };

  const browser = getBrowserInfo();
  const BrowserIcon = browser.icon;

  // Browser-specific instructions
  const getInstructions = () => {
    switch (browser.name) {
      case 'Chrome':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 hoặc camera 🎥 bên trái thanh địa chỉ',
            'Tìm mục "Microphone" trong danh sách quyền',
            'Chọn "Cho phép" (Allow) từ menu thả xuống',
            'Tải lại trang và thử lại'
          ],
          alternative: [
            'Vào Chrome Settings (chrome://settings/content/microphone)',
            'Tìm website này trong danh sách "Đã chặn"',
            'Nhấp vào biểu tượng thùng rác để xóa',
            'Quay lại trang và thử lại'
          ]
        };
      
      case 'Firefox':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 bên trái thanh địa chỉ',
            'Chọn "Connection secure" > "More information"',
            'Vào tab "Permissions"',
            'Tìm "Use the Microphone"',
            'Bỏ chọn "Use default" và chọn "Allow"',
            'Đóng cửa sổ và tải lại trang'
          ],
          alternative: [
            'Vào Firefox Settings > Privacy & Security',
            'Cuộn xuống phần "Permissions" > "Microphone"',
            'Nhấp "Settings..." và tìm website này',
            'Thay đổi trạng thái thành "Allow"'
          ]
        };
      
      case 'Safari':
        return {
          steps: [
            'Mở Safari > Settings (hoặc Preferences)',
            'Chọn tab "Websites"',
            'Chọn "Microphone" từ sidebar bên trái',
            'Tìm website này trong danh sách',
            'Chọn "Allow" từ menu thả xuống',
            'Đóng Settings và tải lại trang'
          ],
          alternative: [
            'Trên macOS: System Settings > Privacy & Security > Microphone',
            'Đảm bảo Safari được bật',
            'Quay lại Safari và thử lại'
          ]
        };
      
      case 'Edge':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 bên trái thanh địa chỉ',
            'Chọn "Permissions for this site"',
            'Tìm "Microphone" và chọn "Allow"',
            'Tải lại trang và thử lại'
          ],
          alternative: [
            'Vào Edge Settings (edge://settings/content/microphone)',
            'Kiểm tra website này trong danh sách "Block"',
            'Di chuyển sang danh sách "Allow"'
          ]
        };
      
      default:
        return {
          steps: [
            'Tìm biểu tượng khóa 🔒 hoặc cài đặt trang web trên thanh địa chỉ',
            'Tìm cài đặt quyền "Microphone"',
            'Thay đổi thành "Cho phép" (Allow)',
            'Tải lại trang và thử lại'
          ],
          alternative: []
        };
    }
  };

  const instructions = getInstructions();

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <div className="flex items-center gap-3 mb-2">
            <div className="p-2 rounded-lg bg-red-500/10">
              <Mic className="h-6 w-6 text-red-500" />
            </div>
            <DialogTitle className="text-xl">
              Cách bật quyền truy cập Microphone
            </DialogTitle>
          </div>
          <DialogDescription>
            Để sử dụng tính năng tìm kiếm bằng giọng nói, bạn cần cho phép 
            website truy cập microphone của bạn.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-6 mt-4">
          {/* Browser Detection */}
          <Alert>
            <BrowserIcon className="h-4 w-4" />
            <AlertDescription>
              Chúng tôi phát hiện bạn đang dùng <strong>{browser.name}</strong>. 
              Dưới đây là hướng dẫn chi tiết.
            </AlertDescription>
          </Alert>

          {/* Main Instructions */}
          <div className="space-y-3">
            <div className="flex items-center gap-2 text-sm font-semibold">
              <Settings className="h-4 w-4 text-red-500" />
              <span>Cách 1: Cài đặt nhanh từ thanh địa chỉ</span>
            </div>
            
            <ol className="space-y-3 ml-6">
              {instructions.steps.map((step, index) => (
                <li key={index} className="flex gap-3 text-sm">
                  <span className="flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full bg-red-500/10 text-red-500 font-semibold text-xs">
                    {index + 1}
                  </span>
                  <span className="pt-0.5">{step}</span>
                </li>
              ))}
            </ol>
          </div>

          {/* Alternative Method */}
          {instructions.alternative.length > 0 && (
            <div className="space-y-3">
              <div className="flex items-center gap-2 text-sm font-semibold">
                <Lock className="h-4 w-4 text-red-500" />
                <span>Cách 2: Từ cài đặt trình duyệt</span>
              </div>
              
              <ol className="space-y-3 ml-6">
                {instructions.alternative.map((step, index) => (
                  <li key={index} className="flex gap-3 text-sm">
                    <span className="flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full bg-red-500/10 text-red-500 font-semibold text-xs">
                      {index + 1}
                    </span>
                    <span className="pt-0.5">{step}</span>
                  </li>
                ))}
              </ol>
            </div>
          )}

          {/* Important Notes */}
          <Alert variant="default" className="border-amber-200 bg-amber-50">
            <AlertCircle className="h-4 w-4 text-amber-600" />
            <AlertDescription className="text-amber-900">
              <strong>Lưu ý quan trọng:</strong>
              <ul className="mt-2 space-y-1 text-sm list-disc list-inside">
                <li>Microphone chỉ được sử dụng khi bạn nhấn nút tìm kiếm giọng nói</li>
                <li>Chúng tôi không ghi âm hoặc lưu trữ giọng nói của bạn</li>
                <li>Âm thanh chỉ được xử lý để chuyển thành văn bản tìm kiếm</li>
                <li>Bạn có thể tắt quyền này bất cứ lúc nào</li>
                <li>Đảm bảo microphone của bạn đang hoạt động tốt</li>
              </ul>
            </AlertDescription>
          </Alert>

          {/* Success Tips */}
          <div className="p-4 rounded-lg bg-green-50 border border-green-200">
            <div className="flex items-start gap-3">
              <CheckCircle2 className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
              <div className="space-y-2">
                <p className="text-sm font-semibold text-green-900">
                  Sau khi bật quyền thành công:
                </p>
                <ul className="text-sm text-green-800 space-y-1 list-disc list-inside">
                  <li>Nhấn nút "Thử lại" bên dưới</li>
                  <li>Hoặc tải lại trang và nhấn nút microphone 🎤</li>
                  <li>Nói rõ ràng từ khóa bạn muốn tìm kiếm</li>
                  <li>Trình duyệt sẽ nhớ lựa chọn của bạn cho lần sau</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Test Microphone */}
          <div className="p-4 rounded-lg bg-blue-50 border border-blue-200">
            <div className="flex items-start gap-3">
              <Volume2 className="h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5" />
              <div className="space-y-2">
                <p className="text-sm font-semibold text-blue-900">
                  Kiểm tra microphone:
                </p>
                <ul className="text-sm text-blue-800 space-y-1 list-disc list-inside">
                  <li>Đảm bảo microphone được kết nối và bật</li>
                  <li>Kiểm tra âm lượng microphone trong cài đặt hệ thống</li>
                  <li>Thử nói "test" để kiểm tra microphone hoạt động</li>
                  <li>Nếu dùng tai nghe, đảm bảo microphone không bị tắt tiếng</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Troubleshooting */}
          <details className="group">
            <summary className="cursor-pointer text-sm font-semibold flex items-center gap-2 hover:text-red-500 transition-colors">
              <AlertCircle className="h-4 w-4" />
              <span>Vẫn không được? Xem thêm cách khắc phục</span>
            </summary>
            <div className="mt-3 ml-6 space-y-2 text-sm text-muted-foreground">
              <p>• <strong>Kiểm tra cài đặt hệ thống:</strong> Đảm bảo quyền microphone được bật cho trình duyệt trong cài đặt máy tính/điện thoại</p>
              <p>• <strong>Thử chế độ ẩn danh:</strong> Mở trang trong cửa sổ ẩn danh để kiểm tra xung đột extension</p>
              <p>• <strong>Xóa cache:</strong> Xóa cache và cookies của website rồi thử lại</p>
              <p>• <strong>Cập nhật trình duyệt:</strong> Đảm bảo bạn dùng phiên bản mới nhất</p>
              <p>• <strong>HTTPS:</strong> Tính năng microphone chỉ hoạt động trên kết nối bảo mật (HTTPS)</p>
              <p>• <strong>Kiểm tra thiết bị:</strong> Thử microphone với ứng dụng khác để đảm bảo nó hoạt động</p>
              <p>• <strong>Driver:</strong> Cập nhật driver âm thanh của máy tính</p>
            </div>
          </details>

          {/* External Resources */}
          <div className="pt-4 border-t">
            <p className="text-xs text-muted-foreground mb-2">
              Tài liệu chính thức từ nhà phát triển:
            </p>
            <div className="flex flex-wrap gap-2">
              {browser.name === 'Chrome' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.google.com/chrome/answer/2693767', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Chrome Help
                </Button>
              )}
              {browser.name === 'Firefox' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.mozilla.org/kb/permissions-request-access-camera-microphone-location', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Firefox Support
                </Button>
              )}
              {browser.name === 'Safari' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.apple.com/guide/safari/websites-ibrwe2159f50/mac', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Safari Guide
                </Button>
              )}
            </div>
          </div>
        </div>

        {/* Action Buttons */}
        <div className="flex gap-3 mt-6 pt-4 border-t">
          <Button
            onClick={onClose}
            variant="outline"
            className="flex-1"
          >
            Đóng
          </Button>
          <Button
            onClick={() => {
              onClose();
              onRetry();
            }}
            className="flex-1 bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700 text-white"
          >
            <Mic className="h-4 w-4 mr-2" />
            Thử lại
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
};

export default MicrophonePermissionGuide;
</file>

<file path="src/components/common/NotificationPermissionAlert.jsx">
import React from 'react';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { AlertCircle, ExternalLink } from 'lucide-react';

/**
 * NotificationPermissionAlert - Inline alert hiển thị khi quyền thông báo bị từ chối
 * Component nhỏ gọn để nhúng trực tiếp trong UI
 */
const NotificationPermissionAlert = ({ onShowGuide }) => {
  return (
    <Alert variant="destructive" className="border-blue-200 bg-blue-50">
      <AlertCircle className="h-4 w-4 text-blue-600" />
      <AlertDescription className="text-blue-900">
        <div className="space-y-2">
          <p className="text-sm font-semibold">
            Quyền thông báo bị từ chối
          </p>
          <p className="text-xs">
            Để nhận thông báo về công việc mới, tin nhắn và cập nhật quan trọng, 
            bạn cần cho phép website gửi thông báo trong cài đặt trình duyệt.
          </p>
          <Button
            onClick={onShowGuide}
            variant="outline"
            size="sm"
            className="w-full mt-2 border-blue-300 bg-white hover:bg-blue-100 text-blue-900"
          >
            <ExternalLink className="h-3 w-3 mr-2" />
            Xem hướng dẫn chi tiết
          </Button>
        </div>
      </AlertDescription>
    </Alert>
  );
};

export default NotificationPermissionAlert;
</file>

<file path="src/components/common/NotificationPermissionGuide.jsx">
import React from 'react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { 
  Bell,
  Chrome, 
  Globe, 
  Settings, 
  Lock,
  CheckCircle2,
  AlertCircle,
  ExternalLink,
  BellRing
} from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * NotificationPermissionGuide - Modal hướng dẫn user bật quyền thông báo đẩy
 * Hiển thị hướng dẫn chi tiết cho từng trình duyệt phổ biến
 */
const NotificationPermissionGuide = ({ isOpen, onClose, onRetry }) => {
  // Detect browser
  const getBrowserInfo = () => {
    const userAgent = navigator.userAgent;
    
    if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
      return { name: 'Chrome', icon: Chrome };
    } else if (userAgent.includes('Firefox')) {
      return { name: 'Firefox', icon: Globe };
    } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
      return { name: 'Safari', icon: Globe };
    } else if (userAgent.includes('Edg')) {
      return { name: 'Edge', icon: Globe };
    }
    return { name: 'Browser', icon: Globe };
  };

  const browser = getBrowserInfo();
  const BrowserIcon = browser.icon;

  // Browser-specific instructions
  const getInstructions = () => {
    switch (browser.name) {
      case 'Chrome':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 hoặc thông tin ⓘ bên trái thanh địa chỉ',
            'Tìm mục "Notifications" trong danh sách quyền',
            'Chọn "Cho phép" (Allow) từ menu thả xuống',
            'Tải lại trang và thử lại'
          ],
          alternative: [
            'Vào Chrome Settings (chrome://settings/content/notifications)',
            'Tìm website này trong danh sách "Đã chặn"',
            'Nhấp vào biểu tượng thùng rác để xóa',
            'Hoặc thêm vào danh sách "Cho phép"',
            'Quay lại trang và thử lại'
          ]
        };
      
      case 'Firefox':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 bên trái thanh địa chỉ',
            'Chọn "Connection secure" > "More information"',
            'Vào tab "Permissions"',
            'Tìm "Receive Notifications"',
            'Bỏ chọn "Use default" và chọn "Allow"',
            'Đóng cửa sổ và tải lại trang'
          ],
          alternative: [
            'Vào Firefox Settings > Privacy & Security',
            'Cuộn xuống phần "Permissions" > "Notifications"',
            'Nhấp "Settings..." và tìm website này',
            'Thay đổi trạng thái thành "Allow"'
          ]
        };
      
      case 'Safari':
        return {
          steps: [
            'Mở Safari > Settings (hoặc Preferences)',
            'Chọn tab "Websites"',
            'Chọn "Notifications" từ sidebar bên trái',
            'Tìm website này trong danh sách',
            'Chọn "Allow" từ menu thả xuống',
            'Đóng Settings và tải lại trang'
          ],
          alternative: [
            'Trên macOS: System Settings > Notifications',
            'Tìm Safari trong danh sách',
            'Đảm bảo "Allow Notifications" được bật',
            'Quay lại Safari và thử lại'
          ]
        };
      
      case 'Edge':
        return {
          steps: [
            'Nhấp vào biểu tượng khóa 🔒 bên trái thanh địa chỉ',
            'Chọn "Permissions for this site"',
            'Tìm "Notifications" và chọn "Allow"',
            'Tải lại trang và thử lại'
          ],
          alternative: [
            'Vào Edge Settings (edge://settings/content/notifications)',
            'Kiểm tra website này trong danh sách "Block"',
            'Di chuyển sang danh sách "Allow"'
          ]
        };
      
      default:
        return {
          steps: [
            'Tìm biểu tượng khóa 🔒 hoặc cài đặt trang web trên thanh địa chỉ',
            'Tìm cài đặt quyền "Notifications" hoặc "Thông báo"',
            'Thay đổi thành "Cho phép" (Allow)',
            'Tải lại trang và thử lại'
          ],
          alternative: []
        };
    }
  };

  const instructions = getInstructions();

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <div className="flex items-center gap-3 mb-2">
            <div className="p-2 rounded-lg bg-blue-500/10">
              <Bell className="h-6 w-6 text-blue-500" />
            </div>
            <DialogTitle className="text-xl">
              Cách bật thông báo đẩy
            </DialogTitle>
          </div>
          <DialogDescription>
            Để nhận thông báo về công việc mới, tin nhắn và cập nhật quan trọng, 
            bạn cần cho phép website gửi thông báo đến trình duyệt của bạn.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-6 mt-4">
          {/* Browser Detection */}
          <Alert>
            <BrowserIcon className="h-4 w-4" />
            <AlertDescription>
              Chúng tôi phát hiện bạn đang dùng <strong>{browser.name}</strong>. 
              Dưới đây là hướng dẫn chi tiết.
            </AlertDescription>
          </Alert>

          {/* Main Instructions */}
          <div className="space-y-3">
            <div className="flex items-center gap-2 text-sm font-semibold">
              <Settings className="h-4 w-4 text-blue-500" />
              <span>Cách 1: Cài đặt nhanh từ thanh địa chỉ</span>
            </div>
            
            <ol className="space-y-3 ml-6">
              {instructions.steps.map((step, index) => (
                <li key={index} className="flex gap-3 text-sm">
                  <span className="flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full bg-blue-500/10 text-blue-500 font-semibold text-xs">
                    {index + 1}
                  </span>
                  <span className="pt-0.5">{step}</span>
                </li>
              ))}
            </ol>
          </div>

          {/* Alternative Method */}
          {instructions.alternative.length > 0 && (
            <div className="space-y-3">
              <div className="flex items-center gap-2 text-sm font-semibold">
                <Lock className="h-4 w-4 text-blue-500" />
                <span>Cách 2: Từ cài đặt trình duyệt</span>
              </div>
              
              <ol className="space-y-3 ml-6">
                {instructions.alternative.map((step, index) => (
                  <li key={index} className="flex gap-3 text-sm">
                    <span className="flex-shrink-0 flex items-center justify-center w-6 h-6 rounded-full bg-blue-500/10 text-blue-500 font-semibold text-xs">
                      {index + 1}
                    </span>
                    <span className="pt-0.5">{step}</span>
                  </li>
                ))}
              </ol>
            </div>
          )}

          {/* Important Notes */}
          <Alert variant="default" className="border-amber-200 bg-amber-50">
            <AlertCircle className="h-4 w-4 text-amber-600" />
            <AlertDescription className="text-amber-900">
              <strong>Lưu ý quan trọng:</strong>
              <ul className="mt-2 space-y-1 text-sm list-disc list-inside">
                <li>Thông báo chỉ được gửi cho các sự kiện quan trọng</li>
                <li>Bạn có thể tắt thông báo bất cứ lúc nào</li>
                <li>Chúng tôi không spam thông báo không cần thiết</li>
                <li>Thông báo giúp bạn không bỏ lỡ cơ hội việc làm</li>
                <li>Bạn có thể tùy chỉnh loại thông báo muốn nhận</li>
              </ul>
            </AlertDescription>
          </Alert>

          {/* Benefits */}
          <div className="p-4 rounded-lg bg-green-50 border border-green-200">
            <div className="flex items-start gap-3">
              <BellRing className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
              <div className="space-y-2">
                <p className="text-sm font-semibold text-green-900">
                  Lợi ích khi bật thông báo:
                </p>
                <ul className="text-sm text-green-800 space-y-1 list-disc list-inside">
                  <li>Nhận thông báo ngay khi có công việc phù hợp</li>
                  <li>Cập nhật trạng thái ứng tuyển real-time</li>
                  <li>Không bỏ lỡ tin nhắn từ nhà tuyển dụng</li>
                  <li>Nhận nhắc nhở về lịch phỏng vấn</li>
                  <li>Cập nhật các tính năng mới của hệ thống</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Success Tips */}
          <div className="p-4 rounded-lg bg-blue-50 border border-blue-200">
            <div className="flex items-start gap-3">
              <CheckCircle2 className="h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5" />
              <div className="space-y-2">
                <p className="text-sm font-semibold text-blue-900">
                  Sau khi bật thông báo thành công:
                </p>
                <ul className="text-sm text-blue-800 space-y-1 list-disc list-inside">
                  <li>Nhấn nút "Thử lại" bên dưới</li>
                  <li>Hoặc tải lại trang và nhấn nút "Bật thông báo"</li>
                  <li>Bạn sẽ nhận được thông báo test để xác nhận</li>
                  <li>Trình duyệt sẽ nhớ lựa chọn của bạn cho lần sau</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Troubleshooting */}
          <details className="group">
            <summary className="cursor-pointer text-sm font-semibold flex items-center gap-2 hover:text-blue-500 transition-colors">
              <AlertCircle className="h-4 w-4" />
              <span>Vẫn không được? Xem thêm cách khắc phục</span>
            </summary>
            <div className="mt-3 ml-6 space-y-2 text-sm text-muted-foreground">
              <p>• <strong>Kiểm tra cài đặt hệ thống:</strong> Đảm bảo thông báo được bật cho trình duyệt trong cài đặt máy tính/điện thoại</p>
              <p>• <strong>Windows:</strong> Settings {'->'} System {'->'} Notifications {'->'} Bật cho trình duyệt</p>
              <p>• <strong>macOS:</strong> System Settings {'->'} Notifications {'->'} Bật cho trình duyệt</p>
              <p>• <strong>Thử chế độ ẩn danh:</strong> Mở trang trong cửa sổ ẩn danh để kiểm tra xung đột extension</p>
              <p>• <strong>Xóa cache:</strong> Xóa cache và cookies của website rồi thử lại</p>
              <p>• <strong>Cập nhật trình duyệt:</strong> Đảm bảo bạn dùng phiên bản mới nhất</p>
              <p>• <strong>HTTPS:</strong> Thông báo đẩy chỉ hoạt động trên kết nối bảo mật (HTTPS)</p>
              <p>• <strong>Do Not Disturb:</strong> Tắt chế độ &quot;Do Not Disturb&quot; nếu đang bật</p>
              <p>• <strong>Focus Mode:</strong> Tắt Focus Mode/Focus Assist trên Windows</p>
            </div>
          </details>

          {/* External Resources */}
          <div className="pt-4 border-t">
            <p className="text-xs text-muted-foreground mb-2">
              Tài liệu chính thức từ nhà phát triển:
            </p>
            <div className="flex flex-wrap gap-2">
              {browser.name === 'Chrome' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.google.com/chrome/answer/3220216', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Chrome Help
                </Button>
              )}
              {browser.name === 'Firefox' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.mozilla.org/kb/push-notifications-firefox', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Firefox Support
                </Button>
              )}
              {browser.name === 'Safari' && (
                <Button
                  variant="outline"
                  size="sm"
                  className="text-xs"
                  onClick={() => window.open('https://support.apple.com/guide/safari/customize-website-notifications-sfri40734/mac', '_blank')}
                >
                  <ExternalLink className="h-3 w-3 mr-1" />
                  Safari Guide
                </Button>
              )}
            </div>
          </div>
        </div>

        {/* Action Buttons */}
        <div className="flex gap-3 mt-6 pt-4 border-t">
          <Button
            onClick={onClose}
            variant="outline"
            className="flex-1"
          >
            Đóng
          </Button>
          <Button
            onClick={() => {
              onClose();
              onRetry();
            }}
            className="flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white"
          >
            <Bell className="h-4 w-4 mr-2" />
            Thử lại
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
};

export default NotificationPermissionGuide;
</file>

<file path="src/components/common/Preloader.jsx">
import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

const Preloader = () => {
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    // Simulate loading time
    const timer = setTimeout(() => {
      setIsLoading(false);
    }, 2000);

    return () => clearTimeout(timer);
  }, []);

  return (
    <AnimatePresence mode="wait">
      {isLoading && (
        <motion.div
          initial={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          transition={{ duration: 0.5 }}
          className="fixed inset-0 z-[9999] flex items-center justify-center bg-white dark:bg-gray-900"
        >
          <div className="relative w-24 h-24">
            {/* First Circle - Cyan */}
            <motion.div
              className="absolute w-16 h-16 rounded-full bg-cyan-400"
              animate={{
                x: [0, 20, 0, -20, 0],
                y: [0, -20, 0, 20, 0],
              }}
              transition={{
                duration: 2,
                repeat: Infinity,
                ease: "easeInOut",
              }}
              style={{
                left: '50%',
                top: '50%',
                marginLeft: '-32px',
                marginTop: '-32px',
              }}
            />
            
            {/* Second Circle - Pink */}
            <motion.div
              className="absolute w-16 h-16 rounded-full bg-pink-500"
              animate={{
                x: [0, -20, 0, 20, 0],
                y: [0, 20, 0, -20, 0],
              }}
              transition={{
                duration: 2,
                repeat: Infinity,
                ease: "easeInOut",
              }}
              style={{
                left: '50%',
                top: '50%',
                marginLeft: '-32px',
                marginTop: '-32px',
                mixBlendMode: 'multiply',
              }}
            />
          </div>
          
          {/* Optional: Loading text */}
          <motion.p
            className="absolute bottom-1/3 text-gray-600 dark:text-gray-300 font-medium"
            animate={{ opacity: [0.5, 1, 0.5] }}
            transition={{ duration: 1.5, repeat: Infinity }}
          >
            Loading...
          </motion.p>
        </motion.div>
      )}
    </AnimatePresence>
  );
};

export default Preloader;
</file>

<file path="src/components/common/ProfileCompletion.jsx">
import React, { useMemo } from 'react';
import { motion } from 'framer-motion';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  CheckCircle2,
  Circle,
  Award,
  Sparkles,
  ArrowRight,
  TrendingUp,
  User,
  Briefcase,
  GraduationCap,
  Code,
  FileText
} from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * ProfileCompletion component
 * Gamified profile completion tracker to encourage users to complete their profile
 */
const ProfileCompletion = ({
  profile = {},
  onActionClick,
  className
}) => {
  // Calculate completion percentage and items
  const completionData = useMemo(() => {
    const items = [
      {
        id: 'basic',
        label: 'Thông tin cơ bản',
        description: 'Họ tên, email, số điện thoại',
        completed: !!(profile.fullName && profile.email && profile.phone),
        weight: 15,
        icon: User,
        action: 'editBasicInfo'
      },
      {
        id: 'bio',
        label: 'Giới thiệu bản thân',
        description: 'Viết vài dòng về bạn',
        completed: !!(profile.bio && profile.bio.length >= 50),
        weight: 10,
        icon: FileText,
        action: 'editBio'
      },
      {
        id: 'experience',
        label: 'Kinh nghiệm làm việc',
        description: 'Thêm ít nhất 1 kinh nghiệm',
        completed: !!(profile.experiences && profile.experiences.length > 0),
        weight: 25,
        icon: Briefcase,
        action: 'addExperience'
      },
      {
        id: 'education',
        label: 'Học vấn',
        description: 'Thêm thông tin học vấn',
        completed: !!(profile.educations && profile.educations.length > 0),
        weight: 15,
        icon: GraduationCap,
        action: 'addEducation'
      },
      {
        id: 'skills',
        label: 'Kỹ năng',
        description: 'Thêm ít nhất 3 kỹ năng',
        completed: !!(profile.skills && profile.skills.length >= 3),
        weight: 20,
        icon: Code,
        action: 'addSkills'
      },
      {
        id: 'cv',
        label: 'CV/Resume',
        description: 'Tải lên hoặc tạo CV',
        completed: !!(profile.cvs && profile.cvs.length > 0),
        weight: 15,
        icon: FileText,
        action: 'uploadCV'
      }
    ];

    const completedWeight = items.reduce((sum, item) => 
      sum + (item.completed ? item.weight : 0), 0
    );
    const totalWeight = items.reduce((sum, item) => sum + item.weight, 0);
    const percentage = Math.round((completedWeight / totalWeight) * 100);
    const completedCount = items.filter(item => item.completed).length;

    return {
      items,
      percentage,
      completedCount,
      totalCount: items.length
    };
  }, [profile]);

  // Get completion level
  const getCompletionLevel = (percentage) => {
    if (percentage === 100) return {
      label: 'Hoàn hảo',
      color: 'from-emerald-600 to-green-600',
      bgColor: 'from-emerald-500/20 to-green-500/10',
      borderColor: 'border-emerald-500/30',
      icon: Award
    };
    if (percentage >= 75) return {
      label: 'Tốt',
      color: 'from-blue-600 to-cyan-600',
      bgColor: 'from-blue-500/20 to-cyan-500/10',
      borderColor: 'border-blue-500/30',
      icon: TrendingUp
    };
    if (percentage >= 50) return {
      label: 'Trung bình',
      color: 'from-amber-600 to-orange-600',
      bgColor: 'from-amber-500/20 to-orange-500/10',
      borderColor: 'border-amber-500/30',
      icon: Sparkles
    };
    return {
      label: 'Cơ bản',
      color: 'from-gray-600 to-gray-500',
      bgColor: 'from-gray-500/20 to-gray-500/10',
      borderColor: 'border-gray-500/30',
      icon: Circle
    };
  };

  const level = getCompletionLevel(completionData.percentage);

  // Get motivational message
  const getMotivationalMessage = (percentage) => {
    if (percentage === 100) return '🎉 Hồ sơ của bạn đã hoàn thiện! Các nhà tuyển dụng sẽ dễ dàng tìm thấy bạn.';
    if (percentage >= 75) return '👏 Hồ sơ của bạn khá tốt! Hoàn thiện thêm để tăng cơ hội được nhận.';
    if (percentage >= 50) return '📈 Hồ sơ đang được hoàn thiện. Hãy tiếp tục để nổi bật hơn!';
    return '🚀 Bắt đầu hoàn thiện hồ sơ để tăng 300% cơ hội được chú ý!';
  };

  return (
    <Card className={cn(
      "border-2 border-border/50 shadow-xl shadow-primary/10",
      "bg-card/95 backdrop-blur-sm overflow-hidden relative",
      className
    )}>
      {/* Animated gradient background */}
      <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-transparent opacity-50" />
      <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-primary/5 to-transparent opacity-30 animate-pulse" />
      
      <CardHeader className="relative z-10 pb-3">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <motion.div 
              className={cn(
                "flex items-center justify-center w-12 h-12 rounded-xl",
                `bg-gradient-to-br ${level.bgColor}`,
                `border-2 ${level.borderColor}`
              )}
              animate={{ rotate: [0, 5, -5, 0] }}
              transition={{ duration: 2, repeat: Infinity, repeatDelay: 3 }}
            >
              <level.icon className={cn(
                "h-6 w-6",
                `bg-gradient-to-r ${level.color} bg-clip-text text-transparent`
              )} />
            </motion.div>
            <div>
              <CardTitle className="text-xl font-bold">Hoàn thiện hồ sơ</CardTitle>
              <p className="text-sm text-muted-foreground">
                {completionData.completedCount}/{completionData.totalCount} mục đã hoàn thành
              </p>
            </div>
          </div>
          <Badge className={cn(
            "px-4 py-2 rounded-lg font-bold text-white border-0",
            `bg-gradient-to-r ${level.color}`
          )}>
            {completionData.percentage}%
          </Badge>
        </div>
      </CardHeader>

      <CardContent className="relative z-10 space-y-6">
        {/* Progress Bar */}
        <div className="space-y-2">
          <div className="relative">
            <Progress 
              value={completionData.percentage} 
              className="h-4 bg-gradient-to-r from-gray-200 to-gray-100"
            />
            <motion.div
              className="absolute top-0 left-0 h-full bg-gradient-to-r from-primary via-primary/80 to-primary rounded-full overflow-hidden"
              initial={{ width: 0 }}
              animate={{ width: `${completionData.percentage}%` }}
              transition={{ duration: 1, ease: "easeOut" }}
            >
              <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shimmer" />
            </motion.div>
          </div>
          <p className="text-sm text-muted-foreground text-center">
            {getMotivationalMessage(completionData.percentage)}
          </p>
        </div>

        {/* Completion Items */}
        <div className="space-y-3">
          {completionData.items.map((item, index) => (
            <motion.div
              key={item.id}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.3, delay: index * 0.1 }}
              className={cn(
                "flex items-start gap-3 p-3 rounded-lg transition-all duration-300",
                item.completed 
                  ? "bg-emerald-50/50 border border-emerald-500/20" 
                  : "bg-gray-50/50 border border-border/30 hover:border-primary/30 hover:bg-primary/5"
              )}
            >
              <div className="flex-shrink-0 pt-0.5">
                {item.completed ? (
                  <CheckCircle2 className="h-5 w-5 text-emerald-600" />
                ) : (
                  <Circle className="h-5 w-5 text-muted-foreground" />
                )}
              </div>
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-1">
                  <item.icon className="h-4 w-4 text-primary" />
                  <h4 className={cn(
                    "text-sm font-semibold",
                    item.completed ? "text-foreground" : "text-foreground/80"
                  )}>
                    {item.label}
                  </h4>
                  <Badge variant="secondary" className="text-xs px-2 py-0">
                    +{item.weight}%
                  </Badge>
                </div>
                <p className="text-xs text-muted-foreground mb-2">
                  {item.description}
                </p>
                {!item.completed && onActionClick && (
                  <Button
                    variant="ghost"
                    size="sm"
                    onClick={() => onActionClick(item.action, item)}
                    className={cn(
                      "h-7 px-3 text-xs rounded-lg",
                      "text-primary hover:text-primary-foreground",
                      "hover:bg-primary group"
                    )}
                  >
                    Hoàn thành ngay
                    <ArrowRight className="h-3 w-3 ml-1 transition-transform duration-300 group-hover:translate-x-1" />
                  </Button>
                )}
              </div>
            </motion.div>
          ))}
        </div>

        {/* Benefits Section */}
        {completionData.percentage < 100 && (
          <div className={cn(
            "p-4 rounded-xl",
            `bg-gradient-to-r ${level.bgColor}`,
            `border-2 ${level.borderColor}`
          )}>
            <div className="flex items-start gap-3">
              <Sparkles className="h-5 w-5 text-primary flex-shrink-0 mt-0.5" />
              <div>
                <h4 className="font-semibold text-sm text-foreground mb-1">
                  Lợi ích khi hoàn thiện hồ sơ
                </h4>
                <ul className="text-xs text-muted-foreground space-y-1">
                  <li>✓ Tăng 300% cơ hội được nhà tuyển dụng chú ý</li>
                  <li>✓ Xuất hiện cao hơn trong kết quả tìm kiếm</li>
                  <li>✓ Nhận gợi ý việc làm phù hợp hơn</li>
                  <li>✓ Được ưu tiên trong các chiến dịch tuyển dụng</li>
                </ul>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
};

export default ProfileCompletion;
</file>

<file path="src/components/common/README_LOCATION_PERMISSION.md">
# Location Permission Components

Components hỗ trợ hướng dẫn user bật quyền truy cập vị trí cho tính năng lọc theo khoảng cách.

## Quick Start

### 1. LocationPermissionGuide (Modal)

Modal dialog với hướng dẫn chi tiết cho từng trình duyệt.

```jsx
import LocationPermissionGuide from '@/components/common/LocationPermissionGuide';

function MyComponent() {
  const [showGuide, setShowGuide] = useState(false);

  const handleRetry = () => {
    // Logic để thử lại lấy vị trí
    navigator.geolocation.getCurrentPosition(...);
  };

  return (
    <>
      <button onClick={() => setShowGuide(true)}>
        Xem hướng dẫn
      </button>
      
      <LocationPermissionGuide
        isOpen={showGuide}
        onClose={() => setShowGuide(false)}
        onRetry={handleRetry}
      />
    </>
  );
}
```

### 2. LocationPermissionAlert (Inline Alert)

Alert nhỏ gọn để hiển thị inline khi quyền bị từ chối.

```jsx
import LocationPermissionAlert from '@/components/common/LocationPermissionAlert';

function MyComponent() {
  const [permissionDenied, setPermissionDenied] = useState(false);
  const [showGuide, setShowGuide] = useState(false);

  return (
    <>
      {permissionDenied && (
        <LocationPermissionAlert 
          onShowGuide={() => setShowGuide(true)}
        />
      )}
      
      <LocationPermissionGuide
        isOpen={showGuide}
        onClose={() => setShowGuide(false)}
        onRetry={handleRetry}
      />
    </>
  );
}
```

## Features

### LocationPermissionGuide
- ✅ Tự động phát hiện trình duyệt (Chrome, Firefox, Safari, Edge)
- ✅ Hướng dẫn 2 phương pháp: Nhanh & Chi tiết
- ✅ Troubleshooting tips
- ✅ Link tài liệu chính thức
- ✅ Lưu ý bảo mật & quyền riêng tư
- ✅ Responsive design

### LocationPermissionAlert
- ✅ Thông báo ngắn gọn
- ✅ Nút mở modal hướng dẫn
- ✅ Amber warning theme

## Example: Complete Integration

```jsx
import { useState } from 'react';
import { toast } from 'sonner';
import LocationPermissionGuide from '@/components/common/LocationPermissionGuide';
import LocationPermissionAlert from '@/components/common/LocationPermissionAlert';

function LocationFeature() {
  const [permissionDenied, setPermissionDenied] = useState(false);
  const [showGuide, setShowGuide] = useState(false);
  const [location, setLocation] = useState(null);

  const getLocation = () => {
    if (!navigator.geolocation) {
      toast.error('Trình duyệt không hỗ trợ định vị');
      return;
    }

    setPermissionDenied(false);

    navigator.geolocation.getCurrentPosition(
      (position) => {
        setLocation({
          lat: position.coords.latitude,
          lng: position.coords.longitude
        });
        toast.success('Đã lấy vị trí thành công!');
      },
      (error) => {
        if (error.code === error.PERMISSION_DENIED) {
          setPermissionDenied(true);
          toast.error('Quyền vị trí bị từ chối', {
            action: {
              label: 'Xem hướng dẫn',
              onClick: () => setShowGuide(true)
            }
          });
          // Auto show guide after delay
          setTimeout(() => setShowGuide(true), 1500);
        } else {
          toast.error('Không thể lấy vị trí');
        }
      }
    );
  };

  return (
    <div>
      {/* Permission Denied Alert */}
      {permissionDenied && (
        <LocationPermissionAlert 
          onShowGuide={() => setShowGuide(true)}
        />
      )}

      {/* Get Location Button */}
      <button onClick={getLocation}>
        Lấy vị trí của tôi
      </button>

      {/* Help Button */}
      <button onClick={() => setShowGuide(true)}>
        ? Hướng dẫn
      </button>

      {/* Permission Guide Modal */}
      <LocationPermissionGuide
        isOpen={showGuide}
        onClose={() => setShowGuide(false)}
        onRetry={getLocation}
      />

      {/* Display Location */}
      {location && (
        <div>
          Vị trí: {location.lat}, {location.lng}
        </div>
      )}
    </div>
  );
}
```

## Browser Detection

Component tự động phát hiện trình duyệt và hiển thị hướng dẫn phù hợp:

- **Chrome**: Hướng dẫn cho Chrome/Chromium
- **Firefox**: Hướng dẫn cho Firefox
- **Safari**: Hướng dẫn cho Safari (macOS)
- **Edge**: Hướng dẫn cho Microsoft Edge
- **Other**: Hướng dẫn chung

## Geolocation Error Codes

```javascript
// PERMISSION_DENIED = 1
if (error.code === error.PERMISSION_DENIED) {
  // User từ chối quyền
  setPermissionDenied(true);
  setShowGuide(true);
}

// POSITION_UNAVAILABLE = 2
if (error.code === error.POSITION_UNAVAILABLE) {
  // Không thể xác định vị trí
  toast.error('Vị trí không khả dụng');
}

// TIMEOUT = 3
if (error.code === error.TIMEOUT) {
  // Hết thời gian chờ
  toast.error('Hết thời gian chờ');
}
```

## Best Practices

1. **Auto-show guide**: Tự động mở modal sau 1-2s khi quyền bị từ chối
2. **Toast with action**: Hiển thị toast có nút "Xem hướng dẫn"
3. **Inline alert**: Hiển thị alert trong UI để user biết có vấn đề
4. **Help icon**: Luôn có icon help để user có thể xem hướng dẫn bất cứ lúc nào
5. **Reset state**: Reset `permissionDenied` khi thử lại

## Styling

Components sử dụng:
- **shadcn/ui**: Dialog, Alert, Button
- **Tailwind CSS**: Utility classes
- **Lucide React**: Icons

Có thể customize theme thông qua Tailwind config.

## See Also

- [Full Documentation](../../docs/LOCATION_PERMISSION_GUIDE.md)
- [DistanceFilter Implementation](../../pages/jobs/components/SearchInterface/DistanceFilter.jsx)
</file>

<file path="src/components/common/SalaryVisualization.jsx">
import React from 'react';
import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, Cell } from 'recharts';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { DollarSign, TrendingUp, Award } from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * SalaryVisualization component
 * Visualizes salary range with comparison to market average
 */
const SalaryVisualization = ({
  minSalary,
  maxSalary,
  averageSalary,
  marketMin,
  marketMax,
  className
}) => {
  // Format salary for display (in millions VND)
  const formatSalary = (value) => {
    if (!value) return 'Thỏa thuận';
    const millions = value / 1000000;
    if (millions >= 1000) {
      return `${(millions / 1000).toFixed(1)}B`;
    }
    return `${millions}M`;
  };

  // Calculate salary statistics
  const jobAverage = minSalary && maxSalary ? (minSalary + maxSalary) / 2 : null;
  const marketAverage = averageSalary || (marketMin && marketMax ? (marketMin + marketMax) / 2 : null);
  
  // Competitive level
  const getCompetitiveLevel = () => {
    if (!jobAverage || !marketAverage) return null;
    const ratio = (jobAverage / marketAverage) * 100;
    
    if (ratio >= 120) return { label: 'Rất cao', color: 'from-emerald-600 to-green-600', icon: Award };
    if (ratio >= 105) return { label: 'Cao hơn thị trường', color: 'from-blue-600 to-cyan-600', icon: TrendingUp };
    if (ratio >= 95) return { label: 'Tương đương thị trường', color: 'from-amber-600 to-orange-600', icon: DollarSign };
    return { label: 'Dưới thị trường', color: 'from-gray-600 to-gray-500', icon: DollarSign };
  };

  const competitive = getCompetitiveLevel();

  // Prepare chart data
  const chartData = [
    {
      name: 'Mức lương',
      min: minSalary ? minSalary / 1000000 : 0,
      max: maxSalary ? maxSalary / 1000000 : 0,
      avg: jobAverage ? jobAverage / 1000000 : 0,
      isJob: true
    }
  ];

  if (marketMin && marketMax) {
    chartData.push({
      name: 'Thị trường',
      min: marketMin / 1000000,
      max: marketMax / 1000000,
      avg: marketAverage ? marketAverage / 1000000 : 0,
      isJob: false
    });
  }

  // Custom tooltip
  const CustomTooltip = ({ active, payload }) => {
    if (active && payload && payload.length) {
      const data = payload[0].payload;
      return (
        <div className="bg-card/95 backdrop-blur-sm border-2 border-primary/30 rounded-lg p-3 shadow-xl">
          <p className="font-semibold text-foreground mb-2">{data.name}</p>
          <div className="space-y-1 text-sm">
            <p className="text-muted-foreground">
              Tối thiểu: <span className="font-bold text-foreground">{data.min}M</span>
            </p>
            <p className="text-muted-foreground">
              Trung bình: <span className="font-bold text-primary">{data.avg}M</span>
            </p>
            <p className="text-muted-foreground">
              Tối đa: <span className="font-bold text-foreground">{data.max}M</span>
            </p>
          </div>
        </div>
      );
    }
    return null;
  };

  return (
    <Card className={cn(
      "border-2 border-border/50 shadow-lg shadow-primary/5",
      "bg-card/95 backdrop-blur-sm overflow-hidden relative",
      className
    )}>
      {/* Gradient overlay */}
      <div className="absolute inset-0 bg-gradient-to-br from-emerald-500/5 via-transparent to-transparent opacity-50" />
      
      <CardHeader className="relative z-10">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500/20 to-green-500/10 border-2 border-emerald-500/30">
              <DollarSign className="h-5 w-5 text-emerald-600" />
            </div>
            <CardTitle className="text-xl font-bold bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text text-transparent">
              Phân tích mức lương
            </CardTitle>
          </div>
          {competitive && (
            <Badge className={cn(
              "px-4 py-2 rounded-lg font-semibold text-white border-0",
              `bg-gradient-to-r ${competitive.color}`
            )}>
              <competitive.icon className="h-4 w-4 mr-1" />
              {competitive.label}
            </Badge>
          )}
        </div>
      </CardHeader>

      <CardContent className="relative z-10 space-y-6">
        {/* Salary Range Display */}
        <div className="grid grid-cols-3 gap-4">
          <div className="text-center p-4 rounded-xl bg-gradient-to-br from-blue-500/10 to-cyan-500/5 border border-blue-500/20">
            <p className="text-xs text-muted-foreground mb-1">Tối thiểu</p>
            <p className="text-2xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">
              {formatSalary(minSalary)}
            </p>
          </div>
          <div className="text-center p-4 rounded-xl bg-gradient-to-br from-emerald-500/10 to-green-500/5 border-2 border-emerald-500/30">
            <p className="text-xs text-muted-foreground mb-1">Trung bình</p>
            <p className="text-2xl font-bold bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text text-transparent">
              {formatSalary(jobAverage)}
            </p>
          </div>
          <div className="text-center p-4 rounded-xl bg-gradient-to-br from-purple-500/10 to-violet-500/5 border border-purple-500/20">
            <p className="text-xs text-muted-foreground mb-1">Tối đa</p>
            <p className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-violet-600 bg-clip-text text-transparent">
              {formatSalary(maxSalary)}
            </p>
          </div>
        </div>

        {/* Chart */}
        {chartData.length > 0 && (
          <div className="h-64 w-full">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={chartData} margin={{ top: 20, right: 30, left: 20, bottom: 20 }}>
                <XAxis 
                  dataKey="name" 
                  tick={{ fill: 'hsl(var(--muted-foreground))', fontSize: 12 }}
                  axisLine={{ stroke: 'hsl(var(--border))' }}
                />
                <YAxis 
                  tick={{ fill: 'hsl(var(--muted-foreground))', fontSize: 12 }}
                  axisLine={{ stroke: 'hsl(var(--border))' }}
                  label={{ value: 'Triệu VND', angle: -90, position: 'insideLeft', fill: 'hsl(var(--muted-foreground))' }}
                />
                <Tooltip content={<CustomTooltip />} />
                <Bar dataKey="min" fill="hsl(var(--primary) / 0.3)" radius={[8, 8, 0, 0]} />
                <Bar dataKey="avg" fill="hsl(var(--primary))" radius={[8, 8, 0, 0]} />
                <Bar dataKey="max" fill="hsl(var(--primary) / 0.5)" radius={[8, 8, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
          </div>
        )}

        {/* Salary Range Bar */}
        <div className="space-y-2">
          <div className="flex items-center justify-between text-xs text-muted-foreground">
            <span>0M</span>
            <span>50M</span>
            <span>100M+</span>
          </div>
          <div className="relative h-8 bg-gradient-to-r from-blue-500/20 via-emerald-500/20 to-purple-500/20 rounded-full overflow-hidden border-2 border-primary/30">
            {minSalary && maxSalary && (
              <div
                className="absolute h-full bg-gradient-to-r from-emerald-600 to-green-600 rounded-full transition-all duration-500"
                style={{
                  left: `${Math.min((minSalary / 1000000 / 100) * 100, 95)}%`,
                  width: `${Math.min(((maxSalary - minSalary) / 1000000 / 100) * 100, 95 - ((minSalary / 1000000 / 100) * 100))}%`
                }}
              >
                <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse" />
              </div>
            )}
          </div>
        </div>

        {/* Market Comparison */}
        {marketAverage && jobAverage && (
          <div className="p-4 rounded-xl bg-gradient-to-r from-primary/10 to-primary/5 border border-primary/20">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm font-semibold text-foreground">So với thị trường</p>
                <p className="text-xs text-muted-foreground">Mức lương trung bình ngành</p>
              </div>
              <div className="text-right">
                <p className="text-2xl font-bold text-primary">
                  {((jobAverage / marketAverage - 1) * 100).toFixed(1)}%
                </p>
                <p className="text-xs text-muted-foreground">
                  {jobAverage > marketAverage ? 'Cao hơn' : 'Thấp hơn'}
                </p>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
};

export default SalaryVisualization;
</file>

<file path="src/components/common/ScrollToTop.jsx">
import { useState, useEffect } from 'react';
import { ArrowUp } from 'lucide-react';

const ScrollToTop = () => {
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const toggleVisibility = () => {
      if (window.scrollY > 300) {
        setIsVisible(true);
      } else {
        setIsVisible(false);
      }
    };

    window.addEventListener('scroll', toggleVisibility);
    return () => window.removeEventListener('scroll', toggleVisibility);
  }, []);

  const scrollToTop = () => {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  };

  return (
    <>
      {isVisible && (
        <button
          onClick={scrollToTop}
          className="fixed bottom-8 right-8 z-50 p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          aria-label="Scroll to top"
        >
          <ArrowUp className="w-6 h-6" />
        </button>
      )}
    </>
  );
};

export default ScrollToTop;
</file>

<file path="src/components/common/ScrollToTopOnRouteChange.jsx">
import { useEffect } from 'react';
import { useLocation } from 'react-router-dom';

/**
 * ScrollToTopOnRouteChange Component
 * Automatically scrolls to top of page when route changes
 * 
 * Usage: Place this component inside BrowserRouter in AppRouter
 * 
 * Features:
 * - Scrolls to top on every route change
 * - Uses 'instant' behavior for immediate scroll (no animation)
 * - Handles both main window and any scrollable containers
 */
const ScrollToTopOnRouteChange = () => {
    const { pathname } = useLocation();

    useEffect(() => {
        // Scroll main window to top immediately
        window.scrollTo({
            top: 0,
            left: 0,
            behavior: 'instant', // Use 'instant' for immediate scroll
        });

        // Also scroll any scrollable containers to top
        // This is useful for layouts with nested scroll containers
        const scrollContainers = document.querySelectorAll('[data-scroll-container]');
        scrollContainers.forEach(container => {
            container.scrollTop = 0;
        });

        // Force scroll for some browsers that might cache scroll position
        // Use setTimeout to ensure it runs after React finishes rendering
        setTimeout(() => {
            window.scrollTo(0, 0);
        }, 0);
    }, [pathname]);

    return null; // This component doesn't render anything
};

export default ScrollToTopOnRouteChange;
</file>

<file path="src/components/common/SectionHeader.jsx">
import { Badge } from '@/components/ui/badge';

/**
 * Reusable section header component for consistent styling across sections
 * @param {{
 *   badgeText?: string;
 *   title: string | React.ReactNode;
 *   description?: string;
 *   badgeVariant?: "default" | "secondary" | "destructive" | "outline";
 *   className?: string;
 * }} props
 */
export const SectionHeader = ({ 
  badgeText, 
  title, 
  description, 
  badgeVariant = "outline",
  className = "" 
}) => (
  <div className={`text-center mb-16 ${className}`}>
    {badgeText && (
      <Badge 
        variant={badgeVariant} 
        className="px-4 py-2 text-sm font-medium text-primary border-primary/30 bg-background mb-4"
      >
        {badgeText}
      </Badge>
    )}
    <h2 className="text-3xl md:text-4xl font-bold text-foreground mb-4">
      {title}
    </h2>
    {description && (
      <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
        {description}
      </p>
    )}
  </div>
);
</file>

<file path="src/components/common/SuggestionItem.jsx">
import React from 'react';
import { cn } from '@/lib/utils';

/**
 * Component để hiển thị một suggestion item với text highlighting
 * 
 * @param {Object} props
 * @param {Object} props.suggestion - Suggestion object với title và metadata
 * @param {string} props.query - Query string để highlight
 * @param {boolean} props.isSelected - Có phải là item được chọn không
 * @param {function} props.onClick - Handler khi click item
 * @param {function} props.onMouseEnter - Handler khi hover item
 * @param {number} props.index - Index của item trong list
 */
const SuggestionItem = ({
  suggestion,
  query,
  isSelected = false,
  onClick,
  onMouseEnter,
  index
}) => {
  /**
   * Highlight text matching query với prefix prioritization
   * @param {string} text - Text cần highlight
   * @param {string} query - Query để match
   * @returns {JSX.Element} - JSX với highlighted text
   */
  const highlightText = (text, query) => {
    if (!query || !text) return text;
    
    const normalizedQuery = query.toLowerCase().trim();
    const normalizedText = text.toLowerCase();
    
    // Ưu tiên prefix match trước
    if (normalizedText.startsWith(normalizedQuery)) {
      const match = text.substring(0, query.length);
      const after = text.substring(query.length);
      
      return (
        <>
          <span className="font-semibold text-primary bg-primary/10 px-0.5 rounded">
            {match}
          </span>
          {after}
        </>
      );
    }
    
    // Nếu không phải prefix match, tìm exact substring match
    const index = normalizedText.indexOf(normalizedQuery);
    if (index !== -1) {
      const before = text.substring(0, index);
      const match = text.substring(index, index + query.length);
      const after = text.substring(index + query.length);
      
      return (
        <>
          {before}
          <span className="font-semibold text-primary bg-primary/10 px-0.5 rounded">
            {match}
          </span>
          {after}
        </>
      );
    }
    
    // Fallback: highlight theo từng từ nếu có match partial
    const queryWords = normalizedQuery.split(/\s+/).filter(word => word.length > 0);
    let highlightedText = text;
    
    // Tìm longest matching prefix từ đầu
    let matchEnd = 0;
    for (let i = 0; i < queryWords.length; i++) {
      const partialQuery = queryWords.slice(0, i + 1).join(' ');
      if (normalizedText.startsWith(partialQuery)) {
        matchEnd = partialQuery.length;
      } else {
        break;
      }
    }
    
    if (matchEnd > 0) {
      const match = text.substring(0, matchEnd);
      const after = text.substring(matchEnd);
      
      return (
        <>
          <span className="font-semibold text-primary bg-primary/10 px-0.5 rounded">
            {match}
          </span>
          {after}
        </>
      );
    }
    
    return text;
  };

  const handleClick = () => {
    onClick?.(suggestion);
  };

  const handleMouseEnter = () => {
    onMouseEnter?.(index);
  };

  return (
    <li
      role="option"
      aria-selected={isSelected}
      className={cn(
        "px-4 py-3 cursor-pointer transition-colors duration-150 flex items-center",
        "hover:bg-muted/50 border-l-2 border-transparent",
        isSelected && "bg-primary/5 border-l-primary text-primary font-medium"
      )}
      onClick={handleClick}
      onMouseEnter={handleMouseEnter}
    >
      {/* Search icon */}
      <div className={cn(
        "flex-shrink-0 w-4 h-4 rounded-sm flex items-center justify-center mr-3",
        isSelected ? "text-primary" : "text-muted-foreground"
      )}>
        <svg
          className="w-3.5 h-3.5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          />
        </svg>
      </div>
      
      {/* Suggestion title với highlighting */}
      <div className="flex-1 min-w-0">
        <div className={cn(
          "text-sm leading-5 text-left",
          isSelected ? "text-primary" : "text-foreground"
        )}>
          {highlightText(suggestion.title, query)}
        </div>
      </div>

      {/* Optional: Prefix match indicator */}
      {suggestion.isPrefixMatch && (
        <div className="flex-shrink-0 ml-2">
          <div className="w-2 h-2 bg-primary rounded-full" title="Prefix match" />
        </div>
      )}
    </li>
  );
};

export default SuggestionItem;
</file>

<file path="src/components/common/ThemeToggle.jsx">
import { Moon, Sun } from 'lucide-react';
import { useTheme } from '@/contexts/ThemeContext';
import { Button } from '@/components/ui/button';

const ThemeToggle = ({ variant = 'ghost', size = 'icon', className = '' }) => {
  const { theme, toggleTheme } = useTheme();

  return (
    <Button
      variant={variant}
      size={size}
      onClick={toggleTheme}
      className={className}
      aria-label={theme === 'light' ? 'Chuyển sang chế độ tối' : 'Chuyển sang chế độ sáng'}
    >
      {theme === 'light' ? (
        <Moon className="h-5 w-5" />
      ) : (
        <Sun className="h-5 w-5" />
      )}
    </Button>
  );
};

export default ThemeToggle;
</file>

<file path="src/components/common/ViewHistoryWidget.jsx">
import { useQuery } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Skeleton } from '@/components/ui/skeleton';
import { Eye, ArrowRight, Building } from 'lucide-react';
import { getViewHistory } from '@/services/viewHistoryService';
import { formatDistanceToNow } from 'date-fns';
import { vi } from 'date-fns/locale';

/**
 * Component hiển thị widget lịch sử xem nhỏ gọn
 * Có thể dùng trong Dashboard hoặc Profile sidebar
 */
const ViewHistoryWidget = ({ limit = 5 }) => {
  const navigate = useNavigate();

  const { data, isLoading } = useQuery({
    queryKey: ['viewHistory', 1],
    queryFn: () => getViewHistory({ page: 1, limit }),
  });

  const viewHistory = data?.data || [];

  const formatViewTime = (date) => {
    try {
      return formatDistanceToNow(new Date(date), { 
        addSuffix: true, 
        locale: vi 
      });
    } catch (error) {
      return 'Vừa xong';
    }
  };

  if (isLoading) {
    return (
      <Card>
        <CardHeader>
          <Skeleton className="h-6 w-48" />
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {[...Array(3)].map((_, i) => (
              <Skeleton key={i} className="h-16 w-full" />
            ))}
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Eye className="h-5 w-5" />
            <CardTitle className="text-lg">Đã xem gần đây</CardTitle>
          </div>
          {viewHistory.length > 0 && (
            <Button
              variant="ghost"
              size="sm"
              onClick={() => navigate('/dashboard/view-history')}
              className="text-primary hover:text-primary/80"
            >
              Xem tất cả
              <ArrowRight className="h-4 w-4 ml-1" />
            </Button>
          )}
        </div>
      </CardHeader>
      <CardContent>
        {viewHistory.length === 0 ? (
          <div className="text-center py-8 text-muted-foreground">
            <Eye className="h-12 w-12 mx-auto mb-3 opacity-50" />
            <p className="text-sm">Chưa có lịch sử xem</p>
          </div>
        ) : (
          <div className="space-y-3">
            {viewHistory.map((item) => (
              <div
                key={item._id}
                className="flex gap-3 p-3 rounded-lg hover:bg-accent cursor-pointer transition-colors"
                onClick={() => navigate(`/jobs/${item.job._id}`)}
              >
                <div className="flex-shrink-0">
                  <div className="w-10 h-10 rounded overflow-hidden bg-gray-100 flex items-center justify-center">
                    {item.job.company?.logo ? (
                      <img 
                        src={item.job.company.logo} 
                        alt={item.job.company.name}
                        className="w-full h-full object-cover"
                      />
                    ) : (
                      <Building className="h-5 w-5 text-gray-400" />
                    )}
                  </div>
                </div>
                <div className="flex-1 min-w-0">
                  <h4 className="font-medium text-sm truncate hover:text-primary">
                    {item.job.title}
                  </h4>
                  <p className="text-xs text-muted-foreground truncate">
                    {item.job.company?.name || 'Công ty'}
                  </p>
                  <p className="text-xs text-muted-foreground mt-1">
                    {formatViewTime(item.viewedAt)}
                  </p>
                </div>
              </div>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  );
};

export default ViewHistoryWidget;
</file>

<file path="src/components/common/VoiceSearchButton.jsx">
import React from 'react';
import { Mic, MicOff } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import { isActiveState } from "@soniox/speech-to-text-web";

/**
 * VoiceSearchButton component with professional animated effects
 * @param {object} props
 * @param {string} props.state - Trạng thái từ useSonioxSearch.
 * @param {boolean} props.isSupported - Trình duyệt có hỗ trợ không.
 * @param {Function} props.onClick - Click handler.
 * @param {string} props.className - Additional CSS classes.
 * @param {string} props.size - Button size ('sm', 'default', 'lg').
 */
const VoiceSearchButton = ({
  state = "Idle",
  isSupported = true,
  onClick,
  className,
  size = 'default',
  disabled = false
}) => {
  if (!isSupported) {
    return (
      <Button
        type="button"
        variant="ghost"
        size="icon"
        disabled
        className={cn("h-10 w-10 rounded-full opacity-50 cursor-not-allowed", className)}
        title="Trình duyệt không hỗ trợ tìm kiếm bằng giọng nói"
      >
        <MicOff className="h-5 w-5 text-muted-foreground" />
      </Button>
    );
  }
  
  const isListening = isActiveState(state);
  const isProcessing = state === "FinishingProcessing";

  const sizeClasses = {
    sm: 'h-9 w-9',
    default: 'h-10 w-10',
    lg: 'h-12 w-12'
  };

  const iconSizes = {
    sm: 'h-4 w-4',
    default: 'h-5 w-5',
    lg: 'h-6 w-6'
  };

  return (
    <div className="relative inline-flex items-center justify-center">
      {/* Multi-layer backdrop blur overlay when listening */}
      {isListening && (
        <>
          {/* Outer blur ring - Largest */}
          <div className="absolute inset-0 -m-20 rounded-full bg-red-500/3 backdrop-blur-[4px] animate-fade-in pointer-events-none" />
          
          {/* Middle blur ring */}
          <div className="absolute inset-0 -m-12 rounded-full bg-red-500/5 backdrop-blur-[6px] animate-fade-in pointer-events-none" 
               style={{ animationDelay: '0.1s' }} />
          
          {/* Inner blur ring - Strongest */}
          <div className="absolute inset-0 -m-6 rounded-full bg-red-500/8 backdrop-blur-[8px] animate-fade-in pointer-events-none" 
               style={{ animationDelay: '0.2s' }} />
        </>
      )}

      <Button
        type="button"
        variant="ghost"
        size="icon"
        onClick={onClick}
        disabled={disabled || isProcessing}
        className={cn(
          sizeClasses[size],
          "relative rounded-full transition-all duration-500 ease-out overflow-hidden",
          "shadow-lg hover:shadow-xl",
          isListening
            ? "bg-gradient-to-br from-red-500 via-red-600 to-pink-600 hover:from-red-600 hover:via-red-700 hover:to-pink-700 text-white scale-110 animate-breathe"
            : isProcessing
            ? "bg-gradient-to-br from-blue-500 to-purple-600 text-white"
            : "bg-gradient-to-br from-muted to-muted/80 hover:from-primary/20 hover:to-primary/10 text-muted-foreground hover:text-foreground hover:scale-105",
          "group border-2",
          isListening ? "border-white/30" : "border-transparent",
          className
        )}
        title={
          isListening 
            ? "Đang nghe... (Nhấn để dừng)" 
            : isProcessing
            ? "Đang xử lý..."
            : "Tìm kiếm bằng giọng nói"
        }
      >
        {/* Shimmer effect when listening */}
        {isListening && (
          <span className="absolute inset-0 w-full h-full">
            <span className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer" 
                  style={{ width: '200%', height: '200%' }} />
          </span>
        )}
        {/* Sound wave rings when listening - Breathing effect */}
        {isListening && (
          <>
            {/* Wave 1 - Fastest, largest expansion */}
            <span 
              className="absolute inset-0 rounded-full border-2 border-white/40 animate-sound-wave-1"
              style={{ animationDelay: '0s' }}
            />
            {/* Wave 2 - Medium speed */}
            <span 
              className="absolute inset-0 rounded-full border-2 border-white/35 animate-sound-wave-2"
              style={{ animationDelay: '0.2s' }}
            />
            {/* Wave 3 - Slower */}
            <span 
              className="absolute inset-0 rounded-full border-2 border-white/30 animate-sound-wave-3"
              style={{ animationDelay: '0.4s' }}
            />
            {/* Wave 4 - Even slower */}
            <span 
              className="absolute inset-0 rounded-full border-2 border-pink-200/25 animate-sound-wave-2"
              style={{ animationDelay: '0.6s' }}
            />
            {/* Wave 5 - Slowest, subtle */}
            <span 
              className="absolute inset-0 rounded-full border-2 border-red-200/20 animate-sound-wave-3"
              style={{ animationDelay: '0.8s' }}
            />
            
            {/* ========== RADIANCE GLOW EFFECTS (Multi-layer) ========== */}
            
            {/* Layer 1: Mega outer radiance - Largest, most diffused */}
            <span className="absolute -inset-16 rounded-full bg-gradient-radial from-red-400/20 via-pink-500/15 to-transparent blur-[60px] animate-radiance-pulse" />
            
            {/* Layer 2: Outer radiance */}
            <span className="absolute -inset-12 rounded-full bg-gradient-radial from-red-500/25 via-pink-600/20 to-transparent blur-[40px] animate-radiance-pulse" 
                  style={{ animationDelay: '0.3s' }} />
            
            {/* Layer 3: Middle radiance */}
            <span className="absolute -inset-8 rounded-full bg-gradient-radial from-red-400/30 via-pink-500/25 to-transparent blur-3xl animate-radiance-pulse" 
                  style={{ animationDelay: '0.6s' }} />
            
            {/* Layer 4: Inner radiance */}
            <span className="absolute -inset-4 rounded-full bg-gradient-radial from-red-500/35 via-pink-600/30 to-transparent blur-2xl animate-radiance-pulse" 
                  style={{ animationDelay: '0.9s' }} />
            
            {/* Layer 5: Core glow - Strongest, closest to button */}
            <span className="absolute inset-0 rounded-full bg-gradient-radial from-red-400/40 via-pink-500/35 to-transparent blur-xl animate-radiance-pulse" 
                  style={{ animationDelay: '1.2s' }} />
            
            {/* ========== ROTATING RADIANCE BEAMS ========== */}
            
            {/* Beam 1 */}
            <span className="absolute inset-0 rounded-full animate-rotate-slow">
              <span className="absolute top-0 left-1/2 -translate-x-1/2 w-1 h-full bg-gradient-to-b from-white/40 via-red-400/30 to-transparent blur-sm" />
            </span>
            
            {/* Beam 2 */}
            <span className="absolute inset-0 rounded-full animate-rotate-slow" style={{ animationDelay: '1s' }}>
              <span className="absolute top-0 left-1/2 -translate-x-1/2 w-1 h-full bg-gradient-to-b from-white/30 via-pink-400/25 to-transparent blur-sm rotate-90" />
            </span>
            
            {/* ========== SPARKLE PARTICLES ========== */}
            
            {/* Sparkle 1 - Top */}
            <span className="absolute -top-6 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-white/80 animate-sparkle-1 shadow-[0_0_10px_2px_rgba(255,255,255,0.8)]" />
            
            {/* Sparkle 2 - Right */}
            <span className="absolute top-1/2 -right-6 -translate-y-1/2 w-2 h-2 rounded-full bg-pink-300/80 animate-sparkle-2 shadow-[0_0_10px_2px_rgba(251,207,232,0.8)]" />
            
            {/* Sparkle 3 - Bottom */}
            <span className="absolute -bottom-6 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-red-300/80 animate-sparkle-3 shadow-[0_0_10px_2px_rgba(252,165,165,0.8)]" />
            
            {/* Sparkle 4 - Left */}
            <span className="absolute top-1/2 -left-6 -translate-y-1/2 w-2 h-2 rounded-full bg-white/80 animate-sparkle-4 shadow-[0_0_10px_2px_rgba(255,255,255,0.8)]" />
            
            {/* ========== ENERGY RING ========== */}
            <span className="absolute -inset-2 rounded-full border-2 border-white/20 animate-energy-ring" />
          </>
        )}

        {/* Processing spinner */}
        {isProcessing && (
          <span className="absolute inset-0 rounded-full border-2 border-white/30 border-t-white animate-spin" />
        )}

        {/* Microphone Icon */}
        <span className="relative z-10 flex items-center justify-center">
          <Mic 
            className={cn(
              iconSizes[size],
              "transition-all duration-300",
              isListening && "animate-voice-pulse",
              isProcessing && "animate-spin",
              "group-hover:scale-110"
            )} 
          />
        </span>

        {/* Hover glow effect */}
        <span className="absolute inset-0 rounded-full bg-gradient-to-br from-primary/0 to-primary/0 group-hover:from-primary/20 group-hover:to-primary/10 transition-all duration-300 blur-sm" />
      </Button>

      {/* Status indicator dot */}
      {isListening && (
        <span className="absolute -top-1 -right-1 flex h-3 w-3 z-20">
          <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75" />
          <span className="relative inline-flex rounded-full h-3 w-3 bg-red-500 border-2 border-white shadow-lg" />
        </span>
      )}

      {/* Custom animations */}
      <style jsx>{`
        @keyframes sound-wave-1 {
          0%, 100% {
            transform: scale(1);
            opacity: 0.6;
          }
          50% {
            transform: scale(1.8);
            opacity: 0.3;
          }
        }

        @keyframes sound-wave-2 {
          0%, 100% {
            transform: scale(1);
            opacity: 0.5;
          }
          50% {
            transform: scale(1.6);
            opacity: 0.25;
          }
        }

        @keyframes sound-wave-3 {
          0%, 100% {
            transform: scale(1);
            opacity: 0.4;
          }
          50% {
            transform: scale(1.4);
            opacity: 0.2;
          }
        }

        @keyframes pulse-glow {
          0%, 100% {
            opacity: 0.3;
          }
          50% {
            opacity: 0.6;
          }
        }

        @keyframes voice-pulse {
          0%, 100% {
            transform: scale(1);
          }
          50% {
            transform: scale(1.15);
          }
        }

        @keyframes fade-in {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }

        @keyframes shimmer {
          0% {
            transform: translateX(-100%) translateY(-100%) rotate(45deg);
          }
          100% {
            transform: translateX(100%) translateY(100%) rotate(45deg);
          }
        }

        @keyframes breathe {
          0%, 100% {
            transform: scale(1);
            opacity: 1;
          }
          50% {
            transform: scale(1.03);
            opacity: 0.9;
          }
        }

        @keyframes radiance-pulse {
          0%, 100% {
            opacity: 0.3;
            transform: scale(1);
          }
          50% {
            opacity: 0.8;
            transform: scale(1.1);
          }
        }

        @keyframes rotate-slow {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }

        @keyframes sparkle-1 {
          0%, 100% {
            opacity: 0;
            transform: translate(-50%, 0) scale(0);
          }
          50% {
            opacity: 1;
            transform: translate(-50%, -10px) scale(1.5);
          }
        }

        @keyframes sparkle-2 {
          0%, 100% {
            opacity: 0;
            transform: translate(0, -50%) scale(0);
          }
          50% {
            opacity: 1;
            transform: translate(10px, -50%) scale(1.5);
          }
        }

        @keyframes sparkle-3 {
          0%, 100% {
            opacity: 0;
            transform: translate(-50%, 0) scale(0);
          }
          50% {
            opacity: 1;
            transform: translate(-50%, 10px) scale(1.5);
          }
        }

        @keyframes sparkle-4 {
          0%, 100% {
            opacity: 0;
            transform: translate(0, -50%) scale(0);
          }
          50% {
            opacity: 1;
            transform: translate(-10px, -50%) scale(1.5);
          }
        }

        @keyframes energy-ring {
          0% {
            opacity: 0;
            transform: scale(0.8);
          }
          50% {
            opacity: 0.6;
            transform: scale(1.2);
          }
          100% {
            opacity: 0;
            transform: scale(1.5);
          }
        }

        .animate-sound-wave-1 {
          animation: sound-wave-1 2s ease-in-out infinite;
        }

        .animate-sound-wave-2 {
          animation: sound-wave-2 2.2s ease-in-out infinite;
        }

        .animate-sound-wave-3 {
          animation: sound-wave-3 2.4s ease-in-out infinite;
        }

        .animate-pulse-glow {
          animation: pulse-glow 2s ease-in-out infinite;
        }

        .animate-voice-pulse {
          animation: voice-pulse 1s ease-in-out infinite;
        }

        .animate-fade-in {
          animation: fade-in 0.3s ease-out;
        }

        .animate-shimmer {
          animation: shimmer 3s ease-in-out infinite;
        }

        .animate-breathe {
          animation: breathe 3s ease-in-out infinite;
        }

        .animate-radiance-pulse {
          animation: radiance-pulse 2.5s ease-in-out infinite;
        }

        .animate-rotate-slow {
          animation: rotate-slow 8s linear infinite;
        }

        .animate-sparkle-1 {
          animation: sparkle-1 2s ease-in-out infinite;
        }

        .animate-sparkle-2 {
          animation: sparkle-2 2s ease-in-out infinite 0.5s;
        }

        .animate-sparkle-3 {
          animation: sparkle-3 2s ease-in-out infinite 1s;
        }

        .animate-sparkle-4 {
          animation: sparkle-4 2s ease-in-out infinite 1.5s;
        }

        .animate-energy-ring {
          animation: energy-ring 2s ease-out infinite;
        }

        /* Gradient radial utility */
        .bg-gradient-radial {
          background: radial-gradient(circle, var(--tw-gradient-stops));
        }
      `}</style>
    </div>
  );
};

export default VoiceSearchButton;
</file>

<file path="src/components/cv/PDFViewer.jsx">
import React, { useState } from 'react';
import { Document, Page, pdfjs } from 'react-pdf';
import 'react-pdf/dist/Page/AnnotationLayer.css';
import 'react-pdf/dist/Page/TextLayer.css';
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, ZoomIn, ZoomOut, Download, Loader2 } from 'lucide-react';

// Configure PDF.js worker
pdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`;

/**
 * PDF Viewer Component
 * Displays PDF with navigation and zoom controls
 */
const PDFViewer = ({ pdfUrl, onDownload, fileName = 'cv.pdf' }) => {
    const [numPages, setNumPages] = useState(null);
    const [pageNumber, setPageNumber] = useState(1);
    const [scale, setScale] = useState(1.0);
    const [loading, setLoading] = useState(true);

    const onDocumentLoadSuccess = ({ numPages }) => {
        setNumPages(numPages);
        setLoading(false);
    };

    const onDocumentLoadError = (error) => {
        console.error('Error loading PDF:', error);
        setLoading(false);
    };

    const goToPrevPage = () => {
        setPageNumber((prev) => Math.max(prev - 1, 1));
    };

    const goToNextPage = () => {
        setPageNumber((prev) => Math.min(prev + 1, numPages));
    };

    const zoomIn = () => {
        setScale((prev) => Math.min(prev + 0.2, 2.0));
    };

    const zoomOut = () => {
        setScale((prev) => Math.max(prev - 0.2, 0.5));
    };

    return (
        <div className="flex flex-col h-full bg-gray-50">
            {/* Toolbar */}
            <div className="flex items-center justify-between p-4 bg-white border-b shadow-sm">
                <div className="flex items-center gap-2">
                    <Button
                        variant="outline"
                        size="sm"
                        onClick={goToPrevPage}
                        disabled={pageNumber <= 1}
                    >
                        <ChevronLeft className="h-4 w-4" />
                    </Button>
                    <span className="text-sm text-gray-700 min-w-[100px] text-center">
                        Trang {pageNumber} / {numPages || '...'}
                    </span>
                    <Button
                        variant="outline"
                        size="sm"
                        onClick={goToNextPage}
                        disabled={pageNumber >= numPages}
                    >
                        <ChevronRight className="h-4 w-4" />
                    </Button>
                </div>

                <div className="flex items-center gap-2">
                    <Button variant="outline" size="sm" onClick={zoomOut} disabled={scale <= 0.5}>
                        <ZoomOut className="h-4 w-4" />
                    </Button>
                    <span className="text-sm text-gray-700 min-w-[60px] text-center">
                        {Math.round(scale * 100)}%
                    </span>
                    <Button variant="outline" size="sm" onClick={zoomIn} disabled={scale >= 2.0}>
                        <ZoomIn className="h-4 w-4" />
                    </Button>
                </div>

                <Button variant="default" size="sm" onClick={onDownload}>
                    <Download className="h-4 w-4 mr-2" />
                    Tải xuống
                </Button>
            </div>

            {/* PDF Display */}
            <div className="flex-1 overflow-auto p-4 flex justify-center">
                {loading && (
                    <div className="flex items-center justify-center h-full">
                        <Loader2 className="h-8 w-8 animate-spin text-blue-600" />
                        <span className="ml-2 text-gray-600">Đang tải PDF...</span>
                    </div>
                )}
                <Document
                    file={pdfUrl}
                    onLoadSuccess={onDocumentLoadSuccess}
                    onLoadError={onDocumentLoadError}
                    loading={
                        <div className="flex items-center justify-center h-full">
                            <Loader2 className="h-8 w-8 animate-spin text-blue-600" />
                        </div>
                    }
                >
                    <Page
                        pageNumber={pageNumber}
                        scale={scale}
                        renderTextLayer={true}
                        renderAnnotationLayer={true}
                        className="shadow-lg"
                    />
                </Document>
            </div>
        </div>
    );
};

export default PDFViewer;
</file>

<file path="src/components/CVPreview/CVPaginatedPreview.jsx">
import React, { useEffect, useRef, useState, useCallback } from 'react';

/**
 * CVPaginatedPreview - Smart pagination with automatic page breaks
 * Calculates element heights and splits content intelligently
 */
const CVPaginatedPreview = React.forwardRef(({ children }, ref) => {
  const measureRef = useRef(null);
  const [pages, setPages] = useState([]);
  const [isProcessing, setIsProcessing] = useState(true);

  const paginateContent = useCallback(() => {
    if (!measureRef.current) return;

    // A4 at 96 DPI: 210mm × 297mm = 794px × 1123px
    // Account for padding: 32px (2rem = px-8) on left/right, 32px top/bottom
    const A4_HEIGHT_PX = 1123; // 297mm at 96 DPI
    const PAGE_PADDING_TOP = 0; // First page has header with own padding
    const PAGE_PADDING_BOTTOM = 32; // pb-8 = 2rem = 32px
    const AVAILABLE_HEIGHT = A4_HEIGHT_PX - PAGE_PADDING_BOTTOM;
    
    const container = measureRef.current;
    
    // Get direct children of cv-preview
    const cvPreview = container.querySelector('.cv-preview');
    if (!cvPreview) {
      setIsProcessing(false);
      return;
    }

    // Collect all top-level elements, unwrapping padding containers
    const allElements = [];
    Array.from(cvPreview.children).forEach((child) => {
      // If element is a padding wrapper (px-8, py-8, p-8), extract its children
      if (child.tagName === 'DIV' && 
          (child.classList.contains('px-8') || 
           child.classList.contains('py-8') ||
           child.classList.contains('p-8'))) {
        // Add wrapper's children as top-level elements for better pagination
        allElements.push(...Array.from(child.children));
      } else {
        // Add element directly
        allElements.push(child);
      }
    });
    
    const newPages = [];
    let currentPageElements = [];
    let currentPageHeight = 0;
    
    const DEBUG = false; // Set to true to see pagination logs

    if (DEBUG) console.log('🔍 Starting pagination with', allElements.length, 'elements');

    allElements.forEach((element, index) => {
      // Measure actual height
      const rect = element.getBoundingClientRect();
      const computedStyle = window.getComputedStyle(element);
      const marginTop = parseFloat(computedStyle.marginTop) || 0;
      const marginBottom = parseFloat(computedStyle.marginBottom) || 0;
      const totalHeight = rect.height + marginTop + marginBottom;

      // Check if element should avoid breaking
      const isHeader = element.tagName === 'HEADER';
      const hasAvoidBreak = element.classList.contains('page-break-avoid') ||
                           element.classList.contains('cv-item') ||
                           isHeader;
      const isSectionHeader = element.classList.contains('cv-section-header') ||
                             (element.tagName === 'SECTION' && element.querySelector('h2'));

      if (DEBUG) console.log(`📏 Element ${index}: ${element.tagName}.${element.className} - Height: ${totalHeight.toFixed(0)}px, Current page: ${currentPageHeight.toFixed(0)}px`);

      // Check if adding this element would exceed page height
      if (currentPageHeight + totalHeight > AVAILABLE_HEIGHT) {
        if (DEBUG) console.log(`⚠️ Would exceed page height (${(currentPageHeight + totalHeight).toFixed(0)}px > ${AVAILABLE_HEIGHT}px)`);
        
        if (hasAvoidBreak || isHeader) {
          // Move entire element to next page
          if (currentPageElements.length > 0) {
            if (DEBUG) console.log(`📄 Creating page ${newPages.length + 1} with ${currentPageElements.length} elements`);
            newPages.push([...currentPageElements]);
          }
          currentPageElements = [element.cloneNode(true)];
          currentPageHeight = totalHeight;
          if (DEBUG) console.log(`➡️ Moved to new page, height: ${totalHeight.toFixed(0)}px`);
        } else {
          // Element can break, add to current page
          currentPageElements.push(element.cloneNode(true));
          if (DEBUG) console.log(`📄 Creating page ${newPages.length + 1} with ${currentPageElements.length} elements (overflow)`);
          newPages.push([...currentPageElements]);
          currentPageElements = [];
          currentPageHeight = 0;
        }
      } else {
        // Fits in current page
        currentPageElements.push(element.cloneNode(true));
        currentPageHeight += totalHeight;
        if (DEBUG) console.log(`✅ Added to current page, new height: ${currentPageHeight.toFixed(0)}px`);

        // Special handling for section headers - try to keep with next element
        if (isSectionHeader && index < allElements.length - 1) {
          const nextElement = allElements[index + 1];
          const nextRect = nextElement.getBoundingClientRect();
          const nextStyle = window.getComputedStyle(nextElement);
          const nextMarginTop = parseFloat(nextStyle.marginTop) || 0;
          const nextMarginBottom = parseFloat(nextStyle.marginBottom) || 0;
          const nextHeight = nextRect.height + nextMarginTop + nextMarginBottom;

          // If header + next element don't fit, move header to next page
          if (currentPageHeight + nextHeight > AVAILABLE_HEIGHT && currentPageElements.length > 1) {
            if (DEBUG) console.log(`🔄 Section header would orphan, moving to next page`);
            // Remove header from current page
            const headerElement = currentPageElements.pop();
            currentPageHeight -= totalHeight;
            
            // Save current page
            if (currentPageElements.length > 0) {
              if (DEBUG) console.log(`📄 Creating page ${newPages.length + 1} with ${currentPageElements.length} elements (before header)`);
              newPages.push([...currentPageElements]);
            }
            
            // Start new page with header
            currentPageElements = [headerElement];
            currentPageHeight = totalHeight;
            if (DEBUG) console.log(`➡️ Header moved to new page`);
          }
        }
      }
    });

    // Add remaining elements as last page
    if (currentPageElements.length > 0) {
      if (DEBUG) console.log(`📄 Creating final page ${newPages.length + 1} with ${currentPageElements.length} elements`);
      newPages.push(currentPageElements);
    }

    if (DEBUG) console.log(`✅ Pagination complete: ${newPages.length} pages`);
    setPages(newPages);
    setIsProcessing(false);
  }, []);

  useEffect(() => {
    // Wait for content to render and fonts to load
    const timer = setTimeout(() => {
      if (document.fonts && document.fonts.ready) {
        document.fonts.ready.then(() => {
          // Additional delay to ensure all styles are applied
          setTimeout(paginateContent, 200);
        });
      } else {
        setTimeout(paginateContent, 300);
      }
    }, 100);

    return () => clearTimeout(timer);
  }, [children, paginateContent]);

  return (
    <>
      {/* Hidden container for measurement */}
      <div
        ref={measureRef}
        style={{
          position: 'absolute',
          visibility: 'hidden',
          width: '210mm',
          top: '-99999px',
          left: '-99999px',
          zIndex: -1,
        }}
      >
        {children}
      </div>

      {/* Visible paginated content */}
      <div ref={ref} className="cv-paginated-preview">
        {isProcessing ? (
          // Show loading state
          <div style={{ 
            width: '210mm', 
            minHeight: '297mm', 
            backgroundColor: 'white',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            margin: '0 auto',
            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
          }}>
            <div style={{ textAlign: 'center', color: '#6b7280' }}>
              <div style={{ 
                width: '40px', 
                height: '40px', 
                border: '3px solid #e5e7eb',
                borderTopColor: '#3b82f6',
                borderRadius: '50%',
                animation: 'spin 1s linear infinite',
                margin: '0 auto 10px',
              }} />
              <div>Đang xử lý phân trang...</div>
            </div>
          </div>
        ) : pages.length === 0 ? (
          // Fallback if pagination fails
          <div style={{ 
            width: '210mm', 
            minHeight: '297mm', 
            backgroundColor: 'white',
            margin: '0 auto',
            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
          }}>
            {children}
          </div>
        ) : (
          pages.map((pageElements, pageIndex) => (
            <div
              key={pageIndex}
              className="cv-page"
              style={{
                width: '210mm',
                height: '297mm',
                minHeight: '297mm',
                maxHeight: '297mm',
                backgroundColor: 'white',
                marginBottom: pageIndex < pages.length - 1 ? '10mm' : '0',
                boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                overflow: 'hidden',
                position: 'relative',
                pageBreakAfter: pageIndex < pages.length - 1 ? 'always' : 'auto',
                breakAfter: pageIndex < pages.length - 1 ? 'page' : 'auto',
              }}
            >
              {/* Wrap content with padding - first page has no top padding (header handles it) */}
              <div className={pageIndex === 0 ? "px-8" : "px-8 pt-8"}>
                {pageElements.map((element, elementIndex) => {
                  const wrapper = document.createElement('div');
                  wrapper.appendChild(element);
                  return (
                    <div
                      key={elementIndex}
                      dangerouslySetInnerHTML={{ __html: wrapper.innerHTML }}
                    />
                  );
                })}
              </div>

              {/* Bottom padding for last page */}
              {pageIndex === pages.length - 1 && (
                <div className="pb-8" />
              )}

              {/* Page number */}
              <div
                className="no-print"
                style={{
                  position: 'absolute',
                  bottom: '5mm',
                  right: '10mm',
                  fontSize: '10px',
                  color: '#9ca3af',
                  fontFamily: 'monospace',
                  backgroundColor: 'rgba(255,255,255,0.9)',
                  padding: '2px 6px',
                  borderRadius: '3px',
                  boxShadow: '0 1px 2px rgba(0,0,0,0.1)',
                }}
              >
                Page {pageIndex + 1} / {pages.length}
              </div>
            </div>
          ))
        )}
      </div>

      <style>{`
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `}</style>
    </>
  );
});

CVPaginatedPreview.displayName = 'CVPaginatedPreview';

export default CVPaginatedPreview;
</file>

<file path="src/components/CVPreview/templates/ExecutiveFormalTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github } from 'lucide-react';

const ExecutiveFormalTemplate = ({ cvData }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section className="mb-12">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center border-b-2 border-gray-300 pb-3">
          EXECUTIVE SUMMARY
        </h2>
        <p className="text-gray-700 leading-loose text-lg text-center max-w-4xl mx-auto">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section className="mb-12">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center border-b-2 border-gray-300 pb-3">
          PROFESSIONAL EXPERIENCE
        </h2>
        <div className="space-y-10">
          {workExperience.map((job) => (
            <div key={job.id} className="bg-gray-50 rounded-lg p-8 border border-gray-200">
              <div className="text-center mb-6">
                <h3 className="text-2xl font-bold text-gray-800 mb-2">{job.position}</h3>
                <p className="text-xl text-gray-600 mb-2">{job.company}</p>
                <p className="text-sm text-gray-500 uppercase tracking-wide">
                  {job.startDate} — {job.isCurrentJob ? 'Present' : job.endDate}
                </p>
              </div>
              <p className="text-gray-700 mb-6 leading-loose text-center">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <div>
                  <h4 className="font-bold text-gray-800 mb-4 text-center">Key Achievements</h4>
                  <ul className="text-gray-700 space-y-3 max-w-3xl mx-auto">
                    {job.achievements.map((achievement, index) => (
                      <li key={index} className="flex items-start">
                        <span className="w-2 h-2 bg-gray-400 rounded-full mt-3 mr-4 flex-shrink-0"></span>
                        <span className="leading-loose">{achievement}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section className="mb-12">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center border-b-2 border-gray-300 pb-3">
          EDUCATION
        </h2>
        <div className="space-y-6 max-w-3xl mx-auto">
          {education.map((edu) => (
            <div key={edu.id} className="text-center bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
              <h3 className="text-xl font-bold text-gray-800 mb-2">{edu.degree}</h3>
              <p className="text-lg text-gray-600 mb-2">{edu.institution}</p>
              <p className="text-gray-600 mb-2">{edu.fieldOfStudy}</p>
              <p className="text-sm text-gray-500 uppercase tracking-wide">
                {edu.startDate} — {edu.endDate}
              </p>
              {edu.gpa && <p className="text-sm text-gray-500 mt-2">GPA: {edu.gpa}</p>}
              {edu.honors && <p className="text-sm text-gray-600 mt-2 italic">{edu.honors}</p>}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section className="mb-12">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center border-b-2 border-gray-300 pb-3">
          CORE COMPETENCIES
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category} className="text-center">
                <h3 className="text-lg font-bold text-gray-800 mb-4 uppercase tracking-wide">{category}</h3>
                <div className="space-y-3">
                  {categorySkills.map((skill) => (
                    <div key={skill.id} className="bg-gray-50 rounded-lg p-3 border border-gray-200">
                      <div className="font-semibold text-gray-800">{skill.name}</div>
                      <div className="text-sm text-gray-600">{skill.level}</div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section className="mb-12">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center border-b-2 border-gray-300 pb-3">
          NOTABLE PROJECTS
        </h2>
        <div className="space-y-8 max-w-4xl mx-auto">
          {projects.map((project) => (
            <div key={project.id} className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm">
              <div className="text-center mb-4">
                <h3 className="text-xl font-bold text-gray-800 mb-2">{project.name}</h3>
                <p className="text-sm text-gray-500 uppercase tracking-wide">
                  {project.startDate} — {project.endDate}
                </p>
              </div>
              <p className="text-gray-700 mb-4 leading-loose text-center">{project.description}</p>
              <div className="flex flex-wrap justify-center gap-2">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium border border-gray-300">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section className="mb-12">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 text-center border-b-2 border-gray-300 pb-3">
          PROFESSIONAL CERTIFICATIONS
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
          {certificates.map((cert) => (
            <div key={cert.id} className="bg-white rounded-lg p-6 border border-gray-200 shadow-sm text-center">
              <h3 className="font-bold text-gray-800 text-lg mb-2">{cert.name}</h3>
              <p className="text-gray-600 mb-2">{cert.issuer}</p>
              <p className="text-sm text-gray-500 uppercase tracking-wide">{cert.issueDate}</p>
              {cert.credentialId && (
                <p className="text-xs text-gray-400 mt-2">Credential ID: {cert.credentialId}</p>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="a4-size w-full max-w-5xl mx-auto bg-white shadow-lg print:shadow-none print:max-w-none">
      {/* Formal Header */}
      <div className="bg-gradient-to-r from-gray-100 to-gray-200 p-12 text-center border-b-4 border-gray-800">
        {personalInfo.profileImage && (
          <img
            src={personalInfo.profileImage}
            alt={personalInfo.fullName}
            className="w-32 h-32 rounded-full mx-auto mb-6 object-cover border-4 border-gray-300 shadow-lg"
          />
        )}
        <h1 className="text-5xl font-bold text-gray-800 mb-6 tracking-wide">{personalInfo.fullName}</h1>
        <div className="flex flex-wrap justify-center gap-8 text-gray-600 text-lg">
          {personalInfo.email && (
            <div className="flex items-center">
              <Mail className="w-5 h-5 mr-2" />
              {personalInfo.email}
            </div>
          )}
          {personalInfo.phone && (
            <div className="flex items-center">
              <Phone className="w-5 h-5 mr-2" />
              {personalInfo.phone}
            </div>
          )}
          {personalInfo.address && (
            <div className="flex items-center">
              <MapPin className="w-5 h-5 mr-2" />
              {personalInfo.address}
            </div>
          )}
          {personalInfo.website && (
            <div className="flex items-center">
              <Globe className="w-5 h-5 mr-2" />
              {personalInfo.website}
            </div>
          )}
          {personalInfo.linkedin && (
            <div className="flex items-center">
              <Linkedin className="w-5 h-5 mr-2" />
              LinkedIn
            </div>
          )}
          {personalInfo.github && (
            <div className="flex items-center">
              <Github className="w-5 h-5 mr-2" />
              GitHub
            </div>
          )}
        </div>
      </div>

      {/* Dynamic Content based on sectionOrder */}
      <div className="p-12">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default ExecutiveFormalTemplate;
</file>

<file path="src/components/dashboard/FeaturedCompanies.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { Building2, Users, Briefcase, MapPin, TrendingUp, Star } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { Avatar, AvatarImage, AvatarFallback } from '../ui/avatar';
import { Skeleton } from '../ui/skeleton';
import apiClient from '../../services/apiClient';

export const FeaturedCompanies = () => {
  const navigate = useNavigate();

  // Fetch top companies với React Query
  const { data, isLoading, error } = useQuery({
    queryKey: ['featured-companies'],
    queryFn: async () => {
      const response = await apiClient.get('/analytics/top-companies?limit=8');
      return response.data;
    },
    staleTime: 5 * 60 * 1000, // 5 phút
    cacheTime: 10 * 60 * 1000, // 10 phút
  });

  const companies = data?.data || [];

  // Format số nhân viên
  const formatEmployees = (employees) => {
    if (!employees) return 'N/A';
    if (employees >= 10000) return `${Math.floor(employees / 1000)}K+`;
    if (employees >= 1000) return `${Math.floor(employees / 1000)}K+`;
    return `${employees}+`;
  };

  // Handle click vào công ty
  const handleCompanyClick = (companyId) => {
    navigate(`/company/${companyId}`);
  };

  // Render loading state
  if (isLoading) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="h-5 w-5 text-primary" />
            <span>Top công ty được săn đón</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {[...Array(4)].map((_, i) => (
              <div key={i} className="flex items-center gap-3 p-3 rounded-lg border">
                <Skeleton className="h-12 w-12 rounded-lg" />
                <div className="flex-1 space-y-2">
                  <Skeleton className="h-4 w-3/4" />
                  <Skeleton className="h-3 w-1/2" />
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    );
  }

  // Render error state
  if (error) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="h-5 w-5 text-primary" />
            <span>Top công ty được săn đón</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-center py-8 text-muted-foreground">
            <Building2 className="h-12 w-12 mx-auto mb-3 opacity-50" />
            <p className="text-sm">Không thể tải danh sách công ty</p>
          </div>
        </CardContent>
      </Card>
    );
  }

  // Render empty state
  if (!companies || companies.length === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <TrendingUp className="h-5 w-5 text-primary" />
            <span>Top công ty được săn đón</span>
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-center py-8 text-muted-foreground">
            <Building2 className="h-12 w-12 mx-auto mb-3 opacity-50" />
            <p className="text-sm">Chưa có dữ liệu công ty</p>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="shadow-sm hover:shadow-md transition-shadow duration-300">
      <CardHeader className="pb-4">
        <div className="flex items-center justify-between">
          <CardTitle className="flex items-center gap-2">
            <div className="p-2 rounded-lg bg-primary/10">
              <TrendingUp className="h-5 w-5 text-primary" />
            </div>
            <span className="text-lg">Top công ty được săn đón</span>
          </CardTitle>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => navigate('/companies')}
            className="text-xs text-primary hover:text-primary/80"
          >
            Xem tất cả →
          </Button>
        </div>
        <p className="text-sm text-muted-foreground mt-1">
          Các công ty có nhiều tin tuyển dụng nhất
        </p>
      </CardHeader>
      <CardContent className="space-y-2">
        {companies.slice(0, 6).map((company, index) => (
          <div
            key={company._id}
            onClick={() => handleCompanyClick(company._id)}
            className="group relative flex items-center gap-3 p-3 rounded-xl border border-border/50 hover:border-primary/30 bg-card hover:bg-accent/50 transition-all duration-200 cursor-pointer"
          >
            {/* Ranking badge cho top 3 */}
            {index < 3 && (
              <div className="absolute -top-2 -left-2 z-10">
                <Badge
                  className={`
                    h-6 w-6 flex items-center justify-center rounded-full text-xs font-bold shadow-sm
                    ${index === 0 ? 'bg-gradient-to-br from-yellow-400 to-yellow-600 text-white' : ''}
                    ${index === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-500 text-white' : ''}
                    ${index === 2 ? 'bg-gradient-to-br from-orange-400 to-orange-600 text-white' : ''}
                  `}
                >
                  {index + 1}
                </Badge>
              </div>
            )}

            {/* Company logo */}
            <Avatar className="h-14 w-14 rounded-lg border-2 border-border/50 flex-shrink-0">
              <AvatarImage
                src={company.logo}
                alt={company.companyName}
                className="object-contain p-1"
              />
              <AvatarFallback className="rounded-lg bg-gradient-to-br from-primary/10 to-primary/5 text-primary font-semibold text-lg">
                {company.companyName?.charAt(0) || 'C'}
              </AvatarFallback>
            </Avatar>

            {/* Company info */}
            <div className="flex-1 min-w-0">
              <div className="flex items-start justify-between gap-2 mb-1">
                <h4 className="font-semibold text-sm text-foreground line-clamp-1 group-hover:text-primary transition-colors">
                  {company.companyName}
                </h4>
                {index < 3 && (
                  <Star className="h-4 w-4 text-yellow-500 fill-yellow-500 flex-shrink-0" />
                )}
              </div>

              <p className="text-xs text-muted-foreground line-clamp-1 mb-2">
                {company.industry || 'Đa lĩnh vực'}
              </p>

              {/* Stats */}
              <div className="flex items-center gap-3 text-xs text-muted-foreground">
                <div className="flex items-center gap-1">
                  <Briefcase className="h-3 w-3 text-emerald-600" />
                  <span className="font-medium text-emerald-600">
                    {company.activeJobCount}
                  </span>
                  <span className="hidden sm:inline">việc làm</span>
                </div>
                
                <div className="flex items-center gap-1">
                  <Users className="h-3 w-3" />
                  <span>{formatEmployees(company.employees)}</span>
                </div>

                {company.location?.province && (
                  <div className="flex items-center gap-1 truncate">
                    <MapPin className="h-3 w-3 flex-shrink-0" />
                    <span className="truncate">{company.location.province}</span>
                  </div>
                )}
              </div>
            </div>
          </div>
        ))}

        {/* View all button */}
        <Button
          variant="outline"
          className="w-full mt-4 border-dashed hover:border-primary hover:bg-primary/5 transition-all"
          onClick={() => navigate('/companies')}
        >
          <Building2 className="h-4 w-4 mr-2" />
          Khám phá thêm công ty
        </Button>
      </CardContent>
    </Card>
  );
};

export default FeaturedCompanies;
</file>

<file path="src/components/dashboard/README.md">
# Dashboard Components

## FeaturedCompanies Component

Component hiển thị **Top công ty được săn đón nhất** trong Dashboard của ứng viên.

### 📍 Vị trí
```
src/components/dashboard/FeaturedCompanies.jsx
```

### 🎯 Mục đích
Hiển thị danh sách các công ty có nhiều tin tuyển dụng nhất, giúp ứng viên khám phá các nhà tuyển dụng uy tín và có nhiều cơ hội việc làm.

### 📊 Nguồn dữ liệu
- **API Endpoint**: `GET /analytics/top-companies?limit=8`
- **Caching**: React Query với staleTime 5 phút
- **Data source**: MongoDB collection `recruiterprofiles` join với `jobs`
- **Sorting**: Sắp xếp theo `activeJobCount` (số tin ACTIVE + APPROVED) giảm dần

### 🎨 UI Features

#### 1. **Ranking Badges** (Top 1-3)
- 🥇 **Top 1**: Gradient vàng (gold)
- 🥈 **Top 2**: Gradient bạc (silver)  
- 🥉 **Top 3**: Gradient đồng (bronze)
- ⭐ Star icon cho top 3

#### 2. **Company Card Layout**
```
┌─────────────────────────────────┐
│ [Badge] [Logo] Company Name  ⭐ │
│         Industry                │
│         💼 5 việc làm           │
│         👥 1K+ 📍 Hà Nội        │
└─────────────────────────────────┘
```

#### 3. **Avatar Fallback**
- Hiển thị chữ cái đầu tiên của tên công ty
- Gradient background: primary/10 to primary/5
- Rounded corners cho modern look

#### 4. **Hover Effects**
- Border color chuyển sang primary/30
- Background chuyển sang accent/50
- Company name chuyển màu primary
- Smooth transition 200ms

### 📱 Responsive Design

| Screen Size | Layout | Companies Shown |
|-------------|--------|-----------------|
| Mobile (<768px) | 1 column | 6 công ty |
| Tablet (768-1024px) | 1 column | 6 công ty |
| Desktop (>1024px) | 1 column (in 3-col grid) | 6 công ty |

### 🔄 States

#### Loading State
- 4 skeleton cards với animation pulse
- Giữ layout consistency

#### Error State
- Building2 icon mờ
- Thông báo lỗi thân thiện
- Không crash app

#### Empty State
- Building2 icon mờ
- "Chưa có dữ liệu công ty"

### 🎯 User Interactions

1. **Click vào company card** → Navigate đến `/company/{companyId}`
2. **Click "Xem tất cả" (header)** → Navigate đến `/companies`
3. **Click "Khám phá thêm công ty" (footer button)** → Navigate đến `/companies`

### 📊 Data Display

#### Company Info
- **Logo**: Avatar component với fallback
- **Company Name**: Line-clamp-1, hover:text-primary
- **Industry**: Text muted, fallback "Đa lĩnh vực"

#### Statistics
- **Active Jobs**: 💼 icon, text emerald-600, font-medium
- **Employees**: 👥 icon, formatted (1K+, 10K+)
- **Location**: 📍 icon, province name, truncate

### 🔗 Integration với Dashboard

```jsx
// Dashboard.jsx
import FeaturedCompanies from '../../components/dashboard/FeaturedCompanies';

// Layout: 3-column grid
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  {/* Featured Companies - 1 column */}
  <div className="lg:col-span-1">
    <FeaturedCompanies />
  </div>

  {/* Recommended Jobs - 2 columns */}
  <div className="lg:col-span-2">
    {/* Job recommendations */}
  </div>
</div>
```

### 🎨 Styling Classes

#### Card
- `shadow-sm hover:shadow-md` - Subtle elevation
- `transition-shadow duration-300` - Smooth shadow change

#### Company Item
- `border-border/50 hover:border-primary/30` - Border color transition
- `bg-card hover:bg-accent/50` - Background highlight
- `rounded-xl` - Rounded corners
- `cursor-pointer` - Interactive feedback

#### Rankings
- Top 1: `from-yellow-400 to-yellow-600`
- Top 2: `from-gray-300 to-gray-500`
- Top 3: `from-orange-400 to-orange-600`

### 🔧 Dependencies
```jsx
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { Building2, Users, Briefcase, MapPin, TrendingUp, Star } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { Avatar, AvatarImage, AvatarFallback } from '../ui/avatar';
import { Skeleton } from '../ui/skeleton';
import apiClient from '../../services/apiClient';
```

### 📈 Performance

- **React Query Caching**: 
  - staleTime: 5 minutes
  - cacheTime: 10 minutes
- **Render Optimization**: Memoized với queryKey
- **Image Loading**: Lazy loading với Avatar component

### 🧪 Testing Checklist

- [ ] Loading state hiển thị 4 skeleton cards
- [ ] Error state hiển thị thông báo lỗi
- [ ] Empty state hiển thị khi không có data
- [ ] Top 3 badges hiển thị đúng màu sắc
- [ ] Logo fallback hiển thị chữ cái đầu
- [ ] Click vào card navigate đến company detail
- [ ] Click "Xem tất cả" navigate đến company list
- [ ] Hover effects hoạt động smooth
- [ ] Responsive trên mobile/tablet/desktop
- [ ] Data format đúng (employees, job count)

### 🔮 Future Enhancements

- [ ] Add company rating stars
- [ ] Add "Following" status
- [ ] Add quick apply button
- [ ] Add company size filter
- [ ] Add location filter
- [ ] Add animation on data load
- [ ] Add infinite scroll option
- [ ] Add bookmark feature
</file>

<file path="src/components/debug/LogoDebugger.jsx">
// Test component để verify logo từ MongoDB
import { useEffect, useState } from 'react';
import apiClient from '../services/apiClient';

const LogoDebugger = () => {
  const [jobs, setJobs] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchJobs = async () => {
      try {
        const response = await apiClient.get('/jobs/search/hybrid', {
          params: {
            query: '',
            page: 1,
            size: 5
          }
        });
        
        console.log('🔍 Full API Response:', response.data);
        
        if (response.data.success && response.data.data) {
          setJobs(response.data.data);
          
          // Log chi tiết từng job
          response.data.data.forEach((job, index) => {
            console.log(`\n📋 Job ${index + 1}:`, {
              title: job.title,
              companyName: job.company?.name,
              companyLogo: job.company?.logo,
              hasLogo: !!job.company?.logo,
              isDefaultLogo: job.company?.logo === 'https://i.pinimg.com/736x/ec/d9/c2/ecd9c2e8ed0dbbc96ac472a965e4afda.jpg'
            });
          });
        }
      } catch (error) {
        console.error('❌ Error fetching jobs:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchJobs();
  }, []);

  if (loading) return <div>Loading...</div>;

  return (
    <div className="p-8 max-w-4xl mx-auto">
      <h1 className="text-2xl font-bold mb-6">🔍 Logo Debugger</h1>
      
      <div className="space-y-4">
        {jobs.map((job, index) => (
          <div key={job._id} className="border p-4 rounded-lg">
            <div className="flex items-start gap-4">
              {/* Logo Display */}
              <div className="flex-shrink-0">
                <div className="w-24 h-24 border-2 rounded-lg overflow-hidden bg-gray-100">
                  {job.company?.logo ? (
                    <img
                      src={job.company.logo}
                      alt={job.company.name}
                      className="w-full h-full object-cover"
                      onError={(e) => {
                        console.error(`❌ Failed to load logo:`, job.company.logo);
                        e.target.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100"%3E%3Crect fill="%23ddd" width="100" height="100"/%3E%3Ctext fill="%23999" x="50%" y="50%" text-anchor="middle" dy=".3em" font-size="20"%3E?%3C/text%3E%3C/svg%3E';
                      }}
                    />
                  ) : (
                    <div className="w-full h-full flex items-center justify-center bg-gray-200 text-gray-500 font-bold text-2xl">
                      {job.company?.name?.charAt(0) || '?'}
                    </div>
                  )}
                </div>
              </div>

              {/* Job Info */}
              <div className="flex-1">
                <h3 className="font-bold text-lg mb-2">{job.title}</h3>
                <p className="text-gray-600 mb-2">
                  <strong>Company:</strong> {job.company?.name || 'N/A'}
                </p>
                <div className="text-sm text-gray-500 space-y-1">
                  <p>
                    <strong>Logo URL:</strong>{' '}
                    <code className="bg-gray-100 px-2 py-1 rounded text-xs break-all">
                      {job.company?.logo || 'No logo'}
                    </code>
                  </p>
                  <p>
                    <strong>Status:</strong>{' '}
                    {job.company?.logo ? (
                      job.company.logo === 'https://i.pinimg.com/736x/ec/d9/c2/ecd9c2e8ed0dbbc96ac472a965e4afda.jpg' ? (
                        <span className="text-orange-600">⚠️ Default Logo</span>
                      ) : (
                        <span className="text-green-600">✅ Custom Logo</span>
                      )
                    ) : (
                      <span className="text-red-600">❌ No Logo</span>
                    )}
                  </p>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>

      {jobs.length === 0 && (
        <div className="text-center text-gray-500 py-8">
          No jobs found
        </div>
      )}
    </div>
  );
};

export default LogoDebugger;
</file>

<file path="src/components/forms/CertificatesForm.jsx">
import React from 'react';
import { AlignCenterVertical as Certificate, Plus, Trash2, Calendar, GripVertical, ChevronUp, ChevronDown, ExternalLink } from 'lucide-react';

const CertificatesForm = ({ certificates, onChange }) => {
  const addCertificate = () => {
    const newCertificate = {
      id: Date.now().toString(),
      name: '',
      issuer: '',
      issueDate: '',
      expiryDate: '',
      credentialId: '',
      url: ''
    };
    onChange([...certificates, newCertificate]);
  };

  const updateCertificate = (id, field, value) => {
    onChange(
      certificates.map(cert =>
        cert.id === id ? { ...cert, [field]: value } : cert
      )
    );
  };

  const removeCertificate = (id) => {
    onChange(certificates.filter(cert => cert.id !== id));
  };

  const moveCertificate = (index, direction) => {
    const newArray = [...certificates];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    
    if (targetIndex >= 0 && targetIndex < newArray.length) {
      [newArray[index], newArray[targetIndex]] = [newArray[targetIndex], newArray[index]];
      onChange(newArray);
    }
  };

  const handleDragStart = (e, index) => {
    e.dataTransfer.setData('text/plain', index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex) => {
    e.preventDefault();
    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
    
    if (dragIndex !== dropIndex) {
      const newArray = [...certificates];
      const draggedItem = newArray[dragIndex];
      newArray.splice(dragIndex, 1);
      newArray.splice(dropIndex, 0, draggedItem);
      onChange(newArray);
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold text-gray-800 flex items-center">
          <Certificate className="w-5 h-5 mr-2 text-blue-600" />
          Certificates & Certifications
        </h3>
        <button
          onClick={addCertificate}
          className="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors"
        >
          <Plus className="w-4 h-4 mr-1" />
          Add Certificate
        </button>
      </div>

      {certificates.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          <Certificate className="w-12 h-12 mx-auto mb-3 text-gray-300" />
          <p>No certificates added yet. Click "Add Certificate" to get started.</p>
        </div>
      ) : (
        <div className="space-y-4">
          <div className="text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
            💡 <strong>Tip:</strong> List your most recent and relevant certifications first.
          </div>
          
          {certificates.map((cert, index) => (
            <div 
              key={cert.id} 
              className="p-6 border border-gray-200 rounded-lg bg-gray-50 relative group"
              draggable
              onDragStart={(e) => handleDragStart(e, index)}
              onDragOver={handleDragOver}
              onDrop={(e) => handleDrop(e, index)}
            >
              {/* Drag Handle and Controls */}
              <div className="absolute left-2 top-6 flex flex-col items-center space-y-1">
                <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
                <div className="flex flex-col space-y-1">
                  <button
                    onClick={() => moveCertificate(index, 'up')}
                    disabled={index === 0}
                    className={`p-1 rounded ${index === 0 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move up"
                  >
                    <ChevronUp className="w-3 h-3" />
                  </button>
                  <button
                    onClick={() => moveCertificate(index, 'down')}
                    disabled={index === certificates.length - 1}
                    className={`p-1 rounded ${index === certificates.length - 1 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move down"
                  >
                    <ChevronDown className="w-3 h-3" />
                  </button>
                </div>
              </div>

              <div className="ml-8">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center space-x-2">
                    <h4 className="text-md font-medium text-gray-800">Certificate #{index + 1}</h4>
                    <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">
                      Position {index + 1}
                    </span>
                  </div>
                  <button
                    onClick={() => removeCertificate(cert.id)}
                    className="text-red-500 hover:text-red-700 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Certificate Name *
                    </label>
                    <input
                      type="text"
                      value={cert.name}
                      onChange={(e) => updateCertificate(cert.id, 'name', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="AWS Certified Solutions Architect"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Issuing Organization *
                    </label>
                    <input
                      type="text"
                      value={cert.issuer}
                      onChange={(e) => updateCertificate(cert.id, 'issuer', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Amazon Web Services"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      <Calendar className="w-4 h-4 inline mr-1" />
                      Issue Date *
                    </label>
                    <input
                      type="month"
                      value={cert.issueDate}
                      onChange={(e) => updateCertificate(cert.id, 'issueDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Expiry Date
                    </label>
                    <input
                      type="month"
                      value={cert.expiryDate}
                      onChange={(e) => updateCertificate(cert.id, 'expiryDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <p className="text-xs text-gray-500 mt-1">Leave empty if it doesn't expire</p>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Credential ID
                    </label>
                    <input
                      type="text"
                      value={cert.credentialId}
                      onChange={(e) => updateCertificate(cert.id, 'credentialId', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="ABC123456789"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      <ExternalLink className="w-4 h-4 inline mr-1" />
                      Certificate URL
                    </label>
                    <input
                      type="url"
                      value={cert.url}
                      onChange={(e) => updateCertificate(cert.id, 'url', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="https://verify.certificate.com"
                    />
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default CertificatesForm;
</file>

<file path="src/components/forms/EducationForm.jsx">
import React from 'react';
import { GraduationCap, Plus, Trash2, Calendar, GripVertical, ChevronUp, ChevronDown } from 'lucide-react';

const EducationForm = ({ education, onChange }) => {
  const addEducation = () => {
    const newEducation = {
      id: Date.now().toString(),
      institution: '',
      degree: '',
      fieldOfStudy: '',
      startDate: '',
      endDate: '',
      gpa: '',
      honors: ''
    };
    onChange([...education, newEducation]);
  };

  const updateEducation = (id, field, value) => {
    onChange(
      education.map(edu =>
        edu.id === id ? { ...edu, [field]: value } : edu
      )
    );
  };

  const removeEducation = (id) => {
    onChange(education.filter(edu => edu.id !== id));
  };

  const moveEducation = (index, direction) => {
    const newArray = [...education];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    
    if (targetIndex >= 0 && targetIndex < newArray.length) {
      [newArray[index], newArray[targetIndex]] = [newArray[targetIndex], newArray[index]];
      onChange(newArray);
    }
  };

  const handleDragStart = (e, index) => {
    e.dataTransfer.setData('text/plain', index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex) => {
    e.preventDefault();
    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
    
    if (dragIndex !== dropIndex) {
      const newArray = [...education];
      const draggedItem = newArray[dragIndex];
      newArray.splice(dragIndex, 1);
      newArray.splice(dropIndex, 0, draggedItem);
      onChange(newArray);
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold text-gray-800 flex items-center">
          <GraduationCap className="w-5 h-5 mr-2 text-blue-600" />
          Education
        </h3>
        <button
          onClick={addEducation}
          className="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors"
        >
          <Plus className="w-4 h-4 mr-1" />
          Add Education
        </button>
      </div>

      {education.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          <GraduationCap className="w-12 h-12 mx-auto mb-3 text-gray-300" />
          <p>No education added yet. Click "Add Education" to get started.</p>
        </div>
      ) : (
        <div className="space-y-4">
          <div className="text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
            💡 <strong>Tip:</strong> List your education in reverse chronological order (most recent first).
          </div>
          
          {education.map((edu, index) => (
            <div 
              key={edu.id} 
              className="p-6 border border-gray-200 rounded-lg bg-gray-50 relative group"
              draggable
              onDragStart={(e) => handleDragStart(e, index)}
              onDragOver={handleDragOver}
              onDrop={(e) => handleDrop(e, index)}
            >
              {/* Drag Handle and Controls */}
              <div className="absolute left-2 top-6 flex flex-col items-center space-y-1">
                <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
                <div className="flex flex-col space-y-1">
                  <button
                    onClick={() => moveEducation(index, 'up')}
                    disabled={index === 0}
                    className={`p-1 rounded ${index === 0 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move up"
                  >
                    <ChevronUp className="w-3 h-3" />
                  </button>
                  <button
                    onClick={() => moveEducation(index, 'down')}
                    disabled={index === education.length - 1}
                    className={`p-1 rounded ${index === education.length - 1 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move down"
                  >
                    <ChevronDown className="w-3 h-3" />
                  </button>
                </div>
              </div>

              <div className="ml-8">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center space-x-2">
                    <h4 className="text-md font-medium text-gray-800">Education #{index + 1}</h4>
                    <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">
                      Position {index + 1}
                    </span>
                  </div>
                  <button
                    onClick={() => removeEducation(edu.id)}
                    className="text-red-500 hover:text-red-700 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Degree *
                    </label>
                    <input
                      type="text"
                      value={edu.degree}
                      onChange={(e) => updateEducation(edu.id, 'degree', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Bachelor of Science"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Institution *
                    </label>
                    <input
                      type="text"
                      value={edu.institution}
                      onChange={(e) => updateEducation(edu.id, 'institution', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="University Name"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Field of Study
                    </label>
                    <input
                      type="text"
                      value={edu.fieldOfStudy}
                      onChange={(e) => updateEducation(edu.id, 'fieldOfStudy', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Computer Science"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      GPA
                    </label>
                    <input
                      type="text"
                      value={edu.gpa}
                      onChange={(e) => updateEducation(edu.id, 'gpa', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="3.8/4.0"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      <Calendar className="w-4 h-4 inline mr-1" />
                      Start Date *
                    </label>
                    <input
                      type="month"
                      value={edu.startDate}
                      onChange={(e) => updateEducation(edu.id, 'startDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      End Date *
                    </label>
                    <input
                      type="month"
                      value={edu.endDate}
                      onChange={(e) => updateEducation(edu.id, 'endDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      required
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Honors & Awards
                  </label>
                  <input
                    type="text"
                    value={edu.honors}
                    onChange={(e) => updateEducation(edu.id, 'honors', e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    placeholder="Magna Cum Laude, Dean's List"
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default EducationForm;
</file>

<file path="src/components/forms/ProjectsForm.jsx">
import React from 'react';
import { FolderOpen, Plus, Trash2, Calendar, GripVertical, ChevronUp, ChevronDown, Globe, Github } from 'lucide-react';

const ProjectsForm = ({ projects, onChange }) => {
  const addProject = () => {
    const newProject = {
      id: Date.now().toString(),
      name: '',
      description: '',
      technologies: [],
      startDate: '',
      endDate: '',
      url: '',
      github: ''
    };
    onChange([...projects, newProject]);
  };

  const updateProject = (id, field, value) => {
    onChange(
      projects.map(project =>
        project.id === id ? { ...project, [field]: value } : project
      )
    );
  };

  const removeProject = (id) => {
    onChange(projects.filter(project => project.id !== id));
  };

  const moveProject = (index, direction) => {
    const newArray = [...projects];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    
    if (targetIndex >= 0 && targetIndex < newArray.length) {
      [newArray[index], newArray[targetIndex]] = [newArray[targetIndex], newArray[index]];
      onChange(newArray);
    }
  };

  const handleDragStart = (e, index) => {
    e.dataTransfer.setData('text/plain', index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex) => {
    e.preventDefault();
    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
    
    if (dragIndex !== dropIndex) {
      const newArray = [...projects];
      const draggedItem = newArray[dragIndex];
      newArray.splice(dragIndex, 1);
      newArray.splice(dropIndex, 0, draggedItem);
      onChange(newArray);
    }
  };

  const updateTechnologies = (id, techString) => {
    const technologies = techString.split(',').map(tech => tech.trim()).filter(tech => tech);
    updateProject(id, 'technologies', technologies);
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold text-gray-800 flex items-center">
          <FolderOpen className="w-5 h-5 mr-2 text-blue-600" />
          Projects
        </h3>
        <button
          onClick={addProject}
          className="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors"
        >
          <Plus className="w-4 h-4 mr-1" />
          Add Project
        </button>
      </div>

      {projects.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          <FolderOpen className="w-12 h-12 mx-auto mb-3 text-gray-300" />
          <p>No projects added yet. Click "Add Project" to get started.</p>
        </div>
      ) : (
        <div className="space-y-4">
          <div className="text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
            💡 <strong>Tip:</strong> List your most impressive projects first. Include personal and professional projects.
          </div>
          
          {projects.map((project, index) => (
            <div 
              key={project.id} 
              className="p-6 border border-gray-200 rounded-lg bg-gray-50 relative group"
              draggable
              onDragStart={(e) => handleDragStart(e, index)}
              onDragOver={handleDragOver}
              onDrop={(e) => handleDrop(e, index)}
            >
              {/* Drag Handle and Controls */}
              <div className="absolute left-2 top-6 flex flex-col items-center space-y-1">
                <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
                <div className="flex flex-col space-y-1">
                  <button
                    onClick={() => moveProject(index, 'up')}
                    disabled={index === 0}
                    className={`p-1 rounded ${index === 0 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move up"
                  >
                    <ChevronUp className="w-3 h-3" />
                  </button>
                  <button
                    onClick={() => moveProject(index, 'down')}
                    disabled={index === projects.length - 1}
                    className={`p-1 rounded ${index === projects.length - 1 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move down"
                  >
                    <ChevronDown className="w-3 h-3" />
                  </button>
                </div>
              </div>

              <div className="ml-8">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center space-x-2">
                    <h4 className="text-md font-medium text-gray-800">Project #{index + 1}</h4>
                    <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">
                      Position {index + 1}
                    </span>
                  </div>
                  <button
                    onClick={() => removeProject(project.id)}
                    className="text-red-500 hover:text-red-700 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Project Name *
                    </label>
                    <input
                      type="text"
                      value={project.name}
                      onChange={(e) => updateProject(project.id, 'name', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="E-commerce Website"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Technologies *
                    </label>
                    <input
                      type="text"
                      value={project.technologies.join(', ')}
                      onChange={(e) => updateTechnologies(project.id, e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="React, Node.js, MongoDB"
                      required
                    />
                    <p className="text-xs text-gray-500 mt-1">Separate technologies with commas</p>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      <Calendar className="w-4 h-4 inline mr-1" />
                      Start Date
                    </label>
                    <input
                      type="month"
                      value={project.startDate}
                      onChange={(e) => updateProject(project.id, 'startDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      End Date
                    </label>
                    <input
                      type="month"
                      value={project.endDate}
                      onChange={(e) => updateProject(project.id, 'endDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      <Globe className="w-4 h-4 inline mr-1" />
                      Live URL
                    </label>
                    <input
                      type="url"
                      value={project.url}
                      onChange={(e) => updateProject(project.id, 'url', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="https://myproject.com"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      <Github className="w-4 h-4 inline mr-1" />
                      GitHub URL
                    </label>
                    <input
                      type="url"
                      value={project.github}
                      onChange={(e) => updateProject(project.id, 'github', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="https://github.com/username/project"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Project Description *
                  </label>
                  <textarea
                    value={project.description}
                    onChange={(e) => updateProject(project.id, 'description', e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows={3}
                    placeholder="Describe what the project does, your role, and key achievements..."
                    required
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default ProjectsForm;
</file>

<file path="src/components/forms/SkillsForm.jsx">
import React from 'react';
import { Award, Plus, Trash2, GripVertical, ChevronUp, ChevronDown } from 'lucide-react';

const SkillsForm = ({ skills, onChange }) => {
  const addSkill = () => {
    const newSkill = {
      id: Date.now().toString(),
      name: '',
      level: 'Intermediate',
      category: 'Technical'
    };
    onChange([...skills, newSkill]);
  };

  const updateSkill = (id, field, value) => {
    onChange(
      skills.map(skill =>
        skill.id === id ? { ...skill, [field]: value } : skill
      )
    );
  };

  const removeSkill = (id) => {
    onChange(skills.filter(skill => skill.id !== id));
  };

  // Move skill up/down
  const moveSkill = (index, direction) => {
    const newArray = [...skills];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    
    if (targetIndex >= 0 && targetIndex < newArray.length) {
      [newArray[index], newArray[targetIndex]] = [newArray[targetIndex], newArray[index]];
      onChange(newArray);
    }
  };

  // Drag and drop handlers
  const handleDragStart = (e, index) => {
    e.dataTransfer.setData('text/plain', index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex) => {
    e.preventDefault();
    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
    
    if (dragIndex !== dropIndex) {
      const newArray = [...skills];
      const draggedItem = newArray[dragIndex];
      newArray.splice(dragIndex, 1);
      newArray.splice(dropIndex, 0, draggedItem);
      onChange(newArray);
    }
  };

  const skillsByCategory = {
    Technical: skills.filter(skill => skill.category === 'Technical'),
    'Soft Skills': skills.filter(skill => skill.category === 'Soft Skills'),
    Language: skills.filter(skill => skill.category === 'Language')
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold text-gray-800 flex items-center">
          <Award className="w-5 h-5 mr-2 text-blue-600" />
          Skills
        </h3>
        <button
          onClick={addSkill}
          className="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors"
        >
          <Plus className="w-4 h-4 mr-1" />
          Add Skill
        </button>
      </div>

      {skills.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          <Award className="w-12 h-12 mx-auto mb-3 text-gray-300" />
          <p>No skills added yet. Click "Add Skill" to get started.</p>
        </div>
      ) : (
        <div className="space-y-4">
          <div className="text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
            💡 <strong>Tip:</strong> Drag and drop skills to reorder them, or use the arrow buttons. 
            Order them by importance or proficiency level.
          </div>
          
          {skills.map((skill, index) => (
            <div 
              key={skill.id} 
              className="flex items-center space-x-3 p-4 bg-gray-50 rounded-lg border border-gray-200 relative group"
              draggable
              onDragStart={(e) => handleDragStart(e, index)}
              onDragOver={handleDragOver}
              onDrop={(e) => handleDrop(e, index)}
            >
              {/* Drag Handle and Controls */}
              <div className="flex flex-col items-center space-y-1">
                <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
                <div className="flex flex-col space-y-1">
                  <button
                    onClick={() => moveSkill(index, 'up')}
                    disabled={index === 0}
                    className={`p-1 rounded ${index === 0 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move up"
                  >
                    <ChevronUp className="w-3 h-3" />
                  </button>
                  <button
                    onClick={() => moveSkill(index, 'down')}
                    disabled={index === skills.length - 1}
                    className={`p-1 rounded ${index === skills.length - 1 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move down"
                  >
                    <ChevronDown className="w-3 h-3" />
                  </button>
                </div>
              </div>

              <div className="flex-1">
                <input
                  type="text"
                  value={skill.name || ''}
                  onChange={(e) => updateSkill(skill.id, 'name', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="Enter skill name (e.g., JavaScript, Communication, English)"
                />
              </div>
              <div className="w-32">
                <select
                  value={skill.level || 'Intermediate'}
                  onChange={(e) => updateSkill(skill.id, 'level', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="Beginner">Beginner</option>
                  <option value="Intermediate">Intermediate</option>
                  <option value="Advanced">Advanced</option>
                  <option value="Expert">Expert</option>
                </select>
              </div>
              <div className="w-32">
                <select
                  value={skill.category || 'Technical'}
                  onChange={(e) => updateSkill(skill.id, 'category', e.target.value)}
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                  <option value="Technical">Technical</option>
                  <option value="Soft Skills">Soft Skills</option>
                  <option value="Language">Language</option>
                </select>
              </div>
              <button
                onClick={() => removeSkill(skill.id)}
                className="text-red-500 hover:text-red-700 transition-colors p-1"
                title="Remove skill"
              >
                <Trash2 className="w-4 h-4" />
              </button>
            </div>
          ))}
        </div>
      )}

      {/* Skills by Category Display */}
      {skills.length > 0 && (
        <div className="mt-6 p-4 bg-blue-50 rounded-lg">
          <h4 className="font-medium text-gray-800 mb-3">Skills Preview by Category:</h4>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            {Object.entries(skillsByCategory).map(([category, categorySkills]) => (
              <div key={category}>
                <h5 className="font-semibold text-gray-700 mb-2">{category}</h5>
                {categorySkills.length > 0 ? (
                  <ul className="space-y-1">
                    {categorySkills.map((skill) => (
                      <li key={skill.id} className="text-sm text-gray-600">
                        {skill.name} - {skill.level}
                      </li>
                    ))}
                  </ul>
                ) : (
                  <p className="text-sm text-gray-400 italic">No skills in this category</p>
                )}
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default SkillsForm;
</file>

<file path="src/components/forms/WorkExperienceForm.jsx">
import React from 'react';
import { Briefcase, Plus, Trash2, Calendar, GripVertical, ChevronUp, ChevronDown } from 'lucide-react';

const WorkExperienceForm = ({ workExperience, onChange }) => {
  const addExperience = () => {
    const newExperience = {
      id: Date.now().toString(),
      company: '',
      position: '',
      startDate: '',
      endDate: '',
      isCurrentJob: false,
      description: '',
      achievements: []
    };
    onChange([...workExperience, newExperience]);
  };

  const updateExperience = (id, field, value) => {
    onChange(
      workExperience.map(exp =>
        exp.id === id ? { ...exp, [field]: value } : exp
      )
    );
  };

  const removeExperience = (id) => {
    onChange(workExperience.filter(exp => exp.id !== id));
  };

  // Move experience up/down
  const moveExperience = (index, direction) => {
    const newArray = [...workExperience];
    const targetIndex = direction === 'up' ? index - 1 : index + 1;
    
    if (targetIndex >= 0 && targetIndex < newArray.length) {
      [newArray[index], newArray[targetIndex]] = [newArray[targetIndex], newArray[index]];
      onChange(newArray);
    }
  };

  // Drag and drop handlers
  const handleDragStart = (e, index) => {
    e.dataTransfer.setData('text/plain', index);
    e.dataTransfer.effectAllowed = 'move';
  };

  const handleDragOver = (e) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
  };

  const handleDrop = (e, dropIndex) => {
    e.preventDefault();
    const dragIndex = parseInt(e.dataTransfer.getData('text/plain'));
    
    if (dragIndex !== dropIndex) {
      const newArray = [...workExperience];
      const draggedItem = newArray[dragIndex];
      newArray.splice(dragIndex, 1);
      newArray.splice(dropIndex, 0, draggedItem);
      onChange(newArray);
    }
  };

  const addAchievement = (id) => {
    const experience = workExperience.find(exp => exp.id === id);
    if (experience) {
      updateExperience(id, 'achievements', [...experience.achievements, '']);
    }
  };

  const updateAchievement = (expId, achievementIndex, value) => {
    const experience = workExperience.find(exp => exp.id === expId);
    if (experience) {
      const newAchievements = [...experience.achievements];
      newAchievements[achievementIndex] = value;
      updateExperience(expId, 'achievements', newAchievements);
    }
  };

  const removeAchievement = (expId, achievementIndex) => {
    const experience = workExperience.find(exp => exp.id === expId);
    if (experience) {
      const newAchievements = experience.achievements.filter((_, index) => index !== achievementIndex);
      updateExperience(expId, 'achievements', newAchievements);
    }
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold text-gray-800 flex items-center">
          <Briefcase className="w-5 h-5 mr-2 text-blue-600" />
          Work Experience
        </h3>
        <button
          onClick={addExperience}
          className="flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors"
        >
          <Plus className="w-4 h-4 mr-1" />
          Add Experience
        </button>
      </div>

      {workExperience.length === 0 ? (
        <div className="text-center py-8 text-gray-500">
          <Briefcase className="w-12 h-12 mx-auto mb-3 text-gray-300" />
          <p>No work experience added yet. Click "Add Experience" to get started.</p>
        </div>
      ) : (
        <div className="space-y-4">
          <div className="text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
            💡 <strong>Tip:</strong> Drag and drop experiences to reorder them, or use the arrow buttons. 
            Most recent experience should be at the top.
          </div>
          
          {workExperience.map((exp, index) => (
            <div 
              key={exp.id} 
              className="p-6 border border-gray-200 rounded-lg bg-gray-50 relative group"
              draggable
              onDragStart={(e) => handleDragStart(e, index)}
              onDragOver={handleDragOver}
              onDrop={(e) => handleDrop(e, index)}
            >
              {/* Drag Handle and Controls */}
              <div className="absolute left-2 top-6 flex flex-col items-center space-y-1">
                <GripVertical className="w-4 h-4 text-gray-400 cursor-move" title="Drag to reorder" />
                <div className="flex flex-col space-y-1">
                  <button
                    onClick={() => moveExperience(index, 'up')}
                    disabled={index === 0}
                    className={`p-1 rounded ${index === 0 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move up"
                  >
                    <ChevronUp className="w-3 h-3" />
                  </button>
                  <button
                    onClick={() => moveExperience(index, 'down')}
                    disabled={index === workExperience.length - 1}
                    className={`p-1 rounded ${index === workExperience.length - 1 ? 'text-gray-300 cursor-not-allowed' : 'text-gray-500 hover:text-blue-600 hover:bg-blue-100'}`}
                    title="Move down"
                  >
                    <ChevronDown className="w-3 h-3" />
                  </button>
                </div>
              </div>

              <div className="ml-8">
                <div className="flex items-center justify-between mb-4">
                  <div className="flex items-center space-x-2">
                    <h4 className="text-md font-medium text-gray-800">Experience #{index + 1}</h4>
                    <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">
                      Position {index + 1}
                    </span>
                  </div>
                  <button
                    onClick={() => removeExperience(exp.id)}
                    className="text-red-500 hover:text-red-700 transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Job Title *
                    </label>
                    <input
                      type="text"
                      value={exp.position}
                      onChange={(e) => updateExperience(exp.id, 'position', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Software Engineer"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      Company *
                    </label>
                    <input
                      type="text"
                      value={exp.company}
                      onChange={(e) => updateExperience(exp.id, 'company', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Tech Corp"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      <Calendar className="w-4 h-4 inline mr-1" />
                      Start Date *
                    </label>
                    <input
                      type="month"
                      value={exp.startDate}
                      onChange={(e) => updateExperience(exp.id, 'startDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      required
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      End Date
                    </label>
                    <input
                      type="month"
                      value={exp.endDate}
                      onChange={(e) => updateExperience(exp.id, 'endDate', e.target.value)}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      disabled={exp.isCurrentJob}
                    />
                    <div className="mt-2">
                      <label className="flex items-center">
                        <input
                          type="checkbox"
                          checked={exp.isCurrentJob}
                          onChange={(e) => {
                            updateExperience(exp.id, 'isCurrentJob', e.target.checked);
                            if (e.target.checked) {
                              updateExperience(exp.id, 'endDate', '');
                            }
                          }}
                          className="mr-2"
                        />
                        <span className="text-sm text-gray-700">Currently working here</span>
                      </label>
                    </div>
                  </div>
                </div>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Job Description *
                  </label>
                  <textarea
                    value={exp.description}
                    onChange={(e) => updateExperience(exp.id, 'description', e.target.value)}
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows={3}
                    placeholder="Describe your role and responsibilities..."
                    required
                  />
                </div>

                <div>
                  <div className="flex items-center justify-between mb-2">
                    <label className="block text-sm font-medium text-gray-700">
                      Key Achievements
                    </label>
                    <button
                      onClick={() => addAchievement(exp.id)}
                      className="text-blue-600 hover:text-blue-700 text-sm font-medium"
                    >
                      + Add Achievement
                    </button>
                  </div>
                  {exp.achievements.map((achievement, achievementIndex) => (
                    <div key={achievementIndex} className="flex items-center mb-2">
                      <input
                        type="text"
                        value={achievement}
                        onChange={(e) => updateAchievement(exp.id, achievementIndex, e.target.value)}
                        className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="Describe a key achievement..."
                      />
                      <button
                        onClick={() => removeAchievement(exp.id, achievementIndex)}
                        className="ml-2 text-red-500 hover:text-red-700"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};

export default WorkExperienceForm;
</file>

<file path="src/components/interview/ConnectionStatus.jsx">
import { useEffect, useState } from 'react';
import { Wifi, WifiOff, AlertTriangle } from 'lucide-react';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';
import { cn } from '@/lib/utils';

/**
 * ConnectionStatus component - Displays real-time connection quality
 * Requirements: 3.3, 8.5, 10.4
 */
const ConnectionStatus = ({ quality, metrics, className }) => {
  const [isVisible, setIsVisible] = useState(true);

  useEffect(() => {
    // Hide excellent quality after 5 seconds
    if (quality === 'excellent') {
      const timer = setTimeout(() => setIsVisible(false), 5000);
      return () => clearTimeout(timer);
    } else {
      setIsVisible(true);
    }
  }, [quality]);

  if (!isVisible && quality === 'excellent') {
    return null;
  }

  const getStatusConfig = () => {
    switch (quality) {
      case 'excellent':
        return {
          icon: Wifi,
          color: 'text-green-600',
          bgColor: 'bg-green-50',
          label: 'Tuyệt vời',
          description: 'Kết nối ổn định'
        };
      case 'good':
        return {
          icon: Wifi,
          color: 'text-blue-600',
          bgColor: 'bg-blue-50',
          label: 'Tốt',
          description: 'Kết nối ổn định'
        };
      case 'fair':
        return {
          icon: AlertTriangle,
          color: 'text-yellow-600',
          bgColor: 'bg-yellow-50',
          label: 'Trung bình',
          description: 'Chất lượng có thể giảm'
        };
      case 'poor':
        return {
          icon: WifiOff,
          color: 'text-red-600',
          bgColor: 'bg-red-50',
          label: 'Kém',
          description: 'Kết nối không ổn định'
        };
      default:
        return {
          icon: Wifi,
          color: 'text-gray-600',
          bgColor: 'bg-gray-50',
          label: 'Đang kiểm tra...',
          description: 'Đang đánh giá chất lượng'
        };
    }
  };

  const config = getStatusConfig();
  const Icon = config.icon;

  const tooltipContent = metrics ? (
    <div className="space-y-1 text-xs">
      <div className="font-semibold">{config.description}</div>
      {metrics.latency && (
        <div>Độ trễ: {metrics.latency}ms</div>
      )}
      {metrics.videoPacketLoss !== undefined && (
        <div>Mất gói video: {metrics.videoPacketLoss}</div>
      )}
      {metrics.audioPacketLoss !== undefined && (
        <div>Mất gói audio: {metrics.audioPacketLoss}</div>
      )}
      {metrics.videoBitrate && (
        <div>Bitrate: {Math.round(metrics.videoBitrate / 1000)}kbps</div>
      )}
      {metrics.fps && (
        <div>FPS: {metrics.fps}</div>
      )}
    </div>
  ) : (
    config.description
  );

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <div
            className={cn(
              'flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium transition-all',
              config.bgColor,
              config.color,
              className
            )}
          >
            <Icon className="h-4 w-4" />
            <span>{config.label}</span>
          </div>
        </TooltipTrigger>
        <TooltipContent>
          {tooltipContent}
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
};

export default ConnectionStatus;
</file>

<file path="src/components/interview/ErrorDialog.jsx">
import { AlertDialog, AlertDialogAction, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '@/components/ui/alert-dialog';
import { AlertTriangle, WifiOff, Camera, Mic, Video } from 'lucide-react';
import { getErrorMessage, getTroubleshootingSteps } from '@/utils/interviewErrorHandler';


const ErrorDialog = ({ open, errorCode, onClose, onAction }) => {
  const errorInfo = getErrorMessage(errorCode);
  const troubleshootingSteps = getTroubleshootingSteps(errorCode);

  const getErrorIcon = () => {
    if (errorCode?.includes('MEDIA_PERMISSION') || errorCode?.includes('DEVICE')) {
      return <Camera className="h-10 w-10 text-destructive" />;
    }
    if (errorCode?.includes('CONNECTION') || errorCode?.includes('SOCKET')) {
      return <WifiOff className="h-10 w-10 text-destructive" />;
    }
    if (errorCode?.includes('RECORDING')) {
      return <Video className="h-10 w-10 text-destructive" />;
    }
    return <AlertTriangle className="h-10 w-10 text-destructive" />;
  };

  return (
    <AlertDialog open={open} onOpenChange={onClose}>
      <AlertDialogContent className="max-w-md">
        <AlertDialogHeader>
          <div className="flex items-center gap-4 mb-4">
            {getErrorIcon()}
            <AlertDialogTitle className="text-xl">{errorInfo.title}</AlertDialogTitle>
          </div>
          <AlertDialogDescription className="text-base text-foreground">
            {errorInfo.message}
          </AlertDialogDescription>
        </AlertDialogHeader>

        {troubleshootingSteps.length > 0 && (
          <div className="mt-4 rounded-lg bg-muted p-4">
            <h4 className="font-semibold mb-2 text-sm">Hướng dẫn khắc phục:</h4>
            <ol className="list-decimal list-inside space-y-1 text-sm text-muted-foreground">
              {troubleshootingSteps.map((step, index) => (
                <li key={index}>{step}</li>
              ))}
            </ol>
          </div>
        )}

        <AlertDialogFooter>
          {errorInfo.actionUrl ? (
            <>
              <AlertDialogAction variant="outline" onClick={onClose}>
                Đóng
              </AlertDialogAction>
              <AlertDialogAction asChild>
                <a href={errorInfo.actionUrl} target="_blank" rel="noopener noreferrer">
                  {errorInfo.action}
                </a>
              </AlertDialogAction>
            </>
          ) : (
            <AlertDialogAction onClick={onAction || onClose}>
              {errorInfo.action}
            </AlertDialogAction>
          )}
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
};

export default ErrorDialog;
</file>

<file path="src/components/interview/PermissionGuard.jsx">
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Camera, Mic, AlertCircle } from 'lucide-react';
import { checkBrowserCompatibility, ERROR_CODES, getErrorMessage } from '@/utils/interviewErrorHandler';
import ErrorDialog from './ErrorDialog';

/**
 * PermissionGuard component - Checks and requests media permissions
 * Requirements: 6.1, 6.2, 10.1, 10.2, 10.3
 */
const PermissionGuard = ({ children, onPermissionsGranted }) => {
  const [permissionsChecked, setPermissionsChecked] = useState(false);
  const [permissionsGranted, setPermissionsGranted] = useState(false);
  const [error, setError] = useState(null);
  const [checking, setChecking] = useState(false);

  useEffect(() => {
    checkPermissions();
  }, []);

  const checkPermissions = async () => {
    setChecking(true);
    setError(null);

    try {
      // Check browser compatibility
      const compatibility = checkBrowserCompatibility();
      if (!compatibility.isCompatible) {
        setError(ERROR_CODES.WEBRTC_NOT_SUPPORTED);
        setChecking(false);
        return;
      }

      // Request permissions
      const stream = await navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true
      });

      // Stop all tracks immediately after permission check
      stream.getTracks().forEach(track => track.stop());

      setPermissionsGranted(true);
      setPermissionsChecked(true);
      onPermissionsGranted?.();
    } catch (err) {
      console.error('[PermissionGuard] Permission error:', err);
      
      if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
        setError(ERROR_CODES.MEDIA_PERMISSION_DENIED);
      } else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
        setError(ERROR_CODES.MEDIA_DEVICE_NOT_FOUND);
      } else {
        setError(ERROR_CODES.PEER_CONNECTION_FAILED);
      }
      
      setPermissionsChecked(true);
    } finally {
      setChecking(false);
    }
  };

  if (!permissionsChecked || checking) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <Card className="w-full max-w-md">
          <CardHeader>
            <CardTitle>Kiểm tra quyền truy cập</CardTitle>
            <CardDescription>
              Đang kiểm tra quyền truy cập camera và microphone...
            </CardDescription>
          </CardHeader>
          <CardContent className="flex justify-center py-8">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (!permissionsGranted && error) {
    const errorInfo = getErrorMessage(error);
    
    return (
      <>
        <div className="flex items-center justify-center min-h-screen p-4">
          <Card className="w-full max-w-md">
            <CardHeader>
              <div className="flex items-center gap-3 mb-2">
                <AlertCircle className="h-8 w-8 text-destructive" />
                <CardTitle>{errorInfo.title}</CardTitle>
              </div>
              <CardDescription className="text-base">
                {errorInfo.message}
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="flex items-center gap-4 p-4 bg-muted rounded-lg">
                <Camera className="h-6 w-6 text-muted-foreground" />
                <div className="flex-1">
                  <div className="font-medium">Camera</div>
                  <div className="text-sm text-muted-foreground">Cần để hiển thị video</div>
                </div>
              </div>
              <div className="flex items-center gap-4 p-4 bg-muted rounded-lg">
                <Mic className="h-6 w-6 text-muted-foreground" />
                <div className="flex-1">
                  <div className="font-medium">Microphone</div>
                  <div className="text-sm text-muted-foreground">Cần để truyền âm thanh</div>
                </div>
              </div>
              <Button onClick={checkPermissions} className="w-full">
                Thử lại
              </Button>
            </CardContent>
          </Card>
        </div>
        
        <ErrorDialog
          open={!!error}
          errorCode={error}
          onClose={() => setError(null)}
          onAction={checkPermissions}
        />
      </>
    );
  }

  return permissionsGranted ? children : null;
};

export default PermissionGuard;
</file>

<file path="src/components/interview/ReconnectionHandler.jsx">
import { useState, useEffect } from 'react';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { RefreshCw, WifiOff } from 'lucide-react';

/**
 * ReconnectionHandler - Displays reconnection status and allows manual retry
 * Requirements: 8.2, 8.3, 10.4
 */
const ReconnectionHandler = ({ 
  isReconnecting, 
  reconnectAttempt, 
  maxAttempts,
  onRetry 
}) => {
  const [countdown, setCountdown] = useState(5);

  useEffect(() => {
    if (isReconnecting) {
      setCountdown(5);
      const interval = setInterval(() => {
        setCountdown(prev => Math.max(0, prev - 1));
      }, 1000);
      return () => clearInterval(interval);
    }
  }, [isReconnecting, reconnectAttempt]);

  if (!isReconnecting) return null;

  return (
    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <Alert className="max-w-md bg-background">
        <div className="flex items-start gap-3">
          <WifiOff className="h-5 w-5 text-destructive mt-0.5" />
          <div className="flex-1 space-y-2">
            <h3 className="font-semibold text-lg">Mất kết nối</h3>
            <AlertDescription>
              Đang thử kết nối lại... (Lần {reconnectAttempt}/{maxAttempts})
            </AlertDescription>
            {countdown > 0 && (
              <div className="text-sm text-muted-foreground">
                Thử lại trong {countdown} giây
              </div>
            )}
            <div className="flex gap-2 pt-2">
              <Button 
                onClick={onRetry} 
                size="sm"
                className="w-full"
              >
                <RefreshCw className="h-4 w-4 mr-2" />
                Thử lại ngay
              </Button>
            </div>
          </div>
        </div>
      </Alert>
    </div>
  );
};

export default ReconnectionHandler;
</file>

<file path="src/components/interviews/ConnectionQualityIndicator.jsx">
import { Wifi, WifiOff, AlertTriangle, Signal } from 'lucide-react';
import { Badge } from '@/components/ui/badge';
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip';
import { cn } from '@/lib/utils';

const ConnectionQualityIndicator = ({ quality = 'good', details = null }) => {
  const getQualityConfig = () => {
    switch (quality) {
      case 'excellent':
        return {
          icon: Wifi,
          label: 'Kết nối xuất sắc',
          color: 'text-emerald-500',
          bgColor: 'bg-emerald-500/10',
          borderColor: 'border-emerald-500',
          description: 'Chất lượng kết nối rất tốt'
        };
      case 'good':
        return {
          icon: Wifi,
          label: 'Kết nối tốt',
          color: 'text-green-500',
          bgColor: 'bg-green-500/10',
          borderColor: 'border-green-500',
          description: 'Chất lượng kết nối ổn định'
        };
      case 'fair':
        return {
          icon: AlertTriangle,
          label: 'Kết nối trung bình',
          color: 'text-yellow-500',
          bgColor: 'bg-yellow-500/10',
          borderColor: 'border-yellow-500',
          description: 'Chất lượng kết nối có thể bị gián đoạn'
        };
      case 'poor':
        return {
          icon: WifiOff,
          label: 'Kết nối kém',
          color: 'text-red-500',
          bgColor: 'bg-red-500/10',
          borderColor: 'border-red-500',
          description: 'Chất lượng kết nối không ổn định. Hãy kiểm tra mạng của bạn.'
        };
      default:
        return {
          icon: Signal,
          label: 'Đang kiểm tra...',
          color: 'text-gray-500',
          bgColor: 'bg-gray-500/10',
          borderColor: 'border-gray-500',
          description: 'Đang kiểm tra chất lượng kết nối'
        };
    }
  };

  const config = getQualityConfig();
  const Icon = config.icon;

  const renderDetails = () => {
    if (!details) return null;

    return (
      <div className="space-y-1 text-xs">
        {details.latency && (
          <div className="flex justify-between">
            <span className="text-muted-foreground">Độ trễ:</span>
            <span className="font-medium">{details.latency} ms</span>
          </div>
        )}
        {details.fps && (
          <div className="flex justify-between">
            <span className="text-muted-foreground">FPS:</span>
            <span className="font-medium">{details.fps}</span>
          </div>
        )}
        {details.resolution && (
          <div className="flex justify-between">
            <span className="text-muted-foreground">Độ phân giải:</span>
            <span className="font-medium">{details.resolution}</span>
          </div>
        )}
        {details.videoBitrate && (
          <div className="flex justify-between">
            <span className="text-muted-foreground">Video bitrate:</span>
            <span className="font-medium">{details.videoBitrate} kbps</span>
          </div>
        )}
        {details.videoPacketLoss !== undefined && (
          <div className="flex justify-between">
            <span className="text-muted-foreground">Mất gói (video):</span>
            <span className="font-medium">{details.videoPacketLoss}%</span>
          </div>
        )}
        {details.audioPacketLoss !== undefined && (
          <div className="flex justify-between">
            <span className="text-muted-foreground">Mất gói (audio):</span>
            <span className="font-medium">{details.audioPacketLoss}%</span>
          </div>
        )}
      </div>
    );
  };

  return (
    <TooltipProvider>
      <Tooltip>
        <TooltipTrigger asChild>
          <Badge
            variant="outline"
            className={cn(
              'flex items-center gap-2 cursor-help',
              config.color,
              config.bgColor,
              config.borderColor
            )}
          >
            <Icon className="h-4 w-4" />
            <span className="text-xs font-medium">{config.label}</span>
          </Badge>
        </TooltipTrigger>
        <TooltipContent className="w-64">
          <div className="space-y-2">
            <p className="text-sm font-medium">{config.description}</p>
            {renderDetails()}
          </div>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  );
};

export default ConnectionQualityIndicator;
</file>

<file path="src/components/interviews/DeviceTest.jsx">
import { useState, useEffect, useRef } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import {
  Video,
  VideoOff,
  Mic,
  MicOff,
  Volume2,
  AlertCircle,
  CheckCircle2,
  XCircle,
  Loader2,
  HelpCircle
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';

/**
 * DeviceTest Component for Candidate
 * Allows candidates to test their camera, microphone, and speaker before joining interview
 */
const DeviceTest = ({ interviewId: propInterviewId, onComplete }) => {
  const navigate = useNavigate();
  const { interviewId: paramInterviewId } = useParams();
  const interviewId = propInterviewId || paramInterviewId;
  
  const videoRef = useRef(null);
  const audioContextRef = useRef(null);
  const analyserRef = useRef(null);
  const animationFrameRef = useRef(null);
  const testAudioRef = useRef(null);

  // Device lists
  const [videoDevices, setVideoDevices] = useState([]);
  const [audioDevices, setAudioDevices] = useState([]);
  const [audioOutputDevices, setAudioOutputDevices] = useState([]);
  
  // Selected devices
  const [selectedVideoDevice, setSelectedVideoDevice] = useState(undefined);
  const [selectedAudioDevice, setSelectedAudioDevice] = useState(undefined);
  const [selectedAudioOutput, setSelectedAudioOutput] = useState(undefined);
  
  // Device states
  const [isVideoEnabled, setIsVideoEnabled] = useState(true);
  const [isAudioEnabled, setIsAudioEnabled] = useState(true);
  const [audioLevel, setAudioLevel] = useState(0);
  
  // Speaker test
  const [isSpeakerTestPlaying, setIsSpeakerTestPlaying] = useState(false);
  
  // Stream
  const [localStream, setLocalStream] = useState(null);
  
  // Loading and error states
  const [isLoading, setIsLoading] = useState(true);
  const [permissionStatus, setPermissionStatus] = useState({
    camera: 'checking', // 'checking', 'granted', 'denied'
    microphone: 'checking'
  });
  
  // Browser compatibility
  const [browserCompatibility, setBrowserCompatibility] = useState({
    isCompatible: true,
    issues: []
  });

  // Check browser compatibility
  useEffect(() => {
    checkBrowserCompatibility();
  }, []);

  const checkBrowserCompatibility = () => {
    const issues = [];
    
    // Check for getUserMedia support
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      issues.push('Trình duyệt không hỗ trợ truy cập camera/microphone');
    }
    
    // Check for WebRTC support
    if (!window.RTCPeerConnection) {
      issues.push('Trình duyệt không hỗ trợ WebRTC');
    }
    
    // Check for secure context (HTTPS)
    if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
      issues.push('Yêu cầu kết nối HTTPS để sử dụng camera/microphone');
    }
    
    // Browser recommendations
    const userAgent = navigator.userAgent.toLowerCase();
    const isChrome = userAgent.includes('chrome') && !userAgent.includes('edge');
    const isFirefox = userAgent.includes('firefox');
    const isEdge = userAgent.includes('edge');
    const isSafari = userAgent.includes('safari') && !userAgent.includes('chrome');
    
    if (!isChrome && !isFirefox && !isEdge && !isSafari) {
      issues.push('Khuyến nghị sử dụng Chrome, Firefox, Edge hoặc Safari để có trải nghiệm tốt nhất');
    }
    
    setBrowserCompatibility({
      isCompatible: issues.length === 0 || issues.length === 1 && issues[0].includes('Khuyến nghị'),
      issues
    });
  };

  // Request permissions first, then get available devices
  useEffect(() => {
    const requestPermissionsAndGetDevices = async () => {
      try {
        setIsLoading(true);
        
        // Request permissions first to get full device list with labels
        const stream = await navigator.mediaDevices.getUserMedia({
          video: true,
          audio: true
        });
        
        // Stop the temporary stream immediately
        stream.getTracks().forEach(track => track.stop());
        
        // Now enumerate devices with permissions granted
        const devices = await navigator.mediaDevices.enumerateDevices();
        
        const videoInputs = devices.filter(device => device.kind === 'videoinput');
        const audioInputs = devices.filter(device => device.kind === 'audioinput');
        const audioOutputs = devices.filter(device => device.kind === 'audiooutput');
        
        setVideoDevices(videoInputs);
        setAudioDevices(audioInputs);
        setAudioOutputDevices(audioOutputs);
        
        // Set default devices
        if (videoInputs.length > 0 && !selectedVideoDevice) {
          setSelectedVideoDevice(videoInputs[0].deviceId);
        }
        if (audioInputs.length > 0 && !selectedAudioDevice) {
          setSelectedAudioDevice(audioInputs[0].deviceId);
        }
        if (audioOutputs.length > 0 && !selectedAudioOutput) {
          setSelectedAudioOutput(audioOutputs[0].deviceId);
        }
        
        setPermissionStatus({
          camera: 'granted',
          microphone: 'granted'
        });
        
        setIsLoading(false);
      } catch (error) {
        console.error('Error requesting permissions or enumerating devices:', error);
        
        // Handle specific errors
        if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
          setPermissionStatus({
            camera: 'denied',
            microphone: 'denied'
          });
          toast.error('Vui lòng cấp quyền truy cập camera và microphone để tiếp tục');
        } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
          toast.error('Không tìm thấy camera hoặc microphone. Vui lòng kiểm tra thiết bị của bạn.');
          setPermissionStatus({
            camera: 'denied',
            microphone: 'denied'
          });
        } else {
          toast.error('Không thể truy cập thiết bị: ' + error.message);
        }
        
        setIsLoading(false);
      }
    };

    requestPermissionsAndGetDevices();
  }, []);

  // Request permissions and start stream
  useEffect(() => {
    if (selectedVideoDevice && selectedAudioDevice) {
      startMediaStream();
    }
    
    return () => {
      stopMediaStream();
    };
  }, [selectedVideoDevice, selectedAudioDevice, isVideoEnabled, isAudioEnabled]);

  const startMediaStream = async () => {
    try {
      setIsLoading(true);
      
      // Stop existing stream
      stopMediaStream();
      
      const constraints = {
        video: isVideoEnabled ? {
          deviceId: selectedVideoDevice ? { exact: selectedVideoDevice } : undefined,
          width: { ideal: 1280 },
          height: { ideal: 720 }
        } : false,
        audio: isAudioEnabled ? {
          deviceId: selectedAudioDevice ? { exact: selectedAudioDevice } : undefined,
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        } : false
      };
      
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      
      setLocalStream(stream);
      
      // Set video element
      if (videoRef.current && isVideoEnabled) {
        videoRef.current.srcObject = stream;
      }
      
      // Setup audio level monitoring
      if (isAudioEnabled) {
        setupAudioMonitoring(stream);
      }
      
      // Update permission status
      setPermissionStatus({
        camera: isVideoEnabled ? 'granted' : 'checking',
        microphone: isAudioEnabled ? 'granted' : 'checking'
      });
      
      setIsLoading(false);
    } catch (error) {
      console.error('Error accessing media devices:', error);
      
      // Handle specific errors
      if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
        setPermissionStatus({
          camera: isVideoEnabled ? 'denied' : 'checking',
          microphone: isAudioEnabled ? 'denied' : 'checking'
        });
        toast.error('Vui lòng cấp quyền truy cập camera và microphone');
      } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
        toast.error('Không tìm thấy camera hoặc microphone');
      } else {
        toast.error('Không thể truy cập thiết bị: ' + error.message);
      }
      
      setIsLoading(false);
    }
  };

  const stopMediaStream = () => {
    if (localStream) {
      localStream.getTracks().forEach(track => track.stop());
      setLocalStream(null);
    }
    
    if (audioContextRef.current) {
      audioContextRef.current.close();
      audioContextRef.current = null;
    }
    
    if (animationFrameRef.current) {
      cancelAnimationFrame(animationFrameRef.current);
      animationFrameRef.current = null;
    }
  };

  const setupAudioMonitoring = (stream) => {
    try {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const analyser = audioContext.createAnalyser();
      const microphone = audioContext.createMediaStreamSource(stream);
      
      analyser.fftSize = 256;
      microphone.connect(analyser);
      
      audioContextRef.current = audioContext;
      analyserRef.current = analyser;
      
      updateAudioLevel();
    } catch (error) {
      console.error('Error setting up audio monitoring:', error);
    }
  };

  const updateAudioLevel = () => {
    if (!analyserRef.current) return;
    
    const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);
    analyserRef.current.getByteFrequencyData(dataArray);
    
    // Calculate average volume
    const average = dataArray.reduce((a, b) => a + b) / dataArray.length;
    const normalizedLevel = Math.min(100, (average / 255) * 100);
    
    setAudioLevel(normalizedLevel);
    
    animationFrameRef.current = requestAnimationFrame(updateAudioLevel);
  };

  const handleVideoDeviceChange = (deviceId) => {
    setSelectedVideoDevice(deviceId);
  };

  const handleAudioDeviceChange = (deviceId) => {
    setSelectedAudioDevice(deviceId);
  };

  const handleAudioOutputChange = async (deviceId) => {
    setSelectedAudioOutput(deviceId);
    
    // Update audio output for test audio if supported
    if (testAudioRef.current && typeof testAudioRef.current.setSinkId === 'function') {
      try {
        await testAudioRef.current.setSinkId(deviceId);
      } catch (error) {
        console.error('Error setting audio output device:', error);
      }
    }
  };

  const toggleVideo = () => {
    setIsVideoEnabled(prev => !prev);
  };

  const toggleAudio = () => {
    setIsAudioEnabled(prev => !prev);
  };

  const testSpeaker = () => {
    if (isSpeakerTestPlaying) {
      testAudioRef.current?.pause();
      setIsSpeakerTestPlaying(false);
    } else {
      // Play test audio (simple tone or notification sound)
      const audio = new Audio('https://onlinetestcase.com/wp-content/uploads/2023/06/100-KB-MP3.mp3'); // You'll need to add a test audio file
      testAudioRef.current = audio;
      
      // Set output device if supported
      if (selectedAudioOutput && typeof audio.setSinkId === 'function') {
        audio.setSinkId(selectedAudioOutput).catch(console.error);
      }
      
      audio.play().then(() => {
        setIsSpeakerTestPlaying(true);
      }).catch(() => {
        toast.error('Không thể phát âm thanh kiểm tra');
      });
      
      audio.onended = () => {
        setIsSpeakerTestPlaying(false);
      };
    }
  };

  const handleJoinInterview = () => {
    // Save device settings to localStorage
    const deviceSettings = {
      videoDeviceId: selectedVideoDevice,
      audioDeviceId: selectedAudioDevice,
      audioOutputDeviceId: selectedAudioOutput,
      isVideoEnabled,
      isAudioEnabled
    };
    localStorage.setItem('interviewDeviceSettings', JSON.stringify(deviceSettings));
    console.log('[DeviceTest] Saved device settings:', deviceSettings);
    
    if (onComplete) {
      onComplete(deviceSettings);
    } else if (interviewId) {
      navigate(`/interviews/${interviewId}/room`);
    } else {
      toast.error('Không tìm thấy ID phỏng vấn');
    }
  };

  const getPermissionIcon = (status) => {
    switch (status) {
      case 'granted':
        return <CheckCircle2 className="h-5 w-5 text-green-500" />;
      case 'denied':
        return <XCircle className="h-5 w-5 text-red-500" />;
      default:
        return <Loader2 className="h-5 w-5 animate-spin text-gray-500" />;
    }
  };

  const canJoinInterview = 
    permissionStatus.camera === 'granted' && 
    permissionStatus.microphone === 'granted' &&
    browserCompatibility.isCompatible;

  if (!browserCompatibility.isCompatible) {
    return (
      <div className="container max-w-4xl mx-auto p-6">
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-destructive">
              <XCircle className="h-6 w-6" />
              Trình duyệt không tương thích
            </CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <Alert variant="destructive">
              <AlertCircle className="h-4 w-4" />
              <AlertTitle>Không thể tham gia phỏng vấn</AlertTitle>
              <AlertDescription>
                <ul className="list-disc list-inside mt-2 space-y-1">
                  {browserCompatibility.issues.map((issue, index) => (
                    <li key={index}>{issue}</li>
                  ))}
                </ul>
              </AlertDescription>
            </Alert>
            
            <div className="space-y-2">
              <p className="font-semibold">Khuyến nghị:</p>
              <ul className="list-disc list-inside space-y-1 text-muted-foreground">
                <li>Sử dụng trình duyệt Chrome, Firefox, Edge hoặc Safari phiên bản mới nhất</li>
                <li>Đảm bảo kết nối HTTPS</li>
                <li>Cấp quyền truy cập camera và microphone</li>
              </ul>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="container max-w-4xl mx-auto p-6 space-y-6">
      {/* Header */}
      <div>
        <h1 className="text-3xl font-bold">Kiểm tra thiết bị</h1>
        <p className="text-muted-foreground mt-1">
          Vui lòng kiểm tra camera, microphone và loa của bạn trước khi tham gia phỏng vấn
        </p>
      </div>

      {/* Permission Status */}
      <Card>
        <CardHeader>
          <CardTitle className="text-lg">Trạng thái quyền truy cập</CardTitle>
        </CardHeader>
        <CardContent className="space-y-3">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <Video className="h-5 w-5 text-muted-foreground" />
              <span>Camera</span>
            </div>
            <div className="flex items-center gap-2">
              {getPermissionIcon(permissionStatus.camera)}
              <Badge variant={permissionStatus.camera === 'granted' ? 'success' : permissionStatus.camera === 'denied' ? 'destructive' : 'secondary'}>
                {permissionStatus.camera === 'granted' ? 'Đã cấp quyền' : permissionStatus.camera === 'denied' ? 'Bị từ chối' : 'Đang kiểm tra'}
              </Badge>
            </div>
          </div>
          
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <Mic className="h-5 w-5 text-muted-foreground" />
              <span>Microphone</span>
            </div>
            <div className="flex items-center gap-2">
              {getPermissionIcon(permissionStatus.microphone)}
              <Badge variant={permissionStatus.microphone === 'granted' ? 'success' : permissionStatus.microphone === 'denied' ? 'destructive' : 'secondary'}>
                {permissionStatus.microphone === 'granted' ? 'Đã cấp quyền' : permissionStatus.microphone === 'denied' ? 'Bị từ chối' : 'Đang kiểm tra'}
              </Badge>
            </div>
          </div>

          {(permissionStatus.camera === 'denied' || permissionStatus.microphone === 'denied') && (
            <Alert variant="destructive" className="mt-4">
              <AlertCircle className="h-4 w-4" />
              <AlertTitle>Quyền truy cập bị từ chối</AlertTitle>
              <AlertDescription>
                Vui lòng cấp quyền truy cập camera và microphone trong cài đặt trình duyệt để tham gia phỏng vấn.
                <br />
                <span className="text-sm">
                  Thường ở thanh địa chỉ, click vào biểu tượng khóa và chọn &quot;Cho phép&quot; cho camera và microphone.
                </span>
              </AlertDescription>
            </Alert>
          )}
        </CardContent>
      </Card>

      {/* Video Preview */}
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <CardTitle className="text-lg">Xem trước camera</CardTitle>
            <Button
              variant="outline"
              size="sm"
              onClick={toggleVideo}
            >
              {isVideoEnabled ? (
                <>
                  <VideoOff className="h-4 w-4 mr-2" />
                  Tắt camera
                </>
              ) : (
                <>
                  <Video className="h-4 w-4 mr-2" />
                  Bật camera
                </>
              )}
            </Button>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="relative aspect-video bg-gray-900 rounded-lg overflow-hidden">
            {isVideoEnabled ? (
              <>
                <video
                  ref={videoRef}
                  autoPlay
                  playsInline
                  muted
                  className="w-full h-full object-cover"
                />
                {isLoading && (
                  <div className="absolute inset-0 flex items-center justify-center bg-gray-900/50">
                    <Loader2 className="h-8 w-8 animate-spin text-white" />
                  </div>
                )}
              </>
            ) : (
              <div className="absolute inset-0 flex flex-col items-center justify-center text-white">
                <VideoOff className="h-12 w-12 mb-2" />
                <p>Camera đã tắt</p>
              </div>
            )}
          </div>

          {/* Camera Selection */}
          <div className="space-y-2">
            <Label htmlFor="video-device">Chọn camera</Label>
            <Select value={selectedVideoDevice} onValueChange={handleVideoDeviceChange}>
              <SelectTrigger id="video-device">
                <SelectValue placeholder="Chọn camera" />
              </SelectTrigger>
              <SelectContent>
                {videoDevices.filter(device => device.deviceId && device.deviceId.trim() !== '').map((device) => (
                  <SelectItem key={device.deviceId} value={device.deviceId}>
                    {device.label || `Camera ${videoDevices.indexOf(device) + 1}`}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </CardContent>
      </Card>

      {/* Microphone Test */}
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <CardTitle className="text-lg">Kiểm tra microphone</CardTitle>
            <Button
              variant="outline"
              size="sm"
              onClick={toggleAudio}
            >
              {isAudioEnabled ? (
                <>
                  <MicOff className="h-4 w-4 mr-2" />
                  Tắt micro
                </>
              ) : (
                <>
                  <Mic className="h-4 w-4 mr-2" />
                  Bật micro
                </>
              )}
            </Button>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* Audio Level Indicator */}
          {isAudioEnabled ? (
            <div className="space-y-2">
              <Label>Mức âm thanh</Label>
              <div className="flex items-center gap-3">
                <Mic className={cn(
                  "h-5 w-5",
                  audioLevel > 10 ? "text-green-500" : "text-muted-foreground"
                )} />
                <div className="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                  <div
                    className={cn(
                      "h-full transition-all duration-100",
                      audioLevel > 70 ? "bg-green-500" : audioLevel > 40 ? "bg-yellow-500" : "bg-red-500"
                    )}
                    style={{ width: `${audioLevel}%` }}
                  />
                </div>
                <span className="text-sm text-muted-foreground w-12">
                  {Math.round(audioLevel)}%
                </span>
              </div>
              <p className="text-sm text-muted-foreground">
                Hãy nói thử để kiểm tra microphone
              </p>
            </div>
          ) : (
            <div className="flex items-center justify-center py-8 text-muted-foreground">
              <div className="text-center">
                <MicOff className="h-8 w-8 mx-auto mb-2" />
                <p>Microphone đã tắt</p>
              </div>
            </div>
          )}

          {/* Microphone Selection */}
          <div className="space-y-2">
            <Label htmlFor="audio-device">Chọn microphone</Label>
            <Select value={selectedAudioDevice} onValueChange={handleAudioDeviceChange}>
              <SelectTrigger id="audio-device">
                <SelectValue placeholder="Chọn microphone" />
              </SelectTrigger>
              <SelectContent>
                {audioDevices.filter(device => device.deviceId && device.deviceId.trim() !== '').map((device) => (
                  <SelectItem key={device.deviceId} value={device.deviceId}>
                    {device.label || `Microphone ${audioDevices.indexOf(device) + 1}`}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </CardContent>
      </Card>

      {/* Speaker Test */}
      <Card>
        <CardHeader>
          <CardTitle className="text-lg">Kiểm tra loa</CardTitle>
          <CardDescription>
            Nhấn nút bên dưới để phát âm thanh kiểm tra
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <Button
            variant="outline"
            onClick={testSpeaker}
            className="w-full"
          >
            <Volume2 className="h-4 w-4 mr-2" />
            {isSpeakerTestPlaying ? 'Dừng kiểm tra' : 'Kiểm tra loa'}
          </Button>

          {/* Speaker Selection */}
          {audioOutputDevices.length > 0 && (
            <div className="space-y-2">
              <Label htmlFor="audio-output">Chọn loa</Label>
              <Select value={selectedAudioOutput} onValueChange={handleAudioOutputChange}>
                <SelectTrigger id="audio-output">
                  <SelectValue placeholder="Chọn loa" />
                </SelectTrigger>
                <SelectContent>
                  {audioOutputDevices.filter(device => device.deviceId && device.deviceId.trim() !== '').map((device) => (
                    <SelectItem key={device.deviceId} value={device.deviceId}>
                      {device.label || `Loa ${audioOutputDevices.indexOf(device) + 1}`}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Browser Compatibility Info */}
      {browserCompatibility.issues.length > 0 && (
        <Alert>
          <HelpCircle className="h-4 w-4" />
          <AlertTitle>Lưu ý</AlertTitle>
          <AlertDescription>
            <ul className="list-disc list-inside space-y-1">
              {browserCompatibility.issues.map((issue, index) => (
                <li key={index}>{issue}</li>
              ))}
            </ul>
          </AlertDescription>
        </Alert>
      )}

      <Separator />

      {/* Action Buttons */}
      <div className="flex justify-between items-center">
        <Button
          variant="outline"
          onClick={() => navigate(-1)}
        >
          Quay lại
        </Button>
        <Button
          onClick={handleJoinInterview}
          disabled={!canJoinInterview || isLoading}
          size="lg"
        >
          {isLoading ? (
            <>
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              Đang tải...
            </>
          ) : (
            <>
              <Video className="h-4 w-4 mr-2" />
              Tham gia phỏng vấn
            </>
          )}
        </Button>
      </div>
    </div>
  );
};

export default DeviceTest;
</file>

<file path="src/components/interviews/HelpPanel.jsx">
import { HelpCircle, X, AlertTriangle, Wifi, Video, Mic } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Separator } from '@/components/ui/separator';
import { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';

const HelpPanel = () => {
  const troubleshootingTips = [
    {
      id: 'connection',
      icon: Wifi,
      title: 'Sự cố kết nối mạng',
      problems: [
        {
          issue: 'Video bị giật, lag',
          solutions: [
            'Kiểm tra tốc độ mạng (tối thiểu 1.5 Mbps)',
            'Đóng các ứng dụng đang sử dụng băng thông',
            'Kết nối dây mạng thay vì WiFi nếu có thể',
            'Di chuyển gần router WiFi hơn'
          ]
        },
        {
          issue: 'Mất kết nối thường xuyên',
          solutions: [
            'Khởi động lại router/modem',
            'Kiểm tra các thiết bị khác có đang tải nặng không',
            'Tắt VPN nếu đang bật',
            'Thử chuyển sang mạng 4G/5G nếu có'
          ]
        }
      ]
    },
    {
      id: 'video',
      icon: Video,
      title: 'Sự cố camera',
      problems: [
        {
          issue: 'Không thấy hình ảnh camera',
          solutions: [
            'Kiểm tra camera có bị che hoặc tắt không',
            'Đảm bảo đã cấp quyền camera cho trình duyệt',
            'Kiểm tra camera có đang được ứng dụng khác sử dụng không',
            'Thử tải lại trang hoặc khởi động lại trình duyệt'
          ]
        },
        {
          issue: 'Hình ảnh camera bị tối hoặc mờ',
          solutions: [
            'Điều chỉnh ánh sáng trong phòng',
            'Lau ống kính camera',
            'Kiểm tra cài đặt camera trong hệ thống',
            'Thử sử dụng camera khác nếu có'
          ]
        }
      ]
    },
    {
      id: 'audio',
      icon: Mic,
      title: 'Sự cố âm thanh',
      problems: [
        {
          issue: 'Không nghe thấy nhà tuyển dụng',
          solutions: [
            'Kiểm tra âm lượng hệ thống và trình duyệt',
            'Thử đổi loa/tai nghe khác',
            'Kiểm tra loa có bị tắt tiếng không',
            'Nhấn F5 để tải lại trang'
          ]
        },
        {
          issue: 'Nhà tuyển dụng không nghe thấy tôi',
          solutions: [
            'Kiểm tra micro có bị tắt tiếng không',
            'Đảm bảo đã cấp quyền microphone cho trình duyệt',
            'Thử micro khác hoặc dùng tai nghe có micro',
            'Kiểm tra micro có đang được ứng dụng khác sử dụng không'
          ]
        },
        {
          issue: 'Tiếng vọng hoặc tạp âm',
          solutions: [
            'Sử dụng tai nghe thay vì loa',
            'Giảm âm lượng loa',
            'Di chuyển đến nơi yên tĩnh hơn',
            'Tắt các nguồn âm thanh khác trong phòng'
          ]
        }
      ]
    }
  ];

  const quickTips = [
    'Đảm bảo bạn ở nơi yên tĩnh, có ánh sáng tốt',
    'Kiểm tra camera và micro trước khi vào phỏng vấn',
    'Đóng các tab/ứng dụng không cần thiết',
    'Sử dụng tai nghe để tránh tiếng vọng',
    'Chuẩn bị giấy bút để ghi chú nếu cần',
    'Giữ kết nối mạng ổn định (dây mạng tốt hơn WiFi)',
    'Ngồi ở vị trí camera quay được cả người và mặt',
    'Mặc trang phục chỉnh chu như phỏng vấn trực tiếp'
  ];

  const emergencySteps = [
    {
      step: 1,
      title: 'Giữ bình tĩnh',
      description: 'Sự cố kỹ thuật có thể xảy ra. Hãy giữ bình tĩnh và xử lý từng bước.'
    },
    {
      step: 2,
      title: 'Thông báo cho nhà tuyển dụng',
      description: 'Sử dụng tính năng chat để thông báo vấn đề bạn đang gặp phải.'
    },
    {
      step: 3,
      title: 'Thử các giải pháp cơ bản',
      description: 'Tải lại trang (F5), kiểm tra kết nối mạng, khởi động lại trình duyệt.'
    },
    {
      step: 4,
      title: 'Liên hệ hỗ trợ',
      description: 'Nếu vấn đề vẫn tiếp diễn, liên hệ đội ngũ hỗ trợ kỹ thuật qua email hoặc hotline.'
    }
  ];

  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button variant="outline" size="icon" className="bg-gray-800 border-gray-700 text-white hover:bg-gray-700">
          <HelpCircle className="h-5 w-5" />
        </Button>
      </DialogTrigger>
      <DialogContent className="max-w-3xl max-h-[80vh]">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <HelpCircle className="h-5 w-5" />
            Trợ giúp & Khắc phục sự cố
          </DialogTitle>
          <DialogDescription>
            Hướng dẫn giải quyết các vấn đề thường gặp trong phỏng vấn trực tuyến
          </DialogDescription>
        </DialogHeader>

        <ScrollArea className="h-[60vh] pr-4">
          <div className="space-y-6">
            {/* Quick Tips */}
            <Card>
              <CardHeader>
                <CardTitle className="text-base">Mẹo để có buổi phỏng vấn tốt</CardTitle>
              </CardHeader>
              <CardContent>
                <ul className="space-y-2">
                  {quickTips.map((tip, index) => (
                    <li key={index} className="flex gap-2 text-sm">
                      <span className="text-blue-500 font-bold">•</span>
                      <span>{tip}</span>
                    </li>
                  ))}
                </ul>
              </CardContent>
            </Card>

            <Separator />

            {/* Troubleshooting */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg">Khắc phục sự cố</h3>
              
              {troubleshootingTips.map((category) => (
                <Card key={category.id}>
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2 text-base">
                      <category.icon className="h-5 w-5" />
                      {category.title}
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <Accordion type="single" collapsible className="w-full">
                      {category.problems.map((problem, idx) => (
                        <AccordionItem key={idx} value={`problem-${idx}`}>
                          <AccordionTrigger className="text-sm">
                            {problem.issue}
                          </AccordionTrigger>
                          <AccordionContent>
                            <div className="space-y-2">
                              <p className="text-sm font-medium text-muted-foreground">
                                Giải pháp:
                              </p>
                              <ol className="list-decimal list-inside space-y-1">
                                {problem.solutions.map((solution, sIdx) => (
                                  <li key={sIdx} className="text-sm">
                                    {solution}
                                  </li>
                                ))}
                              </ol>
                            </div>
                          </AccordionContent>
                        </AccordionItem>
                      ))}
                    </Accordion>
                  </CardContent>
                </Card>
              ))}
            </div>

            <Separator />

            {/* Emergency Steps */}
            <Card className="border-orange-200 bg-orange-50">
              <CardHeader>
                <CardTitle className="flex items-center gap-2 text-base text-orange-700">
                  <AlertTriangle className="h-5 w-5" />
                  Xử lý khi gặp sự cố nghiêm trọng
                </CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {emergencySteps.map((step) => (
                    <div key={step.step} className="flex gap-3">
                      <div className="flex-shrink-0 w-8 h-8 rounded-full bg-orange-600 text-white flex items-center justify-center font-bold text-sm">
                        {step.step}
                      </div>
                      <div>
                        <p className="font-semibold text-sm">{step.title}</p>
                        <p className="text-sm text-muted-foreground">{step.description}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>

            {/* Contact Support */}
            <Card>
              <CardHeader>
                <CardTitle className="text-base">Liên hệ hỗ trợ</CardTitle>
                <CardDescription>
                  Nếu bạn không thể tự khắc phục sự cố, hãy liên hệ với chúng tôi
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-2 text-sm">
                <p><strong>Email:</strong> support@careerzone.vn</p>
                <p><strong>Hotline:</strong> 1900-xxxx (8:00 - 22:00)</p>
                <p className="text-muted-foreground text-xs mt-4">
                  Lưu ý: Trong giờ phỏng vấn, thời gian phản hồi có thể lâu hơn. 
                  Hãy thử các bước khắc phục sự cố ở trên trước khi liên hệ.
                </p>
              </CardContent>
            </Card>
          </div>
        </ScrollArea>
      </DialogContent>
    </Dialog>
  );
};

export default HelpPanel;
</file>

<file path="src/components/interviews/InterviewInvitation.jsx">
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { 
  Calendar, 
  Clock, 
  MapPin, 
  Briefcase, 
  Check, 
  X, 
  Download,
  ExternalLink,
  Video,
  AlertCircle
} from 'lucide-react';
import { Button } from '../ui/button';
import { Card, CardContent, CardFooter, CardHeader } from '../ui/card';
import { Badge } from '../ui/badge';
import { 
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '../ui/alert-dialog';
import { Alert, AlertDescription } from '../ui/alert';
import { 
  acceptInterview, 
  declineInterview, 
  generateGoogleCalendarLink,
  downloadICSFile,
  formatInterviewTime
} from '../../services/interviewService';
import { toast } from 'sonner';

/**
 * InterviewInvitation Component
 * Displays interview invitation details with accept/decline actions
 * 
 * @param {Object} interview - Interview invitation object
 * @param {Function} onStatusChange - Callback when interview status changes
 */
export const InterviewInvitation = ({ interview, onStatusChange }) => {
  const navigate = useNavigate();
  const [isAccepting, setIsAccepting] = useState(false);
  const [isDeclining, setIsDeclining] = useState(false);
  const [showDeclineDialog, setShowDeclineDialog] = useState(false);
  const [showAcceptDialog, setShowAcceptDialog] = useState(false);

  const { date, time, relative, isPast } = formatInterviewTime(interview.scheduledTime);

  const handleAccept = async () => {
    setShowAcceptDialog(false);
    setIsAccepting(true);

    try {
      await acceptInterview(interview._id);
      toast.success('Interview invitation accepted!', {
        description: 'The interview has been added to your schedule.'
      });
      onStatusChange?.();
    } catch (error) {
      console.error('Failed to accept interview:', error);
      toast.error('Failed to accept invitation', {
        description: error.response?.data?.message || 'Please try again later.'
      });
    } finally {
      setIsAccepting(false);
    }
  };

  const handleDecline = async () => {
    setShowDeclineDialog(false);
    setIsDeclining(true);

    try {
      await declineInterview(interview._id, {
        reason: 'Candidate declined the invitation'
      });
      toast.success('Interview invitation declined', {
        description: 'The recruiter has been notified.'
      });
      onStatusChange?.();
    } catch (error) {
      console.error('Failed to decline interview:', error);
      toast.error('Failed to decline invitation', {
        description: error.response?.data?.message || 'Please try again later.'
      });
    } finally {
      setIsDeclining(false);
    }
  };

  const handleAddToGoogleCalendar = () => {
    const calendarLink = generateGoogleCalendarLink(interview);
    window.open(calendarLink, '_blank', 'noopener,noreferrer');
  };

  const handleDownloadICS = () => {
    try {
      downloadICSFile(interview);
      toast.success('Calendar file downloaded', {
        description: 'You can import this file to your calendar app.'
      });
    } catch (error) {
      console.error('Failed to download ICS file:', error);
      toast.error('Failed to download calendar file');
    }
  };

  const handleDeviceTest = () => {
    navigate('/interviews/device-test');
  };

  const jobSnapshot = interview.application?.jobSnapshot || {};

  return (
    <>
      <Card className="overflow-hidden hover:shadow-lg transition-shadow duration-300">
        <CardHeader className="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 pb-4">
          <div className="flex items-start justify-between">
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-2">
                <Badge variant="default" className="bg-blue-600">
                  New Invitation
                </Badge>
                {isPast && (
                  <Badge variant="destructive">
                    Expired
                  </Badge>
                )}
              </div>
              <h3 className="text-xl font-bold text-gray-900 dark:text-gray-100">
                {jobSnapshot.title || 'Interview Invitation'}
              </h3>
              <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
                {jobSnapshot.company || 'Company Name'}
              </p>
            </div>
            <Video className="w-8 h-8 text-blue-600" />
          </div>
        </CardHeader>

        <CardContent className="pt-6 space-y-4">
          {/* Interview Details */}
          <div className="space-y-3">
            <div className="flex items-center gap-3 text-gray-700 dark:text-gray-300">
              <Calendar className="w-5 h-5 text-blue-600 flex-shrink-0" />
              <div>
                <p className="font-medium">{date}</p>
                <p className="text-sm text-gray-500 dark:text-gray-400">{relative}</p>
              </div>
            </div>

            <div className="flex items-center gap-3 text-gray-700 dark:text-gray-300">
              <Clock className="w-5 h-5 text-blue-600 flex-shrink-0" />
              <div>
                <p className="font-medium">{time}</p>
                <p className="text-sm text-gray-500 dark:text-gray-400">
                  Duration: {interview.duration || 60} minutes
                </p>
              </div>
            </div>

            <div className="flex items-center gap-3 text-gray-700 dark:text-gray-300">
              <MapPin className="w-5 h-5 text-blue-600 flex-shrink-0" />
              <span>Online Video Interview</span>
            </div>
          </div>

          {/* Interview Notes */}
          {interview.notes && (
            <Alert>
              <AlertCircle className="h-4 w-4" />
              <AlertDescription>
                <strong>Notes from recruiter:</strong> {interview.notes}
              </AlertDescription>
            </Alert>
          )}

          {/* Calendar Integration */}
          <div className="border-t pt-4">
            <p className="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
              Add to your calendar:
            </p>
            <div className="flex flex-wrap gap-2">
              <Button
                variant="outline"
                size="sm"
                onClick={handleAddToGoogleCalendar}
                className="flex-1 min-w-[150px]"
              >
                <ExternalLink className="w-4 h-4 mr-2" />
                Google Calendar
              </Button>
              <Button
                variant="outline"
                size="sm"
                onClick={handleDownloadICS}
                className="flex-1 min-w-[150px]"
              >
                <Download className="w-4 h-4 mr-2" />
                Download .ics
              </Button>
            </div>
          </div>

          {/* Device Test Link */}
          <div className="border-t pt-4">
            <Button
              variant="link"
              onClick={handleDeviceTest}
              className="p-0 h-auto text-blue-600 hover:text-blue-700"
            >
              Test your camera and microphone before the interview →
            </Button>
          </div>
        </CardContent>

        <CardFooter className="bg-gray-50 dark:bg-gray-900/50 flex gap-3 pt-4">
          <Button
            variant="outline"
            size="lg"
            onClick={() => setShowDeclineDialog(true)}
            disabled={isAccepting || isDeclining || isPast}
            className="flex-1"
          >
            <X className="w-4 h-4 mr-2" />
            Decline
          </Button>
          <Button
            variant="default"
            size="lg"
            onClick={() => setShowAcceptDialog(true)}
            disabled={isAccepting || isDeclining || isPast}
            className="flex-1 bg-blue-600 hover:bg-blue-700"
          >
            {isAccepting ? (
              'Accepting...'
            ) : (
              <>
                <Check className="w-4 h-4 mr-2" />
                Accept Invitation
              </>
            )}
          </Button>
        </CardFooter>
      </Card>

      {/* Accept Confirmation Dialog */}
      <AlertDialog open={showAcceptDialog} onOpenChange={setShowAcceptDialog}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Accept Interview Invitation?</AlertDialogTitle>
            <AlertDialogDescription>
              You are about to accept the interview invitation for <strong>{jobSnapshot.title}</strong> at{' '}
              <strong>{jobSnapshot.company}</strong> scheduled on <strong>{date}</strong> at{' '}
              <strong>{time}</strong>.
              <br />
              <br />
              Please make sure you are available at this time. The recruiter will be notified of
              your acceptance.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Cancel</AlertDialogCancel>
            <AlertDialogAction onClick={handleAccept} className="bg-blue-600 hover:bg-blue-700">
              Confirm Accept
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Decline Confirmation Dialog */}
      <AlertDialog open={showDeclineDialog} onOpenChange={setShowDeclineDialog}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Decline Interview Invitation?</AlertDialogTitle>
            <AlertDialogDescription>
              Are you sure you want to decline the interview invitation for{' '}
              <strong>{jobSnapshot.title}</strong> at <strong>{jobSnapshot.company}</strong>?
              <br />
              <br />
              This action cannot be undone. The recruiter will be notified of your decision.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Cancel</AlertDialogCancel>
            <AlertDialogAction
              onClick={handleDecline}
              className="bg-red-600 hover:bg-red-700"
            >
              Confirm Decline
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  );
};

export default InterviewInvitation;
</file>

<file path="src/components/jobs/AutocompleteDropdown.jsx">
import React from 'react';
import { Clock, History, Search, X } from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * Helper function để format filters thành text hiển thị
 */
const formatFilters = (filters) => {
  if (!filters) return '';
  
  const parts = [];
  
  if (filters.category) parts.push(filters.category);
  if (filters.province) parts.push(filters.province);
  if (filters.type) parts.push(filters.type);
  if (filters.minSalary || filters.maxSalary) {
    const min = filters.minSalary || 0;
    const max = filters.maxSalary || '∞';
    parts.push(`${min} - ${max} triệu`);
  }
  
  return parts.join(' • ');
};

/**
 * AutocompleteDropdown Component
 * 
 * Component hiển thị cả history suggestions và autocomplete suggestions
 * Phân biệt rõ ràng giữa history và autocomplete bằng icons
 * 
 * @param {Object} props
 * @param {Array} props.historySuggestions - Mảng history suggestions từ lịch sử tìm kiếm
 * @param {Array} props.autocompleteSuggestions - Mảng autocomplete suggestions từ hệ thống
 * @param {function} props.onSuggestionClick - Handler khi click vào suggestion (item, isHistory)
 * @param {function} props.onDeleteHistory - Handler khi xóa history entry (event, entryId)
 */
const AutocompleteDropdown = ({
  historySuggestions = [],
  autocompleteSuggestions = [],
  onSuggestionClick,
  onDeleteHistory
}) => {
  const hasHistory = historySuggestions.length > 0;
  const hasAutocomplete = autocompleteSuggestions.length > 0;

  // Empty state - không có lịch sử và không có autocomplete
  if (!hasHistory && !hasAutocomplete) {
    return (
      <div className="absolute top-full left-0 right-0 mt-2 bg-background border border-border rounded-lg shadow-lg z-50">
        <div className="px-4 py-6">
          <div className="flex items-start space-x-3">
            <Clock className="h-5 w-5 text-muted-foreground flex-shrink-0" />
            <div className="space-y-1 flex-1">
              <p className="text-sm font-medium text-foreground">
                Chưa có lịch sử tìm kiếm
              </p>
              <p className="text-xs text-muted-foreground">
                Lịch sử tìm kiếm của bạn sẽ xuất hiện ở đây
              </p>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="absolute top-full left-0 right-0 mt-2 bg-background border border-border rounded-lg shadow-lg max-h-[400px] overflow-hidden z-50 animate-in fade-in-0 zoom-in-95 duration-200">
      {/* History Section */}
      {hasHistory && (
        <div className="dropdown-section">
          <div className="px-4 py-2 bg-muted/30 border-b border-border">
            <div className="flex items-center space-x-2 text-xs font-medium text-muted-foreground">
              <Clock className="h-3.5 w-3.5" />
              <span>Tìm kiếm gần đây</span>
            </div>
          </div>
          
          <div className="max-h-[180px] overflow-y-auto">
            {historySuggestions.map((item) => (
              <div
                key={item._id}
                className={cn(
                  "px-4 py-3 cursor-pointer transition-colors",
                  "hover:bg-muted/50 border-b border-border/50 last:border-b-0",
                  "group"
                )}
                onClick={() => onSuggestionClick(item, true)}
              >
                <div className="flex items-start justify-between gap-3">
                  <div className="flex items-start gap-3 flex-1 min-w-0">
                    <History className="h-4 w-4 text-muted-foreground flex-shrink-0 mt-0.5" />
                    <div className="flex-1 min-w-0">
                      <div className="text-sm font-medium text-foreground truncate">
                        {item.query || 'Tất cả việc làm'}
                      </div>
                      {formatFilters(item.filters) && (
                        <div className="text-xs text-muted-foreground mt-1 truncate">
                          {formatFilters(item.filters)}
                        </div>
                      )}
                    </div>
                  </div>
                  
                  <button
                    className={cn(
                      "flex-shrink-0 p-1 rounded hover:bg-destructive/10 transition-colors",
                      "opacity-0 group-hover:opacity-100"
                    )}
                    onClick={(e) => {
                      e.stopPropagation();
                      onDeleteHistory?.(e, item._id);
                    }}
                    aria-label="Xóa lịch sử"
                  >
                    <X className="h-3.5 w-3.5 text-muted-foreground hover:text-destructive" />
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Divider với label "Gợi ý khác" */}
      {hasHistory && hasAutocomplete && (
        <div className="px-4 py-2 bg-muted/20 border-y border-border">
          <div className="text-xs font-medium text-muted-foreground">
            Gợi ý khác
          </div>
        </div>
      )}

      {/* Autocomplete Section */}
      {hasAutocomplete && (
        <div className="dropdown-section">
          <div className="max-h-[180px] overflow-y-auto">
            {autocompleteSuggestions.map((item, index) => (
              <div
                key={`autocomplete-${index}`}
                className={cn(
                  "px-4 py-3 cursor-pointer transition-colors",
                  "hover:bg-muted/50 border-b border-border/50 last:border-b-0",
                  "flex items-center gap-3"
                )}
                onClick={() => onSuggestionClick(item, false)}
              >
                <Search className="h-4 w-4 text-muted-foreground flex-shrink-0" />
                <span className="text-sm text-foreground truncate">{item.title}</span>
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
};

export default AutocompleteDropdown;
</file>

<file path="src/components/jobs/JobAlertDialog.jsx">
import { useState, useEffect } from 'react';
import { useMutation } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { createJobAlert, updateJobAlert } from '@/services/jobAlertService';
import {
  FREQUENCY_OPTIONS,
  SALARY_RANGE_OPTIONS,
  JOB_TYPE_OPTIONS,
  WORK_TYPE_OPTIONS,
  EXPERIENCE_OPTIONS,
  CATEGORY_OPTIONS,
  NOTIFICATION_METHOD_OPTIONS,
} from '@/constants/jobAlertEnums';
import { provinceNames, locationMap } from '@/constants/locations';

const JobAlertDialog = ({ trigger, alert, open, onOpenChange, onSuccess }) => {
  const [isOpen, setIsOpen] = useState(open || false);
  const [formData, setFormData] = useState({
    keyword: '',
    location: {
      province: 'ALL',
      district: 'ALL',
    },
    frequency: 'weekly',
    salaryRange: 'ALL',
    type: 'ALL',
    workType: 'ALL',
    experience: 'ALL',
    category: 'ALL',
    notificationMethod: 'APPLICATION',
  });

  const [districts, setDistricts] = useState([]);

  useEffect(() => {
    if (open !== undefined) {
      setIsOpen(open);
    }
  }, [open]);

  useEffect(() => {
    if (alert) {
      setFormData({
        keyword: alert.keyword || '',
        location: alert.location || { province: 'ALL', district: 'ALL' },
        frequency: alert.frequency || 'weekly',
        salaryRange: alert.salaryRange || 'ALL',
        type: alert.type || 'ALL',
        workType: alert.workType || 'ALL',
        experience: alert.experience || 'ALL',
        category: alert.category || 'ALL',
        notificationMethod: alert.notificationMethod || 'APPLICATION',
      });
      
      // Load districts for selected province
      if (alert.location?.province && alert.location.province !== 'ALL') {
        const provinceData = locationMap.get(alert.location.province);
        if (provinceData) {
          setDistricts(provinceData.districts);
        }
      }
    }
  }, [alert]);

  const mutation = useMutation({
    mutationFn: (data) => {
      if (alert) {
        return updateJobAlert(alert._id, data);
      }
      return createJobAlert(data);
    },
    onSuccess: () => {
      toast.success(alert ? 'Cập nhật thông báo thành công' : 'Tạo thông báo thành công');
      handleClose();
      if (onSuccess) onSuccess();
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    },
  });

  const handleClose = () => {
    setIsOpen(false);
    if (onOpenChange) onOpenChange(false);
    if (!alert) {
      setFormData({
        keyword: '',
        location: { province: 'ALL', district: 'ALL' },
        frequency: 'weekly',
        salaryRange: 'ALL',
        type: 'ALL',
        workType: 'ALL',
        experience: 'ALL',
        category: 'ALL',
        notificationMethod: 'APPLICATION',
      });
    }
  };

  const handleProvinceChange = (province) => {
    setFormData(prev => ({
      ...prev,
      location: {
        province,
        district: 'ALL',
      },
    }));

    if (province === 'ALL') {
      setDistricts([]);
    } else {
      const provinceData = locationMap.get(province);
      if (provinceData) {
        setDistricts(provinceData.districts);
      }
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    mutation.mutate(formData);
  };

  const dialogContent = (
    <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
      <DialogHeader>
        <DialogTitle>{alert ? 'Chỉnh sửa thông báo' : 'Tạo thông báo việc làm'}</DialogTitle>
        <DialogDescription>
          Nhập tiêu chí để nhận thông báo khi có việc làm phù hợp
        </DialogDescription>
      </DialogHeader>
      <form onSubmit={handleSubmit} className="space-y-4">
        <div className="grid grid-cols-2 gap-4">
          {/* Keyword */}
          <div className="col-span-2">
            <Label htmlFor="keyword">Từ khóa (tùy chọn)</Label>
            <Input
              id="keyword"
              placeholder="VD: React Developer, Marketing Manager..."
              value={formData.keyword}
              onChange={(e) => setFormData(prev => ({ ...prev, keyword: e.target.value }))}
            />
          </div>

          {/* Province */}
          <div>
            <Label htmlFor="province">Tỉnh/Thành phố</Label>
            <Select value={formData.location.province} onValueChange={handleProvinceChange}>
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="ALL">Tất cả</SelectItem>
                {provinceNames.map((province) => (
                  <SelectItem key={province} value={province}>
                    {province}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* District */}
          <div>
            <Label htmlFor="district">Quận/Huyện</Label>
            <Select
              value={formData.location.district}
              onValueChange={(value) =>
                setFormData(prev => ({
                  ...prev,
                  location: { ...prev.location, district: value },
                }))
              }
              disabled={formData.location.province === 'ALL'}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="ALL">Tất cả</SelectItem>
                {districts.map((district) => (
                  <SelectItem key={district.name} value={district.name}>
                    {district.name}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Category */}
          <div>
            <Label htmlFor="category">Ngành nghề</Label>
            <Select
              value={formData.category}
              onValueChange={(value) => setFormData(prev => ({ ...prev, category: value }))}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {CATEGORY_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Experience */}
          <div>
            <Label htmlFor="experience">Kinh nghiệm</Label>
            <Select
              value={formData.experience}
              onValueChange={(value) => setFormData(prev => ({ ...prev, experience: value }))}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {EXPERIENCE_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Salary Range */}
          <div>
            <Label htmlFor="salaryRange">Mức lương</Label>
            <Select
              value={formData.salaryRange}
              onValueChange={(value) => setFormData(prev => ({ ...prev, salaryRange: value }))}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {SALARY_RANGE_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Job Type */}
          <div>
            <Label htmlFor="type">Loại hình công việc</Label>
            <Select
              value={formData.type}
              onValueChange={(value) => setFormData(prev => ({ ...prev, type: value }))}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {JOB_TYPE_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Work Type */}
          <div>
            <Label htmlFor="workType">Hình thức làm việc</Label>
            <Select
              value={formData.workType}
              onValueChange={(value) => setFormData(prev => ({ ...prev, workType: value }))}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {WORK_TYPE_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Frequency */}
          <div>
            <Label htmlFor="frequency">Tần suất nhận thông báo</Label>
            <Select
              value={formData.frequency}
              onValueChange={(value) => setFormData(prev => ({ ...prev, frequency: value }))}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {FREQUENCY_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Notification Method */}
          <div>
            <Label htmlFor="notificationMethod">Phương thức nhận</Label>
            <Select
              value={formData.notificationMethod}
              onValueChange={(value) => setFormData(prev => ({ ...prev, notificationMethod: value }))}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                {NOTIFICATION_METHOD_OPTIONS.map((option) => (
                  <SelectItem key={option.value} value={option.value}>
                    {option.label}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
        </div>

        <DialogFooter>
          <Button type="button" variant="outline" onClick={handleClose}>
            Hủy
          </Button>
          <Button type="submit" disabled={mutation.isPending} className="btn-gradient">
            {mutation.isPending ? 'Đang xử lý...' : alert ? 'Cập nhật' : 'Tạo thông báo'}
          </Button>
        </DialogFooter>
      </form>
    </DialogContent>
  );

  if (trigger) {
    return (
      <Dialog open={isOpen} onOpenChange={setIsOpen}>
        <DialogTrigger asChild>{trigger}</DialogTrigger>
        {dialogContent}
      </Dialog>
    );
  }

  return (
    <Dialog open={isOpen} onOpenChange={onOpenChange}>
      {dialogContent}
    </Dialog>
  );
};

export default JobAlertDialog;
</file>

<file path="src/components/jobs/JobMapDemo.jsx">
import React from 'react';
import { JobMapLeaflet } from './JobMapLeaflet';

/**
 * Component demo đơn giản để test nhanh tính năng bản đồ
 * Sử dụng: Import và render component này ở bất kỳ đâu
 */
export function JobMapDemo() {
  return (
    <div className="w-full h-screen p-4 bg-background">
      <div className="max-w-7xl mx-auto space-y-4">
        <div className="text-center space-y-2">
          <h1 className="text-3xl font-bold text-gradient-primary">
            🗺️ Demo: Tìm kiếm công việc trên Bản đồ
          </h1>
          <p className="text-muted-foreground">
            Di chuyển và zoom bản đồ để khám phá các công việc
          </p>
        </div>

        <div className="h-[calc(100vh-200px)] rounded-lg overflow-hidden shadow-2xl border border-border">
          <JobMapLeaflet 
            initialCenter={[10.762622, 106.660172]} // TP.HCM
            initialZoom={12}
          />
        </div>

        <div className="text-center text-sm text-muted-foreground">
          <p>💡 Tip: Phóng to để xem chi tiết từng công việc trong cụm</p>
        </div>
      </div>
    </div>
  );
}

export default JobMapDemo;
</file>

<file path="src/components/jobs/JobMapLeaflet.jsx">
import React, { useState, useEffect } from 'react';
import { MapContainer, TileLayer, Marker, Popup, useMapEvents } from 'react-leaflet';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import { useQuery } from '@tanstack/react-query';
import { getMapClusters } from '@/services/jobService';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';
import { useNavigate } from 'react-router-dom';

// Fix cho icon mặc định của Leaflet
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
});

// Component con để lấy bounds và zoom khi map thay đổi
function MapEventsHandler({ onBoundsChange }) {
  const map = useMapEvents({
    moveend: () => {
      const bounds = map.getBounds();
      const zoom = map.getZoom();
      onBoundsChange({
        sw_lat: bounds.getSouthWest().lat,
        sw_lng: bounds.getSouthWest().lng,
        ne_lat: bounds.getNorthEast().lat,
        ne_lng: bounds.getNorthEast().lng,
        zoom: zoom,
      });
    },
  });
  return null;
}

export function JobMapLeaflet({ filters = {}, initialCenter = [10.762622, 106.660172], initialZoom = 12 }) {
  const navigate = useNavigate();
  const [viewState, setViewState] = useState({
    sw_lat: 10.7,
    sw_lng: 106.6,
    ne_lat: 10.8,
    ne_lng: 106.7,
    zoom: initialZoom,
  });

  const { data, isLoading, isError, error, refetch } = useQuery({
    queryKey: ['mapClusters', viewState, filters],
    queryFn: () => getMapClusters({ ...viewState, ...filters }),
    keepPreviousData: true,
  });

  const handleBoundsChange = (newViewState) => {
    setViewState(newViewState);
  };

  // Custom icon cho cluster
  const createClusterIcon = (count) => {
    return L.divIcon({
      html: `<div class="marker-cluster-custom"><span>${count}</span></div>`,
      className: 'marker-cluster-wrapper',
      iconSize: [40, 40],
    });
  };

  const handleJobClick = (jobId) => {
    navigate(`/jobs/${jobId}`);
  };

  if (isError) {
    return (
      <ErrorState
        message={error?.response?.data?.message || 'Không thể tải dữ liệu bản đồ'}
        onRetry={refetch}
      />
    );
  }

  return (
    <div className="relative w-full h-full">
      {isLoading && (
        <div className="absolute top-4 left-1/2 transform -translate-x-1/2 z-[1000] bg-background/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-border">
          <p className="text-sm text-muted-foreground">Đang tải dữ liệu...</p>
        </div>
      )}

      <MapContainer
        center={initialCenter}
        zoom={initialZoom}
        style={{ height: '100%', width: '100%' }}
        className="rounded-lg"
      >
        <TileLayer
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        />
        <MapEventsHandler onBoundsChange={handleBoundsChange} />

        {data &&
          data.map((item, index) => {
            if (item.type === 'cluster') {
              // Đây là một cụm
              return (
                <Marker
                  key={`cluster-${index}`}
                  position={[item.coordinates[1], item.coordinates[0]]}
                  icon={createClusterIcon(item.count)}
                >
                  <Popup>
                    <div className="text-sm">
                      <p className="font-semibold">{item.count} công việc</p>
                      <p className="text-muted-foreground text-xs">Phóng to để xem chi tiết</p>
                    </div>
                  </Popup>
                </Marker>
              );
            } else {
              // Đây là một điểm đơn lẻ
              return (
                <Marker
                  key={item.job._id}
                  position={[item.coordinates[1], item.coordinates[0]]}
                >
                  <Popup>
                    <div className="min-w-[200px]">
                      <h3 className="font-semibold text-sm mb-1">{item.job.title}</h3>
                      <p className="text-xs text-muted-foreground mb-1">
                        {item.job.company?.name}
                      </p>
                      {(item.job.minSalary || item.job.maxSalary) && (
                        <p className="text-xs text-primary mb-2">
                          {item.job.minSalary && item.job.maxSalary
                            ? `${parseInt(item.job.minSalary).toLocaleString('vi-VN')} - ${parseInt(item.job.maxSalary).toLocaleString('vi-VN')} VNĐ`
                            : item.job.minSalary
                            ? `Từ ${parseInt(item.job.minSalary).toLocaleString('vi-VN')} VNĐ`
                            : `Lên đến ${parseInt(item.job.maxSalary).toLocaleString('vi-VN')} VNĐ`}
                        </p>
                      )}
                      <button
                        onClick={() => handleJobClick(item.job._id)}
                        className="text-xs bg-primary text-primary-foreground px-3 py-1 rounded hover:opacity-90 transition-opacity"
                      >
                        Xem chi tiết
                      </button>
                    </div>
                  </Popup>
                </Marker>
              );
            }
          })}
      </MapContainer>
    </div>
  );
}
</file>

<file path="src/components/jobs/SearchHistoryDropdown.jsx">
import React, { useRef, useEffect } from 'react';
import { Loader2, AlertCircle, Clock, History, Search, X } from 'lucide-react';
import { cn } from '@/lib/utils';
import SuggestionItem from '@/components/common/SuggestionItem';
import { Skeleton } from '@/components/ui/skeleton';

/**
 * Helper function to highlight matching text
 */
const highlightMatch = (text, query) => {
  if (!query || !text) return text;
  
  const regex = new RegExp(`(${query})`, 'gi');
  const parts = text.split(regex);
  
  return parts.map((part, index) => {
    if (part.toLowerCase() === query.toLowerCase()) {
      return (
        <span key={index} className="text-primary font-semibold">
          {part}
        </span>
      );
    }
    return part;
  });
};

/**
 * Component dropdown hiển thị cả history suggestions và autocomplete suggestions
 * 
 * @param {Object} props
 * @param {Array} props.historySuggestions - Mảng history suggestions
 * @param {Array} props.autocompleteSuggestions - Mảng autocomplete suggestions
 * @param {string} props.query - Query string hiện tại
 * @param {boolean} props.isLoading - Trạng thái loading
 * @param {string} props.error - Error message nếu có
 * @param {number} props.selectedIndex - Index của item được chọn
 * @param {boolean} props.isVisible - Có hiển thị dropdown không
 * @param {function} props.onSuggestionClick - Handler khi click suggestion
 * @param {function} props.onSuggestionHover - Handler khi hover suggestion
 * @param {function} props.onDeleteHistory - Handler khi xóa history entry
 * @param {function} props.onClose - Handler để đóng dropdown
 * @param {function} props.onRetry - Handler để retry khi có lỗi
 * @param {string} props.className - Additional CSS classes
 */
const SearchHistoryDropdown = ({
  historySuggestions = [],
  autocompleteSuggestions = [],
  query = '',
  isLoading = false,
  error = null,
  selectedIndex = -1,
  isVisible = false,
  onSuggestionClick,
  onSuggestionHover,
  onDeleteHistory,
  onClose,
  onRetry,
  className
}) => {
  const dropdownRef = useRef(null);

  const hasHistory = historySuggestions.length > 0;
  const hasAutocomplete = autocompleteSuggestions.length > 0;
  const totalSuggestions = historySuggestions.length + autocompleteSuggestions.length;

  /**
   * Đóng dropdown khi click outside
   */
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        onClose?.();
      }
    };

    if (isVisible) {
      document.addEventListener('mousedown', handleClickOutside);
      return () => {
        document.removeEventListener('mousedown', handleClickOutside);
      };
    }
  }, [isVisible, onClose]);

  /**
   * Auto scroll để đảm bảo selected item visible
   */
  useEffect(() => {
    if (selectedIndex >= 0 && dropdownRef.current) {
      const selectedElement = dropdownRef.current.querySelector(
        `[data-index="${selectedIndex}"]`
      );
      if (selectedElement) {
        selectedElement.scrollIntoView({
          block: 'nearest',
          behavior: 'smooth'
        });
      }
    }
  }, [selectedIndex]);

  // Không render nếu không visible
  if (!isVisible) return null;

  return (
    <div
      ref={dropdownRef}
      className={cn(
        "bg-background border border-border rounded-lg shadow-lg",
        "max-h-[500px] overflow-hidden",
        "animate-in fade-in-0 zoom-in-95 duration-200",
        "w-full",
        className
      )}
    >
      {/* Error State */}
      {error && (
        <div className="px-4 py-3 border-b border-border">
          <div className="flex items-start space-x-3">
            <AlertCircle className="h-4 w-4 text-destructive flex-shrink-0 mt-0.5" />
            <div className="space-y-1 flex-1">
              <p className="text-xs font-medium text-destructive">
                Không thể tải gợi ý
              </p>
              {onRetry && (
                <button
                  onClick={onRetry}
                  className="text-xs text-primary hover:text-primary/80 font-medium underline-offset-4 hover:underline"
                >
                  Thử lại
                </button>
              )}
            </div>
          </div>
        </div>
      )}

      {/* History Section */}
      {hasHistory && (
        <div className="dropdown-section">
          <div className="px-4 py-2 bg-muted/30 border-b border-border">
            <div className="flex items-center space-x-2 text-xs font-medium text-muted-foreground">
              <Clock className="h-3.5 w-3.5" />
              <span>Tìm kiếm gần đây</span>
            </div>
          </div>

          <div className="max-h-[300px] overflow-y-auto">
            {historySuggestions.map((item, index) => {
              // Safety check for item
              if (!item || !item._id) return null;
              
              return (
                <div
                  key={item._id}
                  data-index={index}
                  className={cn(
                    "px-4 py-3 cursor-pointer transition-colors",
                    "hover:bg-muted/50 border-b border-border/50 last:border-b-0",
                    "group",
                    selectedIndex === index && "bg-muted"
                  )}
                  onClick={() => onSuggestionClick(item, true)}
                  onMouseEnter={() => onSuggestionHover?.(index)}
                >
                  <div className="flex items-center justify-between gap-3">
                    <div className="flex items-center gap-3 flex-1 min-w-0">
                      <History className="h-4 w-4 text-muted-foreground flex-shrink-0" />
                      <div className="flex-1 min-w-0">
                        <div className="text-sm font-medium text-foreground text-left">
                          {highlightMatch(item.query || 'Tất cả việc làm', query)}
                        </div>
                      </div>
                    </div>

                    <button
                      className={cn(
                        "flex-shrink-0 p-1 rounded hover:bg-destructive/10 transition-colors",
                        "opacity-0 group-hover:opacity-100"
                      )}
                      onClick={(e) => {
                        e.stopPropagation();
                        onDeleteHistory?.(e, item._id);
                      }}
                      aria-label="Xóa lịch sử"
                    >
                      <X className="h-3.5 w-3.5 text-muted-foreground hover:text-destructive" />
                    </button>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      )}

      {/* Divider */}
      {hasHistory && hasAutocomplete && (
        <div className="px-4 py-2 bg-muted/20 border-y border-border">
          <div className="flex items-center space-x-2 text-xs font-medium text-muted-foreground">
            <Search className="h-3.5 w-3.5" />
            <span>Gợi ý khác</span>
          </div>
        </div>
      )}

      {/* Autocomplete Section */}
      {hasAutocomplete && (
        <div className="dropdown-section">
          <div className="max-h-[300px] overflow-y-auto">
            <ul role="listbox" aria-label="Gợi ý tiêu đề công việc" className="py-1">
              {autocompleteSuggestions.map((suggestion, index) => {
                const globalIndex = historySuggestions.length + index;
                return (
                  <div key={suggestion.title + index} data-index={globalIndex}>
                    <SuggestionItem
                      suggestion={suggestion}
                      query={query}
                      isSelected={globalIndex === selectedIndex}
                      onClick={() => onSuggestionClick(suggestion, false)}
                      onMouseEnter={() => onSuggestionHover?.(globalIndex)}
                      index={globalIndex}
                    />
                  </div>
                );
              })}
            </ul>
          </div>
        </div>
      )}

      {/* Loading State */}
      {isLoading && !hasHistory && !hasAutocomplete && (
        <div className="px-4 py-8 text-left">
          <div className="flex items-center space-x-2 text-muted-foreground">
            <Loader2 className="h-4 w-4 animate-spin" />
            <span className="text-sm">Đang tìm kiếm...</span>
          </div>

          <div className="mt-4 space-y-2">
            {[...Array(3)].map((_, index) => (
              <div key={index} className="px-4 py-3 flex items-center space-x-3">
                <Skeleton className="w-4 h-4 rounded" />
                <Skeleton className="h-4 flex-1" />
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Empty State */}
      {!isLoading && !error && !hasHistory && !hasAutocomplete && query.length === 0 && (
        <div className="px-4 py-6">
          <div className="flex items-start space-x-3">
            <Clock className="h-5 w-5 text-muted-foreground flex-shrink-0" />
            <div className="space-y-1 flex-1 text-left">
              <p className="text-sm font-medium text-foreground">
                Chưa có lịch sử tìm kiếm
              </p>
              <p className="text-xs text-muted-foreground">
                Lịch sử tìm kiếm của bạn sẽ xuất hiện ở đây
              </p>
            </div>
          </div>
        </div>
      )}

      {!isLoading && !error && !hasHistory && !hasAutocomplete && query.length > 0 && (
        <div className="px-4 py-6">
          <div className="flex items-start space-x-3">
            <div className="w-5 h-5 rounded-full bg-muted flex items-center justify-center flex-shrink-0 mt-0.5">
              <Search className="w-3 h-3 text-muted-foreground" />
            </div>
            <div className="space-y-1 flex-1 text-left">
              <p className="text-sm font-medium text-foreground">
                Không tìm thấy gợi ý nào
              </p>
              <p className="text-xs text-muted-foreground">
                Thử tìm kiếm với từ khóa khác
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Footer với keyboard shortcuts hint */}
      {totalSuggestions > 0 && (
        <div className="border-t border-border px-4 py-2 bg-muted/30">
          <div className="flex items-center justify-between text-xs text-muted-foreground">
            <span>
              <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">↑↓</kbd> điều hướng
            </span>
            <span>
              <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">Enter</kbd> chọn
            </span>
            <span>
              <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">Esc</kbd> đóng
            </span>
          </div>
        </div>
      )}
    </div>
  );
};

export default SearchHistoryDropdown;
</file>

<file path="src/components/layout/MainLayout.jsx">
import { Outlet } from 'react-router-dom';
import Header from './Header';
import Footer from './Footer';

const MainLayout = () => {
  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      <main className="grow">
        <Outlet />
      </main>
      <Footer />
    </div>
  );
};

export default MainLayout;
</file>

<file path="src/components/onboarding/LoadingState.jsx">
import { Skeleton } from '@/components/ui/skeleton';
import { Card, CardContent, CardHeader } from '@/components/ui/card';

export const LoadingState = ({ message = 'Đang tải...' }) => {
  return (
    <div className="space-y-6">
      <Card>
        <CardHeader>
          <Skeleton className="h-6 w-1/3" />
          <Skeleton className="h-4 w-2/3 mt-2" />
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="space-y-2">
            <Skeleton className="h-4 w-1/4" />
            <Skeleton className="h-10 w-full" />
          </div>
          <div className="space-y-2">
            <Skeleton className="h-4 w-1/4" />
            <Skeleton className="h-10 w-full" />
          </div>
          <div className="space-y-2">
            <Skeleton className="h-4 w-1/4" />
            <Skeleton className="h-10 w-full" />
          </div>
        </CardContent>
      </Card>
      {message && (
        <p className="text-center text-sm text-muted-foreground">{message}</p>
      )}
    </div>
  );
};

export const FormLoadingOverlay = () => {
  return (
    <div className="absolute inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50 rounded-lg">
      <div className="flex flex-col items-center gap-3">
        <div className="w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin" />
        <p className="text-sm text-muted-foreground">Đang xử lý...</p>
      </div>
    </div>
  );
};
</file>

<file path="src/components/onboarding/OnboardingBackground.jsx">
import { useEffect, useState } from 'react';

export const OnboardingBackground = () => {
  const [particles, setParticles] = useState([]);

  useEffect(() => {
    // Generate random particles for background animation
    const newParticles = Array.from({ length: 20 }, (_, i) => ({
      id: i,
      x: Math.random() * 100,
      y: Math.random() * 100,
      size: Math.random() * 4 + 2,
      duration: Math.random() * 20 + 10,
      delay: Math.random() * 5
    }));
    setParticles(newParticles);
  }, []);

  return (
    <div className="fixed inset-0 overflow-hidden pointer-events-none">
      {/* Gradient Background */}
      <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-background to-secondary/5" />
      
      {/* Animated Particles */}
      {particles.map((particle) => (
        <div
          key={particle.id}
          className="absolute rounded-full bg-primary/20 blur-xl"
          style={{
            left: `${particle.x}%`,
            top: `${particle.y}%`,
            width: `${particle.size}rem`,
            height: `${particle.size}rem`,
            animation: `float ${particle.duration}s ease-in-out infinite`,
            animationDelay: `${particle.delay}s`
          }}
        />
      ))}

      {/* Floating Shapes */}
      <div className="absolute top-20 left-10 w-32 h-32 bg-primary/10 rounded-full blur-3xl animate-pulse" />
      <div className="absolute bottom-20 right-10 w-40 h-40 bg-secondary/10 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '1s' }} />
      <div className="absolute top-1/2 left-1/4 w-24 h-24 bg-accent/10 rounded-full blur-2xl animate-pulse" style={{ animationDelay: '2s' }} />

      <style jsx>{`
        @keyframes float {
          0%, 100% {
            transform: translateY(0) translateX(0);
          }
          25% {
            transform: translateY(-20px) translateX(10px);
          }
          50% {
            transform: translateY(-10px) translateX(-10px);
          }
          75% {
            transform: translateY(-30px) translateX(5px);
          }
        }
      `}</style>
    </div>
  );
};
</file>

<file path="src/components/onboarding/OnboardingErrorBoundary.jsx">
import ErrorBoundary from '@/components/common/ErrorBoundary';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { AlertTriangle, Home, RefreshCw } from 'lucide-react';
import { useNavigate } from 'react-router-dom';

/**
 * Custom fallback UI for onboarding errors
 */
const OnboardingErrorFallback = ({ error, resetError }) => {
  const navigate = useNavigate();

  const handleGoToDashboard = () => {
    navigate('/dashboard');
  };

  const handleGoHome = () => {
    navigate('/');
  };

  return (
    <div className="min-h-screen flex items-center justify-center p-4 bg-background">
      <Card className="max-w-2xl w-full">
        <CardHeader>
          <div className="flex items-center gap-3">
            <div className="p-2 bg-destructive/10 rounded-full">
              <AlertTriangle className="w-6 h-6 text-destructive" />
            </div>
            <div>
              <CardTitle>Lỗi trong quá trình hoàn thiện hồ sơ</CardTitle>
              <CardDescription>
                Đã xảy ra lỗi khi hoàn thiện hồ sơ của bạn
              </CardDescription>
            </div>
          </div>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="text-sm text-muted-foreground space-y-2">
            <p>
              Chúng tôi rất xin lỗi vì sự bất tiện này. Tiến trình của bạn đã được lưu và bạn có thể:
            </p>
            <ul className="list-disc list-inside space-y-1 ml-2">
              <li>Thử lại để tiếp tục hoàn thiện hồ sơ</li>
              <li>Quay về dashboard và hoàn thiện sau</li>
              <li>Liên hệ hỗ trợ nếu lỗi vẫn tiếp diễn</li>
            </ul>
          </div>

          {/* Error Details (only in development) */}
          {process.env.NODE_ENV === 'development' && error && (
            <div className="p-3 bg-muted rounded-lg">
              <p className="text-xs font-mono text-destructive">
                {error.toString()}
              </p>
            </div>
          )}

          {/* Action Buttons */}
          <div className="flex flex-col sm:flex-row gap-3 pt-4">
            <Button
              onClick={resetError}
              className="flex-1"
              variant="default"
            >
              <RefreshCw className="w-4 h-4 mr-2" />
              Thử lại
            </Button>
            <Button
              onClick={handleGoToDashboard}
              className="flex-1"
              variant="outline"
            >
              Về Dashboard
            </Button>
            <Button
              onClick={handleGoHome}
              className="flex-1"
              variant="ghost"
            >
              <Home className="w-4 h-4 mr-2" />
              Trang chủ
            </Button>
          </div>

          {/* Help Text */}
          <div className="text-xs text-center text-muted-foreground pt-4 border-t">
            Tiến trình của bạn đã được lưu tự động. Bạn có thể quay lại bất cứ lúc nào.
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

/**
 * Error Boundary wrapper for onboarding flow
 */
export const OnboardingErrorBoundary = ({ children }) => {
  return (
    <ErrorBoundary
      fallback={OnboardingErrorFallback}
      context="OnboardingFlow"
      errorMessage="Lỗi trong quá trình hoàn thiện hồ sơ"
    >
      {children}
    </ErrorBoundary>
  );
};
</file>

<file path="src/components/onboarding/OnboardingLayout.jsx">
import { Progress } from '@/components/ui/progress';
import { Button } from '@/components/ui/button';
import { ChevronLeft, ChevronRight, X } from 'lucide-react';

const TOTAL_STEPS = 5;

const STEP_TITLES = {
  1: 'Thông tin cơ bản',
  2: 'Kinh nghiệm làm việc',
  3: 'Học vấn',
  4: 'Kỹ năng',
  5: 'Upload CV'
};

export const OnboardingLayout = ({ 
  children, 
  currentStep, 
  onNext, 
  onBack, 
  onSkip, 
  onSkipAll,
  isLastStep = false,
  isFirstStep = false,
  isLoading = false
}) => {
  const progress = (currentStep / TOTAL_STEPS) * 100;
  
  return (
    <div className="min-h-screen bg-background">
      {/* Header with progress */}
      <div className="sticky top-0 z-50 bg-card border-b shadow-sm">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h2 className="text-xl font-semibold text-foreground">
                Hoàn thiện hồ sơ ({currentStep}/{TOTAL_STEPS})
              </h2>
              <p className="text-sm text-muted-foreground mt-1">
                {STEP_TITLES[currentStep]}
              </p>
            </div>
            <Button
              variant="ghost"
              size="sm"
              onClick={onSkipAll}
              className="text-muted-foreground hover:text-foreground"
            >
              <X className="w-4 h-4 mr-1" />
              Bỏ qua tất cả
            </Button>
          </div>
          
          {/* Progress bar with step indicators */}
          <div className="space-y-2">
            <Progress value={progress} className="h-2" />
            <div className="flex justify-between text-xs text-muted-foreground">
              {[1, 2, 3, 4, 5].map((step) => (
                <div 
                  key={step} 
                  className={`flex-1 text-center ${
                    step === currentStep ? 'text-primary font-semibold' : ''
                  } ${
                    step < currentStep ? 'text-emerald-600' : ''
                  }`}
                >
                  {step}
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="container mx-auto px-4 py-8 pb-32">
        <div className="max-w-3xl mx-auto">
          {children}
        </div>
      </div>

      {/* Footer navigation - Fixed at bottom */}
      <div className="fixed bottom-0 left-0 right-0 bg-card border-t shadow-lg p-4 z-40">
        <div className="container mx-auto max-w-3xl">
          <div className="flex items-center justify-between gap-4">
            <Button
              variant="ghost"
              onClick={onSkip}
              disabled={isLoading}
              className="text-muted-foreground hover:text-foreground"
            >
              Bỏ qua bước này
            </Button>
            
            <div className="flex gap-2">
              {!isFirstStep && (
                <Button
                  variant="outline"
                  onClick={onBack}
                  disabled={isLoading}
                >
                  <ChevronLeft className="w-4 h-4 mr-1" />
                  Quay lại
                </Button>
              )}
              <Button 
                onClick={onNext}
                disabled={isLoading}
                className="min-w-[120px]"
              >
                {isLoading ? (
                  'Đang xử lý...'
                ) : isLastStep ? (
                  'Hoàn thành'
                ) : (
                  <>
                    Tiếp tục
                    <ChevronRight className="w-4 h-4 ml-1" />
                  </>
                )}
              </Button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="src/components/onboarding/OnboardingPreview.jsx">
/**
 * OnboardingPreview Component
 * 
 * Component này để preview thiết kế onboarding mới
 * Chỉ dùng cho development/testing
 */

import { useState } from 'react';
import { OnboardingBackground } from './OnboardingBackground';
import { Button } from '@/components/ui/button';
import { Progress } from '@/components/ui/progress';
import { ChevronLeft, X, Check } from 'lucide-react';

const PREVIEW_STEPS = [
    { id: 1, name: 'Thông tin cơ bản' },
    { id: 2, name: 'Kỹ năng & Kinh nghiệm' },
    { id: 3, name: 'Mức lương & Điều kiện' }
];

export const OnboardingPreview = () => {
    const [currentStep, setCurrentStep] = useState(1);
    const [isLoading, setIsLoading] = useState(false);

    const progress = (currentStep / PREVIEW_STEPS.length) * 100;
    const currentStepInfo = PREVIEW_STEPS[currentStep - 1];
    const isFirstStep = currentStep === 1;
    const isLastStep = currentStep === PREVIEW_STEPS.length;

    const handleNext = () => {
        if (currentStep < PREVIEW_STEPS.length) {
            setIsLoading(true);
            setTimeout(() => {
                setCurrentStep(currentStep + 1);
                setIsLoading(false);
            }, 500);
        }
    };

    const handleBack = () => {
        if (currentStep > 1) {
            setCurrentStep(currentStep - 1);
        }
    };

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 animate-in fade-in duration-300">
            {/* Animated Background */}
            <OnboardingBackground />

            {/* Backdrop - Blurred background */}
            <div className="absolute inset-0 bg-black/60 backdrop-blur-md" />

            {/* Modal Container */}
            <div className="relative w-full max-w-4xl max-h-[90vh] flex flex-col bg-card rounded-2xl shadow-2xl border border-border/50 animate-in zoom-in-95 duration-300">

                {/* Header with progress */}
                <div className="flex-shrink-0 px-8 pt-8 pb-6 border-b border-border/50">
                    <div className="flex items-start justify-between mb-6">
                        <div className="flex-1">
                            <div className="flex items-center gap-3 mb-2">
                                <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                                    <span className="text-lg font-bold text-primary">{currentStep}</span>
                                </div>
                                <div>
                                    <h2 className="text-2xl font-bold text-foreground">
                                        {currentStepInfo.name}
                                    </h2>
                                    <p className="text-sm text-muted-foreground mt-0.5">
                                        Bước {currentStep} / {PREVIEW_STEPS.length}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <Button
                            variant="ghost"
                            size="icon"
                            className="text-muted-foreground hover:text-foreground hover:bg-destructive/10 rounded-full"
                            title="Đóng và bỏ qua"
                        >
                            <X className="w-5 h-5" />
                        </Button>
                    </div>

                    {/* Progress bar with step indicators */}
                    <div className="space-y-3">
                        <div className="flex items-center gap-2">
                            {PREVIEW_STEPS.map((step, index) => (
                                <div key={step.id} className="flex items-center flex-1">
                                    <div className="flex-1 relative">
                                        <div className={`h-2 rounded-full transition-all duration-500 ${step.id < currentStep
                                            ? 'bg-emerald-500'
                                            : step.id === currentStep
                                                ? 'bg-primary'
                                                : 'bg-muted'
                                            }`}>
                                            {step.id === currentStep && (
                                                <div className="absolute inset-0 bg-primary rounded-full animate-pulse" />
                                            )}
                                        </div>
                                    </div>
                                    {index < PREVIEW_STEPS.length - 1 && (
                                        <div className="w-2" />
                                    )}
                                </div>
                            ))}
                        </div>
                        <div className="flex justify-between">
                            {PREVIEW_STEPS.map((step) => (
                                <div
                                    key={step.id}
                                    className={`flex-1 text-center text-xs font-medium transition-colors duration-300 ${step.id === currentStep
                                        ? 'text-primary'
                                        : step.id < currentStep
                                            ? 'text-emerald-600'
                                            : 'text-muted-foreground'
                                        }`}
                                >
                                    {step.name}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>

                {/* Content - Scrollable */}
                <div className="flex-1 overflow-y-auto px-8 py-6 custom-scrollbar">
                    <div className="animate-in slide-in-from-right-5 duration-300">
                        {/* Preview Content */}
                        <div className="space-y-6">
                            <div className="p-6 bg-muted/50 rounded-lg border border-border">
                                <h3 className="text-lg font-semibold mb-2">
                                    Preview: {currentStepInfo.name}
                                </h3>
                                <p className="text-muted-foreground mb-4">
                                    Đây là preview của giao diện onboarding mới với modal trung tâm và backdrop làm mờ.
                                </p>

                                {/* Sample Form Fields */}
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-sm font-medium mb-2 block">
                                            Trường mẫu 1
                                        </label>
                                        <input
                                            type="text"
                                            placeholder="Nhập thông tin..."
                                            className="w-full px-3 py-2 border rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="text-sm font-medium mb-2 block">
                                            Trường mẫu 2
                                        </label>
                                        <input
                                            type="text"
                                            placeholder="Nhập thông tin..."
                                            className="w-full px-3 py-2 border rounded-lg"
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Features List */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="p-4 bg-primary/5 rounded-lg border border-primary/20">
                                    <div className="flex items-center gap-2 mb-2">
                                        <Check className="w-5 h-5 text-primary" />
                                        <h4 className="font-semibold">Modal trung tâm</h4>
                                    </div>
                                    <p className="text-sm text-muted-foreground">
                                        Giao diện modal chuyên nghiệp, không chiếm toàn màn hình
                                    </p>
                                </div>
                                <div className="p-4 bg-primary/5 rounded-lg border border-primary/20">
                                    <div className="flex items-center gap-2 mb-2">
                                        <Check className="w-5 h-5 text-primary" />
                                        <h4 className="font-semibold">Backdrop làm mờ</h4>
                                    </div>
                                    <p className="text-sm text-muted-foreground">
                                        Background được làm mờ với hiệu ứng blur
                                    </p>
                                </div>
                                <div className="p-4 bg-primary/5 rounded-lg border border-primary/20">
                                    <div className="flex items-center gap-2 mb-2">
                                        <Check className="w-5 h-5 text-primary" />
                                        <h4 className="font-semibold">Animations mượt mà</h4>
                                    </div>
                                    <p className="text-sm text-muted-foreground">
                                        Chuyển động và hiệu ứng được tối ưu
                                    </p>
                                </div>
                                <div className="p-4 bg-primary/5 rounded-lg border border-primary/20">
                                    <div className="flex items-center gap-2 mb-2">
                                        <Check className="w-5 h-5 text-primary" />
                                        <h4 className="font-semibold">Responsive</h4>
                                    </div>
                                    <p className="text-sm text-muted-foreground">
                                        Hoạt động tốt trên mọi thiết bị
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Footer navigation */}
                <div className="flex-shrink-0 px-8 py-6 border-t border-border/50 bg-muted/30">
                    <div className="flex items-center justify-between gap-4">
                        {/* Left: Back button */}
                        <Button
                            variant="outline"
                            onClick={handleBack}
                            disabled={isLoading || isFirstStep}
                            className="min-w-[120px]"
                        >
                            <ChevronLeft className="w-4 h-4 mr-1" />
                            Quay lại
                        </Button>

                        {/* Right: Skip and Continue buttons */}
                        <div className="flex gap-3">
                            <Button
                                variant="ghost"
                                disabled={isLoading}
                                className="text-muted-foreground hover:text-foreground"
                            >
                                Bỏ qua bước này
                            </Button>
                            <Button
                                onClick={handleNext}
                                disabled={isLoading || isLastStep}
                                className="min-w-[140px] bg-primary hover:bg-primary/90 shadow-lg shadow-primary/25"
                            >
                                {isLoading ? (
                                    <span className="flex items-center gap-2">
                                        <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                                        Đang xử lý...
                                    </span>
                                ) : isLastStep ? (
                                    'Hoàn thành'
                                ) : (
                                    'Tiếp tục'
                                )}
                            </Button>
                        </div>
                    </div>
                </div>
            </div>

            {/* Custom scrollbar styles */}
            <style jsx>{`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: hsl(var(--muted-foreground) / 0.3);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: hsl(var(--muted-foreground) / 0.5);
        }
      `}</style>
        </div>
    );
};
</file>

<file path="src/components/onboarding/ProfileCompletenessBar.jsx">
import { useQuery } from '@tanstack/react-query';
import { Progress } from '@/components/ui/progress';
import { Card, CardContent } from '@/components/ui/card';
import { CheckCircle2, AlertCircle } from 'lucide-react';
import { cn } from '@/lib/utils';
import apiClient from '@/services/apiClient';

const getProfileCompleteness = async () => {
  const response = await apiClient.get('/candidate/profile/completeness');
  return response.data;
};

export const ProfileCompletenessBar = ({ className, showDetails = true }) => {
  const { data, isLoading } = useQuery({
    queryKey: ['profileCompleteness'],
    queryFn: getProfileCompleteness,
    staleTime: 2 * 60 * 1000, // 2 minutes
    refetchOnWindowFocus: true
  });

  if (isLoading) {
    return (
      <Card className={cn('animate-pulse', className)}>
        <CardContent className="p-4">
          <div className="h-4 bg-muted rounded w-1/3 mb-2" />
          <div className="h-2 bg-muted rounded" />
        </CardContent>
      </Card>
    );
  }

  const completeness = data?.completeness || 0;
  const missingFields = data?.missingFields || [];
  const recommendations = data?.recommendations || [];

  const getCompletenessColor = (percentage) => {
    if (percentage >= 80) return 'text-emerald-600';
    if (percentage >= 60) return 'text-amber-600';
    return 'text-red-600';
  };

  const getProgressColor = (percentage) => {
    if (percentage >= 80) return 'bg-emerald-600';
    if (percentage >= 60) return 'bg-amber-600';
    return 'bg-red-600';
  };

  return (
    <Card className={className}>
      <CardContent className="p-4">
        <div className="flex items-center justify-between mb-2">
          <h3 className="text-sm font-semibold text-foreground">
            Độ hoàn thiện hồ sơ
          </h3>
          <span className={cn('text-lg font-bold', getCompletenessColor(completeness))}>
            {completeness}%
          </span>
        </div>

        <div className="relative">
          <Progress value={completeness} className="h-2" />
          <div
            className={cn(
              'absolute top-0 left-0 h-2 rounded-full transition-all',
              getProgressColor(completeness)
            )}
            style={{ width: `${completeness}%` }}
          />
        </div>

        {showDetails && (
          <div className="mt-4 space-y-3">
            {completeness >= 60 ? (
              <div className="flex items-start gap-2 text-sm text-emerald-700 dark:text-emerald-400">
                <CheckCircle2 className="w-4 h-4 mt-0.5 flex-shrink-0" />
                <p>
                  Hồ sơ của bạn đã đủ để nhận gợi ý việc làm!
                </p>
              </div>
            ) : (
              <div className="flex items-start gap-2 text-sm text-amber-700 dark:text-amber-400">
                <AlertCircle className="w-4 h-4 mt-0.5 flex-shrink-0" />
                <p>
                  Hoàn thiện thêm {60 - completeness}% để nhận gợi ý việc làm phù hợp
                </p>
              </div>
            )}

            {missingFields.length > 0 && (
              <div className="bg-muted rounded-lg p-3">
                <p className="text-xs font-medium text-muted-foreground mb-2">
                  Thông tin còn thiếu:
                </p>
                <ul className="space-y-1">
                  {missingFields.slice(0, 3).map((field, index) => (
                    <li key={index} className="text-xs text-foreground flex items-center gap-2">
                      <span className="w-1 h-1 rounded-full bg-primary" />
                      {field}
                    </li>
                  ))}
                  {missingFields.length > 3 && (
                    <li className="text-xs text-muted-foreground">
                      và {missingFields.length - 3} thông tin khác...
                    </li>
                  )}
                </ul>
              </div>
            )}

            {recommendations.length > 0 && (
              <div className="text-xs text-muted-foreground">
                <p className="font-medium mb-1">Gợi ý:</p>
                <p>{recommendations[0]}</p>
              </div>
            )}
          </div>
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/onboarding/ProgressIndicator.jsx">
import { Check } from 'lucide-react';
import { cn } from '@/lib/utils';

export const ProgressIndicator = ({ 
  currentStep, 
  totalSteps, 
  stepLabels = [],
  completedSteps = [] 
}) => {
  return (
    <div className="w-full">
      <div className="flex items-center justify-between">
        {Array.from({ length: totalSteps }, (_, index) => {
          const stepNumber = index + 1;
          const isCompleted = completedSteps.includes(stepNumber) || stepNumber < currentStep;
          const isCurrent = stepNumber === currentStep;
          const isUpcoming = stepNumber > currentStep;

          return (
            <div key={stepNumber} className="flex items-center flex-1">
              {/* Step circle */}
              <div className="flex flex-col items-center">
                <div
                  className={cn(
                    'w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-all',
                    isCompleted && 'bg-emerald-600 text-white',
                    isCurrent && 'bg-primary text-primary-foreground ring-4 ring-primary/20',
                    isUpcoming && 'bg-muted text-muted-foreground'
                  )}
                >
                  {isCompleted ? (
                    <Check className="w-5 h-5" />
                  ) : (
                    <span>{stepNumber}</span>
                  )}
                </div>
                {stepLabels[index] && (
                  <p
                    className={cn(
                      'text-xs mt-2 text-center max-w-[100px] transition-colors',
                      isCurrent && 'text-primary font-semibold',
                      isCompleted && 'text-emerald-600',
                      isUpcoming && 'text-muted-foreground'
                    )}
                  >
                    {stepLabels[index]}
                  </p>
                )}
              </div>

              {/* Connector line */}
              {stepNumber < totalSteps && (
                <div
                  className={cn(
                    'flex-1 h-1 mx-2 transition-colors',
                    isCompleted ? 'bg-emerald-600' : 'bg-muted'
                  )}
                />
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
};
</file>

<file path="src/components/onboarding/README.md">
# Onboarding UI Redesign

## Tổng quan

Giao diện onboarding đã được thiết kế lại hoàn toàn với phong cách chuyên nghiệp, hiện đại và trải nghiệm người dùng tốt hơn.

## Các thay đổi chính

### 1. Modal trung tâm thay vì Full-screen
- Onboarding hiện được hiển thị dưới dạng modal trung tâm màn hình
- Kích thước tối ưu: `max-w-4xl` với chiều cao tối đa `90vh`
- Responsive trên mọi thiết bị

### 2. Backdrop làm mờ (Blur Effect)
- Background được làm mờ với `backdrop-blur-md`
- Overlay màu đen với độ trong suốt 60% (`bg-black/60`)
- Click vào backdrop để đóng modal (với xác nhận)

### 3. Animated Background
- Component `OnboardingBackground` với particles động
- Gradient background chuyển màu mượt mà
- Floating shapes với animation pulse

### 4. Cải tiến UI/UX

#### Header
- Icon step number trong vòng tròn
- Progress bar với animation mượt mà
- Hiển thị tên từng bước rõ ràng
- Nút đóng (X) ở góc phải

#### Content Area
- Scrollable với custom scrollbar
- Animation slide-in khi chuyển step
- Padding và spacing tối ưu

#### Footer
- Fixed ở bottom của modal
- Glassmorphism effect (`bg-muted/30 backdrop-blur-sm`)
- Buttons với shadow và hover effects
- Loading state với spinner animation

### 5. Form Integration
- Forms trong các step không còn button submit riêng
- Submit được trigger từ footer button của modal
- Validation với error messages thân thiện bằng tiếng Việt
- Technical errors được chuyển đổi thành messages dễ hiểu

### 6. Skip Functionality
- Skip step: Chuyển sang bước tiếp theo ngay lập tức (không có popup xác nhận)
- Skip all: Hoàn thành onboarding và chuyển đến dashboard
- Toast notification thông báo khi skip

## Components mới

### OnboardingBackground.jsx
```jsx
<OnboardingBackground />
```
- Tạo animated background với particles
- Gradient và floating shapes
- Pure visual component, không ảnh hưởng logic

### onboarding.css
- Custom animations (float, fadeIn, slideIn, zoomIn)
- Custom scrollbar styles
- Glassmorphism effects
- Accessibility focus styles

## Cách sử dụng

Không cần thay đổi code khi sử dụng. Component `OnboardingWrapper` vẫn giữ nguyên API:

```jsx
<OnboardingWrapper onComplete={handleComplete}>
  {renderStep}
</OnboardingWrapper>
```

## Responsive Design

- Desktop: Modal rộng với padding lớn
- Tablet: Modal thu nhỏ, padding vừa phải
- Mobile: Modal full-width với padding nhỏ, vẫn giữ border radius

## Accessibility

- Keyboard navigation được hỗ trợ đầy đủ
- Focus styles rõ ràng
- ARIA labels cho các interactive elements
- Screen reader friendly

## Performance

- Animations sử dụng CSS transforms (GPU accelerated)
- Lazy loading cho background particles
- Optimized re-renders với React.memo (nếu cần)

## Browser Support

- Chrome/Edge: Full support
- Firefox: Full support
- Safari: Full support (với -webkit- prefixes)
- Mobile browsers: Full support

## Customization

### Thay đổi màu sắc
Sửa trong Tailwind config hoặc CSS variables:
```css
--primary: ...
--secondary: ...
--muted: ...
```

### Thay đổi animations
Sửa trong `fe/src/styles/onboarding.css`:
```css
@keyframes float {
  /* Custom animation */
}
```

### Thay đổi kích thước modal
Sửa trong `OnboardingWrapper.jsx`:
```jsx
<div className="relative w-full max-w-4xl max-h-[90vh]">
```

## Testing

Đã test trên:
- ✅ Chrome (Windows/Mac)
- ✅ Firefox (Windows/Mac)
- ✅ Safari (Mac/iOS)
- ✅ Edge (Windows)
- ✅ Mobile Chrome (Android)
- ✅ Mobile Safari (iOS)

## Known Issues

Không có issues đã biết. Nếu phát hiện bug, vui lòng báo cáo.

## Future Improvements

- [ ] Thêm confetti animation khi hoàn thành
- [ ] Progress save indicator
- [ ] Keyboard shortcuts (Ctrl+Enter để submit)
- [ ] Dark mode optimization
- [ ] A/B testing với design cũ
</file>

<file path="src/components/onboarding/steps/CertificatesProjectsStep.jsx">
import { useForm, useFieldArray } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Plus, X, Award, Code, Linkedin, Github, Globe } from 'lucide-react';
import { certificatesProjectsSchema } from '@/schemas/onboardingSchemas';
import { InlineError } from '../ErrorState';

export const CertificatesProjectsStep = ({ initialData = {}, onNext, isLoading, onLoadingChange }) => {
  const {
    register,
    handleSubmit,
    control,
    formState: { errors }
  } = useForm({
    resolver: zodResolver(certificatesProjectsSchema),
    defaultValues: {
      certificates: initialData.certificates || [],
      projects: initialData.projects || [],
      linkedin: initialData.linkedin || '',
      github: initialData.github || '',
      website: initialData.website || ''
    }
  });

  const { fields: certificateFields, append: appendCertificate, remove: removeCertificate } = useFieldArray({
    control,
    name: 'certificates'
  });

  const { fields: projectFields, append: appendProject, remove: removeProject } = useFieldArray({
    control,
    name: 'projects'
  });

  const onSubmit = (data) => {
    onNext(data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* Certificates */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Award className="w-5 h-5" />
            Chứng chỉ chuyên môn
          </CardTitle>
          <CardDescription>
            Thêm các chứng chỉ, giấy chứng nhận của bạn (không bắt buộc)
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {certificateFields.map((field, index) => (
            <div key={field.id} className="p-4 border rounded-lg space-y-4">
              <div className="flex justify-between items-start">
                <h4 className="font-medium">Chứng chỉ {index + 1}</h4>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => removeCertificate(index)}
                >
                  <X className="w-4 h-4" />
                </Button>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label>Tên chứng chỉ *</Label>
                  <Input
                    {...register(`certificates.${index}.name`)}
                    placeholder="AWS Certified Solutions Architect"
                  />
                  {errors.certificates?.[index]?.name && (
                    <InlineError message={errors.certificates[index].name.message} />
                  )}
                </div>

                <div>
                  <Label>Tổ chức cấp *</Label>
                  <Input
                    {...register(`certificates.${index}.issuer`)}
                    placeholder="Amazon Web Services"
                  />
                  {errors.certificates?.[index]?.issuer && (
                    <InlineError message={errors.certificates[index].issuer.message} />
                  )}
                </div>

                <div>
                  <Label>Ngày cấp *</Label>
                  <Input
                    type="month"
                    {...register(`certificates.${index}.issueDate`)}
                  />
                  {errors.certificates?.[index]?.issueDate && (
                    <InlineError message={errors.certificates[index].issueDate.message} />
                  )}
                </div>

                <div>
                  <Label>Ngày hết hạn</Label>
                  <Input
                    type="month"
                    {...register(`certificates.${index}.expiryDate`)}
                  />
                </div>

                <div>
                  <Label>Mã chứng chỉ</Label>
                  <Input
                    {...register(`certificates.${index}.credentialId`)}
                    placeholder="ABC123456"
                  />
                </div>

                <div>
                  <Label>URL xác minh</Label>
                  <Input
                    {...register(`certificates.${index}.url`)}
                    placeholder="https://..."
                  />
                  {errors.certificates?.[index]?.url && (
                    <InlineError message={errors.certificates[index].url.message} />
                  )}
                </div>
              </div>
            </div>
          ))}

          <Button
            type="button"
            variant="outline"
            onClick={() => appendCertificate({
              name: '',
              issuer: '',
              issueDate: '',
              expiryDate: '',
              credentialId: '',
              url: ''
            })}
            className="w-full"
          >
            <Plus className="w-4 h-4 mr-2" />
            Thêm chứng chỉ
          </Button>
        </CardContent>
      </Card>

      {/* Projects */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Code className="w-5 h-5" />
            Dự án đã thực hiện
          </CardTitle>
          <CardDescription>
            Thêm các dự án bạn đã tham gia hoặc thực hiện (không bắt buộc)
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {projectFields.map((field, index) => (
            <div key={field.id} className="p-4 border rounded-lg space-y-4">
              <div className="flex justify-between items-start">
                <h4 className="font-medium">Dự án {index + 1}</h4>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => removeProject(index)}
                >
                  <X className="w-4 h-4" />
                </Button>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="md:col-span-2">
                  <Label>Tên dự án *</Label>
                  <Input
                    {...register(`projects.${index}.name`)}
                    placeholder="E-commerce Website"
                  />
                  {errors.projects?.[index]?.name && (
                    <InlineError message={errors.projects[index].name.message} />
                  )}
                </div>

                <div>
                  <Label>Ngày bắt đầu</Label>
                  <Input
                    type="month"
                    {...register(`projects.${index}.startDate`)}
                  />
                </div>

                <div>
                  <Label>Ngày kết thúc</Label>
                  <Input
                    type="month"
                    {...register(`projects.${index}.endDate`)}
                  />
                </div>

                <div className="md:col-span-2">
                  <Label>URL dự án</Label>
                  <Input
                    {...register(`projects.${index}.url`)}
                    placeholder="https://github.com/username/project"
                  />
                  {errors.projects?.[index]?.url && (
                    <InlineError message={errors.projects[index].url.message} />
                  )}
                </div>

                <div className="md:col-span-2">
                  <Label>Mô tả dự án</Label>
                  <Textarea
                    {...register(`projects.${index}.description`)}
                    placeholder="Mô tả về dự án, vai trò của bạn, công nghệ sử dụng..."
                    rows={3}
                  />
                </div>

                <div className="md:col-span-2">
                  <Label>Công nghệ sử dụng</Label>
                  <Input
                    {...register(`projects.${index}.technologies`)}
                    placeholder="React, Node.js, MongoDB (phân cách bằng dấu phẩy)"
                  />
                  <p className="text-xs text-muted-foreground mt-1">
                    Nhập các công nghệ, phân cách bằng dấu phẩy
                  </p>
                </div>
              </div>
            </div>
          ))}

          <Button
            type="button"
            variant="outline"
            onClick={() => appendProject({
              name: '',
              description: '',
              url: '',
              startDate: '',
              endDate: '',
              technologies: []
            })}
            className="w-full"
          >
            <Plus className="w-4 h-4 mr-2" />
            Thêm dự án
          </Button>
        </CardContent>
      </Card>

      {/* Social Links */}
      <Card>
        <CardHeader>
          <CardTitle>Liên kết mạng xã hội</CardTitle>
          <CardDescription>
            Thêm các liên kết để nhà tuyển dụng tìm hiểu thêm về bạn (không bắt buộc)
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-1 gap-4">
            <div>
              <Label className="flex items-center gap-2">
                <Linkedin className="w-4 h-4" />
                LinkedIn
              </Label>
              <Input
                {...register('linkedin')}
                placeholder="https://linkedin.com/in/your-profile"
              />
              {errors.linkedin && (
                <InlineError message={errors.linkedin.message} />
              )}
            </div>

            <div>
              <Label className="flex items-center gap-2">
                <Github className="w-4 h-4" />
                Github
              </Label>
              <Input
                {...register('github')}
                placeholder="https://github.com/your-username"
              />
              {errors.github && (
                <InlineError message={errors.github.message} />
              )}
            </div>

            <div>
              <Label className="flex items-center gap-2">
                <Globe className="w-4 h-4" />
                Website cá nhân
              </Label>
              <Input
                {...register('website')}
                placeholder="https://your-website.com"
              />
              {errors.website && (
                <InlineError message={errors.website.message} />
              )}
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Hidden submit button - Form sẽ được submit từ footer của OnboardingWrapper */}
      <button type="submit" className="hidden" />
    </form>
  );
};
</file>

<file path="src/components/onboarding/steps/ExperienceEducationStep.jsx">
import { useForm, Controller, useFieldArray } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';
import { Checkbox } from '@/components/ui/checkbox';
import { Plus, X, Briefcase, GraduationCap } from 'lucide-react';
import { experienceEducationSchema, experienceLevelEnum } from '@/schemas/onboardingSchemas';
import { InlineError } from '../ErrorState';

export const ExperienceEducationStep = ({ initialData = {}, onNext, isLoading, onLoadingChange }) => {
  const {
    register,
    handleSubmit,
    control,
    formState: { errors },
    watch
  } = useForm({
    resolver: zodResolver(experienceEducationSchema),
    defaultValues: {
      experienceLevel: initialData.experienceLevel || '',
      experiences: initialData.experiences || [],
      educations: initialData.educations || []
    }
  });

  const { fields: experienceFields, append: appendExperience, remove: removeExperience } = useFieldArray({
    control,
    name: 'experiences'
  });

  const { fields: educationFields, append: appendEducation, remove: removeEducation } = useFieldArray({
    control,
    name: 'educations'
  });

  const onSubmit = (data) => {
    onNext(data);
  };

  const experienceLevelDescriptions = {
    'Fresher': 'Mới tốt nghiệp, chưa có kinh nghiệm làm việc',
    'Junior': '1-2 năm kinh nghiệm',
    'Mid-level': '3-5 năm kinh nghiệm',
    'Senior': 'Trên 5 năm kinh nghiệm'
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* Experience Level */}
      <Card>
        <CardHeader>
          <CardTitle>Mức độ kinh nghiệm</CardTitle>
          <CardDescription>
            Chọn mức độ kinh nghiệm phù hợp với bạn (không bắt buộc)
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Controller
            name="experienceLevel"
            control={control}
            render={({ field }) => (
              <RadioGroup
                value={field.value}
                onValueChange={field.onChange}
                className="space-y-3"
              >
                {experienceLevelEnum.map((level) => (
                  <div
                    key={level}
                    className={`flex items-start space-x-3 p-3 rounded-lg border cursor-pointer transition-colors ${
                      field.value === level 
                        ? 'border-primary bg-primary/5' 
                        : 'hover:bg-muted'
                    }`}
                    onClick={() => field.onChange(level)}
                  >
                    <RadioGroupItem value={level} id={level} />
                    <div className="flex-1">
                      <Label htmlFor={level} className="cursor-pointer font-medium">
                        {level}
                      </Label>
                      <p className="text-sm text-muted-foreground">
                        {experienceLevelDescriptions[level]}
                      </p>
                    </div>
                  </div>
                ))}
              </RadioGroup>
            )}
          />
          {errors.experienceLevel && (
            <InlineError message={errors.experienceLevel.message} />
          )}
        </CardContent>
      </Card>

      {/* Work Experience */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Briefcase className="w-5 h-5" />
            Kinh nghiệm làm việc
          </CardTitle>
          <CardDescription>
            Thêm kinh nghiệm làm việc của bạn (không bắt buộc)
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {experienceFields.map((field, index) => (
            <div key={field.id} className="p-4 border rounded-lg space-y-4">
              <div className="flex justify-between items-start">
                <h4 className="font-medium">Kinh nghiệm {index + 1}</h4>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => removeExperience(index)}
                >
                  <X className="w-4 h-4" />
                </Button>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label>Công ty *</Label>
                  <Input
                    {...register(`experiences.${index}.company`)}
                    placeholder="Tên công ty"
                  />
                  {errors.experiences?.[index]?.company && (
                    <InlineError message={errors.experiences[index].company.message} />
                  )}
                </div>

                <div>
                  <Label>Vị trí *</Label>
                  <Input
                    {...register(`experiences.${index}.position`)}
                    placeholder="Vị trí công việc"
                  />
                  {errors.experiences?.[index]?.position && (
                    <InlineError message={errors.experiences[index].position.message} />
                  )}
                </div>

                <div>
                  <Label>Ngày bắt đầu *</Label>
                  <Input
                    type="month"
                    {...register(`experiences.${index}.startDate`)}
                  />
                  {errors.experiences?.[index]?.startDate && (
                    <InlineError message={errors.experiences[index].startDate.message} />
                  )}
                </div>

                <div>
                  <Label>Ngày kết thúc</Label>
                  <Input
                    type="month"
                    {...register(`experiences.${index}.endDate`)}
                    disabled={watch(`experiences.${index}.isCurrentJob`)}
                  />
                  <div className="flex items-center space-x-2 mt-2">
                    <Controller
                      name={`experiences.${index}.isCurrentJob`}
                      control={control}
                      render={({ field }) => (
                        <Checkbox
                          id={`current-job-${index}`}
                          checked={field.value}
                          onCheckedChange={field.onChange}
                        />
                      )}
                    />
                    <Label htmlFor={`current-job-${index}`} className="text-sm">
                      Đang làm việc tại đây
                    </Label>
                  </div>
                </div>
              </div>

              <div>
                <Label>Mô tả công việc</Label>
                <Textarea
                  {...register(`experiences.${index}.description`)}
                  placeholder="Mô tả về công việc, trách nhiệm, thành tích..."
                  rows={3}
                />
              </div>
            </div>
          ))}

          <Button
            type="button"
            variant="outline"
            onClick={() => appendExperience({
              company: '',
              position: '',
              startDate: '',
              endDate: '',
              description: '',
              isCurrentJob: false
            })}
            className="w-full"
          >
            <Plus className="w-4 h-4 mr-2" />
            Thêm kinh nghiệm
          </Button>
        </CardContent>
      </Card>

      {/* Education */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <GraduationCap className="w-5 h-5" />
            Học vấn
          </CardTitle>
          <CardDescription>
            Thêm thông tin học vấn của bạn (không bắt buộc)
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {educationFields.map((field, index) => (
            <div key={field.id} className="p-4 border rounded-lg space-y-4">
              <div className="flex justify-between items-start">
                <h4 className="font-medium">Học vấn {index + 1}</h4>
                <Button
                  type="button"
                  variant="ghost"
                  size="sm"
                  onClick={() => removeEducation(index)}
                >
                  <X className="w-4 h-4" />
                </Button>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <Label>Trường *</Label>
                  <Input
                    {...register(`educations.${index}.school`)}
                    placeholder="Tên trường"
                  />
                  {errors.educations?.[index]?.school && (
                    <InlineError message={errors.educations[index].school.message} />
                  )}
                </div>

                <div>
                  <Label>Chuyên ngành *</Label>
                  <Input
                    {...register(`educations.${index}.major`)}
                    placeholder="Chuyên ngành học"
                  />
                  {errors.educations?.[index]?.major && (
                    <InlineError message={errors.educations[index].major.message} />
                  )}
                </div>

                <div>
                  <Label>Bằng cấp *</Label>
                  <Input
                    {...register(`educations.${index}.degree`)}
                    placeholder="Cử nhân, Thạc sĩ, Tiến sĩ..."
                  />
                  {errors.educations?.[index]?.degree && (
                    <InlineError message={errors.educations[index].degree.message} />
                  )}
                </div>

                <div>
                  <Label>GPA</Label>
                  <Input
                    {...register(`educations.${index}.gpa`)}
                    placeholder="3.5/4.0"
                  />
                </div>

                <div>
                  <Label>Ngày bắt đầu *</Label>
                  <Input
                    type="month"
                    {...register(`educations.${index}.startDate`)}
                  />
                  {errors.educations?.[index]?.startDate && (
                    <InlineError message={errors.educations[index].startDate.message} />
                  )}
                </div>

                <div>
                  <Label>Ngày kết thúc</Label>
                  <Input
                    type="month"
                    {...register(`educations.${index}.endDate`)}
                  />
                </div>
              </div>
            </div>
          ))}

          <Button
            type="button"
            variant="outline"
            onClick={() => appendEducation({
              school: '',
              major: '',
              degree: '',
              startDate: '',
              endDate: '',
              gpa: ''
            })}
            className="w-full"
          >
            <Plus className="w-4 h-4 mr-2" />
            Thêm học vấn
          </Button>
        </CardContent>
      </Card>

      {/* Hidden submit button - Form sẽ được submit từ footer của OnboardingWrapper */}
      <button type="submit" className="hidden" />
    </form>
  );
};
</file>

<file path="src/components/onboarding/steps/index.js">
export { BasicInfoStep } from './BasicInfoStep';
export { SkillsStep } from './SkillsStep';
export { SalaryPreferencesStep } from './SalaryPreferencesStep';
export { ExperienceEducationStep } from './ExperienceEducationStep';
export { CertificatesProjectsStep } from './CertificatesProjectsStep';

// Legacy export for backward compatibility
export { SkillsStep as SkillsExperienceStep } from './SkillsStep';
</file>

<file path="src/components/profile/CategoryUpdatePrompt.jsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { X, Layers, Sparkles } from 'lucide-react';

/**
 * Banner to prompt existing users without categories to update their preferences
 * Shows when user has completed profile but no categories selected
 */
export const CategoryUpdatePrompt = ({ profile, onDismiss }) => {
  const navigate = useNavigate();
  const [isDismissed, setIsDismissed] = useState(false);

  // Don't show if user has categories or if dismissed
  if (isDismissed || profile?.preferredCategories?.length > 0) {
    return null;
  }

  // Only show for users with some profile data (not brand new users)
  const hasProfileData = profile?.skills?.length > 0 || 
                         profile?.experiences?.length > 0 || 
                         profile?.educations?.length > 0;

  if (!hasProfileData) {
    return null;
  }

  const handleDismiss = () => {
    setIsDismissed(true);
    if (onDismiss) {
      onDismiss();
    }
  };

  const handleUpdateClick = () => {
    // Scroll to preferences section on profile page
    const preferencesSection = document.querySelector('[data-section="preferences"]');
    if (preferencesSection) {
      preferencesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  };

  return (
    <Alert className="relative border-primary/50 bg-primary/5 mb-6">
      <div className="flex items-start gap-3">
        <Sparkles className="h-5 w-5 text-primary mt-0.5" />
        <div className="flex-1">
          <AlertTitle className="flex items-center gap-2 mb-2">
            <Layers className="h-4 w-4" />
            Cập nhật ngành nghề để nhận gợi ý việc làm phù hợp hơn!
          </AlertTitle>
          <AlertDescription className="text-sm text-muted-foreground mb-3">
            Chúng tôi đã thêm tính năng mới giúp bạn nhận được các gợi ý việc làm chính xác hơn. 
            Hãy cập nhật ngành nghề bạn quan tâm trong phần "Điều kiện làm việc" để tận dụng tối đa tính năng này.
          </AlertDescription>
          <div className="flex gap-2">
            <Button 
              size="sm" 
              onClick={handleUpdateClick}
              className="h-8"
            >
              Cập nhật ngay
            </Button>
            <Button 
              size="sm" 
              variant="outline" 
              onClick={handleDismiss}
              className="h-8"
            >
              Để sau
            </Button>
          </div>
        </div>
        <Button
          variant="ghost"
          size="icon"
          className="h-6 w-6 rounded-full absolute top-3 right-3"
          onClick={handleDismiss}
        >
          <X className="h-4 w-4" />
        </Button>
      </div>
    </Alert>
  );
};
</file>

<file path="src/components/profile/CVSection.jsx">
import { useRef, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { FileText, Upload, Download, Trash2 } from 'lucide-react';
import { toast } from 'sonner';

export const CVSection = ({ cvs = [], onUpload, onDelete, onDownload }) => {
  const fileInputRef = useRef(null);
  const [isUploading, setIsUploading] = useState(false);
  const [deletingCvId, setDeletingCvId] = useState(null);

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('vi-VN');
  };

  const handleFileSelect = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const allowedTypes = [
      'application/pdf',
      'application/msword',
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
    ];

    if (!allowedTypes.includes(file.type)) {
      toast.error('Chỉ chấp nhận file PDF, DOC, DOCX');
      return;
    }

    if (file.size > 5 * 1024 * 1024) {
      toast.error('Kích thước file không được vượt quá 5MB');
      return;
    }

    setIsUploading(true);
    try {
      const formData = new FormData();
      formData.append('cv', file);
      await onUpload(formData);
      e.target.value = '';
      toast.success('Tải lên CV thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Tải lên thất bại');
    } finally {
      setIsUploading(false);
    }
  };

  const handleDownload = async (cvId, cvName) => {
    try {
      await onDownload(cvId, cvName);
    } catch (error) {
      toast.error(error.response?.data?.message || 'Tải xuống thất bại');
    }
  };

  const handleDelete = async (cvId) => {
    if (!window.confirm('Bạn có chắc chắn muốn xóa CV này?')) return;

    try {
      setDeletingCvId(cvId);
      await onDelete(cvId);
      toast.success('Xóa CV thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Xóa thất bại');
    } finally {
      setDeletingCvId(null);
    }
  };

  return (
    <Card>
      <input
        ref={fileInputRef}
        type="file"
        onChange={handleFileSelect}
        accept=".pdf,.doc,.docx"
        className="hidden"
      />
      
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <div className="flex items-center">
            <FileText className="w-5 h-5 mr-2 text-primary" />
            CV của tôi
          </div>
          <Button 
            size="sm" 
            onClick={() => fileInputRef.current?.click()}
            disabled={isUploading}
          >
            {isUploading ? (
              'Đang tải lên...'
            ) : (
              <>
                <Upload className="w-4 h-4 mr-2" />
                Tải lên
              </>
            )}
          </Button>
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-3">
        {cvs.length === 0 ? (
          <p className="text-muted-foreground text-center py-8">
            Chưa có CV. Nhấn "Tải lên" để thêm CV của bạn.
          </p>
        ) : (
          cvs.map((cv) => (
            <div key={cv._id} className="border rounded-lg p-4 hover:bg-card transition-colors">
              <div className="flex items-center justify-between">
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2">
                    <h4 className="font-medium text-foreground truncate">{cv.name}</h4>
                    {cv.isDefault && (
                      <Badge className="bg-primary text-primary-foreground">Mặc định</Badge>
                    )}
                  </div>
                  <p className="text-sm text-muted-foreground mt-1">
                    Tải lên: {formatDate(cv.uploadedAt)}
                  </p>
                </div>
                <div className="flex items-center gap-2">
                  <Button 
                    size="sm" 
                    variant="ghost"
                    onClick={() => handleDownload(cv._id, cv.name)}
                  >
                    <Download className="w-4 h-4" />
                  </Button>
                  <Button 
                    size="sm" 
                    variant="ghost" 
                    className="text-destructive hover:text-destructive"
                    onClick={() => handleDelete(cv._id)}
                    disabled={deletingCvId === cv._id}
                  >
                    {deletingCvId === cv._id ? (
                      <span className="text-xs">Đang xóa...</span>
                    ) : (
                      <Trash2 className="w-4 h-4" />
                    )}
                  </Button>
                </div>
              </div>
            </div>
          ))
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/profile/EducationFormItem.jsx">
import React, { memo, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Trash2 } from 'lucide-react';

const EducationFormItem = ({ edu, index, onChange, onDelete }) => {
  const handleFieldChange = useCallback((field, value) => {
    onChange(index, field, value);
  }, [index, onChange]);

  const handleDelete = useCallback(() => {
    onDelete(index);
  }, [index, onDelete]);

  return (
    <div className="border rounded-lg p-4 space-y-3">
      <div className="flex items-center justify-between">
        <h4 className="font-medium">Học vấn {index + 1}</h4>
        <Button
          type="button"
          variant="ghost"
          size="sm"
          className="text-destructive"
          onClick={handleDelete}
        >
          <Trash2 className="w-4 h-4" />
        </Button>
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div className="space-y-2">
          <Label htmlFor={`edu-school-${index}`}>Trường học</Label>
          <Input
            id={`edu-school-${index}`}
            value={edu.school || ''}
            onChange={(e) => handleFieldChange('school', e.target.value)}
            placeholder="Tên trường học"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`edu-major-${index}`}>Chuyên ngành</Label>
          <Input
            id={`edu-major-${index}`}
            value={edu.major || ''}
            onChange={(e) => handleFieldChange('major', e.target.value)}
            placeholder="Chuyên ngành học"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`edu-degree-${index}`}>Bằng cấp</Label>
          <Input
            id={`edu-degree-${index}`}
            value={edu.degree || ''}
            onChange={(e) => handleFieldChange('degree', e.target.value)}
            placeholder="Ví dụ: Cử nhân, Thạc sĩ"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`edu-type-${index}`}>Loại hình</Label>
          <Input
            id={`edu-type-${index}`}
            value={edu.type || ''}
            onChange={(e) => handleFieldChange('type', e.target.value)}
            placeholder="Ví dụ: Đại học, Cao đẳng"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`edu-start-${index}`}>Ngày bắt đầu</Label>
          <Input
            id={`edu-start-${index}`}
            type="date"
            value={edu.startDate ? edu.startDate.split('T')[0] : ''}
            onChange={(e) => handleFieldChange('startDate', e.target.value)}
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`edu-end-${index}`}>Ngày kết thúc</Label>
          <Input
            id={`edu-end-${index}`}
            type="date"
            value={edu.endDate ? edu.endDate.split('T')[0] : ''}
            onChange={(e) => handleFieldChange('endDate', e.target.value)}
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`edu-gpa-${index}`}>Điểm GPA</Label>
          <Input
            id={`edu-gpa-${index}`}
            value={edu.gpa || ''}
            onChange={(e) => handleFieldChange('gpa', e.target.value)}
            placeholder="Ví dụ: 3.5"
          />
        </div>
      </div>
      <div className="space-y-2">
        <Label htmlFor={`edu-desc-${index}`}>Mô tả</Label>
        <Textarea
          id={`edu-desc-${index}`}
          value={edu.description || ''}
          onChange={(e) => handleFieldChange('description', e.target.value)}
          placeholder="Mô tả về quá trình học tập..."
          rows={3}
        />
      </div>
    </div>
  );
};

EducationFormItem.displayName = 'EducationFormItem';

// Custom comparison function to prevent unnecessary re-renders
const areEqual = (prevProps, nextProps) => {
  return (
    prevProps.index === nextProps.index &&
    prevProps.edu === nextProps.edu &&
    prevProps.onChange === nextProps.onChange &&
    prevProps.onDelete === nextProps.onDelete
  );
};

export default memo(EducationFormItem, areEqual);
</file>

<file path="src/components/profile/ExperienceFormItem.jsx">
import React, { memo, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Trash2 } from 'lucide-react';

const ExperienceFormItem = ({ exp, index, onChange, onDelete }) => {
  const handleFieldChange = useCallback((field, value) => {
    onChange(index, field, value);
  }, [index, onChange]);

  const handleDelete = useCallback(() => {
    onDelete(index);
  }, [index, onDelete]);

  return (
    <div className="border rounded-lg p-4 space-y-3">
      <div className="flex items-center justify-between">
        <h4 className="font-medium">Kinh nghiệm {index + 1}</h4>
        <Button
          type="button"
          variant="ghost"
          size="sm"
          className="text-destructive"
          onClick={handleDelete}
        >
          <Trash2 className="w-4 h-4" />
        </Button>
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div className="space-y-2">
          <Label htmlFor={`exp-company-${index}`}>Công ty</Label>
          <Input
            id={`exp-company-${index}`}
            value={exp.company || ''}
            onChange={(e) => handleFieldChange('company', e.target.value)}
            placeholder="Tên công ty"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`exp-position-${index}`}>Vị trí</Label>
          <Input
            id={`exp-position-${index}`}
            value={exp.position || ''}
            onChange={(e) => handleFieldChange('position', e.target.value)}
            placeholder="Vị trí công việc"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`exp-start-${index}`}>Ngày bắt đầu</Label>
          <Input
            id={`exp-start-${index}`}
            type="date"
            value={exp.startDate ? exp.startDate.split('T')[0] : ''}
            onChange={(e) => handleFieldChange('startDate', e.target.value)}
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`exp-end-${index}`}>Ngày kết thúc</Label>
          <Input
            id={`exp-end-${index}`}
            type="date"
            value={exp.endDate ? exp.endDate.split('T')[0] : ''}
            onChange={(e) => handleFieldChange('endDate', e.target.value)}
          />
        </div>
      </div>
      <div className="space-y-2">
        <Label htmlFor={`exp-desc-${index}`}>Mô tả công việc</Label>
        <Textarea
          id={`exp-desc-${index}`}
          value={exp.description || ''}
          onChange={(e) => handleFieldChange('description', e.target.value)}
          placeholder="Mô tả về công việc..."
          rows={3}
        />
      </div>
      <div className="space-y-2">
        <Label htmlFor={`exp-resp-${index}`}>Trách nhiệm (mỗi dòng một trách nhiệm)</Label>
        <Textarea
          id={`exp-resp-${index}`}
          value={exp.responsibilities ? exp.responsibilities.join('\n') : ''}
          onChange={(e) => handleFieldChange('responsibilities', e.target.value.split('\n').filter(r => r.trim()))}
          placeholder="Liệt kê các trách nhiệm..."
          rows={3}
        />
      </div>
    </div>
  );
};

ExperienceFormItem.displayName = 'ExperienceFormItem';

// Custom comparison function to prevent unnecessary re-renders
const areEqual = (prevProps, nextProps) => {
  return (
    prevProps.index === nextProps.index &&
    prevProps.exp === nextProps.exp &&
    prevProps.onChange === nextProps.onChange &&
    prevProps.onDelete === nextProps.onDelete
  );
};

export default memo(ExperienceFormItem, areEqual);
</file>

<file path="src/components/profile/ProfileCompletionBadge.jsx">
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';

export const ProfileCompletionBadge = ({ percentage = 0, size = 'default' }) => {
  if (percentage === 100) {
    return (
      <Badge 
        variant="default" 
        className={cn(
          "bg-emerald-600 hover:bg-emerald-700",
          size === 'sm' && "text-xs px-1.5 py-0"
        )}
      >
        ✓ 100%
      </Badge>
    );
  }

  const getVariant = (pct) => {
    if (pct >= 70) return { variant: 'default', className: 'bg-blue-600 hover:bg-blue-700' };
    if (pct >= 40) return { variant: 'default', className: 'bg-amber-600 hover:bg-amber-700' };
    return { variant: 'destructive' };
  };

  const style = getVariant(percentage);

  return (
    <Badge 
      variant={style.variant}
      className={cn(
        style.className,
        size === 'sm' && "text-xs px-1.5 py-0"
      )}
    >
      {percentage}%
    </Badge>
  );
};
</file>

<file path="src/components/profile/ProfileCompletionReminder.jsx">
import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Progress } from '@/components/ui/progress';
import { 
  AlertCircle, 
  CheckCircle2, 
  TrendingUp, 
  ArrowRight,
  X,
  ChevronDown,
  ChevronUp
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { getProfileRecommendations } from '@/services/profileService';

export const ProfileCompletionReminder = ({ 
  profileCompleteness, 
  onDismiss,
  showDismiss = true,
  collapsible = true 
}) => {
  const [recommendations, setRecommendations] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [isExpanded, setIsExpanded] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchRecommendations = async () => {
      try {
        setIsLoading(true);
        const response = await getProfileRecommendations();
        if (response.success && response.data) {
          setRecommendations(response.data);
        }
      } catch (err) {
        console.error('Lỗi khi lấy gợi ý cải thiện hồ sơ:', err);
        setError(err.message);
      } finally {
        setIsLoading(false);
      }
    };

    if (profileCompleteness && profileCompleteness.percentage < 100) {
      fetchRecommendations();
    }
  }, [profileCompleteness]);

  if (!profileCompleteness || profileCompleteness.percentage === 100) {
    return null;
  }

  const { percentage = 0 } = profileCompleteness;

  const getColorClass = (pct) => {
    if (pct >= 70) return 'from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-blue-200 dark:border-blue-800';
    if (pct >= 40) return 'from-amber-50 to-orange-50 dark:from-amber-950/20 dark:to-orange-950/20 border-amber-200 dark:border-amber-800';
    return 'from-rose-50 to-pink-50 dark:from-rose-950/20 dark:to-pink-950/20 border-rose-200 dark:border-rose-800';
  };

  const getTextColor = (pct) => {
    if (pct >= 70) return 'text-blue-900 dark:text-blue-100';
    if (pct >= 40) return 'text-amber-900 dark:text-amber-100';
    return 'text-rose-900 dark:text-rose-100';
  };

  const getMutedTextColor = (pct) => {
    if (pct >= 70) return 'text-blue-700 dark:text-blue-300';
    if (pct >= 40) return 'text-amber-700 dark:text-amber-300';
    return 'text-rose-700 dark:text-rose-300';
  };

  const getIconColor = (pct) => {
    if (pct >= 70) return 'text-blue-600';
    if (pct >= 40) return 'text-amber-600';
    return 'text-rose-600';
  };

  const getPriorityBadgeColor = (priority) => {
    switch (priority) {
      case 'critical':
        return 'bg-rose-600 text-white';
      case 'important':
        return 'bg-amber-600 text-white';
      case 'optional':
        return 'bg-gray-500 text-white';
      default:
        return 'bg-gray-500 text-white';
    }
  };

  return (
    <Card className={cn("border-2", getColorClass(percentage))}>
      <CardHeader className="pb-3">
        <div className="flex items-start justify-between gap-4">
          <div className="flex items-start gap-3 flex-1">
            <TrendingUp className={cn("w-6 h-6 flex-shrink-0 mt-0.5", getIconColor(percentage))} />
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 mb-1">
                <CardTitle className={cn("text-lg", getTextColor(percentage))}>
                  Hoàn thiện hồ sơ để tăng cơ hội việc làm
                </CardTitle>
                <Badge className={cn("font-bold", getTextColor(percentage))}>
                  {percentage}%
                </Badge>
              </div>
              <Progress value={percentage} className="h-2 mb-2" />
              <p className={cn("text-sm", getMutedTextColor(percentage))}>
                {percentage < 60 ? (
                  <>⚠️ Hồ sơ chưa đủ để nhận gợi ý việc làm (cần tối thiểu 60%)</>
                ) : percentage < 80 ? (
                  <>💡 Hoàn thiện thêm để nhận gợi ý việc làm tốt hơn</>
                ) : (
                  <>🎯 Hồ sơ gần hoàn thiện! Hoàn thành các mục còn lại</>
                )}
              </p>
            </div>
          </div>
          <div className="flex items-center gap-2">
            {collapsible && (
              <Button
                variant="ghost"
                size="sm"
                onClick={() => setIsExpanded(!isExpanded)}
                className="h-8 w-8 p-0"
              >
                {isExpanded ? (
                  <ChevronUp className="h-4 w-4" />
                ) : (
                  <ChevronDown className="h-4 w-4" />
                )}
              </Button>
            )}
            {showDismiss && onDismiss && (
              <Button
                variant="ghost"
                size="sm"
                onClick={onDismiss}
                className="h-8 w-8 p-0"
              >
                <X className="h-4 w-4" />
              </Button>
            )}
          </div>
        </div>
      </CardHeader>

      {isExpanded && (
        <CardContent className="pt-0">
          {isLoading ? (
            <div className="flex items-center justify-center py-4">
              <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
            </div>
          ) : error ? (
            <div className="text-sm text-muted-foreground text-center py-4">
              Không thể tải gợi ý. Vui lòng thử lại sau.
            </div>
          ) : recommendations ? (
            <div className="space-y-4">
              {/* Critical Items */}
              {recommendations.recommendations.critical.length > 0 && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <AlertCircle className="w-4 h-4 text-rose-600" />
                    <h4 className="text-sm font-semibold text-rose-900 dark:text-rose-100">
                      Cần hoàn thành ngay ({recommendations.recommendations.critical.length})
                    </h4>
                  </div>
                  <div className="space-y-2">
                    {recommendations.recommendations.critical.map((item, index) => (
                      <div
                        key={index}
                        className="flex items-start gap-3 p-3 bg-rose-50 dark:bg-rose-950/20 rounded-lg border border-rose-200 dark:border-rose-800"
                      >
                        <AlertCircle className="w-4 h-4 text-rose-600 flex-shrink-0 mt-0.5" />
                        <div className="flex-1 min-w-0">
                          <p className="text-sm font-medium text-rose-900 dark:text-rose-100">
                            {item.message}
                          </p>
                          <p className="text-xs text-rose-700 dark:text-rose-300 mt-0.5">
                            {item.impact}
                          </p>
                        </div>
                        <Link to="/dashboard/profile">
                          <Button size="sm" variant="outline" className="flex-shrink-0">
                            {item.action}
                            <ArrowRight className="w-3 h-3 ml-1" />
                          </Button>
                        </Link>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Important Items */}
              {recommendations.recommendations.important.length > 0 && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <TrendingUp className="w-4 h-4 text-amber-600" />
                    <h4 className="text-sm font-semibold text-amber-900 dark:text-amber-100">
                      Nên hoàn thành ({recommendations.recommendations.important.length})
                    </h4>
                  </div>
                  <div className="space-y-2">
                    {recommendations.recommendations.important.map((item, index) => (
                      <div
                        key={index}
                        className="flex items-start gap-3 p-3 bg-amber-50 dark:bg-amber-950/20 rounded-lg border border-amber-200 dark:border-amber-800"
                      >
                        <TrendingUp className="w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5" />
                        <div className="flex-1 min-w-0">
                          <p className="text-sm font-medium text-amber-900 dark:text-amber-100">
                            {item.message}
                          </p>
                          <p className="text-xs text-amber-700 dark:text-amber-300 mt-0.5">
                            {item.impact}
                          </p>
                        </div>
                        <Link to="/dashboard/profile">
                          <Button size="sm" variant="outline" className="flex-shrink-0">
                            {item.action}
                            <ArrowRight className="w-3 h-3 ml-1" />
                          </Button>
                        </Link>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Optional Items */}
              {recommendations.recommendations.optional.length > 0 && (
                <div className="space-y-2">
                  <div className="flex items-center gap-2">
                    <CheckCircle2 className="w-4 h-4 text-gray-600" />
                    <h4 className="text-sm font-semibold text-gray-900 dark:text-gray-100">
                      Tùy chọn ({recommendations.recommendations.optional.length})
                    </h4>
                  </div>
                  <div className="space-y-2">
                    {recommendations.recommendations.optional.slice(0, 2).map((item, index) => (
                      <div
                        key={index}
                        className="flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-950/20 rounded-lg border border-gray-200 dark:border-gray-800"
                      >
                        <CheckCircle2 className="w-4 h-4 text-gray-600 flex-shrink-0 mt-0.5" />
                        <div className="flex-1 min-w-0">
                          <p className="text-sm font-medium text-gray-900 dark:text-gray-100">
                            {item.message}
                          </p>
                          <p className="text-xs text-gray-700 dark:text-gray-300 mt-0.5">
                            {item.impact}
                          </p>
                        </div>
                        <Link to="/dashboard/profile">
                          <Button size="sm" variant="outline" className="flex-shrink-0">
                            {item.action}
                            <ArrowRight className="w-3 h-3 ml-1" />
                          </Button>
                        </Link>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Action Button */}
              <div className="pt-2">
                <Link to="/dashboard/profile">
                  <Button className="w-full" size="lg">
                    Hoàn thiện hồ sơ ngay
                    <ArrowRight className="w-4 h-4 ml-2" />
                  </Button>
                </Link>
              </div>
            </div>
          ) : (
            <div className="text-sm text-muted-foreground text-center py-4">
              Không có gợi ý nào
            </div>
          )}
        </CardContent>
      )}
    </Card>
  );
};
</file>

<file path="src/components/profile/SkillLevelIndicator.jsx">
import { Badge } from '@/components/ui/badge';

const LEVEL_CONFIG = {
  'Beginner': {
    label: 'Cơ bản',
    color: 'bg-blue-100 text-blue-700 border-blue-200 dark:bg-blue-900/30 dark:text-blue-400 dark:border-blue-800',
    dots: 1
  },
  'Intermediate': {
    label: 'Trung cấp',
    color: 'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800',
    dots: 2
  },
  'Advanced': {
    label: 'Nâng cao',
    color: 'bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/30 dark:text-orange-400 dark:border-orange-800',
    dots: 3
  },
  'Expert': {
    label: 'Chuyên gia',
    color: 'bg-purple-100 text-purple-700 border-purple-200 dark:bg-purple-900/30 dark:text-purple-400 dark:border-purple-800',
    dots: 4
  }
};

export const SkillLevelIndicator = ({ level, showDots = false }) => {
  const config = LEVEL_CONFIG[level];
  
  if (!config) return null;

  if (showDots) {
    return (
      <div className="flex items-center gap-1">
        {[...Array(4)].map((_, i) => (
          <div
            key={i}
            className={`w-1.5 h-1.5 rounded-full ${
              i < config.dots ? 'bg-current' : 'bg-gray-300 dark:bg-gray-600'
            }`}
          />
        ))}
      </div>
    );
  }

  return (
    <Badge variant="outline" className={`text-xs font-medium ${config.color}`}>
      {config.label}
    </Badge>
  );
};
</file>

<file path="src/components/profile/SocialLinksSection.jsx">
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Link2, Linkedin, Github, Globe, MapPin, Edit2, Check, X } from 'lucide-react';
import { toast } from 'sonner';

export const SocialLinksSection = ({ profile, onUpdate }) => {
  const [isEditing, setIsEditing] = useState(false);
  const [formData, setFormData] = useState({
    address: profile?.address || '',
    website: profile?.website || '',
    linkedin: profile?.linkedin || '',
    github: profile?.github || ''
  });

  const handleEdit = () => {
    setFormData({
      address: profile?.address || '',
      website: profile?.website || '',
      linkedin: profile?.linkedin || '',
      github: profile?.github || ''
    });
    setIsEditing(true);
  };

  const handleCancel = () => {
    setIsEditing(false);
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    try {
      await onUpdate(formData);
      toast.success('Đã cập nhật thông tin liên hệ');
      setIsEditing(false);
    } catch (error) {
      toast.error('Không thể cập nhật thông tin');
    }
  };

  const hasAnyLink = profile?.address || profile?.website || profile?.linkedin || profile?.github;

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between">
        <CardTitle className="flex items-center gap-2">
          <Link2 className="w-5 h-5" />
          Thông tin liên hệ & Mạng xã hội
        </CardTitle>
        {!isEditing && (
          <Button onClick={handleEdit} size="sm" variant="outline">
            <Edit2 className="w-4 h-4 mr-2" />
            Chỉnh sửa
          </Button>
        )}
      </CardHeader>
      <CardContent>
        {!isEditing ? (
          <div className="space-y-3">
            {!hasAnyLink ? (
              <div className="text-center py-6 text-muted-foreground">
                <Link2 className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>Chưa có thông tin liên hệ</p>
                <p className="text-sm mt-1">Thêm thông tin để nhà tuyển dụng dễ dàng liên hệ</p>
              </div>
            ) : (
              <>
                {profile?.address && (
                  <div className="flex items-start gap-3 p-3 rounded-lg bg-accent/50">
                    <MapPin className="w-5 h-5 text-muted-foreground mt-0.5" />
                    <div>
                      <p className="text-sm font-medium">Địa chỉ</p>
                      <p className="text-sm text-muted-foreground">{profile.address}</p>
                    </div>
                  </div>
                )}
                
                {profile?.website && (
                  <div className="flex items-start gap-3 p-3 rounded-lg bg-accent/50">
                    <Globe className="w-5 h-5 text-muted-foreground mt-0.5" />
                    <div>
                      <p className="text-sm font-medium">Website</p>
                      <a
                        href={profile.website}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-sm text-primary hover:underline"
                      >
                        {profile.website}
                      </a>
                    </div>
                  </div>
                )}
                
                {profile?.linkedin && (
                  <div className="flex items-start gap-3 p-3 rounded-lg bg-accent/50">
                    <Linkedin className="w-5 h-5 text-muted-foreground mt-0.5" />
                    <div>
                      <p className="text-sm font-medium">LinkedIn</p>
                      <a
                        href={profile.linkedin}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-sm text-primary hover:underline"
                      >
                        {profile.linkedin}
                      </a>
                    </div>
                  </div>
                )}
                
                {profile?.github && (
                  <div className="flex items-start gap-3 p-3 rounded-lg bg-accent/50">
                    <Github className="w-5 h-5 text-muted-foreground mt-0.5" />
                    <div>
                      <p className="text-sm font-medium">Github</p>
                      <a
                        href={profile.github}
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-sm text-primary hover:underline"
                      >
                        {profile.github}
                      </a>
                    </div>
                  </div>
                )}
              </>
            )}
          </div>
        ) : (
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <Label htmlFor="address" className="flex items-center gap-2">
                <MapPin className="w-4 h-4" />
                Địa chỉ
              </Label>
              <Input
                id="address"
                value={formData.address}
                onChange={(e) => setFormData({ ...formData, address: e.target.value })}
                placeholder="VD: 123 Nguyễn Huệ, Q1, TP.HCM"
              />
            </div>

            <div>
              <Label htmlFor="website" className="flex items-center gap-2">
                <Globe className="w-4 h-4" />
                Website/Portfolio
              </Label>
              <Input
                id="website"
                type="url"
                value={formData.website}
                onChange={(e) => setFormData({ ...formData, website: e.target.value })}
                placeholder="https://myportfolio.com"
              />
            </div>

            <div>
              <Label htmlFor="linkedin" className="flex items-center gap-2">
                <Linkedin className="w-4 h-4" />
                LinkedIn
              </Label>
              <Input
                id="linkedin"
                type="url"
                value={formData.linkedin}
                onChange={(e) => setFormData({ ...formData, linkedin: e.target.value })}
                placeholder="https://linkedin.com/in/username"
              />
            </div>

            <div>
              <Label htmlFor="github" className="flex items-center gap-2">
                <Github className="w-4 h-4" />
                Github
              </Label>
              <Input
                id="github"
                type="url"
                value={formData.github}
                onChange={(e) => setFormData({ ...formData, github: e.target.value })}
                placeholder="https://github.com/username"
              />
            </div>

            <div className="flex gap-2 justify-end">
              <Button type="button" variant="outline" onClick={handleCancel}>
                <X className="w-4 h-4 mr-2" />
                Hủy
              </Button>
              <Button type="submit">
                <Check className="w-4 h-4 mr-2" />
                Lưu
              </Button>
            </div>
          </form>
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/recommendations/index.js">
export { default as JobRecommendations } from './JobRecommendations';
export { default as JobRecommendationCard } from './JobRecommendationCard';
</file>

<file path="src/components/recommendations/JobRecommendationCard.jsx">
import React from 'react';
import { useNavigate } from 'react-router-dom';
import { useSelector } from 'react-redux';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { saveJob, unsaveJob } from '@/services/savedJobService';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';
import {
  MapPin,
  Clock,
  DollarSign,
  Briefcase,
  Building,
  Heart,
  ArrowRight,
  Sparkles,
  CheckCircle2
} from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';
import { formatSalary, formatTimeAgo } from '@/utils/formatters';

/**
 * JobRecommendationCard component for displaying recommended jobs
 * Includes recommendation score, reasons, and action buttons
 */
const JobRecommendationCard = ({ job, onSaveToggle }) => {
  const navigate = useNavigate();
  const { isAuthenticated } = useSelector((state) => state.auth);
  const queryClient = useQueryClient();

  const handleCardClick = () => {
    navigate(`/jobs/${job._id}`);
  };

  const { mutate: toggleSaveJob } = useMutation({
    mutationFn: () => {
      if (onSaveToggle) {
        onSaveToggle(job);
        return Promise.resolve();
      }
      return job.isSaved ? unsaveJob(job._id) : saveJob(job._id);
    },
    onMutate: async () => {
      if (onSaveToggle) return;

      await queryClient.cancelQueries({ queryKey: ['recommendations'] });
      const previousData = queryClient.getQueryData(['recommendations']);

      queryClient.setQueryData(['recommendations'], (oldData) => {
        if (!oldData?.pages) return oldData;
        return {
          ...oldData,
          pages: oldData.pages.map(page => ({
            ...page,
            data: page.data.map(j =>
              j._id === job._id ? { ...j, isSaved: !j.isSaved } : j
            )
          }))
        };
      });

      return { previousData };
    },
    onSuccess: () => {
      if (onSaveToggle) return;
      toast.success(job.isSaved ? 'Đã bỏ lưu việc làm' : 'Đã lưu việc làm thành công');
      queryClient.invalidateQueries({ queryKey: ['savedJobs'] });
    },
    onError: (err, _vars, context) => {
      if (onSaveToggle) return;
      if (context?.previousData) {
        queryClient.setQueryData(['recommendations'], context.previousData);
      }
      toast.error(err.response?.data?.message || 'Đã có lỗi xảy ra.');
    },
  });

  const handleSaveJob = (event) => {
    event.stopPropagation();
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để lưu việc làm.');
      return;
    }
    toggleSaveJob();
  };

  const handleApplyJob = (event) => {
    event.stopPropagation();
    
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để ứng tuyển');
      navigate('/login');
      return;
    }

    navigate(`/jobs/${job._id}`);
  };

  // Get score color based on recommendation score
  const getScoreColor = (score) => {
    if (score >= 80) return 'text-green-600 bg-green-50 border-green-200';
    if (score >= 60) return 'text-blue-600 bg-blue-50 border-blue-200';
    if (score >= 40) return 'text-amber-600 bg-amber-50 border-amber-200';
    return 'text-gray-600 bg-gray-50 border-gray-200';
  };

  return (
    <Card
      className={cn(
        "group cursor-pointer border-2 border-primary/30",
        "hover:border-primary hover:shadow-2xl hover:shadow-primary/20",
        "transition-all duration-500",
        "bg-gradient-to-br from-primary/5 via-card to-card",
        "overflow-hidden relative"
      )}
      onClick={handleCardClick}
    >
      {/* Recommendation Badge */}
      <div className="absolute top-4 right-4 z-20">
        <Badge 
          className={cn(
            "px-3 py-1.5 rounded-full font-bold text-sm border-2",
            getScoreColor(job.recommendationScore || 0),
            "shadow-lg animate-pulse"
          )}
        >
          <Sparkles className="h-4 w-4 mr-1" />
          {job.recommendationScore || 0}% phù hợp
        </Badge>
      </div>

      {/* Gradient overlay */}
      <div className="absolute inset-0 bg-gradient-to-br from-primary/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
      
      <CardContent className="p-6 relative z-10">
        <div className="flex gap-4">
          {/* Company Logo */}
          <div className="flex-shrink-0">
            <div className={cn(
              "rounded-2xl border-2 border-primary/40 bg-white shadow-lg",
              "group-hover:shadow-2xl group-hover:border-primary group-hover:scale-105",
              "transition-all duration-500 overflow-hidden",
              "h-32 w-32"
            )}>
              <Avatar className="h-full w-full rounded-2xl">
                <AvatarImage
                  src={job.recruiterProfileId?.company?.logo}
                  alt={job.recruiterProfileId?.company}
                  className="object-cover"
                />
                <AvatarFallback className={cn(
                  "bg-gradient-to-br from-primary/30 via-primary/20 to-transparent",
                  "text-primary font-bold rounded-2xl text-3xl"
                )}>
                  {job.recruiterProfileId?.company?.charAt(0) || job.title?.charAt(0) || 'J'}
                </AvatarFallback>
              </Avatar>
            </div>
          </div>

          {/* Job Details */}
          <div className="flex-1 min-w-0">
            <div className="flex items-start justify-between gap-4 mb-3">
              <div className="flex-1 min-w-0">
                <h3 className={cn(
                  "font-bold text-foreground line-clamp-2 mb-2 text-2xl",
                  "group-hover:text-primary transition-all duration-300"
                )}>
                  {job.title}
                </h3>
                <div className="flex items-center gap-2 text-muted-foreground group-hover:text-primary/80 transition-all duration-300">
                  <Building className="h-4 w-4 flex-shrink-0" />
                  <span className="font-semibold truncate">{job.recruiterProfileId?.company || 'Công ty'}</span>
                </div>
              </div>
              
              {/* Save Button */}
              <Button
                variant="ghost"
                size="icon"
                onClick={handleSaveJob}
                className={cn(
                  "flex-shrink-0 rounded-xl transition-all duration-300",
                  "hover:bg-red-50/20 hover:scale-110",
                  job.isSaved 
                    ? "text-red-500 hover:text-red-600" 
                    : "text-muted-foreground hover:text-red-500"
                )}
              >
                <Heart className={cn(
                  "h-6 w-6 transition-all duration-300",
                  job.isSaved && "fill-red-500 animate-pulse"
                )} />
              </Button>
            </div>

            {/* Recommendation Reasons */}
            {job.recommendationReasons && job.recommendationReasons.length > 0 && (
              <div className="mb-4 p-3 bg-primary/5 rounded-lg border border-primary/20">
                <div className="flex items-center gap-2 mb-2">
                  <Sparkles className="h-4 w-4 text-primary" />
                  <span className="text-sm font-semibold text-primary">Lý do gợi ý:</span>
                </div>
                <div className="space-y-1">
                  {job.recommendationReasons.slice(0, 3).map((reason, index) => (
                    <div key={index} className="flex items-start gap-2 text-sm">
                      <CheckCircle2 className="h-4 w-4 text-green-600 flex-shrink-0 mt-0.5" />
                      <span className="text-muted-foreground">{reason.value}</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Job Info Badges */}
            <div className="flex flex-wrap gap-2 mb-4">
              {job.type && (
                <Badge 
                  variant="secondary" 
                  className="text-xs font-semibold px-3 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 text-blue-600 border border-blue-500/20"
                >
                  <Briefcase className="h-3 w-3 mr-1" />
                  {job.type}
                </Badge>
              )}
              
              {job.workType && (
                <Badge 
                  variant="outline" 
                  className="text-xs font-semibold px-3 py-1 rounded-lg bg-gradient-to-r from-indigo-500/10 to-blue-500/10 text-indigo-600 border-2 border-indigo-500/30"
                >
                  {job.workType}
                </Badge>
              )}
              
              <Badge 
                variant="outline" 
                className="text-xs font-semibold px-3 py-1 rounded-lg bg-gradient-to-r from-emerald-500/10 to-green-500/10 text-emerald-600 border-2 border-emerald-500/30"
              >
                <DollarSign className="h-3 w-3 mr-1" />
                {formatSalary(job.minSalary, job.maxSalary)}
              </Badge>
              
              {job.location?.province && (
                <Badge 
                  variant="outline" 
                  className="text-xs font-semibold px-3 py-1 rounded-lg bg-gradient-to-r from-blue-500/10 to-cyan-500/10 text-blue-600 border-2 border-blue-500/30"
                >
                  <MapPin className="h-3 w-3 mr-1" />
                  {job.location.province}
                </Badge>
              )}
            </div>

            {/* Job Description */}
            {job.description && (
              <p className="text-muted-foreground text-sm line-clamp-2 mb-4 group-hover:text-foreground transition-colors duration-300">
                {job.description}
              </p>
            )}

            {/* Job Skills */}
            {job.skills && job.skills.length > 0 && (
              <div className="flex flex-wrap gap-2 mb-4">
                {job.skills.slice(0, 4).map((skill, index) => (
                  <Badge 
                    key={index} 
                    variant="secondary" 
                    className="text-xs font-medium px-3 py-1 rounded-full bg-gradient-to-r from-primary/15 to-primary/5 text-primary border border-primary/30"
                  >
                    {skill}
                  </Badge>
                ))}
                {job.skills.length > 4 && (
                  <Badge 
                    variant="secondary" 
                    className="text-xs font-bold px-3 py-1 rounded-full bg-gradient-to-r from-primary/20 to-primary/10 text-primary border-2 border-primary/40"
                  >
                    +{job.skills.length - 4}
                  </Badge>
                )}
              </div>
            )}

            {/* Footer */}
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4 text-xs text-muted-foreground">
                <div className="flex items-center gap-1">
                  <Clock className="h-3 w-3" />
                  {formatTimeAgo(job.createdAt)}
                </div>
                {job.recommendedAt && (
                  <div className="flex items-center gap-1 text-primary">
                    <Sparkles className="h-3 w-3" />
                    Gợi ý {formatTimeAgo(job.recommendedAt)}
                  </div>
                )}
              </div>

              {/* Action Buttons */}
              <div className="flex items-center gap-3">
                <Button
                  variant="outline"
                  size="sm"
                  onClick={handleCardClick}
                  className="text-xs font-semibold px-4 py-2 rounded-lg border-2 border-primary/40 text-primary hover:bg-primary/10 hover:border-primary hover:scale-105 transition-all duration-300"
                >
                  Xem chi tiết
                  <ArrowRight className="h-3 w-3 ml-1" />
                </Button>
                
                <Button
                  size="sm"
                  onClick={handleApplyJob}
                  className="btn-gradient text-primary-foreground text-xs font-bold px-5 py-2 rounded-lg hover:scale-110 hover:shadow-xl hover:shadow-primary/40 transition-all duration-300"
                >
                  Ứng tuyển
                </Button>
              </div>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default JobRecommendationCard;
</file>

<file path="src/components/recommendations/JobRecommendations.jsx">
import React, { useState } from 'react';
import { useInfiniteQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { getRecommendations, generateRecommendations } from '@/services/recommendationService';
import JobRecommendationCard from './JobRecommendationCard';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { 
  Sparkles, 
  RefreshCw, 
  AlertCircle, 
  TrendingUp,
  FileText,
  MapPin,
  Briefcase
} from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';
import { useNavigate } from 'react-router-dom';

/**
 * JobRecommendations component
 * Displays personalized job recommendations with infinite scroll
 */
const JobRecommendations = ({ 
  limit = 10,
  showHeader = true,
  className 
}) => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const [isGenerating, setIsGenerating] = useState(false);

  // Fetch recommendations with infinite scroll
  const {
    data,
    fetchNextPage,
    hasNextPage,
    isFetchingNextPage,
    isLoading,
    isError,
    error,
    refetch
  } = useInfiniteQuery({
    queryKey: ['recommendations', limit],
    queryFn: ({ pageParam = 1 }) => getRecommendations({ page: pageParam, limit }),
    getNextPageParam: (lastPage) => {
      if (!lastPage?.pagination) return undefined;
      const { currentPage, totalPages } = lastPage.pagination;
      return currentPage < totalPages ? currentPage + 1 : undefined;
    },
    staleTime: 5 * 60 * 1000, // 5 minutes
  });

  // Generate new recommendations
  const generateMutation = useMutation({
    mutationFn: generateRecommendations,
    onMutate: () => {
      setIsGenerating(true);
    },
    onSuccess: (response) => {
      setIsGenerating(false);
      toast.success(response.message || 'Đã tạo gợi ý việc làm mới');
      queryClient.invalidateQueries({ queryKey: ['recommendations'] });
      refetch();
    },
    onError: (err) => {
      setIsGenerating(false);
      const errorMessage = err.response?.data?.message || 'Không thể tạo gợi ý việc làm';
      toast.error(errorMessage);
    }
  });

  const handleGenerateRecommendations = () => {
    generateMutation.mutate({ limit: 20 });
  };

  const handleRefresh = () => {
    queryClient.invalidateQueries({ queryKey: ['recommendations'] });
    refetch();
  };

  // Get all jobs from all pages
  const allJobs = data?.pages?.flatMap(page => page.data) || [];
  const totalItems = data?.pages?.[0]?.pagination?.totalItems || 0;
  const lastUpdated = data?.pages?.[0]?.lastUpdated;

  // Loading state
  if (isLoading) {
    return (
      <div className={cn("space-y-4", className)}>
        {showHeader && (
          <div className="flex items-center justify-between mb-6">
            <Skeleton className="h-8 w-64" />
            <Skeleton className="h-10 w-32" />
          </div>
        )}
        {[1, 2, 3].map((i) => (
          <Card key={i} className="overflow-hidden">
            <CardContent className="p-6">
              <div className="flex gap-4">
                <Skeleton className="h-32 w-32 rounded-2xl" />
                <div className="flex-1 space-y-3">
                  <Skeleton className="h-6 w-3/4" />
                  <Skeleton className="h-4 w-1/2" />
                  <div className="flex gap-2">
                    <Skeleton className="h-6 w-20" />
                    <Skeleton className="h-6 w-24" />
                    <Skeleton className="h-6 w-28" />
                  </div>
                  <Skeleton className="h-16 w-full" />
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }

  // Error state
  if (isError) {
    const errorMessage = error?.response?.data?.message || 'Không thể tải gợi ý việc làm';
    const isProfileIncomplete = errorMessage.includes('60%');

    return (
      <Card className={cn("border-2 border-amber-200 bg-amber-50/50", className)}>
        <CardContent className="p-8 text-center">
          <div className="flex flex-col items-center gap-4">
            <div className="p-4 bg-amber-100 rounded-full">
              <AlertCircle className="h-12 w-12 text-amber-600" />
            </div>
            <div>
              <h3 className="text-xl font-bold text-amber-900 mb-2">
                {isProfileIncomplete ? 'Hồ sơ chưa đủ để tạo gợi ý' : 'Không thể tải gợi ý'}
              </h3>
              <p className="text-amber-700 mb-4">
                {errorMessage}
              </p>
            </div>
            {isProfileIncomplete ? (
              <Button
                onClick={() => navigate('/profile')}
                className="btn-gradient"
              >
                <FileText className="h-4 w-4 mr-2" />
                Hoàn thiện hồ sơ
              </Button>
            ) : (
              <Button
                onClick={handleRefresh}
                variant="outline"
                className="border-amber-300 text-amber-700 hover:bg-amber-100"
              >
                <RefreshCw className="h-4 w-4 mr-2" />
                Thử lại
              </Button>
            )}
          </div>
        </CardContent>
      </Card>
    );
  }

  // No recommendations state
  if (allJobs.length === 0) {
    return (
      <Card className={cn("border-2 border-blue-200 bg-blue-50/50", className)}>
        <CardContent className="p-8 text-center">
          <div className="flex flex-col items-center gap-4">
            <div className="p-4 bg-blue-100 rounded-full">
              <Sparkles className="h-12 w-12 text-blue-600" />
            </div>
            <div>
              <h3 className="text-xl font-bold text-blue-900 mb-2">
                Chưa có gợi ý việc làm
              </h3>
              <p className="text-blue-700 mb-4">
                Hãy tạo gợi ý việc làm dựa trên hồ sơ của bạn
              </p>
            </div>
            <div className="space-y-3 text-left bg-white p-4 rounded-lg border border-blue-200 max-w-md">
              <p className="text-sm font-semibold text-blue-900 mb-2">Để nhận gợi ý tốt hơn, hãy:</p>
              <div className="flex items-start gap-2 text-sm text-blue-700">
                <FileText className="h-4 w-4 flex-shrink-0 mt-0.5" />
                <span>Cập nhật kỹ năng và kinh nghiệm</span>
              </div>
              <div className="flex items-start gap-2 text-sm text-blue-700">
                <MapPin className="h-4 w-4 flex-shrink-0 mt-0.5" />
                <span>Thêm địa điểm làm việc mong muốn</span>
              </div>
              <div className="flex items-start gap-2 text-sm text-blue-700">
                <Briefcase className="h-4 w-4 flex-shrink-0 mt-0.5" />
                <span>Điền mức lương và hình thức làm việc</span>
              </div>
            </div>
            <div className="flex gap-3">
              <Button
                onClick={() => navigate('/profile')}
                variant="outline"
                className="border-blue-300 text-blue-700 hover:bg-blue-100"
              >
                <FileText className="h-4 w-4 mr-2" />
                Cập nhật hồ sơ
              </Button>
              <Button
                onClick={handleGenerateRecommendations}
                disabled={isGenerating}
                className="btn-gradient"
              >
                {isGenerating ? (
                  <>
                    <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                    Đang tạo...
                  </>
                ) : (
                  <>
                    <Sparkles className="h-4 w-4 mr-2" />
                    Tạo gợi ý ngay
                  </>
                )}
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <div className={cn("space-y-6", className)}>
      {/* Header */}
      {showHeader && (
        <div className="flex items-center justify-between">
          <div>
            <h2 className="text-2xl font-bold text-foreground flex items-center gap-2">
              <Sparkles className="h-6 w-6 text-primary" />
              Việc làm gợi ý cho bạn
            </h2>
            <p className="text-sm text-muted-foreground mt-1">
              {totalItems} việc làm phù hợp với hồ sơ của bạn
              {lastUpdated && ` • Cập nhật ${new Date(lastUpdated).toLocaleString('vi-VN')}`}
            </p>
          </div>
          <div className="flex gap-2">
            <Button
              onClick={handleRefresh}
              variant="outline"
              size="sm"
              disabled={isLoading}
            >
              <RefreshCw className={cn("h-4 w-4 mr-2", isLoading && "animate-spin")} />
              Làm mới
            </Button>
            <Button
              onClick={handleGenerateRecommendations}
              disabled={isGenerating}
              size="sm"
              className="btn-gradient"
            >
              {isGenerating ? (
                <>
                  <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                  Đang tạo...
                </>
              ) : (
                <>
                  <TrendingUp className="h-4 w-4 mr-2" />
                  Tạo gợi ý mới
                </>
              )}
            </Button>
          </div>
        </div>
      )}

      {/* Job List */}
      <div className="space-y-4">
        {allJobs.map((job) => (
          <JobRecommendationCard 
            key={job._id} 
            job={job}
          />
        ))}
      </div>

      {/* Load More Button */}
      {hasNextPage && (
        <div className="flex justify-center pt-4">
          <Button
            onClick={() => fetchNextPage()}
            disabled={isFetchingNextPage}
            variant="outline"
            size="lg"
            className="border-2 border-primary/40 text-primary hover:bg-primary/10"
          >
            {isFetchingNextPage ? (
              <>
                <RefreshCw className="h-4 w-4 mr-2 animate-spin" />
                Đang tải...
              </>
            ) : (
              <>
                <TrendingUp className="h-4 w-4 mr-2" />
                Xem thêm việc làm
              </>
            )}
          </Button>
        </div>
      )}

      {/* Loading more indicator */}
      {isFetchingNextPage && (
        <div className="space-y-4">
          {[1, 2].map((i) => (
            <Card key={i} className="overflow-hidden">
              <CardContent className="p-6">
                <div className="flex gap-4">
                  <Skeleton className="h-32 w-32 rounded-2xl" />
                  <div className="flex-1 space-y-3">
                    <Skeleton className="h-6 w-3/4" />
                    <Skeleton className="h-4 w-1/2" />
                    <div className="flex gap-2">
                      <Skeleton className="h-6 w-20" />
                      <Skeleton className="h-6 w-24" />
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
};

export default JobRecommendations;
</file>

<file path="src/components/sections/CareerGuideSection.jsx">
import { ArrowRight, Clock, User, BookOpen } from 'lucide-react';
import { Card, CardContent, CardFooter } from '../ui/card';
import { Button } from '../ui/button';
import { Badge } from '../ui/badge';

const guideItems = [
  {
    title: 'Cách viết CV thu hút nhà tuyển dụng trong ngành IT',
    description: 'Khám phá những bí quyết để tạo ra một CV nổi bật giúp bạn gây ấn tượng với nhà tuyển dụng và tăng cơ hội được mời phỏng vấn.',
    image: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?q=80&w=500&auto=format&fit=crop',
    author: 'Nguyễn Văn A',
    date: '12/07/2025',
    readTime: '8 phút',
    category: 'Kỹ năng CV'
  },
  {
    title: 'Những câu hỏi phỏng vấn thường gặp và cách trả lời hiệu quả',
    description: 'Tổng hợp các câu hỏi phỏng vấn phổ biến và hướng dẫn cách trả lời chuyên nghiệp để tăng khả năng thành công trong buổi phỏng vấn.',
    image: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?q=80&w=500&auto=format&fit=crop',
    author: 'Trần Thị B',
    date: '05/08/2025',
    readTime: '10 phút',
    category: 'Phỏng vấn'
  },
  {
    title: '5 kỹ năng mềm quan trọng cần có để phát triển sự nghiệp',
    description: 'Những kỹ năng mềm thiết yếu giúp bạn không chỉ tìm được việc làm tốt mà còn phát triển sự nghiệp bền vững trong dài hạn.',
    image: 'https://images.unsplash.com/photo-1553877522-43269d4ea984?q=80&w=500&auto=format&fit=crop',
    author: 'Lê Văn C',
    date: '23/06/2025',
    readTime: '6 phút',
    category: 'Phát triển bản thân'
  },
];

const CareerGuideSection = () => {
  return (
    <section className="py-20 bg-background">
      <div className="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6">
        <div className="flex flex-col md:flex-row md:items-end justify-between mb-12">
          <div>
            <Badge variant="outline" className="text-primary mb-4 bg-background border-primary/30">📚 Cẩm nang nghề nghiệp</Badge>
            <h2 className="text-3xl md:text-4xl font-bold mb-4 text-foreground">
              Bí quyết <span className="text-gradient-primary">phát triển sự nghiệp</span>
            </h2>
            <p className="text-lg text-muted-foreground max-w-2xl">
              Những bài viết hữu ích giúp bạn đạt được thành công trong hành trình sự nghiệp của mình.
            </p>
          </div>
          <Button variant="outline" size="lg" className="mt-6 md:mt-0 border-primary text-primary hover:bg-primary hover:text-primary-foreground">
            Xem tất cả bài viết
          </Button>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {guideItems.map((item, index) => (
            <Card key={index} className="overflow-hidden hover:shadow-xl transition-all duration-300 border-0 shadow-md bg-background group hover:-translate-y-1">
              <div className="relative h-48 overflow-hidden">
                <img 
                  src={item.image} 
                  alt={item.title}
                  className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                />
                <div className="absolute top-4 left-4">
                  <Badge className="bg-gradient-primary text-white hover:opacity-90">{item.category}</Badge>
                </div>
              </div>
              <CardContent className="p-6">
                <div className="flex items-center text-sm text-muted-foreground space-x-4 mb-4">
                  <div className="flex items-center">
                    <User className="h-4 w-4 mr-1" />
                    <span>{item.author}</span>
                  </div>
                  <div className="flex items-center">
                    <Clock className="h-4 w-4 mr-1" />
                    <span>{item.readTime}</span>
                  </div>
                </div>
                <h3 className="text-xl font-semibold mb-3 line-clamp-2 text-foreground group-hover:text-primary transition-colors">{item.title}</h3>
                <p className="text-muted-foreground line-clamp-3">{item.description}</p>
              </CardContent>
              <CardFooter className="px-6 pb-6 pt-0">
                <Button variant="link" className="p-0 h-auto text-primary">
                  Đọc tiếp <ArrowRight className="ml-2 h-4 w-4" />
                </Button>
              </CardFooter>
            </Card>
          ))}
        </div>

        <div className="mt-16 bg-primary/5 rounded-xl p-8 md:p-12">
          <div className="flex flex-col md:flex-row items-center justify-between">
            <div className="mb-6 md:mb-0 md:mr-8">
              <div className="inline-flex items-center justify-center h-16 w-16 rounded-full bg-primary/20 text-primary mb-4">
                <BookOpen className="h-8 w-8" />
              </div>
              <h3 className="text-2xl font-bold mb-3">Trung tâm hướng nghiệp</h3>
              <p className="text-muted-foreground max-w-xl">
                Khám phá các khóa học, webinar và tài liệu miễn phí để phát triển kỹ năng và định hướng sự nghiệp. 
                Được thiết kế bởi các chuyên gia hàng đầu trong ngành.
              </p>
            </div>
            <Button size="lg" className="min-w-[180px]">
              Truy cập ngay
            </Button>
          </div>
        </div>
      </div>
    </section>
  );
};

export default CareerGuideSection;
</file>

<file path="src/components/sections/JobCategoriesSection.jsx">
import { Briefcase, PieChart, Code, Megaphone, Monitor, PenTool, ShoppingBag, Database } from 'lucide-react';
import { Card, CardContent } from '../ui/card';
import { Button } from '../ui/button';
import { Badge } from '../ui/badge';

const categories = [
  { 
    icon: Code, 
    name: 'Phát triển phần mềm', 
    jobCount: 1245,
    skills: ['JavaScript', 'React', 'Node.js', 'Python'] 
  },
  { 
    icon: Megaphone, 
    name: 'Marketing & Truyền thông', 
    jobCount: 856,
    skills: ['Digital Marketing', 'SEO', 'Content', 'Social Media'] 
  },
  { 
    icon: PieChart, 
    name: 'Tài chính & Kế toán', 
    jobCount: 697,
    skills: ['Kế toán', 'Phân tích tài chính', 'Thuế', 'Kiểm toán'] 
  },
  { 
    icon: Monitor, 
    name: 'Thiết kế UI/UX', 
    jobCount: 423,
    skills: ['Figma', 'Adobe XD', 'UI Design', 'Web Design'] 
  },
  { 
    icon: ShoppingBag, 
    name: 'Kinh doanh & Bán hàng', 
    jobCount: 934,
    skills: ['B2B Sales', 'Quản lý KH', 'Đàm phán', 'CRM'] 
  },
  { 
    icon: Database, 
    name: 'Dữ liệu & Phân tích', 
    jobCount: 531,
    skills: ['SQL', 'Python', 'Data Mining', 'Tableau'] 
  },
  { 
    icon: PenTool, 
    name: 'Thiết kế & Sáng tạo', 
    jobCount: 378,
    skills: ['Photoshop', 'Illustrator', 'Branding', '3D'] 
  },
  { 
    icon: Briefcase, 
    name: 'Quản lý dự án', 
    jobCount: 645,
    skills: ['Agile', 'Scrum', 'PM Tools', 'Lãnh đạo'] 
  },
];

const JobCategoriesSection = () => {
  return (
    <section className="py-20 bg-muted/30">
      <div className="container">
        <div className="flex flex-col md:flex-row md:items-end justify-between mb-12">
          <div>
            <Badge variant="outline" className="text-primary mb-4">Khám phá lĩnh vực</Badge>
            <h2 className="text-3xl md:text-4xl font-bold mb-4">
              Việc làm theo danh mục
            </h2>
            <p className="text-lg text-muted-foreground max-w-2xl">
              Khám phá các cơ hội việc làm trong nhiều lĩnh vực khác nhau, tìm kiếm ngành nghề phù hợp với kỹ năng và sở thích của bạn.
            </p>
          </div>
          <Button variant="outline" size="lg" className="mt-6 md:mt-0">
            Xem tất cả danh mục
          </Button>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {categories.map((category, index) => (
            <Card key={index} className="hover:shadow-lg transition-all duration-300 group">
              <CardContent className="p-6">
                <div className="inline-flex items-center justify-center h-14 w-14 rounded-lg bg-primary/10 text-primary mb-4 group-hover:bg-gradient-primary group-hover:text-primary-foreground transition-all duration-300">
                  <category.icon className="h-7 w-7" />
                </div>
                <h3 className="text-xl font-semibold mb-2">{category.name}</h3>
                <p className="text-muted-foreground mb-4">{category.jobCount} việc làm có sẵn</p>
                <div className="flex flex-wrap gap-2 mb-4">
                  {category.skills.map((skill, i) => (
                    <Badge key={i} variant="secondary" className="font-normal">
                      {skill}
                    </Badge>
                  ))}
                </div>
                <Button variant="link" className="p-0 h-auto text-primary">
                  Xem chi tiết
                </Button>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>
    </section>
  );
};

export default JobCategoriesSection;
</file>

<file path="src/components/sections/RecommendedJobs.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useSelector } from 'react-redux';
import { MapPin, Briefcase, DollarSign, Clock, ArrowRight, Heart, Building, Calendar, Sparkles, AlertCircle, RefreshCw } from 'lucide-react';
import { Card, CardContent, CardFooter, CardHeader, CardTitle } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { Avatar, AvatarImage, AvatarFallback } from '../ui/avatar';
import { Skeleton } from '../ui/skeleton';
import { Alert, AlertDescription } from '../ui/alert';
import { SectionHeader } from '../common/SectionHeader';
import { getRecommendations, generateRecommendations } from '../../services/recommendationService';
import { getOnboardingStatus } from '../../services/onboardingService';
import { getAllJobs } from '../../services/jobService';
import { formatSalaryVND, formatWorkType, formatExperience } from '../../utils/formatters';

const RecommendedJobs = () => {
  const navigate = useNavigate();
  const { user, isAuthenticated } = useSelector((state) => state.auth);
  
  const [jobs, setJobs] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isRecommendationsMode, setIsRecommendationsMode] = useState(false);
  const [profileCompleteness, setProfileCompleteness] = useState(0);
  const [isGenerating, setIsGenerating] = useState(false);

  useEffect(() => {
    fetchJobs();
  }, [isAuthenticated]);

  const fetchJobs = async () => {
    try {
      setIsLoading(true);
      setError(null);

      // Nếu user chưa đăng nhập, hiển thị featured jobs
      if (!isAuthenticated) {
        await fetchFeaturedJobs();
        return;
      }

      // Check profile completeness
      const statusResponse = await getOnboardingStatus();
      const completeness = statusResponse?.data?.profileCompleteness?.percentage || 0;
      setProfileCompleteness(completeness);

      console.log('📊 Profile completeness:', completeness);

      // Nếu profile >= 60%, thử lấy recommendations
      if (completeness >= 60) {
        try {
          console.log('🎯 Fetching recommendations...');
          const recResponse = await getRecommendations({ page: 1, limit: 6 });
          
          console.log('✅ Recommendations response:', recResponse);

          // Nếu có recommendations
          if (recResponse?.data?.length > 0) {
            const recommendedJobs = recResponse.data
              .filter(rec => rec.jobId) // Lọc những recommendation có job
              .map(rec => ({
                ...rec.jobId,
                recommendationScore: rec.score,
                recommendationReasons: rec.reasons
              }));

            if (recommendedJobs.length > 0) {
              console.log('✅ Using recommendations:', recommendedJobs.length);
              setJobs(recommendedJobs);
              setIsRecommendationsMode(true);
              return;
            }
          }

          // Nếu chưa có recommendations, tự động generate
          console.log('🔄 No recommendations found, auto-generating...');
          await autoGenerateRecommendations();
          
        } catch (err) {
          console.warn('⚠️ Failed to fetch recommendations, falling back to featured jobs:', err);
          await fetchFeaturedJobs();
        }
      } else {
        // Profile chưa đủ 60%, hiển thị featured jobs
        console.log('📝 Profile not complete enough (<60%), showing featured jobs');
        await fetchFeaturedJobs();
      }

    } catch (err) {
      console.error('❌ Error in fetchJobs:', err);
      setError('Không thể tải danh sách việc làm');
      setJobs([]);
    } finally {
      setIsLoading(false);
    }
  };

  const autoGenerateRecommendations = async () => {
    try {
      setIsGenerating(true);
      console.log('🚀 Generating recommendations...');
      
      const genResponse = await generateRecommendations({ limit: 20 });
      
      if (genResponse?.data?.recommendations?.length > 0) {
        const recommendedJobs = genResponse.data.recommendations
          .slice(0, 6)
          .map(rec => ({
            ...rec.job,
            recommendationScore: rec.score,
            recommendationReasons: rec.reasons
          }));

        console.log('✅ Generated and loaded recommendations:', recommendedJobs.length);
        setJobs(recommendedJobs);
        setIsRecommendationsMode(true);
      } else {
        console.log('⚠️ No recommendations generated, showing featured jobs');
        await fetchFeaturedJobs();
      }
    } catch (err) {
      console.error('❌ Error generating recommendations:', err);
      await fetchFeaturedJobs();
    } finally {
      setIsGenerating(false);
    }
  };

  const fetchFeaturedJobs = async () => {
    try {
      console.log('🔄 Fetching featured jobs...');
      const response = await getAllJobs({ page: 1, limit: 6, sortBy: 'newest' });

      if (response.data && response.data.success) {
        const jobsData = Array.isArray(response.data.data) ? response.data.data : [];
        console.log('✅ Featured jobs loaded:', jobsData.length);
        setJobs(jobsData);
        setIsRecommendationsMode(false);
      }
    } catch (err) {
      console.error('❌ Error fetching featured jobs:', err);
      throw err;
    }
  };

  const handleRefreshRecommendations = async () => {
    try {
      setIsGenerating(true);
      await autoGenerateRecommendations();
    } catch (err) {
      console.error('❌ Error refreshing:', err);
    }
  };

  const handleViewAll = () => {
    navigate(isRecommendationsMode ? '/jobs/recommended' : '/jobs/search');
  };

  const handleJobClick = (jobId) => {
    navigate(`/jobs/${jobId}`);
  };

  const renderReasonBadges = (reasons) => {
    if (!reasons || reasons.length === 0) return null;

    return (
      <div className="flex flex-wrap gap-2 mt-2">
        {reasons.slice(0, 2).map((reason, idx) => (
          <Badge
            key={idx}
            variant="outline"
            className="text-xs bg-emerald-50 text-emerald-700 border-emerald-200"
          >
            {reason.value}
          </Badge>
        ))}
      </div>
    );
  };

  return (
    <section className="py-20 bg-background">
      <div className="container">
        <SectionHeader
          badgeText={isRecommendationsMode ? '✨ Dành riêng cho bạn' : '⭐ Việc làm nổi bật'}
          title={
            isRecommendationsMode ? (
              <>
                Việc làm <span className="bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">phù hợp với bạn</span>
              </>
            ) : (
              <>
                Cơ hội nghề nghiệp <span className="bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">hàng đầu</span>
              </>
            )
          }
          description={
            isRecommendationsMode
              ? 'Những công việc được gợi ý dựa trên kỹ năng, kinh nghiệm và mong muốn của bạn.'
              : 'Khám phá những vị trí chất lượng từ các công ty uy tín, với mức lương hấp dẫn và môi trường chuyên nghiệp.'
          }
        />

        {/* Alert for profile completeness if not recommendations mode */}
        {isAuthenticated && !isRecommendationsMode && profileCompleteness < 60 && (
          <Alert className="mb-6 bg-amber-50 border-amber-200">
            <AlertCircle className="h-4 w-4 text-amber-600" />
            <AlertDescription className="text-amber-800">
              Hoàn thiện hồ sơ đến {profileCompleteness}%. Cần tối thiểu 60% để nhận gợi ý việc làm phù hợp với bạn.{' '}
              <Button
                variant="link"
                className="p-0 h-auto text-amber-700 font-semibold"
                onClick={() => navigate('/profile')}
              >
                Hoàn thiện ngay →
              </Button>
            </AlertDescription>
          </Alert>
        )}

        {/* Refresh button for recommendations */}
        {isRecommendationsMode && (
          <div className="flex justify-end mb-4">
            <Button
              variant="outline"
              size="sm"
              onClick={handleRefreshRecommendations}
              disabled={isGenerating}
              className="gap-2"
            >
              <RefreshCw className={`h-4 w-4 ${isGenerating ? 'animate-spin' : ''}`} />
              {isGenerating ? 'Đang cập nhật...' : 'Làm mới gợi ý'}
            </Button>
          </div>
        )}

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
          {isLoading ? (
            // Loading skeletons
            [...Array(6)].map((_, i) => (
              <Card key={i} className="h-80 shadow-lg">
                <CardContent className="p-6">
                  <div className="space-y-4">
                    <div className="flex items-start justify-between">
                      <Skeleton className="w-16 h-16 rounded-xl" />
                      <Skeleton className="w-12 h-12 rounded-full" />
                    </div>
                    <div className="space-y-3">
                      <Skeleton className="h-6 w-full" />
                      <Skeleton className="h-4 w-3/4" />
                    </div>
                    <div className="space-y-2">
                      <Skeleton className="h-5 w-1/2" />
                      <Skeleton className="h-4 w-2/3" />
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))
          ) : jobs.length > 0 ? (
            jobs.map((job) => (
              <Card
                key={job._id || job.id}
                className="group relative overflow-hidden border shadow-lg hover:shadow-2xl bg-card cursor-pointer transition-all duration-300 hover:-translate-y-1 rounded-2xl"
                onClick={() => handleJobClick(job._id || job.id)}
              >
                {/* Recommendation score badge */}
                {isRecommendationsMode && job.recommendationScore && (
                  <div className="absolute top-3 right-3 z-10">
                    <Badge className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-semibold">
                      <Sparkles className="w-3 h-3 mr-1" />
                      {job.recommendationScore}% phù hợp
                    </Badge>
                  </div>
                )}

                <CardHeader className="pb-3">
                  <div className="flex items-start space-x-4">
                    <Avatar className="w-16 h-16 flex-shrink-0">
                      <AvatarImage
                        src={job.recruiterProfileId?.company?.logo || job.company?.logo || ''}
                        alt={job.recruiterProfileId?.company?.name || job.company?.name || 'Logo'}
                      />
                      <AvatarFallback>
                        {(job.recruiterProfileId?.company?.name || job.company?.name || 'C')[0]}
                      </AvatarFallback>
                    </Avatar>
                    <div className="flex-1 min-w-0">
                      <CardTitle className="line-clamp-2 mb-1">{job.title || 'Không có tiêu đề'}</CardTitle>
                      <div className="flex flex-col gap-1 text-sm text-muted-foreground">
                        <div className="flex items-center gap-1">
                          <Building className="w-3 h-3 flex-shrink-0" />
                          <span className="truncate">
                            {job.recruiterProfileId?.company?.name || job.company?.name || 'Không rõ công ty'}
                          </span>
                        </div>
                        <div className="flex items-center gap-1">
                          <MapPin className="w-3 h-3 flex-shrink-0" />
                          <span className="truncate">
                            {job.location?.province
                              ? `${job.location.district ? job.location.district + ', ' : ''}${job.location.province}`
                              : 'Không rõ địa điểm'}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </CardHeader>

                <CardContent className="pt-0 pb-4">
                  <div className="flex flex-wrap gap-2">
                    <Badge variant="secondary" className="flex items-center gap-1">
                      <DollarSign className="w-3 h-3" />
                      {formatSalaryVND(job.minSalary, job.maxSalary)}
                    </Badge>
                    <Badge variant="secondary" className="flex items-center gap-1">
                      <Clock className="w-3 h-3" />
                      {formatWorkType(job.workType)}
                    </Badge>
                    <Badge variant="secondary" className="flex items-center gap-1">
                      <Briefcase className="w-3 h-3" />
                      {formatExperience(job.experience)}
                    </Badge>
                    {job.deadline && (
                      <Badge variant="secondary" className="flex items-center gap-1">
                        <Calendar className="w-3 h-3" />
                        {new Date(job.deadline).toLocaleDateString('vi-VN')}
                      </Badge>
                    )}
                  </div>

                  {/* Recommendation reasons */}
                  {isRecommendationsMode && renderReasonBadges(job.recommendationReasons)}
                </CardContent>

                <CardFooter className="border-t pt-3 flex justify-end items-center bg-transparent">
                  <Button
                    variant="ghost"
                    className="p-0 h-auto font-semibold text-green-700 group-hover:translate-x-1 transition-all duration-300 hover:text-green-800"
                    onClick={(e) => {
                      e.stopPropagation();
                      handleJobClick(job._id || job.id);
                    }}
                  >
                    Xem chi tiết <ArrowRight className="ml-1 h-4 w-4" />
                  </Button>
                </CardFooter>
              </Card>
            ))
          ) : (
            <div className="col-span-full text-center py-12">
              <p className="text-muted-foreground">Không tìm thấy việc làm phù hợp</p>
            </div>
          )}
        </div>

        <div className="text-center">
          <Button
            size="lg"
            className="px-8 py-6 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white transition-all duration-300 shadow-lg hover:shadow-xl rounded-2xl font-semibold"
            onClick={handleViewAll}
          >
            {isRecommendationsMode ? 'Xem tất cả gợi ý' : 'Xem tất cả việc làm'}
            <ArrowRight className="ml-2 h-5 w-5" />
          </Button>
        </div>
      </div>
    </section>
  );
};

export default RecommendedJobs;
</file>

<file path="src/components/sections/TRENDING_COMPANIES_EXAMPLES.md">
# Usage Examples - TrendingCompanies Component

## 1. Trang Landing Page (Full Featured - Grid)

```jsx
// src/pages/Home.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';

export default function Home() {
  return (
    <div>
      {/* Hero Section */}
      <HeroSection />
      
      {/* Popular Categories */}
      <PopularCategories />
      
      {/* Trending Companies - Full Featured */}
      <TrendingCompanies 
        limit={12} 
        showHeader={true} 
        variant="grid" 
      />
      
      {/* Featured Jobs */}
      <FeaturedJobs />
    </div>
  );
}
```

**Result**: Hiển thị 12 công ty ở dạng grid 4 cột với header đầy đủ, màu gradient orange-red-pink.

---

## 2. Sidebar Widget (Compact - List)

```jsx
// src/components/layout/Sidebar.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';

export default function Sidebar() {
  return (
    <aside className="w-80 space-y-6">
      {/* Profile Summary */}
      <ProfileCard />
      
      {/* Trending Companies - Compact */}
      <TrendingCompanies 
        limit={6} 
        showHeader={false} 
        variant="list" 
      />
      
      {/* Quick Links */}
      <QuickLinks />
    </aside>
  );
}
```

**Result**: Hiển thị 6 công ty dạng list compact, không có header, phù hợp sidebar.

---

## 3. Company Discovery Page (Grid - No Header)

```jsx
// src/pages/CompanyDiscovery.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';

export default function CompanyDiscovery() {
  return (
    <div className="container py-8">
      <div className="mb-8">
        <h1 className="text-3xl font-bold mb-2">Khám phá công ty</h1>
        <p className="text-muted-foreground">
          Tìm kiếm và kết nối với các nhà tuyển dụng hàng đầu
        </p>
      </div>

      {/* Search & Filters */}
      <CompanySearchFilters />

      {/* Trending Section */}
      <div className="mt-12">
        <h2 className="text-2xl font-bold mb-6">🔥 Công ty được săn đón nhất</h2>
        <TrendingCompanies 
          limit={8} 
          showHeader={false} 
          variant="grid" 
        />
      </div>

      {/* All Companies */}
      <AllCompaniesList />
    </div>
  );
}
```

**Result**: Grid 8 công ty không có section header (dùng custom heading), 4 cột responsive.

---

## 4. Dashboard Widget (Small Grid)

```jsx
// src/pages/dashboard/Dashboard.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';

export default function Dashboard() {
  return (
    <div className="space-y-6">
      {/* Welcome Banner */}
      <WelcomeBanner />

      {/* Stats Grid */}
      <StatsGrid />

      {/* Two Column Layout */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Recommended Jobs */}
        <Card>
          <CardHeader>
            <CardTitle>Việc làm phù hợp</CardTitle>
          </CardHeader>
          <CardContent>
            <RecommendedJobs />
          </CardContent>
        </Card>

        {/* Trending Companies */}
        <div>
          <TrendingCompanies 
            limit={4} 
            showHeader={true} 
            variant="grid" 
          />
        </div>
      </div>
    </div>
  );
}
```

**Result**: Grid 2x2 (4 companies) với header, hiển thị trong dashboard layout.

---

## 5. Job Detail Page (Sidebar - List)

```jsx
// src/pages/jobs/JobDetail.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';

export default function JobDetail() {
  return (
    <div className="container py-8">
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {/* Main Content - 2 columns */}
        <div className="lg:col-span-2">
          <JobDetailCard />
          <JobDescription />
          <CompanyInfo />
        </div>

        {/* Sidebar - 1 column */}
        <aside className="space-y-6">
          {/* Apply Button */}
          <ApplyButton />

          {/* Similar Jobs */}
          <SimilarJobs limit={3} />

          {/* Trending Companies */}
          <Card>
            <CardHeader>
              <CardTitle className="text-lg">Công ty hot</CardTitle>
            </CardHeader>
            <CardContent>
              <TrendingCompanies 
                limit={5} 
                showHeader={false} 
                variant="list" 
              />
            </CardContent>
          </Card>
        </aside>
      </div>
    </div>
  );
}
```

**Result**: List 5 công ty trong sidebar của job detail, compact format.

---

## 6. Company List Page (With Tabs)

```jsx
// src/pages/companies/CompanyList.jsx
import { useState } from 'react';
import TrendingCompanies from '@/components/sections/TrendingCompanies';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';

export default function CompanyList() {
  const [activeTab, setActiveTab] = useState('trending');

  return (
    <div className="container py-8">
      <h1 className="text-3xl font-bold mb-8">Danh sách công ty</h1>

      <Tabs value={activeTab} onValueChange={setActiveTab}>
        <TabsList className="mb-6">
          <TabsTrigger value="trending">🔥 Đang hot</TabsTrigger>
          <TabsTrigger value="featured">⭐ Nổi bật</TabsTrigger>
          <TabsTrigger value="all">📋 Tất cả</TabsTrigger>
        </TabsList>

        <TabsContent value="trending">
          <TrendingCompanies 
            limit={20} 
            showHeader={false} 
            variant="grid" 
          />
        </TabsContent>

        <TabsContent value="featured">
          <FeaturedCompanies limit={20} />
        </TabsContent>

        <TabsContent value="all">
          <AllCompanies />
        </TabsContent>
      </Tabs>
    </div>
  );
}
```

**Result**: Tab "Đang hot" hiển thị 20 công ty trending dạng grid.

---

## 7. Mobile Bottom Sheet (List)

```jsx
// src/components/mobile/CompaniesBottomSheet.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';
import { Sheet, SheetContent, SheetHeader, SheetTitle } from '@/components/ui/sheet';

export default function CompaniesBottomSheet({ open, onClose }) {
  return (
    <Sheet open={open} onOpenChange={onClose}>
      <SheetContent side="bottom" className="h-[80vh]">
        <SheetHeader>
          <SheetTitle>Công ty được săn đón</SheetTitle>
        </SheetHeader>
        
        <div className="mt-6 overflow-y-auto h-full pb-20">
          <TrendingCompanies 
            limit={10} 
            showHeader={false} 
            variant="list" 
          />
        </div>
      </SheetContent>
    </Sheet>
  );
}
```

**Result**: Bottom sheet mobile với list 10 công ty, scroll vertical.

---

## 8. Email Template (Static HTML)

```jsx
// src/services/email/templates/weeklyDigest.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';

export function WeeklyDigestEmail({ user }) {
  return (
    <EmailLayout>
      <EmailHeader>
        Chào {user.fullname}, đây là bản tin tuần này! 📬
      </EmailHeader>

      <EmailSection title="📊 Thống kê của bạn">
        <UserStats user={user} />
      </EmailSection>

      <EmailSection title="🔥 Công ty hot tuần này">
        <TrendingCompanies 
          limit={6} 
          showHeader={false} 
          variant="grid" 
        />
      </EmailSection>

      <EmailSection title="💼 Việc làm mới">
        <NewJobs limit={5} />
      </EmailSection>

      <EmailFooter />
    </EmailLayout>
  );
}
```

**Result**: Email digest với 6 công ty trending, 3 columns grid (2 rows).

---

## 9. Dialog/Modal (Compact Grid)

```jsx
// src/components/dialogs/ExploreCompaniesDialog.jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';

export default function ExploreCompaniesDialog({ open, onClose }) {
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="max-w-4xl max-h-[80vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Khám phá công ty hàng đầu</DialogTitle>
        </DialogHeader>

        <div className="mt-6">
          <TrendingCompanies 
            limit={8} 
            showHeader={false} 
            variant="grid" 
          />
        </div>

        <div className="flex justify-end gap-2 mt-6">
          <Button variant="outline" onClick={onClose}>Đóng</Button>
          <Button onClick={() => navigate('/companies')}>
            Xem tất cả công ty
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

**Result**: Dialog hiển thị 8 công ty grid 2x4, có buttons ở footer.

---

## 10. Search Results Page (Mixed Layout)

```jsx
// src/pages/search/SearchResults.jsx
import { useSearchParams } from 'react-router-dom';
import TrendingCompanies from '@/components/sections/TrendingCompanies';

export default function SearchResults() {
  const [searchParams] = useSearchParams();
  const query = searchParams.get('q');

  return (
    <div className="container py-8">
      <h1 className="text-2xl font-bold mb-6">
        Kết quả tìm kiếm: "{query}"
      </h1>

      {/* Search Results */}
      <div className="mb-12">
        <JobSearchResults query={query} />
      </div>

      {/* Related Companies */}
      {query && (
        <div className="border-t pt-12">
          <h2 className="text-xl font-bold mb-6">
            Công ty liên quan đến "{query}"
          </h2>
          <TrendingCompanies 
            limit={8} 
            showHeader={false} 
            variant="grid" 
          />
        </div>
      )}
    </div>
  );
}
```

**Result**: Hiển thị công ty liên quan đến search query dưới job results.

---

## 🎯 Best Practices

### When to use Grid
- ✅ Landing pages (full width)
- ✅ Discovery pages
- ✅ Dashboard main section
- ✅ Company listing pages
- ✅ Wide layouts (>1024px)

### When to use List
- ✅ Sidebars
- ✅ Narrow widgets
- ✅ Mobile views
- ✅ Bottom sheets
- ✅ Compact sections

### Limit Guidelines
- **4-6**: Small widgets, cards
- **8-12**: Standard sections
- **16-20**: Full pages, tabs
- **20+**: Use with pagination

### showHeader Usage
- `true`: Standalone sections, landing pages
- `false`: Integrated into custom layouts, widgets

---

## 🎨 Customization Examples

### Custom Wrapper
```jsx
<div className="bg-gradient-to-br from-purple-50 to-pink-50 py-16">
  <TrendingCompanies 
    limit={12} 
    showHeader={true} 
    variant="grid" 
  />
</div>
```

### With Custom Title
```jsx
<section>
  <div className="text-center mb-8">
    <h2 className="text-4xl font-bold mb-4">
      Các công ty <span className="text-primary">đáng chú ý</span>
    </h2>
    <p className="text-lg text-muted-foreground">
      Nơi có nhiều cơ hội việc làm nhất
    </p>
  </div>
  
  <TrendingCompanies 
    limit={8} 
    showHeader={false} 
    variant="grid" 
  />
</section>
```

### Conditional Rendering
```jsx
{isAuthenticated ? (
  <TrendingCompanies limit={12} variant="grid" />
) : (
  <TrendingCompanies limit={6} variant="list" />
)}
```
</file>

<file path="src/components/sections/TRENDING_COMPANIES_GUIDE.md">
# TrendingCompanies Component

Component cao cấp hiển thị **"Top công ty được săn đón nhất"** với nhiều tùy chọn hiển thị và tính năng nâng cao.

## 📍 Vị trí
```
src/components/sections/TrendingCompanies.jsx
```

## 🎯 Khác biệt so với TopCompanies

| Feature | TopCompanies | TrendingCompanies |
|---------|--------------|-------------------|
| Use case | Landing page | Anywhere (landing, pages, dashboard) |
| Variants | Grid only | Grid + List |
| Customization | Fixed | Props-based |
| Limit | Fixed 6 | Configurable (default 12) |
| Header | Always show | Optional |
| Styling | Emerald/Teal | Orange/Red/Pink |
| Animation | Basic | Enhanced |
| Ranking | Top 1-3 badges | Enhanced with sparkles |

## 🎨 Props

```jsx
<TrendingCompanies 
  limit={12}           // Số lượng công ty (default: 12)
  showHeader={true}    // Hiển thị header (default: true)
  variant="grid"       // "grid" | "list" (default: "grid")
/>
```

### Props Detail

#### `limit` (number)
- **Default**: `12`
- **Description**: Số lượng công ty tối đa hiển thị
- **Examples**: 
  - `limit={6}` - Hiển thị 6 công ty
  - `limit={20}` - Hiển thị 20 công ty

#### `showHeader` (boolean)
- **Default**: `true`
- **Description**: Hiển thị section header với title và description
- **Use cases**:
  - `showHeader={true}` - Trang landing, trang chính
  - `showHeader={false}` - Sidebar, widget nhỏ

#### `variant` (string)
- **Default**: `"grid"`
- **Options**: `"grid"` | `"list"`
- **Description**: Kiểu hiển thị layout
- **Use cases**:
  - `variant="grid"` - Trang chính, landing page
  - `variant="list"` - Sidebar, compact view

## 🎨 Visual Design

### Grid Variant
```
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ 🏆 Top 1    │ │ 🥈 Top 2    │ │ 🥉 Top 3    │ │   #4        │
│    [Logo]   │ │    [Logo]   │ │    [Logo]   │ │   [Logo]    │
│  ✨ Sparkle │ │  ✨ Sparkle │ │  ✨ Sparkle │ │             │
│             │ │             │ │             │ │             │
│ Company Name│ │ Company Name│ │ Company Name│ │ Company Name│
│  Industry   │ │  Industry   │ │  Industry   │ │  Industry   │
│             │ │             │ │             │ │             │
│ ┌─────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │ │ ┌─────────┐ │
│ │💼 5 jobs│ │ │ │💼 5 jobs│ │ │ │💼 5 jobs│ │ │ │💼 5 jobs│ │
│ └─────────┘ │ │ └─────────┘ │ │ └─────────┘ │ │ └─────────┘ │
│ 👥 1K  📍 HN│ │ 👥 1K  📍 HN│ │ 👥 1K  📍 HN│ │ 👥 1K  📍 HN│
│             │ │             │ │             │ │             │
│ [Xem công ty│ │ [Xem công ty│ │ [Xem công ty│ │ [Xem công ty│
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
```

### List Variant
```
┌──────────────────────────────────────────────────────────────┐
│ [1] [Logo] Company Name ⭐        💼 5 việc làm 👥 1K+ 📍 HN →│
├──────────────────────────────────────────────────────────────┤
│ [2] [Logo] Company Name ⭐        💼 5 việc làm 👥 1K+ 📍 HN →│
├──────────────────────────────────────────────────────────────┤
│ [3] [Logo] Company Name ⭐        💼 5 việc làm 👥 1K+ 📍 HN →│
├──────────────────────────────────────────────────────────────┤
│ [4] [Logo] Company Name           💼 5 việc làm 👥 1K+ 📍 HN →│
└──────────────────────────────────────────────────────────────┘
```

## 🎯 UI Features

### 1. **Enhanced Ranking System**

#### Top 1 (Gold)
- 🏆 Gold badge: `from-yellow-400 to-yellow-600`
- ⭐ Star icon
- ✨ Sparkle animation (absolute positioned)
- Hover: Scale + glow effect

#### Top 2 (Silver)
- 🥈 Silver badge: `from-gray-300 to-gray-500`
- ⭐ Star icon
- ✨ Sparkle animation

#### Top 3 (Bronze)
- 🥉 Bronze badge: `from-orange-400 to-orange-600`
- ⭐ Star icon
- ✨ Sparkle animation

#### Rank 4+
- Number badge: `bg-muted text-muted-foreground`
- No star, no sparkle

### 2. **Job Count Highlight**
```jsx
<div className="bg-emerald-50 dark:bg-emerald-950/20 border border-emerald-200">
  💼 5 tin tuyển dụng
</div>
```
- Prominent display with emerald background
- Dark mode support
- Bold font for number

### 3. **Hover Effects**

#### Grid Cards
- Border: `border-border/50` → `border-primary/30`
- Shadow: `shadow` → `shadow-xl`
- Company name: `text-foreground` → `text-primary`
- Logo border: `border-border/50` → `border-primary/50`
- Button arrow: Translate X animation

#### List Items
- Background: `bg-card` → `bg-accent/50`
- Arrow: Translate X + color change
- All transitions: `duration-200`

### 4. **Color Scheme**
- **Primary**: Orange → Red → Pink gradient
- **Accent**: Emerald for job counts
- **Rankings**: Gold/Silver/Bronze
- **Muted**: For secondary info

## 📱 Responsive Grid

### Grid Variant
```css
grid-cols-1           /* Mobile: 1 column */
md:grid-cols-2        /* Tablet: 2 columns */
lg:grid-cols-3        /* Desktop: 3 columns */
xl:grid-cols-4        /* Large: 4 columns */
```

### List Variant
- Always 1 column
- Compact layout optimized for narrow spaces

## 🔄 States

### 1. Loading State
- **Grid**: Skeleton cards với số lượng = `limit`
- **List**: 6 skeleton rows
- Animation: Pulse effect

### 2. Error State
- Destructive icon color
- Error message: "Không thể tải danh sách công ty"
- Retry button: "Tải lại trang"

### 3. Empty State
- Muted icon
- Message: "Chưa có dữ liệu công ty"
- CTA button: "Khám phá công ty"

### 4. Success State
- Show companies based on variant
- Show "View All" button at bottom

## 🎯 User Interactions

### Grid Variant
1. **Click on card** → Navigate to company detail
2. **Click on "Xem công ty" button** → Navigate to company detail
3. **Click on "Khám phá tất cả công ty"** → Navigate to companies list

### List Variant
1. **Click on row** → Navigate to company detail
2. **Hover** → Show arrow translate effect

## 🔗 Usage Examples

### 1. Landing Page (Full Featured)
```jsx
import TrendingCompanies from '@/components/sections/TrendingCompanies';

<TrendingCompanies 
  limit={12} 
  showHeader={true} 
  variant="grid" 
/>
```

### 2. Sidebar Widget (Compact)
```jsx
<TrendingCompanies 
  limit={6} 
  showHeader={false} 
  variant="list" 
/>
```

### 3. Company Page (Grid Without Header)
```jsx
<TrendingCompanies 
  limit={8} 
  showHeader={false} 
  variant="grid" 
/>
```

### 4. Dashboard Section
```jsx
<TrendingCompanies 
  limit={4} 
  showHeader={true} 
  variant="grid" 
/>
```

## 🎨 Styling Customization

### Header
```jsx
<SectionHeader
  badgeText="🔥 Đang hot"
  title={<>Top công ty <span className="gradient">được săn đón nhất</span></>}
/>
```

### Gradient Classes
- Header gradient: `from-orange-600 via-red-600 to-pink-600`
- Button gradient: Same as header
- Job count: `from-emerald-50 to-emerald-950/20`

### Border & Background
- Card border: `border-border/50 hover:border-primary/30`
- Card background: `bg-card hover:shadow-xl`
- List hover: `bg-card hover:bg-accent/50`

## 🔧 Dependencies

```jsx
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { 
  Building2, Users, Briefcase, MapPin, TrendingUp, 
  Star, Award, ArrowRight, Sparkles, Target 
} from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { Avatar, AvatarImage, AvatarFallback } from '../ui/avatar';
import { Skeleton } from '../ui/skeleton';
import { SectionHeader } from '../common/SectionHeader';
import apiClient from '../../services/apiClient';
```

## 📊 Data Flow

```
API Call: GET /analytics/top-companies?limit={limit}
    ↓
React Query (cache 5min)
    ↓
Transform & Sort by activeJobCount DESC
    ↓
Render based on variant (grid/list)
    ↓
User interaction → Navigate
```

## 🧪 Testing Checklist

### Grid Variant
- [ ] Loading state shows correct number of skeletons
- [ ] Top 3 show gold/silver/bronze badges
- [ ] Top 3 show sparkle animations
- [ ] Top 3 show star icons
- [ ] Hover effects work smoothly
- [ ] Cards are clickable
- [ ] "Xem công ty" button works
- [ ] "Khám phá tất cả" button works
- [ ] Responsive grid on mobile/tablet/desktop
- [ ] Logo fallback shows first letter
- [ ] Job count highlighted in emerald
- [ ] Empty state shows correctly
- [ ] Error state shows correctly

### List Variant
- [ ] Loading shows 6 skeleton rows
- [ ] Rank numbers show correctly
- [ ] Top 3 have colored backgrounds
- [ ] Top 3 show star icons
- [ ] Hover shows arrow translate
- [ ] Rows are clickable
- [ ] Stats display correctly
- [ ] Responsive on narrow screens

### Props
- [ ] `limit` prop changes number of items
- [ ] `showHeader={false}` hides header
- [ ] `variant="list"` shows list layout
- [ ] `variant="grid"` shows grid layout

## 📈 Performance

- **React Query**: 
  - Query key includes `limit` for cache separation
  - staleTime: 5 minutes
  - cacheTime: 10 minutes
- **Render Optimization**: 
  - Conditional rendering based on variant
  - Memoized with query dependencies
- **Image Loading**: 
  - Avatar component with lazy loading
  - Fallback with first letter

## 🎨 Animation Details

### Sparkle Effect
```jsx
<Sparkles className="h-5 w-5 text-yellow-500 animate-pulse" />
```
- Only on top 3 companies
- Absolute positioned top-right of logo
- Pulse animation

### Button Hover
```jsx
<ArrowRight className="group-hover:translate-x-1 transition-transform" />
```
- Translates 0.25rem to right
- Smooth transition

### Award Icon Hover
```jsx
<Award className="group-hover:rotate-12 transition-transform" />
```
- Rotates 12 degrees on hover
- In "View All" button

## 🔮 Future Enhancements

- [ ] Add filter by industry
- [ ] Add filter by location
- [ ] Add sorting options (jobs, employees, rating)
- [ ] Add pagination for large lists
- [ ] Add "Follow" button
- [ ] Add company rating display
- [ ] Add verified badge for verified companies
- [ ] Add "Recently viewed" section
- [ ] Add infinite scroll for list variant
- [ ] Add search/filter overlay
- [ ] Add company comparison feature
- [ ] Add export to PDF feature
- [ ] Add bookmark/save feature
- [ ] Add share button
- [ ] Add company growth indicator
</file>

<file path="src/components/ui/accordion.jsx">
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item ref={ref} className={cn("border-b", className)} {...props} />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}>
      {children}
      <ChevronDown
        className="h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}>
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))
AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }
</file>

<file path="src/components/ui/alert-dialog.jsx">
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref} />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props} />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}) => (
  <div
    className={cn("flex flex-col space-y-2 text-center sm:text-left", className)}
    {...props} />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}) => (
  <div
    className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2", className)}
    {...props} />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title ref={ref} className={cn("text-lg font-semibold", className)} {...props} />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props} />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action ref={ref} className={cn(buttonVariants(), className)} {...props} />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(buttonVariants({ variant: "outline" }), "mt-2 sm:mt-0", className)}
    {...props} />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}
</file>

<file path="src/components/ui/card.jsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("rounded-xl border bg-card text-card-foreground shadow", className)}
    {...props} />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props} />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("font-semibold leading-none tracking-tight", className)}
    {...props} />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props} />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props} />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
</file>

<file path="src/components/ui/checkbox.jsx">
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}>
    <CheckboxPrimitive.Indicator className={cn("flex items-center justify-center text-current")}>
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }
</file>

<file path="src/components/ui/dialog.jsx">
import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({
  ...props
}) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({
  ...props
}) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({
  ...props
}) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({
  className,
  ...props
}) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props} />
  );
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}>
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({
  className,
  ...props
}) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props} />
  );
}

function DialogFooter({
  className,
  ...props
}) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props} />
  );
}

function DialogTitle({
  className,
  ...props
}) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props} />
  );
}

function DialogDescription({
  className,
  ...props
}) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props} />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}
</file>

<file path="src/components/ui/pagination.jsx">
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button";

const Pagination = ({
  className,
  ...props
}) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props} />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props} />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(buttonVariants({
      variant: isActive ? "outline" : "ghost",
      size,
    }), className)}
    {...props} />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}>
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}>
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}>
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
}
</file>

<file path="src/components/ui/progress.jsx">
import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-2 w-full overflow-hidden rounded-full bg-primary/20",
      className
    )}
    {...props}>
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }} />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }
</file>

<file path="src/components/ui/radio-group.jsx">
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function RadioGroup({
  className,
  ...props
}) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn("grid gap-3", className)}
      {...props} />
  );
}

function RadioGroupItem({
  className,
  ...props
}) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}>
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center">
        <CircleIcon
          className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
}

export { RadioGroup, RadioGroupItem }
</file>

<file path="src/components/ui/scroll-area.jsx">
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}>
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}>
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }
</file>

<file path="src/components/ui/select.jsx">
import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}) {
  return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({
  ...props
}) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({
  ...props
}) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}>
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  );
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-32 origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        {...props}>
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn("p-1", position === "popper" &&
            "h-(--radix-select-trigger-height) w-full min-w-(--radix-select-trigger-width) scroll-my-1")}>
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  );
}

function SelectLabel({
  className,
  ...props
}) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props} />
  );
}

function SelectItem({
  className,
  children,
  ...props
}) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-disabled:pointer-events-none data-disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className
      )}
      {...props}>
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  );
}

function SelectSeparator({
  className,
  ...props
}) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props} />
  );
}

function SelectScrollUpButton({
  className,
  ...props
}) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn("flex cursor-default items-center justify-center py-1", className)}
      {...props}>
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  );
}

function SelectScrollDownButton({
  className,
  ...props
}) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn("flex cursor-default items-center justify-center py-1", className)}
      {...props}>
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  );
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="src/components/ui/separator.jsx">
import { cn } from "@/lib/utils"

const Separator = ({ className, orientation = "horizontal", ...props }) => {
  return (
    <div
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-px w-full" : "h-full w-px",
        className
      )}
      {...props}
    />
  )
}

export { Separator }
</file>

<file path="src/components/ui/slider.jsx">
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef(({ className, ...props }, ref) => {
  const value = props.value || props.defaultValue || [0];
  
  return (
    <SliderPrimitive.Root
      ref={ref}
      className={cn("relative flex w-full touch-none select-none items-center", className)}
      {...props}>
      <SliderPrimitive.Track
        className="relative h-2 w-full grow overflow-hidden rounded-full bg-primary/20">
        <SliderPrimitive.Range className="absolute h-full bg-gradient-to-r from-emerald-600 to-green-600" />
      </SliderPrimitive.Track>
      {value.map((_, index) => (
        <SliderPrimitive.Thumb
          key={index}
          className="block h-5 w-5 rounded-full border-2 border-primary bg-background shadow-lg transition-colors hover:bg-primary/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
      ))}
    </SliderPrimitive.Root>
  );
})
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }
</file>

<file path="src/components/ui/sonner.jsx">
import { useTheme } from "next-themes"
import { Toaster as Sonner } from "sonner";

const Toaster = ({
  ...props
}) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme}
      className="toaster group"
      position="top-center"
      offset="39px"
      closeButton={true}
      richColors
      toastOptions={{
        style: {
          padding: '16px',
          gap: '12px',
          borderRadius: '8px',
          border: '1px solid var(--border)',
          boxShadow: '0 4px 12px rgba(0, 0, 0, 0.1)',
          minWidth: '400px',
        },
        classNames: {
          toast: 'group toast group-[.toaster]:bg-popover group-[.toaster]:text-popover-foreground group-[.toaster]:border-border',
          description: 'group-[.toast]:text-muted-foreground',
          actionButton: 'group-[.toast]:bg-primary group-[.toast]:text-primary-foreground',
          cancelButton: 'group-[.toast]:bg-muted group-[.toast]:text-muted-foreground',
          closeButton: 'group-[.toast]:bg-transparent group-[.toast]:text-red-500 group-[.toast]:border-0 hover:group-[.toast]:bg-red-500/10 hover:group-[.toast]:text-red-600 group-[.toast]:absolute group-[.toast]:right-2 group-[.toast]:top-1/2 group-[.toast]:-translate-y-1/2 group-[.toast]:left-auto',
        },
      }}
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)"
        }
      }
      {...props} />
  );
}

export { Toaster }
</file>

<file path="src/components/ui/switch.jsx">
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}>
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }
</file>

<file path="src/components/ui/table.jsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props} />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props} />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0", className)}
    {...props} />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props} />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
      className
    )}
    {...props} />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn(
      "p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
      className
    )}
    {...props} />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props} />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="src/components/ui/tabs.jsx">
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }
</file>

<file path="src/components/ui/textarea.jsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Textarea({
  className,
  ...props
}) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      {...props} />
  );
}

export { Textarea }
</file>

<file path="src/components/ui/tooltip.jsx">
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Portal>
    <TooltipPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",
        className
      )}
      {...props} />
  </TooltipPrimitive.Portal>
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
</file>

<file path="src/constants/creditTransaction.js">
/**
 * Credit Transaction Constants
 * Định nghĩa các hằng số cho hệ thống giao dịch xu (credit)
 */

// Transaction types
export const TRANSACTION_TYPES = {
  DEPOSIT: 'DEPOSIT',
  USAGE: 'USAGE'
};

// Transaction categories
export const TRANSACTION_CATEGORIES = {
  // Deposit categories
  RECHARGE: 'RECHARGE',
  
  // Usage categories
  JOB_VIEW: 'JOB_VIEW',
  CV_UNLOCK: 'CV_UNLOCK',
  PROFILE_BOOST: 'PROFILE_BOOST',
  JOB_POST: 'JOB_POST',
  PREMIUM_FEATURE: 'PREMIUM_FEATURE'
};

// Category display names (Vietnamese)
export const CATEGORY_LABELS = {
  [TRANSACTION_CATEGORIES.RECHARGE]: 'Nạp xu',
  [TRANSACTION_CATEGORIES.JOB_VIEW]: 'Xem số lượng ứng viên',
  [TRANSACTION_CATEGORIES.CV_UNLOCK]: 'Mở khóa hồ sơ ứng viên',
  [TRANSACTION_CATEGORIES.PROFILE_BOOST]: 'Nâng cấp hồ sơ',
  [TRANSACTION_CATEGORIES.JOB_POST]: 'Đăng tin tuyển dụng',
  [TRANSACTION_CATEGORIES.PREMIUM_FEATURE]: 'Tính năng cao cấp'
};

// Role-based category descriptions
export const CANDIDATE_CATEGORIES = [
  TRANSACTION_CATEGORIES.RECHARGE,
  TRANSACTION_CATEGORIES.PROFILE_BOOST,
  TRANSACTION_CATEGORIES.PREMIUM_FEATURE
];

export const RECRUITER_CATEGORIES = [
  TRANSACTION_CATEGORIES.RECHARGE,
  TRANSACTION_CATEGORIES.JOB_VIEW,
  TRANSACTION_CATEGORIES.CV_UNLOCK,
  TRANSACTION_CATEGORIES.JOB_POST,
  TRANSACTION_CATEGORIES.PREMIUM_FEATURE
];

// Transaction type display names (Vietnamese)
export const TRANSACTION_TYPE_LABELS = {
  [TRANSACTION_TYPES.DEPOSIT]: 'Nạp xu',
  [TRANSACTION_TYPES.USAGE]: 'Sử dụng xu'
};
</file>

<file path="src/constants/jobAlertEnums.js">
// Job Alert Enums matching backend

export const FREQUENCY_OPTIONS = [
  { value: 'daily', label: 'Hàng ngày' },
  { value: 'weekly', label: 'Hàng tuần' },
];

export const SALARY_RANGE_OPTIONS = [
  { value: 'ALL', label: 'Tất cả mức lương' },
  { value: 'UNDER_10M', label: 'Dưới 10 triệu' },
  { value: '10M_20M', label: '10 - 20 triệu' },
  { value: '20M_30M', label: '20 - 30 triệu' },
  { value: 'OVER_30M', label: 'Trên 30 triệu' },
];

export const JOB_TYPE_OPTIONS = [
  { value: 'ALL', label: 'Tất cả loại hình' },
  { value: 'FULL_TIME', label: 'Toàn thời gian' },
  { value: 'PART_TIME', label: 'Bán thời gian' },
  { value: 'CONTRACT', label: 'Hợp đồng' },
  { value: 'INTERNSHIP', label: 'Thực tập' },
  { value: 'TEMPORARY', label: 'Tạm thời' },
  { value: 'VOLUNTEER', label: 'Tình nguyện' },
  { value: 'FREELANCE', label: 'Freelance' },
];

export const WORK_TYPE_OPTIONS = [
  { value: 'ALL', label: 'Tất cả hình thức' },
  { value: 'ON_SITE', label: 'Tại văn phòng' },
  { value: 'REMOTE', label: 'Từ xa' },
  { value: 'HYBRID', label: 'Kết hợp' },
];

export const EXPERIENCE_OPTIONS = [
  { value: 'ALL', label: 'Tất cả kinh nghiệm' },
  { value: 'NO_EXPERIENCE', label: 'Không yêu cầu' },
  { value: 'INTERN', label: 'Thực tập sinh' },
  { value: 'FRESHER', label: 'Fresher' },
  { value: 'ENTRY_LEVEL', label: 'Junior' },
  { value: 'MID_LEVEL', label: 'Middle' },
  { value: 'SENIOR_LEVEL', label: 'Senior' },
  { value: 'EXECUTIVE', label: 'Quản lý' },
];

export const CATEGORY_OPTIONS = [
  { value: 'ALL', label: 'Tất cả ngành nghề' },
  { value: 'IT', label: 'Công nghệ thông tin' },
  { value: 'SOFTWARE_DEVELOPMENT', label: 'Phát triển phần mềm' },
  { value: 'DATA_SCIENCE', label: 'Khoa học dữ liệu' },
  { value: 'MACHINE_LEARNING', label: 'Machine Learning' },
  { value: 'WEB_DEVELOPMENT', label: 'Phát triển Web' },
  { value: 'SALES', label: 'Kinh doanh' },
  { value: 'MARKETING', label: 'Marketing' },
  { value: 'ACCOUNTING', label: 'Kế toán' },
  { value: 'GRAPHIC_DESIGN', label: 'Thiết kế đồ họa' },
  { value: 'CONTENT_WRITING', label: 'Viết nội dung' },
  { value: 'MEDICAL', label: 'Y tế' },
  { value: 'TEACHING', label: 'Giáo dục' },
  { value: 'ENGINEERING', label: 'Kỹ thuật' },
  { value: 'PRODUCTION', label: 'Sản xuất' },
  { value: 'LOGISTICS', label: 'Logistics' },
  { value: 'HOSPITALITY', label: 'Khách sạn - Nhà hàng' },
  { value: 'REAL_ESTATE', label: 'Bất động sản' },
  { value: 'LAW', label: 'Luật' },
  { value: 'FINANCE', label: 'Tài chính' },
  { value: 'HUMAN_RESOURCES', label: 'Nhân sự' },
  { value: 'CUSTOMER_SERVICE', label: 'Dịch vụ khách hàng' },
  { value: 'ADMINISTRATION', label: 'Hành chính' },
  { value: 'MANAGEMENT', label: 'Quản lý' },
  { value: 'OTHER', label: 'Khác' },
];

export const NOTIFICATION_METHOD_OPTIONS = [
  { value: 'APPLICATION', label: 'Trong ứng dụng' },
  { value: 'EMAIL', label: 'Email' },
  { value: 'BOTH', label: 'Cả hai' },
];

// Helper functions to get label from value
export const getFrequencyLabel = (value) => {
  return FREQUENCY_OPTIONS.find(opt => opt.value === value)?.label || value;
};

export const getSalaryRangeLabel = (value) => {
  return SALARY_RANGE_OPTIONS.find(opt => opt.value === value)?.label || value;
};

export const getJobTypeLabel = (value) => {
  return JOB_TYPE_OPTIONS.find(opt => opt.value === value)?.label || value;
};

export const getWorkTypeLabel = (value) => {
  return WORK_TYPE_OPTIONS.find(opt => opt.value === value)?.label || value;
};

export const getExperienceLabel = (value) => {
  return EXPERIENCE_OPTIONS.find(opt => opt.value === value)?.label || value;
};

export const getCategoryLabel = (value) => {
  return CATEGORY_OPTIONS.find(opt => opt.value === value)?.label || value;
};

export const getNotificationMethodLabel = (value) => {
  return NOTIFICATION_METHOD_OPTIONS.find(opt => opt.value === value)?.label || value;
};
</file>

<file path="src/constants/jobCategories.js">
/**
 * Job Categories Constants
 * Danh sách các ngành nghề và labels tiếng Việt
 */

export const JOB_CATEGORIES = [
  { value: 'IT', label: 'Công nghệ thông tin', icon: '💻' },
  { value: 'SOFTWARE_DEVELOPMENT', label: 'Phát triển phần mềm', icon: '⚙️' },
  { value: 'DATA_SCIENCE', label: 'Khoa học dữ liệu', icon: '📊' },
  { value: 'MACHINE_LEARNING', label: 'Machine Learning/AI', icon: '🤖' },
  { value: 'WEB_DEVELOPMENT', label: 'Phát triển Web', icon: '🌐' },
  { value: 'SALES', label: 'Kinh doanh/Bán hàng', icon: '💼' },
  { value: 'MARKETING', label: 'Marketing', icon: '📣' },
  { value: 'ACCOUNTING', label: 'Kế toán', icon: '💰' },
  { value: 'GRAPHIC_DESIGN', label: 'Thiết kế đồ họa', icon: '🎨' },
  { value: 'CONTENT_WRITING', label: 'Biên tập nội dung', icon: '✍️' },
  { value: 'MEDICAL', label: 'Y tế/Chăm sóc sức khỏe', icon: '⚕️' },
  { value: 'TEACHING', label: 'Giáo dục/Đào tạo', icon: '👨‍🏫' },
  { value: 'ENGINEERING', label: 'Kỹ thuật/Công nghệ', icon: '🔧' },
  { value: 'PRODUCTION', label: 'Sản xuất', icon: '🏭' },
  { value: 'LOGISTICS', label: 'Logistics/Vận chuyển', icon: '🚚' },
  { value: 'HOSPITALITY', label: 'Khách sạn/Du lịch', icon: '🏨' },
  { value: 'REAL_ESTATE', label: 'Bất động sản', icon: '🏢' },
  { value: 'LAW', label: 'Luật/Pháp lý', icon: '⚖️' },
  { value: 'FINANCE', label: 'Tài chính/Ngân hàng', icon: '🏦' },
  { value: 'HUMAN_RESOURCES', label: 'Nhân sự', icon: '👥' },
  { value: 'CUSTOMER_SERVICE', label: 'Dịch vụ khách hàng', icon: '📞' },
  { value: 'ADMINISTRATION', label: 'Hành chính/Văn phòng', icon: '📋' },
  { value: 'MANAGEMENT', label: 'Quản lý', icon: '👔' },
  { value: 'OTHER', label: 'Khác', icon: '📂' }
];

// Helper function to get label by value
export const getCategoryLabel = (value) => {
  const category = JOB_CATEGORIES.find(cat => cat.value === value);
  return category ? category.label : value;
};

// Helper function to get icon by value
export const getCategoryIcon = (value) => {
  const category = JOB_CATEGORIES.find(cat => cat.value === value);
  return category ? category.icon : '📂';
};

// Group categories by type for better UI organization
export const CATEGORY_GROUPS = {
  'Công nghệ': [
    'IT',
    'SOFTWARE_DEVELOPMENT',
    'DATA_SCIENCE',
    'MACHINE_LEARNING',
    'WEB_DEVELOPMENT'
  ],
  'Kinh doanh': [
    'SALES',
    'MARKETING',
    'ACCOUNTING',
    'FINANCE'
  ],
  'Sáng tạo': [
    'GRAPHIC_DESIGN',
    'CONTENT_WRITING'
  ],
  'Y tế & Giáo dục': [
    'MEDICAL',
    'TEACHING'
  ],
  'Kỹ thuật & Sản xuất': [
    'ENGINEERING',
    'PRODUCTION',
    'LOGISTICS'
  ],
  'Dịch vụ': [
    'HOSPITALITY',
    'CUSTOMER_SERVICE'
  ],
  'Chuyên môn': [
    'LAW',
    'REAL_ESTATE',
    'HUMAN_RESOURCES',
    'ADMINISTRATION',
    'MANAGEMENT'
  ],
  'Khác': [
    'OTHER'
  ]
};

// Popular categories (for quick selection)
export const POPULAR_CATEGORIES = [
  'IT',
  'SOFTWARE_DEVELOPMENT',
  'SALES',
  'MARKETING',
  'ACCOUNTING',
  'CUSTOMER_SERVICE'
];

export default JOB_CATEGORIES;
</file>

<file path="src/constants/locations.js">
export const provinceNames = [
  'Thành phố Hà Nội',
  'Thành phố Hồ Chí Minh',
  'Thành phố Đà Nẵng',
  'Tỉnh Hải Dương',
  'Tỉnh Hưng Yên',
];

const locationData = [
  {
    name: 'Thành phố Hà Nội',
    districts: [
      { name: 'Quận Ba Đình' },
      { name: 'Quận Hoàn Kiếm' },
      { name: 'Quận Hai Bà Trưng' },
      { name: 'Quận Đống Đa' },
      { name: 'Quận Tây Hồ' },
      { name: 'Quận Cầu Giấy' },
      { name: 'Quận Thanh Xuân' },
      { name: 'Quận Hoàng Mai' },
      { name: 'Quận Long Biên' },
      { name: 'Huyện Từ Liêm' },
    ],
  },
  {
    name: 'Thành phố Hồ Chí Minh',
    districts: [
      { name: 'Quận 1' },
      { name: 'Quận 3' },
      { name: 'Quận 4' },
      { name: 'Quận 5' },
      { name: 'Quận 6' },
      { name: 'Quận 7' },
      { name: 'Quận 8' },
      { name: 'Quận 10' },
      { name: 'Quận 11' },
      { name: 'Quận 12' },
      { name: 'Quận Bình Thạnh' },
      { name: 'Quận Phú Nhuận' },
      { name: 'Quận Gò Vấp' },
      { name: 'Quận Tân Bình' },
      { name: 'Quận Tân Phú' },
      { name: 'Thành phố Thủ Đức' },
    ],
  },
  {
    name: 'Thành phố Đà Nẵng',
    districts: [
      { name: 'Quận Hải Châu' },
      { name: 'Quận Thanh Khê' },
      { name: 'Quận Sơn Trà' },
      { name: 'Quận Ngũ Hành Sơn' },
      { name: 'Quận Liên Chiểu' },
      { name: 'Huyện Hòa Vang' },
    ],
  },
  {
    name: 'Tỉnh Hải Dương',
    districts: [
        { name: 'Thành phố Hải Dương' },
        { name: 'Thành phố Chí Linh' },
        { name: 'Huyện Nam Sách' },
        { name: 'Huyện Kinh Môn' },
        { name: 'Huyện Gia Lộc' },
        { name: 'Huyện Tứ Kỳ' },
        { name: 'Huyện Thanh Miện' },
        { name: 'Huyện Ninh Giang' },
        { name: 'Huyện Cẩm Giàng' },
        { name: 'Huyện Thanh Hà' },
        { name: 'Huyện Kim Thành' },
        { name: 'Huyện Bình Giang' },
    ],
  },
  {
    name: 'Tỉnh Hưng Yên',
    districts: [
        { name: 'Thành phố Hưng Yên' },
        { name: 'Huyện Văn Lâm' },
        { name: 'Huyện Văn Giang' },
        { name: 'Huyện Mỹ Hào' },
        { name: 'Huyện Yên Mỹ' },
        { name: 'Huyện Khoái Châu' },
        { name: 'Huyện Ân Thi' },
        { name: 'Huyện Tiên Lữ' },
        { name: 'Huyện Phù Cừ' },
        { name: 'Huyện Kim Động' },
    ],
  },
];

export const locationMap = new Map(locationData.map(p => [p.name, { districts: p.districts }]));
</file>

<file path="src/contexts/backgroundConfig.js">
// Default configuration for background - Enhanced for more prominent effects
export const DEFAULT_BACKGROUND_CONFIG = {
  particleDensity: 'high',     // Increased from 'medium' to 'high' for more particles
  animationSpeed: 'normal',
  gradientIntensity: 'strong', // Increased from 'medium' to 'strong' for more visible gradients
  enabled: true
};

export const BACKGROUND_CONFIG_DEFAULTS = {
  particleDensity: 'high',     // Enhanced particle density
  animationSpeed: 'normal',
  gradientIntensity: 'strong', // Enhanced gradient intensity
  enabled: true
};
</file>

<file path="src/contexts/BackgroundContext.jsx">
import React, { createContext, useContext, useState, useEffect, useCallback, useMemo } from 'react';
import { DEFAULT_BACKGROUND_CONFIG, BACKGROUND_CONFIG_DEFAULTS } from './backgroundConfig';

/**
 * Context for managing global animated background state
 */
const BackgroundContext = createContext();

export const useBackground = () => {
  const context = useContext(BackgroundContext);
  if (!context) {
    throw new Error('useBackground must be used within a BackgroundProvider');
  }
  return context;
};

export const BackgroundProvider = ({ children }) => {
  const [config, setConfig] = useState(() => {
    // Load from localStorage if available
    const saved = localStorage.getItem('careerzone-background-config');
    if (saved) {
      try {
        return JSON.parse(saved);
      } catch (error) {
        console.warn('Failed to parse saved background config:', error);
      }
    }
    
    // Default configuration
    return DEFAULT_BACKGROUND_CONFIG;
  });


  // Save config to localStorage whenever it changes
  useEffect(() => {
    localStorage.setItem('careerzone-background-config', JSON.stringify(config));
  }, [config]);

  // Check for reduced motion preference
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
    
    const handleChange = (e) => {
      if (e.matches) {
        setConfig(prev => ({ ...prev, enabled: false }));
      }
    };

    mediaQuery.addEventListener('change', handleChange);
    
    // Initial check
    if (mediaQuery.matches) {
      setConfig(prev => ({ ...prev, enabled: false }));
    }

    return () => mediaQuery.removeEventListener('change', handleChange);
  }, []);

  const updateConfig = useCallback((newConfig) => {
    setConfig(prev => ({ ...prev, ...newConfig }));
  }, []);

  const resetConfig = useCallback(() => {
    setConfig(BACKGROUND_CONFIG_DEFAULTS);
  }, []);

  const toggleEnabled = useCallback(() => {
    setConfig(prev => ({ ...prev, enabled: !prev.enabled }));
  }, []);

  const value = useMemo(() => ({
    config,
    updateConfig,
    resetConfig,
    toggleEnabled
  }), [config, updateConfig, resetConfig, toggleEnabled]);

  return (
    <BackgroundContext.Provider value={value}>
      {children}
    </BackgroundContext.Provider>
  );
};
</file>

<file path="src/contexts/ThemeContext.jsx">
import React, { createContext, useContext, useState, useEffect, useMemo } from 'react';

const ThemeContext = createContext();

export const useTheme = () => {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme must be used within a ThemeProvider');
  }
  return context;
};

export const ThemeProvider = ({ children }) => {
  const [theme, setTheme] = useState(() => {
    // Load from localStorage
    const saved = localStorage.getItem('careerzone-theme');
    if (saved) {
      return saved;
    }
    
    // Check system preference
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
    
    return 'light';
  });

  useEffect(() => {
    const root = document.documentElement;
    
    // Remove both classes first
    root.classList.remove('light', 'dark');
    
    // Add the current theme class
    root.classList.add(theme);
    
    // Save to localStorage
    localStorage.setItem('careerzone-theme', theme);
  }, [theme]);

  // Listen for system theme changes
  useEffect(() => {
    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    
    const handleChange = (e) => {
      const saved = localStorage.getItem('careerzone-theme');
      // Only auto-switch if user hasn't manually set a preference
      if (!saved) {
        setTheme(e.matches ? 'dark' : 'light');
      }
    };

    mediaQuery.addEventListener('change', handleChange);
    return () => mediaQuery.removeEventListener('change', handleChange);
  }, []);

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  const value = useMemo(() => ({
    theme,
    setTheme,
    toggleTheme,
    isDark: theme === 'dark'
  }), [theme]);

  return (
    <ThemeContext.Provider value={value}>
      {children}
    </ThemeContext.Provider>
  );
};
</file>

<file path="src/data/notifications.js">
// src/data/notifications.js

/**
 * @typedef {object} Notification
 * @property {string} id
 * @property {string} type - 'new_job', 'application_status', 'interview_reminder', 'system'
 * @property {string} title
 * @property {string} description
 * @property {string} timestamp - ISO 8601 date string
 * @property {boolean} read
 * @property {object} [metadata]
 * @property {string} [metadata.jobId]
 * @property {string} [metadata.companyName]
 */

/** @type {Notification[]} */
export const mockNotifications = [
  {
    id: '1',
    type: 'new_job',
    title: 'Gợi ý công việc mới: React Developer',
    description: 'FPT Software đang tuyển dụng vị trí Senior React Developer phù hợp với kỹ năng của bạn.',
    timestamp: new Date(Date.now() - 1000 * 60 * 5).toISOString(), // 5 minutes ago
    read: false,
    metadata: {
      jobId: 'job-123',
      companyName: 'FPT Software',
    },
  },
  {
    id: '2',
    type: 'application_status',
    title: 'Hồ sơ của bạn đã được xem',
    description: 'Nhà tuyển dụng tại VNG đã xem hồ sơ ứng tuyển của bạn cho vị trí "Frontend Developer".',
    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(), // 2 hours ago
    read: false,
    metadata: {
      jobId: 'job-456',
      companyName: 'VNG Corporation',
    },
  },
  {
    id: '3',
    type: 'interview_reminder',
    title: 'Nhắc nhở phỏng vấn ngày mai',
    description: 'Bạn có lịch phỏng vấn với Tiki vào 9:00 AM ngày mai cho vị trí "UI/UX Designer".',
    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 23).toISOString(), // 23 hours ago
    read: true,
    metadata: {
      jobId: 'job-789',
      companyName: 'Tiki',
    },
  },
  {
    id: '4',
    type: 'system',
    title: 'Chào mừng đến với CareerZone!',
    description: 'Hãy bắt đầu bằng cách hoàn thiện hồ sơ của bạn để nhận được những gợi ý công việc tốt nhất.',
    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 2).toISOString(), // 2 days ago
    read: true,
  },
  {
    id: '5',
    type: 'application_status',
    title: 'Hồ sơ của bạn đã bị từ chối',
    description: 'Rất tiếc, nhà tuyển dụng tại Grab đã từ chối hồ sơ của bạn cho vị trí "Data Analyst".',
    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 3).toISOString(), // 3 days ago
    read: true,
    metadata: {
      jobId: 'job-abc',
      companyName: 'Grab',
    },
  },
    {
    id: '6',
    type: 'new_job',
    title: 'Công việc mới có thể bạn quan tâm: Fullstack Engineer',
    description: 'NashTech vừa đăng tuyển vị trí Fullstack Engineer với mức lương hấp dẫn.',
    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 4).toISOString(), // 4 days ago
    read: true,
    metadata: {
      jobId: 'job-def',
      companyName: 'NashTech',
    },
  },
  {
    id: '7',
    type: 'system',
    title: 'Hồ sơ của bạn đã được cập nhật',
    description: 'Thông tin kinh nghiệm làm việc của bạn đã được cập nhật thành công.',
    timestamp: new Date(Date.now() - 1000 * 60 * 60 * 24 * 5).toISOString(), // 5 days ago
    read: true,
  },
];
</file>

<file path="src/data/oldtree.json">
[{"name":"Thành phố Hà Nội","districts":[{"name":"Quận Ba Đình","communes":["Phường Phúc Xá","Phường Trúc Bạch","Phường Vĩnh Phúc","Phường Cống Vị","Phường Liễu Giai","Phường Nguyễn Trung Trực","Phường Quán Thánh","Phường Ngọc Hà","Phường Điện Biên","Phường Đội Cấn","Phường Ngọc Khánh","Phường Kim Mã","Phường Giảng Võ","Phường Thành Công"]},{"name":"Quận Hoàn Kiếm","communes":["Phường Phúc Tân","Phường Đồng Xuân","Phường Hàng Mã","Phường Hàng Buồm","Phường Hàng Đào","Phường Hàng Bồ","Phường Cửa Đông","Phường Lý Thái Tổ","Phường Hàng Bạc","Phường Hàng Gai","Phường Chương Dương","Phường Hàng Trống","Phường Cửa Nam","Phường Hàng Bông","Phường Tràng Tiền","Phường Trần Hưng Đạo","Phường Phan Chu Trinh","Phường Hàng Bài"]},{"name":"Quận Tây Hồ","communes":["Phường Phú Thượng","Phường Nhật Tân","Phường Tứ Liên","Phường Quảng An","Phường Xuân La","Phường Yên Phụ","Phường Bưởi","Phường Thụy Khuê"]},{"name":"Quận Long Biên","communes":["Phường Thượng Thanh","Phường Ngọc Thụy","Phường Giang Biên","Phường Đức Giang","Phường Việt Hưng","Phường Gia Thụy","Phường Ngọc Lâm","Phường Phúc Lợi","Phường Bồ Đề","Phường Sài Đồng","Phường Long Biên","Phường Thạch Bàn","Phường Phúc Đồng","Phường Cự Khối"]},{"name":"Quận Cầu Giấy","communes":["Phường Nghĩa Đô","Phường Nghĩa Tân","Phường Mai Dịch","Phường Dịch Vọng","Phường Dịch Vọng Hậu","Phường Quan Hoa","Phường Yên Hoà","Phường Trung Hoà"]},{"name":"Quận Đống Đa","communes":["Phường Cát Linh","Phường Văn Miếu","Phường Quốc Tử Giám","Phường Láng Thượng","Phường Ô Chợ Dừa","Phường Văn Chương","Phường Hàng Bột","Phường Láng Hạ","Phường Khâm Thiên","Phường Thổ Quan","Phường Nam Đồng","Phường Trung Phụng","Phường Quang Trung","Phường Trung Liệt","Phường Phương Liên","Phường Thịnh Quang","Phường Trung Tự","Phường Kim Liên","Phường Phương Mai","Phường Ngã Tư Sở","Phường Khương Thượng"]},{"name":"Quận Hai Bà Trưng","communes":["Phường Nguyễn Du","Phường Bạch Đằng","Phường Phạm Đình Hổ","Phường Lê Đại Hành","Phường Đồng Nhân","Phường Phố Huế","Phường Đống Mác","Phường Thanh Lương","Phường Thanh Nhàn","Phường Cầu Dền","Phường Bách Khoa","Phường Đồng Tâm","Phường Vĩnh Tuy","Phường Bạch Mai","Phường Quỳnh Mai","Phường Quỳnh Lôi","Phường Minh Khai","Phường Trương Định"]},{"name":"Quận Hoàng Mai","communes":["Phường Thanh Trì","Phường Vĩnh Hưng","Phường Định Công","Phường Mai Động","Phường Tương Mai","Phường Đại Kim","Phường Tân Mai","Phường Hoàng Văn Thụ","Phường Giáp Bát","Phường Lĩnh Nam","Phường Thịnh Liệt","Phường Trần Phú","Phường Hoàng Liệt","Phường Yên Sở"]},{"name":"Quận Thanh Xuân","communes":["Phường Nhân Chính","Phường Thượng Đình","Phường Khương Trung","Phường Khương Mai","Phường Thanh Xuân Trung","Phường Phương Liệt","Phường Hạ Đình","Phường Khương Đình","Phường Thanh Xuân Bắc","Phường Thanh Xuân Nam","Phường Kim Giang"]},{"name":"Huyện Sóc Sơn","communes":["Thị trấn Sóc Sơn","Xã Bắc Sơn","Xã Minh Trí","Xã Hồng Kỳ","Xã Nam Sơn","Xã Trung Giã","Xã Tân Hưng","Xã Minh Phú","Xã Phù Linh","Xã Bắc Phú","Xã Tân Minh","Xã Quang Tiến","Xã Hiền Ninh","Xã Tân Dân","Xã Tiên Dược","Xã Việt Long","Xã Xuân Giang","Xã Mai Đình","Xã Đức Hoà","Xã Thanh Xuân","Xã Đông Xuân","Xã Kim Lũ","Xã Phú Cường","Xã Phú Minh","Xã Phù Lỗ","Xã Xuân Thu"]},{"name":"Huyện Đông Anh","communes":["Thị trấn Đông Anh","Xã Xuân Nộn","Xã Thuỵ Lâm","Xã Bắc Hồng","Xã Nguyên Khê","Xã Nam Hồng","Xã Tiên Dương","Xã Vân Hà","Xã Uy Nỗ","Xã Vân Nội","Xã Liên Hà","Xã Việt Hùng","Xã Kim Nỗ","Xã Kim Chung","Xã Dục Tú","Xã Đại Mạch","Xã Vĩnh Ngọc","Xã Cổ Loa","Xã Hải Bối","Xã Xuân Canh","Xã Võng La","Xã Tàm Xá","Xã Mai Lâm","Xã Đông Hội"]},{"name":"Huyện Gia Lâm","communes":["Thị trấn Yên Viên","Xã Yên Thường","Xã Yên Viên","Xã Ninh Hiệp","Xã Đình Xuyên","Xã Dương Hà","Xã Phù Đổng","Xã Trung Mầu","Xã Lệ Chi","Xã Cổ Bi","Xã Đặng Xá","Xã Phú Thị","Xã Kim Sơn","Thị trấn Trâu Quỳ","Xã Dương Quang","Xã Dương Xá","Xã Đông Dư","Xã Đa Tốn","Xã Kiêu Kỵ","Xã Bát Tràng","Xã Kim Lan","Xã Văn Đức"]},{"name":"Quận Nam Từ Liêm","communes":["Phường Cầu Diễn","Phường Xuân Phương","Phường Phương Canh","Phường Mỹ Đình 1","Phường Mỹ Đình 2","Phường Tây Mỗ","Phường Mễ Trì","Phường Phú Đô","Phường Đại Mỗ","Phường Trung Văn"]},{"name":"Huyện Thanh Trì","communes":["Thị trấn Văn Điển","Xã Tân Triều","Xã Thanh Liệt","Xã Tả Thanh Oai","Xã Hữu Hoà","Xã Tam Hiệp","Xã Tứ Hiệp","Xã Yên Mỹ","Xã Vĩnh Quỳnh","Xã Ngũ Hiệp","Xã Duyên Hà","Xã Ngọc Hồi","Xã Vạn Phúc","Xã Đại áng","Xã Liên Ninh","Xã Đông Mỹ"]},{"name":"Quận Bắc Từ Liêm","communes":["Phường Thượng Cát","Phường Liên Mạc","Phường Đông Ngạc","Phường Đức Thắng","Phường Thụy Phương","Phường Tây Tựu","Phường Xuân Đỉnh","Phường Xuân Tảo","Phường Minh Khai","Phường Cổ Nhuế 1","Phường Cổ Nhuế 2","Phường Phú Diễn","Phường Phúc Diễn"]},{"name":"Huyện Mê Linh","communes":["Thị trấn Chi Đông","Xã Đại Thịnh","Xã Kim Hoa","Xã Thạch Đà","Xã Tiến Thắng","Xã Tự Lập","Thị trấn Quang Minh","Xã Thanh Lâm","Xã Tam Đồng","Xã Liên Mạc","Xã Vạn Yên","Xã Chu Phan","Xã Tiến Thịnh","Xã Mê Linh","Xã Văn Khê","Xã Hoàng Kim","Xã Tiền Phong","Xã Tráng Việt"]},{"name":"Quận Hà Đông","communes":["Phường Nguyễn Trãi","Phường Mộ Lao","Phường Văn Quán","Phường Vạn Phúc","Phường Yết Kiêu","Phường Quang Trung","Phường La Khê","Phường Phú La","Phường Phúc La","Phường Hà Cầu","Phường Yên Nghĩa","Phường Kiến Hưng","Phường Phú Lãm","Phường Phú Lương","Phường Dương Nội","Phường Đồng Mai","Phường Biên Giang"]},{"name":"Thị xã Sơn Tây","communes":["Phường Lê Lợi","Phường Phú Thịnh","Phường Ngô Quyền","Phường Quang Trung","Phường Sơn Lộc","Phường Xuân Khanh","Xã Đường Lâm","Phường Viên Sơn","Xã Xuân Sơn","Phường Trung Hưng","Xã Thanh Mỹ","Phường Trung Sơn Trầm","Xã Kim Sơn","Xã Sơn Đông","Xã Cổ Đông"]},{"name":"Huyện Ba Vì","communes":["Thị trấn Tây Đằng","Xã Phú Cường","Xã Cổ Đô","Xã Tản Hồng","Xã Vạn Thắng","Xã Châu Sơn","Xã Phong Vân","Xã Phú Đông","Xã Phú Phương","Xã Phú Châu","Xã Thái Hòa","Xã Đồng Thái","Xã Phú Sơn","Xã Minh Châu","Xã Vật Lại","Xã Chu Minh","Xã Tòng Bạt","Xã Cẩm Lĩnh","Xã Sơn Đà","Xã Đông Quang","Xã Tiên Phong","Xã Thụy An","Xã Cam Thượng","Xã Thuần Mỹ","Xã Tản Lĩnh","Xã Ba Trại","Xã Minh Quang","Xã Ba Vì","Xã Vân Hòa","Xã Yên Bài","Xã Khánh Thượng"]},{"name":"Huyện Phúc Thọ","communes":["Thị trấn Phúc Thọ","Xã Vân Hà","Xã Vân Phúc","Xã Vân Nam","Xã Xuân Đình","Xã Sen Phương","Xã Võng Xuyên","Xã Thọ Lộc","Xã Long Xuyên","Xã Thượng Cốc","Xã Hát Môn","Xã Tích Giang","Xã Thanh Đa","Xã Trạch Mỹ Lộc","Xã Phúc Hòa","Xã Ngọc Tảo","Xã Phụng Thượng","Xã Tam Thuấn","Xã Tam Hiệp","Xã Hiệp Thuận","Xã Liên Hiệp"]},{"name":"Huyện Đan Phượng","communes":["Thị trấn Phùng","Xã Trung Châu","Xã Thọ An","Xã Thọ Xuân","Xã Hồng Hà","Xã Liên Hồng","Xã Liên Hà","Xã Hạ Mỗ","Xã Liên Trung","Xã Phương Đình","Xã Thượng Mỗ","Xã Tân Hội","Xã Tân Lập","Xã Đan Phượng","Xã Đồng Tháp","Xã Song Phượng"]},{"name":"Huyện Hoài Đức","communes":["Thị trấn Trạm Trôi","Xã Đức Thượng","Xã Minh Khai","Xã Dương Liễu","Xã Di Trạch","Xã Đức Giang","Xã Cát Quế","Xã Kim Chung","Xã Yên Sở","Xã Sơn Đồng","Xã Vân Canh","Xã Đắc Sở","Xã Lại Yên","Xã Tiền Yên","Xã Song Phương","Xã An Khánh","Xã An Thượng","Xã Vân Côn","Xã La Phù","Xã Đông La"]},{"name":"Huyện Quốc Oai","communes":["Xã Đông Xuân","Thị trấn Quốc Oai","Xã Sài Sơn","Xã Phượng Cách","Xã Yên Sơn","Xã Ngọc Liệp","Xã Ngọc Mỹ","Xã Liệp Tuyết","Xã Thạch Thán","Xã Đồng Quang","Xã Phú Cát","Xã Tuyết Nghĩa","Xã Nghĩa Hương","Xã Cộng Hòa","Xã Tân Phú","Xã Đại Thành","Xã Phú Mãn","Xã Cấn Hữu","Xã Tân Hòa","Xã Hòa Thạch","Xã Đông Yên"]},{"name":"Huyện Thạch Thất","communes":["Xã Yên Trung","Xã Yên Bình","Xã Tiến Xuân","Thị trấn Liên Quan","Xã Đại Đồng","Xã Cẩm Yên","Xã Lại Thượng","Xã Phú Kim","Xã Hương Ngải","Xã Canh Nậu","Xã Kim Quan","Xã Dị Nậu","Xã Bình Yên","Xã Chàng Sơn","Xã Thạch Hoà","Xã Cần Kiệm","Xã Hữu Bằng","Xã Phùng Xá","Xã Tân Xã","Xã Thạch Xá","Xã Bình Phú","Xã Hạ Bằng","Xã Đồng Trúc"]},{"name":"Huyện Chương Mỹ","communes":["Thị trấn Chúc Sơn","Thị trấn Xuân Mai","Xã Phụng Châu","Xã Tiên Phương","Xã Đông Sơn","Xã Đông Phương Yên","Xã Phú Nghĩa","Xã Trường Yên","Xã Ngọc Hòa","Xã Thủy Xuân Tiên","Xã Thanh Bình","Xã Trung Hòa","Xã Đại Yên","Xã Thụy Hương","Xã Tốt Động","Xã Lam Điền","Xã Tân Tiến","Xã Nam Phương Tiến","Xã Hợp Đồng","Xã Hoàng Văn Thụ","Xã Hoàng Diệu","Xã Hữu Văn","Xã Quảng Bị","Xã Mỹ Lương","Xã Thượng Vực","Xã Hồng Phong","Xã Đồng Phú","Xã Trần Phú","Xã Văn Võ","Xã Đồng Lạc","Xã Hòa Chính","Xã Phú Nam An"]},{"name":"Huyện Thanh Oai","communes":["Thị trấn Kim Bài","Xã Cự Khê","Xã Bích Hòa","Xã Mỹ Hưng","Xã Cao Viên","Xã Bình Minh","Xã Tam Hưng","Xã Thanh Cao","Xã Thanh Thùy","Xã Thanh Mai","Xã Thanh Văn","Xã Đỗ Động","Xã Kim An","Xã Kim Thư","Xã Phương Trung","Xã Tân Ước","Xã Dân Hòa","Xã Liên Châu","Xã Cao Dương","Xã Xuân Dương","Xã Hồng Dương"]},{"name":"Huyện Thường Tín","communes":["Thị trấn Thường Tín","Xã Ninh Sở","Xã Nhị Khê","Xã Duyên Thái","Xã Khánh Hà","Xã Hòa Bình","Xã Văn Bình","Xã Hiền Giang","Xã Hồng Vân","Xã Vân Tảo","Xã Liên Phương","Xã Văn Phú","Xã Tự Nhiên","Xã Tiền Phong","Xã Hà Hồi","Xã Thư Phú","Xã Nguyễn Trãi","Xã Quất Động","Xã Chương Dương","Xã Tân Minh","Xã Lê Lợi","Xã Thắng Lợi","Xã Dũng Tiến","Xã Thống Nhất","Xã Nghiêm Xuyên","Xã Tô Hiệu","Xã Văn Tự","Xã Vạn Điểm","Xã Minh Cường"]},{"name":"Huyện Phú Xuyên","communes":["Thị trấn Phú Minh","Thị trấn Phú Xuyên","Xã Hồng Minh","Xã Phượng Dực","Xã Nam Tiến","Xã Tri Trung","Xã Đại Thắng","Xã Phú Túc","Xã Văn Hoàng","Xã Hồng Thái","Xã Hoàng Long","Xã Quang Trung","Xã Nam Phong","Xã Nam Triều","Xã Tân Dân","Xã Sơn Hà","Xã Chuyên Mỹ","Xã Khai Thái","Xã Phúc Tiến","Xã Vân Từ","Xã Tri Thủy","Xã Đại Xuyên","Xã Phú Yên","Xã Bạch Hạ","Xã Quang Lãng","Xã Châu Can","Xã Minh Tân"]},{"name":"Huyện Ứng Hòa","communes":["Thị trấn Vân Đình","Xã Viên An","Xã Viên Nội","Xã Hoa Sơn","Xã Quảng Phú Cầu","Xã Trường Thịnh","Xã Cao Thành","Xã Liên Bạt","Xã Sơn Công","Xã Đồng Tiến","Xã Phương Tú","Xã Trung Tú","Xã Đồng Tân","Xã Tảo Dương Văn","Xã Vạn Thái","Xã Minh Đức","Xã Hòa Lâm","Xã Hòa Xá","Xã Trầm Lộng","Xã Kim Đường","Xã Hòa Nam","Xã Hòa Phú","Xã Đội Bình","Xã Đại Hùng","Xã Đông Lỗ","Xã Phù Lưu","Xã Đại Cường","Xã Lưu Hoàng","Xã Hồng Quang"]},{"name":"Huyện Mỹ Đức","communes":["Thị trấn Đại Nghĩa","Xã Đồng Tâm","Xã Thượng Lâm","Xã Tuy Lai","Xã Phúc Lâm","Xã Mỹ Thành","Xã Bột Xuyên","Xã An Mỹ","Xã Hồng Sơn","Xã Lê Thanh","Xã Xuy Xá","Xã Phùng Xá","Xã Phù Lưu Tế","Xã Đại Hưng","Xã Vạn Kim","Xã Đốc Tín","Xã Hương Sơn","Xã Hùng Tiến","Xã An Tiến","Xã Hợp Tiến","Xã Hợp Thanh","Xã An Phú"]}]},{"name":"Tỉnh Hà Giang","districts":[{"name":"Thành phố Hà Giang","communes":["Phường Quang Trung","Phường Trần Phú","Phường Ngọc Hà","Phường Nguyễn Trãi","Phường Minh Khai","Xã Ngọc Đường","Xã Phương Độ","Xã Phương Thiện"]},{"name":"Huyện Đồng Văn","communes":["Thị trấn Phó Bảng","Xã Lũng Cú","Xã Má Lé","Thị trấn Đồng Văn","Xã Lũng Táo","Xã Phố Là","Xã Thài Phìn Tủng","Xã Sủng Là","Xã Xà Phìn","Xã Tả Phìn","Xã Tả Lủng","Xã Phố Cáo","Xã Sính Lủng","Xã Sảng Tủng","Xã Lũng Thầu","Xã Hố Quáng Phìn","Xã Vần Chải","Xã Lũng Phìn","Xã Sủng Trái"]},{"name":"Huyện Mèo Vạc","communes":["Thị trấn Mèo Vạc","Xã Thượng Phùng","Xã Pải Lủng","Xã Xín Cái","Xã Pả Vi","Xã Giàng Chu Phìn","Xã Sủng Trà","Xã Sủng Máng","Xã Sơn Vĩ","Xã Tả Lủng","Xã Cán Chu Phìn","Xã Lũng Pù","Xã Lũng Chinh","Xã Tát Ngà","Xã Nậm Ban","Xã Khâu Vai","Xã Niêm Tòng","Xã Niêm Sơn"]},{"name":"Huyện Yên Minh","communes":["Thị trấn Yên Minh","Xã Thắng Mố","Xã Phú Lũng","Xã Sủng Tráng","Xã Bạch Đích","Xã Na Khê","Xã Sủng Thài","Xã Hữu Vinh","Xã Lao Và Chải","Xã Mậu Duệ","Xã Đông Minh","Xã Mậu Long","Xã Ngam La","Xã Ngọc Long","Xã Đường Thượng","Xã Lũng Hồ","Xã Du Tiến","Xã Du Già"]},{"name":"Huyện Quản Bạ","communes":["Thị trấn Tam Sơn","Xã Bát Đại Sơn","Xã Nghĩa Thuận","Xã Cán Tỷ","Xã Cao Mã Pờ","Xã Thanh Vân","Xã Tùng Vài","Xã Đông Hà","Xã Quản Bạ","Xã Lùng Tám","Xã Quyết Tiến","Xã Tả Ván","Xã Thái An"]},{"name":"Huyện Vị Xuyên","communes":["Xã Kim Thạch","Xã Phú Linh","Xã Kim Linh","Thị trấn Vị Xuyên","Thị trấn Nông Trường Việt Lâm","Xã Minh Tân","Xã Thuận Hoà","Xã Tùng Bá","Xã Thanh Thủy","Xã Thanh Đức","Xã Phong Quang","Xã Xín Chải","Xã Phương Tiến","Xã Lao Chải","Xã Cao Bồ","Xã Đạo Đức","Xã Thượng Sơn","Xã Linh Hồ","Xã Quảng Ngần","Xã Việt Lâm","Xã Ngọc Linh","Xã Ngọc Minh","Xã Bạch Ngọc","Xã Trung Thành"]},{"name":"Huyện Bắc Mê","communes":["Xã Minh Sơn","Xã Giáp Trung","Xã Yên Định","Thị trấn Yên Phú","Xã Minh Ngọc","Xã Yên Phong","Xã Lạc Nông","Xã Phú Nam","Xã Yên Cường","Xã Thượng Tân","Xã Đường Âm","Xã Đường Hồng","Xã Phiêng Luông"]},{"name":"Huyện Hoàng Su Phì","communes":["Thị trấn Vinh Quang","Xã Bản Máy","Xã Thàng Tín","Xã Thèn Chu Phìn","Xã Pố Lồ","Xã Bản Phùng","Xã Túng Sán","Xã Chiến Phố","Xã Đản Ván","Xã Tụ Nhân","Xã Tân Tiến","Xã Nàng Đôn","Xã Pờ Ly Ngài","Xã Sán Xả Hồ","Xã Bản Luốc","Xã Ngàm Đăng Vài","Xã Bản Nhùng","Xã Tả Sử Choóng","Xã Nậm Dịch","Xã Hồ Thầu","Xã Nam Sơn","Xã Nậm Tỵ","Xã Thông Nguyên","Xã Nậm Khòa"]},{"name":"Huyện Xín Mần","communes":["Thị trấn Cốc Pài","Xã Nàn Xỉn","Xã Bản Díu","Xã Chí Cà","Xã Xín Mần","Xã Thèn Phàng","Xã Trung Thịnh","Xã Pà Vầy Sủ","Xã Cốc Rế","Xã Thu Tà","Xã Nàn Ma","Xã Tả Nhìu","Xã Bản Ngò","Xã Chế Là","Xã Nấm Dẩn","Xã Quảng Nguyên","Xã Nà Chì","Xã Khuôn Lùng"]},{"name":"Huyện Bắc Quang","communes":["Thị trấn Việt Quang","Thị trấn Vĩnh Tuy","Xã Tân Lập","Xã Tân Thành","Xã Đồng Tiến","Xã Đồng Tâm","Xã Tân Quang","Xã Thượng Bình","Xã Hữu Sản","Xã Kim Ngọc","Xã Việt Vinh","Xã Bằng Hành","Xã Quang Minh","Xã Liên Hiệp","Xã Vô Điếm","Xã Việt Hồng","Xã Hùng An","Xã Đức Xuân","Xã Tiên Kiều","Xã Vĩnh Hảo","Xã Vĩnh Phúc","Xã Đồng Yên","Xã Đông Thành"]},{"name":"Huyện Quang Bình","communes":["Xã Xuân Minh","Xã Tiên Nguyên","Xã Tân Nam","Xã Bản Rịa","Xã Yên Thành","Thị trấn Yên Bình","Xã Tân Trịnh","Xã Tân Bắc","Xã Bằng Lang","Xã Yên Hà","Xã Hương Sơn","Xã Xuân Giang","Xã Nà Khương","Xã Tiên Yên","Xã Vĩ Thượng"]}]},{"name":"Tỉnh Cao Bằng","districts":[{"name":"Thành phố Cao Bằng","communes":["Phường Sông Hiến","Phường Sông Bằng","Phường Hợp Giang","Phường Tân Giang","Phường Ngọc Xuân","Phường Đề Thám","Phường Hoà Chung","Phường Duyệt Trung","Xã Vĩnh Quang","Xã Hưng Đạo","Xã Chu Trinh"]},{"name":"Huyện Bảo Lâm","communes":["Thị trấn Pác Miầu","Xã Đức Hạnh","Xã Lý Bôn","Xã Nam Cao","Xã Nam Quang","Xã Vĩnh Quang","Xã Quảng Lâm","Xã Thạch Lâm","Xã Vĩnh Phong","Xã Mông Ân","Xã Thái Học","Xã Thái Sơn","Xã Yên Thổ"]},{"name":"Huyện Bảo Lạc","communes":["Thị trấn Bảo Lạc","Xã Cốc Pàng","Xã Thượng Hà","Xã Cô Ba","Xã Bảo Toàn","Xã Khánh Xuân","Xã Xuân Trường","Xã Hồng Trị","Xã Kim Cúc","Xã Phan Thanh","Xã Hồng An","Xã Hưng Đạo","Xã Hưng Thịnh","Xã Huy Giáp","Xã Đình Phùng","Xã Sơn Lập","Xã Sơn Lộ"]},{"name":"Huyện Hà Quảng","communes":["Thị trấn Thông Nông","Xã Cần Yên","Xã Cần Nông","Xã Lương Thông","Xã Đa Thông","Xã Ngọc Động","Xã Yên Sơn","Xã Lương Can","Xã Thanh Long","Thị trấn Xuân Hòa","Xã Lũng Nặm","Xã Trường Hà","Xã Cải Viên","Xã Nội Thôn","Xã Tổng Cọt","Xã Sóc Hà","Xã Thượng Thôn","Xã Hồng Sỹ","Xã Quý Quân","Xã Mã Ba","Xã Ngọc Đào"]},{"name":"Huyện Trùng Khánh","communes":["Thị trấn Trà Lĩnh","Xã Tri Phương","Xã Quang Hán","Xã Xuân Nội","Xã Quang Trung","Xã Quang Vinh","Xã Cao Chương","Thị trấn Trùng Khánh","Xã Ngọc Khê","Xã Ngọc Côn","Xã Phong Nậm","Xã Đình Phong","Xã Đàm Thuỷ","Xã Khâm Thành","Xã Chí Viễn","Xã Lăng Hiếu","Xã Phong Châu","Xã Trung Phúc","Xã Cao Thăng","Xã Đức Hồng","Xã Đoài Dương"]},{"name":"Huyện Hạ Lang","communes":["Xã Minh Long","Xã Lý Quốc","Xã Thắng Lợi","Xã Đồng Loan","Xã Đức Quang","Xã Kim Loan","Xã Quang Long","Xã An Lạc","Thị trấn Thanh Nhật","Xã Vinh Quý","Xã Thống Nhất","Xã Cô Ngân","Xã Thị Hoa"]},{"name":"Huyện Quảng Hòa","communes":["Xã Quốc Toản","Thị trấn Quảng Uyên","Xã Phi Hải","Xã Quảng Hưng","Xã Độc Lập","Xã Cai Bộ","Xã Phúc Sen","Xã Chí Thảo","Xã Tự Do","Xã Hồng Quang","Xã Ngọc Động","Xã Hạnh Phúc","Thị trấn Tà Lùng","Xã Bế Văn Đàn","Xã Cách Linh","Xã Đại Sơn","Xã Tiên Thành","Thị trấn Hoà Thuận","Xã Mỹ Hưng"]},{"name":"Huyện Hoà An","communes":["Thị trấn Nước Hai","Xã Dân Chủ","Xã Nam Tuấn","Xã Đại Tiến","Xã Đức Long","Xã Ngũ Lão","Xã Trương Lương","Xã Hồng Việt","Xã Hoàng Tung","Xã Nguyễn Huệ","Xã Quang Trung","Xã Bạch Đằng","Xã Bình Dương","Xã Lê Chung","Xã Hồng Nam"]},{"name":"Huyện Nguyên Bình","communes":["Thị trấn Nguyên Bình","Thị trấn Tĩnh Túc","Xã Yên Lạc","Xã Triệu Nguyên","Xã Ca Thành","Xã Vũ Nông","Xã Minh Tâm","Xã Thể Dục","Xã Mai Long","Xã Vũ Minh","Xã Hoa Thám","Xã Phan Thanh","Xã Quang Thành","Xã Tam Kim","Xã Thành Công","Xã Thịnh Vượng","Xã Hưng Đạo"]},{"name":"Huyện Thạch An","communes":["Thị trấn Đông Khê","Xã Canh Tân","Xã Kim Đồng","Xã Minh Khai","Xã Đức Thông","Xã Thái Cường","Xã Vân Trình","Xã Thụy Hùng","Xã Quang Trọng","Xã Trọng Con","Xã Lê Lai","Xã Đức Long","Xã Lê Lợi","Xã Đức Xuân"]}]},{"name":"Tỉnh Bắc Kạn","districts":[{"name":"Thành Phố Bắc Kạn","communes":["Phường Nguyễn Thị Minh Khai","Phường Sông Cầu","Phường Đức Xuân","Phường Phùng Chí Kiên","Phường Huyền Tụng","Xã Dương Quang","Xã Nông Thượng","Phường Xuất Hóa"]},{"name":"Huyện Pác Nặm","communes":["Xã Bằng Thành","Xã Nhạn Môn","Xã Bộc Bố","Xã Công Bằng","Xã Giáo Hiệu","Xã Xuân La","Xã An Thắng","Xã Cổ Linh","Xã Nghiên Loan","Xã Cao Tân"]},{"name":"Huyện Ba Bể","communes":["Thị trấn Chợ Rã","Xã Bành Trạch","Xã Phúc Lộc","Xã Hà Hiệu","Xã Cao Thượng","Xã Khang Ninh","Xã Nam Mẫu","Xã Thượng Giáo","Xã Địa Linh","Xã Yến Dương","Xã Chu Hương","Xã Quảng Khê","Xã Mỹ Phương","Xã Hoàng Trĩ","Xã Đồng Phúc"]},{"name":"Huyện Ngân Sơn","communes":["Thị trấn Nà Phặc","Xã Thượng Ân","Xã Bằng Vân","Xã Cốc Đán","Xã Trung Hoà","Xã Đức Vân","Xã Vân Tùng","Xã Thượng Quan","Xã Hiệp Lực","Xã Thuần Mang"]},{"name":"Huyện Bạch Thông","communes":["Thị trấn Phủ Thông","Xã Vi Hương","Xã Sĩ Bình","Xã Vũ Muộn","Xã Đôn Phong","Xã Lục Bình","Xã Tân Tú","Xã Nguyên Phúc","Xã Cao Sơn","Xã Quân Hà","Xã Cẩm Giàng","Xã Mỹ Thanh","Xã Dương Phong","Xã Quang Thuận"]},{"name":"Huyện Chợ Đồn","communes":["Thị trấn Bằng Lũng","Xã Xuân Lạc","Xã Nam Cường","Xã Đồng Lạc","Xã Tân Lập","Xã Bản Thi","Xã Quảng Bạch","Xã Bằng Phúc","Xã Yên Thịnh","Xã Yên Thượng","Xã Phương Viên","Xã Ngọc Phái","Xã Đồng Thắng","Xã Lương Bằng","Xã Bằng Lãng","Xã Đại Sảo","Xã Nghĩa Tá","Xã Yên Mỹ","Xã Bình Trung","Xã Yên Phong"]},{"name":"Huyện Chợ Mới","communes":["Thị trấn Đồng Tâm","Xã Tân Sơn","Xã Thanh Vận","Xã Mai Lạp","Xã Hoà Mục","Xã Thanh Mai","Xã Cao Kỳ","Xã Nông Hạ","Xã Yên Cư","Xã Thanh Thịnh","Xã Yên Hân","Xã Như Cố","Xã Bình Văn","Xã Quảng Chu"]},{"name":"Huyện Na Rì","communes":["Xã Văn Vũ","Xã Văn Lang","Xã Lương Thượng","Xã Kim Hỷ","Xã Cường Lợi","Thị trấn Yến Lạc","Xã Kim Lư","Xã Sơn Thành","Xã Văn Minh","Xã Côn Minh","Xã Cư Lễ","Xã Trần Phú","Xã Quang Phong","Xã Dương Sơn","Xã Xuân Dương","Xã Đổng Xá","Xã Liêm Thuỷ"]}]},{"name":"Tỉnh Tuyên Quang","districts":[{"name":"Thành phố Tuyên Quang","communes":["Phường Phan Thiết","Phường Minh Xuân","Phường Tân Quang","Xã Tràng Đà","Phường Nông Tiến","Phường Ỷ La","Phường Tân Hà","Phường Hưng Thành","Xã Kim Phú","Xã An Khang","Phường Mỹ Lâm","Phường An Tường","Xã Lưỡng Vượng","Xã Thái Long","Phường Đội Cấn"]},{"name":"Huyện Lâm Bình","communes":["Xã Phúc Yên","Xã Xuân Lập","Xã Khuôn Hà","Thị trấn Lăng Can","Xã Thượng Lâm","Xã Bình An","Xã Hồng Quang","Xã Thổ Bình","Xã Phúc Sơn","Xã Minh Quang"]},{"name":"Huyện Na Hang","communes":["Thị trấn Na Hang","Xã Sinh Long","Xã Thượng Giáp","Xã Thượng Nông","Xã Côn Lôn","Xã Yên Hoa","Xã Hồng Thái","Xã Đà Vị","Xã Khau Tinh","Xã Sơn Phú","Xã Năng Khả","Xã Thanh Tương"]},{"name":"Huyện Chiêm Hóa","communes":["Thị trấn Vĩnh Lộc","Xã Trung Hà","Xã Tân Mỹ","Xã Hà Lang","Xã Hùng Mỹ","Xã Yên Lập","Xã Tân An","Xã Bình Phú","Xã Xuân Quang","Xã Ngọc Hội","Xã Phú Bình","Xã Hòa Phú","Xã Phúc Thịnh","Xã Kiên Đài","Xã Tân Thịnh","Xã Trung Hòa","Xã Kim Bình","Xã Hòa An","Xã Vinh Quang","Xã Tri Phú","Xã Nhân Lý","Xã Yên Nguyên","Xã Linh Phú","Xã Bình Nhân"]},{"name":"Huyện Hàm Yên","communes":["Thị trấn Tân Yên","Xã Yên Thuận","Xã Bạch Xa","Xã Minh Khương","Xã Yên Lâm","Xã Minh Dân","Xã Phù Lưu","Xã Minh Hương","Xã Yên Phú","Xã Tân Thành","Xã Bình Xa","Xã Thái Sơn","Xã Nhân Mục","Xã Thành Long","Xã Bằng Cốc","Xã Thái Hòa","Xã Đức Ninh","Xã Hùng Đức"]},{"name":"Huyện Yên Sơn","communes":["Xã Quí Quân","Xã Lực Hành","Xã Kiến Thiết","Xã Trung Minh","Xã Chiêu Yên","Xã Trung Trực","Xã Xuân Vân","Xã Phúc Ninh","Xã Hùng Lợi","Xã Trung Sơn","Xã Tân Tiến","Xã Tứ Quận","Xã Đạo Viện","Xã Tân Long","Thị trấn Yên Sơn","Xã Kim Quan","Xã Lang Quán","Xã Phú Thịnh","Xã Công Đa","Xã Trung Môn","Xã Chân Sơn","Xã Thái Bình","Xã Tiến Bộ","Xã Mỹ Bằng","Xã Hoàng Khai","Xã Nhữ Hán","Xã Nhữ Khê","Xã Đội Bình"]},{"name":"Huyện Sơn Dương","communes":["Thị trấn Sơn Dương","Xã Trung Yên","Xã Minh Thanh","Xã Tân Trào","Xã Vĩnh Lợi","Xã Thượng Ấm","Xã Bình Yên","Xã Lương Thiện","Xã Tú Thịnh","Xã Cấp Tiến","Xã Hợp Thành","Xã Phúc Ứng","Xã Đông Thọ","Xã Kháng Nhật","Xã Hợp Hòa","Xã Quyết Thắng","Xã Đồng Quý","Xã Tân Thanh","Xã Vân Sơn","Xã Văn Phú","Xã Chi Thiết","Xã Đông Lợi","Xã Thiện Kế","Xã Hồng Lạc","Xã Phú Lương","Xã Ninh Lai","Xã Đại Phú","Xã Sơn Nam","Xã Hào Phú","Xã Tam Đa","Xã Trường Sinh"]}]},{"name":"Tỉnh Lào Cai","districts":[{"name":"Thành phố Lào Cai","communes":["Phường Duyên Hải","Phường Lào Cai","Phường Cốc Lếu","Phường Kim Tân","Phường Bắc Lệnh","Phường Pom Hán","Phường Xuân Tăng","Phường Bình Minh","Xã Thống Nhất","Xã Đồng Tuyển","Xã Vạn Hoà","Phường Bắc Cường","Phường Nam Cường","Xã Cam Đường","Xã Tả Phời","Xã Hợp Thành","Xã Cốc San"]},{"name":"Huyện Bát Xát","communes":["Thị trấn Bát Xát","Xã A Mú Sung","Xã Nậm Chạc","Xã A Lù","Xã Trịnh Tường","Xã Y Tý","Xã Cốc Mỳ","Xã Dền Sáng","Xã Bản Vược","Xã Sàng Ma Sáo","Xã Bản Qua","Xã Mường Vi","Xã Dền Thàng","Xã Bản Xèo","Xã Mường Hum","Xã Trung Lèng Hồ","Xã Quang Kim","Xã Pa Cheo","Xã Nậm Pung","Xã Phìn Ngan","Xã Tòng Sành"]},{"name":"Huyện Mường Khương","communes":["Xã Pha Long","Xã Tả Ngải Chồ","Xã Tung Chung Phố","Thị trấn Mường Khương","Xã Dìn Chin","Xã Tả Gia Khâu","Xã Nậm Chảy","Xã Nấm Lư","Xã Lùng Khấu Nhin","Xã Thanh Bình","Xã Cao Sơn","Xã Lùng Vai","Xã Bản Lầu","Xã La Pan Tẩn","Xã Tả Thàng","Xã Bản Sen"]},{"name":"Huyện Si Ma Cai","communes":["Xã Nàn Sán","Xã Thào Chư Phìn","Xã Bản Mế","Thị trấn Si Ma Cai","Xã Sán Chải","Xã Lùng Thẩn","Xã Cán Cấu","Xã Sín Chéng","Xã Quan Hồ Thẩn","Xã Nàn Xín"]},{"name":"Huyện Bắc Hà","communes":["Thị trấn Bắc Hà","Xã Lùng Cải","Xã Lùng Phình","Xã Tả Van Chư","Xã Tả Củ Tỷ","Xã Thải Giàng Phố","Xã Hoàng Thu Phố","Xã Bản Phố","Xã Bản Liền","Xã Tà Chải","Xã Na Hối","Xã Cốc Ly","Xã Nậm Mòn","Xã Nậm Đét","Xã Nậm Khánh","Xã Bảo Nhai","Xã Nậm Lúc","Xã Cốc Lầu","Xã Bản Cái"]},{"name":"Huyện Bảo Thắng","communes":["Thị trấn N.T Phong Hải","Thị trấn Phố Lu","Thị trấn Tằng Loỏng","Xã Bản Phiệt","Xã Bản Cầm","Xã Thái Niên","Xã Phong Niên","Xã Gia Phú","Xã Xuân Quang","Xã Sơn Hải","Xã Xuân Giao","Xã Trì Quang","Xã Sơn Hà","Xã Phú Nhuận"]},{"name":"Huyện Bảo Yên","communes":["Thị trấn Phố Ràng","Xã Tân Tiến","Xã Nghĩa Đô","Xã Vĩnh Yên","Xã Điện Quan","Xã Xuân Hoà","Xã Tân Dương","Xã Thượng Hà","Xã Kim Sơn","Xã Cam Cọn","Xã Minh Tân","Xã Xuân Thượng","Xã Việt Tiến","Xã Yên Sơn","Xã Bảo Hà","Xã Lương Sơn","Xã Phúc Khánh"]},{"name":"Thị xã Sa Pa","communes":["Phường Sa Pa","Phường Sa Pả","Phường Ô Quý Hồ","Xã Ngũ Chỉ Sơn","Phường Phan Si Păng","Xã Trung Chải","Xã Tả Phìn","Phường Hàm Rồng","Xã Hoàng Liên","Xã Thanh Bình","Phường Cầu Mây","Xã Mường Hoa","Xã Tả Van","Xã Mường Bo","Xã Bản Hồ","Xã Liên Minh"]},{"name":"Huyện Văn Bàn","communes":["Thị trấn Khánh Yên","Xã Võ Lao","Xã Sơn Thuỷ","Xã Nậm Mả","Xã Tân Thượng","Xã Nậm Rạng","Xã Nậm Chầy","Xã Tân An","Xã Khánh Yên Thượng","Xã Nậm Xé","Xã Dần Thàng","Xã Chiềng Ken","Xã Làng Giàng","Xã Hoà Mạc","Xã Khánh Yên Trung","Xã Khánh Yên Hạ","Xã Dương Quỳ","Xã Nậm Tha","Xã Minh Lương","Xã Thẩm Dương","Xã Liêm Phú","Xã Nậm Xây"]}]},{"name":"Tỉnh Điện Biên","districts":[{"name":"Thành phố Điện Biên Phủ","communes":["Phường Noong Bua","Phường Him Lam","Phường Thanh Bình","Phường Tân Thanh","Phường Mường Thanh","Phường Nam Thanh","Phường Thanh Trường","Xã Thanh Minh","Xã Nà Tấu","Xã Nà Nhạn","Xã Mường Phăng","Xã Pá Khoang"]},{"name":"Thị xã Mường Lay","communes":["Phường Sông Đà","Phường Na Lay","Xã Lay Nưa"]},{"name":"Huyện Mường Nhé","communes":["Xã Sín Thầu","Xã Sen Thượng","Xã Chung Chải","Xã Leng Su Sìn","Xã Pá Mỳ","Xã Mường Nhé","Xã Nậm Vì","Xã Nậm Kè","Xã Mường Toong","Xã Quảng Lâm","Xã Huổi Lếnh"]},{"name":"Huyện Mường Chà","communes":["Thị Trấn Mường Chà","Xã Xá Tổng","Xã Mường Tùng","Xã Hừa Ngài","Xã Huổi Mí","Xã Pa Ham","Xã Nậm Nèn","Xã Huổi Lèng","Xã Sa Lông","Xã Ma Thì Hồ","Xã Na Sang","Xã Mường Mươn"]},{"name":"Huyện Tủa Chùa","communes":["Thị trấn Tủa Chùa","Xã Huổi Só","Xã Xín Chải","Xã Tả Sìn Thàng","Xã Lao Xả Phình","Xã Tả Phìn","Xã Tủa Thàng","Xã Trung Thu","Xã Sính Phình","Xã Sáng Nhè","Xã Mường Đun","Xã Mường Báng"]},{"name":"Huyện Tuần Giáo","communes":["Thị trấn Tuần Giáo","Xã Phình Sáng","Xã Rạng Đông","Xã Mùn Chung","Xã Nà Tòng","Xã Ta Ma","Xã Mường Mùn","Xã Pú Xi","Xã Pú Nhung","Xã Quài Nưa","Xã Mường Thín","Xã Tỏa Tình","Xã Nà Sáy","Xã Mường Khong","Xã Quài Cang","Xã Quài Tở","Xã Chiềng Sinh","Xã Chiềng Đông","Xã Tênh Phông"]},{"name":"Huyện Điện Biên","communes":["Xã Mường Pồn","Xã Thanh Nưa","Xã Hua Thanh","Xã Thanh Luông","Xã Thanh Hưng","Xã Thanh Xương","Xã Thanh Chăn","Xã Pa Thơm","Xã Thanh An","Xã Thanh Yên","Xã Noong Luống","Xã Noọng Hẹt","Xã Sam Mứn","Xã Pom Lót","Xã Núa Ngam","Xã Hẹ Muông","Xã Na Ư","Xã Mường Nhà","Xã Na Tông","Xã Mường Lói","Xã Phu Luông"]},{"name":"Huyện Điện Biên Đông","communes":["Thị trấn Điện Biên Đông","Xã Na Son","Xã Phì Nhừ","Xã Chiềng Sơ","Xã Mường Luân","Xã Pú Nhi","Xã Nong U","Xã Xa Dung","Xã Keo Lôm","Xã Luân Giới","Xã Phình Giàng","Xã Pú Hồng","Xã Tìa Dình","Xã Háng Lìa"]},{"name":"Huyện Mường Ảng","communes":["Thị trấn Mường Ảng","Xã Mường Đăng","Xã Ngối Cáy","Xã Ẳng Tở","Xã Búng Lao","Xã Xuân Lao","Xã Ẳng Nưa","Xã Ẳng Cang","Xã Nặm Lịch","Xã Mường Lạn"]},{"name":"Huyện Nậm Pồ","communes":["Xã Nậm Tin","Xã Pa Tần","Xã Chà Cang","Xã Na Cô Sa","Xã Nà Khoa","Xã Nà Hỳ","Xã Nà Bủng","Xã Nậm Nhừ","Xã Nậm Chua","Xã Nậm Khăn","Xã Chà Tở","Xã Vàng Đán","Xã Chà Nưa","Xã Phìn Hồ","Xã Si Pa Phìn"]}]},{"name":"Tỉnh Lai Châu","districts":[{"name":"Thành phố Lai Châu","communes":["Phường Quyết Thắng","Phường Tân Phong","Phường Quyết Tiến","Phường Đoàn Kết","Xã Sùng Phài","Phường Đông Phong","Xã San Thàng"]},{"name":"Huyện Tam Đường","communes":["Thị trấn Tam Đường","Xã Thèn Sin","Xã Tả Lèng","Xã Giang Ma","Xã Hồ Thầu","Xã Bình Lư","Xã Sơn Bình","Xã Nùng Nàng","Xã Bản Giang","Xã Bản Hon","Xã Bản Bo","Xã Nà Tăm","Xã Khun Há"]},{"name":"Huyện Mường Tè","communes":["Thị trấn Mường Tè","Xã Thu Lũm","Xã Ka Lăng","Xã Tá Bạ","Xã Pa ủ","Xã Mường Tè","Xã Pa Vệ Sử","Xã Mù Cả","Xã Bum Tở","Xã Nậm Khao","Xã Tà Tổng","Xã Bum Nưa","Xã Vàng San","Xã Kan Hồ"]},{"name":"Huyện Sìn Hồ","communes":["Thị trấn Sìn Hồ","Xã Chăn Nưa","Xã Pa Tần","Xã Phìn Hồ","Xã Hồng Thu","Xã Phăng Sô Lin","Xã Ma Quai","Xã Lùng Thàng","Xã Tả Phìn","Xã Sà Dề Phìn","Xã Nậm Tăm","Xã Tả Ngảo","Xã Pu Sam Cáp","Xã Nậm Cha","Xã Pa Khoá","Xã Làng Mô","Xã Noong Hẻo","Xã Nậm Mạ","Xã Căn Co","Xã Tủa Sín Chải","Xã Nậm Cuổi","Xã Nậm Hăn"]},{"name":"Huyện Phong Thổ","communes":["Xã Lả Nhì Thàng","Xã Huổi Luông","Thị trấn Phong Thổ","Xã Sì Lở Lầu","Xã Mồ Sì San","Xã Pa Vây Sử","Xã Vàng Ma Chải","Xã Tông Qua Lìn","Xã Mù Sang","Xã Dào San","Xã Ma Ly Pho","Xã Bản Lang","Xã Hoang Thèn","Xã Khổng Lào","Xã Nậm Xe","Xã Mường So","Xã Sin Suối Hồ"]},{"name":"Huyện Than Uyên","communes":["Thị trấn Than Uyên","Xã Phúc Than","Xã Mường Than","Xã Mường Mít","Xã Pha Mu","Xã Mường Cang","Xã Hua Nà","Xã Tà Hừa","Xã Mường Kim","Xã Tà Mung","Xã Tà Gia","Xã Khoen On"]},{"name":"Huyện Tân Uyên","communes":["Thị trấn Tân Uyên","Xã Mường Khoa","Xã Phúc Khoa","Xã Thân Thuộc","Xã Trung Đồng","Xã Hố Mít","Xã Nậm Cần","Xã Nậm Sỏ","Xã Pắc Ta","Xã Tà Mít"]},{"name":"Huyện Nậm Nhùn","communes":["Thị trấn Nậm Nhùn","Xã Hua Bun","Xã Mường Mô","Xã Nậm Chà","Xã Nậm Manh","Xã Nậm Hàng","Xã Lê Lợi","Xã Pú Đao","Xã Nậm Pì","Xã Nậm Ban","Xã Trung Chải"]}]},{"name":"Tỉnh Sơn La","districts":[{"name":"Thành phố Sơn La","communes":["Phường Chiềng Lề","Phường Tô Hiệu","Phường Quyết Thắng","Phường Quyết Tâm","Xã Chiềng Cọ","Xã Chiềng Đen","Xã Chiềng Xôm","Phường Chiềng An","Phường Chiềng Cơi","Xã Chiềng Ngần","Xã Hua La","Phường Chiềng Sinh"]},{"name":"Huyện Quỳnh Nhai","communes":["Xã Mường Chiên","Xã Cà Nàng","Xã Chiềng Khay","Xã Mường Giôn","Xã Pá Ma Pha Khinh","Xã Chiềng Ơn","Xã Mường Giàng","Xã Chiềng Bằng","Xã Mường Sại","Xã Nậm ét","Xã Chiềng Khoang"]},{"name":"Huyện Thuận Châu","communes":["Thị trấn Thuận Châu","Xã Phổng Lái","Xã Mường é","Xã Chiềng Pha","Xã Chiềng La","Xã Chiềng Ngàm","Xã Liệp Tè","Xã é Tòng","Xã Phổng Lập","Xã Phổng Lăng","Xã Chiềng Ly","Xã Noong Lay","Xã Mường Khiêng","Xã Mường Bám","Xã Long Hẹ","Xã Chiềng Bôm","Xã Thôm Mòn","Xã Tông Lạnh","Xã Tông Cọ","Xã Bó Mười","Xã Co Mạ","Xã Púng Tra","Xã Chiềng Pấc","Xã Nậm Lầu","Xã Bon Phặng","Xã Co Tòng","Xã Muổi Nọi","Xã Pá Lông","Xã Bản Lầm"]},{"name":"Huyện Mường La","communes":["Thị trấn Ít Ong","Xã Nậm Giôn","Xã Chiềng Lao","Xã Hua Trai","Xã Ngọc Chiến","Xã Mường Trai","Xã Nậm Păm","Xã Chiềng Muôn","Xã Chiềng Ân","Xã Pi Toong","Xã Chiềng Công","Xã Tạ Bú","Xã Chiềng San","Xã Mường Bú","Xã Chiềng Hoa","Xã Mường Chùm"]},{"name":"Huyện Bắc Yên","communes":["Thị trấn Bắc Yên","Xã Phiêng Ban","Xã Hang Chú","Xã Xím Vàng","Xã Tà Xùa","Xã Háng Đồng","Xã Pắc Ngà","Xã Làng Chếu","Xã Chim Vàn","Xã Mường Khoa","Xã Song Pe","Xã Hồng Ngài","Xã Tạ Khoa","Xã Hua Nhàn","Xã Phiêng Côn","Xã Chiềng Sại"]},{"name":"Huyện Phù Yên","communes":["Thị trấn Phù Yên","Xã Suối Tọ","Xã Mường Thải","Xã Mường Cơi","Xã Quang Huy","Xã Huy Bắc","Xã Huy Thượng","Xã Tân Lang","Xã Gia Phù","Xã Tường Phù","Xã Huy Hạ","Xã Huy Tân","Xã Mường Lang","Xã Suối Bau","Xã Huy Tường","Xã Mường Do","Xã Sập Xa","Xã Tường Thượng","Xã Tường Tiến","Xã Tường Phong","Xã Tường Hạ","Xã Kim Bon","Xã Mường Bang","Xã Đá Đỏ","Xã Tân Phong","Xã Nam Phong","Xã Bắc Phong"]},{"name":"Huyện Mộc Châu","communes":["Thị trấn Mộc Châu","Thị trấn NT Mộc Châu","Xã Chiềng Sơn","Xã Tân Hợp","Xã Qui Hướng","Xã Tân Lập","Xã Nà Mường","Xã Tà Lai","Xã Chiềng Hắc","Xã Hua Păng","Xã Chiềng Khừa","Xã Mường Sang","Xã Đông Sang","Xã Phiêng Luông","Xã Lóng Sập"]},{"name":"Huyện Yên Châu","communes":["Thị trấn Yên Châu","Xã Chiềng Đông","Xã Sập Vạt","Xã Chiềng Sàng","Xã Chiềng Pằn","Xã Viêng Lán","Xã Chiềng Hặc","Xã Mường Lựm","Xã Chiềng On","Xã Yên Sơn","Xã Chiềng Khoi","Xã Tú Nang","Xã Lóng Phiêng","Xã Phiêng Khoài","Xã Chiềng Tương"]},{"name":"Huyện Mai Sơn","communes":["Thị trấn Hát Lót","Xã Chiềng Sung","Xã Mường Bằng","Xã Chiềng Chăn","Xã Mương Chanh","Xã Chiềng Ban","Xã Chiềng Mung","Xã Mường Bon","Xã Chiềng Chung","Xã Chiềng Mai","Xã Hát Lót","Xã Nà Pó","Xã Cò  Nòi","Xã Chiềng Nơi","Xã Phiêng Cằm","Xã Chiềng Dong","Xã Chiềng Kheo","Xã Chiềng Ve","Xã Chiềng Lương","Xã Phiêng Pằn","Xã Nà Ơt","Xã Tà Hộc"]},{"name":"Huyện Sông Mã","communes":["Thị trấn Sông Mã","Xã Bó Sinh","Xã Pú Pẩu","Xã Chiềng Phung","Xã Chiềng En","Xã Mường Lầm","Xã Nậm Ty","Xã Đứa Mòn","Xã Yên Hưng","Xã Chiềng Sơ","Xã Nà Nghịu","Xã Nậm Mằn","Xã Chiềng Khoong","Xã Chiềng Cang","Xã Huổi Một","Xã Mường Sai","Xã Mường Cai","Xã Mường Hung","Xã Chiềng Khương"]},{"name":"Huyện Sốp Cộp","communes":["Xã Sam Kha","Xã Púng Bánh","Xã Sốp Cộp","Xã Dồm Cang","Xã Nậm Lạnh","Xã Mường Lèo","Xã Mường Và","Xã Mường Lạn"]},{"name":"Huyện Vân Hồ","communes":["Xã Suối Bàng","Xã Song Khủa","Xã Liên Hoà","Xã Tô Múa","Xã Mường Tè","Xã Chiềng Khoa","Xã Mường Men","Xã Quang Minh","Xã Vân Hồ","Xã Lóng Luông","Xã Chiềng Yên","Xã Chiềng Xuân","Xã Xuân Nha","Xã Tân Xuân"]}]},{"name":"Tỉnh Yên Bái","districts":[{"name":"Thành phố Yên Bái","communes":["Phường Yên Thịnh","Phường Yên Ninh","Phường Minh Tân","Phường Nguyễn Thái Học","Phường Đồng Tâm","Phường Nguyễn Phúc","Phường Hồng Hà","Xã Minh Bảo","Phường Nam Cường","Xã Tuy Lộc","Xã Tân Thịnh","Xã Âu Lâu","Xã Giới Phiên","Phường Hợp Minh","Xã Văn Phú"]},{"name":"Thị xã Nghĩa Lộ","communes":["Phường Pú Trạng","Phường Trung Tâm","Phường Tân An","Phường Cầu Thia","Xã Nghĩa Lợi","Xã Nghĩa Phúc","Xã Nghĩa An","Xã Nghĩa Lộ","Xã Sơn A","Xã Phù Nham","Xã Thanh Lương","Xã Hạnh Sơn","Xã Phúc Sơn","Xã Thạch Lương"]},{"name":"Huyện Lục Yên","communes":["Thị trấn Yên Thế","Xã Tân Phượng","Xã Lâm Thượng","Xã Khánh Thiện","Xã Minh Chuẩn","Xã Mai Sơn","Xã Khai Trung","Xã Mường Lai","Xã An Lạc","Xã Minh Xuân","Xã Tô Mậu","Xã Tân Lĩnh","Xã Yên Thắng","Xã Khánh Hoà","Xã Vĩnh Lạc","Xã Liễu Đô","Xã Động Quan","Xã Tân Lập","Xã Minh Tiến","Xã Trúc Lâu","Xã Phúc Lợi","Xã Phan Thanh","Xã An Phú","Xã Trung Tâm"]},{"name":"Huyện Văn Yên","communes":["Thị trấn Mậu A","Xã Lang Thíp","Xã Lâm Giang","Xã Châu Quế Thượng","Xã Châu Quế Hạ","Xã An Bình","Xã Quang Minh","Xã Đông An","Xã Đông Cuông","Xã Phong Dụ Hạ","Xã Mậu Đông","Xã Ngòi A","Xã Xuân Tầm","Xã Tân Hợp","Xã An Thịnh","Xã Yên Thái","Xã Phong Dụ Thượng","Xã Yên Hợp","Xã Đại Sơn","Xã Đại Phác","Xã Yên Phú","Xã Xuân Ái","Xã Viễn Sơn","Xã Mỏ Vàng","Xã Nà Hẩu"]},{"name":"Huyện Mù Căng Chải","communes":["Thị trấn Mù Căng Chải","Xã Hồ Bốn","Xã Nậm Có","Xã Khao Mang","Xã Mồ Dề","Xã Chế Cu Nha","Xã Lao Chải","Xã Kim Nọi","Xã Cao Phạ","Xã La Pán Tẩn","Xã Dế Su Phình","Xã Chế Tạo","Xã Púng Luông","Xã Nậm Khắt"]},{"name":"Huyện Trấn Yên","communes":["Thị trấn Cổ Phúc","Xã Tân Đồng","Xã Báo Đáp","Xã Đào Thịnh","Xã Việt Thành","Xã Hòa Cuông","Xã Minh Quán","Xã Quy Mông","Xã Cường Thịnh","Xã Kiên Thành","Xã Nga Quán","Xã Y Can","Xã Lương Thịnh","Xã Bảo Hưng","Xã Việt Cường","Xã Minh Quân","Xã Hồng Ca","Xã Hưng Thịnh","Xã Hưng Khánh","Xã Việt Hồng","Xã Vân Hội"]},{"name":"Huyện Trạm Tấu","communes":["Thị trấn Trạm Tấu","Xã Túc Đán","Xã Pá Lau","Xã Xà Hồ","Xã Phình Hồ","Xã Trạm Tấu","Xã Tà Si Láng","Xã Pá Hu","Xã Làng Nhì","Xã Bản Công","Xã Bản Mù","Xã Hát Lìu"]},{"name":"Huyện Văn Chấn","communes":["Thị trấn NT Liên Sơn","Thị trấn NT Trần Phú","Xã Tú Lệ","Xã Nậm Búng","Xã Gia Hội","Xã Sùng Đô","Xã Nậm Mười","Xã An Lương","Xã Nậm Lành","Xã Sơn Lương","Xã Suối Quyền","Xã Suối Giàng","Xã Nghĩa Sơn","Xã Suối Bu","Thị trấn Sơn Thịnh","Xã Đại Lịch","Xã Đồng Khê","Xã Cát Thịnh","Xã Tân Thịnh","Xã Chấn Thịnh","Xã Bình Thuận","Xã Thượng Bằng La","Xã Minh An","Xã Nghĩa Tâm"]},{"name":"Huyện Yên Bình","communes":["Thị trấn Yên Bình","Thị trấn Thác Bà","Xã Xuân Long","Xã Cảm Nhân","Xã Ngọc Chấn","Xã Tân Nguyên","Xã Phúc Ninh","Xã Bảo Ái","Xã Mỹ Gia","Xã Xuân Lai","Xã Mông Sơn","Xã Cảm Ân","Xã Yên Thành","Xã Tân Hương","Xã Phúc An","Xã Bạch Hà","Xã Vũ Linh","Xã Đại Đồng","Xã Vĩnh Kiên","Xã Yên Bình","Xã Thịnh Hưng","Xã Hán Đà","Xã Phú Thịnh","Xã Đại Minh"]}]},{"name":"Tỉnh Hoà Bình","districts":[{"name":"Thành phố Hòa Bình","communes":["Phường Thái Bình","Phường Tân Hòa","Phường Thịnh Lang","Phường Hữu Nghị","Phường Tân Thịnh","Phường Đồng Tiến","Phường Phương Lâm","Xã Yên Mông","Phường Quỳnh Lâm","Phường Dân Chủ","Xã Hòa Bình","Phường Thống Nhất","Phường Kỳ Sơn","Xã Thịnh Minh","Xã Hợp Thành","Xã Quang Tiến","Xã Mông Hóa","Phường Trung Minh","Xã Độc Lập"]},{"name":"Huyện Đà Bắc","communes":["Thị trấn Đà Bắc","Xã Nánh Nghê","Xã Giáp Đắt","Xã Mường Chiềng","Xã Tân Pheo","Xã Đồng Chum","Xã Tân Minh","Xã Đoàn Kết","Xã Đồng Ruộng","Xã Tú Lý","Xã Trung Thành","Xã Yên Hòa","Xã Cao Sơn","Xã Toàn Sơn","Xã Hiền Lương","Xã Tiền Phong","Xã Vầy Nưa"]},{"name":"Huyện Lương Sơn","communes":["Thị trấn Lương Sơn","Xã Lâm Sơn","Xã Hòa Sơn","Xã Tân Vinh","Xã Nhuận Trạch","Xã Cao Sơn","Xã Cư Yên","Xã Liên Sơn","Xã Cao Dương","Xã Thanh Sơn","Xã Thanh Cao"]},{"name":"Huyện Kim Bôi","communes":["Thị trấn Bo","Xã Đú Sáng","Xã Hùng Sơn","Xã Bình Sơn","Xã Tú Sơn","Xã Vĩnh Tiến","Xã Đông Bắc","Xã Xuân Thủy","Xã Vĩnh Đồng","Xã Kim Lập","Xã Hợp Tiến","Xã Kim Bôi","Xã Nam Thượng","Xã Cuối Hạ","Xã Sào Báy","Xã Mi Hòa","Xã Nuông Dăm"]},{"name":"Huyện Cao Phong","communes":["Thị trấn Cao Phong","Xã Bình Thanh","Xã Thung Nai","Xã Bắc Phong","Xã Thu Phong","Xã Hợp Phong","Xã Tây Phong","Xã Dũng Phong","Xã Nam Phong","Xã Thạch Yên"]},{"name":"Huyện Tân Lạc","communes":["Thị trấn Mãn Đức","Xã Suối Hoa","Xã Phú Vinh","Xã Phú Cường","Xã Mỹ Hòa","Xã Quyết Chiến","Xã Phong Phú","Xã Tử Nê","Xã Thanh Hối","Xã Ngọc Mỹ","Xã Đông Lai","Xã Vân Sơn","Xã Nhân Mỹ","Xã Lỗ Sơn","Xã Ngổ Luông","Xã Gia Mô"]},{"name":"Huyện Mai Châu","communes":["Xã Tân Thành","Thị trấn Mai Châu","Xã Sơn Thủy","Xã Pà Cò","Xã Hang Kia","Xã Đồng Tân","Xã Cun Pheo","Xã Bao La","Xã Tòng Đậu","Xã Nà Phòn","Xã Săm Khóe","Xã Chiềng Châu","Xã Mai Hạ","Xã Thành Sơn","Xã Mai Hịch","Xã Vạn Mai"]},{"name":"Huyện Lạc Sơn","communes":["Thị trấn Vụ Bản","Xã Quý Hòa","Xã Miền Đồi","Xã Mỹ Thành","Xã Tuân Đạo","Xã Văn Nghĩa","Xã Văn Sơn","Xã Tân Lập","Xã Nhân Nghĩa","Xã Thượng Cốc","Xã Quyết Thắng","Xã Xuất Hóa","Xã Yên Phú","Xã Bình Hẻm","Xã Định Cư","Xã Chí Đạo","Xã Ngọc Sơn","Xã Hương Nhượng","Xã Vũ Bình","Xã Tự Do","Xã Yên Nghiệp","Xã Tân Mỹ","Xã Ân Nghĩa","Xã Ngọc Lâu"]},{"name":"Huyện Yên Thủy","communes":["Thị trấn Hàng Trạm","Xã Lạc Sỹ","Xã Lạc Lương","Xã Bảo Hiệu","Xã Đa Phúc","Xã Hữu Lợi","Xã Lạc Thịnh","Xã Đoàn Kết","Xã Phú Lai","Xã Yên Trị","Xã Ngọc Lương"]},{"name":"Huyện Lạc Thủy","communes":["Thị trấn Ba Hàng Đồi","Thị trấn Chi Nê","Xã Phú Nghĩa","Xã Phú Thành","Xã Hưng Thi","Xã Khoan Dụ","Xã Đồng Tâm","Xã Yên Bồng","Xã Thống Nhất","Xã An Bình"]}]},{"name":"Tỉnh Thái Nguyên","districts":[{"name":"Thành phố Thái Nguyên","communes":["Phường Quán Triều","Phường Quang Vinh","Phường Túc Duyên","Phường Hoàng Văn Thụ","Phường Trưng Vương","Phường Quang Trung","Phường Phan Đình Phùng","Phường Tân Thịnh","Phường Thịnh Đán","Phường Đồng Quang","Phường Gia Sàng","Phường Tân Lập","Phường Cam Giá","Phường Phú Xá","Phường Hương Sơn","Phường Trung Thành","Phường Tân Thành","Phường Tân Long","Xã Phúc Hà","Xã Phúc Xuân","Xã Quyết Thắng","Xã Phúc Trìu","Xã Thịnh Đức","Phường Tích Lương","Xã Tân Cương","Xã Sơn Cẩm","Phường Chùa Hang","Xã Cao Ngạn","Xã Linh Sơn","Phường Đồng Bẩm","Xã Huống Thượng","Xã Đồng Liên"]},{"name":"Thành phố Sông Công","communes":["Phường Lương Sơn","Phường Châu Sơn","Phường Mỏ Chè","Phường Cải Đan","Phường Thắng Lợi","Phường Phố Cò","Xã Tân Quang","Phường Bách Quang","Xã Bình Sơn","Xã Bá Xuyên"]},{"name":"Huyện Định Hóa","communes":["Thị trấn Chợ Chu","Xã Linh Thông","Xã Lam Vỹ","Xã Quy Kỳ","Xã Tân Thịnh","Xã Kim Phượng","Xã Bảo Linh","Xã Phúc Chu","Xã Tân Dương","Xã Phượng Tiến","Xã Bảo Cường","Xã Đồng Thịnh","Xã Định Biên","Xã Thanh Định","Xã Trung Hội","Xã Trung Lương","Xã Bình Yên","Xã Điềm Mặc","Xã Phú Tiến","Xã Bộc Nhiêu","Xã Sơn Phú","Xã Phú Đình","Xã Bình Thành"]},{"name":"Huyện Phú Lương","communes":["Thị trấn Giang Tiên","Thị trấn Đu","Xã Yên Ninh","Xã Yên Trạch","Xã Yên Đổ","Xã Yên Lạc","Xã Ôn Lương","Xã Động Đạt","Xã Phủ Lý","Xã Phú Đô","Xã Hợp Thành","Xã Tức Tranh","Xã Phấn Mễ","Xã Vô Tranh","Xã Cổ Lũng"]},{"name":"Huyện Đồng Hỷ","communes":["Thị trấn Sông Cầu","Thị trấn Trại Cau","Xã Văn Lăng","Xã Tân Long","Xã Hòa Bình","Xã Quang Sơn","Xã Minh Lập","Xã Văn Hán","Xã Hóa Trung","Xã Khe Mo","Xã Cây Thị","Xã Hóa Thượng","Xã Hợp Tiến","Xã Tân Lợi","Xã Nam Hòa"]},{"name":"Huyện Võ Nhai","communes":["Thị trấn Đình Cả","Xã Sảng Mộc","Xã Nghinh Tường","Xã Thần Xa","Xã Vũ Chấn","Xã Thượng Nung","Xã Phú Thượng","Xã Cúc Đường","Xã La Hiên","Xã Lâu Thượng","Xã Tràng Xá","Xã Phương Giao","Xã Liên Minh","Xã Dân Tiến","Xã Bình Long"]},{"name":"Huyện Đại Từ","communes":["Thị trấn Hùng Sơn","Thị trấn Quân Chu","Xã Phúc Lương","Xã Minh Tiến","Xã Yên Lãng","Xã Đức Lương","Xã Phú Cường","Xã Na Mao","Xã Phú Lạc","Xã Tân Linh","Xã Phú Thịnh","Xã Phục Linh","Xã Phú Xuyên","Xã Bản Ngoại","Xã Tiên Hội","Xã Cù Vân","Xã Hà Thượng","Xã La Bằng","Xã Hoàng Nông","Xã Khôi Kỳ","Xã An Khánh","Xã Tân Thái","Xã Bình Thuận","Xã Lục Ba","Xã Mỹ Yên","Xã Vạn Thọ","Xã Văn Yên","Xã Ký Phú","Xã Cát Nê","Xã Quân Chu"]},{"name":"Thành phố Phổ Yên","communes":["Phường Bãi Bông","Phường Bắc Sơn","Phường Ba Hàng","Xã Phúc Tân","Xã Phúc Thuận","Phường Hồng Tiến","Xã Minh Đức","Phường Đắc Sơn","Phường Đồng Tiến","Xã Thành Công","Phường Tiên Phong","Xã Vạn Phái","Phường Nam Tiến","Phường Tân Hương","Phường Đông Cao","Phường Trung Thành","Phường Tân Phú","Phường Thuận Thành"]},{"name":"Huyện Phú Bình","communes":["Thị trấn Hương Sơn","Xã Bàn Đạt","Xã Tân Khánh","Xã Tân Kim","Xã Tân Thành","Xã Đào Xá","Xã Bảo Lý","Xã Thượng Đình","Xã Tân Hòa","Xã Nhã Lộng","Xã Điềm Thụy","Xã Xuân Phương","Xã Tân Đức","Xã Úc Kỳ","Xã Lương Phú","Xã Nga My","Xã Kha Sơn","Xã Thanh Ninh","Xã Dương Thành","Xã Hà Châu"]}]},{"name":"Tỉnh Lạng Sơn","districts":[{"name":"Thành phố Lạng Sơn","communes":["Phường Hoàng Văn Thụ","Phường Tam Thanh","Phường Vĩnh Trại","Phường Đông Kinh","Phường Chi Lăng","Xã Hoàng Đồng","Xã Quảng Lạc","Xã Mai Pha"]},{"name":"Huyện Tràng Định","communes":["Thị trấn Thất Khê","Xã Khánh Long","Xã Đoàn Kết","Xã Quốc Khánh","Xã Vĩnh Tiến","Xã Cao Minh","Xã Chí Minh","Xã Tri Phương","Xã Tân Tiến","Xã Tân Yên","Xã Đội Cấn","Xã Tân Minh","Xã Kim Đồng","Xã Chi Lăng","Xã Trung Thành","Xã Đại Đồng","Xã Đào Viên","Xã Đề Thám","Xã Kháng Chiến","Xã Hùng Sơn","Xã Quốc Việt","Xã Hùng Việt"]},{"name":"Huyện Bình Gia","communes":["Xã Hưng Đạo","Xã Vĩnh Yên","Xã Hoa Thám","Xã Quý Hòa","Xã Hồng Phong","Xã Yên Lỗ","Xã Thiện Hòa","Xã Quang Trung","Xã Thiện Thuật","Xã Minh Khai","Xã Thiện Long","Xã Hoàng Văn Thụ","Xã Hòa Bình","Xã Mông Ân","Xã Tân Hòa","Thị trấn Bình Gia","Xã Hồng Thái","Xã Bình La","Xã Tân Văn"]},{"name":"Huyện Văn Lãng","communes":["Thị trấn Na Sầm","Xã Trùng Khánh","Xã Bắc La","Xã Thụy Hùng","Xã Bắc Hùng","Xã Tân Tác","Xã Thanh Long","Xã Hội Hoan","Xã Bắc Việt","Xã Hoàng Việt","Xã Gia Miễn","Xã Thành Hòa","Xã Tân Thanh","Xã Tân Mỹ","Xã Hồng Thái","Xã  Hoàng Văn Thụ","Xã Nhạc Kỳ"]},{"name":"Huyện Cao Lộc","communes":["Thị trấn Đồng Đăng","Thị trấn Cao Lộc","Xã Bảo Lâm","Xã Thanh Lòa","Xã Cao Lâu","Xã Thạch Đạn","Xã Xuất Lễ","Xã Hồng Phong","Xã Thụy Hùng","Xã Lộc Yên","Xã Phú Xá","Xã Bình Trung","Xã Hải Yến","Xã Hòa Cư","Xã Hợp Thành","Xã Công Sơn","Xã Gia Cát","Xã Mẫu Sơn","Xã Xuân Long","Xã Tân Liên","Xã Yên Trạch","Xã Tân Thành"]},{"name":"Huyện Văn Quan","communes":["Thị trấn Văn Quan","Xã Trấn Ninh","Xã Liên Hội","Xã Hòa Bình","Xã Tú Xuyên","Xã Điềm He","Xã An Sơn","Xã Khánh Khê","Xã Lương Năng","Xã Đồng Giáp","Xã Bình Phúc","Xã Tràng Các","Xã Tân Đoàn","Xã Tri Lễ","Xã Tràng Phái","Xã Yên Phúc","Xã Hữu Lễ"]},{"name":"Huyện Bắc Sơn","communes":["Thị trấn Bắc Sơn","Xã Long Đống","Xã Vạn Thủy","Xã Đồng ý","Xã Tân Tri","Xã Bắc Quỳnh","Xã Hưng Vũ","Xã Tân Lập","Xã Vũ Sơn","Xã Chiêu Vũ","Xã Tân Hương","Xã Chiến Thắng","Xã Vũ Lăng","Xã Trấn Yên","Xã Vũ Lễ","Xã Nhất Hòa","Xã Tân Thành","Xã Nhất Tiến"]},{"name":"Huyện Hữu Lũng","communes":["Thị trấn Hữu Lũng","Xã Hữu Liên","Xã Yên Bình","Xã Quyết Thắng","Xã Hòa Bình","Xã Yên Thịnh","Xã Yên Sơn","Xã Thiện Tân","Xã Yên Vượng","Xã Minh Tiến","Xã Nhật Tiến","Xã Thanh Sơn","Xã Đồng Tân","Xã Cai Kinh","Xã Hòa Lạc","Xã Vân Nham","Xã Đồng Tiến","Xã Tân Thành","Xã Hòa Sơn","Xã Minh Sơn","Xã Hồ Sơn","Xã Sơn Hà","Xã Minh Hòa","Xã Hòa Thắng"]},{"name":"Huyện Chi Lăng","communes":["Thị trấn Đồng Mỏ","Thị trấn Chi Lăng","Xã Vân An","Xã Vân Thủy","Xã Gia Lộc","Xã Bắc Thủy","Xã Chiến Thắng","Xã Mai Sao","Xã Bằng Hữu","Xã Thượng Cường","Xã Bằng Mạc","Xã Nhân Lý","Xã Lâm Sơn","Xã Liên Sơn","Xã Vạn Linh","Xã Hòa Bình","Xã Hữu Kiên","Xã Quan Sơn","Xã Y Tịch","Xã Chi Lăng"]},{"name":"Huyện Lộc Bình","communes":["Thị trấn Na Dương","Thị trấn Lộc Bình","Xã Mẫu Sơn","Xã Yên Khoái","Xã Khánh Xuân","Xã Tú Mịch","Xã Hữu Khánh","Xã Đồng Bục","Xã Tam Gia","Xã Tú Đoạn","Xã Khuất Xá","Xã Tĩnh Bắc","Xã Thống Nhất","Xã Sàn Viên","Xã Đông Quan","Xã Minh Hiệp","Xã Hữu Lân","Xã Lợi Bác","Xã Nam Quan","Xã Xuân Dương","Xã Ái Quốc"]},{"name":"Huyện Đình Lập","communes":["Thị trấn Đình Lập","Thị trấn NT Thái Bình","Xã Bắc Xa","Xã Bính Xá","Xã Kiên Mộc","Xã Đình Lập","Xã Thái Bình","Xã Cường Lợi","Xã Châu Sơn","Xã Lâm Ca","Xã Đồng Thắng","Xã Bắc Lãng"]}]},{"name":"Tỉnh Quảng Ninh","districts":[{"name":"Thành phố Hạ Long","communes":["Phường Hà Khánh","Phường Hà Phong","Phường Hà Khẩu","Phường Cao Xanh","Phường Giếng Đáy","Phường Hà Tu","Phường Hà Trung","Phường Hà Lầm","Phường Bãi Cháy","Phường Cao Thắng","Phường Hùng Thắng","Phường Yết Kiêu","Phường Trần Hưng Đạo","Phường Hồng Hải","Phường Hồng Gai","Phường Bạch Đằng","Phường Hồng Hà","Phường Tuần Châu","Phường Việt Hưng","Phường Đại Yên","Phường Hoành Bồ","Xã Kỳ Thượng","Xã Đồng Sơn","Xã Tân Dân","Xã Đồng Lâm","Xã Hòa Bình","Xã Vũ Oai","Xã Dân Chủ","Xã Quảng La","Xã Bằng Cả","Xã Thống Nhất","Xã Sơn Dương","Xã Lê Lợi"]},{"name":"Thành phố Móng Cái","communes":["Phường Ka Long","Phường Trần Phú","Phường Ninh Dương","Phường Hoà Lạc","Phường Trà Cổ","Xã Hải Sơn","Xã Bắc Sơn","Xã Hải Đông","Xã Hải Tiến","Phường Hải Yên","Xã Quảng Nghĩa","Phường Hải Hoà","Xã Hải Xuân","Xã Vạn Ninh","Phường Bình Ngọc","Xã Vĩnh Trung","Xã Vĩnh Thực"]},{"name":"Thành phố Cẩm Phả","communes":["Phường Mông Dương","Phường Cửa Ông","Phường Cẩm Sơn","Phường Cẩm Đông","Phường Cẩm Phú","Phường Cẩm Tây","Phường Quang Hanh","Phường Cẩm Thịnh","Phường Cẩm Thủy","Phường Cẩm Thạch","Phường Cẩm Thành","Phường Cẩm Trung","Phường Cẩm Bình","Xã Cộng Hòa","Xã Cẩm Hải","Xã Dương Huy"]},{"name":"Thành phố Uông Bí","communes":["Phường Vàng Danh","Phường Thanh Sơn","Phường Bắc Sơn","Phường Quang Trung","Phường Trưng Vương","Phường Nam Khê","Phường Yên Thanh","Xã Thượng Yên Công","Phường Phương Đông","Phường Phương Nam"]},{"name":"Huyện Bình Liêu","communes":["Thị trấn Bình Liêu","Xã Hoành Mô","Xã Đồng Tâm","Xã Đồng Văn","Xã Vô Ngại","Xã Lục Hồn","Xã Húc Động"]},{"name":"Huyện Tiên Yên","communes":["Thị trấn Tiên Yên","Xã Hà Lâu","Xã Đại Dực","Xã Phong Dụ","Xã Điền Xá","Xã Đông Ngũ","Xã Yên Than","Xã Đông Hải","Xã Hải Lạng","Xã Tiên Lãng","Xã Đồng Rui"]},{"name":"Huyện Đầm Hà","communes":["Thị trấn Đầm Hà","Xã Quảng Lâm","Xã Quảng An","Xã Tân Bình","Xã Dực Yên","Xã Quảng Tân","Xã Đầm Hà","Xã Tân Lập","Xã Đại Bình"]},{"name":"Huyện Hải Hà","communes":["Thị trấn Quảng Hà","Xã Quảng Đức","Xã Quảng Sơn","Xã Quảng Thành","Xã Quảng Thịnh","Xã Quảng Minh","Xã Quảng Chính","Xã Quảng Long","Xã Đường Hoa","Xã Quảng Phong","Xã Cái Chiên"]},{"name":"Huyện Ba Chẽ","communes":["Thị trấn Ba Chẽ","Xã Thanh Sơn","Xã Thanh Lâm","Xã Đạp Thanh","Xã Nam Sơn","Xã Lương Mông","Xã Đồn Đạc","Xã Minh Cầm"]},{"name":"Huyện Vân Đồn","communes":["Thị trấn Cái Rồng","Xã Đài Xuyên","Xã Bình Dân","Xã Vạn Yên","Xã Minh Châu","Xã Đoàn Kết","Xã Hạ Long","Xã Đông Xá","Xã Bản Sen","Xã Thắng Lợi","Xã Quan Lạn","Xã Ngọc Vừng"]},{"name":"Thị xã Đông Triều","communes":["Phường Mạo Khê","Phường Đông Triều","Xã An Sinh","Xã Tràng Lương","Xã Bình Khê","Xã Việt Dân","Xã Tân Việt","Xã Bình Dương","Phường Đức Chính","Phường Tràng An","Xã Nguyễn Huệ","Xã Thủy An","Phường Xuân Sơn","Xã Hồng Thái Tây","Xã Hồng Thái Đông","Phường Hoàng Quế","Phường Yên Thọ","Phường Hồng Phong","Phường Kim Sơn","Phường Hưng Đạo","Xã Yên Đức"]},{"name":"Thị xã Quảng Yên","communes":["Phường Quảng Yên","Phường Đông Mai","Phường Minh Thành","Xã Sông Khoai","Xã Hiệp Hòa","Phường Cộng Hòa","Xã Tiền An","Xã Hoàng Tân","Phường Tân An","Phường Yên Giang","Phường Nam Hoà","Phường Hà An","Xã Cẩm La","Phường Phong Hải","Phường Yên Hải","Xã Liên Hòa","Phường Phong Cốc","Xã Liên Vị","Xã Tiền Phong"]},{"name":"Huyện Cô Tô","communes":["Thị trấn Cô Tô","Xã Đồng Tiến","Xã Thanh Lân"]}]},{"name":"Tỉnh Bắc Giang","districts":[{"name":"Thành phố Bắc Giang","communes":["Phường Thọ Xương","Phường Trần Nguyên Hãn","Phường Ngô Quyền","Phường Hoàng Văn Thụ","Phường Trần Phú","Phường Mỹ Độ","Phường Lê Lợi","Xã Song Mai","Phường Xương Giang","Phường Đa Mai","Phường Dĩnh Kế","Xã Dĩnh Trì","Xã Tân Mỹ","Xã Đồng Sơn","Xã Tân Tiến","Xã Song Khê"]},{"name":"Huyện Yên Thế","communes":["Xã Đồng Tiến","Xã Canh Nậu","Xã Xuân Lương","Xã Tam Tiến","Xã Đồng Vương","Xã Đồng Hưu","Xã Đồng Tâm","Xã Tam Hiệp","Xã Tiến Thắng","Xã Hồng Kỳ","Xã Đồng Lạc","Xã Đông Sơn","Xã Tân Hiệp","Xã Hương Vĩ","Xã Đồng Kỳ","Xã An Thượng","Thị trấn Phồn Xương","Xã Tân Sỏi","Thị trấn Bố Hạ"]},{"name":"Huyện Tân Yên","communes":["Xã Lan Giới","Thị trấn Nhã Nam","Xã Tân Trung","Xã Đại Hóa","Xã Quang Tiến","Xã Phúc Sơn","Xã An Dương","Xã Phúc Hòa","Xã Liên Sơn","Xã Hợp Đức","Xã Lam Cốt","Xã Cao Xá","Thị trấn Cao Thượng","Xã Việt Ngọc","Xã Song Vân","Xã Ngọc Châu","Xã Ngọc Vân","Xã Việt Lập","Xã Liên Chung","Xã Ngọc Thiện","Xã Ngọc Lý","Xã Quế Nham"]},{"name":"Huyện Lạng Giang","communes":["Thị trấn Vôi","Xã Nghĩa Hòa","Xã Nghĩa Hưng","Xã Quang Thịnh","Xã Hương Sơn","Xã Đào Mỹ","Xã Tiên Lục","Xã An Hà","Thị trấn Kép","Xã Mỹ Hà","Xã Hương Lạc","Xã Dương Đức","Xã Tân Thanh","Xã Yên Mỹ","Xã Tân Hưng","Xã Mỹ Thái","Xã Xương Lâm","Xã Xuân Hương","Xã Tân Dĩnh","Xã Đại Lâm","Xã Thái Đào"]},{"name":"Huyện Lục Nam","communes":["Thị trấn Đồi Ngô","Xã Đông Hưng","Xã Đông Phú","Xã Tam Dị","Xã Bảo Sơn","Xã Bảo Đài","Xã Thanh Lâm","Xã Tiên Nha","Xã Trường Giang","Thị trấn Phương Sơn","Xã Chu Điện","Xã Cương Sơn","Xã Nghĩa Phương","Xã Vô Tranh","Xã Bình Sơn","Xã Lan Mẫu","Xã Yên Sơn","Xã Khám Lạng","Xã Huyền Sơn","Xã Trường Sơn","Xã Lục Sơn","Xã Bắc Lũng","Xã Vũ Xá","Xã Cẩm Lý","Xã Đan Hội"]},{"name":"Huyện Lục Ngạn","communes":["Thị trấn Chũ","Xã Cấm Sơn","Xã Tân Sơn","Xã Phong Minh","Xã Phong Vân","Xã Xa Lý","Xã Hộ Đáp","Xã Sơn Hải","Xã Thanh Hải","Xã Kiên Lao","Xã Biên Sơn","Xã Kiên Thành","Xã Hồng Giang","Xã Kim Sơn","Xã Tân Hoa","Xã Giáp Sơn","Xã Biển Động","Xã Quý Sơn","Xã Trù Hựu","Xã Phì Điền","Xã Tân Quang","Xã Đồng Cốc","Xã Tân Lập","Xã Phú Nhuận","Xã Mỹ An","Xã Nam Dương","Xã Tân Mộc","Xã Đèo Gia","Xã Phượng Sơn"]},{"name":"Huyện Sơn Động","communes":["Thị trấn An Châu","Thị trấn Tây Yên Tử","Xã Vân Sơn","Xã Hữu Sản","Xã Đại Sơn","Xã Phúc Sơn","Xã Giáo Liêm","Xã Cẩm Đàn","Xã An Lạc","Xã Vĩnh An","Xã Yên Định","Xã Lệ Viễn","Xã An Bá","Xã Tuấn Đạo","Xã Dương Hưu","Xã Long Sơn","Xã Thanh Luận"]},{"name":"Huyện Yên Dũng","communes":["Thị trấn Nham Biền","Thị trấn Tân An","Xã Lão Hộ","Xã Hương Gián","Xã Quỳnh Sơn","Xã Nội Hoàng","Xã Tiền Phong","Xã Xuân Phú","Xã Tân Liễu","Xã Trí Yên","Xã Lãng Sơn","Xã Yên Lư","Xã Tiến Dũng","Xã Đức Giang","Xã Cảnh Thụy","Xã Tư Mại","Xã Đồng Việt","Xã Đồng Phúc"]},{"name":"Huyện Việt Yên","communes":["Xã Thượng Lan","Xã Việt Tiến","Xã Nghĩa Trung","Xã Minh Đức","Xã Hương Mai","Xã Tự Lạn","Thị trấn Bích Động","Xã Trung Sơn","Xã Hồng Thái","Xã Tiên Sơn","Xã Tăng Tiến","Xã Quảng Minh","Thị trấn Nếnh","Xã Ninh Sơn","Xã Vân Trung","Xã Vân Hà","Xã Quang Châu"]},{"name":"Huyện Hiệp Hòa","communes":["Xã Đồng Tân","Xã Thanh Vân","Xã Hoàng Lương","Xã Hoàng Vân","Xã Hoàng Thanh","Xã Hoàng An","Xã Ngọc Sơn","Xã Thái Sơn","Xã Hòa Sơn","Thị trấn Thắng","Xã Quang Minh","Xã Lương Phong","Xã Hùng Sơn","Xã Đại Thành","Xã Thường Thắng","Xã Hợp Thịnh","Xã Danh Thắng","Xã Mai Trung","Xã Đoan Bái","Thị trấn Bắc Lý","Xã Xuân Cẩm","Xã Hương Lâm","Xã Đông Lỗ","Xã Châu Minh","Xã Mai Đình"]}]},{"name":"Tỉnh Phú Thọ","districts":[{"name":"Thành phố Việt Trì","communes":["Phường Dữu Lâu","Phường Vân Cơ","Phường Nông Trang","Phường Tân Dân","Phường Gia Cẩm","Phường Tiên Cát","Phường Thọ Sơn","Phường Thanh Miếu","Phường Bạch Hạc","Phường Bến Gót","Phường Vân Phú","Xã Phượng Lâu","Xã Thụy Vân","Phường Minh Phương","Xã Trưng Vương","Phường Minh Nông","Xã Sông Lô","Xã Kim Đức","Xã Hùng Lô","Xã Hy Cương","Xã Chu Hóa","Xã Thanh Đình"]},{"name":"Thị xã Phú Thọ","communes":["Phường Hùng Vương","Phường Phong Châu","Phường Âu Cơ","Xã Hà Lộc","Xã Phú Hộ","Xã Văn Lung","Xã Thanh Minh","Xã Hà Thạch","Phường Thanh Vinh"]},{"name":"Huyện Đoan Hùng","communes":["Thị trấn Đoan Hùng","Xã Hùng Xuyên","Xã Bằng Luân","Xã Vân Du","Xã Phú Lâm","Xã Minh Lương","Xã Bằng Doãn","Xã Chí Đám","Xã Phúc Lai","Xã Ngọc Quan","Xã Hợp Nhất","Xã Sóc Đăng","Xã Tây Cốc","Xã Yên Kiện","Xã Hùng Long","Xã Vụ Quang","Xã Vân Đồn","Xã Tiêu Sơn","Xã Minh Tiến","Xã Minh Phú","Xã Chân Mộng","Xã Ca Đình"]},{"name":"Huyện Hạ Hoà","communes":["Thị trấn Hạ Hoà","Xã Đại Phạm","Xã Đan Thượng","Xã Hà Lương","Xã Tứ Hiệp","Xã Hiền Lương","Xã Phương Viên","Xã Gia Điền","Xã Ấm Hạ","Xã Hương Xạ","Xã Xuân Áng","Xã Yên Kỳ","Xã Minh Hạc","Xã Lang Sơn","Xã Bằng Giã","Xã Yên Luật","Xã Vô Tranh","Xã Văn Lang","Xã Minh Côi","Xã Vĩnh Chân"]},{"name":"Huyện Thanh Ba","communes":["Thị trấn Thanh Ba","Xã Vân Lĩnh","Xã Đông Lĩnh","Xã Đại An","Xã Hanh Cù","Xã Đồng Xuân","Xã Quảng Yên","Xã Ninh Dân","Xã Võ Lao","Xã Khải Xuân","Xã Mạn Lạn","Xã Hoàng Cương","Xã Chí Tiên","Xã Đông Thành","Xã Sơn Cương","Xã Thanh Hà","Xã Đỗ Sơn","Xã Đỗ Xuyên","Xã Lương Lỗ"]},{"name":"Huyện Phù Ninh","communes":["Thị trấn Phong Châu","Xã Phú Mỹ","Xã Lệ Mỹ","Xã Liên Hoa","Xã Trạm Thản","Xã Trị Quận","Xã Trung Giáp","Xã Tiên Phú","Xã Hạ Giáp","Xã Bảo Thanh","Xã Phú Lộc","Xã Gia Thanh","Xã Tiên Du","Xã Phú Nham","Xã An Đạo","Xã Bình Phú","Xã Phù Ninh"]},{"name":"Huyện Yên Lập","communes":["Thị trấn Yên Lập","Xã Mỹ Lung","Xã Mỹ Lương","Xã Lương Sơn","Xã Xuân An","Xã Xuân Viên","Xã Xuân Thủy","Xã Trung Sơn","Xã Hưng Long","Xã Nga Hoàng","Xã Đồng Lạc","Xã Thượng Long","Xã Đồng Thịnh","Xã Phúc Khánh","Xã Minh Hòa","Xã Ngọc Lập","Xã Ngọc Đồng"]},{"name":"Huyện Cẩm Khê","communes":["Thị trấn Cẩm Khê","Xã Tiên Lương","Xã Tuy Lộc","Xã Ngô Xá","Xã Minh Tân","Xã Phượng Vĩ","Xã Thụy Liễu","Xã Tùng Khê","Xã Tam Sơn","Xã Văn Bán","Xã Cấp Dẫn","Xã Xương Thịnh","Xã Phú Khê","Xã Sơn Tình","Xã Yên Tập","Xã Hương Lung","Xã Tạ Xá","Xã Phú Lạc","Xã Chương Xá","Xã Hùng Việt","Xã Văn Khúc","Xã Yên Dưỡng","Xã Điêu Lương","Xã Đồng Lương"]},{"name":"Huyện Tam Nông","communes":["Thị trấn Hưng Hoá","Xã Hiền Quan","Xã Bắc Sơn","Xã Thanh Uyên","Xã Lam Sơn","Xã Vạn Xuân","Xã Quang Húc","Xã Hương Nộn","Xã Tề Lễ","Xã Thọ Văn","Xã Dị Nậu","Xã Dân Quyền"]},{"name":"Huyện Lâm Thao","communes":["Thị trấn Lâm Thao","Xã Tiên Kiên","Thị trấn Hùng Sơn","Xã Xuân Lũng","Xã Xuân Huy","Xã Thạch Sơn","Xã Sơn Vi","Xã Phùng Nguyên","Xã Cao Xá","Xã Vĩnh Lại","Xã Tứ Xã","Xã Bản Nguyên"]},{"name":"Huyện Thanh Sơn","communes":["Thị trấn Thanh Sơn","Xã Sơn Hùng","Xã Địch Quả","Xã Giáp Lai","Xã Thục Luyện","Xã Võ Miếu","Xã Thạch Khoán","Xã Cự Thắng","Xã Tất Thắng","Xã Văn Miếu","Xã Cự Đồng","Xã Thắng Sơn","Xã Tân Minh","Xã Hương Cần","Xã Khả Cửu","Xã Đông Cửu","Xã Tân Lập","Xã Yên Lãng","Xã Yên Lương","Xã Thượng Cửu","Xã Lương Nha","Xã Yên Sơn","Xã Tinh Nhuệ"]},{"name":"Huyện Thanh Thuỷ","communes":["Xã Đào Xá","Xã Thạch Đồng","Xã Xuân Lộc","Xã Tân Phương","Thị trấn Thanh Thủy","Xã Sơn Thủy","Xã Bảo Yên","Xã Đoan Hạ","Xã Đồng Trung","Xã Hoàng Xá","Xã Tu Vũ"]},{"name":"Huyện Tân Sơn","communes":["Xã Thu Cúc","Xã Thạch Kiệt","Xã Thu Ngạc","Xã Kiệt Sơn","Xã Đồng Sơn","Xã Lai Đồng","Xã Tân Phú","Xã Mỹ Thuận","Xã Tân Sơn","Xã Xuân Đài","Xã Minh Đài","Xã Văn Luông","Xã Xuân Sơn","Xã Long Cốc","Xã Kim Thượng","Xã Tam Thanh","Xã Vinh Tiền"]}]},{"name":"Tỉnh Vĩnh Phúc","districts":[{"name":"Thành phố Vĩnh Yên","communes":["Phường Tích Sơn","Phường Liên Bảo","Phường Hội Hợp","Phường Đống Đa","Phường Ngô Quyền","Phường Đồng Tâm","Xã Định Trung","Phường Khai Quang","Xã Thanh Trù"]},{"name":"Thành phố Phúc Yên","communes":["Phường Trưng Trắc","Phường Hùng Vương","Phường Trưng Nhị","Phường Phúc Thắng","Phường Xuân Hoà","Phường Đồng Xuân","Xã Ngọc Thanh","Xã Cao Minh","Phường Nam Viêm","Phường Tiền Châu"]},{"name":"Huyện Lập Thạch","communes":["Thị trấn Lập Thạch","Xã Quang Sơn","Xã Ngọc Mỹ","Xã Hợp Lý","Xã Bắc Bình","Xã Thái Hòa","Thị trấn Hoa Sơn","Xã Liễn Sơn","Xã Xuân Hòa","Xã Vân Trục","Xã Liên Hòa","Xã Tử Du","Xã Bàn Giản","Xã Xuân Lôi","Xã Đồng Ích","Xã Tiên Lữ","Xã Văn Quán","Xã Đình Chu","Xã Triệu Đề","Xã Sơn Đông"]},{"name":"Huyện Tam Dương","communes":["Thị trấn Hợp Hòa","Xã Hoàng Hoa","Xã Đồng Tĩnh","Xã Kim Long","Xã Hướng Đạo","Xã Đạo Tú","Xã An Hòa","Xã Thanh Vân","Xã Duy Phiên","Xã Hoàng Đan","Xã Hoàng Lâu","Xã Vân Hội","Xã Hợp Thịnh"]},{"name":"Huyện Tam Đảo","communes":["Thị trấn Tam Đảo","Thị trấn Hợp Châu","Xã Đạo Trù","Xã Yên Dương","Xã Bồ Lý","Thị trấn Đại Đình","Xã Tam Quan","Xã Hồ Sơn","Xã Minh Quang"]},{"name":"Huyện Bình Xuyên","communes":["Thị trấn Hương Canh","Thị trấn Gia Khánh","Xã Trung Mỹ","Thị trấn Bá Hiến","Xã Thiện Kế","Xã Hương Sơn","Xã Tam Hợp","Xã Quất Lưu","Xã Sơn Lôi","Thị trấn Đạo Đức","Xã Tân Phong","Thị trấn Thanh Lãng","Xã Phú Xuân"]},{"name":"Huyện Yên Lạc","communes":["Thị trấn Yên Lạc","Xã Đồng Cương","Xã Đồng Văn","Xã Bình Định","Xã Trung Nguyên","Xã Tề Lỗ","Xã Tam Hồng","Xã Yên Đồng","Xã Văn Tiến","Xã Nguyệt Đức","Xã Yên Phương","Xã Hồng Phương","Xã Trung Kiên","Xã Liên Châu","Xã Đại Tự","Xã Hồng Châu","Xã Trung Hà"]},{"name":"Huyện Vĩnh Tường","communes":["Thị trấn Vĩnh Tường","Xã Kim Xá","Xã Yên Bình","Xã Chấn Hưng","Xã Nghĩa Hưng","Xã Yên Lập","Xã Việt Xuân","Xã Bồ Sao","Xã Đại Đồng","Xã Tân Tiến","Xã Lũng Hoà","Xã Cao Đại","Thị Trấn Thổ Tang","Xã Vĩnh Sơn","Xã Bình Dương","Xã Tân Phú","Xã Thượng Trưng","Xã Vũ Di","Xã Lý Nhân","Xã Tuân Chính","Xã Vân Xuân","Xã Tam Phúc","Thị trấn Tứ Trưng","Xã Ngũ Kiên","Xã An Tường","Xã Vĩnh Thịnh","Xã Phú Đa","Xã Vĩnh Ninh"]},{"name":"Huyện Sông Lô","communes":["Xã Lãng Công","Xã Quang Yên","Xã Bạch Lưu","Xã Hải Lựu","Xã Đồng Quế","Xã Nhân Đạo","Xã Đôn Nhân","Xã Phương Khoan","Xã Tân Lập","Xã Nhạo Sơn","Thị trấn Tam Sơn","Xã Như Thụy","Xã Yên Thạch","Xã Đồng Thịnh","Xã Tứ Yên","Xã Đức Bác","Xã Cao Phong"]}]},{"name":"Tỉnh Bắc Ninh","districts":[{"name":"Thành phố Bắc Ninh","communes":["Phường Vũ Ninh","Phường Đáp Cầu","Phường Thị Cầu","Phường Kinh Bắc","Phường Vệ An","Phường Tiền An","Phường Đại Phúc","Phường Ninh Xá","Phường Suối Hoa","Phường Võ Cường","Phường Hòa Long","Phường Vạn An","Phường Khúc Xuyên","Phường Phong Khê","Phường Kim Chân","Phường Vân Dương","Phường Nam Sơn","Phường Khắc Niệm","Phường Hạp Lĩnh"]},{"name":"Huyện Yên Phong","communes":["Thị trấn Chờ","Xã Dũng Liệt","Xã Tam Đa","Xã Tam Giang","Xã Yên Trung","Xã Thụy Hòa","Xã Hòa Tiến","Xã Đông Tiến","Xã Yên Phụ","Xã Trung Nghĩa","Xã Đông Phong","Xã Long Châu","Xã Văn Môn","Xã Đông Thọ"]},{"name":"Thị xã Quế Võ","communes":["Thị trấn Phố Mới","Xã Việt Thống","Xã Đại Xuân","Xã Nhân Hòa","Xã Bằng An","Xã Phương Liễu","Xã Quế Tân","Xã Phù Lương","Xã Phù Lãng","Xã Phượng Mao","Xã Việt Hùng","Xã Ngọc Xá","Xã Châu Phong","Xã Bồng Lai","Xã Cách Bi","Xã Đào Viên","Xã Yên Giả","Xã Mộ Đạo","Xã Đức Long","Xã Chi Lăng","Xã Hán Quảng"]},{"name":"Huyện Tiên Du","communes":["Thị trấn Lim","Xã Phú Lâm","Xã Nội Duệ","Xã Liên Bão","Xã Hiên Vân","Xã Hoàn Sơn","Xã Lạc Vệ","Xã Việt Đoàn","Xã Phật Tích","Xã Tân Chi","Xã Đại Đồng","Xã Tri Phương","Xã Minh Đạo","Xã Cảnh Hưng"]},{"name":"Thành phố Từ Sơn","communes":["Phường Đông Ngàn","Phường Tam Sơn","Phường Hương Mạc","Phường Tương Giang","Phường Phù Khê","Phường Đồng Kỵ","Phường Trang Hạ","Phường Đồng Nguyên","Phường Châu Khê","Phường Tân Hồng","Phường Đình Bảng","Phường Phù Chẩn"]},{"name":"Thị xã Thuận Thành","communes":["Thị trấn Hồ","Xã Hoài Thượng","Xã Đại Đồng Thành","Xã Mão Điền","Xã Song Hồ","Xã Đình Tổ","Xã An Bình","Xã Trí Quả","Xã Gia Đông","Xã Thanh Khương","Xã Trạm Lộ","Xã Xuân Lâm","Xã Hà Mãn","Xã Ngũ Thái","Xã Nguyệt Đức","Xã Ninh Xá","Xã Nghĩa Đạo","Xã Song Liễu"]},{"name":"Huyện Gia Bình","communes":["Thị trấn Gia Bình","Xã Vạn Ninh","Xã Thái Bảo","Xã Giang Sơn","Xã Cao Đức","Xã Đại Lai","Xã Song Giang","Xã Bình Dương","Xã Lãng Ngâm","Xã Nhân Thắng","Xã Xuân Lai","Xã Đông Cứu","Xã Đại Bái","Xã Quỳnh Phú"]},{"name":"Huyện Lương Tài","communes":["Thị trấn Thứa","Xã An Thịnh","Xã Trung Kênh","Xã Phú Hòa","Xã Mỹ Hương","Xã Tân Lãng","Xã Quảng Phú","Xã Trừng Xá","Xã Lai Hạ","Xã Trung Chính","Xã Minh Tân","Xã Bình Định","Xã Phú Lương","Xã Lâm Thao"]}]},{"name":"Tỉnh Hải Dương","districts":[{"name":"Thành phố Hải Dương","communes":["Phường Cẩm Thượng","Phường Bình Hàn","Phường Ngọc Châu","Phường Nhị Châu","Phường Quang Trung","Phường Nguyễn Trãi","Phường Phạm Ngũ Lão","Phường Trần Hưng Đạo","Phường Trần Phú","Phường Thanh Bình","Phường Tân Bình","Phường Lê Thanh Nghị","Phường Hải Tân","Phường Tứ Minh","Phường Việt Hoà","Phường Ái Quốc","Xã An Thượng","Phường Nam Đồng","Xã Quyết Thắng","Xã Tiền Tiến","Phường Thạch Khôi","Xã Liên Hồng","Phường Tân Hưng","Xã Gia Xuyên","Xã Ngọc Sơn"]},{"name":"Thành phố Chí Linh","communes":["Phường Phả Lại","Phường Sao Đỏ","Phường Bến Tắm","Xã Hoàng Hoa Thám","Xã Bắc An","Xã Hưng Đạo","Xã Lê Lợi","Phường Hoàng Tiến","Phường Cộng Hoà","Phường Hoàng Tân","Phường Cổ Thành","Phường Văn An","Phường Chí Minh","Phường Văn Đức","Phường Thái Học","Xã Nhân Huệ","Phường An Lạc","Phường Đồng Lạc","Phường Tân Dân"]},{"name":"Huyện Nam Sách","communes":["Thị trấn Nam Sách","Xã Nam Hưng","Xã Nam Tân","Xã Hợp Tiến","Xã Hiệp Cát","Xã Thanh Quang","Xã Quốc Tuấn","Xã Nam Chính","Xã An Bình","Xã Nam Trung","Xã An Sơn","Xã Cộng Hòa","Xã Thái Tân","Xã An Lâm","Xã Phú Điền","Xã Nam Hồng","Xã Hồng Phong","Xã Đồng Lạc","Xã Minh Tân"]},{"name":"Thị xã Kinh Môn","communes":["Phường An Lưu","Xã Bạch Đằng","Phường Thất Hùng","Xã Lê Ninh","Xã Hoành Sơn","Phường Phạm Thái","Phường Duy Tân","Phường Tân Dân","Phường Minh Tân","Xã Quang Thành","Xã Hiệp Hòa","Phường Phú Thứ","Xã Thăng Long","Xã Lạc Long","Phường An Sinh","Phường Hiệp Sơn","Xã Thượng Quận","Phường An Phụ","Phường Hiệp An","Phường Long Xuyên","Phường Thái Thịnh","Phường Hiến Thành","Xã Minh Hòa"]},{"name":"Huyện Kim Thành","communes":["Thị trấn Phú Thái","Xã Lai Vu","Xã Cộng Hòa","Xã Thượng Vũ","Xã Cổ Dũng","Xã Tuấn Việt","Xã Kim Xuyên","Xã Phúc Thành A","Xã Ngũ Phúc","Xã Kim Anh","Xã Kim Liên","Xã Kim Tân","Xã Kim Đính","Xã Bình Dân","Xã Tam Kỳ","Xã Đồng Cẩm","Xã Liên Hòa","Xã Đại Đức"]},{"name":"Huyện Thanh Hà","communes":["Thị trấn Thanh Hà","Xã Hồng Lạc","Xã Việt Hồng","Xã Tân Việt","Xã Cẩm Chế","Xã Thanh An","Xã Thanh Lang","Xã Tân An","Xã Liên Mạc","Xã Thanh Hải","Xã Thanh Khê","Xã Thanh Xá","Xã Thanh Xuân","Xã Thanh Thủy","Xã An Phượng","Xã Thanh Sơn","Xã Thanh Quang","Xã Thanh Hồng","Xã Thanh Cường","Xã Vĩnh Lập"]},{"name":"Huyện Cẩm Giàng","communes":["Thị trấn Cẩm Giang","Thị trấn Lai Cách","Xã Cẩm Hưng","Xã Cẩm Hoàng","Xã Cẩm Văn","Xã Ngọc Liên","Xã Thạch Lỗi","Xã Cẩm Vũ","Xã Đức Chính","Xã Định Sơn","Xã Lương Điền","Xã Cao An","Xã Tân Trường","Xã Cẩm Phúc","Xã Cẩm Điền","Xã Cẩm Đông","Xã Cẩm Đoài"]},{"name":"Huyện Bình Giang","communes":["Thị trấn Kẻ Sặt","Xã Vĩnh Hưng","Xã Hùng Thắng","Xã Vĩnh Hồng","Xã Long Xuyên","Xã Tân Việt","Xã Thúc Kháng","Xã Tân Hồng","Xã Bình Minh","Xã Hồng Khê","Xã Thái Học","Xã Cổ Bì","Xã Nhân Quyền","Xã Thái Dương","Xã Thái Hòa","Xã Bình Xuyên"]},{"name":"Huyện Gia Lộc","communes":["Thị trấn Gia Lộc","Xã Thống Nhất","Xã Yết Kiêu","Xã Gia Tân","Xã Tân Tiến","Xã Gia Khánh","Xã Gia Lương","Xã Lê Lợi","Xã Toàn Thắng","Xã Hoàng Diệu","Xã Hồng Hưng","Xã Phạm Trấn","Xã Đoàn Thượng","Xã Thống Kênh","Xã Quang Minh","Xã Đồng Quang","Xã Nhật Tân","Xã Đức Xương"]},{"name":"Huyện Tứ Kỳ","communes":["Thị trấn Tứ Kỳ","Xã Đại Sơn","Xã Hưng Đạo","Xã Ngọc Kỳ","Xã Bình Lăng","Xã Chí Minh","Xã Tái Sơn","Xã Quang Phục","Xã Dân Chủ","Xã Tân Kỳ","Xã Quang Khải","Xã Đại Hợp","Xã Quảng Nghiệp","Xã An Thanh","Xã Minh Đức","Xã Văn Tố","Xã Quang Trung","Xã Phượng Kỳ","Xã Cộng Lạc","Xã Tiên Động","Xã Nguyên Giáp","Xã Hà Kỳ","Xã Hà Thanh"]},{"name":"Huyện Ninh Giang","communes":["Thị trấn Ninh Giang","Xã Ứng Hoè","Xã Nghĩa An","Xã Hồng Đức","Xã An Đức","Xã Vạn Phúc","Xã Tân Hương","Xã Vĩnh Hòa","Xã Đông Xuyên","Xã Tân Phong","Xã Ninh Hải","Xã Đồng Tâm","Xã Tân Quang","Xã Kiến Quốc","Xã Hồng Dụ","Xã Văn Hội","Xã Hồng Phong","Xã Hiệp Lực","Xã Hồng Phúc","Xã Hưng Long"]},{"name":"Huyện Thanh Miện","communes":["Thị trấn Thanh Miện","Xã Thanh Tùng","Xã Phạm Kha","Xã Ngô Quyền","Xã Đoàn Tùng","Xã Hồng Quang","Xã Tân Trào","Xã Lam Sơn","Xã Đoàn Kết","Xã Lê Hồng","Xã Tứ Cường","Xã Ngũ Hùng","Xã Cao Thắng","Xã Chi Lăng Bắc","Xã Chi Lăng Nam","Xã Thanh Giang","Xã Hồng Phong"]}]},{"name":"Thành phố Hải Phòng","districts":[{"name":"Quận Hồng Bàng","communes":["Phường Quán Toan","Phường Hùng Vương","Phường Sở Dầu","Phường Thượng Lý","Phường Hạ Lý","Phường Minh Khai","Phường Trại Chuối","Phường Hoàng Văn Thụ","Phường Phan Bội Châu"]},{"name":"Quận Ngô Quyền","communes":["Phường Máy Chai","Phường Máy Tơ","Phường Vạn Mỹ","Phường Cầu Tre","Phường Lạc Viên","Phường Cầu Đất","Phường Gia Viên","Phường Đông Khê","Phường Lê Lợi","Phường Đằng Giang","Phường Lạch Tray","Phường Đổng Quốc Bình"]},{"name":"Quận Lê Chân","communes":["Phường Cát Dài","Phường An Biên","Phường Lam Sơn","Phường An Dương","Phường Trần Nguyên Hãn","Phường Hồ Nam","Phường Trại Cau","Phường Dư Hàng","Phường Hàng Kênh","Phường Đông Hải","Phường Niệm Nghĩa","Phường Nghĩa Xá","Phường Dư Hàng Kênh","Phường Kênh Dương","Phường Vĩnh Niệm"]},{"name":"Quận Hải An","communes":["Phường Đông Hải 1","Phường Đông Hải 2","Phường Đằng Lâm","Phường Thành Tô","Phường Đằng Hải","Phường Nam Hải","Phường Cát Bi","Phường Tràng Cát"]},{"name":"Quận Kiến An","communes":["Phường Quán Trữ","Phường Lãm Hà","Phường Đồng Hoà","Phường Bắc Sơn","Phường Nam Sơn","Phường Ngọc Sơn","Phường Trần Thành Ngọ","Phường Văn Đẩu","Phường Phù Liễn","Phường Tràng Minh"]},{"name":"Quận Đồ Sơn","communes":["Phường Ngọc Xuyên","Phường Hải Sơn","Phường Vạn Hương","Phường Minh Đức","Phường Bàng La","Phường Hợp Đức"]},{"name":"Quận Dương Kinh","communes":["Phường Đa Phúc","Phường Hưng Đạo","Phường Anh Dũng","Phường Hải Thành","Phường Hoà Nghĩa","Phường Tân Thành"]},{"name":"Huyện Thuỷ Nguyên","communes":["Thị trấn Núi Đèo","Thị trấn Minh Đức","Xã Lại Xuân","Xã An Sơn","Xã Kỳ Sơn","Xã Liên Khê","Xã Lưu Kiếm","Xã Lưu Kỳ","Xã Gia Minh","Xã Gia Đức","Xã Minh Tân","Xã Phù Ninh","Xã Quảng Thanh","Xã Chính Mỹ","Xã Kênh Giang","Xã Hợp Thành","Xã Cao Nhân","Xã Mỹ Đồng","Xã Đông Sơn","Xã Hoà Bình","Xã Trung Hà","Xã An Lư","Xã Thuỷ Triều","Xã Ngũ Lão","Xã Phục Lễ","Xã Tam Hưng","Xã Phả Lễ","Xã Lập Lễ","Xã Kiền Bái","Xã Thiên Hương","Xã Thuỷ Sơn","Xã Thuỷ Đường","Xã Hoàng Động","Xã Lâm Động","Xã Hoa Động","Xã Tân Dương","Xã Dương Quan"]},{"name":"Huyện An Dương","communes":["Thị trấn An Dương","Xã Lê Thiện","Xã Đại Bản","Xã An Hoà","Xã Hồng Phong","Xã Tân Tiến","Xã An Hưng","Xã An Hồng","Xã Bắc Sơn","Xã Nam Sơn","Xã Lê Lợi","Xã Đặng Cương","Xã Đồng Thái","Xã Quốc Tuấn","Xã An Đồng","Xã Hồng Thái"]},{"name":"Huyện An Lão","communes":["Thị trấn An Lão","Xã Bát Trang","Xã Trường Thọ","Xã Trường Thành","Xã An Tiến","Xã Quang Hưng","Xã Quang Trung","Xã Quốc Tuấn","Xã An Thắng","Thị trấn Trường Sơn","Xã Tân Dân","Xã Thái Sơn","Xã Tân Viên","Xã Mỹ Đức","Xã Chiến Thắng","Xã An Thọ","Xã An Thái"]},{"name":"Huyện Kiến Thuỵ","communes":["Thị trấn Núi Đối","Xã Đông Phương","Xã Thuận Thiên","Xã Hữu Bằng","Xã Đại Đồng","Xã Ngũ Phúc","Xã Kiến Quốc","Xã Du Lễ","Xã Thuỵ Hương","Xã Thanh Sơn","Xã Minh Tân","Xã Đại Hà","Xã Ngũ Đoan","Xã Tân Phong","Xã Tân Trào","Xã Đoàn Xá","Xã Tú Sơn","Xã Đại Hợp"]},{"name":"Huyện Tiên Lãng","communes":["Thị trấn Tiên Lãng","Xã Đại Thắng","Xã Tiên Cường","Xã Tự Cường","Xã Quyết Tiến","Xã Khởi Nghĩa","Xã Tiên Thanh","Xã Cấp Tiến","Xã Kiến Thiết","Xã Đoàn Lập","Xã Bạch Đằng","Xã Quang Phục","Xã Toàn Thắng","Xã Tiên Thắng","Xã Tiên Minh","Xã Bắc Hưng","Xã Nam Hưng","Xã Hùng Thắng","Xã Tây Hưng","Xã Đông Hưng","Xã Vinh Quang"]},{"name":"Huyện Vĩnh Bảo","communes":["Thị trấn Vĩnh Bảo","Xã Dũng Tiến","Xã Giang Biên","Xã Thắng Thuỷ","Xã Trung Lập","Xã Việt Tiến","Xã Vĩnh An","Xã Vĩnh Long","Xã Hiệp Hoà","Xã Hùng Tiến","Xã An Hoà","Xã Tân Hưng","Xã Tân Liên","Xã Nhân Hoà","Xã Tam Đa","Xã Hưng Nhân","Xã Vinh Quang","Xã Đồng Minh","Xã Thanh Lương","Xã Liên Am","Xã Lý Học","Xã Tam Cường","Xã Hoà Bình","Xã Tiền Phong","Xã Vĩnh Phong","Xã Cộng Hiền","Xã Cao Minh","Xã Cổ Am","Xã Vĩnh Tiến","Xã Trấn Dương"]},{"name":"Huyện Cát Hải","communes":["Thị trấn Cát Bà","Thị trấn Cát Hải","Xã Nghĩa Lộ","Xã Đồng Bài","Xã Hoàng Châu","Xã Văn Phong","Xã Phù Long","Xã Gia Luận","Xã Hiền Hào","Xã Trân Châu","Xã Việt Hải","Xã Xuân Đám"]},{"name":"Huyện Bạch Long Vĩ","communes":[]}]},{"name":"Tỉnh Hưng Yên","districts":[{"name":"Thành phố Hưng Yên","communes":["Phường Lam Sơn","Phường Hiến Nam","Phường An Tảo","Phường Lê Lợi","Phường Minh Khai","Phường Quang Trung","Phường Hồng Châu","Xã Trung Nghĩa","Xã Liên Phương","Xã Hồng Nam","Xã Quảng Châu","Xã Bảo Khê","Xã Phú Cường","Xã Hùng Cường","Xã Phương Chiểu","Xã Tân Hưng","Xã Hoàng Hanh"]},{"name":"Huyện Văn Lâm","communes":["Thị trấn Như Quỳnh","Xã Lạc Đạo","Xã Chỉ Đạo","Xã Đại Đồng","Xã Việt Hưng","Xã Tân Quang","Xã Đình Dù","Xã Minh Hải","Xã Lương Tài","Xã Trưng Trắc","Xã Lạc Hồng"]},{"name":"Huyện Văn Giang","communes":["Thị trấn Văn Giang","Xã Xuân Quan","Xã Cửu Cao","Xã Phụng Công","Xã Nghĩa Trụ","Xã Long Hưng","Xã Vĩnh Khúc","Xã Liên Nghĩa","Xã Tân Tiến","Xã Thắng Lợi","Xã Mễ Sở"]},{"name":"Huyện Yên Mỹ","communes":["Thị trấn Yên Mỹ","Xã Giai Phạm","Xã Nghĩa Hiệp","Xã Đồng Than","Xã Ngọc Long","Xã Liêu Xá","Xã Hoàn Long","Xã Tân Lập","Xã Thanh Long","Xã Yên Phú","Xã Việt Cường","Xã Trung Hòa","Xã Yên Hòa","Xã Minh Châu","Xã Trung Hưng","Xã Lý Thường Kiệt","Xã Tân Việt"]},{"name":"Thị xã Mỹ Hào","communes":["Phường Bần Yên Nhân","Phường Phan Đình Phùng","Xã Cẩm Xá","Xã Dương Quang","Xã Hòa Phong","Phường Nhân Hòa","Phường Dị Sử","Phường Bạch Sam","Phường Minh Đức","Phường Phùng Chí Kiên","Xã Xuân Dục","Xã Ngọc Lâm","Xã Hưng Long"]},{"name":"Huyện Ân Thi","communes":["Thị trấn Ân Thi","Xã Phù Ủng","Xã Bắc Sơn","Xã Bãi Sậy","Xã Đào Dương","Xã Tân Phúc","Xã Vân Du","Xã Quang Vinh","Xã Xuân Trúc","Xã Hoàng Hoa Thám","Xã Quảng Lãng","Xã Văn Nhuệ","Xã Đặng Lễ","Xã Cẩm Ninh","Xã Nguyễn Trãi","Xã Đa Lộc","Xã Hồ Tùng Mậu","Xã Tiền Phong","Xã Hồng Vân","Xã Hồng Quang","Xã Hạ Lễ"]},{"name":"Huyện Khoái Châu","communes":["Thị trấn Khoái Châu","Xã Đông Tảo","Xã Bình Minh","Xã Dạ Trạch","Xã Hàm Tử","Xã Ông Đình","Xã Tân Dân","Xã Tứ Dân","Xã An Vĩ","Xã Đông Kết","Xã Bình Kiều","Xã Dân Tiến","Xã Đồng Tiến","Xã Hồng Tiến","Xã Tân Châu","Xã Liên Khê","Xã Phùng Hưng","Xã Việt Hòa","Xã Đông Ninh","Xã Đại Tập","Xã Chí Tân","Xã Đại Hưng","Xã Thuần Hưng","Xã Thành Công","Xã Nhuế Dương"]},{"name":"Huyện Kim Động","communes":["Thị trấn Lương Bằng","Xã Nghĩa Dân","Xã Toàn Thắng","Xã Vĩnh Xá","Xã Phạm Ngũ Lão","Xã Thọ Vinh","Xã Đồng Thanh","Xã Song Mai","Xã Chính Nghĩa","Xã Nhân La","Xã Phú Thịnh","Xã Mai Động","Xã Đức Hợp","Xã Hùng An","Xã Ngọc Thanh","Xã Vũ Xá","Xã Hiệp Cường"]},{"name":"Huyện Tiên Lữ","communes":["Thị trấn Vương","Xã Hưng Đạo","Xã Ngô Quyền","Xã Nhật Tân","Xã Dị Chế","Xã Lệ Xá","Xã An Viên","Xã Đức Thắng","Xã Trung Dũng","Xã Hải Triều","Xã Thủ Sỹ","Xã Thiện Phiến","Xã Thụy Lôi","Xã Cương Chính","Xã Minh Phượng"]},{"name":"Huyện Phù Cừ","communes":["Thị trấn Trần Cao","Xã Minh Tân","Xã Phan Sào Nam","Xã Quang Hưng","Xã Minh Hoàng","Xã Đoàn Đào","Xã Tống Phan","Xã Đình Cao","Xã Nhật Quang","Xã Tiền Tiến","Xã Tam Đa","Xã Minh Tiến","Xã Nguyên Hòa","Xã Tống Trân"]}]},{"name":"Tỉnh Thái Bình","districts":[{"name":"Thành phố Thái Bình","communes":["Phường Lê Hồng Phong","Phường Bồ Xuyên","Phường Đề Thám","Phường Kỳ Bá","Phường Quang Trung","Phường Phú Khánh","Phường Tiền Phong","Phường Trần Hưng Đạo","Phường Trần Lãm","Xã Đông Hòa","Phường Hoàng Diệu","Xã Phú Xuân","Xã Vũ Phúc","Xã Vũ Chính","Xã Đông Mỹ","Xã Đông Thọ","Xã Vũ Đông","Xã Vũ Lạc","Xã Tân Bình"]},{"name":"Huyện Quỳnh Phụ","communes":["Thị trấn Quỳnh Côi","Xã An Khê","Xã An Đồng","Xã Quỳnh Hoa","Xã Quỳnh Lâm","Xã Quỳnh Thọ","Xã An Hiệp","Xã Quỳnh Hoàng","Xã Quỳnh Giao","Xã An Thái","Xã An Cầu","Xã Quỳnh Hồng","Xã Quỳnh Khê","Xã Quỳnh Minh","Xã An Ninh","Xã Quỳnh Ngọc","Xã Quỳnh Hải","Thị trấn An Bài","Xã An Ấp","Xã Quỳnh Hội","Xã Châu Sơn","Xã Quỳnh Mỹ","Xã An Quí","Xã An Thanh","Xã An Vũ","Xã An Lễ","Xã Quỳnh Hưng","Xã Quỳnh Bảo","Xã An Mỹ","Xã Quỳnh Nguyên","Xã An Vinh","Xã Quỳnh Xá","Xã An Dục","Xã Đông Hải","Xã Quỳnh Trang","Xã An Tràng","Xã Đồng Tiến"]},{"name":"Huyện Hưng Hà","communes":["Thị trấn Hưng Hà","Xã Điệp Nông","Xã Tân Lễ","Xã Cộng Hòa","Xã Dân Chủ","Xã Canh Tân","Xã Hòa Tiến","Xã Hùng Dũng","Xã Tân Tiến","Thị trấn Hưng Nhân","Xã Đoan Hùng","Xã Duyên Hải","Xã Tân Hòa","Xã Văn Cẩm","Xã Bắc Sơn","Xã Đông Đô","Xã Phúc Khánh","Xã Liên Hiệp","Xã Tây Đô","Xã Thống Nhất","Xã Tiến Đức","Xã Thái Hưng","Xã Thái Phương","Xã Hòa Bình","Xã Chi Lăng","Xã Minh Khai","Xã Hồng An","Xã Kim Chung","Xã Hồng Lĩnh","Xã Minh Tân","Xã Văn Lang","Xã Độc Lập","Xã Chí Hòa","Xã Minh Hòa","Xã Hồng Minh"]},{"name":"Huyện Đông Hưng","communes":["Thị trấn Đông Hưng","Xã Đô Lương","Xã Đông Phương","Xã Liên Giang","Xã An Châu","Xã Đông Sơn","Xã Đông Cường","Xã Phú Lương","Xã Mê Linh","Xã Lô Giang","Xã Đông La","Xã Minh Tân","Xã Đông Xá","Xã Chương Dương","Xã Nguyên Xá","Xã Phong Châu","Xã Hợp Tiến","Xã Hồng Việt","Xã Hà Giang","Xã Đông Kinh","Xã Đông Hợp","Xã Thăng Long","Xã Đông Các","Xã Phú Châu","Xã Liên Hoa","Xã Đông Tân","Xã Đông Vinh","Xã Đông Động","Xã Hồng Bạch","Xã Trọng Quan","Xã Hồng Giang","Xã Đông Quan","Xã Đông Quang","Xã Đông Xuân","Xã Đông Á","Xã Đông Hoàng","Xã Đông Dương","Xã Minh Phú"]},{"name":"Huyện Thái Thụy","communes":["Thị trấn Diêm Điền","Xã Thụy Trường","Xã Hồng Dũng","Xã Thụy Quỳnh","Xã An Tân","Xã Thụy Ninh","Xã Thụy Hưng","Xã Thụy Việt","Xã Thụy Văn","Xã Thụy Xuân","Xã Dương Phúc","Xã Thụy Trình","Xã Thụy Bình","Xã Thụy Chính","Xã Thụy Dân","Xã Thụy Hải","Xã Thụy Liên","Xã Thụy Duyên","Xã Thụy Thanh","Xã Thụy Sơn","Xã Thụy Phong","Xã Thái Thượng","Xã Thái Nguyên","Xã Dương Hồng  Thủy","Xã Thái Giang","Xã Hòa An","Xã Sơn Hà","Xã Thái Phúc","Xã Thái Hưng","Xã Thái Đô","Xã Thái Xuyên","Xã  Mỹ Lộc","Xã Tân Học","Xã Thái Thịnh","Xã Thuần Thành","Xã Thái Thọ"]},{"name":"Huyện Tiền Hải","communes":["Thị trấn Tiền Hải","Xã Đông Trà","Xã Đông Long","Xã Đông Quí","Xã Vũ Lăng","Xã Đông Xuyên","Xã Tây Lương","Xã Tây Ninh","Xã Đông Trung","Xã Đông Hoàng","Xã Đông Minh","Xã Đông Phong","Xã An Ninh","Xã Đông Cơ","Xã Tây Giang","Xã Đông Lâm","Xã Phương Công","Xã Tây Phong","Xã Tây Tiến","Xã Nam Cường","Xã Vân Trường","Xã Nam Thắng","Xã Nam Chính","Xã Bắc Hải","Xã Nam Thịnh","Xã Nam Hà","Xã Nam Thanh","Xã Nam Trung","Xã Nam Hồng","Xã Nam Hưng","Xã Nam Hải","Xã Nam Phú"]},{"name":"Huyện Kiến Xương","communes":["Thị trấn Kiến Xương","Xã Trà Giang","Xã Quốc Tuấn","Xã An Bình","Xã Tây Sơn","Xã Hồng Thái","Xã Bình Nguyên","Xã Lê Lợi","Xã Vũ Lễ","Xã Thanh Tân","Xã Thượng Hiền","Xã Nam Cao","Xã Đình Phùng","Xã Vũ Ninh","Xã Vũ An","Xã Quang Lịch","Xã Hòa Bình","Xã Bình Minh","Xã Vũ Quí","Xã Quang Bình","Xã Vũ Trung","Xã Vũ Thắng","Xã Vũ Công","Xã Vũ Hòa","Xã Quang Minh","Xã Quang Trung","Xã Minh Quang","Xã Vũ Bình","Xã Minh Tân","Xã Nam Bình","Xã Bình Thanh","Xã Bình Định","Xã Hồng Tiến"]},{"name":"Huyện Vũ Thư","communes":["Thị trấn Vũ Thư","Xã Hồng Lý","Xã Đồng Thanh","Xã Xuân Hòa","Xã Hiệp Hòa","Xã Phúc Thành","Xã Tân Phong","Xã Song Lãng","Xã Tân Hòa","Xã Việt Hùng","Xã Minh Lãng","Xã Minh Khai","Xã Dũng Nghĩa","Xã Minh Quang","Xã Tam Quang","Xã Tân Lập","Xã Bách Thuận","Xã Tự Tân","Xã Song An","Xã Trung An","Xã Vũ Hội","Xã Hòa Bình","Xã Nguyên Xá","Xã Việt Thuận","Xã Vũ Vinh","Xã Vũ Đoài","Xã Vũ Tiến","Xã Vũ Vân","Xã Duy Nhất","Xã Hồng Phong"]}]},{"name":"Tỉnh Hà Nam","districts":[{"name":"Thành phố Phủ Lý","communes":["Phường Quang Trung","Phường Lương Khánh Thiện","Phường Lê Hồng Phong","Phường Minh Khai","Phường Hai Bà Trưng","Phường Trần Hưng Đạo","Phường Lam Hạ","Xã Phù Vân","Phường Liêm Chính","Xã Liêm Chung","Phường Thanh Châu","Phường Châu Sơn","Xã Tiên Tân","Xã Tiên Hiệp","Xã Tiên Hải","Xã Kim Bình","Xã Liêm Tuyền","Xã Liêm Tiết","Phường Thanh Tuyền","Xã Đinh Xá","Xã Trịnh Xá"]},{"name":"Thị xã Duy Tiên","communes":["Phường Đồng Văn","Phường Hòa Mạc","Xã Mộc Bắc","Phường Châu Giang","Phường Bạch Thượng","Phường Duy Minh","Xã Mộc Nam","Phường Duy Hải","Xã Chuyên Ngoại","Phường Yên Bắc","Xã Trác Văn","Phường Tiên Nội","Phường Hoàng Đông","Xã Yên Nam","Xã Tiên Ngoại","Xã Tiên Sơn"]},{"name":"Huyện Kim Bảng","communes":["Thị trấn Quế","Xã Nguyễn Úy","Xã Đại Cương","Xã Lê Hồ","Xã Tượng Lĩnh","Xã Nhật Tựu","Xã Nhật Tân","Xã Đồng Hóa","Xã Hoàng Tây","Xã Tân Sơn","Xã Thụy Lôi","Xã Văn Xá","Xã Khả Phong","Xã Ngọc Sơn","Thị trấn Ba Sao","Xã Liên Sơn","Xã Thi Sơn","Xã Thanh Sơn"]},{"name":"Huyện Thanh Liêm","communes":["Thị trấn Kiện Khê","Xã Liêm Phong","Xã Thanh Hà","Xã Liêm Cần","Xã Liêm Thuận","Xã Thanh Thủy","Xã Thanh Phong","Thị trấn Tân Thanh","Xã Thanh Tân","Xã Liêm Túc","Xã Liêm Sơn","Xã Thanh Hương","Xã Thanh Nghị","Xã Thanh Tâm","Xã Thanh Nguyên","Xã Thanh Hải"]},{"name":"Huyện Bình Lục","communes":["Thị trấn Bình Mỹ","Xã Bình Nghĩa","Xã Tràng An","Xã Đồng Du","Xã Ngọc Lũ","Xã Hưng Công","Xã Đồn Xá","Xã An Ninh","Xã Bồ Đề","Xã Bối Cầu","Xã An Nội","Xã Vũ Bản","Xã Trung Lương","Xã An Đổ","Xã La Sơn","Xã Tiêu Động","Xã An Lão"]},{"name":"Huyện Lý Nhân","communes":["Xã Hợp Lý","Xã Nguyên Lý","Xã Chính Lý","Xã Chân Lý","Xã Đạo Lý","Xã Công Lý","Xã Văn Lý","Xã Bắc Lý","Xã Đức Lý","Xã Trần Hưng Đạo","Thị trấn Vĩnh Trụ","Xã Nhân Thịnh","Xã Nhân Khang","Xã Nhân Mỹ","Xã Nhân Nghĩa","Xã Nhân Chính","Xã Nhân Bình","Xã Phú Phúc","Xã Xuân Khê","Xã Tiến Thắng","Xã Hòa Hậu"]}]},{"name":"Tỉnh Nam Định","districts":[{"name":"Thành phố Nam Định","communes":["Phường Hạ Long","Phường Trần Tế Xương","Phường Vị Hoàng","Phường Vị Xuyên","Phường Quang Trung","Phường Cửa Bắc","Phường Nguyễn Du","Phường Bà Triệu","Phường Trường Thi","Phường Phan Đình Phùng","Phường Ngô Quyền","Phường Trần Hưng Đạo","Phường Trần Đăng Ninh","Phường Năng Tĩnh","Phường Văn Miếu","Phường Trần Quang Khải","Phường Thống Nhất","Phường Lộc Hạ","Phường Lộc Vượng","Phường Cửa Nam","Phường Lộc Hòa","Xã Nam Phong","Phường Mỹ Xá","Xã Lộc An","Xã Nam Vân"]},{"name":"Huyện Mỹ Lộc","communes":["Thị trấn Mỹ Lộc","Xã Mỹ Hà","Xã Mỹ Tiến","Xã Mỹ Thắng","Xã Mỹ Trung","Xã Mỹ Tân","Xã Mỹ Phúc","Xã Mỹ Hưng","Xã Mỹ Thuận","Xã Mỹ Thịnh","Xã Mỹ Thành"]},{"name":"Huyện Vụ Bản","communes":["Thị trấn Gôi","Xã Minh Thuận","Xã Hiển Khánh","Xã Tân Khánh","Xã Hợp Hưng","Xã Đại An","Xã Tân Thành","Xã Cộng Hòa","Xã Trung Thành","Xã Quang Trung","Xã Minh Tân","Xã Liên Bảo","Xã Thành Lợi","Xã Kim Thái","Xã Liên Minh","Xã Đại Thắng","Xã Tam Thanh","Xã Vĩnh Hào"]},{"name":"Huyện Ý Yên","communes":["Thị trấn Lâm","Xã Yên Trung","Xã Yên Thành","Xã Yên Tân","Xã Yên Lợi","Xã Yên Thọ","Xã Yên Nghĩa","Xã Yên Minh","Xã Yên Phương","Xã Yên Chính","Xã Yên Bình","Xã Yên Phú","Xã Yên Mỹ","Xã Yên Dương","Xã Yên Hưng","Xã Yên Khánh","Xã Yên Phong","Xã Yên Ninh","Xã Yên Lương","Xã Yên Hồng","Xã Yên Quang","Xã Yên Tiến","Xã Yên Thắng","Xã Yên Phúc","Xã Yên Cường","Xã Yên Lộc","Xã Yên Bằng","Xã Yên Đồng","Xã Yên Khang","Xã Yên Nhân","Xã Yên Trị"]},{"name":"Huyện Nghĩa Hưng","communes":["Thị trấn Liễu Đề","Thị trấn Rạng Đông","Xã Nghĩa Đồng","Xã Nghĩa Thịnh","Xã Nghĩa Minh","Xã Nghĩa Thái","Xã Hoàng Nam","Xã Nghĩa Châu","Xã Nghĩa Trung","Xã Nghĩa Sơn","Xã Nghĩa Lạc","Xã Nghĩa Hồng","Xã Nghĩa Phong","Xã Nghĩa Phú","Xã Nghĩa Bình","Thị trấn Quỹ Nhất","Xã Nghĩa Tân","Xã Nghĩa Hùng","Xã Nghĩa Lâm","Xã Nghĩa Thành","Xã Phúc Thắng","Xã Nghĩa Lợi","Xã Nghĩa Hải","Xã Nam Điền"]},{"name":"Huyện Nam Trực","communes":["Thị trấn Nam Giang","Xã Nam Mỹ","Xã Điền Xá","Xã Nghĩa An","Xã Nam Thắng","Xã Nam Toàn","Xã Hồng Quang","Xã Tân Thịnh","Xã Nam Cường","Xã Nam Hồng","Xã Nam Hùng","Xã Nam Hoa","Xã Nam Dương","Xã Nam Thanh","Xã Nam Lợi","Xã Bình Minh","Xã Đồng Sơn","Xã Nam Tiến","Xã Nam Hải","Xã Nam Thái"]},{"name":"Huyện Trực Ninh","communes":["Thị trấn Cổ Lễ","Xã Phương Định","Xã Trực Chính","Xã Trung Đông","Xã Liêm Hải","Xã Trực Tuấn","Xã Việt Hùng","Xã Trực Đạo","Xã Trực Hưng","Xã Trực Nội","Thị trấn Cát Thành","Xã Trực Thanh","Xã Trực Khang","Xã Trực Thuận","Xã Trực Mỹ","Xã Trực Đại","Xã Trực Cường","Thị trấn Ninh Cường","Xã Trực Thái","Xã Trực Hùng","Xã Trực Thắng"]},{"name":"Huyện Xuân Trường","communes":["Thị trấn Xuân Trường","Xã Xuân Châu","Xã Xuân Hồng","Xã Xuân Thành","Xã Xuân Thượng","Xã Xuân Phong","Xã Xuân Đài","Xã Xuân Tân","Xã Xuân Thủy","Xã Xuân Ngọc","Xã Xuân Bắc","Xã Xuân Phương","Xã Thọ Nghiệp","Xã Xuân Phú","Xã Xuân Trung","Xã Xuân Vinh","Xã Xuân Kiên","Xã Xuân Tiến","Xã Xuân Ninh","Xã Xuân Hòa"]},{"name":"Huyện Giao Thủy","communes":["Thị trấn Ngô Đồng","Thị trấn Quất Lâm","Xã Giao Hương","Xã Hồng Thuận","Xã Giao Thiện","Xã Giao Thanh","Xã Hoành Sơn","Xã Bình Hòa","Xã Giao Tiến","Xã Giao Hà","Xã Giao Nhân","Xã Giao An","Xã Giao Lạc","Xã Giao Châu","Xã Giao Tân","Xã Giao Yến","Xã Giao Xuân","Xã Giao Thịnh","Xã Giao Hải","Xã Bạch Long","Xã Giao Long","Xã Giao Phong"]},{"name":"Huyện Hải Hậu","communes":["Thị trấn Yên Định","Thị trấn Cồn","Thị trấn Thịnh Long","Xã Hải Nam","Xã Hải Trung","Xã Hải Vân","Xã Hải Minh","Xã Hải Anh","Xã Hải Hưng","Xã Hải Bắc","Xã Hải Phúc","Xã Hải Thanh","Xã Hải Hà","Xã Hải Long","Xã Hải Phương","Xã Hải Đường","Xã Hải Lộc","Xã Hải Quang","Xã Hải Đông","Xã Hải Sơn","Xã Hải Tân","Xã Hải Phong","Xã Hải An","Xã Hải Tây","Xã Hải Lý","Xã Hải Phú","Xã Hải Giang","Xã Hải Cường","Xã Hải Ninh","Xã Hải Chính","Xã Hải Xuân","Xã Hải Châu","Xã Hải Triều","Xã Hải Hòa"]}]},{"name":"Tỉnh Ninh Bình","districts":[{"name":"Thành phố Ninh Bình","communes":["Phường Đông Thành","Phường Tân Thành","Phường Thanh Bình","Phường Vân Giang","Phường Bích Đào","Phường Phúc Thành","Phường Nam Bình","Phường Nam Thành","Phường Ninh Khánh","Xã Ninh Nhất","Xã Ninh Tiến","Xã Ninh Phúc","Phường Ninh Sơn","Phường Ninh Phong"]},{"name":"Thành phố Tam Điệp","communes":["Phường Bắc Sơn","Phường Trung Sơn","Phường Nam Sơn","Phường Tây Sơn","Xã Yên Sơn","Phường Yên Bình","Phường Tân Bình","Xã Quang Sơn","Xã Đông Sơn"]},{"name":"Huyện Nho Quan","communes":["Thị trấn Nho Quan","Xã Xích Thổ","Xã Gia Lâm","Xã Gia Sơn","Xã Thạch Bình","Xã Gia Thủy","Xã Gia Tường","Xã Cúc Phương","Xã Phú Sơn","Xã Đức Long","Xã Lạc Vân","Xã Đồng Phong","Xã Yên Quang","Xã Lạng Phong","Xã Thượng Hòa","Xã Văn Phong","Xã Văn Phương","Xã Thanh Lạc","Xã Sơn Lai","Xã Sơn Thành","Xã Văn Phú","Xã Phú Lộc","Xã Kỳ Phú","Xã Quỳnh Lưu","Xã Sơn Hà","Xã Phú Long","Xã Quảng Lạc"]},{"name":"Huyện Gia Viễn","communes":["Thị trấn Me","Xã Gia Hòa","Xã Gia Hưng","Xã Liên Sơn","Xã Gia Thanh","Xã Gia Vân","Xã Gia Phú","Xã Gia Xuân","Xã Gia Lập","Xã Gia Vượng","Xã Gia Trấn","Xã Gia Thịnh","Xã Gia Phương","Xã Gia Tân","Xã Gia Thắng","Xã Gia Trung","Xã Gia Minh","Xã Gia Lạc","Xã Gia Tiến","Xã Gia Sinh","Xã Gia Phong"]},{"name":"Huyện Hoa Lư","communes":["Thị trấn Thiên Tôn","Xã Ninh Giang","Xã Trường Yên","Xã Ninh Khang","Xã Ninh Mỹ","Xã Ninh Hòa","Xã Ninh Xuân","Xã Ninh Hải","Xã Ninh Thắng","Xã Ninh Vân","Xã Ninh An"]},{"name":"Huyện Yên Khánh","communes":["Thị trấn Yên Ninh","Xã Khánh Tiên","Xã Khánh Phú","Xã Khánh Hòa","Xã Khánh Lợi","Xã Khánh An","Xã Khánh Cường","Xã Khánh Cư","Xã Khánh Thiện","Xã Khánh Hải","Xã Khánh Trung","Xã Khánh Mậu","Xã Khánh Vân","Xã Khánh Hội","Xã Khánh Công","Xã Khánh Thành","Xã Khánh Nhạc","Xã Khánh Thủy","Xã Khánh Hồng"]},{"name":"Huyện Kim Sơn","communes":["Thị trấn Phát Diệm","Thị trấn Bình Minh","Xã Hồi Ninh","Xã Xuân Chính","Xã Kim Định","Xã Ân Hòa","Xã Hùng Tiến","Xã Quang Thiện","Xã Như Hòa","Xã Chất Bình","Xã Đồng Hướng","Xã Kim Chính","Xã Thượng Kiệm","Xã Lưu Phương","Xã Tân Thành","Xã Yên Lộc","Xã Lai Thành","Xã Định Hóa","Xã Văn Hải","Xã Kim Tân","Xã Kim Mỹ","Xã Cồn Thoi","Xã Kim Hải","Xã Kim Trung","Xã Kim Đông"]},{"name":"Huyện Yên Mô","communes":["Thị trấn Yên Thịnh","Xã Khánh Thượng","Xã Khánh Dương","Xã Mai Sơn","Xã Khánh Thịnh","Xã Yên Phong","Xã Yên Hòa","Xã Yên Thắng","Xã Yên Từ","Xã Yên Hưng","Xã Yên Thành","Xã Yên Nhân","Xã Yên Mỹ","Xã Yên Mạc","Xã Yên Đồng","Xã Yên Thái","Xã Yên Lâm"]}]},{"name":"Tỉnh Thanh Hóa","districts":[{"name":"Thành phố Thanh Hóa","communes":["Phường Hàm Rồng","Phường Đông Thọ","Phường Nam Ngạn","Phường Trường Thi","Phường Điện Biên","Phường Phú Sơn","Phường Lam Sơn","Phường Ba Đình","Phường Ngọc Trạo","Phường Đông Vệ","Phường Đông Sơn","Phường Tân Sơn","Phường Đông Cương","Phường Đông Hương","Phường Đông Hải","Phường Quảng Hưng","Phường Quảng Thắng","Phường Quảng Thành","Xã Thiệu Vân","Phường Thiệu Khánh","Phường Thiệu Dương","Phường Tào Xuyên","Phường Long Anh","Xã Hoằng Quang","Xã Hoằng Đại","Phường Đông Lĩnh","Xã Đông Vinh","Phường Đông Tân","Phường An Hưng","Phường Quảng Thịnh","Phường Quảng Đông","Phường Quảng Cát","Phường Quảng Phú","Phường Quảng Tâm"]},{"name":"Thị xã Bỉm Sơn","communes":["Phường Bắc Sơn","Phường Ba Đình","Phường Lam Sơn","Phường Ngọc Trạo","Phường Đông Sơn","Phường Phú Sơn","Xã Quang Trung"]},{"name":"Thành phố Sầm Sơn","communes":["Phường Trung Sơn","Phường Bắc Sơn","Phường Trường Sơn","Phường Quảng Cư","Phường Quảng Tiến","Xã Quảng Minh","Xã Quảng Hùng","Phường Quảng Thọ","Phường Quảng Châu","Phường Quảng Vinh","Xã Quảng Đại"]},{"name":"Huyện Mường Lát","communes":["Thị trấn Mường Lát","Xã Tam Chung","Xã Mường Lý","Xã Trung Lý","Xã Quang Chiểu","Xã Pù Nhi","Xã Nhi Sơn","Xã Mường Chanh"]},{"name":"Huyện Quan Hóa","communes":["Thị trấn Hồi Xuân","Xã Thành Sơn","Xã Trung Sơn","Xã Phú Thanh","Xã Trung Thành","Xã Phú Lệ","Xã Phú Sơn","Xã Phú Xuân","Xã Hiền Chung","Xã Hiền Kiệt","Xã Nam Tiến","Xã Thiên Phủ","Xã Phú Nghiêm","Xã Nam Xuân","Xã Nam Động"]},{"name":"Huyện Bá Thước","communes":["Thị trấn Cành Nàng","Xã Điền Thượng","Xã Điền Hạ","Xã Điền Quang","Xã Điền Trung","Xã Thành Sơn","Xã Lương Ngoại","Xã Ái Thượng","Xã Lương Nội","Xã Điền Lư","Xã Lương Trung","Xã Lũng Niêm","Xã Lũng Cao","Xã Hạ Trung","Xã Cổ Lũng","Xã Thành Lâm","Xã Ban Công","Xã Kỳ Tân","Xã Văn Nho","Xã Thiết Ống","Xã Thiết Kế"]},{"name":"Huyện Quan Sơn","communes":["Xã Trung Xuân","Xã Trung Thượng","Xã Trung Tiến","Xã Trung Hạ","Xã Sơn Hà","Xã Tam Thanh","Xã Sơn Thủy","Xã Na Mèo","Thị trấn Sơn Lư","Xã Tam Lư","Xã Sơn Điện","Xã Mường Mìn"]},{"name":"Huyện Lang Chánh","communes":["Xã Yên Khương","Xã Yên Thắng","Xã Trí Nang","Xã Giao An","Xã Giao Thiện","Xã Tân Phúc","Xã Tam Văn","Xã Lâm Phú","Thị trấn Lang Chánh","Xã Đồng Lương"]},{"name":"Huyện Ngọc Lặc","communes":["Thị Trấn Ngọc Lặc","Xã Lam Sơn","Xã Mỹ Tân","Xã Thúy Sơn","Xã Thạch Lập","Xã Vân Âm","Xã Cao Ngọc","Xã Quang Trung","Xã Đồng Thịnh","Xã Ngọc Liên","Xã Ngọc Sơn","Xã Lộc Thịnh","Xã Cao Thịnh","Xã Ngọc Trung","Xã Phùng Giáo","Xã Phùng Minh","Xã Phúc Thịnh","Xã Nguyệt Ấn","Xã Kiên Thọ","Xã Minh Tiến","Xã Minh Sơn"]},{"name":"Huyện Cẩm Thủy","communes":["Thị trấn Phong Sơn","Xã Cẩm Thành","Xã Cẩm Quý","Xã Cẩm Lương","Xã Cẩm Thạch","Xã Cẩm Liên","Xã Cẩm Giang","Xã Cẩm Bình","Xã Cẩm Tú","Xã Cẩm Châu","Xã Cẩm Tâm","Xã Cẩm Ngọc","Xã Cẩm Long","Xã Cẩm Yên","Xã Cẩm Tân","Xã Cẩm Phú","Xã Cẩm Vân"]},{"name":"Huyện Thạch Thành","communes":["Thị trấn Kim Tân","Thị trấn Vân Du","Xã Thạch Lâm","Xã Thạch Quảng","Xã Thạch Tượng","Xã Thạch Cẩm","Xã Thạch Sơn","Xã Thạch Bình","Xã Thạch Định","Xã Thạch Đồng","Xã Thạch Long","Xã Thành Mỹ","Xã Thành Yên","Xã Thành Vinh","Xã Thành Minh","Xã Thành Công","Xã Thành Tân","Xã Thành Trực","Xã Thành Tâm","Xã Thành An","Xã Thành Thọ","Xã Thành Tiến","Xã Thành Long","Xã Thành Hưng","Xã Ngọc Trạo"]},{"name":"Huyện Hà Trung","communes":["Thị trấn Hà Trung","Xã Hà Long","Xã Hà Vinh","Xã Hà Bắc","Xã Hoạt Giang","Xã Yên Dương","Xã Hà Giang","Xã Lĩnh Toại","Xã Hà Ngọc","Xã Yến Sơn","Xã Hà Sơn","Xã Hà Lĩnh","Xã Hà Đông","Xã Hà Tân","Xã Hà Tiến","Xã Hà Bình","Xã Hà Lai","Xã Hà Châu","Xã Hà Thái","Xã Hà Hải"]},{"name":"Huyện Vĩnh Lộc","communes":["Thị trấn Vĩnh Lộc","Xã Vĩnh Quang","Xã Vĩnh Yên","Xã Vĩnh Tiến","Xã Vĩnh Long","Xã Vĩnh Phúc","Xã Vĩnh Hưng","Xã Vĩnh Hòa","Xã Vĩnh Hùng","Xã Minh Tân","Xã Ninh Khang","Xã Vĩnh Thịnh","Xã Vĩnh An"]},{"name":"Huyện Yên Định","communes":["Thị trấn Thống Nhất","Thị trấn Yên Lâm","Xã Yên Tâm","Xã Yên Phú","Thị trấn Quý Lộc","Xã Yên Thọ","Xã Yên Trung","Xã Yên Trường","Xã Yên Phong","Xã Yên Thái","Xã Yên Hùng","Xã Yên Thịnh","Xã Yên Ninh","Xã Yên Lạc","Xã Định Tăng","Xã Định Hòa","Xã Định Thành","Xã Định Công","Xã Định Tân","Xã Định Tiến","Xã Định Long","Xã Định Liên","Thị trấn Quán Lào","Xã Định Hưng","Xã Định Hải","Xã Định Bình"]},{"name":"Huyện Thọ Xuân","communes":["Xã Xuân Hồng","Thị trấn Thọ Xuân","Xã Bắc Lương","Xã Nam Giang","Xã Xuân Phong","Xã Thọ Lộc","Xã Xuân Trường","Xã Xuân Hòa","Xã Thọ Hải","Xã Tây Hồ","Xã Xuân Giang","Xã Xuân Sinh","Xã Xuân Hưng","Xã Thọ Diên","Xã Thọ Lâm","Xã Thọ Xương","Xã Xuân Bái","Xã Xuân Phú","Thị trấn Sao Vàng","Thị trấn Lam Sơn","Xã Xuân Thiên","Xã Thuận Minh","Xã Thọ Lập","Xã Quảng Phú","Xã Xuân Tín","Xã Phú Xuân","Xã Xuân Lai","Xã Xuân Lập","Xã Xuân Minh","Xã Trường Xuân"]},{"name":"Huyện Thường Xuân","communes":["Xã Bát Mọt","Xã Yên Nhân","Xã Xuân Lẹ","Xã Vạn Xuân","Xã Lương Sơn","Xã Xuân Cao","Xã Luận Thành","Xã Luận Khê","Xã Xuân Thắng","Xã Xuân Lộc","Thị trấn Thường Xuân","Xã Xuân Dương","Xã Thọ Thanh","Xã Ngọc Phụng","Xã Xuân Chinh","Xã Tân Thành"]},{"name":"Huyện Triệu Sơn","communes":["Thị trấn Triệu Sơn","Xã Thọ Sơn","Xã Thọ Bình","Xã Thọ Tiến","Xã Hợp Lý","Xã Hợp Tiến","Xã Hợp Thành","Xã Triệu Thành","Xã Hợp Thắng","Xã Minh Sơn","Xã Dân Lực","Xã Dân Lý","Xã Dân Quyền","Xã An Nông","Xã Văn Sơn","Xã Thái Hòa","Thị trấn Nưa","Xã Đồng Lợi","Xã Đồng Tiến","Xã Đồng Thắng","Xã Tiến Nông","Xã Khuyến Nông","Xã Xuân Thịnh","Xã Xuân Lộc","Xã Thọ Dân","Xã Xuân Thọ","Xã Thọ Tân","Xã Thọ Ngọc","Xã Thọ Cường","Xã Thọ Phú","Xã Thọ Vực","Xã Thọ Thế","Xã Nông Trường","Xã Bình Sơn"]},{"name":"Huyện Thiệu Hóa","communes":["Thị trấn Thiệu Hóa","Xã Thiệu Ngọc","Xã Thiệu Vũ","Xã Thiệu Phúc","Xã Thiệu Tiến","Xã Thiệu Công","Xã Thiệu Phú","Xã Thiệu Long","Xã Thiệu Giang","Xã Thiệu Duy","Xã Thiệu Nguyên","Xã Thiệu Hợp","Xã Thiệu Thịnh","Xã Thiệu Quang","Xã Thiệu Thành","Xã Thiệu Toán","Xã Thiệu Chính","Xã Thiệu Hòa","Xã Minh Tâm","Xã Thiệu Viên","Xã Thiệu Lý","Xã Thiệu Vận","Xã Thiệu Trung","Xã Tân Châu","Xã Thiệu Giao"]},{"name":"Huyện Hoằng Hóa","communes":["Thị trấn Bút Sơn","Xã Hoằng Giang","Xã Hoằng Xuân","Xã Hoằng Phượng","Xã Hoằng Phú","Xã Hoằng Quỳ","Xã Hoằng Kim","Xã Hoằng Trung","Xã Hoằng Trinh","Xã Hoằng Sơn","Xã Hoằng Cát","Xã Hoằng Xuyên","Xã Hoằng Quý","Xã Hoằng Hợp","Xã Hoằng Đức","Xã Hoằng Hà","Xã Hoằng Đạt","Xã Hoằng Đạo","Xã Hoằng Thắng","Xã Hoằng Đồng","Xã Hoằng Thái","Xã Hoằng Thịnh","Xã Hoằng Thành","Xã Hoằng Lộc","Xã Hoằng Trạch","Xã Hoằng Phong","Xã Hoằng Lưu","Xã Hoằng Châu","Xã Hoằng Tân","Xã Hoằng Yến","Xã Hoằng Tiến","Xã Hoằng Hải","Xã Hoằng Ngọc","Xã Hoằng Đông","Xã Hoằng Thanh","Xã Hoằng Phụ","Xã Hoằng Trường"]},{"name":"Huyện Hậu Lộc","communes":["Thị trấn Hậu Lộc","Xã Đồng Lộc","Xã Đại Lộc","Xã Triệu Lộc","Xã Tiến Lộc","Xã Lộc Sơn","Xã Cầu Lộc","Xã Thành Lộc","Xã Tuy Lộc","Xã Phong Lộc","Xã Mỹ Lộc","Xã Thuần Lộc","Xã Xuân Lộc","Xã Hoa Lộc","Xã Liên Lộc","Xã Quang Lộc","Xã Phú Lộc","Xã Hòa Lộc","Xã Minh Lộc","Xã Hưng Lộc","Xã Hải Lộc","Xã Đa Lộc","Xã Ngư Lộc"]},{"name":"Huyện Nga Sơn","communes":["Thị trấn Nga Sơn","Xã Ba Đình","Xã Nga Vịnh","Xã Nga Văn","Xã Nga Thiện","Xã Nga Tiến","Xã Nga Phượng","Xã Nga Trung","Xã Nga Bạch","Xã Nga Thanh","Xã Nga Yên","Xã Nga Giáp","Xã Nga Hải","Xã Nga Thành","Xã Nga An","Xã Nga Phú","Xã Nga Điền","Xã Nga Tân","Xã Nga Thủy","Xã Nga Liên","Xã Nga Thái","Xã Nga Thạch","Xã Nga Thắng","Xã Nga Trường"]},{"name":"Huyện Như Xuân","communes":["Thị trấn Yên Cát","Xã Bãi Trành","Xã Xuân Hòa","Xã Xuân Bình","Xã Hóa Quỳ","Xã Cát Vân","Xã Cát Tân","Xã Tân Bình","Xã Bình Lương","Xã Thanh Quân","Xã Thanh Xuân","Xã Thanh Hòa","Xã Thanh Phong","Xã Thanh Lâm","Xã Thanh Sơn","Xã Thượng Ninh"]},{"name":"Huyện Như Thanh","communes":["Thị trấn Bến Sung","Xã Cán Khê","Xã Xuân Du","Xã Phượng Nghi","Xã Mậu Lâm","Xã Xuân Khang","Xã Phú Nhuận","Xã Hải Long","Xã Xuân Thái","Xã Xuân Phúc","Xã Yên Thọ","Xã Yên Lạc","Xã Thanh Tân","Xã Thanh Kỳ"]},{"name":"Huyện Nông Cống","communes":["Thị trấn Nông Cống","Xã Tân Phúc","Xã Tân Thọ","Xã Hoàng Sơn","Xã Tân Khang","Xã Hoàng Giang","Xã Trung Chính","Xã Trung Thành","Xã Tế Thắng","Xã Tế Lợi","Xã Tế Nông","Xã Minh Nghĩa","Xã Minh Khôi","Xã Vạn Hòa","Xã Trường Trung","Xã Vạn Thắng","Xã Trường Giang","Xã Vạn Thiện","Xã Thăng Long","Xã Trường Minh","Xã Trường Sơn","Xã Thăng Bình","Xã Công Liêm","Xã Tượng Văn","Xã Thăng Thọ","Xã Tượng Lĩnh","Xã Tượng Sơn","Xã Công Chính","Xã Yên Mỹ"]},{"name":"Huyện Đông Sơn","communes":["Thị trấn Rừng Thông","Xã Đông Hoàng","Xã Đông Ninh","Xã Đông Hòa","Xã Đông Yên","Xã Đông Minh","Xã Đông Thanh","Xã Đông Tiến","Xã Đông Khê","Xã Đông Thịnh","Xã Đông Văn","Xã Đông Phú","Xã Đông Nam","Xã Đông Quang"]},{"name":"Huyện Quảng Xương","communes":["Thị trấn Tân Phong","Xã Quảng Trạch","Xã Quảng Đức","Xã Quảng Định","Xã Quảng Nhân","Xã Quảng Ninh","Xã Quảng Bình","Xã Quảng Hợp","Xã Quảng Văn","Xã Quảng Long","Xã Quảng Yên","Xã Quảng Hòa","Xã Quảng Khê","Xã Quảng Trung","Xã Quảng Chính","Xã Quảng Ngọc","Xã Quảng Trường","Xã Quảng Phúc","Xã Quảng Giao","Xã Quảng Hải","Xã Quảng Lưu","Xã Quảng Lộc","Xã Tiên Trang","Xã Quảng Nham","Xã Quảng Thạch","Xã Quảng Thái"]},{"name":"Thị xã Nghi Sơn","communes":["Phường Hải Hòa","Phường Hải Châu","Xã Thanh Thủy","Xã Thanh Sơn","Phường Hải Ninh","Xã Anh Sơn","Xã Ngọc Lĩnh","Phường Hải An","Xã Các Sơn","Phường Tân Dân","Phường Hải Lĩnh","Xã Định Hải","Xã Phú Sơn","Phường Ninh Hải","Phường Nguyên Bình","Xã Hải Nhân","Phường Bình Minh","Phường Hải Thanh","Xã Phú Lâm","Phường Xuân Lâm","Phường Trúc Lâm","Phường Hải Bình","Xã Tân Trường","Xã Tùng Lâm","Phường Tĩnh Hải","Phường Mai Lâm","Xã Trường Lâm","Xã Hải Yến","Phường Hải Thượng","Xã Nghi Sơn","Xã Hải Hà"]}]},{"name":"Tỉnh Nghệ An","districts":[{"name":"Thành phố Vinh","communes":["Phường Đông Vĩnh","Phường Hà Huy Tập","Phường Lê Lợi","Phường Quán Bàu","Phường Hưng Bình","Phường Hưng Phúc","Phường Hưng Dũng","Phường Cửa Nam","Phường Quang Trung","Phường Đội Cung","Phường Lê Mao","Phường Trường Thi","Phường Bến Thủy","Phường Hồng Sơn","Phường Trung Đô","Xã Nghi Phú","Xã Hưng Đông","Xã Hưng Lộc","Xã Hưng Hòa","Phường Vinh Tân","Xã Nghi Liên","Xã Nghi Ân","Xã Nghi Kim","Xã Nghi Đức","Xã Hưng Chính"]},{"name":"Thị xã Cửa Lò","communes":["Phường Nghi Thuỷ","Phường Nghi Tân","Phường Thu Thuỷ","Phường Nghi Hòa","Phường Nghi Hải","Phường Nghi Hương","Phường Nghi Thu"]},{"name":"Thị xã Thái Hoà","communes":["Phường Hoà Hiếu","Phường Quang Phong","Phường Quang Tiến","Phường Long Sơn","Xã Nghĩa Tiến","Xã Nghĩa Mỹ","Xã Tây Hiếu","Xã Nghĩa Thuận","Xã Đông Hiếu"]},{"name":"Huyện Quế Phong","communes":["Thị trấn Kim Sơn","Xã Thông Thụ","Xã Đồng Văn","Xã Hạnh Dịch","Xã Tiền Phong","Xã Nậm Giải","Xã Tri Lễ","Xã Châu Kim","Xã Mường Nọc","Xã Châu Thôn","Xã Nậm Nhoóng","Xã Quang Phong","Xã Căm Muộn"]},{"name":"Huyện Quỳ Châu","communes":["Thị trấn Tân Lạc","Xã Châu Bính","Xã Châu Thuận","Xã Châu Hội","Xã Châu Nga","Xã Châu Tiến","Xã Châu Hạnh","Xã Châu Thắng","Xã Châu Phong","Xã Châu Bình","Xã Châu Hoàn","Xã Diên Lãm"]},{"name":"Huyện Kỳ Sơn","communes":["Thị trấn Mường Xén","Xã Mỹ Lý","Xã Bắc Lý","Xã Keng Đu","Xã Đoọc Mạy","Xã Huồi Tụ","Xã Mường Lống","Xã Na Loi","Xã Nậm Cắn","Xã Bảo Nam","Xã Phà Đánh","Xã Bảo Thắng","Xã Hữu Lập","Xã Tà Cạ","Xã Chiêu Lưu","Xã Mường Típ","Xã Hữu Kiệm","Xã Tây Sơn","Xã Mường Ải","Xã Na Ngoi","Xã Nậm Càn"]},{"name":"Huyện Tương Dương","communes":["Thị trấn Thạch Giám","Xã Mai Sơn","Xã Nhôn Mai","Xã Hữu Khuông","Xã Yên Tĩnh","Xã Nga My","Xã Xiêng My","Xã Lưỡng Minh","Xã Yên Hòa","Xã Yên Na","Xã Lưu Kiền","Xã Xá Lượng","Xã Tam Thái","Xã Tam Đình","Xã Yên Thắng","Xã Tam Quang","Xã Tam Hợp"]},{"name":"Huyện Nghĩa Đàn","communes":["Thị trấn Nghĩa Đàn","Xã Nghĩa Mai","Xã Nghĩa Yên","Xã Nghĩa Lạc","Xã Nghĩa Lâm","Xã Nghĩa Sơn","Xã Nghĩa Lợi","Xã Nghĩa Bình","Xã Nghĩa Thọ","Xã Nghĩa Minh","Xã Nghĩa Phú","Xã Nghĩa Hưng","Xã Nghĩa Hồng","Xã Nghĩa Thịnh","Xã Nghĩa Trung","Xã Nghĩa Hội","Xã Nghĩa Thành","Xã Nghĩa Hiếu","Xã Nghĩa Đức","Xã Nghĩa An","Xã Nghĩa Long","Xã Nghĩa Lộc","Xã Nghĩa Khánh"]},{"name":"Huyện Quỳ Hợp","communes":["Thị trấn Quỳ Hợp","Xã Yên Hợp","Xã Châu Tiến","Xã Châu Hồng","Xã Đồng Hợp","Xã Châu Thành","Xã Liên Hợp","Xã Châu Lộc","Xã Tam Hợp","Xã Châu Cường","Xã Châu Quang","Xã Thọ Hợp","Xã Minh Hợp","Xã Nghĩa Xuân","Xã Châu Thái","Xã Châu Đình","Xã Văn Lợi","Xã Nam Sơn","Xã Châu Lý","Xã Hạ Sơn","Xã Bắc Sơn"]},{"name":"Huyện Quỳnh Lưu","communes":["Thị trấn Cầu Giát","Xã Quỳnh Thắng","Xã Quỳnh Tân","Xã Quỳnh Châu","Xã Tân Sơn","Xã Quỳnh Văn","Xã Ngọc Sơn","Xã Quỳnh Tam","Xã Quỳnh Hoa","Xã Quỳnh Thạch","Xã Quỳnh Bảng","Xã Quỳnh Mỹ","Xã Quỳnh Thanh","Xã Quỳnh Hậu","Xã Quỳnh Lâm","Xã Quỳnh Đôi","Xã Quỳnh Lương","Xã Quỳnh Hồng","Xã Quỳnh Yên","Xã Quỳnh Bá","Xã Quỳnh Minh","Xã Quỳnh Diễn","Xã Quỳnh Hưng","Xã Quỳnh Giang","Xã Quỳnh Ngọc","Xã Quỳnh Nghĩa","Xã An Hòa","Xã Tiến Thủy","Xã Sơn Hải","Xã Quỳnh Thọ","Xã Quỳnh Thuận","Xã Quỳnh Long","Xã Tân Thắng"]},{"name":"Huyện Con Cuông","communes":["Thị trấn Con Cuông","Xã Bình Chuẩn","Xã Lạng Khê","Xã Cam Lâm","Xã Thạch Ngàn","Xã Đôn Phục","Xã Mậu Đức","Xã Châu Khê","Xã Chi Khê","Xã Bồng Khê","Xã Yên Khê","Xã Lục Dạ","Xã Môn Sơn"]},{"name":"Huyện Tân Kỳ","communes":["Thị trấn Tân Kỳ","Xã Tân Hợp","Xã Tân Phú","Xã Tân Xuân","Xã Giai Xuân","Xã Nghĩa Bình","Xã Nghĩa Đồng","Xã Đồng Văn","Xã Nghĩa Thái","Xã Nghĩa Hợp","Xã Nghĩa Hoàn","Xã Nghĩa Phúc","Xã Tiên Kỳ","Xã Tân An","Xã Nghĩa Dũng","Xã Tân Long","Xã Kỳ Sơn","Xã Hương Sơn","Xã Kỳ Tân","Xã Phú Sơn","Xã Tân Hương","Xã Nghĩa Hành"]},{"name":"Huyện Anh Sơn","communes":["Thị trấn Anh Sơn","Xã Thọ Sơn","Xã Thành Sơn","Xã Bình Sơn","Xã Tam Sơn","Xã Đỉnh Sơn","Xã Hùng Sơn","Xã Cẩm Sơn","Xã Đức Sơn","Xã Tường Sơn","Xã Hoa Sơn","Xã Tào Sơn","Xã Vĩnh Sơn","Xã Lạng Sơn","Xã Hội Sơn","Xã Thạch Sơn","Xã Phúc Sơn","Xã Long Sơn","Xã Khai Sơn","Xã Lĩnh Sơn","Xã Cao Sơn"]},{"name":"Huyện Diễn Châu","communes":["Thị trấn Diễn Châu","Xã Diễn Lâm","Xã Diễn Đoài","Xã Diễn Trường","Xã Diễn Yên","Xã Diễn Hoàng","Xã Diễn Hùng","Xã Diễn Mỹ","Xã Diễn Hồng","Xã Diễn Phong","Xã Diễn Hải","Xã Diễn Tháp","Xã Diễn Liên","Xã Diễn Vạn","Xã Diễn Kim","Xã Diễn Kỷ","Xã Diễn Xuân","Xã Diễn Thái","Xã Diễn Đồng","Xã Diễn Bích","Xã Diễn Hạnh","Xã Diễn Ngọc","Xã Diễn Quảng","Xã Diễn Nguyên","Xã Diễn Hoa","Xã Diễn Thành","Xã Diễn Phúc","Xã Diễn Cát","Xã Diễn Thịnh","Xã Diễn Tân","Xã Minh Châu","Xã Diễn Thọ","Xã Diễn Lợi","Xã Diễn Lộc","Xã Diễn Trung","Xã Diễn An","Xã Diễn Phú"]},{"name":"Huyện Yên Thành","communes":["Thị trấn Yên Thành","Xã Mã Thành","Xã Tiến Thành","Xã Lăng Thành","Xã Tân Thành","Xã Đức Thành","Xã Kim Thành","Xã Hậu Thành","Xã Hùng Thành","Xã Đô Thành","Xã Thọ Thành","Xã Quang Thành","Xã Tây Thành","Xã Phúc Thành","Xã Hồng Thành","Xã Đồng Thành","Xã Phú Thành","Xã Hoa Thành","Xã Tăng Thành","Xã Văn Thành","Xã Thịnh Thành","Xã Hợp Thành","Xã Xuân Thành","Xã Bắc Thành","Xã Nhân Thành","Xã Trung Thành","Xã Long Thành","Xã Minh Thành","Xã Nam Thành","Xã Vĩnh Thành","Xã Lý Thành","Xã Khánh Thành","Xã Viên Thành","Xã Đại Thành","Xã Liên Thành","Xã Bảo Thành","Xã Mỹ Thành","Xã Công Thành","Xã Sơn Thành"]},{"name":"Huyện Đô Lương","communes":["Thị trấn Đô Lương","Xã Giang Sơn Đông","Xã Giang Sơn Tây","Xã Lam Sơn","Xã Bồi Sơn","Xã Hồng Sơn","Xã Bài Sơn","Xã Ngọc Sơn","Xã Bắc Sơn","Xã Tràng Sơn","Xã Thượng Sơn","Xã Hòa Sơn","Xã Đặng Sơn","Xã Đông Sơn","Xã Nam Sơn","Xã Lưu Sơn","Xã Yên Sơn","Xã Văn Sơn","Xã Đà Sơn","Xã Lạc Sơn","Xã Tân Sơn","Xã Thái Sơn","Xã Quang Sơn","Xã Thịnh Sơn","Xã Trung Sơn","Xã Xuân Sơn","Xã Minh Sơn","Xã Thuận Sơn","Xã Nhân Sơn","Xã Hiến Sơn","Xã Mỹ Sơn","Xã Trù Sơn","Xã Đại Sơn"]},{"name":"Huyện Thanh Chương","communes":["Thị trấn Thanh Chương","Xã Cát Văn","Xã Thanh Nho","Xã Hạnh Lâm","Xã Thanh Sơn","Xã Thanh Hòa","Xã Phong Thịnh","Xã Thanh Phong","Xã Thanh Mỹ","Xã Thanh Tiên","Xã Thanh Liên","Xã Đại Đồng","Xã Thanh Đồng","Xã Thanh Ngọc","Xã Thanh Hương","Xã Ngọc Lâm","Xã Thanh Lĩnh","Xã Đồng Văn","Xã Ngọc Sơn","Xã Thanh Thịnh","Xã Thanh An","Xã Thanh Chi","Xã Xuân Tường","Xã Thanh Dương","Xã Thanh Lương","Xã Thanh Khê","Xã Võ Liệt","Xã Thanh Long","Xã Thanh Thủy","Xã Thanh Khai","Xã Thanh Yên","Xã Thanh Hà","Xã Thanh Giang","Xã Thanh Tùng","Xã Thanh Lâm","Xã Thanh Mai","Xã Thanh Xuân","Xã Thanh Đức"]},{"name":"Huyện Nghi Lộc","communes":["Thị trấn Quán Hành","Xã Nghi Văn","Xã Nghi Yên","Xã Nghi Tiến","Xã Nghi Hưng","Xã Nghi Đồng","Xã Nghi Thiết","Xã Nghi Lâm","Xã Nghi Quang","Xã Nghi Kiều","Xã Nghi Mỹ","Xã Nghi Phương","Xã Nghi Thuận","Xã Nghi Long","Xã Nghi Xá","Xã Nghi Hoa","Xã Khánh Hợp","Xã Nghi Thịnh","Xã Nghi Công Bắc","Xã Nghi Công Nam","Xã Nghi Thạch","Xã Nghi Trung","Xã Nghi Trường","Xã Nghi Diên","Xã Nghi Phong","Xã Nghi Xuân","Xã Nghi Vạn","Xã Phúc Thọ","Xã Nghi Thái"]},{"name":"Huyện Nam Đàn","communes":["Xã Nam Hưng","Xã Nam Nghĩa","Xã Nam Thanh","Xã Nam Anh","Xã Nam Xuân","Xã Nam Thái","Thị trấn Nam Đàn","Xã Nam Lĩnh","Xã Nam Giang","Xã Xuân Hòa","Xã Hùng Tiến","Xã Thượng Tân Lộc","Xã Kim Liên","Xã Hồng Long","Xã Xuân Lâm","Xã Nam Cát","Xã Khánh Sơn","Xã Trung Phúc Cường","Xã Nam Kim"]},{"name":"Huyện Hưng Nguyên","communes":["Thị trấn Hưng Nguyên","Xã Hưng Trung","Xã Hưng Yên","Xã Hưng Yên Bắc","Xã Hưng Tây","Xã Hưng Đạo","Xã Hưng Mỹ","Xã Hưng Thịnh","Xã Hưng Lĩnh","Xã Hưng Thông","Xã Hưng Tân","Xã Hưng Lợi","Xã Hưng Nghĩa","Xã Hưng Phúc","Xã Long Xá","Xã Châu Nhân","Xã Xuân Lam","Xã Hưng Thành"]},{"name":"Thị xã Hoàng Mai","communes":["Xã Quỳnh Vinh","Xã Quỳnh Lộc","Phường Quỳnh Thiện","Xã Quỳnh Lập","Xã Quỳnh Trang","Phường Mai Hùng","Phường Quỳnh Dị","Phường Quỳnh Xuân","Phường Quỳnh Phương","Xã Quỳnh Liên"]}]},{"name":"Tỉnh Hà Tĩnh","districts":[{"name":"Thành phố Hà Tĩnh","communes":["Phường Trần Phú","Phường Nam Hà","Phường Bắc Hà","Phường Nguyễn Du","Phường Tân Giang","Phường Đại Nài","Phường Hà Huy Tập","Xã Thạch Trung","Phường Thạch Quý","Phường Thạch Linh","Phường Văn Yên","Xã Thạch Hạ","Xã Đồng Môn","Xã Thạch Hưng","Xã Thạch Bình"]},{"name":"Thị xã Hồng Lĩnh","communes":["Phường Bắc Hồng","Phường Nam Hồng","Phường Trung Lương","Phường Đức Thuận","Phường Đậu Liêu","Xã Thuận Lộc"]},{"name":"Huyện Hương Sơn","communes":["Thị trấn Phố Châu","Thị trấn  Tây Sơn","Xã Sơn Hồng","Xã Sơn Tiến","Xã Sơn Lâm","Xã Sơn Lễ","Xã Sơn Giang","Xã Sơn Lĩnh","Xã An Hòa Thịnh","Xã Sơn Tây","Xã Sơn Ninh","Xã Sơn Châu","Xã Tân Mỹ Hà","Xã Quang Diệm","Xã Sơn Trung","Xã Sơn Bằng","Xã Sơn Bình","Xã Sơn Kim 1","Xã Sơn Kim 2","Xã Sơn Trà","Xã Sơn Long","Xã Kim Hoa","Xã Sơn Hàm","Xã Sơn Phú","Xã Sơn Trường"]},{"name":"Huyện Đức Thọ","communes":["Thị trấn Đức Thọ","Xã Quang Vĩnh","Xã Tùng Châu","Xã Trường Sơn","Xã Liên Minh","Xã Yên Hồ","Xã Tùng Ảnh","Xã Bùi La Nhân","Xã Thanh Bình Thịnh","Xã Lâm Trung Thủy","Xã Hòa Lạc","Xã Tân Dân","Xã An Dũng","Xã Đức Đồng","Xã Đức Lạng","Xã Tân Hương"]},{"name":"Huyện Vũ Quang","communes":["Thị trấn Vũ Quang","Xã Ân Phú","Xã Đức Giang","Xã Đức Lĩnh","Xã Thọ Điền","Xã Đức Hương","Xã Đức Bồng","Xã Đức Liên","Xã Hương Minh","Xã Quang Thọ"]},{"name":"Huyện Nghi Xuân","communes":["Thị trấn Xuân An","Xã Xuân Hội","Xã Đan Trường","Xã Xuân Phổ","Xã Xuân Hải","Xã Xuân Giang","Thị trấn Tiên Điền","Xã Xuân Yên","Xã Xuân Mỹ","Xã Xuân Thành","Xã Xuân Viên","Xã Xuân Hồng","Xã Cỗ Đạm","Xã Xuân Liên","Xã Xuân Lĩnh","Xã Xuân Lam","Xã Cương Gián"]},{"name":"Huyện Can Lộc","communes":["Thị trấn Nghèn","Xã Thiên Lộc","Xã Thuần Thiện","Xã Vượng Lộc","Xã Thanh Lộc","Xã Kim Song Trường","Xã Thường Nga","Xã Tùng Lộc","Xã Phú Lộc","Xã Gia Hanh","Xã Khánh Vĩnh Yên","Xã Trung Lộc","Xã Xuân Lộc","Xã Thượng Lộc","Xã Quang Lộc","Thị trấn Đồng Lộc","Xã Mỹ Lộc","Xã Sơn Lộc"]},{"name":"Huyện Hương Khê","communes":["Thị trấn Hương Khê","Xã Điền Mỹ","Xã Hà Linh","Xã Hương Thủy","Xã Hòa Hải","Xã Phúc Đồng","Xã Hương Giang","Xã Lộc Yên","Xã Hương Bình","Xã Hương Long","Xã Phú Gia","Xã Gia Phố","Xã Phú Phong","Xã Hương Đô","Xã Hương Vĩnh","Xã Hương Xuân","Xã Phúc Trạch","Xã Hương Trà","Xã Hương Trạch","Xã Hương Lâm","Xã Hương Liên"]},{"name":"Huyện Thạch Hà","communes":["Thị trấn Thạch Hà","Xã Ngọc Sơn","Xã Thạch Hải","Xã Thạch Kênh","Xã Thạch Sơn","Xã Thạch Liên","Xã Đỉnh Bàn","Xã Việt Tiến","Xã Thạch Khê","Xã Thạch Long","Xã Thạch Trị","Xã Thạch Lạc","Xã Thạch Ngọc","Xã Tượng Sơn","Xã Thạch Văn","Xã Lưu Vĩnh Sơn","Xã Thạch Thắng","Xã Thạch Đài","Xã Thạch Hội","Xã Tân Lâm Hương","Xã Thạch Xuân","Xã Nam Điền"]},{"name":"Huyện Cẩm Xuyên","communes":["Thị trấn Cẩm Xuyên","Thị trấn Thiên Cầm","Xã Yên Hòa","Xã Cẩm Dương","Xã Cẩm Bình","Xã Cẩm Vĩnh","Xã Cẩm Thành","Xã Cẩm Quang","Xã Cẩm Thạch","Xã Cẩm Nhượng","Xã Nam Phúc Thăng","Xã Cẩm Duệ","Xã Cẩm Lĩnh","Xã Cẩm Quan","Xã Cẩm Hà","Xã Cẩm Lộc","Xã Cẩm Hưng","Xã Cẩm Thịnh","Xã Cẩm Mỹ","Xã Cẩm Trung","Xã Cẩm Sơn","Xã Cẩm Lạc","Xã Cẩm Minh"]},{"name":"Huyện Kỳ Anh","communes":["Xã Kỳ Xuân","Xã Kỳ Bắc","Xã Kỳ Phú","Xã Kỳ Phong","Xã Kỳ Tiến","Xã Kỳ Giang","Xã Kỳ Đồng","Xã Kỳ Khang","Xã Kỳ Văn","Xã Kỳ Trung","Xã Kỳ Thọ","Xã Kỳ Tây","Xã Kỳ Thượng","Xã Kỳ Hải","Xã Kỳ Thư","Xã Kỳ Châu","Xã Kỳ Tân","Xã Lâm Hợp","Xã Kỳ Sơn","Xã Kỳ Lạc"]},{"name":"Huyện Lộc Hà","communes":["Xã Tân Lộc","Xã Hồng Lộc","Xã Thịnh Lộc","Xã Bình An","Xã Ích Hậu","Xã Phù Lưu","Thị trấn Lộc Hà","Xã Thạch Mỹ","Xã Thạch Kim","Xã Thạch Châu","Xã Hộ Độ","Xã Mai Phụ"]},{"name":"Thị xã Kỳ Anh","communes":["Phường Hưng Trí","Xã Kỳ Ninh","Xã Kỳ Lợi","Xã Kỳ Hà","Phường Kỳ Trinh","Phường Kỳ Thịnh","Xã Kỳ Hoa","Phường Kỳ Phương","Phường Kỳ Long","Phường Kỳ Liên","Xã Kỳ Nam"]}]},{"name":"Tỉnh Quảng Bình","districts":[{"name":"Thành Phố Đồng Hới","communes":["Phường Hải Thành","Phường Đồng Phú","Phường Bắc Lý","Phường Nam Lý","Phường Đồng Hải","Phường Đồng Sơn","Phường Phú Hải","Phường Bắc Nghĩa","Phường Đức Ninh Đông","Xã Quang Phú","Xã Lộc Ninh","Xã Bảo Ninh","Xã Nghĩa Ninh","Xã Thuận Đức","Xã Đức Ninh"]},{"name":"Huyện Minh Hóa","communes":["Thị trấn Quy Đạt","Xã Dân Hóa","Xã Trọng Hóa","Xã Hóa Phúc","Xã Hồng Hóa","Xã Hóa Thanh","Xã Hóa Tiến","Xã Hóa Hợp","Xã Xuân Hóa","Xã Yên Hóa","Xã Minh Hóa","Xã Tân Hóa","Xã Hóa Sơn","Xã Trung Hóa","Xã Thượng Hóa"]},{"name":"Huyện Tuyên Hóa","communes":["Thị trấn Đồng Lê","Xã Hương Hóa","Xã Kim Hóa","Xã Thanh Hóa","Xã Thanh Thạch","Xã Thuận Hóa","Xã Lâm Hóa","Xã Lê Hóa","Xã Sơn Hóa","Xã Đồng Hóa","Xã Ngư Hóa","Xã Thạch Hóa","Xã Đức Hóa","Xã Phong Hóa","Xã Mai Hóa","Xã Tiến Hóa","Xã Châu Hóa","Xã Cao Quảng","Xã Văn Hóa"]},{"name":"Huyện Quảng Trạch","communes":["Xã Quảng Hợp","Xã Quảng Kim","Xã Quảng Đông","Xã Quảng Phú","Xã Quảng Châu","Xã Quảng Thạch","Xã Quảng Lưu","Xã Quảng Tùng","Xã Cảnh Dương","Xã Quảng Tiến","Xã Quảng Hưng","Xã Quảng Xuân","Xã Cảnh Hóa","Xã Liên Trường","Xã Quảng Phương","Xã Phù Hóa","Xã Quảng Thanh"]},{"name":"Huyện Bố Trạch","communes":["Thị trấn Hoàn Lão","Thị trấn NT Việt Trung","Xã Xuân Trạch","Xã Mỹ Trạch","Xã Hạ Trạch","Xã Bắc Trạch","Xã Lâm Trạch","Xã Thanh Trạch","Xã Liên Trạch","Xã Phúc Trạch","Xã Cự Nẫm","Xã Hải Phú","Xã Thượng Trạch","Xã Sơn Lộc","Xã Hưng Trạch","Xã Đồng Trạch","Xã Đức Trạch","Thị trấn Phong Nha","Xã Vạn Trạch","Xã Phú Định","Xã Trung Trạch","Xã Tây Trạch","Xã Hòa Trạch","Xã Đại Trạch","Xã Nhân Trạch","Xã Tân Trạch","Xã Nam Trạch","Xã Lý Trạch"]},{"name":"Huyện Quảng Ninh","communes":["Thị trấn Quán Hàu","Xã Trường Sơn","Xã Lương Ninh","Xã Vĩnh Ninh","Xã Võ Ninh","Xã Hải Ninh","Xã Hàm Ninh","Xã Duy Ninh","Xã Gia Ninh","Xã Trường Xuân","Xã Hiền Ninh","Xã Tân Ninh","Xã Xuân Ninh","Xã An Ninh","Xã Vạn Ninh"]},{"name":"Huyện Lệ Thủy","communes":["Thị trấn NT Lệ Ninh","Thị trấn Kiến Giang","Xã Hồng Thủy","Xã Ngư Thủy Bắc","Xã Hoa Thủy","Xã Thanh Thủy","Xã An Thủy","Xã Phong Thủy","Xã Cam Thủy","Xã Ngân Thủy","Xã Sơn Thủy","Xã Lộc Thủy","Xã Liên Thủy","Xã Hưng Thủy","Xã Dương Thủy","Xã Tân Thủy","Xã Phú Thủy","Xã Xuân Thủy","Xã Mỹ Thủy","Xã Ngư Thủy ","Xã Mai Thủy","Xã Sen Thủy","Xã Thái Thủy","Xã Kim Thủy","Xã Trường Thủy","Xã Lâm Thủy"]},{"name":"Thị xã Ba Đồn","communes":["Phường Ba Đồn","Phường Quảng Long","Phường Quảng Thọ","Xã Quảng Tiên","Xã Quảng Trung","Phường Quảng Phong","Phường Quảng Thuận","Xã Quảng Tân","Xã Quảng Hải","Xã Quảng Sơn","Xã Quảng Lộc","Xã Quảng Thủy","Xã Quảng Văn","Phường Quảng Phúc","Xã Quảng Hòa","Xã Quảng Minh"]}]},{"name":"Tỉnh Quảng Trị","districts":[{"name":"Thành phố Đông Hà","communes":["Phường Đông Giang","Phường 1","Phường Đông Lễ","Phường Đông Thanh","Phường 2","Phường 4","Phường 5","Phường Đông Lương","Phường 3"]},{"name":"Thị xã Quảng Trị","communes":["Phường 1","Phường An Đôn","Phường 2","Phường 3","Xã Hải Lệ"]},{"name":"Huyện Vĩnh Linh","communes":["Thị trấn Hồ Xá","Thị trấn Bến Quan","Xã Vĩnh Thái","Xã Vĩnh Tú","Xã Vĩnh Chấp","Xã Trung Nam","Xã Kim Thạch","Xã Vĩnh Long","Xã Vĩnh Khê","Xã Vĩnh Hòa","Xã Vĩnh Thủy","Xã Vĩnh Lâm","Xã Hiền Thành","Thị trấn Cửa Tùng","Xã Vĩnh Hà","Xã Vĩnh Sơn","Xã Vĩnh Giang","Xã Vĩnh Ô"]},{"name":"Huyện Hướng Hóa","communes":["Thị trấn Khe Sanh","Thị trấn Lao Bảo","Xã Hướng Lập","Xã Hướng Việt","Xã Hướng Phùng","Xã Hướng Sơn","Xã Hướng Linh","Xã Tân Hợp","Xã Hướng Tân","Xã Tân Thành","Xã Tân Long","Xã Tân Lập","Xã Tân Liên","Xã Húc","Xã Thuận","Xã Hướng Lộc","Xã Ba Tầng","Xã Thanh","Xã  A Dơi","Xã Lìa","Xã Xy"]},{"name":"Huyện Gio Linh","communes":["Thị trấn Gio Linh","Thị trấn Cửa Việt","Xã Trung Giang","Xã Trung Hải","Xã Trung Sơn","Xã Phong Bình","Xã Gio Mỹ","Xã Gio Hải","Xã Gio An","Xã Gio Châu","Xã Gio Việt","Xã Linh Trường","Xã Gio Sơn","Xã Gio Mai","Xã Hải Thái","Xã Linh Hải","Xã Gio Quang"]},{"name":"Huyện Đa Krông","communes":["Thị trấn Krông Klang","Xã Mò Ó","Xã Hướng Hiệp","Xã Đa Krông","Xã Triệu Nguyên","Xã Ba Lòng","Xã Ba Nang","Xã Tà Long","Xã Húc Nghì","Xã A Vao","Xã Tà Rụt","Xã A Bung","Xã A Ngo"]},{"name":"Huyện Cam Lộ","communes":["Thị trấn Cam Lộ","Xã Cam Tuyền","Xã Thanh An","Xã Cam Thủy","Xã Cam Thành","Xã Cam Hiếu","Xã Cam Chính","Xã Cam Nghĩa"]},{"name":"Huyện Triệu Phong","communes":["Thị Trấn Ái Tử","Xã Triệu An","Xã Triệu Vân","Xã Triệu Phước","Xã Triệu Độ","Xã Triệu Trạch","Xã Triệu Thuận","Xã Triệu Đại","Xã Triệu Hòa","Xã Triệu Lăng","Xã Triệu Sơn","Xã Triệu Long","Xã Triệu Tài","Xã Triệu Trung","Xã Triệu Ái","Xã Triệu Thượng","Xã Triệu Giang","Xã Triệu Thành"]},{"name":"Huyện Hải Lăng","communes":["Thị trấn Diên Sanh","Xã Hải An","Xã Hải Ba","Xã Hải Quy","Xã Hải Quế","Xã Hải Hưng","Xã Hải Phú","Xã Hải Thượng","Xã Hải Dương","Xã Hải Định","Xã Hải Lâm","Xã Hải Phong","Xã Hải Trường","Xã Hải Sơn","Xã Hải Chánh","Xã Hải Khê"]},{"name":"Huyện Cồn Cỏ","communes":[]}]},{"name":"Tỉnh Thừa Thiên Huế","districts":[{"name":"Thành phố Huế","communes":["Phường Tây Lộc","Phường Thuận Lộc","Phường Gia Hội","Phường Phú Hậu","Phường Thuận Hòa","Phường Đông Ba","Phường Kim Long","Phường Vỹ Dạ","Phường Phường Đúc","Phường Vĩnh Ninh","Phường Phú Hội","Phường Phú Nhuận","Phường Xuân Phú","Phường Trường An","Phường Phước Vĩnh","Phường An Cựu","Phường An Hòa","Phường Hương Sơ","Phường Thuỷ Biều","Phường Hương Long","Phường Thuỷ Xuân","Phường An Đông","Phường An Tây","Phường Thuận An","Xã Phú Dương","Xã Phú Mậu","Xã Phú Thanh","Phường Phú Thượng","Phường Thủy Vân","Xã Thủy Bằng","Xã Hải Dương","Xã Hương Phong","Phường Hương Vinh","Phường Hương An","Phường Hương Hồ","Xã Hương Thọ"]},{"name":"Huyện Phong Điền","communes":["Thị trấn Phong Điền","Xã Điền Hương","Xã Điền Môn","Xã Điền Lộc","Xã Phong Bình","Xã Điền Hòa","Xã Phong Chương","Xã Phong Hải","Xã Điền Hải","Xã Phong Hòa","Xã Phong Thu","Xã Phong Hiền","Xã Phong Mỹ","Xã Phong An","Xã Phong Xuân","Xã Phong Sơn"]},{"name":"Huyện Quảng Điền","communes":["Thị trấn Sịa","Xã Quảng Thái","Xã Quảng Ngạn","Xã Quảng Lợi","Xã Quảng Công","Xã Quảng Phước","Xã Quảng Vinh","Xã Quảng An","Xã Quảng Thành","Xã Quảng Thọ","Xã Quảng Phú"]},{"name":"Huyện Phú Vang","communes":["Xã Phú Thuận","Xã Phú An","Xã Phú Hải","Xã Phú Xuân","Xã Phú Diên","Xã Phú Mỹ","Xã Phú Hồ","Xã Vinh Xuân","Xã Phú Lương","Thị trấn Phú Đa","Xã Vinh Thanh","Xã Vinh An","Xã Phú Gia","Xã Vinh Hà"]},{"name":"Thị xã Hương Thủy","communes":["Phường Phú Bài","Xã Thủy Thanh","Phường Thủy Dương","Phường Thủy Phương","Phường Thủy Châu","Phường Thủy Lương","Xã Thủy Tân","Xã Thủy Phù","Xã Phú Sơn","Xã Dương Hòa"]},{"name":"Thị xã Hương Trà","communes":["Phường Tứ Hạ","Xã Hương Toàn","Phường Hương Vân","Phường Hương Văn","Phường Hương Xuân","Phường Hương Chữ","Xã Hương Bình","Xã Bình Tiến","Xã Bình Thành"]},{"name":"Huyện A Lưới","communes":["Thị trấn A Lưới","Xã Hồng Vân","Xã Hồng Hạ","Xã Hồng Kim","Xã Trung Sơn","Xã Hương Nguyên","Xã Hồng Bắc","Xã A Ngo","Xã Sơn Thủy","Xã Phú Vinh","Xã Hương Phong","Xã Quảng Nhâm","Xã Hồng Thượng","Xã Hồng Thái","Xã A Roàng","Xã Đông Sơn","Xã Lâm Đớt","Xã Hồng Thủy"]},{"name":"Huyện Phú Lộc","communes":["Thị trấn Phú Lộc","Thị trấn Lăng Cô","Xã Vinh Mỹ","Xã Vinh Hưng","Xã Giang Hải","Xã Vinh Hiền","Xã Lộc Bổn","Xã Lộc Sơn","Xã Lộc Bình","Xã Lộc Vĩnh","Xã Lộc An","Xã Lộc Điền","Xã Lộc Thủy","Xã Lộc Trì","Xã Lộc Tiến","Xã Lộc Hòa","Xã Xuân Lộc"]},{"name":"Huyện Nam Đông","communes":["Thị trấn Khe Tre","Xã Hương Phú","Xã Hương Sơn","Xã Hương Lộc","Xã Thượng Quảng","Xã Hương Xuân","Xã Hương Hữu","Xã Thượng Lộ","Xã Thượng Long","Xã Thượng Nhật"]}]},{"name":"Thành phố Đà Nẵng","districts":[{"name":"Quận Liên Chiểu","communes":["Phường Hòa Hiệp Bắc","Phường Hòa Hiệp Nam","Phường Hòa Khánh Bắc","Phường Hòa Khánh Nam","Phường Hòa Minh"]},{"name":"Quận Thanh Khê","communes":["Phường Tam Thuận","Phường Thanh Khê Tây","Phường Thanh Khê Đông","Phường Xuân Hà","Phường Tân Chính","Phường Chính Gián","Phường Vĩnh Trung","Phường Thạc Gián","Phường An Khê","Phường Hòa Khê"]},{"name":"Quận Hải Châu","communes":["Phường Thanh Bình","Phường Thuận Phước","Phường Thạch Thang","Phường Hải Châu  I","Phường Hải Châu II","Phường Phước Ninh","Phường Hòa Thuận Tây","Phường Hòa Thuận Đông","Phường Nam Dương","Phường Bình Hiên","Phường Bình Thuận","Phường Hòa Cường Bắc","Phường Hòa Cường Nam"]},{"name":"Quận Sơn Trà","communes":["Phường Thọ Quang","Phường Nại Hiên Đông","Phường Mân Thái","Phường An Hải Bắc","Phường Phước Mỹ","Phường An Hải Tây","Phường An Hải Đông"]},{"name":"Quận Ngũ Hành Sơn","communes":["Phường Mỹ An","Phường Khuê Mỹ","Phường Hoà Quý","Phường Hoà Hải"]},{"name":"Quận Cẩm Lệ","communes":["Phường Khuê Trung","Phường Hòa Phát","Phường Hòa An","Phường Hòa Thọ Tây","Phường Hòa Thọ Đông","Phường Hòa Xuân"]},{"name":"Huyện Hòa Vang","communes":["Xã Hòa Bắc","Xã Hòa Liên","Xã Hòa Ninh","Xã Hòa Sơn","Xã Hòa Nhơn","Xã Hòa Phú","Xã Hòa Phong","Xã Hòa Châu","Xã Hòa Tiến","Xã Hòa Phước","Xã Hòa Khương"]},{"name":"Huyện Hoàng Sa","communes":[]}]},{"name":"Tỉnh Quảng Nam","districts":[{"name":"Thành phố Tam Kỳ","communes":["Phường Tân Thạnh","Phường Phước Hòa","Phường An Mỹ","Phường Hòa Hương","Phường An Xuân","Phường An Sơn","Phường Trường Xuân","Phường An Phú","Xã Tam Thanh","Xã Tam Thăng","Xã Tam Phú","Phường Hoà Thuận","Xã Tam Ngọc"]},{"name":"Thành phố Hội An","communes":["Phường Minh An","Phường Tân An","Phường Cẩm Phô","Phường Thanh Hà","Phường Sơn Phong","Phường Cẩm Châu","Phường Cửa Đại","Phường Cẩm An","Xã Cẩm Hà","Xã Cẩm Kim","Phường Cẩm Nam","Xã Cẩm Thanh","Xã Tân Hiệp"]},{"name":"Huyện Tây Giang","communes":["Xã Ch'ơm","Xã Ga Ri","Xã A Xan","Xã Tr'Hy","Xã Lăng","Xã A Nông","Xã A Tiêng","Xã Bha Lê","Xã A Vương","Xã Dang"]},{"name":"Huyện Đông Giang","communes":["Thị trấn P Rao","Xã Tà Lu","Xã Sông Kôn","Xã Jơ Ngây","Xã A Ting","Xã  Tư","Xã Ba","Xã A Rooi","Xã Za Hung","Xã Mà Cooi","Xã Ka Dăng"]},{"name":"Huyện Đại Lộc","communes":["Thị Trấn Ái Nghĩa","Xã Đại Sơn","Xã Đại Lãnh","Xã Đại Hưng","Xã Đại Hồng","Xã Đại Đồng","Xã Đại Quang","Xã Đại Nghĩa","Xã Đại Hiệp","Xã Đại Thạnh","Xã Đại Chánh","Xã Đại Tân","Xã Đại Phong","Xã Đại Minh","Xã Đại Thắng","Xã Đại Cường","Xã Đại An","Xã Đại Hòa"]},{"name":"Thị xã Điện Bàn","communes":["Phường Vĩnh Điện","Xã Điện Tiến","Xã Điện Hòa","Xã Điện Thắng Bắc","Xã Điện Thắng Trung","Xã Điện Thắng Nam","Phường Điện Ngọc","Xã Điện Hồng","Xã Điện Thọ","Xã Điện Phước","Phường Điện An","Phường Điện Nam Bắc","Phường Điện Nam Trung","Phường Điện Nam Đông","Phường Điện Dương","Xã Điện Quang","Xã Điện Trung","Xã Điện Phong","Xã Điện Minh","Xã Điện Phương"]},{"name":"Huyện Duy Xuyên","communes":["Thị trấn Nam Phước","Xã Duy Thu","Xã Duy Phú","Xã Duy Tân","Xã Duy Hòa","Xã Duy Châu","Xã Duy Trinh","Xã Duy Sơn","Xã Duy Trung","Xã Duy Phước","Xã Duy Thành","Xã Duy Vinh","Xã Duy Nghĩa","Xã Duy Hải"]},{"name":"Huyện Quế Sơn","communes":["Thị trấn Đông Phú","Xã Quế Xuân 1","Xã Quế Xuân 2","Xã Quế Phú","Thị trấn Hương An","Xã Quế Hiệp","Xã Quế Thuận","Xã Quế Mỹ","Xã Quế Long","Xã Quế Châu","Xã Quế Phong","Xã Quế An","Xã Quế Minh"]},{"name":"Huyện Nam Giang","communes":["Thị trấn Thạnh Mỹ","Xã Laêê","Xã Chơ Chun","Xã Zuôich","Xã Tà Pơơ","Xã La Dêê","Xã Đắc Tôi","Xã Chà Vàl","Xã Tà Bhinh","Xã Cà Dy","Xã Đắc Pre","Xã Đắc Pring"]},{"name":"Huyện Phước Sơn","communes":["Thị trấn Khâm Đức","Xã Phước Xuân","Xã Phước Hiệp","Xã Phước Hoà","Xã Phước Đức","Xã Phước Năng","Xã Phước Mỹ","Xã Phước Chánh","Xã Phước Công","Xã Phước Kim","Xã Phước Lộc","Xã Phước Thành"]},{"name":"Huyện Hiệp Đức","communes":["Xã Hiệp Hòa","Xã Hiệp Thuận","Xã Quế Thọ","Xã Bình Lâm","Xã Sông Trà","Xã Phước Trà","Xã Phước Gia","Thị trấn Tân Bình","Xã Quế Lưu","Xã Thăng Phước","Xã Bình Sơn"]},{"name":"Huyện Thăng Bình","communes":["Thị trấn Hà Lam","Xã Bình Dương","Xã Bình Giang","Xã Bình Nguyên","Xã Bình Phục","Xã Bình Triều","Xã Bình Đào","Xã Bình Minh","Xã Bình Lãnh","Xã Bình Trị","Xã Bình Định Bắc","Xã Bình Định Nam","Xã Bình Quý","Xã Bình Phú","Xã Bình Chánh","Xã Bình Tú","Xã Bình Sa","Xã Bình Hải","Xã Bình Quế","Xã Bình An","Xã Bình Trung","Xã Bình Nam"]},{"name":"Huyện Tiên Phước","communes":["Thị trấn Tiên Kỳ","Xã Tiên Sơn","Xã Tiên Hà","Xã Tiên Cẩm","Xã Tiên Châu","Xã Tiên Lãnh","Xã Tiên Ngọc","Xã Tiên Hiệp","Xã Tiên Cảnh","Xã Tiên Mỹ","Xã Tiên Phong","Xã Tiên Thọ","Xã Tiên An","Xã Tiên Lộc","Xã Tiên Lập"]},{"name":"Huyện Bắc Trà My","communes":["Thị trấn Trà My","Xã Trà Sơn","Xã Trà Kót","Xã Trà Nú","Xã Trà Đông","Xã Trà Dương","Xã Trà Giang","Xã Trà Bui","Xã Trà Đốc","Xã Trà Tân","Xã Trà Giác","Xã Trà Giáp","Xã Trà Ka"]},{"name":"Huyện Nam Trà My","communes":["Xã Trà Leng","Xã Trà Dơn","Xã Trà Tập","Xã Trà Mai","Xã Trà Cang","Xã Trà Linh","Xã Trà Nam","Xã Trà Don","Xã Trà Vân","Xã Trà Vinh"]},{"name":"Huyện Núi Thành","communes":["Thị trấn Núi Thành","Xã Tam Xuân I","Xã Tam Xuân II","Xã Tam Tiến","Xã Tam Sơn","Xã Tam Thạnh","Xã Tam Anh Bắc","Xã Tam Anh Nam","Xã Tam Hòa","Xã Tam Hiệp","Xã Tam Hải","Xã Tam Giang","Xã Tam Quang","Xã Tam Nghĩa","Xã Tam Mỹ Tây","Xã Tam Mỹ Đông","Xã Tam Trà"]},{"name":"Huyện Phú Ninh","communes":["Thị trấn Phú Thịnh","Xã Tam Thành","Xã Tam An","Xã Tam Đàn","Xã Tam Lộc","Xã Tam Phước","Xã Tam Vinh","Xã Tam Thái","Xã Tam Đại","Xã Tam Dân","Xã Tam Lãnh"]},{"name":"Huyện Nông Sơn","communes":["Xã Quế Trung","Xã Ninh Phước","Xã Phước Ninh","Xã Quế Lộc","Xã Sơn Viên","Xã Quế Lâm"]}]},{"name":"Tỉnh Quảng Ngãi","districts":[{"name":"Thành phố Quảng Ngãi","communes":["Phường Lê Hồng Phong","Phường Trần Phú","Phường Quảng Phú","Phường Nghĩa Chánh","Phường Trần Hưng Đạo","Phường Nguyễn Nghiêm","Phường Nghĩa Lộ","Phường Chánh Lộ","Xã Nghĩa Dũng","Xã Nghĩa Dõng","Phường Trương Quang Trọng","Xã Tịnh Hòa","Xã Tịnh Kỳ","Xã Tịnh Thiện","Xã Tịnh Ấn Đông","Xã Tịnh Châu","Xã Tịnh Khê","Xã Tịnh Long","Xã Tịnh Ấn Tây","Xã Tịnh An","Xã Nghĩa Phú","Xã Nghĩa Hà","Xã Nghĩa An"]},{"name":"Huyện Bình Sơn","communes":["Thị Trấn Châu Ổ","Xã Bình Thuận","Xã Bình Thạnh","Xã Bình Đông","Xã Bình Chánh","Xã Bình Nguyên","Xã Bình Khương","Xã Bình Trị","Xã Bình An","Xã Bình Hải","Xã Bình Dương","Xã Bình Phước","Xã Bình Hòa","Xã Bình Trung","Xã Bình Minh","Xã Bình Long","Xã Bình Thanh ","Xã Bình Chương","Xã Bình Hiệp","Xã Bình Mỹ","Xã Bình Tân Phú","Xã Bình Châu"]},{"name":"Huyện Trà Bồng","communes":["Thị trấn Trà Xuân","Xã Trà Giang","Xã Trà Thủy","Xã Trà Hiệp","Xã Trà Bình","Xã Trà Phú","Xã Trà Lâm","Xã Trà Tân","Xã Trà Sơn","Xã Trà Bùi","Xã Trà Thanh","Xã Sơn Trà","Xã Trà Phong","Xã Hương Trà","Xã Trà Xinh","Xã Trà Tây"]},{"name":"Huyện Sơn Tịnh","communes":["Xã Tịnh Thọ","Xã Tịnh Trà","Xã Tịnh Phong","Xã Tịnh Hiệp","Xã Tịnh Bình","Xã Tịnh Đông","Xã Tịnh Bắc","Xã Tịnh Sơn","Xã Tịnh Hà","Xã Tịnh Giang","Xã Tịnh Minh"]},{"name":"Huyện Tư Nghĩa","communes":["Thị trấn La Hà","Thị trấn Sông Vệ","Xã Nghĩa Lâm","Xã Nghĩa Thắng","Xã Nghĩa Thuận","Xã Nghĩa Kỳ","Xã Nghĩa Sơn","Xã Nghĩa Hòa","Xã Nghĩa Điền","Xã Nghĩa Thương","Xã Nghĩa Trung","Xã Nghĩa Hiệp","Xã Nghĩa Phương","Xã Nghĩa Mỹ"]},{"name":"Huyện Sơn Hà","communes":["Thị trấn Di Lăng","Xã Sơn Hạ","Xã Sơn Thành","Xã Sơn Nham","Xã Sơn Bao","Xã Sơn Linh","Xã Sơn Giang","Xã Sơn Trung","Xã Sơn Thượng","Xã Sơn Cao","Xã Sơn Hải","Xã Sơn Thủy","Xã Sơn Kỳ","Xã Sơn Ba"]},{"name":"Huyện Sơn Tây","communes":["Xã Sơn Bua","Xã Sơn Mùa","Xã Sơn Liên","Xã Sơn Tân","Xã Sơn Màu","Xã Sơn Dung","Xã Sơn Long","Xã Sơn Tinh","Xã Sơn Lập"]},{"name":"Huyện Minh Long","communes":["Xã Long Sơn","Xã Long Mai","Xã Thanh An","Xã Long Môn","Xã Long Hiệp"]},{"name":"Huyện Nghĩa Hành","communes":["Thị trấn Chợ Chùa","Xã Hành Thuận","Xã Hành Dũng","Xã Hành Trung","Xã Hành Nhân","Xã Hành Đức","Xã Hành Minh","Xã Hành Phước","Xã Hành Thiện","Xã Hành Thịnh","Xã Hành Tín Tây","Xã Hành Tín  Đông"]},{"name":"Huyện Mộ Đức","communes":["Thị trấn Mộ Đức","Xã Đức Lợi","Xã Đức Thắng","Xã Đức Nhuận","Xã Đức Chánh","Xã Đức Hiệp","Xã Đức Minh","Xã Đức Thạnh","Xã Đức Hòa","Xã Đức Tân","Xã Đức Phú","Xã Đức Phong","Xã Đức Lân"]},{"name":"Thị xã Đức Phổ","communes":["Phường Nguyễn Nghiêm","Xã Phổ An","Xã Phổ Phong","Xã Phổ Thuận","Phường Phổ Văn","Phường Phổ Quang","Xã Phổ Nhơn","Phường Phổ Ninh","Phường Phổ Minh","Phường Phổ Vinh","Phường Phổ Hòa","Xã Phổ Cường","Xã Phổ Khánh","Phường Phổ Thạnh","Xã Phổ Châu"]},{"name":"Huyện Ba Tơ","communes":["Thị trấn Ba Tơ","Xã Ba Điền","Xã Ba Vinh","Xã Ba Thành","Xã Ba Động","Xã Ba Dinh","Xã Ba Giang","Xã Ba Liên","Xã Ba Ngạc","Xã Ba Khâm","Xã Ba Cung","Xã Ba Tiêu","Xã Ba Trang","Xã Ba Tô","Xã Ba Bích","Xã Ba Vì","Xã Ba Lế","Xã Ba Nam","Xã Ba Xa"]},{"name":"Huyện Lý Sơn","communes":[]}]},{"name":"Tỉnh Bình Định","districts":[{"name":"Thành phố Quy Nhơn","communes":["Phường Nhơn Bình","Phường Nhơn Phú","Phường Đống Đa","Phường Trần Quang Diệu","Phường Hải Cảng","Phường Quang Trung","Phường Thị Nại","Phường Lê Hồng Phong","Phường Trần Hưng Đạo","Phường Ngô Mây","Phường Lý Thường Kiệt","Phường Lê Lợi","Phường Trần Phú","Phường Bùi Thị Xuân","Phường Nguyễn Văn Cừ","Phường Ghềnh Ráng","Xã Nhơn Lý","Xã Nhơn Hội","Xã Nhơn Hải","Xã Nhơn Châu","Xã Phước Mỹ"]},{"name":"Huyện An Lão","communes":["Thị trấn An Lão","Xã An Hưng","Xã An Trung","Xã An Dũng","Xã An Vinh","Xã An Toàn","Xã An Tân","Xã An Hòa","Xã An Quang","Xã An Nghĩa"]},{"name":"Thị xã Hoài Nhơn","communes":["Phường Tam Quan","Phường Bồng Sơn","Xã Hoài Sơn","Xã Hoài Châu Bắc","Xã Hoài Châu","Xã Hoài Phú","Phường Tam Quan Bắc","Phường Tam Quan Nam","Phường Hoài Hảo","Phường Hoài Thanh Tây","Phường Hoài Thanh","Phường Hoài Hương","Phường Hoài Tân","Xã Hoài Hải","Phường Hoài Xuân","Xã Hoài Mỹ","Phường Hoài Đức"]},{"name":"Huyện Hoài Ân","communes":["Thị trấn Tăng Bạt Hổ","Xã Ân Hảo Tây","Xã Ân Hảo Đông","Xã Ân Sơn","Xã Ân Mỹ","Xã Đak Mang","Xã Ân Tín","Xã Ân Thạnh","Xã Ân Phong","Xã Ân Đức","Xã Ân Hữu","Xã Bok Tới","Xã Ân Tường Tây","Xã Ân Tường Đông","Xã Ân Nghĩa"]},{"name":"Huyện Phù Mỹ","communes":["Thị trấn Phù Mỹ","Thị trấn Bình Dương","Xã Mỹ Đức","Xã Mỹ Châu","Xã Mỹ Thắng","Xã Mỹ Lộc","Xã Mỹ Lợi","Xã Mỹ An","Xã Mỹ Phong","Xã Mỹ Trinh","Xã Mỹ Thọ","Xã Mỹ Hòa","Xã Mỹ Thành","Xã Mỹ Chánh","Xã Mỹ Quang","Xã Mỹ Hiệp","Xã Mỹ Tài","Xã Mỹ Cát","Xã Mỹ Chánh Tây"]},{"name":"Huyện Vĩnh Thạnh","communes":["Thị trấn Vĩnh Thạnh","Xã Vĩnh Sơn","Xã Vĩnh Kim","Xã Vĩnh Hiệp","Xã Vĩnh Hảo","Xã Vĩnh Hòa","Xã Vĩnh Thịnh","Xã Vĩnh Thuận","Xã Vĩnh Quang"]},{"name":"Huyện Tây Sơn","communes":["Thị trấn Phú Phong","Xã Bình Tân","Xã Tây Thuận","Xã Bình Thuận","Xã Tây Giang","Xã Bình Thành","Xã Tây An","Xã Bình Hòa","Xã Tây Bình","Xã Bình Tường","Xã Tây Vinh","Xã Vĩnh An","Xã Tây Xuân","Xã Bình Nghi","Xã Tây Phú"]},{"name":"Huyện Phù Cát","communes":["Thị trấn Ngô Mây","Xã Cát Sơn","Xã Cát Minh","Xã Cát Khánh","Xã Cát Tài","Xã Cát Lâm","Xã Cát Hanh","Xã Cát Thành","Xã Cát Trinh","Xã Cát Hải","Xã Cát Hiệp","Xã Cát Nhơn","Xã Cát Hưng","Xã Cát Tường","Xã Cát Tân","Thị trấn Cát Tiến","Xã Cát Thắng","Xã Cát Chánh"]},{"name":"Thị xã An Nhơn","communes":["Phường Bình Định","Phường Đập Đá","Xã Nhơn Mỹ","Phường Nhơn Thành","Xã Nhơn Hạnh","Xã Nhơn Hậu","Xã Nhơn Phong","Xã Nhơn An","Xã Nhơn Phúc","Phường Nhơn Hưng","Xã Nhơn Khánh","Xã Nhơn Lộc","Phường Nhơn Hoà","Xã Nhơn Tân","Xã Nhơn Thọ"]},{"name":"Huyện Tuy Phước","communes":["Thị trấn Tuy Phước","Thị trấn Diêu Trì","Xã Phước Thắng","Xã Phước Hưng","Xã Phước Quang","Xã Phước Hòa","Xã Phước Sơn","Xã Phước Hiệp","Xã Phước Lộc","Xã Phước Nghĩa","Xã Phước Thuận","Xã Phước An","Xã Phước Thành"]},{"name":"Huyện Vân Canh","communes":["Thị trấn Vân Canh","Xã Canh Liên","Xã Canh Hiệp","Xã Canh Vinh","Xã Canh Hiển","Xã Canh Thuận","Xã Canh Hòa"]}]},{"name":"Tỉnh Phú Yên","districts":[{"name":"Thành phố Tuy Hoà","communes":["Phường 1","Phường 8","Phường 2","Phường 9","Phường 3","Phường 4","Phường 5","Phường 7","Phường 6","Phường Phú Thạnh","Phường Phú Đông","Xã Hòa Kiến","Xã Bình Kiến","Xã Bình Ngọc","Xã An Phú","Phường Phú Lâm"]},{"name":"Thị xã Sông Cầu","communes":["Phường Xuân Phú","Xã Xuân Lâm","Phường Xuân Thành","Xã Xuân Hải","Xã Xuân Lộc","Xã Xuân Bình","Xã Xuân Cảnh","Xã Xuân Thịnh","Xã Xuân Phương","Phường Xuân Yên","Xã Xuân Thọ 1","Phường Xuân Đài","Xã Xuân Thọ 2"]},{"name":"Huyện Đồng Xuân","communes":["Thị trấn La Hai","Xã Đa Lộc","Xã Phú Mỡ","Xã Xuân Lãnh","Xã Xuân Long","Xã Xuân Quang 1","Xã Xuân Sơn Bắc","Xã Xuân Quang 2","Xã Xuân Sơn Nam","Xã Xuân Quang 3","Xã Xuân Phước"]},{"name":"Huyện Tuy An","communes":["Thị trấn Chí Thạnh","Xã An Dân","Xã An Ninh Tây","Xã An Ninh Đông","Xã An Thạch","Xã An Định","Xã An Nghiệp","Xã An Cư","Xã An Xuân","Xã An Lĩnh","Xã An Hòa Hải","Xã An Hiệp","Xã An Mỹ","Xã An Chấn","Xã An Thọ"]},{"name":"Huyện Sơn Hòa","communes":["Thị trấn Củng Sơn","Xã Phước Tân","Xã Sơn Hội","Xã Sơn Định","Xã Sơn Long","Xã Cà Lúi","Xã Sơn Phước","Xã Sơn Xuân","Xã Sơn Nguyên","Xã Eachà Rang","Xã Krông Pa","Xã Suối Bạc","Xã Sơn Hà","Xã Suối Trai"]},{"name":"Huyện Sông Hinh","communes":["Thị trấn Hai Riêng","Xã Ea Lâm","Xã Đức Bình Tây","Xã Ea Bá","Xã Sơn Giang","Xã Đức Bình Đông","Xã EaBar","Xã EaBia","Xã EaTrol","Xã Sông Hinh","Xã Ealy"]},{"name":"Huyện Tây Hoà","communes":["Xã Sơn Thành Tây","Xã Sơn Thành Đông","Xã Hòa Bình 1","Thị trấn Phú Thứ","Xã Hòa Phong","Xã Hòa Phú","Xã Hòa Tân Tây","Xã Hòa Đồng","Xã Hòa Mỹ Đông","Xã Hòa Mỹ Tây","Xã Hòa Thịnh"]},{"name":"Huyện Phú Hoà","communes":["Xã Hòa Quang Bắc","Xã Hòa Quang Nam","Xã Hòa Hội","Xã Hòa Trị","Xã Hòa An","Xã Hòa Định Đông","Thị Trấn Phú Hoà","Xã Hòa Định Tây","Xã Hòa Thắng"]},{"name":"Thị xã Đông Hòa","communes":["Xã Hòa Thành","Phường Hòa Hiệp Bắc","Phường Hoà Vinh","Phường Hoà Hiệp Trung","Xã Hòa Tân Đông","Phường Hòa Xuân Tây","Phường Hòa Hiệp Nam","Xã Hòa Xuân Đông","Xã Hòa Tâm","Xã Hòa Xuân Nam"]}]},{"name":"Tỉnh Khánh Hòa","districts":[{"name":"Thành phố Nha Trang","communes":["Phường Vĩnh Hòa","Phường Vĩnh Hải","Phường Vĩnh Phước","Phường Ngọc Hiệp","Phường Vĩnh Thọ","Phường Xương Huân","Phường Vạn Thắng","Phường Vạn Thạnh","Phường Phương Sài","Phường Phương Sơn","Phường Phước Hải","Phường Phước Tân","Phường Lộc Thọ","Phường Phước Tiến","Phường Tân Lập","Phường Phước Hòa","Phường Vĩnh Nguyên","Phường Phước Long","Phường Vĩnh Trường","Xã Vĩnh Lương","Xã Vĩnh Phương","Xã Vĩnh Ngọc","Xã Vĩnh Thạnh","Xã Vĩnh Trung","Xã Vĩnh Hiệp","Xã Vĩnh Thái","Xã Phước Đồng"]},{"name":"Thành phố Cam Ranh","communes":["Phường Cam Nghĩa","Phường Cam Phúc Bắc","Phường Cam Phúc Nam","Phường Cam Lộc","Phường Cam Phú","Phường Ba Ngòi","Phường Cam Thuận","Phường Cam Lợi","Phường Cam Linh","Xã Cam Thành Nam","Xã Cam Phước Đông","Xã Cam Thịnh Tây","Xã Cam Thịnh Đông","Xã Cam Lập","Xã Cam Bình"]},{"name":"Huyện Cam Lâm","communes":["Xã Cam Tân","Xã Cam Hòa","Xã Cam Hải Đông","Xã Cam Hải Tây","Xã Sơn Tân","Xã Cam Hiệp Bắc","Thị trấn Cam Đức","Xã Cam Hiệp Nam","Xã Cam Phước Tây","Xã Cam Thành Bắc","Xã Cam An Bắc","Xã Cam An Nam","Xã Suối Cát","Xã Suối Tân"]},{"name":"Huyện Vạn Ninh","communes":["Thị trấn Vạn Giã","Xã Đại Lãnh","Xã Vạn Phước","Xã Vạn Long","Xã Vạn Bình","Xã Vạn Thọ","Xã Vạn Khánh","Xã Vạn Phú","Xã Vạn Lương","Xã Vạn Thắng","Xã Vạn Thạnh","Xã Xuân Sơn","Xã Vạn Hưng"]},{"name":"Thị xã Ninh Hòa","communes":["Phường Ninh Hiệp","Xã Ninh Sơn","Xã Ninh Tây","Xã Ninh Thượng","Xã Ninh An","Phường Ninh Hải","Xã Ninh Thọ","Xã Ninh Trung","Xã Ninh Sim","Xã Ninh Xuân","Xã Ninh Thân","Phường Ninh Diêm","Xã Ninh Đông","Phường Ninh Thủy","Phường Ninh Đa","Xã Ninh Phụng","Xã Ninh Bình","Xã Ninh Phước","Xã Ninh Phú","Xã Ninh Tân","Xã Ninh Quang","Phường Ninh Giang","Phường Ninh Hà","Xã Ninh Hưng","Xã Ninh Lộc","Xã Ninh Ích","Xã Ninh Vân"]},{"name":"Huyện Khánh Vĩnh","communes":["Thị trấn Khánh Vĩnh","Xã Khánh Hiệp","Xã Khánh Bình","Xã Khánh Trung","Xã Khánh Đông","Xã Khánh Thượng","Xã Khánh Nam","Xã Sông Cầu","Xã Giang Ly","Xã Cầu Bà","Xã Liên Sang","Xã Khánh Thành","Xã Khánh Phú","Xã Sơn Thái"]},{"name":"Huyện Diên Khánh","communes":["Thị trấn Diên Khánh","Xã Diên Lâm","Xã Diên Điền","Xã Diên Xuân","Xã Diên Sơn","Xã Diên Đồng","Xã Diên Phú","Xã Diên Thọ","Xã Diên Phước","Xã Diên Lạc","Xã Diên Tân","Xã Diên Hòa","Xã Diên Thạnh","Xã Diên Toàn","Xã Diên An","Xã Bình Lộc","Xã Suối Hiệp","Xã Suối Tiên"]},{"name":"Huyện Khánh Sơn","communes":["Thị trấn Tô Hạp","Xã Thành Sơn","Xã Sơn Lâm","Xã Sơn Hiệp","Xã Sơn Bình","Xã Sơn Trung","Xã Ba Cụm Bắc","Xã Ba Cụm Nam"]},{"name":"Huyện Trường Sa","communes":["Thị trấn Trường Sa","Xã Song Tử Tây","Xã Sinh Tồn"]}]},{"name":"Tỉnh Ninh Thuận","districts":[{"name":"Thành phố Phan Rang-Tháp Chàm","communes":["Phường Đô Vinh","Phường Phước Mỹ","Phường Bảo An","Phường Phủ Hà","Phường Thanh Sơn","Phường Mỹ Hương","Phường Tấn Tài","Phường Kinh Dinh","Phường Đạo Long","Phường Đài Sơn","Phường Đông Hải","Phường Mỹ Đông","Xã Thành Hải","Phường Văn Hải","Phường Mỹ Bình","Phường Mỹ Hải"]},{"name":"Huyện Bác Ái","communes":["Xã Phước Bình","Xã Phước Hòa","Xã Phước Tân","Xã Phước Tiến","Xã Phước Thắng","Xã Phước Thành","Xã Phước Đại","Xã Phước Chính","Xã Phước Trung"]},{"name":"Huyện Ninh Sơn","communes":["Thị trấn Tân Sơn","Xã Lâm Sơn","Xã Lương Sơn","Xã Quảng Sơn","Xã Mỹ Sơn","Xã Hòa Sơn","Xã Ma Nới","Xã Nhơn Sơn"]},{"name":"Huyện Ninh Hải","communes":["Thị trấn Khánh Hải","Xã Vĩnh Hải","Xã Phương Hải","Xã Tân Hải","Xã Xuân Hải","Xã Hộ Hải","Xã Tri Hải","Xã Nhơn Hải","Xã Thanh Hải"]},{"name":"Huyện Ninh Phước","communes":["Thị trấn Phước Dân","Xã Phước Sơn","Xã Phước Thái","Xã Phước Hậu","Xã Phước Thuận","Xã An Hải","Xã Phước Hữu","Xã Phước Hải","Xã Phước Vinh"]},{"name":"Huyện Thuận Bắc","communes":["Xã Phước Chiến","Xã Công Hải","Xã Phước Kháng","Xã Lợi Hải","Xã Bắc Sơn","Xã Bắc Phong"]},{"name":"Huyện Thuận Nam","communes":["Xã Phước Hà","Xã Phước Nam","Xã Phước Ninh","Xã Nhị Hà","Xã Phước Dinh","Xã Phước Minh","Xã Phước Diêm","Xã Cà Ná"]}]},{"name":"Tỉnh Bình Thuận","districts":[{"name":"Thành phố Phan Thiết","communes":["Phường Mũi Né","Phường Hàm Tiến","Phường Phú Hài","Phường Phú Thủy","Phường Phú Tài","Phường Phú Trinh","Phường Xuân An","Phường Thanh Hải","Phường Bình Hưng","Phường Đức Nghĩa","Phường Lạc Đạo","Phường Đức Thắng","Phường Hưng Long","Phường Đức Long","Xã Thiện Nghiệp","Xã Phong Nẫm","Xã Tiến Lợi","Xã Tiến Thành"]},{"name":"Thị xã La Gi","communes":["Phường Phước Hội","Phường Phước Lộc","Phường Tân Thiện","Phường Tân An","Phường Bình Tân","Xã Tân Hải","Xã Tân Tiến","Xã Tân Bình","Xã Tân Phước"]},{"name":"Huyện Tuy Phong","communes":["Thị trấn Liên Hương","Thị trấn Phan Rí Cửa","Xã Phan Dũng","Xã Phong Phú","Xã Vĩnh Hảo","Xã Vĩnh Tân","Xã Phú Lạc","Xã Phước Thể","Xã Hòa Minh","Xã Chí Công","Xã Bình Thạnh"]},{"name":"Huyện Bắc Bình","communes":["Thị trấn Chợ Lầu","Xã Phan Sơn","Xã Phan Lâm","Xã Bình An","Xã Phan Điền","Xã Hải Ninh","Xã Sông Lũy","Xã Phan Tiến","Xã Sông Bình","Thị trấn Lương Sơn","Xã Phan Hòa","Xã Phan Thanh","Xã Hồng Thái","Xã Phan Hiệp","Xã Bình Tân","Xã Phan Rí Thành","Xã Hòa Thắng","Xã Hồng Phong"]},{"name":"Huyện Hàm Thuận Bắc","communes":["Thị trấn Ma Lâm","Thị trấn Phú Long","Xã La Dạ","Xã Đông Tiến","Xã Thuận Hòa","Xã Đông Giang","Xã Hàm Phú","Xã Hồng Liêm","Xã Thuận Minh","Xã Hồng Sơn","Xã Hàm Trí","Xã Hàm Đức","Xã Hàm Liêm","Xã Hàm Chính","Xã Hàm Hiệp","Xã Hàm Thắng","Xã Đa Mi"]},{"name":"Huyện Hàm Thuận Nam","communes":["Thị trấn Thuận Nam","Xã Mỹ Thạnh","Xã Hàm Cần","Xã Mương Mán","Xã Hàm Thạnh","Xã Hàm Kiệm","Xã Hàm Cường","Xã Hàm Mỹ","Xã Tân Lập","Xã Hàm Minh","Xã Thuận Quí","Xã Tân Thuận","Xã Tân Thành"]},{"name":"Huyện Tánh Linh","communes":["Thị trấn Lạc Tánh","Xã Bắc Ruộng","Xã Nghị Đức","Xã La Ngâu","Xã Huy Khiêm","Xã Măng Tố","Xã Đức Phú","Xã Đồng Kho","Xã Gia An","Xã Đức Bình","Xã Gia Huynh","Xã Đức Thuận","Xã Suối Kiết"]},{"name":"Huyện Đức Linh","communes":["Thị trấn Võ Xu","Thị trấn Đức Tài","Xã Đa Kai","Xã Sùng Nhơn","Xã Mê Pu","Xã Nam Chính","Xã Đức Hạnh","Xã Đức Tín","Xã Vũ Hoà","Xã Tân Hà","Xã Đông Hà","Xã Trà Tân"]},{"name":"Huyện Hàm Tân","communes":["Thị trấn Tân Minh","Thị trấn Tân Nghĩa","Xã Sông Phan","Xã Tân Phúc","Xã Tân Đức","Xã Tân Thắng","Xã Thắng Hải","Xã Tân Hà","Xã Tân Xuân","Xã Sơn Mỹ"]},{"name":"Huyện Phú Quí","communes":["Xã Ngũ Phụng","Xã Long Hải","Xã Tam Thanh"]}]},{"name":"Tỉnh Kon Tum","districts":[{"name":"Thành phố Kon Tum","communes":["Phường Quang Trung","Phường Duy Tân","Phường Quyết Thắng","Phường Trường Chinh","Phường Thắng Lợi","Phường Ngô Mây","Phường Thống Nhất","Phường Lê Lợi","Phường Nguyễn Trãi","Phường Trần Hưng Đạo","Xã Đắk Cấm","Xã Kroong","Xã Ngọk Bay","Xã Vinh Quang","Xã Đắk Blà","Xã Ia Chim","Xã Đăk Năng","Xã Đoàn Kết","Xã Chư Hreng","Xã Đắk Rơ Wa","Xã Hòa Bình"]},{"name":"Huyện Đắk Glei","communes":["Thị trấn Đắk Glei","Xã Đắk Blô","Xã Đắk Man","Xã Đắk Nhoong","Xã Đắk Pék","Xã Đắk Choong","Xã Xốp","Xã Mường Hoong","Xã Ngọc Linh","Xã Đắk Long","Xã Đắk KRoong","Xã Đắk Môn"]},{"name":"Huyện Ngọc Hồi","communes":["Thị trấn Plei Kần","Xã Đắk Ang","Xã Đắk Dục","Xã Đắk Nông","Xã Đắk Xú","Xã Đắk Kan","Xã Bờ Y","Xã Sa Loong"]},{"name":"Huyện Đắk Tô","communes":["Thị trấn Đắk Tô","Xã Đắk Rơ Nga","Xã Ngọk Tụ","Xã Đắk Trăm","Xã Văn Lem","Xã Kon Đào","Xã Tân Cảnh","Xã Diên Bình","Xã Pô Kô"]},{"name":"Huyện Kon Plông","communes":["Xã Đắk Nên","Xã Đắk Ring","Xã Măng Buk","Xã Đắk Tăng","Xã Ngok Tem","Xã Pờ Ê","Xã Măng Cành","Thị trấn Măng Đen","Xã Hiếu"]},{"name":"Huyện Kon Rẫy","communes":["Thị trấn Đắk Rve","Xã Đắk Kôi","Xã Đắk Tơ Lung","Xã Đắk Ruồng","Xã Đắk Pne","Xã Đắk Tờ Re","Xã Tân Lập"]},{"name":"Huyện Đắk Hà","communes":["Thị trấn Đắk Hà","Xã Đắk PXi","Xã Đăk Long","Xã Đắk HRing","Xã Đắk Ui","Xã Đăk Ngọk","Xã Đắk Mar","Xã Ngok Wang","Xã Ngok Réo","Xã Hà Mòn","Xã Đắk La"]},{"name":"Huyện Sa Thầy","communes":["Thị trấn Sa Thầy","Xã Rơ Kơi","Xã Sa Nhơn","Xã Hơ Moong","Xã Mô Rai","Xã Sa Sơn","Xã Sa Nghĩa","Xã Sa Bình","Xã Ya Xiêr","Xã Ya Tăng","Xã Ya ly"]},{"name":"Huyện Tu Mơ Rông","communes":["Xã Ngọc Lây","Xã Đắk Na","Xã Măng Ri","Xã Ngọc Yêu","Xã Đắk Sao","Xã Đắk Rơ Ông","Xã Đắk Tờ Kan","Xã Tu Mơ Rông","Xã Đắk Hà","Xã Tê Xăng","Xã Văn Xuôi"]},{"name":"Huyện Ia H' Drai","communes":["Xã Ia Đal","Xã Ia Dom","Xã Ia Tơi"]}]},{"name":"Tỉnh Gia Lai","districts":[{"name":"Thành phố Pleiku","communes":["Phường Yên Đỗ","Phường Diên Hồng","Phường Ia Kring","Phường Hội Thương","Phường Hội Phú","Phường Phù Đổng","Phường Hoa Lư","Phường Tây Sơn","Phường Thống Nhất","Phường Đống Đa","Phường Trà Bá","Phường Thắng Lợi","Phường Yên Thế","Phường Chi Lăng","Xã Biển Hồ","Xã Tân Sơn","Xã Trà Đa","Xã Chư Á","Xã An Phú","Xã Diên Phú","Xã Ia Kênh","Xã Gào"]},{"name":"Thị xã An Khê","communes":["Phường An Bình","Phường Tây Sơn","Phường An Phú","Phường An Tân","Xã Tú An","Xã Xuân An","Xã Cửu An","Phường An Phước","Xã Song An","Phường Ngô Mây","Xã Thành An"]},{"name":"Thị xã Ayun Pa","communes":["Phường Cheo Reo","Phường Hòa Bình","Phường Đoàn Kết","Phường Sông Bờ","Xã Ia RBol","Xã Chư Băh","Xã Ia RTô","Xã Ia Sao"]},{"name":"Huyện KBang","communes":["Thị trấn KBang","Xã Kon Pne","Xã Đăk Roong","Xã Sơn Lang","Xã KRong","Xã Sơ Pai","Xã Lơ Ku","Xã Đông","Xã Đak SMar","Xã Nghĩa An","Xã Tơ Tung","Xã Kông Lơng Khơng","Xã Kông Pla","Xã Đăk HLơ"]},{"name":"Huyện Đăk Đoa","communes":["Thị trấn Đăk Đoa","Xã Hà Đông","Xã Đăk Sơmei","Xã Đăk Krong","Xã Hải Yang","Xã Kon Gang","Xã Hà Bầu","Xã Nam Yang","Xã K' Dang","Xã H' Neng","Xã Tân Bình","Xã Glar","Xã A Dơk","Xã Trang","Xã HNol","Xã Ia Pết","Xã Ia Băng"]},{"name":"Huyện Chư Păh","communes":["Thị trấn Phú Hòa","Xã Hà Tây","Xã Ia Khươl","Xã Ia Phí","Thị trấn Ia Ly","Xã Ia Mơ Nông","Xã Ia Kreng","Xã Đăk Tơ Ver","Xã Hòa Phú","Xã Chư Đăng Ya","Xã Ia Ka","Xã Ia Nhin","Xã Nghĩa Hòa","Xã Nghĩa Hưng"]},{"name":"Huyện Ia Grai","communes":["Thị trấn Ia Kha","Xã Ia Sao","Xã Ia Yok","Xã Ia Hrung","Xã Ia Bă","Xã Ia Khai","Xã Ia KRai","Xã Ia Grăng","Xã Ia Tô","Xã Ia O","Xã Ia Dêr","Xã Ia Chia","Xã Ia Pếch"]},{"name":"Huyện Mang Yang","communes":["Thị trấn Kon Dơng","Xã Ayun","Xã Đak Jơ Ta","Xã Đak Ta Ley","Xã Hra","Xã Đăk Yă","Xã Đăk Djrăng","Xã Lơ Pang","Xã Kon Thụp","Xã Đê Ar","Xã Kon Chiêng","Xã Đăk Trôi"]},{"name":"Huyện Kông Chro","communes":["Thị trấn Kông Chro","Xã Chư Krêy","Xã An Trung","Xã Kông Yang","Xã Đăk Tơ Pang","Xã SRó","Xã Đắk Kơ Ning","Xã Đăk Song","Xã Đăk Pling","Xã Yang Trung","Xã Đăk Pơ Pho","Xã Ya Ma","Xã Chơ Long","Xã Yang Nam"]},{"name":"Huyện Đức Cơ","communes":["Thị trấn Chư Ty","Xã Ia Dơk","Xã Ia Krêl","Xã Ia Din","Xã Ia Kla","Xã Ia Dom","Xã Ia Lang","Xã Ia Kriêng","Xã Ia Pnôn","Xã Ia Nan"]},{"name":"Huyện Chư Prông","communes":["Thị trấn Chư Prông","Xã Ia Kly","Xã Bình Giáo","Xã Ia Drăng","Xã Thăng Hưng","Xã Bàu Cạn","Xã Ia Phìn","Xã Ia Băng","Xã Ia Tôr","Xã Ia Boòng","Xã Ia O","Xã Ia Púch","Xã Ia Me","Xã Ia Vê","Xã Ia Bang","Xã Ia Pia","Xã Ia Ga","Xã Ia Lâu","Xã Ia Piơr","Xã Ia Mơ"]},{"name":"Huyện Chư Sê","communes":["Thị trấn Chư Sê","Xã Ia Tiêm","Xã Chư Pơng","Xã Bar Măih","Xã Bờ Ngoong","Xã Ia Glai","Xã AL Bá","Xã Kông HTok","Xã AYun","Xã Ia HLốp","Xã Ia Blang","Xã Dun","Xã Ia Pal","Xã H Bông","Xã Ia Ko"]},{"name":"Huyện Đăk Pơ","communes":["Xã Hà Tam","Xã An Thành","Thị trấn Đak Pơ","Xã Yang Bắc","Xã Cư An","Xã Tân An","Xã Phú An","Xã Ya Hội"]},{"name":"Huyện Ia Pa","communes":["Xã Pờ Tó","Xã Chư Răng","Xã Ia KDăm","Xã Kim Tân","Xã Chư Mố","Xã Ia Tul","Xã Ia Ma Rơn","Xã Ia Broăi","Xã Ia Trok"]},{"name":"Huyện Krông Pa","communes":["Thị trấn Phú Túc","Xã Ia RSai","Xã Ia RSươm","Xã Chư Gu","Xã Đất Bằng","Xã Ia Mláh","Xã Chư Drăng","Xã Phú Cần","Xã Ia HDreh","Xã Ia RMok","Xã Chư Ngọc","Xã Uar","Xã Chư Rcăm","Xã Krông Năng"]},{"name":"Huyện Phú Thiện","communes":["Thị trấn Phú Thiện","Xã Chư A Thai","Xã Ayun Hạ","Xã Ia Ake","Xã Ia Sol","Xã Ia Piar","Xã Ia Peng","Xã Chrôh Pơnan","Xã Ia Hiao","Xã Ia Yeng"]},{"name":"Huyện Chư Pưh","communes":["Thị trấn Nhơn Hoà","Xã Ia Hrú","Xã Ia Rong","Xã Ia Dreng","Xã Ia Hla","Xã Chư Don","Xã Ia Phang","Xã Ia Le","Xã Ia BLứ"]}]},{"name":"Tỉnh Đắk Lắk","districts":[{"name":"Thành phố Buôn Ma Thuột","communes":["Phường Tân Lập","Phường Tân Hòa","Phường Tân An","Phường Thống Nhất","Phường Thành Nhất","Phường Thắng Lợi","Phường Tân Lợi","Phường Thành Công","Phường Tân Thành","Phường Tân Tiến","Phường Tự An","Phường Ea Tam","Phường Khánh Xuân","Xã Hòa Thuận","Xã Cư ÊBur","Xã Ea Tu","Xã Hòa Thắng","Xã Ea Kao","Xã Hòa Phú","Xã Hòa Khánh","Xã Hòa Xuân"]},{"name":"Thị xã Buôn Hồ","communes":["Phường An Lạc","Phường An Bình","Phường Thiện An","Phường Đạt Hiếu","Phường Đoàn Kết","Xã Ea Blang","Xã Ea Drông","Phường Thống Nhất","Phường Bình Tân","Xã Ea Siên","Xã Bình Thuận","Xã Cư Bao"]},{"name":"Huyện Ea H'leo","communes":["Thị trấn Ea Drăng","Xã Ea H'leo","Xã Ea Sol","Xã Ea Ral","Xã Ea Wy","Xã Cư A Mung","Xã Cư Mốt","Xã Ea Hiao","Xã Ea Khal","Xã Dliê Yang","Xã Ea Tir","Xã Ea Nam"]},{"name":"Huyện Ea Súp","communes":["Thị trấn Ea Súp","Xã Ia Lốp","Xã Ia JLơi","Xã Ea Rốk","Xã Ya Tờ Mốt","Xã Ia RVê","Xã Ea Lê","Xã Cư KBang","Xã Ea Bung","Xã Cư M'Lan"]},{"name":"Huyện Buôn Đôn","communes":["Xã Krông Na","Xã Ea Huar","Xã Ea Wer","Xã Tân Hoà","Xã Cuôr KNia","Xã Ea Bar","Xã Ea Nuôl"]},{"name":"Huyện Cư M'gar","communes":["Thị trấn Ea Pốk","Thị trấn Quảng Phú","Xã Quảng Tiến","Xã Ea Kuêh","Xã Ea Kiết","Xã Ea Tar","Xã Cư Dliê M'nông","Xã Ea H'đinh","Xã Ea Tul","Xã Ea KPam","Xã Ea M'DRóh","Xã Quảng Hiệp","Xã Cư M'gar","Xã Ea D'Rơng","Xã Ea M'nang","Xã Cư Suê","Xã Cuor Đăng"]},{"name":"Huyện Krông Búk","communes":["Xã Cư Né","Xã Chư KBô","Xã Cư Pơng","Xã Ea Sin","Xã Pơng Drang","Xã Tân Lập","Xã Ea Ngai"]},{"name":"Huyện Krông Năng","communes":["Thị trấn Krông Năng","Xã ĐLiê Ya","Xã Ea Tóh","Xã Ea Tam","Xã Phú Lộc","Xã Tam Giang","Xã Ea Puk","Xã Ea Dăh","Xã Ea Hồ","Xã Phú Xuân","Xã Cư Klông","Xã Ea Tân"]},{"name":"Huyện Ea Kar","communes":["Thị trấn Ea Kar","Thị trấn Ea Knốp","Xã Ea Sô","Xã Ea Sar","Xã Xuân Phú","Xã Cư Huê","Xã Ea Tih","Xã Ea Đar","Xã Ea Kmút","Xã Cư Ni","Xã Ea Păl","Xã Cư Prông","Xã Ea Ô","Xã Cư ELang","Xã Cư Bông","Xã Cư Jang"]},{"name":"Huyện M'Đrắk","communes":["Thị trấn M'Đrắk","Xã Cư Prao","Xã Ea Pil","Xã Ea Lai","Xã Ea H'MLay","Xã Krông Jing","Xã Ea M' Doal","Xã Ea Riêng","Xã Cư M'ta","Xã Cư K Róa","Xã Krông Á","Xã Cư San","Xã Ea Trang"]},{"name":"Huyện Krông Bông","communes":["Thị trấn Krông Kmar","Xã Dang Kang","Xã Cư KTy","Xã Hòa Thành","Xã Hòa Tân","Xã Hòa Phong","Xã Hòa Lễ","Xã Yang Reh","Xã Ea Trul","Xã Khuê Ngọc Điền","Xã Cư Pui","Xã Hòa Sơn","Xã Cư Drăm","Xã Yang Mao"]},{"name":"Huyện Krông Pắc","communes":["Thị trấn Phước An","Xã KRông Búk","Xã Ea Kly","Xã Ea Kênh","Xã Ea Phê","Xã Ea KNuec","Xã Ea Yông","Xã Hòa An","Xã Ea Kuăng","Xã Hòa Đông","Xã Ea Hiu","Xã Hòa Tiến","Xã Tân Tiến","Xã Vụ Bổn","Xã Ea Uy","Xã Ea Yiêng"]},{"name":"Huyện Krông A Na","communes":["Thị trấn Buôn Trấp","Xã Dray Sáp","Xã Ea Na","Xã Ea Bông","Xã Băng A Drênh","Xã Dur KMăl","Xã Bình Hòa","Xã Quảng Điền"]},{"name":"Huyện Lắk","communes":["Thị trấn Liên Sơn","Xã Yang Tao","Xã Bông Krang","Xã Đắk Liêng","Xã Buôn Triết","Xã Buôn Tría","Xã Đắk Phơi","Xã Đắk Nuê","Xã Krông Nô","Xã Nam Ka","Xã Ea R'Bin"]},{"name":"Huyện Cư Kuin","communes":["Xã Ea Ning","Xã Cư Ê Wi","Xã Ea Ktur","Xã Ea Tiêu","Xã Ea BHốk","Xã Ea Hu","Xã Dray Bhăng","Xã Hòa Hiệp"]}]},{"name":"Tỉnh Đắk Nông","districts":[{"name":"Thành phố Gia Nghĩa","communes":["Phường Nghĩa Đức","Phường Nghĩa Thành","Phường Nghĩa Phú","Phường Nghĩa Tân","Phường Nghĩa Trung","Xã Đăk R'Moan","Phường Quảng Thành","Xã Đắk Nia"]},{"name":"Huyện Đăk Glong","communes":["Xã Quảng Sơn","Xã Quảng Hoà","Xã Đắk Ha","Xã Đắk R'Măng","Xã Quảng Khê","Xã Đắk Plao","Xã Đắk Som"]},{"name":"Huyện Cư Jút","communes":["Thị trấn Ea T'Ling","Xã Đắk Wil","Xã Ea Pô","Xã Nam Dong","Xã Đắk DRông","Xã Tâm Thắng","Xã Cư Knia","Xã Trúc Sơn"]},{"name":"Huyện Đắk Mil","communes":["Thị trấn Đắk Mil","Xã  Đắk Lao","Xã Đắk R'La","Xã Đắk Gằn","Xã Đức Mạnh","Xã Đắk N'Drót","Xã Long Sơn","Xã Đắk Sắk","Xã Thuận An","Xã Đức Minh"]},{"name":"Huyện Krông Nô","communes":["Thị trấn Đắk Mâm","Xã Đắk Sôr","Xã Nam Xuân","Xã Buôn Choah","Xã Nam Đà","Xã Tân Thành","Xã Đắk Drô","Xã Nâm Nung","Xã Đức Xuyên","Xã Đắk Nang","Xã Quảng Phú","Xã Nâm N'Đir"]},{"name":"Huyện Đắk Song","communes":["Thị trấn Đức An","Xã Đắk Môl","Xã Đắk Hòa","Xã Nam Bình","Xã Thuận Hà","Xã Thuận Hạnh","Xã Đắk N'Dung","Xã Nâm N'Jang","Xã Trường Xuân"]},{"name":"Huyện Đắk R'Lấp","communes":["Thị trấn Kiến Đức","Xã Quảng Tín","Xã Đắk Wer","Xã Nhân Cơ","Xã Kiến Thành","Xã Nghĩa Thắng","Xã Đạo Nghĩa","Xã Đắk Sin","Xã Hưng Bình","Xã Đắk Ru","Xã Nhân Đạo"]},{"name":"Huyện Tuy Đức","communes":["Xã Quảng Trực","Xã Đắk Búk So","Xã Quảng Tâm","Xã Đắk R'Tíh","Xã Đắk Ngo","Xã Quảng Tân"]}]},{"name":"Tỉnh Lâm Đồng","districts":[{"name":"Thành phố Đà Lạt","communes":["Phường 7","Phường 8","Phường 12","Phường 9","Phường 2","Phường 1","Phường 6","Phường 5","Phường 4","Phường 10","Phường 11","Phường 3","Xã Xuân Thọ","Xã Tà Nung","Xã Trạm Hành","Xã Xuân Trường"]},{"name":"Thành phố Bảo Lộc","communes":["Phường Lộc Phát","Phường Lộc Tiến","Phường 2","Phường 1","Phường B'lao","Phường Lộc Sơn","Xã Đạm Bri","Xã Lộc Thanh","Xã Lộc Nga","Xã Lộc Châu","Xã Đại Lào"]},{"name":"Huyện Đam Rông","communes":["Xã Đạ Tông","Xã Đạ Long","Xã Đạ M' Rong","Xã Liêng Srônh","Xã Đạ Rsal","Xã Rô Men","Xã Phi Liêng","Xã Đạ K' Nàng"]},{"name":"Huyện Lạc Dương","communes":["Thị trấn Lạc Dương","Xã Đạ Chais","Xã Đạ Nhim","Xã Đưng KNớ","Xã Lát","Xã Đạ Sar"]},{"name":"Huyện Lâm Hà","communes":["Thị trấn Nam Ban","Thị trấn Đinh Văn","Xã Phú Sơn","Xã Phi Tô","Xã Mê Linh","Xã Đạ Đờn","Xã Phúc Thọ","Xã Đông Thanh","Xã Gia Lâm","Xã Tân Thanh","Xã Tân Văn","Xã Hoài Đức","Xã Tân Hà","Xã Liên Hà","Xã Đan Phượng","Xã Nam Hà"]},{"name":"Huyện Đơn Dương","communes":["Thị trấn D'Ran","Thị trấn Thạnh Mỹ","Xã Lạc Xuân","Xã Đạ Ròn","Xã Lạc Lâm","Xã Ka Đô","Xã Quảng Lập","Xã Ka Đơn","Xã Tu Tra","Xã Pró"]},{"name":"Huyện Đức Trọng","communes":["Thị trấn Liên Nghĩa","Xã Hiệp An","Xã Liên Hiệp","Xã Hiệp Thạnh","Xã Bình Thạnh","Xã N'Thol Hạ","Xã Tân Hội","Xã Tân Thành","Xã Phú Hội","Xã Ninh Gia","Xã Tà Năng","Xã Đa Quyn","Xã Tà Hine","Xã Đà Loan","Xã Ninh Loan"]},{"name":"Huyện Di Linh","communes":["Thị trấn Di Linh","Xã Đinh Trang Thượng","Xã Tân Thượng","Xã Tân Lâm","Xã Tân Châu","Xã Tân Nghĩa","Xã Gia Hiệp","Xã Đinh Lạc","Xã Tam Bố","Xã Đinh Trang Hòa","Xã Liên Đầm","Xã Gung Ré","Xã Bảo Thuận","Xã Hòa Ninh","Xã Hòa Trung","Xã Hòa Nam","Xã Hòa Bắc","Xã Sơn Điền","Xã Gia Bắc"]},{"name":"Huyện Bảo Lâm","communes":["Thị trấn Lộc Thắng","Xã Lộc Bảo","Xã Lộc Lâm","Xã Lộc Phú","Xã Lộc Bắc","Xã B' Lá","Xã Lộc Ngãi","Xã Lộc Quảng","Xã Lộc Tân","Xã Lộc Đức","Xã Lộc An","Xã Tân Lạc","Xã Lộc Thành","Xã Lộc Nam"]},{"name":"Huyện Đạ Huoai","communes":["Thị trấn Đạ M'ri","Thị trấn Ma Đa Guôi","Xã Hà Lâm","Xã Đạ Tồn","Xã Đạ Oai","Xã Đạ Ploa","Xã Ma Đa Guôi","Xã Đoàn Kết","Xã Phước Lộc"]},{"name":"Huyện Đạ Tẻh","communes":["Thị trấn Đạ Tẻh","Xã An Nhơn","Xã Quốc Oai","Xã Mỹ Đức","Xã Quảng Trị","Xã Đạ Lây","Xã Triệu Hải","Xã Đạ Kho","Xã Đạ Pal"]},{"name":"Huyện Cát Tiên","communes":["Thị trấn Cát Tiên","Xã Tiên Hoàng","Xã Phước Cát 2","Xã Gia Viễn","Xã Nam Ninh","Thị trấn Phước Cát ","Xã Đức Phổ","Xã Quảng Ngãi","Xã Đồng Nai Thượng"]}]},{"name":"Tỉnh Bình Phước","districts":[{"name":"Thị xã Phước Long","communes":["Phường Thác Mơ","Phường Long Thủy","Phường Phước Bình","Phường Long Phước","Phường Sơn Giang","Xã Long Giang","Xã Phước Tín"]},{"name":"Thành phố Đồng Xoài","communes":["Phường Tân Phú","Phường Tân Đồng","Phường Tân Bình","Phường Tân Xuân","Phường Tân Thiện","Xã Tân Thành","Phường Tiến Thành","Xã Tiến Hưng"]},{"name":"Thị xã Bình Long","communes":["Phường Hưng Chiến","Phường An Lộc","Phường Phú Thịnh","Phường Phú Đức","Xã Thanh Lương","Xã Thanh Phú"]},{"name":"Huyện Bù Gia Mập","communes":["Xã Bù Gia Mập","Xã Đak Ơ","Xã Đức Hạnh","Xã Phú Văn","Xã Đa Kia","Xã Phước Minh","Xã Bình Thắng","Xã Phú Nghĩa"]},{"name":"Huyện Lộc Ninh","communes":["Thị trấn Lộc Ninh","Xã Lộc Hòa","Xã Lộc An","Xã Lộc Tấn","Xã Lộc Thạnh","Xã Lộc Hiệp","Xã Lộc Thiện","Xã Lộc Thuận","Xã Lộc Quang","Xã Lộc Phú","Xã Lộc Thành","Xã Lộc Thái","Xã Lộc Điền","Xã Lộc Hưng","Xã Lộc Thịnh","Xã Lộc Khánh"]},{"name":"Huyện Bù Đốp","communes":["Thị trấn Thanh Bình","Xã Hưng Phước","Xã Phước Thiện","Xã Thiện Hưng","Xã Thanh Hòa","Xã Tân Thành","Xã Tân Tiến"]},{"name":"Huyện Hớn Quản","communes":["Xã Thanh An","Xã An Khương","Xã An Phú","Xã Tân Lợi","Xã Tân Hưng","Xã Minh Đức","Xã Minh Tâm","Xã Phước An","Xã Thanh Bình","Thị trấn Tân Khai","Xã Đồng Nơ","Xã Tân Hiệp","Xã Tân Quan"]},{"name":"Huyện Đồng Phú","communes":["Thị trấn Tân Phú","Xã Thuận Lợi","Xã Đồng Tâm","Xã Tân Phước","Xã Tân Hưng","Xã Tân Lợi","Xã Tân Lập","Xã Tân Hòa","Xã Thuận Phú","Xã Đồng Tiến","Xã Tân Tiến"]},{"name":"Huyện Bù Đăng","communes":["Thị trấn Đức Phong","Xã Đường 10","Xã Đak Nhau","Xã Phú Sơn","Xã Thọ Sơn","Xã Bình Minh","Xã Bom Bo","Xã Minh Hưng","Xã Đoàn Kết","Xã Đồng Nai","Xã Đức Liễu","Xã Thống Nhất","Xã Nghĩa Trung","Xã Nghĩa Bình","Xã Đăng Hà","Xã Phước Sơn"]},{"name":"Thị xã Chơn Thành","communes":["Phường Hưng Long","Phường Thành Tâm","Xã Minh Lập","Xã Quang Minh","Phường Minh Hưng","Phường Minh Long","Phường Minh Thành","Xã Nha Bích","Xã Minh Thắng"]},{"name":"Huyện Phú Riềng","communes":["Xã Long Bình","Xã Bình Tân","Xã Bình Sơn","Xã Long Hưng","Xã Phước Tân","Xã Bù Nho","Xã Long Hà","Xã Long Tân","Xã Phú Trung","Xã Phú Riềng"]}]},{"name":"Tỉnh Tây Ninh","districts":[{"name":"Thành phố Tây Ninh","communes":["Phường 1","Phường 3","Phường 4","Phường Hiệp Ninh","Phường 2","Xã Thạnh Tân","Xã Tân Bình","Xã Bình Minh","Phường Ninh Sơn","Phường Ninh Thạnh"]},{"name":"Huyện Tân Biên","communes":["Thị trấn Tân Biên","Xã Tân Lập","Xã Thạnh Bắc","Xã Tân Bình","Xã Thạnh Bình","Xã Thạnh Tây","Xã Hòa Hiệp","Xã Tân Phong","Xã Mỏ Công","Xã Trà Vong"]},{"name":"Huyện Tân Châu","communes":["Thị trấn Tân Châu","Xã Tân Hà","Xã Tân Đông","Xã Tân Hội","Xã Tân Hòa","Xã Suối Ngô","Xã Suối Dây","Xã Tân Hiệp","Xã Thạnh Đông","Xã Tân Thành","Xã Tân Phú","Xã Tân Hưng"]},{"name":"Huyện Dương Minh Châu","communes":["Thị trấn Dương Minh Châu","Xã Suối Đá","Xã Phan","Xã Phước Ninh","Xã Phước Minh","Xã Bàu Năng","Xã Chà Là","Xã Cầu Khởi","Xã Bến Củi","Xã Lộc Ninh","Xã Truông Mít"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Châu Thành","Xã Hảo Đước","Xã Phước Vinh","Xã Đồng Khởi","Xã Thái Bình","Xã An Cơ","Xã Biên Giới","Xã Hòa Thạnh","Xã Trí Bình","Xã Hòa Hội","Xã An Bình","Xã Thanh Điền","Xã Thành Long","Xã Ninh Điền","Xã Long Vĩnh"]},{"name":"Thị xã Hòa Thành","communes":["Phường Long Hoa","Phường Hiệp Tân","Phường Long Thành Bắc","Xã Trường Hòa","Xã Trường Đông","Phường Long Thành Trung","Xã Trường Tây","Xã Long Thành Nam"]},{"name":"Huyện Gò Dầu","communes":["Thị trấn Gò Dầu","Xã Thạnh Đức","Xã Cẩm Giang","Xã Hiệp Thạnh","Xã Bàu Đồn","Xã Phước Thạnh","Xã Phước Đông","Xã Phước Trạch","Xã Thanh Phước"]},{"name":"Huyện Bến Cầu","communes":["Thị trấn Bến Cầu","Xã Long Chữ","Xã Long Phước","Xã Long Giang","Xã Tiên Thuận","Xã Long Khánh","Xã Lợi Thuận","Xã Long Thuận","Xã An Thạnh"]},{"name":"Thị xã Trảng Bàng","communes":["Phường Trảng Bàng","Xã Đôn Thuận","Xã Hưng Thuận","Phường Lộc Hưng","Phường Gia Lộc","Phường Gia Bình","Xã Phước Bình","Phường An Tịnh","Phường An Hòa","Xã Phước Chỉ"]}]},{"name":"Tỉnh Bình Dương","districts":[{"name":"Thành phố Thủ Dầu Một","communes":["Phường Hiệp Thành","Phường Phú Lợi","Phường Phú Cường","Phường Phú Hòa","Phường Phú Thọ","Phường Chánh Nghĩa","Phường Định Hoà","Phường Hoà Phú","Phường Phú Mỹ","Phường Phú Tân","Phường Tân An","Phường Hiệp An","Phường Tương Bình Hiệp","Phường Chánh Mỹ"]},{"name":"Huyện Bàu Bàng","communes":["Xã Trừ Văn Thố","Xã Cây Trường II","Thị trấn Lai Uyên","Xã Tân Hưng","Xã Long Nguyên","Xã Hưng Hòa","Xã Lai Hưng"]},{"name":"Huyện Dầu Tiếng","communes":["Thị trấn Dầu Tiếng","Xã Minh Hoà","Xã Minh Thạnh","Xã Minh Tân","Xã Định An","Xã Long Hoà","Xã Định Thành","Xã Định Hiệp","Xã An Lập","Xã Long Tân","Xã Thanh An","Xã Thanh Tuyền"]},{"name":"Thị xã Bến Cát","communes":["Phường Mỹ Phước","Phường Chánh Phú Hòa","Xã An Điền","Xã An Tây","Phường Thới Hòa","Phường Hòa Lợi","Phường Tân Định","Xã Phú An"]},{"name":"Huyện Phú Giáo","communes":["Thị trấn Phước Vĩnh","Xã An Linh","Xã Phước Sang","Xã An Thái","Xã An Long","Xã An Bình","Xã Tân Hiệp","Xã Tam Lập","Xã Tân Long","Xã Vĩnh Hoà","Xã Phước Hoà"]},{"name":"Thành phố Tân Uyên","communes":["Phường Uyên Hưng","Phường Tân Phước Khánh","Phường Vĩnh Tân","Phường Hội Nghĩa","Phường Tân Hiệp","Phường Khánh Bình","Phường Phú Chánh","Xã Bạch Đằng","Phường Tân Vĩnh Hiệp","Phường Thạnh Phước","Xã Thạnh Hội","Phường Thái Hòa"]},{"name":"Thành phố Dĩ An","communes":["Phường Dĩ An","Phường Tân Bình","Phường Tân Đông Hiệp","Phường Bình An","Phường Bình Thắng","Phường Đông Hòa","Phường An Bình"]},{"name":"Thành phố Thuận An","communes":["Phường An Thạnh","Phường Lái Thiêu","Phường Bình Chuẩn","Phường Thuận Giao","Phường An Phú","Phường Hưng Định","Xã An Sơn","Phường Bình Nhâm","Phường Bình Hòa","Phường Vĩnh Phú"]},{"name":"Huyện Bắc Tân Uyên","communes":["Xã Tân Định","Xã Bình Mỹ","Thị trấn Tân Bình","Xã Tân Lập","Thị trấn Tân Thành","Xã Đất Cuốc","Xã Hiếu Liêm","Xã Lạc An","Xã Tân Mỹ","Xã Thường Tân"]}]},{"name":"Tỉnh Đồng Nai","districts":[{"name":"Thành phố Biên Hòa","communes":["Phường Trảng Dài","Phường Tân Phong","Phường Tân Biên","Phường Hố Nai","Phường Tân Hòa","Phường Tân Hiệp","Phường Bửu Long","Phường Tân Tiến","Phường Tam Hiệp","Phường Long Bình","Phường Quang Vinh","Phường Tân Mai","Phường Thống Nhất","Phường Trung Dũng","Phường Tam Hòa","Phường Hòa Bình","Phường Quyết Thắng","Phường Thanh Bình","Phường Bình Đa","Phường An Bình","Phường Bửu Hòa","Phường Long Bình Tân","Phường Tân Vạn","Phường Tân Hạnh","Phường Hiệp Hòa","Phường Hóa An","Phường An Hòa","Phường Tam Phước","Phường Phước Tân","Xã Long Hưng"]},{"name":"Thành phố Long Khánh","communes":["Phường Xuân Trung","Phường Xuân Thanh","Phường Xuân Bình","Phường Xuân An","Phường Xuân Hoà","Phường Phú Bình","Xã Bình Lộc","Xã Bảo Quang","Phường Suối Tre","Phường Bảo Vinh","Phường Xuân Lập","Phường Bàu Sen","Xã Bàu Trâm","Phường Xuân Tân","Xã Hàng Gòn"]},{"name":"Huyện Tân Phú","communes":["Thị trấn Tân Phú","Xã Dak Lua","Xã Nam Cát Tiên","Xã Phú An","Xã Núi Tượng","Xã Tà Lài","Xã Phú Lập","Xã Phú Sơn","Xã Phú Thịnh","Xã Thanh Sơn","Xã Phú Trung","Xã Phú Xuân","Xã Phú Lộc","Xã Phú Lâm","Xã Phú Bình","Xã Phú Thanh","Xã Trà Cổ","Xã Phú Điền"]},{"name":"Huyện Vĩnh Cửu","communes":["Thị trấn Vĩnh An","Xã Phú Lý","Xã Trị An","Xã Tân An","Xã Vĩnh Tân","Xã Bình Lợi","Xã Thạnh Phú","Xã Thiện Tân","Xã Tân Bình","Xã Bình Hòa","Xã Mã Đà","Xã Hiếu Liêm"]},{"name":"Huyện Định Quán","communes":["Thị trấn Định Quán","Xã Thanh Sơn","Xã Phú Tân","Xã Phú Vinh","Xã Phú Lợi","Xã Phú Hòa","Xã Ngọc Định","Xã La Ngà","Xã Gia Canh","Xã Phú Ngọc","Xã Phú Cường","Xã Túc Trưng","Xã Phú Túc","Xã Suối Nho"]},{"name":"Huyện Trảng Bom","communes":["Thị trấn Trảng Bom","Xã Thanh Bình","Xã Cây Gáo","Xã Bàu Hàm","Xã Sông Thao","Xã Sông Trầu","Xã Đông Hoà","Xã Bắc Sơn","Xã Hố Nai 3","Xã Tây Hoà","Xã Bình Minh","Xã Trung Hoà","Xã Đồi 61","Xã Hưng Thịnh","Xã Quảng Tiến","Xã Giang Điền","Xã An Viễn"]},{"name":"Huyện Thống Nhất","communes":["Xã Gia Tân 1","Xã Gia Tân 2","Xã Gia Tân 3","Xã Gia Kiệm","Xã Quang Trung","Xã Bàu Hàm 2","Xã Hưng Lộc","Xã Lộ 25","Xã Xuân Thiện","Thị trấn Dầu Giây"]},{"name":"Huyện Cẩm Mỹ","communes":["Xã Sông Nhạn","Xã Xuân Quế","Xã Nhân Nghĩa","Xã Xuân Đường","Thị trấn Long Giao","Xã Xuân Mỹ","Xã Thừa Đức","Xã Bảo Bình","Xã Xuân Bảo","Xã Xuân Tây","Xã Xuân Đông","Xã Sông Ray","Xã Lâm San"]},{"name":"Huyện Long Thành","communes":["Thị trấn Long Thành","Xã An Phước","Xã Bình An","Xã Long Đức","Xã Lộc An","Xã Bình Sơn","Xã Tam An","Xã Cẩm Đường","Xã Long An","Xã Bàu Cạn","Xã Long Phước","Xã Phước Bình","Xã Tân Hiệp","Xã Phước Thái"]},{"name":"Huyện Xuân Lộc","communes":["Thị trấn Gia Ray","Xã Xuân Bắc","Xã Suối Cao","Xã Xuân Thành","Xã Xuân Thọ","Xã Xuân Trường","Xã Xuân Hòa","Xã Xuân Hưng","Xã Xuân Tâm","Xã Suối Cát","Xã Xuân Hiệp","Xã Xuân Phú","Xã Xuân Định","Xã Bảo Hoà","Xã Lang Minh"]},{"name":"Huyện Nhơn Trạch","communes":["Xã Phước Thiền","Xã Long Tân","Xã Đại Phước","Thị trấn Hiệp Phước","Xã Phú Hữu","Xã Phú Hội","Xã Phú Thạnh","Xã Phú Đông","Xã Long Thọ","Xã Vĩnh Thanh","Xã Phước Khánh","Xã Phước An"]}]},{"name":"Tỉnh Bà Rịa - Vũng Tàu","districts":[{"name":"Thành phố Vũng Tàu","communes":["Phường 1","Phường Thắng Tam","Phường 2","Phường 3","Phường 4","Phường 5","Phường Thắng Nhì","Phường 7","Phường Nguyễn An Ninh","Phường 8","Phường 9","Phường Thắng Nhất","Phường Rạch Dừa","Phường 10","Phường 11","Phường 12","Xã Long Sơn"]},{"name":"Thành phố Bà Rịa","communes":["Phường Phước Hưng","Phường Phước Hiệp","Phường Phước Nguyên","Phường Long Toàn","Phường Long Tâm","Phường Phước Trung","Phường Long Hương","Phường Kim Dinh","Xã Tân Hưng","Xã Long Phước","Xã Hoà Long"]},{"name":"Huyện Châu Đức","communes":["Xã Bàu Chinh","Thị trấn Ngãi Giao","Xã Bình Ba","Xã Suối Nghệ","Xã Xuân Sơn","Xã Sơn Bình","Xã Bình Giã","Xã Bình Trung","Xã Xà Bang","Xã Cù Bị","Xã Láng Lớn","Xã Quảng Thành","Xã Kim Long","Xã Suối Rao","Xã Đá Bạc","Xã Nghĩa Thành"]},{"name":"Huyện Xuyên Mộc","communes":["Thị trấn Phước Bửu","Xã Phước Thuận","Xã Phước Tân","Xã Xuyên Mộc","Xã Bông Trang","Xã Tân Lâm","Xã Bàu Lâm","Xã Hòa Bình","Xã Hòa Hưng","Xã Hòa Hiệp","Xã Hòa Hội","Xã Bưng Riềng","Xã Bình Châu"]},{"name":"Huyện Long Điền","communes":["Thị trấn Long Điền","Thị trấn Long Hải","Xã An Ngãi","Xã Tam Phước","Xã An Nhứt","Xã Phước Tỉnh","Xã Phước Hưng"]},{"name":"Huyện Đất Đỏ","communes":["Thị trấn Đất Đỏ","Xã Phước Long Thọ","Xã Phước Hội","Xã Long Mỹ","Thị trấn Phước Hải","Xã Long Tân","Xã Láng Dài","Xã Lộc An"]},{"name":"Thị xã Phú Mỹ","communes":["Phường Phú Mỹ","Xã Tân Hoà","Xã Tân Hải","Phường Phước Hoà","Phường Tân Phước","Phường Mỹ Xuân","Xã Sông Xoài","Phường Hắc Dịch","Xã Châu Pha","Xã Tóc Tiên"]},{"name":"Huyện Côn Đảo","communes":[]}]},{"name":"Thành phố Hồ Chí Minh","districts":[{"name":"Quận 1","communes":["Phường Tân Định","Phường Đa Kao","Phường Bến Nghé","Phường Bến Thành","Phường Nguyễn Thái Bình","Phường Phạm Ngũ Lão","Phường Cầu Ông Lãnh","Phường Cô Giang","Phường Nguyễn Cư Trinh","Phường Cầu Kho"]},{"name":"Quận 12","communes":["Phường Thạnh Xuân","Phường Thạnh Lộc","Phường Hiệp Thành","Phường Thới An","Phường Tân Chánh Hiệp","Phường An Phú Đông","Phường Tân Thới Hiệp","Phường Trung Mỹ Tây","Phường Tân Hưng Thuận","Phường Đông Hưng Thuận","Phường Tân Thới Nhất"]},{"name":"Quận Gò Vấp","communes":["Phường 15","Phường 13","Phường 17","Phường 6","Phường 16","Phường 12","Phường 14","Phường 10","Phường 05","Phường 07","Phường 04","Phường 01","Phường 9","Phường 8","Phường 11","Phường 03"]},{"name":"Quận Bình Thạnh","communes":["Phường 13","Phường 11","Phường 27","Phường 26","Phường 12","Phường 25","Phường 05","Phường 07","Phường 24","Phường 06","Phường 14","Phường 15","Phường 02","Phường 01","Phường 03","Phường 17","Phường 21","Phường 22","Phường 19","Phường 28"]},{"name":"Quận Tân Bình","communes":["Phường 02","Phường 04","Phường 12","Phường 13","Phường 01","Phường 03","Phường 11","Phường 07","Phường 05","Phường 10","Phường 06","Phường 08","Phường 09","Phường 14","Phường 15"]},{"name":"Quận Tân Phú","communes":["Phường Tân Sơn Nhì","Phường Tây Thạnh","Phường Sơn Kỳ","Phường Tân Quý","Phường Tân Thành","Phường Phú Thọ Hòa","Phường Phú Thạnh","Phường Phú Trung","Phường Hòa Thạnh","Phường Hiệp Tân","Phường Tân Thới Hòa"]},{"name":"Quận Phú Nhuận","communes":["Phường 04","Phường 05","Phường 09","Phường 07","Phường 03","Phường 01","Phường 02","Phường 08","Phường 15","Phường 10","Phường 11","Phường 17","Phường 13"]},{"name":"Thành phố Thủ Đức","communes":["Phường Linh Xuân","Phường Bình Chiểu","Phường Linh Trung","Phường Tam Bình","Phường Tam Phú","Phường Hiệp Bình Phước","Phường Hiệp Bình Chánh","Phường Linh Chiểu","Phường Linh Tây","Phường Linh Đông","Phường Bình Thọ","Phường Trường Thọ","Phường Long Bình","Phường Long Thạnh Mỹ","Phường Tân Phú","Phường Hiệp Phú","Phường Tăng Nhơn Phú A","Phường Tăng Nhơn Phú B","Phường Phước Long B","Phường Phước Long A","Phường Trường Thạnh","Phường Long Phước","Phường Long Trường","Phường Phước Bình","Phường Phú Hữu","Phường Thảo Điền","Phường An Phú","Phường An Khánh","Phường Bình Trưng Đông","Phường Bình Trưng Tây","Phường Cát Lái","Phường Thạnh Mỹ Lợi","Phường An Lợi Đông","Phường Thủ Thiêm"]},{"name":"Quận 3","communes":["Phường 14","Phường 12","Phường 11","Phường 13","Phường Võ Thị Sáu","Phường 09","Phường 10","Phường 04","Phường 05","Phường 03","Phường 02","Phường 01"]},{"name":"Quận 10","communes":["Phường 15","Phường 13","Phường 14","Phường 12","Phường 11","Phường 10","Phường 09","Phường 01","Phường 08","Phường 02","Phường 04","Phường 07","Phường 05","Phường 06"]},{"name":"Quận 11","communes":["Phường 15","Phường 05","Phường 14","Phường 11","Phường 03","Phường 10","Phường 13","Phường 08","Phường 09","Phường 12","Phường 07","Phường 06","Phường 04","Phường 01","Phường 02","Phường 16"]},{"name":"Quận 4","communes":["Phường 13","Phường 09","Phường 06","Phường 08","Phường 10","Phường 18","Phường 14","Phường 04","Phường 03","Phường 16","Phường 02","Phường 15","Phường 01"]},{"name":"Quận 5","communes":["Phường 04","Phường 09","Phường 03","Phường 12","Phường 02","Phường 08","Phường 07","Phường 01","Phường 11","Phường 14","Phường 05","Phường 06","Phường 10","Phường 13"]},{"name":"Quận 6","communes":["Phường 14","Phường 13","Phường 09","Phường 06","Phường 12","Phường 05","Phường 11","Phường 02","Phường 01","Phường 04","Phường 08","Phường 03","Phường 07","Phường 10"]},{"name":"Quận 8","communes":["Phường 08","Phường 02","Phường 01","Phường 03","Phường 11","Phường 09","Phường 10","Phường 04","Phường 13","Phường 12","Phường 05","Phường 14","Phường 06","Phường 15","Phường 16","Phường 07"]},{"name":"Quận Bình Tân","communes":["Phường Bình Hưng Hòa","Phường Bình Hưng Hoà A","Phường Bình Hưng Hoà B","Phường Bình Trị Đông","Phường Bình Trị Đông A","Phường Bình Trị Đông B","Phường Tân Tạo","Phường Tân Tạo A","Phường  An Lạc","Phường An Lạc A"]},{"name":"Quận 7","communes":["Phường Tân Thuận Đông","Phường Tân Thuận Tây","Phường Tân Kiểng","Phường Tân Hưng","Phường Bình Thuận","Phường Tân Quy","Phường Phú Thuận","Phường Tân Phú","Phường Tân Phong","Phường Phú Mỹ"]},{"name":"Huyện Củ Chi","communes":["Thị trấn Củ Chi","Xã Phú Mỹ Hưng","Xã An Phú","Xã Trung Lập Thượng","Xã An Nhơn Tây","Xã Nhuận Đức","Xã Phạm Văn Cội","Xã Phú Hòa Đông","Xã Trung Lập Hạ","Xã Trung An","Xã Phước Thạnh","Xã Phước Hiệp","Xã Tân An Hội","Xã Phước Vĩnh An","Xã Thái Mỹ","Xã Tân Thạnh Tây","Xã Hòa Phú","Xã Tân Thạnh Đông","Xã Bình Mỹ","Xã Tân Phú Trung","Xã Tân Thông Hội"]},{"name":"Huyện Hóc Môn","communes":["Thị trấn Hóc Môn","Xã Tân Hiệp","Xã Nhị Bình","Xã Đông Thạnh","Xã Tân Thới Nhì","Xã Thới Tam Thôn","Xã Xuân Thới Sơn","Xã Tân Xuân","Xã Xuân Thới Đông","Xã Trung Chánh","Xã Xuân Thới Thượng","Xã Bà Điểm"]},{"name":"Huyện Bình Chánh","communes":["Thị trấn Tân Túc","Xã Phạm Văn Hai","Xã Vĩnh Lộc A","Xã Vĩnh Lộc B","Xã Bình Lợi","Xã Lê Minh Xuân","Xã Tân Nhựt","Xã Tân Kiên","Xã Bình Hưng","Xã Phong Phú","Xã An Phú Tây","Xã Hưng Long","Xã Đa Phước","Xã Tân Quý Tây","Xã Bình Chánh","Xã Quy Đức"]},{"name":"Huyện Nhà Bè","communes":["Thị trấn Nhà Bè","Xã Phước Kiển","Xã Phước Lộc","Xã Nhơn Đức","Xã Phú Xuân","Xã Long Thới","Xã Hiệp Phước"]},{"name":"Huyện Cần Giờ","communes":["Thị trấn Cần Thạnh","Xã Bình Khánh","Xã Tam Thôn Hiệp","Xã An Thới Đông","Xã Thạnh An","Xã Long Hòa","Xã Lý Nhơn"]}]},{"name":"Tỉnh Long An","districts":[{"name":"Thành phố Tân An","communes":["Phường 5","Phường 2","Phường 4","Phường Tân Khánh","Phường 1","Phường 3","Phường 7","Phường 6","Xã Hướng Thọ Phú","Xã Nhơn Thạnh Trung","Xã Lợi Bình Nhơn","Xã Bình Tâm","Phường Khánh Hậu","Xã An Vĩnh Ngãi"]},{"name":"Thị xã Kiến Tường","communes":["Phường 1","Phường 2","Xã Thạnh Trị","Xã Bình Hiệp","Xã Bình Tân","Xã Tuyên Thạnh","Phường 3","Xã Thạnh Hưng"]},{"name":"Huyện Tân Hưng","communes":["Thị trấn Tân Hưng","Xã Hưng Hà","Xã Hưng Điền B","Xã Hưng Điền","Xã Thạnh Hưng","Xã Hưng Thạnh","Xã Vĩnh Thạnh","Xã Vĩnh Châu B","Xã Vĩnh Lợi","Xã Vĩnh Đại","Xã Vĩnh Châu A","Xã Vĩnh Bửu"]},{"name":"Huyện Vĩnh Hưng","communes":["Thị trấn Vĩnh Hưng","Xã Hưng Điền A","Xã Khánh Hưng","Xã Thái Trị","Xã Vĩnh Trị","Xã Thái Bình Trung","Xã Vĩnh Bình","Xã Vĩnh Thuận","Xã Tuyên Bình","Xã Tuyên Bình Tây"]},{"name":"Huyện Mộc Hóa","communes":["Xã Bình Hòa Tây","Xã Bình Thạnh","Xã Bình Hòa Trung","Xã Bình Hòa Đông","Thị trấn Bình Phong Thạnh","Xã Tân Lập","Xã Tân Thành"]},{"name":"Huyện Tân Thạnh","communes":["Thị trấn Tân Thạnh","Xã Bắc Hòa","Xã Hậu Thạnh Tây","Xã Nhơn Hòa Lập","Xã Tân Lập","Xã Hậu Thạnh Đông","Xã Nhơn Hoà","Xã Kiến Bình","Xã Tân Thành","Xã Tân Bình","Xã Tân Ninh","Xã Nhơn Ninh","Xã Tân Hòa"]},{"name":"Huyện Thạnh Hóa","communes":["Thị trấn Thạnh Hóa","Xã Tân Hiệp","Xã Thuận Bình","Xã Thạnh Phước","Xã Thạnh Phú","Xã Thuận Nghĩa Hòa","Xã Thủy Đông","Xã Thủy Tây","Xã Tân Tây","Xã Tân Đông","Xã Thạnh An"]},{"name":"Huyện Đức Huệ","communes":["Thị trấn Đông Thành","Xã Mỹ Quý Đông","Xã Mỹ Thạnh Bắc","Xã Mỹ Quý Tây","Xã Mỹ Thạnh Tây","Xã Mỹ Thạnh Đông","Xã Bình Thành","Xã Bình Hòa Bắc","Xã Bình Hòa Hưng","Xã Bình Hòa Nam","Xã Mỹ Bình"]},{"name":"Huyện Đức Hòa","communes":["Thị trấn Hậu Nghĩa","Thị trấn Hiệp Hòa","Thị trấn Đức Hòa","Xã Lộc Giang","Xã An Ninh Đông","Xã An Ninh Tây","Xã Tân Mỹ","Xã Hiệp Hòa","Xã Đức Lập Thượng","Xã Đức Lập Hạ","Xã Tân Phú","Xã Mỹ Hạnh Bắc","Xã Đức Hòa Thượng","Xã Hòa Khánh Tây","Xã Hòa Khánh Đông","Xã Mỹ Hạnh Nam","Xã Hòa Khánh Nam","Xã Đức Hòa Đông","Xã Đức Hòa Hạ","Xã Hựu Thạnh"]},{"name":"Huyện Bến Lức","communes":["Thị trấn Bến Lức","Xã Thạnh Lợi","Xã Lương Bình","Xã Thạnh Hòa","Xã Lương Hòa","Xã Tân Hòa","Xã Tân Bửu","Xã An Thạnh","Xã Bình Đức","Xã Mỹ Yên","Xã Thanh Phú","Xã Long Hiệp","Xã Thạnh Đức","Xã Phước Lợi","Xã Nhựt Chánh"]},{"name":"Huyện Thủ Thừa","communes":["Thị trấn Thủ Thừa","Xã Long Thạnh","Xã Tân Thành","Xã Long Thuận","Xã Mỹ Lạc","Xã Mỹ Thạnh","Xã Bình An","Xã Nhị Thành","Xã Mỹ An","Xã Bình Thạnh","Xã Mỹ Phú","Xã Tân Long"]},{"name":"Huyện Tân Trụ","communes":["Thị trấn Tân Trụ","Xã Tân Bình","Xã Quê Mỹ Thạnh","Xã Lạc Tấn","Xã Bình Trinh Đông","Xã Tân Phước Tây","Xã Bình Lãng","Xã Bình Tịnh","Xã Đức Tân","Xã Nhựt Ninh"]},{"name":"Huyện Cần Đước","communes":["Thị trấn Cần Đước","Xã Long Trạch","Xã Long Khê","Xã Long Định","Xã Phước Vân","Xã Long Hòa","Xã Long Cang","Xã Long Sơn","Xã Tân Trạch","Xã Mỹ Lệ","Xã Tân Lân","Xã Phước Tuy","Xã Long Hựu Đông","Xã Tân Ân","Xã Phước Đông","Xã Long Hựu Tây","Xã Tân Chánh"]},{"name":"Huyện Cần Giuộc","communes":["Thị trấn Cần Giuộc","Xã Phước Lý","Xã Long Thượng","Xã Long Hậu","Xã Phước Hậu","Xã Mỹ Lộc","Xã Phước Lại","Xã Phước Lâm","Xã Thuận Thành","Xã Phước Vĩnh Tây","Xã Phước Vĩnh Đông","Xã Long An","Xã Long Phụng","Xã Đông Thạnh","Xã Tân Tập"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Tầm Vu","Xã Bình Quới","Xã Hòa Phú","Xã Phú Ngãi Trị","Xã Vĩnh Công","Xã Thuận Mỹ","Xã Hiệp Thạnh","Xã Phước Tân Hưng","Xã Thanh Phú Long","Xã Dương Xuân Hội","Xã An Lục Long","Xã Long Trì","Xã Thanh Vĩnh Đông"]}]},{"name":"Tỉnh Tiền Giang","districts":[{"name":"Thành phố Mỹ Tho","communes":["Phường 5","Phường 4","Phường 7","Phường 3","Phường 1","Phường 2","Phường 8","Phường 6","Phường 9","Phường 10","Phường Tân Long","Xã Đạo Thạnh","Xã Trung An","Xã Mỹ Phong","Xã Tân Mỹ Chánh","Xã Phước Thạnh","Xã Thới Sơn"]},{"name":"Thị xã Gò Công","communes":["Phường 3","Phường 2","Phường 4","Phường 1","Phường 5","Xã Long Hưng","Xã Long Thuận","Xã Long Chánh","Xã Long Hòa","Xã Bình Đông","Xã Bình Xuân","Xã Tân Trung"]},{"name":"Thị xã Cai Lậy","communes":["Phường 1","Phường 2","Phường 3","Phường 4","Phường 5","Xã Mỹ Phước Tây","Xã Mỹ Hạnh Đông","Xã Mỹ Hạnh Trung","Xã Tân Phú","Xã Tân Bình","Xã Tân Hội","Phường Nhị Mỹ","Xã Nhị Quý","Xã Thanh Hòa","Xã Phú Quý","Xã Long Khánh"]},{"name":"Huyện Tân Phước","communes":["Thị trấn Mỹ Phước","Xã Tân Hòa Đông","Xã Thạnh Tân","Xã Thạnh Mỹ","Xã Thạnh Hoà","Xã Phú Mỹ","Xã Tân Hòa Thành","Xã Hưng Thạnh","Xã Tân Lập 1","Xã Tân Hòa Tây","Xã Tân Lập 2","Xã Phước Lập"]},{"name":"Huyện Cái Bè","communes":["Thị trấn Cái Bè","Xã Hậu Mỹ Bắc B","Xã Hậu Mỹ Bắc A","Xã Mỹ Trung","Xã Hậu Mỹ Trinh","Xã Hậu Mỹ Phú","Xã Mỹ Tân","Xã Mỹ Lợi B","Xã Thiện Trung","Xã Mỹ Hội","Xã An Cư","Xã Hậu Thành","Xã Mỹ Lợi A","Xã Hòa Khánh","Xã Thiện Trí","Xã Mỹ Đức Đông","Xã Mỹ Đức Tây","Xã Đông Hòa Hiệp","Xã An Thái Đông","Xã Tân Hưng","Xã Mỹ Lương","Xã Tân Thanh","Xã An Thái Trung","Xã An Hữu","Xã Hòa Hưng"]},{"name":"Huyện Cai Lậy","communes":["Xã Thạnh Lộc","Xã Mỹ Thành Bắc","Xã Phú Cường","Xã Mỹ Thành Nam","Xã Phú Nhuận","Thị trấn Bình Phú","Xã Cẩm Sơn","Xã Phú An","Xã Mỹ Long","Xã Long Tiên","Xã Hiệp Đức","Xã Long Trung","Xã Hội Xuân","Xã Tân Phong","Xã Tam Bình","Xã Ngũ Hiệp"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Tân Hiệp","Xã Tân Hội Đông","Xã Tân Hương","Xã Tân Lý Đông","Xã Tân Lý Tây","Xã Thân Cửu Nghĩa","Xã Tam Hiệp","Xã Điềm Hy","Xã Nhị Bình","Xã Dưỡng Điềm","Xã Đông Hòa","Xã Long Định","Xã Hữu Đạo","Xã Long An","Xã Long Hưng","Xã Bình Trưng","Xã Thạnh Phú","Xã Bàn Long","Xã Vĩnh Kim","Xã Bình Đức","Xã Song Thuận","Xã Kim Sơn","Xã Phú Phong"]},{"name":"Huyện Chợ Gạo","communes":["Thị trấn Chợ Gạo","Xã Trung Hòa","Xã Hòa Tịnh","Xã Mỹ Tịnh An","Xã Tân Bình Thạnh","Xã Phú Kiết","Xã Lương Hòa Lạc","Xã Thanh Bình","Xã Quơn Long","Xã Bình Phục Nhứt","Xã Đăng Hưng Phước","Xã Tân Thuận Bình","Xã Song Bình","Xã Bình Phan","Xã Long Bình Điền","Xã An Thạnh Thủy","Xã Xuân Đông","Xã Hòa Định","Xã Bình Ninh"]},{"name":"Huyện Gò Công Tây","communes":["Thị trấn Vĩnh Bình","Xã Đồng Sơn","Xã Bình Phú","Xã Đồng Thạnh","Xã Thành Công","Xã Bình Nhì","Xã Yên Luông","Xã Thạnh Trị","Xã Thạnh Nhựt","Xã Long Vĩnh","Xã Bình Tân","Xã Vĩnh Hựu","Xã Long Bình"]},{"name":"Huyện Gò Công Đông","communes":["Thị trấn Tân Hòa","Xã Tăng Hoà","Xã Tân Phước","Xã Gia Thuận","Thị trấn Vàm Láng","Xã Tân Tây","Xã Kiểng Phước","Xã Tân Đông","Xã Bình Ân","Xã Tân Điền","Xã Bình Nghị","Xã Phước Trung","Xã Tân Thành"]},{"name":"Huyện Tân Phú Đông","communes":["Xã Tân Thới","Xã Tân Phú","Xã Phú Thạnh","Xã Tân Thạnh","Xã Phú Đông","Xã Phú Tân"]}]},{"name":"Tỉnh Bến Tre","districts":[{"name":"Thành phố Bến Tre","communes":["Phường Phú Khương","Phường Phú Tân","Phường 8","Phường 6","Phường 4","Phường 5","Phường An Hội","Phường 7","Xã Sơn Đông","Xã Phú Hưng","Xã Bình Phú","Xã Mỹ Thạnh An","Xã Nhơn Thạnh","Xã Phú Nhuận"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Châu Thành","Xã Tân Thạch","Xã Qưới Sơn","Xã An Khánh","Xã Giao Long","Xã Phú Túc","Xã Phú Đức","Xã Phú An Hòa","Xã An Phước","Xã Tam Phước","Xã Thành Triệu","Xã Tường Đa","Xã Tân Phú","Xã Quới Thành","Xã Phước Thạnh","Xã An Hóa","Xã Tiên Long","Xã An Hiệp","Xã Hữu Định","Xã Tiên Thủy","Xã Sơn Hòa"]},{"name":"Huyện Chợ Lách","communes":["Thị trấn Chợ Lách","Xã Phú Phụng","Xã Sơn Định","Xã Vĩnh Bình","Xã Hòa Nghĩa","Xã Long Thới","Xã Phú Sơn","Xã Tân Thiềng","Xã Vĩnh Thành","Xã Vĩnh Hòa","Xã Hưng Khánh Trung B"]},{"name":"Huyện Mỏ Cày Nam","communes":["Thị trấn Mỏ Cày","Xã Định Thủy","Xã Đa Phước Hội","Xã Tân Hội","Xã Phước Hiệp","Xã Bình Khánh ","Xã An Thạnh","Xã An Định","Xã Thành Thới B","Xã Tân Trung","Xã An Thới","Xã Thành Thới A","Xã Minh Đức","Xã Ngãi Đăng","Xã Cẩm Sơn","Xã Hương Mỹ"]},{"name":"Huyện Giồng Trôm","communes":["Thị trấn Giồng Trôm","Xã Phong Nẫm","Xã Mỹ Thạnh","Xã Châu Hòa","Xã Lương Hòa","Xã Lương Quới","Xã Lương Phú","Xã Châu Bình","Xã Thuận Điền","Xã Sơn Phú","Xã Bình Hoà","Xã Phước Long","Xã Hưng Phong","Xã Long Mỹ","Xã Tân Hào","Xã Bình Thành","Xã Tân Thanh","Xã Tân Lợi Thạnh","Xã Thạnh Phú Đông","Xã Hưng Nhượng","Xã Hưng Lễ"]},{"name":"Huyện Bình Đại","communes":["Thị trấn Bình Đại","Xã Tam Hiệp","Xã Long Định","Xã Long Hòa","Xã Phú Thuận","Xã Vang Quới Tây","Xã Vang Quới Đông","Xã Châu Hưng","Xã Phú Vang","Xã Lộc Thuận","Xã Định Trung","Xã Thới Lai","Xã Bình Thới","Xã Phú Long","Xã Bình Thắng","Xã Thạnh Trị","Xã Đại Hòa Lộc","Xã Thừa Đức","Xã Thạnh Phước","Xã Thới Thuận"]},{"name":"Huyện Ba Tri","communes":["Thị trấn Ba Tri","Xã Tân Mỹ","Xã Mỹ Hòa","Xã Tân Xuân","Xã Mỹ Chánh","Xã Bảo Thạnh","Xã An Phú Trung","Xã Mỹ Thạnh","Xã Mỹ Nhơn","Xã Phước Ngãi","Xã An Ngãi Trung","Xã Phú Lễ","Xã An Bình Tây","Xã Bảo Thuận","Xã Tân Hưng","Xã An Ngãi Tây","Xã An Hiệp","Xã Vĩnh Hòa","Xã Tân Thủy","Xã Vĩnh An","Xã An Đức","Xã An Hòa Tây","Xã An Thủy"]},{"name":"Huyện Thạnh Phú","communes":["Thị trấn Thạnh Phú","Xã Phú Khánh","Xã Đại Điền","Xã Quới Điền","Xã Tân Phong","Xã Mỹ Hưng","Xã An Thạnh","Xã Thới Thạnh","Xã Hòa Lợi","Xã An Điền","Xã Bình Thạnh","Xã An Thuận","Xã An Quy","Xã Thạnh Hải","Xã An Nhơn","Xã Giao Thạnh","Xã Thạnh Phong","Xã Mỹ An"]},{"name":"Huyện Mỏ Cày Bắc","communes":["Xã Phú Mỹ","Xã Hưng Khánh Trung A","Xã Thanh Tân","Xã Thạnh Ngãi","Xã Tân Phú Tây","Xã Phước Mỹ Trung","Xã Tân Thành Bình","Xã Thành An","Xã Hòa Lộc","Xã Tân Thanh Tây","Xã Tân Bình","Xã Nhuận Phú Tân","Xã Khánh Thạnh Tân"]}]},{"name":"Tỉnh Trà Vinh","districts":[{"name":"Thành phố Trà Vinh","communes":["Phường 4","Phường 1","Phường 3","Phường 2","Phường 5","Phường 6","Phường 7","Phường 8","Phường 9","Xã Long Đức"]},{"name":"Huyện Càng Long","communes":["Thị trấn Càng Long","Xã Mỹ Cẩm","Xã An Trường A","Xã An Trường","Xã Huyền Hội","Xã Tân An","Xã Tân Bình","Xã Bình Phú","Xã Phương Thạnh","Xã Đại Phúc","Xã Đại Phước","Xã Nhị Long Phú","Xã Nhị Long","Xã Đức Mỹ"]},{"name":"Huyện Cầu Kè","communes":["Thị trấn Cầu Kè","Xã Hòa Ân","Xã Châu Điền","Xã An Phú Tân","Xã Hoà Tân","Xã Ninh Thới","Xã Phong Phú","Xã Phong Thạnh","Xã Tam Ngãi","Xã Thông Hòa","Xã Thạnh Phú"]},{"name":"Huyện Tiểu Cần","communes":["Thị trấn Tiểu Cần","Thị trấn Cầu Quan","Xã Phú Cần","Xã Hiếu Tử","Xã Hiếu Trung","Xã Long Thới","Xã Hùng Hòa","Xã Tân Hùng","Xã Tập Ngãi","Xã Ngãi Hùng","Xã Tân Hòa"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Châu Thành","Xã Đa Lộc","Xã Mỹ Chánh","Xã Thanh Mỹ","Xã Lương Hoà A","Xã Lương Hòa","Xã Song Lộc","Xã Nguyệt Hóa","Xã Hòa Thuận","Xã Hòa Lợi","Xã Phước Hảo","Xã Hưng Mỹ","Xã Hòa Minh","Xã Long Hòa"]},{"name":"Huyện Cầu Ngang","communes":["Thị trấn Cầu Ngang","Thị trấn Mỹ Long","Xã Mỹ Long Bắc","Xã Mỹ Long Nam","Xã Mỹ Hòa","Xã Vĩnh Kim","Xã Kim Hòa","Xã Hiệp Hòa","Xã Thuận Hòa","Xã Long Sơn","Xã Nhị Trường","Xã Trường Thọ","Xã Hiệp Mỹ Đông","Xã Hiệp Mỹ Tây","Xã Thạnh Hòa Sơn"]},{"name":"Huyện Trà Cú","communes":["Thị trấn Trà Cú","Thị trấn Định An","Xã Phước Hưng","Xã Tập Sơn","Xã Tân Sơn","Xã An Quảng Hữu","Xã Lưu Nghiệp Anh","Xã Ngãi Xuyên","Xã Kim Sơn","Xã Thanh Sơn","Xã Hàm Giang","Xã Hàm Tân","Xã Đại An","Xã Định An","Xã Ngọc Biên","Xã Long Hiệp","Xã Tân Hiệp"]},{"name":"Huyện Duyên Hải","communes":["Xã Đôn Xuân","Xã Đôn Châu","Thị trấn Long Thành","Xã Long Khánh","Xã Ngũ Lạc","Xã Long Vĩnh","Xã Đông Hải"]},{"name":"Thị xã Duyên Hải","communes":["Phường 1","Xã Long Toàn","Phường 2","Xã Long Hữu","Xã Dân Thành","Xã Trường Long Hòa","Xã Hiệp Thạnh"]}]},{"name":"Tỉnh Vĩnh Long","districts":[{"name":"Thành phố Vĩnh Long","communes":["Phường 9","Phường 5","Phường 1","Phường 2","Phường 4","Phường 3","Phường 8","Phường Tân Ngãi","Phường Tân Hòa","Phường Tân Hội","Phường Trường An"]},{"name":"Huyện Long Hồ","communes":["Thị trấn Long Hồ","Xã Đồng Phú","Xã Bình Hòa Phước","Xã Hòa Ninh","Xã An Bình","Xã Thanh Đức","Xã Tân Hạnh","Xã Phước Hậu","Xã Long Phước","Xã Phú Đức","Xã Lộc Hòa","Xã Long An","Xã Phú Quới","Xã Thạnh Quới","Xã Hòa Phú"]},{"name":"Huyện Mang Thít","communes":["Xã Mỹ An","Xã Mỹ Phước","Xã An Phước","Xã Nhơn Phú","Xã Long Mỹ","Xã Hòa Tịnh","Thị trấn Cái Nhum","Xã Bình Phước","Xã Chánh An","Xã Tân An Hội","Xã Tân Long","Xã Tân Long Hội"]},{"name":"Huyện  Vũng Liêm","communes":["Thị trấn Vũng Liêm","Xã Tân Quới Trung","Xã Quới Thiện","Xã Quới An","Xã Trung Chánh","Xã Tân An Luông","Xã Thanh Bình","Xã Trung Thành Tây","Xã Trung Hiệp","Xã Hiếu Phụng","Xã Trung Thành Đông","Xã Trung Thành","Xã Trung Hiếu","Xã Trung Ngãi","Xã Hiếu Thuận","Xã Trung Nghĩa","Xã Trung An","Xã Hiếu Nhơn","Xã Hiếu Thành","Xã Hiếu Nghĩa"]},{"name":"Huyện Tam Bình","communes":["Thị trấn Tam Bình","Xã Tân Lộc","Xã Phú Thịnh","Xã Hậu Lộc","Xã Hòa Thạnh","Xã Hoà Lộc","Xã Phú Lộc","Xã Song Phú","Xã Hòa Hiệp","Xã Mỹ Lộc","Xã Tân Phú","Xã Long Phú","Xã Mỹ Thạnh Trung","Xã Tường Lộc","Xã Loan Mỹ","Xã Ngãi Tứ","Xã Bình Ninh"]},{"name":"Thị xã Bình Minh","communes":["Phường Cái Vồn","Phường Thành Phước","Xã Thuận An","Xã Đông Thạnh","Xã Đông Bình","Phường Đông Thuận","Xã Mỹ Hòa","Xã Đông Thành"]},{"name":"Huyện Trà Ôn","communes":["Thị trấn Trà Ôn","Xã Xuân Hiệp","Xã Nhơn Bình","Xã Hòa Bình","Xã Thới Hòa","Xã Trà Côn","Xã Tân Mỹ","Xã Hựu Thành","Xã Vĩnh Xuân","Xã Thuận Thới","Xã Phú Thành","Xã Thiện Mỹ","Xã Lục Sỹ Thành","Xã Tích Thiện"]},{"name":"Huyện Bình Tân","communes":["Xã Tân Hưng","Xã Tân Thành","Xã Thành Trung","Xã Tân An Thạnh","Xã Tân Lược","Xã Nguyễn Văn Thảnh","Xã Thành Lợi","Xã Mỹ Thuận","Xã Tân Bình","Thị trấn Tân Quới"]}]},{"name":"Tỉnh Đồng Tháp","districts":[{"name":"Thành phố Cao Lãnh","communes":["Phường 11","Phường 1","Phường 2","Phường 4","Phường 3","Phường 6","Xã Mỹ Ngãi","Xã Mỹ Tân","Xã Mỹ Trà","Phường Mỹ Phú","Xã Tân Thuận Tây","Phường Hoà Thuận","Xã Hòa An","Xã Tân Thuận Đông","Xã Tịnh Thới"]},{"name":"Thành phố Sa Đéc","communes":["Phường 3","Phường 1","Phường 4","Phường 2","Xã Tân Khánh Đông","Phường Tân Quy Đông","Phường An Hoà","Xã Tân Quy Tây","Xã Tân Phú Đông"]},{"name":"Thành phố Hồng Ngự","communes":["Phường An Lộc","Phường An Thạnh","Xã Bình Thạnh","Xã Tân Hội","Phường An Lạc","Phường An Bình B","Phường An Bình A"]},{"name":"Huyện Tân Hồng","communes":["Thị trấn Sa Rài","Xã Tân Hộ Cơ","Xã Thông Bình","Xã Bình Phú","Xã Tân Thành A","Xã Tân Thành B","Xã Tân Phước","Xã Tân Công Chí","Xã An Phước"]},{"name":"Huyện Hồng Ngự","communes":["Xã Thường Phước 1","Xã Thường Thới Hậu A","Thị trấn Thường Thới Tiền","Xã Thường Phước 2","Xã Thường Lạc","Xã Long Khánh A","Xã Long Khánh B","Xã Long Thuận","Xã Phú Thuận B","Xã Phú Thuận A"]},{"name":"Huyện Tam Nông","communes":["Thị trấn Tràm Chim","Xã Hoà Bình","Xã Tân Công Sính","Xã Phú Hiệp","Xã Phú Đức","Xã Phú Thành B","Xã An Hòa","Xã An Long","Xã Phú Cường","Xã Phú Ninh","Xã Phú Thọ","Xã Phú Thành A"]},{"name":"Huyện Tháp Mười","communes":["Thị trấn Mỹ An","Xã Thạnh Lợi","Xã Hưng Thạnh","Xã Trường Xuân","Xã Tân Kiều","Xã Mỹ Hòa","Xã Mỹ Quý","Xã Mỹ Đông","Xã Đốc Binh Kiều","Xã Mỹ An","Xã Phú Điền","Xã Láng Biển","Xã Thanh Mỹ"]},{"name":"Huyện Cao Lãnh","communes":["Thị trấn Mỹ Thọ","Xã Gáo Giồng","Xã Phương Thịnh","Xã Ba Sao","Xã Phong Mỹ","Xã Tân Nghĩa","Xã Phương Trà","Xã Nhị Mỹ","Xã Mỹ Thọ","Xã Tân Hội Trung","Xã An Bình","Xã Mỹ Hội","Xã Mỹ Hiệp","Xã Mỹ Long","Xã Bình Hàng Trung","Xã Mỹ Xương","Xã Bình Hàng Tây","Xã Bình Thạnh"]},{"name":"Huyện Thanh Bình","communes":["Thị trấn Thanh Bình","Xã Tân Quới","Xã Tân Hòa","Xã An Phong","Xã Phú Lợi","Xã Tân Mỹ","Xã Bình Tấn","Xã Tân Huề","Xã Tân Bình","Xã Tân Thạnh","Xã Tân Phú","Xã Bình Thành","Xã Tân Long"]},{"name":"Huyện Lấp Vò","communes":["Thị trấn Lấp Vò","Xã Mỹ An Hưng A","Xã Tân Mỹ","Xã Mỹ An Hưng B","Xã Tân  Khánh Trung","Xã Long Hưng A","Xã Vĩnh Thạnh","Xã Long Hưng B","Xã Bình Thành","Xã Định An","Xã Định Yên","Xã Hội An Đông","Xã Bình Thạnh Trung"]},{"name":"Huyện Lai Vung","communes":["Thị trấn Lai Vung","Xã Tân Dương","Xã Hòa Thành","Xã Long Hậu","Xã Tân Phước","Xã Hòa Long","Xã Tân Thành","Xã Long Thắng","Xã Vĩnh Thới","Xã Tân Hòa","Xã Định Hòa","Xã Phong Hòa"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Cái Tàu Hạ","Xã An Hiệp","Xã An Nhơn","Xã Tân Nhuận Đông","Xã Tân Bình","Xã Tân Phú Trung","Xã Phú Long","Xã An Phú Thuận","Xã Phú Hựu","Xã An Khánh","Xã Tân Phú","Xã Hòa Tân"]}]},{"name":"Tỉnh An Giang","districts":[{"name":"Thành phố Long Xuyên","communes":["Phường Mỹ Bình","Phường Mỹ Long","Phường Đông Xuyên","Phường Mỹ Xuyên","Phường Bình Đức","Phường Bình Khánh","Phường Mỹ Phước","Phường Mỹ Quý","Phường Mỹ Thới","Phường Mỹ Thạnh","Phường Mỹ Hòa","Xã Mỹ Khánh","Xã Mỹ Hoà Hưng"]},{"name":"Thành phố Châu Đốc","communes":["Phường Châu Phú B","Phường Châu Phú A","Phường Vĩnh Mỹ","Phường Núi Sam","Phường Vĩnh Ngươn","Xã Vĩnh Tế","Xã Vĩnh Châu"]},{"name":"Huyện An Phú","communes":["Thị trấn An Phú","Xã Khánh An","Thị Trấn Long Bình","Xã Khánh Bình","Xã Quốc Thái","Xã Nhơn Hội","Xã Phú Hữu","Xã Phú Hội","Xã Phước Hưng","Xã Vĩnh Lộc","Xã Vĩnh Hậu","Xã Vĩnh Trường","Xã Vĩnh Hội Đông","Xã Đa Phước"]},{"name":"Thị xã Tân Châu","communes":["Phường Long Thạnh","Phường Long Hưng","Phường Long Châu","Xã Phú Lộc","Xã Vĩnh Xương","Xã Vĩnh Hòa","Xã Tân Thạnh","Xã Tân An","Xã Long An","Phường Long Phú","Xã Châu Phong","Xã Phú Vĩnh","Xã Lê Chánh","Phường Long Sơn"]},{"name":"Huyện Phú Tân","communes":["Thị trấn Phú Mỹ","Thị trấn Chợ Vàm","Xã Long Hoà","Xã Phú Long","Xã Phú Lâm","Xã Phú Hiệp","Xã Phú Thạnh","Xã Hoà Lạc","Xã Phú Thành","Xã Phú An","Xã Phú Xuân","Xã Hiệp Xương","Xã Phú Bình","Xã Phú Thọ","Xã Phú Hưng","Xã Bình Thạnh Đông","Xã Tân Hòa","Xã Tân Trung"]},{"name":"Huyện Châu Phú","communes":["Thị trấn Cái Dầu","Xã Khánh Hòa","Xã Mỹ Đức","Xã Mỹ Phú","Xã Ô Long Vỹ","Thị trấn Vĩnh Thạnh Trung","Xã Thạnh Mỹ Tây","Xã Bình Long","Xã Bình Mỹ","Xã Bình Thủy","Xã Đào Hữu Cảnh","Xã Bình Phú","Xã Bình Chánh"]},{"name":"Thị xã Tịnh Biên","communes":["Thị trấn Nhà Bàng","Thị trấn Chi Lăng","Xã Núi Voi","Xã Nhơn Hưng","Xã An Phú","Xã Thới Sơn","Thị trấn Tịnh Biên","Xã Văn Giáo","Xã An Cư","Xã An Nông","Xã Vĩnh Trung","Xã Tân Lợi","Xã An Hảo","Xã Tân Lập"]},{"name":"Huyện Tri Tôn","communes":["Thị trấn Tri Tôn","Thị trấn Ba Chúc","Xã Lạc Quới","Xã Lê Trì","Xã Vĩnh Gia","Xã Vĩnh Phước","Xã Châu Lăng","Xã Lương Phi","Xã Lương An Trà","Xã Tà Đảnh","Xã Núi Tô","Xã An Tức","Thị trấn Cô Tô","Xã Tân Tuyến","Xã Ô Lâm"]},{"name":"Huyện Châu Thành","communes":["Thị trấn An Châu","Xã An Hòa","Xã Cần Đăng","Xã Vĩnh Hanh","Xã Bình Thạnh","Thị trấn Vĩnh Bình","Xã Bình Hòa","Xã Vĩnh An","Xã Hòa Bình Thạnh","Xã Vĩnh Lợi","Xã Vĩnh Nhuận","Xã Tân Phú","Xã Vĩnh Thành"]},{"name":"Huyện Chợ Mới","communes":["Thị trấn Chợ Mới","Thị trấn Mỹ Luông","Xã Kiến An","Xã Mỹ Hội Đông","Xã Long Điền A","Xã Tấn Mỹ","Xã Long Điền B","Xã Kiến Thành","Xã Mỹ Hiệp","Xã Mỹ An","Xã Nhơn Mỹ","Xã Long Giang","Xã Long Kiến","Xã Bình Phước Xuân","Xã An Thạnh Trung","Xã Hội An","Xã Hòa Bình","Xã Hòa An"]},{"name":"Huyện Thoại Sơn","communes":["Thị trấn Núi Sập","Thị trấn Phú Hoà","Thị Trấn Óc Eo","Xã Tây Phú","Xã An Bình","Xã Vĩnh Phú","Xã Vĩnh Trạch","Xã Phú Thuận","Xã Vĩnh Chánh","Xã Định Mỹ","Xã Định Thành","Xã Mỹ Phú Đông","Xã Vọng Đông","Xã Vĩnh Khánh","Xã Thoại Giang","Xã Bình Thành","Xã Vọng Thê"]}]},{"name":"Tỉnh Kiên Giang","districts":[{"name":"Thành phố Rạch Giá","communes":["Phường Vĩnh Thanh Vân","Phường Vĩnh Thanh","Phường Vĩnh Quang","Phường Vĩnh Hiệp","Phường Vĩnh Bảo","Phường Vĩnh Lạc","Phường An Hòa","Phường An Bình","Phường Rạch Sỏi","Phường Vĩnh Lợi","Phường Vĩnh Thông","Xã Phi Thông"]},{"name":"Thành phố Hà Tiên","communes":["Phường Tô Châu","Phường Đông Hồ","Phường Bình San","Phường Pháo Đài","Phường Mỹ Đức","Xã Tiên Hải","Xã Thuận Yên"]},{"name":"Huyện Kiên Lương","communes":["Thị trấn Kiên Lương","Xã Kiên Bình","Xã Hòa Điền","Xã Dương Hòa","Xã Bình An","Xã Bình Trị","Xã Sơn Hải","Xã Hòn Nghệ"]},{"name":"Huyện Hòn Đất","communes":["Thị trấn Hòn Đất","Thị trấn Sóc Sơn","Xã Bình Sơn","Xã Bình Giang","Xã Mỹ Thái","Xã Nam Thái Sơn","Xã Mỹ Hiệp Sơn","Xã Sơn Kiên","Xã Sơn Bình","Xã Mỹ Thuận","Xã Lình Huỳnh","Xã Thổ Sơn","Xã Mỹ Lâm","Xã Mỹ Phước"]},{"name":"Huyện Tân Hiệp","communes":["Thị trấn Tân Hiệp","Xã Tân Hội","Xã Tân Thành","Xã Tân Hiệp B","Xã Tân Hoà","Xã Thạnh Đông B","Xã Thạnh Đông","Xã Tân Hiệp A","Xã Tân An","Xã Thạnh Đông A","Xã Thạnh Trị"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Minh Lương","Xã Mong Thọ A","Xã Mong Thọ B","Xã Mong Thọ","Xã Giục Tượng","Xã Vĩnh Hòa Hiệp","Xã Vĩnh Hoà Phú","Xã Minh Hòa","Xã Bình An","Xã Thạnh Lộc"]},{"name":"Huyện Giồng Riềng","communes":["Thị Trấn Giồng Riềng","Xã Thạnh Hưng","Xã Thạnh Phước","Xã Thạnh Lộc","Xã Thạnh Hòa","Xã Thạnh Bình","Xã Bàn Thạch","Xã Bàn Tân Định","Xã Ngọc Thành","Xã Ngọc Chúc","Xã Ngọc Thuận","Xã Hòa Hưng","Xã Hoà Lợi","Xã Hoà An","Xã Long Thạnh","Xã Vĩnh Thạnh","Xã Vĩnh Phú","Xã  Hòa Thuận","Xã Ngọc Hoà"]},{"name":"Huyện Gò Quao","communes":["Thị trấn Gò Quao","Xã Vĩnh Hòa Hưng Bắc","Xã Định Hòa","Xã Thới Quản","Xã Định An","Xã Thủy Liễu","Xã Vĩnh Hòa Hưng Nam","Xã Vĩnh Phước A","Xã Vĩnh Phước B","Xã Vĩnh Tuy","Xã Vĩnh Thắng"]},{"name":"Huyện An Biên","communes":["Thị trấn Thứ Ba","Xã Tây Yên","Xã Tây Yên A","Xã Nam Yên","Xã Hưng Yên","Xã Nam Thái","Xã Nam Thái A","Xã Đông Thái","Xã Đông Yên"]},{"name":"Huyện An Minh","communes":["Thị trấn Thứ Mười Một","Xã Thuận Hoà","Xã Đông Hòa","Xã Đông Thạnh","Xã Tân Thạnh","Xã Đông Hưng","Xã Đông Hưng A","Xã Đông Hưng B","Xã Vân Khánh","Xã Vân Khánh Đông","Xã Vân Khánh Tây"]},{"name":"Huyện Vĩnh Thuận","communes":["Thị trấn Vĩnh Thuận","Xã Vĩnh Bình Bắc","Xã Vĩnh Bình Nam","Xã Bình Minh","Xã Vĩnh Thuận","Xã Tân Thuận","Xã Phong Đông","Xã Vĩnh Phong"]},{"name":"Thành phố Phú Quốc","communes":["Phường Dương Đông","Phường An Thới","Xã Cửa Cạn","Xã Gành Dầu","Xã Cửa Dương","Xã Hàm Ninh","Xã Dương Tơ","Xã Bãi Thơm","Xã Thổ Châu"]},{"name":"Huyện Kiên Hải","communes":["Xã Hòn Tre","Xã Lại Sơn","Xã An Sơn","Xã Nam Du"]},{"name":"Huyện U Minh Thượng","communes":["Xã Thạnh Yên","Xã Thạnh Yên A","Xã An Minh Bắc","Xã Vĩnh Hòa","Xã Hoà Chánh","Xã Minh Thuận"]},{"name":"Huyện Giang Thành","communes":["Xã Vĩnh Phú","Xã Vĩnh Điều","Xã Tân Khánh Hòa","Xã Phú Lợi","Xã Phú Mỹ"]}]},{"name":"Thành phố Cần Thơ","districts":[{"name":"Quận Ninh Kiều","communes":["Phường Cái Khế","Phường An Hòa","Phường Thới Bình","Phường An Nghiệp","Phường An Cư","Phường Tân An","Phường An Phú","Phường Xuân Khánh","Phường Hưng Lợi","Phường An Khánh","Phường An Bình"]},{"name":"Quận Ô Môn","communes":["Phường Châu Văn Liêm","Phường Thới Hòa","Phường Thới Long","Phường Long Hưng","Phường Thới An","Phường Phước Thới","Phường Trường Lạc"]},{"name":"Quận Bình Thuỷ","communes":["Phường Bình Thủy","Phường Trà An","Phường Trà Nóc","Phường Thới An Đông","Phường An Thới","Phường Bùi Hữu Nghĩa","Phường Long Hòa","Phường Long Tuyền"]},{"name":"Quận Cái Răng","communes":["Phường Lê Bình","Phường Hưng Phú","Phường Hưng Thạnh","Phường Ba Láng","Phường Thường Thạnh","Phường Phú Thứ","Phường Tân Phú"]},{"name":"Quận Thốt Nốt","communes":["Phường Thốt Nốt","Phường Thới Thuận","Phường Thuận An","Phường Tân Lộc","Phường Trung Nhứt","Phường Thạnh Hoà","Phường Trung Kiên","Phường Tân Hưng","Phường Thuận Hưng"]},{"name":"Huyện Vĩnh Thạnh","communes":["Xã Vĩnh Bình","Thị trấn Thanh An","Thị trấn Vĩnh Thạnh","Xã Thạnh Mỹ","Xã Vĩnh Trinh","Xã Thạnh An","Xã Thạnh Tiến","Xã Thạnh Thắng","Xã Thạnh Lợi","Xã Thạnh Qưới","Xã Thạnh Lộc"]},{"name":"Huyện Cờ Đỏ","communes":["Xã Trung An","Xã Trung Thạnh","Xã Thạnh Phú","Xã Trung Hưng","Thị trấn Cờ Đỏ","Xã Thới Hưng","Xã Đông Hiệp","Xã Đông Thắng","Xã Thới Đông","Xã Thới Xuân"]},{"name":"Huyện Phong Điền","communes":["Thị trấn Phong Điền","Xã Nhơn Ái","Xã Giai Xuân","Xã Tân Thới","Xã Trường Long","Xã Mỹ Khánh","Xã Nhơn Nghĩa"]},{"name":"Huyện Thới Lai","communes":["Thị trấn Thới Lai","Xã Thới Thạnh","Xã Tân Thạnh","Xã Xuân Thắng","Xã Đông Bình","Xã Đông Thuận","Xã Thới Tân","Xã Trường Thắng","Xã Định Môn","Xã Trường Thành","Xã Trường Xuân","Xã Trường Xuân A","Xã Trường Xuân B"]}]},{"name":"Tỉnh Hậu Giang","districts":[{"name":"Thành phố Vị Thanh","communes":["Phường I","Phường III","Phường IV","Phường V","Phường VII","Xã Vị Tân","Xã Hoả Lựu","Xã Tân Tiến","Xã Hoả Tiến"]},{"name":"Thành phố Ngã Bảy","communes":["Phường Ngã Bảy","Phường Lái Hiếu","Phường Hiệp Thành","Phường Hiệp Lợi","Xã Đại Thành","Xã Tân Thành"]},{"name":"Huyện Châu Thành A","communes":["Thị trấn Một Ngàn","Xã Tân Hoà","Thị trấn Bảy Ngàn","Xã Trường Long Tây","Xã Trường Long A","Xã Nhơn Nghĩa A","Thị trấn Rạch Gòi","Xã Thạnh Xuân","Thị trấn Cái Tắc","Xã Tân Phú Thạnh"]},{"name":"Huyện Châu Thành","communes":["Thị Trấn Ngã Sáu","Xã Đông Thạnh","Xã Đông Phú","Xã Phú Hữu","Xã Phú Tân","Thị trấn Mái Dầm","Xã Đông Phước","Xã Đông Phước A"]},{"name":"Huyện Phụng Hiệp","communes":["Thị trấn Kinh Cùng","Thị trấn Cây Dương","Xã Tân Bình","Xã Bình Thành","Xã Thạnh Hòa","Xã Long Thạnh","Xã Phụng Hiệp","Xã Hòa Mỹ","Xã Hòa An","Xã Phương Bình","Xã Hiệp Hưng","Xã Tân Phước Hưng","Thị trấn Búng Tàu","Xã Phương Phú","Xã Tân Long"]},{"name":"Huyện Vị Thuỷ","communes":["Thị trấn Nàng Mau","Xã Vị Trung","Xã Vị Thuỷ","Xã Vị Thắng","Xã Vĩnh Thuận Tây","Xã Vĩnh Trung","Xã Vĩnh Tường","Xã Vị Đông","Xã Vị Thanh","Xã Vị Bình"]},{"name":"Huyện Long Mỹ","communes":["Xã Thuận Hưng","Xã Thuận Hòa","Xã Vĩnh Thuận Đông","Thị trấn Vĩnh Viễn","Xã Vĩnh Viễn A","Xã Lương Tâm","Xã Lương Nghĩa","Xã Xà Phiên"]},{"name":"Thị xã Long Mỹ","communes":["Phường Thuận An","Phường Trà Lồng","Phường Bình Thạnh","Xã Long Bình","Phường Vĩnh Tường","Xã Long Trị","Xã Long Trị A","Xã Long Phú","Xã Tân Phú"]}]},{"name":"Tỉnh Sóc Trăng","districts":[{"name":"Thành phố Sóc Trăng","communes":["Phường 5","Phường 7","Phường 8","Phường 6","Phường 2","Phường 1","Phường 4","Phường 3","Phường 9","Phường 10"]},{"name":"Huyện Châu Thành","communes":["Thị trấn Châu Thành","Xã Hồ Đắc Kiện","Xã Phú Tâm","Xã Thuận Hòa","Xã Phú Tân","Xã Thiện Mỹ","Xã An Hiệp","Xã An Ninh"]},{"name":"Huyện Kế Sách","communes":["Thị trấn Kế Sách","Thị trấn An Lạc Thôn","Xã Xuân Hòa","Xã Phong Nẫm","Xã An Lạc Tây","Xã Trinh Phú","Xã Ba Trinh","Xã Thới An Hội","Xã Nhơn Mỹ","Xã Kế Thành","Xã Kế An","Xã Đại Hải","Xã An Mỹ"]},{"name":"Huyện Mỹ Tú","communes":["Thị trấn Huỳnh Hữu Nghĩa","Xã Long Hưng","Xã Hưng Phú","Xã Mỹ Hương","Xã Mỹ Tú","Xã Mỹ Phước","Xã Thuận Hưng","Xã Mỹ Thuận","Xã Phú Mỹ"]},{"name":"Huyện Cù Lao Dung","communes":["Thị trấn Cù Lao Dung","Xã An Thạnh 1","Xã An Thạnh Tây","Xã An Thạnh Đông","Xã Đại Ân 1","Xã An Thạnh 2","Xã An Thạnh 3","Xã An Thạnh Nam"]},{"name":"Huyện Long Phú","communes":["Thị trấn Long Phú","Xã Song Phụng","Thị trấn Đại Ngãi","Xã Hậu Thạnh","Xã Long Đức","Xã Trường Khánh","Xã Phú Hữu","Xã Tân Hưng","Xã Châu Khánh","Xã Tân Thạnh","Xã Long Phú"]},{"name":"Huyện Mỹ Xuyên","communes":["Thị trấn Mỹ Xuyên","Xã Đại Tâm","Xã Tham Đôn","Xã Thạnh Phú","Xã Ngọc Đông","Xã Thạnh Quới","Xã Hòa Tú 1","Xã Gia Hòa 1","Xã Ngọc Tố","Xã Gia Hòa 2","Xã Hòa Tú II"]},{"name":"Thị xã Ngã Năm","communes":["Phường 1","Phường 2","Xã Vĩnh Quới","Xã Tân Long","Xã Long Bình","Phường 3","Xã Mỹ Bình","Xã Mỹ Quới"]},{"name":"Huyện Thạnh Trị","communes":["Thị trấn Phú Lộc","Thị trấn Hưng Lợi","Xã Lâm Tân","Xã Thạnh Tân","Xã Lâm Kiết","Xã Tuân Tức","Xã Vĩnh Thành","Xã Thạnh Trị","Xã Vĩnh Lợi","Xã Châu Hưng"]},{"name":"Thị xã Vĩnh Châu","communes":["Phường 1","Xã Hòa Đông","Phường Khánh Hòa","Xã Vĩnh Hiệp","Xã Vĩnh Hải","Xã Lạc Hòa","Phường 2","Phường Vĩnh Phước","Xã Vĩnh Tân","Xã Lai Hòa"]},{"name":"Huyện Trần Đề","communes":["Xã Đại Ân  2","Thị trấn Trần Đề","Xã Liêu Tú","Xã Lịch Hội Thượng","Thị trấn Lịch Hội Thượng","Xã Trung Bình","Xã Tài Văn","Xã Viên An","Xã Thạnh Thới An","Xã Thạnh Thới Thuận","Xã Viên Bình"]}]},{"name":"Tỉnh Bạc Liêu","districts":[{"name":"Thành phố Bạc Liêu","communes":["Phường 2","Phường 3","Phường 5","Phường 7","Phường 1","Phường 8","Phường Nhà Mát","Xã Vĩnh Trạch","Xã Vĩnh Trạch Đông","Xã Hiệp Thành"]},{"name":"Huyện Hồng Dân","communes":["Thị trấn Ngan Dừa","Xã Ninh Quới","Xã Ninh Quới A","Xã Ninh Hòa","Xã Lộc Ninh","Xã Vĩnh Lộc","Xã Vĩnh Lộc A","Xã Ninh Thạnh Lợi A","Xã Ninh Thạnh Lợi"]},{"name":"Huyện Phước Long","communes":["Thị trấn Phước Long","Xã Vĩnh Phú Đông","Xã Vĩnh Phú Tây","Xã Phước Long","Xã Hưng Phú","Xã Vĩnh Thanh","Xã Phong Thạnh Tây A","Xã Phong Thạnh Tây B"]},{"name":"Huyện Vĩnh Lợi","communes":["Xã Vĩnh Hưng","Xã Vĩnh Hưng A","Thị trấn Châu Hưng","Xã Châu Hưng A","Xã Hưng Thành","Xã Hưng Hội","Xã Châu Thới","Xã Long Thạnh"]},{"name":"Thị xã Giá Rai","communes":["Phường 1","Phường Hộ Phòng","Xã Phong Thạnh Đông","Phường Láng Tròn","Xã Phong Tân","Xã Tân Phong","Xã Phong Thạnh","Xã Phong Thạnh A","Xã Phong Thạnh Tây","Xã Tân Thạnh"]},{"name":"Huyện Đông Hải","communes":["Thị trấn Gành Hào","Xã Long Điền Đông","Xã Long Điền Đông A","Xã Long Điền","Xã Long Điền Tây","Xã Điền Hải","Xã An Trạch","Xã An Trạch A","Xã An Phúc","Xã Định Thành","Xã Định Thành A"]},{"name":"Huyện Hoà Bình","communes":["Thị trấn Hòa Bình","Xã Minh Diệu","Xã Vĩnh Bình","Xã Vĩnh Mỹ B","Xã Vĩnh Hậu","Xã Vĩnh Hậu A","Xã Vĩnh Mỹ A","Xã Vĩnh Thịnh"]}]},{"name":"Tỉnh Cà Mau","districts":[{"name":"Thành phố Cà Mau","communes":["Phường 9","Phường 4","Phường 1","Phường 5","Phường 2","Phường 8","Phường 6","Phường 7","Phường Tân Xuyên","Xã An Xuyên","Phường Tân Thành","Xã Tân Thành","Xã Tắc Vân","Xã Lý Văn Lâm","Xã Định Bình","Xã Hòa Thành","Xã Hòa Tân"]},{"name":"Huyện U Minh","communes":["Thị trấn U Minh","Xã Khánh Hòa","Xã Khánh Thuận","Xã Khánh Tiến","Xã Nguyễn Phích","Xã Khánh Lâm","Xã Khánh An","Xã Khánh Hội"]},{"name":"Huyện Thới Bình","communes":["Thị trấn Thới Bình","Xã Biển Bạch","Xã Tân Bằng","Xã Trí Phải","Xã Trí Lực","Xã Biển Bạch Đông","Xã Thới Bình","Xã Tân Phú","Xã Tân Lộc Bắc","Xã Tân Lộc","Xã Tân Lộc Đông","Xã Hồ Thị Kỷ"]},{"name":"Huyện Trần Văn Thời","communes":["Thị trấn Trần Văn Thời","Thị trấn Sông Đốc","Xã Khánh Bình Tây Bắc","Xã Khánh Bình Tây","Xã Trần Hợi","Xã Khánh Lộc","Xã Khánh Bình","Xã Khánh Hưng","Xã Khánh Bình Đông","Xã Khánh Hải","Xã Lợi An","Xã Phong Điền","Xã Phong Lạc"]},{"name":"Huyện Cái Nước","communes":["Thị trấn Cái Nước","Xã Thạnh Phú","Xã Lương Thế Trân","Xã Phú Hưng","Xã Tân Hưng","Xã Hưng Mỹ","Xã Hoà Mỹ","Xã Đông Hưng","Xã Đông Thới","Xã Tân Hưng Đông","Xã Trần Thới"]},{"name":"Huyện Đầm Dơi","communes":["Thị trấn Đầm Dơi","Xã Tạ An Khương","Xã Tạ An Khương  Đông","Xã Trần Phán","Xã Tân Trung","Xã Tân Đức","Xã Tân Thuận","Xã Tạ An Khương  Nam","Xã Tân Duyệt","Xã Tân Dân","Xã Tân Tiến","Xã Quách Phẩm Bắc","Xã Quách Phẩm","Xã Thanh Tùng","Xã Ngọc Chánh","Xã Nguyễn Huân"]},{"name":"Huyện Năm Căn","communes":["Thị Trấn Năm Căn","Xã Hàm Rồng","Xã Hiệp Tùng","Xã Đất Mới","Xã Lâm Hải","Xã Hàng Vịnh","Xã Tam Giang","Xã Tam Giang Đông"]},{"name":"Huyện Phú Tân","communes":["Thị trấn Cái Đôi Vàm","Xã Phú Thuận","Xã Phú Mỹ","Xã Phú Tân","Xã Tân Hải","Xã Việt Thắng","Xã Tân Hưng Tây","Xã Rạch Chèo","Xã Nguyễn Việt Khái"]},{"name":"Huyện Ngọc Hiển","communes":["Xã Tam Giang Tây","Xã Tân Ân Tây","Xã Viên An Đông","Xã Viên An","Thị trấn Rạch Gốc","Xã Tân Ân","Xã Đất Mũi"]}]}]
</file>

<file path="src/docs/JOB_ALERTS_FEATURE.md">
# Tính năng Quản lý Thông báo Việc làm

## 📋 Tổng quan

Tính năng cho phép người dùng đăng ký nhận thông báo khi có việc làm phù hợp với tiêu chí của họ. Mỗi user có thể tạo tối đa 3 thông báo việc làm.

## 🎯 Các tính năng chính

### 1. Quản lý Thông báo
- **Tạo thông báo mới**: Người dùng có thể tạo thông báo với các bộ lọc chi tiết
- **Chỉnh sửa thông báo**: Cập nhật tiêu chí của thông báo đã tạo
- **Xóa thông báo**: Xóa thông báo không còn cần thiết
- **Bật/Tắt thông báo**: Tạm dừng hoặc kích hoạt lại thông báo

### 2. Bộ lọc thông báo
- **Từ khóa**: Tìm kiếm theo từ khóa (tùy chọn)
- **Địa điểm**: Tỉnh/Thành phố và Quận/Huyện
- **Ngành nghề**: 25+ ngành nghề khác nhau
- **Kinh nghiệm**: Từ Intern đến Executive
- **Mức lương**: 5 khoảng lương khác nhau
- **Loại hình công việc**: Full-time, Part-time, Contract, etc.
- **Hình thức làm việc**: On-site, Remote, Hybrid
- **Tần suất nhận**: Hàng ngày hoặc hàng tuần
- **Phương thức nhận**: Trong app, Email, hoặc cả hai

### 3. Giới hạn
- Mỗi user chỉ được tạo tối đa **3 thông báo việc làm**
- Chỉ tính các thông báo đang hoạt động (active) vào giới hạn

## 🗂️ Cấu trúc File

```
src/
├── services/
│   └── jobAlertService.js          # API service cho job alerts
├── constants/
│   └── jobAlertEnums.js            # Enum values và helper functions
├── components/
│   ├── jobs/
│   │   └── JobAlertDialog.jsx      # Dialog tạo/sửa thông báo
│   └── layout/
│       ├── Header.jsx              # Updated với Jobs dropdown
│       └── JobsDropdownMenu.jsx    # Dropdown menu cho Việc làm
└── pages/
    └── dashboard/
        └── settings/
            └── JobAlertSettings.jsx # Trang quản lý thông báo
```

## 🚀 Cách sử dụng

### Truy cập trang quản lý
Có 3 cách để truy cập trang quản lý thông báo:

1. **Từ Header**: Hover vào "Việc làm" → Click "Quản lý thông báo việc làm"
2. **Từ Dashboard**: Sidebar → Settings → Job Alerts
3. **Direct URL**: `/dashboard/settings/job-alerts`

### Tạo thông báo mới
1. Click nút "Thêm thông báo"
2. Điền các tiêu chí mong muốn
3. Click "Tạo thông báo"

### Chỉnh sửa thông báo
1. Click icon ✏️ (Pencil) trên hàng thông báo
2. Cập nhật thông tin
3. Click "Cập nhật"

### Bật/Tắt thông báo
- Click icon 🔔 (Bell) để tạm dừng thông báo
- Click icon 🔕 (BellOff) để kích hoạt lại

### Xóa thông báo
1. Click icon 🗑️ (Trash) trên hàng thông báo
2. Xác nhận xóa trong dialog

## 🔌 API Endpoints

```javascript
// Get all job alerts
GET /api/job-alerts

// Create new job alert
POST /api/job-alerts
Body: {
  keyword: string (optional),
  location: { province: string, district: string },
  frequency: 'daily' | 'weekly',
  salaryRange: enum,
  type: enum,
  workType: enum,
  experience: enum,
  category: enum,
  notificationMethod: 'EMAIL' | 'APPLICATION' | 'BOTH'
}

// Update job alert
PUT /api/job-alerts/:id
Body: Partial<CreateJobAlertBody> + { active: boolean }

// Delete job alert
DELETE /api/job-alerts/:id

// Get notification history
GET /api/job-alerts/:id/history?page=1&limit=20
GET /api/job-alerts/history?page=1&limit=20
```

## 🎨 UI Components

### JobAlertSettings (Main Page)
- Hiển thị danh sách thông báo dạng Table
- Actions: Edit, Delete, Toggle Active
- Button "Thêm thông báo" (disabled khi đạt giới hạn)
- Warning message khi đạt giới hạn 3 thông báo

### JobAlertDialog (Form)
- Form 2 cột responsive
- Tất cả fields sử dụng shadcn/ui Select components
- Province/District có logic cascade (chọn tỉnh → load quận)
- Validation tự động từ backend

### JobsDropdownMenu (Header)
- Hover để hiển thị dropdown
- 4 menu items:
  - Tìm việc làm (public)
  - Việc làm đã lưu (authenticated)
  - Việc làm đã ứng tuyển (authenticated)
  - Quản lý thông báo việc làm (authenticated)

## 📱 Responsive Design

- **Desktop**: Table layout với đầy đủ thông tin
- **Mobile**: Mobile menu với nested items cho Jobs section

## 🔄 State Management

- **TanStack Query** cho server state
  - Query key: `['jobAlerts']`
  - Auto refetch on window focus
  - Optimistic updates cho toggle active
- **Local State** cho UI (dialogs, forms)

## ⚡ Performance

- Sử dụng `.lean()` trong backend queries
- Pagination cho notification history
- Debounce cho search inputs (nếu có)

## 🎯 Best Practices

1. **Error Handling**: Tất cả API calls đều có error handling với toast notifications
2. **Loading States**: Skeleton loaders và disabled states
3. **Validation**: Client-side validation + backend Zod schemas
4. **Accessibility**: Proper ARIA labels, keyboard navigation
5. **UX**: Confirmation dialogs cho destructive actions

## 🐛 Troubleshooting

### Không thể tạo thông báo mới
- Kiểm tra đã đạt giới hạn 3 thông báo chưa
- Xóa thông báo cũ để tạo mới

### Dropdown không hiển thị
- Kiểm tra z-index conflicts
- Đảm bảo `data-dropdown` attribute được set

### API errors
- Kiểm tra token authentication
- Verify backend API đang chạy
- Check network tab trong DevTools

## 📝 Notes

- Tính năng này yêu cầu user đã đăng nhập
- Backend sẽ tự động gửi thông báo theo tần suất đã chọn
- Notification history được lưu để tracking
</file>

<file path="src/docs/JOB_ALERTS_TOGGLE_FIX.md">
# 🔧 Job Alerts Toggle Active Fix

## 🐛 Problem

When toggling active/inactive status of a job alert, the API returned validation error:

```json
{
  "success": false,
  "message": "JobAlertSubscription validation failed: location.district: District is required"
}
```

## 🔍 Root Cause

### Backend Behavior
The backend Mongoose model has `location.district` marked as `required: true`:

```javascript
location: {
  district: {
    type: String,
    required: [true, 'District is required'],
  }
}
```

When using `.save()` method in Mongoose, it validates **all required fields**, even if you're only updating one field.

### Frontend Original Code
```javascript
// Only sending { active: true/false }
const toggleActiveMutation = useMutation({
  mutationFn: ({ id, active }) => updateJobAlert(id, { active }),
  // ...
});
```

This sends:
```json
PUT /api/job-alerts/:id
{
  "active": false
}
```

But Mongoose validation fails because `location.district` is missing.

## ✅ Solution

### Option 1: Fix Backend (Recommended for Production)

Update backend service to use `findByIdAndUpdate` with `runValidators: false` or make validation conditional:

```javascript
// In jobAlert.service.js
export const updateJobAlert = async (candidateId, subscriptionId, data) => {
  const subscription = await JobAlertSubscription.findOneAndUpdate(
    { _id: subscriptionId, candidateId },
    data,
    { 
      new: true, 
      runValidators: false // Skip validation for partial updates
    }
  );
  
  if (!subscription) {
    throw new NotFoundError('Không tìm thấy đăng ký.');
  }
  
  return subscription;
};
```

### Option 2: Fix Frontend (Quick Fix - Implemented) ✅

Send full alert data with only the `active` field changed:

```javascript
const handleToggleActive = (alert) => {
  // Send full alert data with only active field changed
  const alertData = {
    keyword: alert.keyword,
    location: alert.location,
    frequency: alert.frequency,
    salaryRange: alert.salaryRange,
    type: alert.type,
    workType: alert.workType,
    experience: alert.experience,
    category: alert.category,
    notificationMethod: alert.notificationMethod,
    active: !alert.active,
  };
  toggleActiveMutation.mutate({ id: alert._id, alertData });
};
```

This sends:
```json
PUT /api/job-alerts/:id
{
  "keyword": "Senior Backend Developer",
  "location": {
    "province": "Thành phố Hà Nội",
    "district": "ALL"
  },
  "frequency": "daily",
  "salaryRange": "20M_30M",
  "type": "FULL_TIME",
  "workType": "HYBRID",
  "experience": "SENIOR_LEVEL",
  "category": "SOFTWARE_DEVELOPMENT",
  "notificationMethod": "APPLICATION",
  "active": false
}
```

## 📊 Comparison

| Approach | Pros | Cons |
|----------|------|------|
| **Backend Fix** | - Cleaner API<br>- True partial updates<br>- Less data transfer | - Requires backend changes<br>- Need to test validation |
| **Frontend Fix** | - Quick to implement<br>- No backend changes<br>- Works immediately | - Sends more data<br>- Not true partial update |

## 🎯 Current Implementation

We implemented **Option 2 (Frontend Fix)** because:
1. ✅ Quick to implement
2. ✅ No backend changes needed
3. ✅ Works immediately
4. ✅ Safe - sends all required fields
5. ✅ Minimal risk

## 🔄 Future Improvement

Consider implementing **Option 1 (Backend Fix)** in the future for:
- Better API design
- Reduced payload size
- True RESTful partial updates

## 📝 Code Changes

### Before
```javascript
const toggleActiveMutation = useMutation({
  mutationFn: ({ id, active }) => updateJobAlert(id, { active }),
  onSuccess: (_, variables) => {
    toast.success(variables.active ? 'Đã bật' : 'Đã tắt');
  },
});

const handleToggleActive = (alert) => {
  toggleActiveMutation.mutate({ 
    id: alert._id, 
    active: !alert.active 
  });
};
```

### After
```javascript
const toggleActiveMutation = useMutation({
  mutationFn: ({ id, alertData }) => updateJobAlert(id, alertData),
  onSuccess: (_, variables) => {
    toast.success(variables.alertData.active ? 'Đã bật' : 'Đã tắt');
  },
});

const handleToggleActive = (alert) => {
  const alertData = {
    keyword: alert.keyword,
    location: alert.location,
    frequency: alert.frequency,
    salaryRange: alert.salaryRange,
    type: alert.type,
    workType: alert.workType,
    experience: alert.experience,
    category: alert.category,
    notificationMethod: alert.notificationMethod,
    active: !alert.active,
  };
  toggleActiveMutation.mutate({ id: alert._id, alertData });
};
```

## 🧪 Testing

### Test Cases
1. ✅ Toggle active → inactive
2. ✅ Toggle inactive → active
3. ✅ Multiple toggles in succession
4. ✅ Toggle with different alert configurations

### Expected Behavior
- No validation errors
- Smooth toggle animation
- Toast notification appears
- Card updates immediately
- Status badge changes color

## 🐛 Debugging Tips

If toggle still fails:

1. **Check Network Tab**
   - Verify full payload is sent
   - Check response status code
   - Look for validation errors

2. **Check Console**
   - Look for mutation errors
   - Check toast notifications
   - Verify state updates

3. **Check Backend Logs**
   - Mongoose validation errors
   - Service layer errors
   - Database connection issues

## 📚 Related Files

- `src/pages/dashboard/settings/JobAlertSettings.jsx` - Main component
- `src/services/jobAlertService.js` - API service
- Backend: `src/services/jobAlert.service.js` - Service layer
- Backend: `src/models/JobAlertSubscription.js` - Mongoose model

## ✅ Status

**Fixed** ✓ - Toggle active/inactive now works correctly by sending full alert data.
</file>

<file path="src/examples/VoiceSearchExamples.jsx">
/**
 * Voice Search Integration Examples
 * 
 * File này chứa các ví dụ về cách tích hợp voice search vào các component khác
 * Copy và modify theo nhu cầu của bạn
 */

import { useState, useEffect } from 'react';
import { useVoiceSearch } from '@/hooks/useVoiceSearch';
import VoiceSearchButton from '@/components/common/VoiceSearchButton';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { toast } from 'sonner';
import { Search } from 'lucide-react';
import { cn } from '@/lib/utils';

// ============================================================================
// Example 1: Simple Voice Search Input
// ============================================================================

export function SimpleVoiceSearchInput() {
  const [query, setQuery] = useState('');

  const { isListening, fullTranscript, isSupported, toggleListening } = useVoiceSearch({
    lang: 'vi-VN',
    onResult: (text) => {
      setQuery(text);
      toast.success('Đã nhận dạng: ' + text);
    }
  });

  useEffect(() => {
    if (isListening) setQuery(fullTranscript);
  }, [fullTranscript, isListening]);

  return (
    <div className="relative">
      <Input
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder={isListening ? "Đang nghe..." : "Tìm kiếm..."}
        disabled={isListening}
        className="pr-14"
      />
      {isSupported && (
        <div className="absolute right-2 top-1/2 -translate-y-1/2">
          <VoiceSearchButton
            isListening={isListening}
            isSupported={isSupported}
            onClick={toggleListening}
          />
        </div>
      )}
    </div>
  );
}

// ============================================================================
// Example 2: Voice Search with Search Button
// ============================================================================

export function VoiceSearchWithButton() {
  const [query, setQuery] = useState('');

  const { isListening, fullTranscript, isSupported, toggleListening, resetTranscript } = useVoiceSearch({
    lang: 'vi-VN',
    onResult: (text) => {
      setQuery(text);
      handleSearch(text);
    },
    onError: (error) => toast.error(error)
  });

  useEffect(() => {
    if (isListening) setQuery(fullTranscript);
  }, [fullTranscript, isListening]);

  const handleSearch = (searchQuery = query) => {
    console.log('Searching for:', searchQuery);
    toast.success('Đang tìm kiếm: ' + searchQuery);
  };

  const handleVoiceClick = () => {
    if (!isListening) {
      resetTranscript();
    }
    toggleListening();
  };

  return (
    <div className="flex gap-2">
      <div className="relative flex-1">
        <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground" />
        <Input
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder={isListening ? "Đang nghe..." : "Tìm kiếm..."}
          disabled={isListening}
          className={cn(
            "pl-10 pr-14",
            isListening && "bg-red-50 border-red-300"
          )}
        />
        {isSupported && (
          <div className="absolute right-2 top-1/2 -translate-y-1/2">
            <VoiceSearchButton
              isListening={isListening}
              isSupported={isSupported}
              onClick={handleVoiceClick}
            />
          </div>
        )}
      </div>
      <Button onClick={() => handleSearch()} disabled={isListening}>
        Tìm kiếm
      </Button>
    </div>
  );
}

// ============================================================================
// Example 3: Voice Search with Language Selector
// ============================================================================

export function VoiceSearchWithLanguage() {
  const [query, setQuery] = useState('');
  const [language, setLanguage] = useState('vi-VN');

  const { isListening, fullTranscript, isSupported, toggleListening } = useVoiceSearch({
    lang: language,
    onResult: (text) => {
      setQuery(text);
      toast.success('Recognized: ' + text);
    }
  });

  useEffect(() => {
    if (isListening) setQuery(fullTranscript);
  }, [fullTranscript, isListening]);

  return (
    <div className="space-y-2">
      <div className="flex gap-2">
        <select
          value={language}
          onChange={(e) => setLanguage(e.target.value)}
          disabled={isListening}
          className="px-3 py-2 border rounded-lg"
        >
          <option value="vi-VN">🇻🇳 Tiếng Việt</option>
          <option value="en-US">🇺🇸 English</option>
          <option value="zh-CN">🇨🇳 中文</option>
          <option value="ja-JP">🇯🇵 日本語</option>
        </select>
      </div>
      <div className="relative">
        <Input
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder={isListening ? "Listening..." : "Search..."}
          disabled={isListening}
          className="pr-14"
        />
        {isSupported && (
          <div className="absolute right-2 top-1/2 -translate-y-1/2">
            <VoiceSearchButton
              isListening={isListening}
              isSupported={isSupported}
              onClick={toggleListening}
            />
          </div>
        )}
      </div>
    </div>
  );
}

// ============================================================================
// Example 4: Voice Search with Transcript Display
// ============================================================================

export function VoiceSearchWithTranscript() {
  const [query, setQuery] = useState('');

  const {
    isListening,
    transcript,
    interimTranscript,
    fullTranscript,
    isSupported,
    toggleListening
  } = useVoiceSearch({
    lang: 'vi-VN',
    onResult: (text) => {
      setQuery(text);
      toast.success('Đã nhận dạng: ' + text);
    }
  });

  useEffect(() => {
    if (isListening) setQuery(fullTranscript);
  }, [fullTranscript, isListening]);

  return (
    <div className="space-y-3">
      <div className="relative">
        <Input
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder={isListening ? "Đang nghe..." : "Tìm kiếm..."}
          disabled={isListening}
          className="pr-14"
        />
        {isSupported && (
          <div className="absolute right-2 top-1/2 -translate-y-1/2">
            <VoiceSearchButton
              isListening={isListening}
              isSupported={isSupported}
              onClick={toggleListening}
            />
          </div>
        )}
      </div>

      {/* Transcript Display */}
      {(transcript || interimTranscript) && (
        <div className="bg-muted rounded-lg p-3 text-sm">
          <div className="text-muted-foreground mb-1">Transcript:</div>
          <div>
            <span className="font-medium text-foreground">{transcript}</span>
            {interimTranscript && (
              <span className="text-muted-foreground italic"> {interimTranscript}</span>
            )}
          </div>
        </div>
      )}
    </div>
  );
}

// ============================================================================
// Example 5: Voice Search with Custom Timeout
// ============================================================================

export function VoiceSearchWithCustomTimeout() {
  const [query, setQuery] = useState('');
  const [timeout, setTimeout] = useState(2000);

  const { isListening, fullTranscript, isSupported, toggleListening } = useVoiceSearch({
    lang: 'vi-VN',
    silenceTimeout: timeout,
    onResult: (text) => {
      setQuery(text);
      toast.success(`Đã nhận dạng (${timeout}ms): ${text}`);
    }
  });

  useEffect(() => {
    if (isListening) setQuery(fullTranscript);
  }, [fullTranscript, isListening]);

  return (
    <div className="space-y-3">
      <div className="flex gap-2 items-center">
        <label className="text-sm text-muted-foreground">Silence timeout:</label>
        <select
          value={timeout}
          onChange={(e) => setTimeout(Number(e.target.value))}
          disabled={isListening}
          className="px-3 py-1 border rounded-lg text-sm"
        >
          <option value={1000}>1 giây</option>
          <option value={2000}>2 giây</option>
          <option value={3000}>3 giây</option>
          <option value={5000}>5 giây</option>
        </select>
      </div>

      <div className="relative">
        <Input
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder={isListening ? "Đang nghe..." : "Tìm kiếm..."}
          disabled={isListening}
          className="pr-14"
        />
        {isSupported && (
          <div className="absolute right-2 top-1/2 -translate-y-1/2">
            <VoiceSearchButton
              isListening={isListening}
              isSupported={isSupported}
              onClick={toggleListening}
            />
          </div>
        )}
      </div>
    </div>
  );
}

// ============================================================================
// Example 6: Voice Search with Manual Control
// ============================================================================

export function VoiceSearchManualControl() {
  const [query, setQuery] = useState('');

  const {
    isListening,
    fullTranscript,
    isSupported,
    startListening,
    stopListening,
    resetTranscript
  } = useVoiceSearch({
    lang: 'vi-VN',
    continuous: true, // Don't auto-stop
    silenceTimeout: 0,
    onResult: (text) => {
      setQuery(text);
    }
  });

  useEffect(() => {
    if (isListening) setQuery(fullTranscript);
  }, [fullTranscript, isListening]);

  const handleStart = () => {
    resetTranscript();
    startListening();
    toast.info('Bắt đầu nghe...');
  };

  const handleStop = () => {
    stopListening();
    toast.success('Đã dừng');
  };

  return (
    <div className="space-y-3">
      <div className="relative">
        <Input
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          placeholder={isListening ? "Đang nghe..." : "Tìm kiếm..."}
          disabled={isListening}
          className="pr-14"
        />
        {isSupported && (
          <div className="absolute right-2 top-1/2 -translate-y-1/2">
            <VoiceSearchButton
              isListening={isListening}
              isSupported={isSupported}
              onClick={isListening ? handleStop : handleStart}
            />
          </div>
        )}
      </div>

      <div className="flex gap-2">
        <Button
          onClick={handleStart}
          disabled={isListening || !isSupported}
          size="sm"
          variant="outline"
        >
          Bắt đầu
        </Button>
        <Button
          onClick={handleStop}
          disabled={!isListening}
          size="sm"
          variant="outline"
        >
          Dừng
        </Button>
        <Button
          onClick={() => {
            resetTranscript();
            setQuery('');
          }}
          disabled={isListening}
          size="sm"
          variant="outline"
        >
          Reset
        </Button>
      </div>
    </div>
  );
}

// ============================================================================
// Example 7: Voice Search in Modal/Dialog
// ============================================================================

export function VoiceSearchInModal({ isOpen, onClose }) {
  const [query, setQuery] = useState('');

  const { isListening, fullTranscript, isSupported, toggleListening, resetTranscript } = useVoiceSearch({
    lang: 'vi-VN',
    onResult: (text) => {
      setQuery(text);
      handleSearch(text);
    }
  });

  useEffect(() => {
    if (isListening) setQuery(fullTranscript);
  }, [fullTranscript, isListening]);

  // Cleanup when modal closes
  useEffect(() => {
    if (!isOpen && isListening) {
      toggleListening();
    }
  }, [isOpen]);

  const handleSearch = (searchQuery) => {
    console.log('Searching:', searchQuery);
    toast.success('Tìm kiếm: ' + searchQuery);
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div className="bg-background rounded-lg p-6 max-w-md w-full">
        <h2 className="text-xl font-semibold mb-4">Voice Search</h2>
        
        <div className="relative mb-4">
          <Input
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            placeholder={isListening ? "Đang nghe..." : "Tìm kiếm..."}
            disabled={isListening}
            className="pr-14"
          />
          {isSupported && (
            <div className="absolute right-2 top-1/2 -translate-y-1/2">
              <VoiceSearchButton
                isListening={isListening}
                isSupported={isSupported}
                onClick={() => {
                  if (!isListening) resetTranscript();
                  toggleListening();
                }}
              />
            </div>
          )}
        </div>

        <div className="flex gap-2 justify-end">
          <Button variant="outline" onClick={onClose}>
            Hủy
          </Button>
          <Button onClick={() => handleSearch(query)}>
            Tìm kiếm
          </Button>
        </div>
      </div>
    </div>
  );
}

// ============================================================================
// Usage Example
// ============================================================================

/*
import {
  SimpleVoiceSearchInput,
  VoiceSearchWithButton,
  VoiceSearchWithLanguage,
  VoiceSearchWithTranscript,
  VoiceSearchWithCustomTimeout,
  VoiceSearchManualControl,
  VoiceSearchInModal
} from '@/examples/VoiceSearchExamples';

function MyPage() {
  return (
    <div className="space-y-8 p-8">
      <div>
        <h3>Simple Input</h3>
        <SimpleVoiceSearchInput />
      </div>

      <div>
        <h3>With Search Button</h3>
        <VoiceSearchWithButton />
      </div>

      <div>
        <h3>With Language Selector</h3>
        <VoiceSearchWithLanguage />
      </div>

      <div>
        <h3>With Transcript Display</h3>
        <VoiceSearchWithTranscript />
      </div>

      <div>
        <h3>Custom Timeout</h3>
        <VoiceSearchWithCustomTimeout />
      </div>

      <div>
        <h3>Manual Control</h3>
        <VoiceSearchManualControl />
      </div>
    </div>
  );
}
*/
</file>

<file path="src/hooks/useDebounce.js">
import { useState, useEffect } from 'react';

/**
 * Custom hook để debounce một giá trị
 * Hữu ích để giảm số lượng API calls khi user đang typing
 * 
 * @param {any} value - Giá trị cần debounce
 * @param {number} delay - Thời gian delay (ms), mặc định 300ms
 * @returns {any} - Giá trị đã được debounce
 */
export const useDebounce = (value, delay = 300) => {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    // Set timeout để update debounced value sau delay
    const timeoutId = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    // Cleanup timeout nếu value thay đổi trước khi timeout hoàn thành
    return () => {
      clearTimeout(timeoutId);
    };
  }, [value, delay]);

  return debouncedValue;
};

export default useDebounce;
</file>

<file path="src/hooks/useFormSubmitWithRetry.js">
import { useState, useCallback } from 'react';
import { toast } from 'sonner';
import { 
  getErrorMessage, 
  isRetryableError, 
  retryWithBackoff,
  isOnline,
  waitForOnline,
  logError
} from '@/utils/errorHandling';

/**
 * Custom hook for form submission with retry logic and error handling
 * @param {Function} submitFn - Async function to submit form data
 * @param {Object} options - Configuration options
 * @returns {Object} Submit handler and state
 */
export const useFormSubmitWithRetry = (submitFn, options = {}) => {
  const {
    maxRetries = 3,
    onSuccess,
    onError,
    successMessage = 'Đã lưu thành công',
    errorContext = 'Lưu dữ liệu',
    showSuccessToast = true,
    showErrorToast = true
  } = options;

  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState(null);
  const [retryCount, setRetryCount] = useState(0);

  const handleSubmit = useCallback(async (data) => {
    // Check if online before submitting
    if (!isOnline()) {
      const errorMsg = 'Không có kết nối mạng. Vui lòng kiểm tra và thử lại.';
      setError(errorMsg);
      if (showErrorToast) {
        toast.error(errorMsg);
      }
      return { success: false, error: errorMsg };
    }

    setIsSubmitting(true);
    setError(null);
    setRetryCount(0);

    try {
      // Attempt submission with retry logic
      const result = await retryWithBackoff(
        async () => {
          try {
            return await submitFn(data);
          } catch (err) {
            // If network error, wait for connection
            if (!isOnline()) {
              if (showErrorToast) {
                toast.loading('Đang chờ kết nối mạng...', { id: 'waiting-online' });
              }
              
              const connected = await waitForOnline(30000);
              
              if (showErrorToast) {
                toast.dismiss('waiting-online');
              }
              
              if (!connected) {
                throw new Error('Không thể kết nối sau 30 giây');
              }
              
              // Retry after connection restored
              return await submitFn(data);
            }
            throw err;
          }
        },
        maxRetries,
        (error) => {
          setRetryCount(prev => prev + 1);
          return isRetryableError(error);
        }
      );

      // Success
      setIsSubmitting(false);
      if (showSuccessToast) {
        toast.success(successMessage);
      }
      
      if (onSuccess) {
        onSuccess(result);
      }

      return { success: true, data: result };

    } catch (err) {
      // Log error for debugging
      logError(err, { context: errorContext, data });

      // Get user-friendly error message
      const errorMsg = getErrorMessage(err, errorContext);
      setError(errorMsg);
      setIsSubmitting(false);

      if (showErrorToast) {
        toast.error(errorMsg);
      }

      if (onError) {
        onError(err);
      }

      return { success: false, error: errorMsg };
    }
  }, [submitFn, maxRetries, onSuccess, onError, successMessage, errorContext, showSuccessToast, showErrorToast]);

  const reset = useCallback(() => {
    setError(null);
    setRetryCount(0);
    setIsSubmitting(false);
  }, []);

  return {
    handleSubmit,
    isSubmitting,
    error,
    retryCount,
    reset
  };
};
</file>

<file path="src/hooks/useNotifications.js">
// src/hooks/useNotifications.js
import { useState, useEffect, useCallback } from 'react';
import * as notificationService from '@/services/notificationService';
import { toast } from 'react-toastify';

/**
 * Custom hook để quản lý notifications
 * @param {object} options
 * @param {boolean} options.autoFetch - Tự động fetch khi mount
 * @param {number} options.refreshInterval - Thời gian refresh tự động (ms)
 */
export const useNotifications = ({ 
  autoFetch = true, 
  refreshInterval = null 
} = {}) => {
  const [notifications, setNotifications] = useState([]);
  const [unreadCount, setUnreadCount] = useState(0);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [pagination, setPagination] = useState({
    page: 1,
    limit: 10,
    total: 0,
    pages: 0
  });

  // Fetch notifications
  const fetchNotifications = useCallback(async (params = {}) => {
    try {
      setLoading(true);
      setError(null);
      const response = await notificationService.getNotifications({
        page: pagination.page,
        limit: pagination.limit,
        ...params
      });
      
      setNotifications(response.data);
      setPagination(prev => ({
        ...prev,
        total: response.meta.total,
        pages: response.meta.pages,
        page: response.meta.page
      }));
    } catch (err) {
      setError(err.message || 'Không thể tải thông báo');
      toast.error('Không thể tải thông báo');
    } finally {
      setLoading(false);
    }
  }, [pagination.page, pagination.limit]);

  // Fetch unread count
  const fetchUnreadCount = useCallback(async () => {
    try {
      const count = await notificationService.getUnreadCount();
      setUnreadCount(count);
    } catch (err) {
      console.error('Failed to fetch unread count:', err);
    }
  }, []);

  // Mark notification as read
  const markAsRead = useCallback(async (notificationId) => {
    try {
      await notificationService.markNotificationAsRead(notificationId);
      
      // Update local state
      setNotifications(prev => 
        prev.map(n => 
          n._id === notificationId ? { ...n, read: true } : n
        )
      );
      
      // Update unread count
      setUnreadCount(prev => Math.max(0, prev - 1));
    } catch (err) {
      toast.error('Không thể đánh dấu đã đọc');
    }
  }, []);

  // Mark all as read
  const markAllAsRead = useCallback(async () => {
    try {
      await notificationService.markAllAsRead();
      
      // Update local state
      setNotifications(prev => 
        prev.map(n => ({ ...n, read: true }))
      );
      
      setUnreadCount(0);
      toast.success('Đã đánh dấu tất cả là đã đọc');
    } catch (err) {
      toast.error('Không thể đánh dấu tất cả đã đọc');
    }
  }, []);

  // Change page
  const changePage = useCallback((newPage) => {
    setPagination(prev => ({ ...prev, page: newPage }));
  }, []);

  // Refresh
  const refresh = useCallback(() => {
    fetchNotifications();
    fetchUnreadCount();
  }, [fetchNotifications, fetchUnreadCount]);

  // Auto fetch on mount
  useEffect(() => {
    if (autoFetch) {
      fetchNotifications();
      fetchUnreadCount();
    }
  }, [autoFetch, fetchNotifications, fetchUnreadCount]);

  // Auto refresh
  useEffect(() => {
    if (refreshInterval) {
      const interval = setInterval(() => {
        fetchUnreadCount();
      }, refreshInterval);
      
      return () => clearInterval(interval);
    }
  }, [refreshInterval, fetchUnreadCount]);

  // Refetch when page changes
  useEffect(() => {
    if (autoFetch && pagination.page > 1) {
      fetchNotifications();
    }
  }, [pagination.page, autoFetch, fetchNotifications]);

  return {
    notifications,
    unreadCount,
    loading,
    error,
    pagination,
    fetchNotifications,
    fetchUnreadCount,
    markAsRead,
    markAllAsRead,
    changePage,
    refresh
  };
};

export default useNotifications;
</file>

<file path="src/hooks/useOnboardingStatus.js">
import { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { fetchOnboardingStatus, shouldRefetchOnboardingStatus } from '@/redux/slices/onboardingThunks';

/**
 * Custom hook to get onboarding status from Redux
 * Automatically fetches from API if data is stale or missing
 * 
 * @param {boolean} autoFetch - Whether to automatically fetch on mount (default: true)
 * @returns {Object} Onboarding status and helper functions
 */
export const useOnboardingStatus = (autoFetch = true) => {
  const dispatch = useDispatch();
  
  const {
    isOnboardingComplete,
    needsOnboarding,
    currentStep,
    completedSteps,
    skippedSteps,
    completionPercentage,
    profileCompleteness,
    isLoading,
    error,
    lastFetchTime
  } = useSelector((state) => state.onboarding);

  const shouldRefetch = useSelector(shouldRefetchOnboardingStatus);

  // Auto-fetch on mount if enabled and data is stale
  useEffect(() => {
    if (autoFetch && shouldRefetch) {
      dispatch(fetchOnboardingStatus());
    }
  }, [autoFetch, shouldRefetch, dispatch]);

  // Manual refresh function
  const refresh = () => {
    dispatch(fetchOnboardingStatus());
  };

  return {
    // Status flags
    isOnboardingComplete,
    needsOnboarding,
    
    // Progress data
    currentStep,
    completedSteps,
    skippedSteps,
    completionPercentage,
    profileCompleteness,
    
    // Loading states
    isLoading,
    error,
    lastFetchTime,
    
    // Actions
    refresh
  };
};
</file>

<file path="src/hooks/usePayment.js">
import { useState } from 'react';
import { toast } from 'sonner';
import { createPaymentOrder } from '../services/paymentService';

export const usePayment = () => {
    const [isProcessing, setIsProcessing] = useState(false);

    const handlePayment = async (values) => {
        setIsProcessing(true);
        try {
            const response = await createPaymentOrder(values);
            console.log('Payment Response:', response);
            
            // Dựa theo logic của project recruiter
            if (response.success && response.data.order_url) {
                // Redirect to payment gateway
                window.location.href = response.data.order_url;
            } else {
                toast.error(response.message || 'Failed to create payment order. Please try again.');
            }
        } catch (error) {
            console.error('Payment Error:', error);
            const errorMessage = error.response?.data?.message || 'An unexpected error occurred during payment.';
            toast.error(errorMessage);
        } finally {
            setIsProcessing(false);
        }
    };

    return { isProcessing, handlePayment };
};
</file>

<file path="src/hooks/useRechargeHistory.js">
import { useState, useEffect } from 'react';
import { getRechargeHistory } from '@/services/walletService';
import { toast } from 'sonner';

export const useRechargeHistory = () => {
  const [history, setHistory] = useState([]);
  const [loading, setLoading] = useState(false);
  const [pagination, setPagination] = useState({
    page: 1,
    limit: 10,
    total: 0,
    totalPages: 0
  });

  const fetchHistory = async (page = 1, limit = 10) => {
    setLoading(true);
    try {
      const response = await getRechargeHistory({ page, limit });
      
      if (response.success) {
        setHistory(response.data);
        setPagination({
          page: response.meta.page,
          limit: response.meta.limit,
          total: response.meta.total,
          totalPages: response.meta.totalPages
        });
      } else {
        toast.error(response.message || 'Không thể tải lịch sử nạp xu');
      }
    } catch (error) {
      console.error('Error fetching recharge history:', error);
      toast.error('Có lỗi xảy ra khi tải lịch sử nạp xu');
    } finally {
      setLoading(false);
    }
  };

  const loadMore = () => {
    if (pagination.page < pagination.totalPages) {
      fetchHistory(pagination.page + 1, pagination.limit);
    }
  };

  const refresh = () => {
    fetchHistory(1, pagination.limit);
  };

  useEffect(() => {
    fetchHistory();
  }, []);

  return {
    history,
    loading,
    pagination,
    loadMore,
    refresh,
    fetchHistory
  };
};
</file>

<file path="src/hooks/useRetry.js">
import { useState, useCallback, useEffect } from 'react';
import { 
  isRetryableError, 
  getRetryDelay, 
  isOnline, 
  waitForOnline 
} from '@/utils/errorHandling';

/**
 * Custom hook for retry logic with offline detection
 * @param {Function} fn - Async function to retry
 * @param {Object} options - Configuration options
 * @returns {Object} Retry state and handlers
 */
export const useRetry = (fn, options = {}) => {
  const {
    maxRetries = 3,
    onSuccess,
    onError,
    onRetry,
    shouldRetry = isRetryableError,
    waitForConnection = true
  } = options;

  const [isRetrying, setIsRetrying] = useState(false);
  const [retryCount, setRetryCount] = useState(0);
  const [error, setError] = useState(null);
  const [online, setOnline] = useState(isOnline());

  // Monitor online status
  useEffect(() => {
    const handleOnline = () => setOnline(true);
    const handleOffline = () => setOnline(false);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  const execute = useCallback(async (...args) => {
    setIsRetrying(true);
    setError(null);
    let currentRetry = 0;

    while (currentRetry <= maxRetries) {
      try {
        // Check if online before attempting
        if (!isOnline()) {
          if (waitForConnection) {
            // Wait for connection to be restored
            const connected = await waitForOnline(30000);
            if (!connected) {
              throw new Error('Không thể kết nối sau 30 giây');
            }
          } else {
            throw new Error('Không có kết nối mạng');
          }
        }

        // Execute function
        const result = await fn(...args);
        
        // Success
        setIsRetrying(false);
        setRetryCount(0);
        
        if (onSuccess) {
          onSuccess(result);
        }
        
        return { success: true, data: result };

      } catch (err) {
        setError(err);

        // Check if should retry
        const canRetry = currentRetry < maxRetries && shouldRetry(err);
        
        if (!canRetry) {
          setIsRetrying(false);
          
          if (onError) {
            onError(err);
          }
          
          return { success: false, error: err };
        }

        // Increment retry count
        currentRetry++;
        setRetryCount(currentRetry);

        if (onRetry) {
          onRetry(currentRetry, err);
        }

        // Wait before retrying
        const delay = getRetryDelay(currentRetry - 1);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }

    // Max retries reached
    setIsRetrying(false);
    
    if (onError) {
      onError(error);
    }
    
    return { success: false, error };
  }, [fn, maxRetries, shouldRetry, waitForConnection, onSuccess, onError, onRetry, error]);

  const reset = useCallback(() => {
    setIsRetrying(false);
    setRetryCount(0);
    setError(null);
  }, []);

  return {
    execute,
    isRetrying,
    retryCount,
    error,
    online,
    reset
  };
};

/**
 * Hook for manual retry with state management
 */
export const useManualRetry = () => {
  const [retryTrigger, setRetryTrigger] = useState(0);

  const retry = useCallback(() => {
    setRetryTrigger(prev => prev + 1);
  }, []);

  return {
    retryTrigger,
    retry
  };
};
</file>

<file path="src/hooks/useSectionManager.js">
import { useState, useCallback } from 'react';
import { 
  isTwoColumnTemplate, 
  moveSectionInColumn, 
  getDefaultSectionOrder,
  validateSectionOrder,
  splitSectionsByColumn
} from '@/utils/templateHelpers';

/**
 * Custom hook để quản lý sections (order, visibility)
 */
export const useSectionManager = (initialSectionOrder, initialHiddenSections, templateId) => {
  const [sectionOrder, setSectionOrder] = useState(initialSectionOrder || getDefaultSectionOrder(templateId));
  const [hiddenSections, setHiddenSections] = useState(initialHiddenSections || []);

  /**
   * Di chuyển section lên/xuống
   */
  const moveSection = useCallback((sectionId, direction) => {
    setSectionOrder(prevOrder => {
      const newOrder = moveSectionInColumn(prevOrder, templateId, sectionId, direction);
      return validateSectionOrder(newOrder, templateId) ? newOrder : prevOrder;
    });
  }, [templateId]);

  /**
   * Reorder sections bằng drag & drop
   */
  const reorderSections = useCallback((newOrder) => {
    if (validateSectionOrder(newOrder, templateId)) {
      setSectionOrder(newOrder);
    }
  }, [templateId]);

  /**
   * Toggle visibility của section
   */
  const toggleSectionVisibility = useCallback((sectionId) => {
    setHiddenSections(prev => {
      if (prev.includes(sectionId)) {
        return prev.filter(id => id !== sectionId);
      } else {
        return [...prev, sectionId];
      }
    });
  }, []);

  /**
   * Ẩn section
   */
  const hideSection = useCallback((sectionId) => {
    setHiddenSections(prev => {
      if (!prev.includes(sectionId)) {
        return [...prev, sectionId];
      }
      return prev;
    });
  }, []);

  /**
   * Hiện section
   */
  const showSection = useCallback((sectionId) => {
    setHiddenSections(prev => prev.filter(id => id !== sectionId));
  }, []);

  /**
   * Ẩn nhiều sections
   */
  const hideSections = useCallback((sectionIds) => {
    setHiddenSections(prev => {
      const newHidden = [...prev];
      sectionIds.forEach(id => {
        if (!newHidden.includes(id)) {
          newHidden.push(id);
        }
      });
      return newHidden;
    });
  }, []);

  /**
   * Hiện nhiều sections
   */
  const showSections = useCallback((sectionIds) => {
    setHiddenSections(prev => prev.filter(id => !sectionIds.includes(id)));
  }, []);

  /**
   * Reset về default
   */
  const resetToDefault = useCallback(() => {
    setSectionOrder(getDefaultSectionOrder(templateId));
    setHiddenSections([]);
  }, [templateId]);

  /**
   * Lấy visible sections (không bị ẩn)
   */
  const getVisibleSections = useCallback(() => {
    return sectionOrder.filter(id => !hiddenSections.includes(id));
  }, [sectionOrder, hiddenSections]);

  /**
   * Kiểm tra section có bị ẩn không
   */
  const isSectionHidden = useCallback((sectionId) => {
    return hiddenSections.includes(sectionId);
  }, [hiddenSections]);

  /**
   * Lấy index của section trong order
   */
  const getSectionIndex = useCallback((sectionId) => {
    return sectionOrder.indexOf(sectionId);
  }, [sectionOrder]);

  /**
   * Kiểm tra có thể di chuyển section lên không
   */
  const canMoveUp = useCallback((sectionId) => {
    const index = getSectionIndex(sectionId);
    if (index <= 0) return false;

    // Nếu là template 2 cột, chỉ check trong column của nó
    if (isTwoColumnTemplate(templateId)) {
      const { sidebar, main } = splitSectionsByColumn(sectionOrder, templateId);
      const columnSections = sidebar.includes(sectionId) ? sidebar : main;
      const columnIndex = columnSections.indexOf(sectionId);
      return columnIndex > 0;
    }

    return true;
  }, [sectionOrder, templateId, getSectionIndex]);

  /**
   * Kiểm tra có thể di chuyển section xuống không
   */
  const canMoveDown = useCallback((sectionId) => {
    const index = getSectionIndex(sectionId);
    if (index === -1 || index >= sectionOrder.length - 1) return false;

    // Nếu là template 2 cột, chỉ check trong column của nó
    if (isTwoColumnTemplate(templateId)) {
      const { sidebar, main } = splitSectionsByColumn(sectionOrder, templateId);
      const columnSections = sidebar.includes(sectionId) ? sidebar : main;
      const columnIndex = columnSections.indexOf(sectionId);
      return columnIndex < columnSections.length - 1;
    }

    return true;
  }, [sectionOrder, templateId, getSectionIndex]);

  return {
    sectionOrder,
    hiddenSections,
    moveSection,
    reorderSections,
    toggleSectionVisibility,
    hideSection,
    showSection,
    hideSections,
    showSections,
    resetToDefault,
    getVisibleSections,
    isSectionHidden,
    getSectionIndex,
    canMoveUp,
    canMoveDown,
    setSectionOrder,
    setHiddenSections
  };
};
</file>

<file path="src/hooks/useTheme.js">
import { useTheme as useThemeContext } from '@/contexts/ThemeContext';

export const useTheme = useThemeContext;
</file>

<file path="src/hooks/useVoiceSearch.js">
import { useState, useEffect, useRef, useCallback } from 'react';

/**
 * Custom hook for voice search using Web Speech API
 * Automatically stops recording after silence is detected
 * 
 * @param {Object} options - Configuration options
 * @param {string} options.lang - Language code (default: 'vi-VN')
 * @param {number} options.silenceTimeout - Milliseconds of silence before auto-stop (default: 2000)
 * @param {boolean} options.continuous - Continue listening after results (default: false)
 * @param {Function} options.onResult - Callback when final result is received
 * @param {Function} options.onError - Callback when error occurs
 * @returns {Object} Voice search state and controls
 */
export const useVoiceSearch = ({
  lang = 'vi-VN',
  silenceTimeout = 2000,
  continuous = false,
  onResult,
  onError
} = {}) => {
  const [isListening, setIsListening] = useState(false);
  const [transcript, setTranscript] = useState('');
  const [interimTranscript, setInterimTranscript] = useState('');
  const [error, setError] = useState(null);
  const [isSupported, setIsSupported] = useState(true);

  const recognitionRef = useRef(null);
  const silenceTimerRef = useRef(null);
  const hasReceivedSpeechRef = useRef(false);

  // Initialize Speech Recognition
  useEffect(() => {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (!SpeechRecognition) {
      setIsSupported(false);
      setError('Trình duyệt không hỗ trợ nhận dạng giọng nói');
      return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = lang;
    recognition.continuous = continuous;
    recognition.interimResults = true;
    recognition.maxAlternatives = 1;

    // Handle results
    recognition.onresult = (event) => {
      let interimText = '';
      let finalText = '';

      for (let i = event.resultIndex; i < event.results.length; i++) {
        const result = event.results[i];
        const text = result[0].transcript;

        if (result.isFinal) {
          finalText += text;
          hasReceivedSpeechRef.current = true;
        } else {
          interimText += text;
        }
      }

      if (finalText) {
        setTranscript(prev => prev + finalText);
        setInterimTranscript('');
        
        // Reset silence timer when we get final results
        clearTimeout(silenceTimerRef.current);
        
        // Start silence timer to auto-stop after silence
        silenceTimerRef.current = setTimeout(() => {
          if (hasReceivedSpeechRef.current) {
            stopListening();
          }
        }, silenceTimeout);
      } else if (interimText) {
        setInterimTranscript(interimText);
        
        // Reset silence timer on interim results
        clearTimeout(silenceTimerRef.current);
      }
    };

    // Handle errors
    recognition.onerror = (event) => {
      console.error('Speech recognition error:', event.error);
      
      let errorMessage = 'Có lỗi xảy ra khi nhận dạng giọng nói';
      
      switch (event.error) {
        case 'no-speech':
          errorMessage = 'Không phát hiện giọng nói';
          break;
        case 'audio-capture':
          errorMessage = 'Không thể truy cập microphone';
          break;
        case 'not-allowed':
          errorMessage = 'Quyền truy cập microphone bị từ chối';
          break;
        case 'network':
          errorMessage = 'Lỗi kết nối mạng';
          break;
        case 'aborted':
          // User stopped manually, not an error
          return;
      }
      
      setError(errorMessage);
      setIsListening(false);
      
      if (onError) {
        onError(errorMessage);
      }
    };

    // Handle end
    recognition.onend = () => {
      setIsListening(false);
      clearTimeout(silenceTimerRef.current);
      
      // Call onResult with final transcript if we received speech
      if (hasReceivedSpeechRef.current && transcript && onResult) {
        onResult(transcript.trim());
      }
    };

    recognitionRef.current = recognition;

    return () => {
      if (recognitionRef.current) {
        recognitionRef.current.abort();
      }
      clearTimeout(silenceTimerRef.current);
    };
  }, [lang, continuous, silenceTimeout, onResult, onError, transcript]);

  /**
   * Start listening for voice input
   */
  const startListening = useCallback(() => {
    if (!isSupported || !recognitionRef.current) {
      return;
    }

    try {
      // Reset state
      setTranscript('');
      setInterimTranscript('');
      setError(null);
      hasReceivedSpeechRef.current = false;
      
      // Start recognition
      recognitionRef.current.start();
      setIsListening(true);
    } catch (err) {
      console.error('Error starting recognition:', err);
      setError('Không thể bắt đầu nhận dạng giọng nói');
    }
  }, [isSupported]);

  /**
   * Stop listening
   */
  const stopListening = useCallback(() => {
    if (recognitionRef.current && isListening) {
      recognitionRef.current.stop();
      clearTimeout(silenceTimerRef.current);
    }
  }, [isListening]);

  /**
   * Toggle listening state
   */
  const toggleListening = useCallback(() => {
    if (isListening) {
      stopListening();
    } else {
      startListening();
    }
  }, [isListening, startListening, stopListening]);

  /**
   * Reset transcript
   */
  const resetTranscript = useCallback(() => {
    setTranscript('');
    setInterimTranscript('');
    hasReceivedSpeechRef.current = false;
  }, []);

  return {
    isListening,
    transcript,
    interimTranscript,
    fullTranscript: transcript + interimTranscript,
    error,
    isSupported,
    startListening,
    stopListening,
    toggleListening,
    resetTranscript
  };
};
</file>

<file path="src/hooks/useWallet.js">
import { useState, useEffect, useCallback } from 'react';
import { useSelector } from 'react-redux';
import { toast } from 'sonner';
import { 
  getWalletInfo, 
  getTransactionHistory, 
  rechargeWallet, 
  spendCoins, 
  getRechargePackages 
} from '../services/walletService';

/**
 * Custom hook để quản lý wallet functionality
 * @returns {Object} Wallet state và functions
 */
export const useWallet = () => {
  const { isAuthenticated } = useSelector((state) => state.auth);
  
  // State
  const [walletInfo, setWalletInfo] = useState({
    balance: 0,
    totalSpent: 0,
    totalRecharged: 0
  });
  const [transactions, setTransactions] = useState([]);
  const [rechargePackages, setRechargePackages] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [isRecharging, setIsRecharging] = useState(false);
  const [isSpending, setIsSpending] = useState(false);
  const [error, setError] = useState(null);

  // Fetch wallet info
  const fetchWalletInfo = useCallback(async () => {
    if (!isAuthenticated) return;

    try {
      setIsLoading(true);
      setError(null);
      const response = await getWalletInfo();
      
      if (response.success) {
        setWalletInfo(response.data);
      } else {
        throw new Error(response.message || 'Không thể tải thông tin ví');
      }
    } catch (err) {
      console.error('Error fetching wallet info:', err);
      setError(err.response?.data?.message || err.message);
      toast.error('Không thể tải thông tin ví');
    } finally {
      setIsLoading(false);
    }
  }, [isAuthenticated]);

  // Fetch transaction history
  const fetchTransactions = useCallback(async (params = {}) => {
    if (!isAuthenticated) return;

    try {
      setIsLoading(true);
      const response = await getTransactionHistory(params);
      
      if (response.success) {
        setTransactions(response.data.transactions || []);
      } else {
        throw new Error(response.message || 'Không thể tải lịch sử giao dịch');
      }
    } catch (err) {
      console.error('Error fetching transactions:', err);
      setError(err.response?.data?.message || err.message);
      toast.error('Không thể tải lịch sử giao dịch');
    } finally {
      setIsLoading(false);
    }
  }, [isAuthenticated]);

  // Fetch recharge packages
  const fetchRechargePackages = useCallback(async () => {
    try {
      const response = await getRechargePackages();
      
      if (response.success) {
        setRechargePackages(response.data || []);
      } else {
        throw new Error(response.message || 'Không thể tải gói nạp xu');
      }
    } catch (err) {
      console.error('Error fetching recharge packages:', err);
      setError(err.response?.data?.message || err.message);
    }
  }, []);

  // Recharge wallet
  const handleRecharge = useCallback(async (rechargeData) => {
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để nạp xu');
      return false;
    }

    try {
      setIsRecharging(true);
      setError(null);
      
      const response = await rechargeWallet(rechargeData);
      
      if (response.success) {
        toast.success('Nạp xu thành công!');
        // Refresh wallet info
        await fetchWalletInfo();
        return true;
      } else {
        throw new Error(response.message || 'Nạp xu thất bại');
      }
    } catch (err) {
      console.error('Error recharging wallet:', err);
      const errorMessage = err.response?.data?.message || err.message;
      setError(errorMessage);
      toast.error(errorMessage);
      return false;
    } finally {
      setIsRecharging(false);
    }
  }, [isAuthenticated, fetchWalletInfo]);

  // Spend coins
  const handleSpend = useCallback(async (spendData) => {
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để sử dụng tính năng này');
      return false;
    }

    // Check balance
    if (walletInfo.balance < spendData.amount) {
      toast.error('Số xu không đủ. Vui lòng nạp thêm xu.');
      return false;
    }

    try {
      setIsSpending(true);
      setError(null);
      
      const response = await spendCoins(spendData);
      
      if (response.success) {
        toast.success(`Đã tiêu ${spendData.amount} xu thành công!`);
        // Update balance immediately
        setWalletInfo(prev => ({
          ...prev,
          balance: prev.balance - spendData.amount,
          totalSpent: prev.totalSpent + spendData.amount
        }));
        return response.data;
      } else {
        throw new Error(response.message || 'Không thể thực hiện giao dịch');
      }
    } catch (err) {
      console.error('Error spending coins:', err);
      const errorMessage = err.response?.data?.message || err.message;
      setError(errorMessage);
      toast.error(errorMessage);
      return false;
    } finally {
      setIsSpending(false);
    }
  }, [isAuthenticated, walletInfo.balance]);

  // Load initial data
  useEffect(() => {
    if (isAuthenticated) {
      fetchWalletInfo();
      fetchRechargePackages();
    }
  }, [isAuthenticated, fetchWalletInfo, fetchRechargePackages]);

  return {
    // State
    walletInfo,
    transactions,
    rechargePackages,
    isLoading,
    isRecharging,
    isSpending,
    error,
    
    // Actions
    fetchWalletInfo,
    fetchTransactions,
    fetchRechargePackages,
    handleRecharge,
    handleSpend,
    
    // Computed
    hasEnoughBalance: (amount) => walletInfo.balance >= amount,
    formatBalance: (amount = walletInfo.balance) => amount.toLocaleString('vi-VN'),
  };
};

export default useWallet;
</file>

<file path="src/pages/auth/ForgotPassword.jsx">
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { ArrowLeft, Mail, CheckCircle, AlertCircle } from 'lucide-react';
import { forgotPassword } from '@/services/authService';
import { toast } from 'sonner';

// Validation schema
const forgotPasswordSchema = z.object({
  email: z.string().email('Email không hợp lệ').min(1, 'Email là bắt buộc'),
});

const ForgotPassword = () => {
  const navigate = useNavigate();
  const [isLoading, setIsLoading] = useState(false);
  const [isSuccess, setIsSuccess] = useState(false);
  const [error, setError] = useState('');
  const [resetToken, setResetToken] = useState('');
  const [showDevMode, setShowDevMode] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
    getValues,
  } = useForm({
    resolver: zodResolver(forgotPasswordSchema),
  });

  const onSubmit = async (data) => {
    try {
      setIsLoading(true);
      setError('');

      const response = await forgotPassword(data.email);

      if (response.success) {
        // Check if response contains a reset token (for development/testing)
        if (response.data?.resetToken) {
          setResetToken(response.data.resetToken);
          setShowDevMode(true);
          toast.success('Token đặt lại mật khẩu đã được tạo!');
        } else {
          // For production or when email is sent, show success message
          setIsSuccess(true);
          toast.success('Email đặt lại mật khẩu đã được gửi thành công!');
        }
      }
    } catch (err) {
      const errorMessage = err.response?.data?.message || 'Có lỗi xảy ra khi gửi email';
      setError(errorMessage);
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  if (showDevMode && resetToken) {
    const resetLink = `${window.location.origin}/reset-password?token=${resetToken}`;

    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center p-4">
        <Card className="w-full max-w-lg shadow-xl border-0">
          <CardHeader className="text-center pb-4">
            <div className="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
              <CheckCircle className="w-8 h-8 text-blue-600" />
            </div>
            <CardTitle className="text-2xl font-bold text-gray-900">
              Token đặt lại mật khẩu
            </CardTitle>
            <CardDescription className="text-gray-600">
              Chế độ phát triển - Sử dụng token dưới đây để đặt lại mật khẩu
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="p-4 bg-blue-50 rounded-lg space-y-3">
              <div>
                <p className="text-sm font-medium text-blue-800 mb-1">Token:</p>
                <div className="flex items-center gap-2">
                  <code className="flex-1 p-2 bg-white rounded text-sm font-mono text-blue-700 border">
                    {resetToken}
                  </code>
                  <Button
                    size="sm"
                    variant="outline"
                    onClick={() => navigator.clipboard.writeText(resetToken)}
                    className="shrink-0"
                  >
                    Sao chép
                  </Button>
                </div>
              </div>

              <div>
                <p className="text-sm font-medium text-blue-800 mb-1">Liên kết đặt lại:</p>
                <div className="flex items-center gap-2">
                  <code className="flex-1 p-2 bg-white rounded text-xs font-mono text-blue-700 border break-all">
                    {resetLink}
                  </code>
                  <Button
                    size="sm"
                    variant="outline"
                    onClick={() => navigator.clipboard.writeText(resetLink)}
                    className="shrink-0"
                  >
                    Sao chép
                  </Button>
                </div>
              </div>
            </div>

            <div className="space-y-3">
              <Button
                onClick={() => navigate(`/reset-password?token=${resetToken}`)}
                className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700"
              >
                Đặt lại mật khẩu ngay
              </Button>
              <Button
                variant="outline"
                onClick={() => {
                  setShowDevMode(false);
                  setResetToken('');
                }}
                className="w-full"
              >
                Quay lại
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isSuccess) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center p-4">
        <Card className="w-full max-w-md shadow-xl border-0">
          <CardHeader className="text-center pb-4">
            <div className="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
              <CheckCircle className="w-8 h-8 text-green-600" />
            </div>
            <CardTitle className="text-2xl font-bold text-gray-900">
              Email đã được gửi!
            </CardTitle>
            <CardDescription className="text-gray-600">
              Chúng tôi đã gửi liên kết đặt lại mật khẩu đến email của bạn.
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="p-4 bg-blue-50 rounded-lg">
              <p className="text-sm text-blue-800">
                <strong>Email:</strong> {getValues('email')}
              </p>
              <p className="text-sm text-blue-700 mt-2">
                Vui lòng kiểm tra hộp thư đến và thư rác. Liên kết sẽ hết hạn sau 15 phút.
              </p>
            </div>

            <div className="space-y-3">
              <Button
                onClick={() => navigate('/login')}
                className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700"
              >
                Quay lại đăng nhập
              </Button>
              <Button
                variant="outline"
                onClick={() => setIsSuccess(false)}
                className="w-full"
              >
                Gửi lại email
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center p-4">
      <Card className="w-full max-w-md shadow-xl border-0">
        <CardHeader className="text-center pb-4">
          <div className="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
            <Mail className="w-8 h-8 text-blue-600" />
          </div>
          <CardTitle className="text-2xl font-bold text-gray-900">
            Quên mật khẩu
          </CardTitle>
          <CardDescription className="text-gray-600">
            Nhập email của bạn để nhận liên kết đặt lại mật khẩu
            <br />
            <span className="text-xs text-amber-600 mt-1 block">
              💡 Lưu ý: Nếu backend trả về token trực tiếp, chế độ phát triển sẽ hiển thị token để test
            </span>
          </CardDescription>
        </CardHeader>

        <CardContent>
          <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
            {error && (
              <Alert variant="destructive">
                <AlertCircle className="h-4 w-4" />
                <AlertDescription>{error}</AlertDescription>
              </Alert>
            )}

            <div className="space-y-2">
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                placeholder="Nhập email của bạn"
                {...register('email')}
                className={errors.email ? 'border-red-500' : ''}
              />
              {errors.email && (
                <p className="text-sm text-red-600">{errors.email.message}</p>
              )}
            </div>

            <Button
              type="submit"
              className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700"
              disabled={isLoading}
            >
              {isLoading ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                  Đang gửi...
                </>
              ) : (
                <>
                  <Mail className="w-4 h-4 mr-2" />
                  Gửi liên kết đặt lại
                </>
              )}
            </Button>
          </form>

          <div className="mt-6 text-center">
            <Link
              to="/login"
              className="inline-flex items-center text-sm text-blue-600 hover:text-blue-800 transition-colors"
            >
              <ArrowLeft className="w-4 h-4 mr-1" />
              Quay lại đăng nhập
            </Link>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default ForgotPassword;
</file>

<file path="src/pages/auth/ResetPassword.jsx">
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { ArrowLeft, Lock, CheckCircle, AlertCircle, Eye, EyeOff } from 'lucide-react';
import { resetPassword } from '@/services/authService';
import { toast } from 'sonner';

// Validation schema
const resetPasswordSchema = z.object({
  password: z
    .string()
    .min(8, 'Mật khẩu phải có ít nhất 8 ký tự')
    .regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/, 'Mật khẩu phải chứa ít nhất 1 chữ hoa, 1 chữ thường và 1 số'),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: 'Mật khẩu xác nhận không khớp',
  path: ['confirmPassword'],
});

const ResetPassword = () => {
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const [isLoading, setIsLoading] = useState(false);
  const [isSuccess, setIsSuccess] = useState(false);
  const [error, setError] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [token, setToken] = useState('');

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm({
    resolver: zodResolver(resetPasswordSchema),
  });

  useEffect(() => {
    // Get token from URL parameters
    const tokenFromUrl = searchParams.get('token');
    if (tokenFromUrl) {
      setToken(tokenFromUrl);
    } else {
      setError('Token đặt lại mật khẩu không hợp lệ hoặc đã hết hạn.');
    }
  }, [searchParams]);

  const onSubmit = async (data) => {
    if (!token) {
      setError('Token đặt lại mật khẩu không hợp lệ.');
      return;
    }

    try {
      setIsLoading(true);
      setError('');

      const response = await resetPassword(token, data.password);

      console.log('Reset password response:', response); // Debug log

      if (response.success) {
        setIsSuccess(true);
        reset(); // Clear form and validation errors
        toast.success('Mật khẩu đã được đặt lại thành công!');
      }
    } catch (err) {
      let errorMessage = 'Có lỗi xảy ra khi đặt lại mật khẩu';

      if (err.response?.status === 400) {
        errorMessage = err.response?.data?.message || 'Dữ liệu không hợp lệ';
      } else if (err.response?.status === 401) {
        errorMessage = 'Token không hợp lệ hoặc đã hết hạn';
      } else if (err.response?.status === 404) {
        errorMessage = 'Không tìm thấy tài khoản';
      } else if (err.response?.data?.message) {
        errorMessage = err.response.data.message;
      }

      setError(errorMessage);
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  if (isSuccess) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-green-50 via-white to-emerald-50 flex items-center justify-center p-4">
        <Card className="w-full max-w-md shadow-xl border-0">
          <CardHeader className="text-center pb-4">
            <div className="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
              <CheckCircle className="w-8 h-8 text-green-600" />
            </div>
            <CardTitle className="text-2xl font-bold text-gray-900">
              Đặt lại mật khẩu thành công!
            </CardTitle>
            <CardDescription className="text-gray-600">
              Mật khẩu của bạn đã được cập nhật. Bạn có thể đăng nhập với mật khẩu mới.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <Button
              onClick={() => navigate('/login')}
              className="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700"
            >
              <ArrowLeft className="w-4 h-4 mr-2" />
              Đăng nhập ngay
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (!token) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-50 via-white to-orange-50 flex items-center justify-center p-4">
        <Card className="w-full max-w-md shadow-xl border-0">
          <CardHeader className="text-center pb-4">
            <div className="mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4">
              <AlertCircle className="w-8 h-8 text-red-600" />
            </div>
            <CardTitle className="text-2xl font-bold text-gray-900">
              Liên kết không hợp lệ
            </CardTitle>
            <CardDescription className="text-gray-600">
              Token đặt lại mật khẩu không hợp lệ hoặc đã hết hạn.
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              <Alert>
                <AlertCircle className="h-4 w-4" />
                <AlertDescription>
                  Vui lòng yêu cầu đặt lại mật khẩu mới từ trang đăng nhập.
                </AlertDescription>
              </Alert>
              <Button
                onClick={() => navigate('/forgot-password')}
                className="w-full"
              >
                Yêu cầu đặt lại mật khẩu
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50 flex items-center justify-center p-4">
      <Card className="w-full max-w-md shadow-xl border-0">
        <CardHeader className="text-center pb-4">
          <div className="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
            <Lock className="w-8 h-8 text-blue-600" />
          </div>
          <CardTitle className="text-2xl font-bold text-gray-900">
            Đặt lại mật khẩu
          </CardTitle>
          <CardDescription className="text-gray-600">
            Nhập mật khẩu mới cho tài khoản của bạn
          </CardDescription>
        </CardHeader>

        <CardContent>
          <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
            {error && (
              <Alert variant="destructive">
                <AlertCircle className="h-4 w-4" />
                <AlertDescription>{error}</AlertDescription>
              </Alert>
            )}

            <div className="space-y-2">
              <Label htmlFor="password">Mật khẩu mới</Label>
              <div className="relative">
                <Input
                  id="password"
                  type={showPassword ? 'text' : 'password'}
                  placeholder="Nhập mật khẩu mới"
                  {...register('password')}
                  className={errors.password ? 'border-red-500 pr-10' : 'pr-10'}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                >
                  {showPassword ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
                </button>
              </div>
              {errors.password && (
                <p className="text-sm text-red-600">{errors.password.message}</p>
              )}
            </div>

            <div className="space-y-2">
              <Label htmlFor="confirmPassword">Xác nhận mật khẩu</Label>
              <div className="relative">
                <Input
                  id="confirmPassword"
                  type={showConfirmPassword ? 'text' : 'password'}
                  placeholder="Nhập lại mật khẩu"
                  {...register('confirmPassword')}
                  className={errors.confirmPassword ? 'border-red-500 pr-10' : 'pr-10'}
                />
                <button
                  type="button"
                  onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                  className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"
                >
                  {showConfirmPassword ? <EyeOff className="w-4 h-4" /> : <Eye className="w-4 h-4" />}
                </button>
              </div>
              {errors.confirmPassword && (
                <p className="text-sm text-red-600">{errors.confirmPassword.message}</p>
              )}
            </div>

            <Button
              type="submit"
              className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700"
              disabled={isLoading}
            >
              {isLoading ? (
                <>
                  <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                  Đang cập nhật...
                </>
              ) : (
                <>
                  <Lock className="w-4 h-4 mr-2" />
                  Đặt lại mật khẩu
                </>
              )}
            </Button>
          </form>

          <div className="mt-6 text-center">
            <button
              onClick={() => navigate('/login')}
              className="inline-flex items-center text-sm text-blue-600 hover:text-blue-800 transition-colors"
            >
              <ArrowLeft className="w-4 h-4 mr-1" />
              Quay lại đăng nhập
            </button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default ResetPassword;
</file>

<file path="src/pages/billing/CreditHistory.jsx">
import React, { useState, useEffect } from 'react';
import { useSearchParams, useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { Button } from '@/components/ui/button';
import CreditHistoryList from '@/components/billing/CreditHistoryList';
import CreditHistoryFilters from '@/components/billing/CreditHistoryFilters';
import CreditSummary from '@/components/billing/CreditSummary';
import { getCreditHistory, getCreditSummary } from '@/services/creditHistoryService';
import { toast } from 'sonner';
import { ArrowLeft } from 'lucide-react';

const CreditHistoryPage = () => {
  const [searchParams, setSearchParams] = useSearchParams();
  const navigate = useNavigate();

  // Initialize filters from URL params
  const [filters, setFilters] = useState({
    page: parseInt(searchParams.get('page')) || 1,
    limit: parseInt(searchParams.get('limit')) || 20,
    type: searchParams.get('type') || '',
    category: searchParams.get('category') || '',
    startDate: searchParams.get('startDate') || '',
    endDate: searchParams.get('endDate') || '',
  });

  // Store accumulated transactions for "Load More" functionality
  const [accumulatedTransactions, setAccumulatedTransactions] = useState([]);

  // Fetch credit history
  const {
    data: historyData,
    isLoading: isLoadingHistory,
    error: historyError,
    isFetching,
  } = useQuery({
    queryKey: ['creditHistory', filters],
    queryFn: () => getCreditHistory(filters),
    keepPreviousData: true,
  });

  // Accumulate transactions when new data arrives
  useEffect(() => {
    if (historyData?.data?.transactions) {
      if (filters.page === 1) {
        // Reset accumulated data when filters change or going back to page 1
        setAccumulatedTransactions(historyData.data.transactions);
      } else {
        // Append new transactions for subsequent pages
        setAccumulatedTransactions(prev => {
          const existingIds = new Set(prev.map(t => t._id));
          const newTransactions = historyData.data.transactions.filter(
            t => !existingIds.has(t._id)
          );
          return [...prev, ...newTransactions];
        });
      }
    }
  }, [historyData, filters.page]);

  // Fetch summary
  const {
    data: summaryData,
    isLoading: isLoadingSummary,
  } = useQuery({
    queryKey: ['creditSummary', { startDate: filters.startDate, endDate: filters.endDate }],
    queryFn: () => getCreditSummary({
      startDate: filters.startDate,
      endDate: filters.endDate
    }),
  });

  // Update URL params when filters change
  useEffect(() => {
    const params = {};
    Object.entries(filters).forEach(([key, value]) => {
      if (value) {
        params[key] = value.toString();
      }
    });
    setSearchParams(params, { replace: true });
  }, [filters, setSearchParams]);

  // Show error toast
  useEffect(() => {
    if (historyError) {
      toast.error('Không thể tải lịch sử giao dịch', {
        description: historyError.response?.data?.message || 'Vui lòng thử lại sau',
      });
    }
  }, [historyError]);

  const handleFilterChange = (newFilters) => {
    setFilters((prev) => ({
      ...prev,
      ...newFilters,
      page: 1, // Reset to first page when filters change
    }));
    // Reset accumulated transactions when filters change
    setAccumulatedTransactions([]);
  };

  const handleClearFilters = () => {
    setFilters({
      page: 1,
      limit: 20,
      type: '',
      category: '',
      startDate: '',
      endDate: '',
    });
    // Reset accumulated transactions
    setAccumulatedTransactions([]);
  };

  const handleLoadMore = () => {
    setFilters((prev) => ({
      ...prev,
      page: prev.page + 1,
    }));
  };

  return (
    <div className="container mx-auto py-8 px-4 max-w-7xl">
      <div className="mb-6">
        <div className="flex items-center gap-4 mb-6">
          <Button
            variant="ghost"
            size="sm"
            onClick={() => navigate(-1)}
            className="flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors"
          >
            <ArrowLeft className="h-4 w-4" />
            Quay lại
          </Button>
        </div>
        <div>
          <h1 className="text-3xl font-bold mb-2">Lịch sử giao dịch xu</h1>
          <p className="text-muted-foreground">
            Theo dõi tất cả các giao dịch nạp xu và sử dụng xu của bạn
          </p>
        </div>
      </div>

      <div className="space-y-6">
        {/* Summary Statistics */}
        <CreditSummary
          summary={summaryData?.data}
          isLoading={isLoadingSummary}
        />

        {/* Filters */}
        <CreditHistoryFilters
          filters={filters}
          onFilterChange={handleFilterChange}
          onClearFilters={handleClearFilters}
        />

        {/* Transaction List */}
        <CreditHistoryList
          transactions={accumulatedTransactions}
          pagination={historyData?.data?.pagination}
          isLoading={isLoadingHistory && filters.page === 1}
          isLoadingMore={isFetching && filters.page > 1}
          onLoadMore={handleLoadMore}
        />
      </div>
    </div>
  );
};

export default CreditHistoryPage;
</file>

<file path="src/pages/company/CompanyList.jsx">
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { Skeleton } from '@/components/ui/skeleton';
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';
import {
  Building,
  MapPin,
  Users,
  Search,
  ChevronLeft,
  ChevronRight,
  Briefcase
} from 'lucide-react';
import { getAllCompanies } from '@/services/companyService';

const CompanyList = () => {
  const navigate = useNavigate();
  const [currentPage, setCurrentPage] = useState(1);
  const [searchQuery, setSearchQuery] = useState('');
  const [searchInput, setSearchInput] = useState('');
  const companiesPerPage = 12;

  // Fetch companies
  const { data: companiesData, isLoading } = useQuery({
    queryKey: ['companies', currentPage, searchQuery],
    queryFn: async () => {
      const response = await getAllCompanies({
        page: currentPage,
        limit: companiesPerPage,
        search: searchQuery || undefined
      });
      return response.data;
    },
    keepPreviousData: true
  });

  const handleSearch = (e) => {
    e.preventDefault();
    setSearchQuery(searchInput);
    setCurrentPage(1);
  };

  const handleClearSearch = () => {
    setSearchInput('');
    setSearchQuery('');
    setCurrentPage(1);
  };

  const handleCompanyClick = (companyId) => {
    navigate(`/company/${companyId}`);
  };

  return (
    <div className="container py-10 max-w-7xl">
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-4xl font-bold mb-2">Danh sách công ty</h1>
        <p className="text-muted-foreground">
          Khám phá các công ty hàng đầu đang tuyển dụng
        </p>
      </div>

      {/* Search Bar */}
      <Card className="mb-8">
        <CardContent className="pt-6">
          <form onSubmit={handleSearch} className="flex gap-2">
            <Input
              placeholder="Tìm kiếm công ty theo tên..."
              value={searchInput}
              onChange={(e) => setSearchInput(e.target.value)}
              className="flex-1"
            />
            <Button type="submit">
              <Search className="h-4 w-4 mr-2" />
              Tìm kiếm
            </Button>
          </form>
        </CardContent>
      </Card>

      {/* Companies Grid */}
      {isLoading ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {[1, 2, 3, 4, 5, 6].map((i) => (
            <CompanyCardSkeleton key={i} />
          ))}
        </div>
      ) : companiesData?.data?.length > 0 ? (
        <>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            {companiesData.data.map((company) => (
              <CompanyCard
                key={company._id}
                company={company}
                onClick={() => handleCompanyClick(company._id)}
              />
            ))}
          </div>

          {/* Pagination */}
          {companiesData.meta && companiesData.meta.totalPages > 1 && (
            <div className="flex justify-center items-center gap-2">
              <Button
                variant="outline"
                size="sm"
                onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                disabled={currentPage === 1}
              >
                <ChevronLeft className="h-4 w-4" />
              </Button>
              
              <span className="text-sm text-muted-foreground">
                Trang {currentPage} / {companiesData.meta.totalPages}
              </span>
              
              <Button
                variant="outline"
                size="sm"
                onClick={() => setCurrentPage(p => Math.min(companiesData.meta.totalPages, p + 1))}
                disabled={currentPage === companiesData.meta.totalPages}
              >
                <ChevronRight className="h-4 w-4" />
              </Button>
            </div>
          )}
        </>
      ) : (
        <Card>
          <CardContent className="py-20">
            <div className="text-center">
              <Building className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
              <p className="text-muted-foreground mb-4">
                {searchQuery ? 'Không tìm thấy công ty phù hợp' : 'Chưa có công ty nào'}
              </p>
              {searchQuery && (
                <Button
                  variant="outline"
                  size="sm"
                  onClick={handleClearSearch}
                >
                  Xóa bộ lọc
                </Button>
              )}
            </div>
          </CardContent>
        </Card>
      )}
    </div>
  );
};

// Company Card Component
const CompanyCard = ({ company, onClick }) => {
  return (
    <Card
      onClick={onClick}
      className="cursor-pointer hover:shadow-lg hover:border-primary transition-all duration-300"
    >
      <CardContent className="pt-6">
        <div className="flex flex-col items-center text-center mb-4">
          <Avatar className="h-20 w-20 mb-4 rounded-lg">
            <AvatarImage src={company.logo} alt={company.name} />
            <AvatarFallback className="rounded-lg text-2xl">
              <Building className="h-10 w-10" />
            </AvatarFallback>
          </Avatar>
          
          <h3 className="font-bold text-lg mb-2 line-clamp-2 hover:text-primary transition-colors">
            {company.name}
          </h3>
          
          {company.industry && (
            <Badge variant="secondary" className="mb-3">
              <Briefcase className="h-3 w-3 mr-1" />
              {company.industry}
            </Badge>
          )}
        </div>

        <div className="space-y-2 text-sm text-muted-foreground">
          {company.size && (
            <div className="flex items-center gap-2">
              <Users className="h-4 w-4 flex-shrink-0" />
              <span>{company.size}</span>
            </div>
          )}
          
          {company.location && (
            <div className="flex items-center gap-2">
              <MapPin className="h-4 w-4 flex-shrink-0" />
              <span className="line-clamp-1">
                {company.location.province}
              </span>
            </div>
          )}
        </div>

        {company.about && (
          <p className="text-sm text-muted-foreground mt-4 line-clamp-3">
            {company.about}
          </p>
        )}
      </CardContent>
    </Card>
  );
};

// Skeleton Component
const CompanyCardSkeleton = () => (
  <Card>
    <CardContent className="pt-6">
      <div className="flex flex-col items-center">
        <Skeleton className="h-20 w-20 rounded-lg mb-4" />
        <Skeleton className="h-6 w-3/4 mb-2" />
        <Skeleton className="h-4 w-1/2 mb-4" />
        <div className="w-full space-y-2">
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-full" />
        </div>
      </div>
    </CardContent>
  </Card>
);

export default CompanyList;
</file>

<file path="src/pages/cv/CVBuilderPage.jsx">
import React from 'react';
import CVListPage from './CVListPage';

/**
 * Trang CV Builder
 * Wrapper cho CVListPage với header riêng
 */
const CVBuilderPage = () => {
  return (
    <div className="container mx-auto p-4 md:p-8">
      <div className="mb-6">
        <h1 className="text-3xl font-bold tracking-tight text-gray-900 mb-2">
          CV Builder
        </h1>
        <p className="text-gray-600">
          Tạo CV chuyên nghiệp với các template có sẵn
        </p>
      </div>

      <CVListPage />
    </div>
  );
};

export default CVBuilderPage;
</file>

<file path="src/pages/cv/CVManagementPage.jsx">
import React, { useState, useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import CVListPage from './CVListPage';
import UploadedCVManager from '@/components/cv/UploadedCVManager';
import { FileEdit, Upload } from 'lucide-react';

/**
 * Trang quản lý CV tổng hợp
 * Bao gồm cả CV builder và CV upload
 */
const CVManagementPage = () => {
  const [searchParams, setSearchParams] = useSearchParams();
  const tabFromUrl = searchParams.get('tab');
  const [activeTab, setActiveTab] = useState(tabFromUrl || 'builder');

  // Sync tab with URL
  useEffect(() => {
    if (tabFromUrl && (tabFromUrl === 'builder' || tabFromUrl === 'uploaded')) {
      setActiveTab(tabFromUrl);
    }
  }, [tabFromUrl]);

  const handleTabChange = (value) => {
    setActiveTab(value);
    setSearchParams({ tab: value });
  };

  return (
    <div className="container mx-auto p-4 md:p-8">
      <div className="mb-6">
        <h1 className="text-3xl font-bold tracking-tight text-gray-900 mb-2">
          Quản lý CV
        </h1>
        <p className="text-gray-600">
          Tạo CV mới hoặc quản lý CV đã tải lên
        </p>
      </div>

      <Tabs value={activeTab} onValueChange={handleTabChange} className="w-full">
        <TabsList className="grid w-full max-w-md grid-cols-2 mb-6">
          <TabsTrigger value="builder" className="flex items-center gap-2">
            <FileEdit className="h-4 w-4" />
            CV Builder
          </TabsTrigger>
          <TabsTrigger value="uploaded" className="flex items-center gap-2">
            <Upload className="h-4 w-4" />
            CV đã tải lên
          </TabsTrigger>
        </TabsList>

        <TabsContent value="builder" className="mt-0 space-y-0">
          <div className="space-y-6">
            <CVListPage />
          </div>
        </TabsContent>

        <TabsContent value="uploaded" className="mt-0">
          <UploadedCVManager />
        </TabsContent>
      </Tabs>
    </div>
  );
};

export default CVManagementPage;
</file>

<file path="src/pages/cv/UploadedCVPage.jsx">
import React from 'react';
import UploadedCVManager from '@/components/cv/UploadedCVManager';

/**
 * Trang quản lý CV đã upload
 */
const UploadedCVPage = () => {
  return (
    <div className="container mx-auto p-4 md:p-8">
      <div className="mb-6">
        <h1 className="text-3xl font-bold tracking-tight text-gray-900 mb-2">
          CV đã tải lên
        </h1>
        <p className="text-gray-600">
          Quản lý các CV bạn đã tải lên từ file PDF
        </p>
      </div>

      <UploadedCVManager />
    </div>
  );
};

export default UploadedCVPage;
</file>

<file path="src/pages/jobs/components/MapView/index.js">
export { default as JobMapView } from './JobMapView';
export { default as JobMarkerPopup } from './JobMarkerPopup';
</file>

<file path="src/pages/jobs/components/MapView/JobMapView_NEW.jsx">
import React, { useEffect, useState, useRef, useCallback } from 'react';
import { MapContainer, TileLayer, Marker, Popup, useMap, useMapEvents } from 'react-leaflet';
import MarkerClusterGroup from 'react-leaflet-cluster';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import { Card, CardContent } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { MapPin, Navigation, Loader2, RefreshCw } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import JobMarkerPopup from './JobMarkerPopup';
import { cn } from '@/lib/utils';
import { searchJobsHybrid } from '@/services/jobService';
import { toast } from 'sonner';

// Fix Leaflet default icon issue with Vite/Webpack
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
});

// Custom marker icons
const createCustomIcon = (color = '#FF6B35') => {
  return L.divIcon({
    className: 'custom-marker',
    html: `
      <div style="
        background-color: ${color};
        width: 32px;
        height: 32px;
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border: 3px solid white;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
      ">
        <div style="
          transform: rotate(45deg);
          color: white;
          font-size: 16px;
          margin-top: -4px;
        ">📍</div>
      </div>
    `,
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -32],
  });
};

const userIcon = L.divIcon({
  className: 'user-marker',
  html: `
    <div style="
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite;
    ">
      <div style="color: white; font-size: 20px;">📍</div>
    </div>
    <style>
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }
    </style>
  `,
  iconSize: [40, 40],
  iconAnchor: [20, 20],
  popupAnchor: [0, -20],
});

/**
 * MapEventHandler - Handle map move and fetch data for current viewport
 */
const MapEventHandler = ({ onMapMove, searchFilters }) => {
  const map = useMap();
  const debounceTimerRef = useRef(null);

  useMapEvents({
    moveend: () => {
      // Debounce: Wait 500ms after user stops moving
      if (debounceTimerRef.current) {
        clearTimeout(debounceTimerRef.current);
      }

      debounceTimerRef.current = setTimeout(() => {
        const bounds = map.getBounds();
        const center = map.getCenter();
        const zoom = map.getZoom();

        onMapMove({
          bounds: {
            north: bounds.getNorth(),
            south: bounds.getSouth(),
            east: bounds.getEast(),
            west: bounds.getWest(),
          },
          center: {
            lat: center.lat,
            lng: center.lng,
          },
          zoom,
        });
      }, 500); // 500ms debounce
    },
  });

  return null;
};

/**
 * JobMapView - Interactive map view with marker clustering and dynamic data loading
 * Loads jobs based on current viewport (no pagination needed)
 */
const JobMapView = ({
  initialJobs = [],
  isLoading: initialLoading = false,
  userLocation = null,
  searchFilters = {}, // All search filters from parent
  className
}) => {
  const [mapCenter, setMapCenter] = useState([21.0285, 105.8542]); // Hanoi default
  const [mapZoom, setMapZoom] = useState(12);
  const [jobs, setJobs] = useState(initialJobs);
  const [isLoadingJobs, setIsLoadingJobs] = useState(false);
  const [totalJobsInView, setTotalJobsInView] = useState(0);
  const mapRef = useRef(null);

  // Update jobs when initialJobs changes (first load)
  useEffect(() => {
    if (initialJobs && initialJobs.length > 0) {
      setJobs(initialJobs);
    }
  }, [initialJobs]);

  // Update map center based on user location or first job
  useEffect(() => {
    if (userLocation) {
      try {
        const coords = JSON.parse(userLocation);
        if (coords && coords.length === 2) {
          setMapCenter([coords[1], coords[0]]); // [lat, lng]
          setMapZoom(13);
        }
      } catch (error) {
        console.error('Failed to parse user location:', error);
      }
    } else if (jobs.length > 0 && jobs[0].location?.coordinates?.coordinates) {
      const [lng, lat] = jobs[0].location.coordinates.coordinates;
      setMapCenter([lat, lng]);
      setMapZoom(12);
    }
  }, [userLocation, jobs]);

  /**
   * Fetch jobs for current viewport
   */
  const fetchJobsForViewport = useCallback(async (mapState) => {
    setIsLoadingJobs(true);

    try {
      // Calculate distance from center to edge (approximate radius in km)
      const latDiff = mapState.bounds.north - mapState.bounds.south;
      const lngDiff = mapState.bounds.east - mapState.bounds.west;
      const avgDiff = (latDiff + lngDiff) / 2;
      const radiusKm = Math.ceil(avgDiff * 111); // 1 degree ≈ 111 km

      // Prepare search params with viewport center and radius
      const params = {
        ...searchFilters,
        latitude: mapState.center.lat,
        longitude: mapState.center.lng,
        distance: Math.max(radiusKm, 10), // Minimum 10km
        page: 1,
        size: 200, // Load more jobs for map view (no pagination UI)
      };

      console.log('Fetching jobs for viewport:', params);

      const response = await searchJobsHybrid(params);

      if (response && response.data) {
        setJobs(response.data);
        setTotalJobsInView(response.meta?.totalItems || response.data.length);
      }
    } catch (error) {
      console.error('Error fetching jobs for viewport:', error);
      toast.error('Không thể tải công việc cho khu vực này');
    } finally {
      setIsLoadingJobs(false);
    }
  }, [searchFilters]);

  /**
   * Handle map move event (debounced)
   */
  const handleMapMove = useCallback((mapState) => {
    console.log('Map moved to:', mapState);
    fetchJobsForViewport(mapState);
  }, [fetchJobsForViewport]);

  /**
   * Manual refresh
   */
  const handleRefresh = () => {
    if (mapRef.current) {
      const map = mapRef.current;
      const bounds = map.getBounds();
      const center = map.getCenter();
      const zoom = map.getZoom();

      handleMapMove({
        bounds: {
          north: bounds.getNorth(),
          south: bounds.getSouth(),
          east: bounds.getEast(),
          west: bounds.getWest(),
        },
        center: {
          lat: center.lat,
          lng: center.lng,
        },
        zoom,
      });
    }
  };

  // Get user coordinates for marker
  const getUserCoords = () => {
    if (!userLocation) return null;
    try {
      const coords = JSON.parse(userLocation);
      if (coords && coords.length === 2) {
        return [coords[1], coords[0]]; // [lat, lng]
      }
    } catch (error) {
      console.error('Failed to parse user location:', error);
    }
    return null;
  };

  // Recenter map to user location
  const handleRecenterToUser = () => {
    const coords = getUserCoords();
    if (coords && mapRef.current) {
      mapRef.current.setView(coords, 13, {
        animate: true,
        duration: 1
      });
    }
  };

  if (initialLoading) {
    return (
      <Card className={cn("h-[700px]", className)}>
        <CardContent className="p-0 h-full">
          <Skeleton className="w-full h-full rounded-lg" />
        </CardContent>
      </Card>
    );
  }

  // Filter jobs with valid coordinates
  const validJobs = jobs.filter(
    (job) => job.location?.coordinates?.coordinates &&
    job.location.coordinates.coordinates.length === 2
  );

  const userCoords = getUserCoords();

  return (
    <Card className={cn(
      "h-[700px] overflow-hidden",
      "border-2 border-border/50 shadow-xl shadow-primary/5",
      "bg-card/95 backdrop-blur-sm",
      className
    )}>
      <CardContent className="p-0 h-full relative">
        {/* Map container */}
        <MapContainer
          center={mapCenter}
          zoom={mapZoom}
          className="h-full w-full rounded-lg"
          ref={mapRef}
          zoomControl={true}
          scrollWheelZoom={true}
        >
          {/* OpenStreetMap Tile Layer */}
          <TileLayer
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            maxZoom={19}
          />

          {/* Map Event Handler for viewport-based loading */}
          <MapEventHandler 
            onMapMove={handleMapMove}
            searchFilters={searchFilters}
          />

          {/* User location marker */}
          {userCoords && (
            <Marker position={userCoords} icon={userIcon}>
              <Popup>
                <div className="p-2 text-center">
                  <div className="flex items-center gap-2 mb-1">
                    <Navigation className="h-4 w-4 text-primary" />
                    <span className="font-semibold text-sm">Vị trí của bạn</span>
                  </div>
                  <p className="text-xs text-muted-foreground">
                    {userCoords[0].toFixed(6)}, {userCoords[1].toFixed(6)}
                  </p>
                </div>
              </Popup>
            </Marker>
          )}

          {/* Job markers with clustering */}
          <MarkerClusterGroup
            chunkedLoading
            maxClusterRadius={60}
            spiderfyOnMaxZoom={true}
            showCoverageOnHover={false}
            zoomToBoundsOnClick={true}
            iconCreateFunction={(cluster) => {
              const count = cluster.getChildCount();
              let size = 'small';
              let colorClass = 'bg-primary';

              if (count > 50) {
                size = 'large';
                colorClass = 'bg-red-500';
              } else if (count > 20) {
                size = 'medium';
                colorClass = 'bg-orange-500';
              }

              const sizeMap = {
                small: 'w-10 h-10 text-sm',
                medium: 'w-12 h-12 text-base',
                large: 'w-14 h-14 text-lg'
              };

              return L.divIcon({
                html: `
                  <div class="${sizeMap[size]} ${colorClass} rounded-full flex items-center justify-center text-white font-bold border-4 border-white shadow-lg">
                    ${count}
                  </div>
                `,
                className: 'custom-cluster-icon',
                iconSize: L.point(40, 40, true),
              });
            }}
          >
            {validJobs.map((job) => {
              const [lng, lat] = job.location.coordinates.coordinates;
              return (
                <Marker
                  key={job._id}
                  position={[lat, lng]}
                  icon={createCustomIcon('#FF6B35')}
                >
                  <Popup
                    maxWidth={340}
                    minWidth={320}
                    closeButton={true}
                    className="job-marker-popup"
                  >
                    <JobMarkerPopup job={job} />
                  </Popup>
                </Marker>
              );
            })}
          </MarkerClusterGroup>
        </MapContainer>

        {/* Loading Overlay */}
        {isLoadingJobs && (
          <div className="absolute top-20 left-1/2 -translate-x-1/2 z-[1000]">
            <Badge className="bg-primary/90 text-white px-4 py-2 shadow-lg">
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              Đang tải công việc...
            </Badge>
          </div>
        )}

        {/* Recenter button (floating) */}
        {userCoords && (
          <div className="absolute bottom-6 right-6 z-[1000] flex flex-col gap-2">
            <Button
              onClick={handleRecenterToUser}
              size="icon"
              className={cn(
                "btn-gradient text-white shadow-xl",
                "hover:scale-110 transition-all duration-300",
                "border-2 border-white/20"
              )}
              title="Về vị trí của tôi"
            >
              <Navigation className="h-5 w-5" />
            </Button>
            
            <Button
              onClick={handleRefresh}
              size="icon"
              variant="secondary"
              className={cn(
                "shadow-xl",
                "hover:scale-110 transition-all duration-300",
                "border-2 border-white/20"
              )}
              title="Làm mới khu vực này"
              disabled={isLoadingJobs}
            >
              <RefreshCw className={cn(
                "h-5 w-5",
                isLoadingJobs && "animate-spin"
              )} />
            </Button>
          </div>
        )}

        {/* Job count indicator */}
        <div className="absolute top-4 left-4 z-[1000]">
          <Card className="bg-card/90 backdrop-blur-sm border-2 border-border shadow-lg">
            <CardContent className="p-3 flex items-center gap-2">
              <MapPin className="h-5 w-5 text-primary" />
              <div>
                <p className="text-sm font-semibold text-foreground">
                  {validJobs.length} công việc
                </p>
                <p className="text-xs text-muted-foreground">
                  trong khu vực này
                </p>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Help text when no filters */}
        {!searchFilters.latitude && !searchFilters.distance && (
          <div className="absolute bottom-6 left-6 z-[1000] max-w-xs">
            <Card className="bg-card/90 backdrop-blur-sm border-2 border-primary/30 shadow-lg">
              <CardContent className="p-3">
                <p className="text-xs text-muted-foreground">
                  💡 <span className="font-semibold">Mẹo:</span> Di chuyển bản đồ để khám phá công việc ở các khu vực khác nhau. Dữ liệu sẽ tự động cập nhật!
                </p>
              </CardContent>
            </Card>
          </div>
        )}
      </CardContent>

      {/* Custom CSS for popup and clustering */}
      <style>{`
        .job-marker-popup .leaflet-popup-content-wrapper {
          padding: 0;
          border-radius: 0.5rem;
          overflow: hidden;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .job-marker-popup .leaflet-popup-content {
          margin: 0;
          width: 320px !important;
        }
        .job-marker-popup .leaflet-popup-tip {
          background: white;
        }
        .custom-marker {
          background: transparent;
          border: none;
        }
        .user-marker {
          background: transparent;
          border: none;
        }
        .custom-cluster-icon {
          background: transparent;
          border: none;
        }
        .marker-cluster {
          background-color: transparent !important;
        }
      `}</style>
    </Card>
  );
};

export default JobMapView;
</file>

<file path="src/pages/jobs/components/MapView/JobMapView_OLD.jsx">
import React, { useEffect, useState, useRef } from 'react';
import { MapContainer, TileLayer, Marker, Popup, useMap } from 'react-leaflet';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import { Card, CardContent } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { MapPin, Navigation } from 'lucide-react';
import { Button } from '@/components/ui/button';
import JobMarkerPopup from './JobMarkerPopup';
import { cn } from '@/lib/utils';

// Fix Leaflet default icon issue with Vite/Webpack
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
});

// Custom marker icons
const createCustomIcon = (color = '#FF6B35') => {
  return L.divIcon({
    className: 'custom-marker',
    html: `
      <div style="
        background-color: ${color};
        width: 32px;
        height: 32px;
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border: 3px solid white;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
      ">
        <div style="
          transform: rotate(45deg);
          color: white;
          font-size: 16px;
          margin-top: -4px;
        ">📍</div>
      </div>
    `,
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -32],
  });
};

const userIcon = L.divIcon({
  className: 'user-marker',
  html: `
    <div style="
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite;
    ">
      <div style="color: white; font-size: 20px;">📍</div>
    </div>
    <style>
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }
    </style>
  `,
  iconSize: [40, 40],
  iconAnchor: [20, 20],
  popupAnchor: [0, -20],
});

/**
 * Component to auto-fit map bounds to markers
 */
const MapBounds = ({ jobs, userLocation }) => {
  const map = useMap();

  useEffect(() => {
    const bounds = [];

    // Add user location to bounds
    if (userLocation) {
      try {
        const coords = JSON.parse(userLocation);
        if (coords && coords.length === 2) {
          bounds.push([coords[1], coords[0]]); // [lat, lng]
        }
      } catch (error) {
        console.error('Failed to parse user location:', error);
      }
    }

    // Add job locations to bounds
    jobs.forEach((job) => {
      if (job.location?.coordinates?.coordinates) {
        const [lng, lat] = job.location.coordinates.coordinates;
        if (lat && lng) {
          bounds.push([lat, lng]);
        }
      }
    });

    // Fit bounds if we have markers
    if (bounds.length > 0) {
      map.fitBounds(bounds, {
        padding: [50, 50],
        maxZoom: 13,
      });
    }
  }, [jobs, userLocation, map]);

  return null;
};

/**
 * JobMapView - Interactive map view for job search results
 * Displays jobs as markers on a map using Leaflet and Goong Maps API
 */
const JobMapView = ({
  jobs = [],
  isLoading = false,
  userLocation = null,
  className
}) => {
  const [mapCenter, setMapCenter] = useState([21.0285, 105.8542]); // Hanoi default
  const [mapZoom, setMapZoom] = useState(12);
  const mapRef = useRef(null);

  // Update map center based on user location or first job
  useEffect(() => {
    if (userLocation) {
      try {
        const coords = JSON.parse(userLocation);
        if (coords && coords.length === 2) {
          setMapCenter([coords[1], coords[0]]); // [lat, lng]
          setMapZoom(13);
        }
      } catch (error) {
        console.error('Failed to parse user location:', error);
      }
    } else if (jobs.length > 0 && jobs[0].location?.coordinates?.coordinates) {
      const [lng, lat] = jobs[0].location.coordinates.coordinates;
      setMapCenter([lat, lng]);
      setMapZoom(12);
    }
  }, [userLocation, jobs]);

  // Get user coordinates for marker
  const getUserCoords = () => {
    if (!userLocation) return null;
    try {
      const coords = JSON.parse(userLocation);
      if (coords && coords.length === 2) {
        return [coords[1], coords[0]]; // [lat, lng]
      }
    } catch (error) {
      console.error('Failed to parse user location:', error);
    }
    return null;
  };

  // Recenter map to user location
  const handleRecenterToUser = () => {
    const coords = getUserCoords();
    if (coords && mapRef.current) {
      mapRef.current.setView(coords, 13, {
        animate: true,
        duration: 1
      });
    }
  };

  if (isLoading) {
    return (
      <Card className={cn("h-[700px]", className)}>
        <CardContent className="p-0 h-full">
          <Skeleton className="w-full h-full rounded-lg" />
        </CardContent>
      </Card>
    );
  }

  // Filter jobs with valid coordinates
  const validJobs = jobs.filter(
    (job) => job.location?.coordinates?.coordinates &&
    job.location.coordinates.coordinates.length === 2
  );

  const userCoords = getUserCoords();

  return (
    <Card className={cn(
      "h-[700px] overflow-hidden",
      "border-2 border-border/50 shadow-xl shadow-primary/5",
      "bg-card/95 backdrop-blur-sm",
      className
    )}>
      <CardContent className="p-0 h-full relative">
        {/* Map container */}
        <MapContainer
          center={mapCenter}
          zoom={mapZoom}
          className="h-full w-full rounded-lg"
          ref={mapRef}
          zoomControl={true}
          scrollWheelZoom={true}
        >
          {/* OpenStreetMap Tile Layer */}
          <TileLayer
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            maxZoom={19}
          />
          
          {/* To use Goong Maps instead, replace above TileLayer with:
            <TileLayer
              attribution='&copy; <a href="https://www.goong.io/">Goong</a>'
              url={`https://tiles.goong.io/assets/goong_map_web.json?api_key=${YOUR_GOONG_API_KEY}`}
            />
          */}

          {/* User location marker */}
          {userCoords && (
            <Marker position={userCoords} icon={userIcon}>
              <Popup>
                <div className="p-2 text-center">
                  <div className="flex items-center gap-2 mb-1">
                    <Navigation className="h-4 w-4 text-primary" />
                    <span className="font-semibold text-sm">Vị trí của bạn</span>
                  </div>
                  <p className="text-xs text-muted-foreground">
                    {userCoords[0].toFixed(6)}, {userCoords[1].toFixed(6)}
                  </p>
                </div>
              </Popup>
            </Marker>
          )}

          {/* Job markers */}
          {validJobs.map((job) => {
            const [lng, lat] = job.location.coordinates.coordinates;
            return (
              <Marker
                key={job._id}
                position={[lat, lng]}
                icon={createCustomIcon('#FF6B35')}
              >
                <Popup
                  maxWidth={340}
                  minWidth={320}
                  closeButton={true}
                  className="job-marker-popup"
                >
                  <JobMarkerPopup job={job} />
                </Popup>
              </Marker>
            );
          })}

          {/* Auto-fit bounds */}
          <MapBounds jobs={validJobs} userLocation={userLocation} />
        </MapContainer>

        {/* Recenter button (floating) */}
        {userCoords && (
          <div className="absolute bottom-6 right-6 z-[1000]">
            <Button
              onClick={handleRecenterToUser}
              size="icon"
              className={cn(
                "btn-gradient text-white shadow-xl",
                "hover:scale-110 transition-all duration-300",
                "border-2 border-white/20"
              )}
              title="Về vị trí của tôi"
            >
              <Navigation className="h-5 w-5" />
            </Button>
          </div>
        )}

        {/* Job count indicator */}
        <div className="absolute top-4 left-4 z-[1000]">
          <Card className="bg-card/90 backdrop-blur-sm border-2 border-border shadow-lg">
            <CardContent className="p-3 flex items-center gap-2">
              <MapPin className="h-5 w-5 text-primary" />
              <div>
                <p className="text-sm font-semibold text-foreground">
                  {validJobs.length} công việc
                </p>
                <p className="text-xs text-muted-foreground">
                  trên bản đồ
                </p>
              </div>
            </CardContent>
          </Card>
        </div>
      </CardContent>

      {/* Custom CSS for popup styling */}
      <style>{`
        .job-marker-popup .leaflet-popup-content-wrapper {
          padding: 0;
          border-radius: 0.5rem;
          overflow: hidden;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .job-marker-popup .leaflet-popup-content {
          margin: 0;
          width: 320px !important;
        }
        .job-marker-popup .leaflet-popup-tip {
          background: white;
        }
        .custom-marker {
          background: transparent;
          border: none;
        }
        .user-marker {
          background: transparent;
          border: none;
        }
      `}</style>
    </Card>
  );
};

export default JobMapView;
</file>

<file path="src/pages/jobs/components/MapView/JobMarkerPopup.jsx">
import React from 'react';
import { useNavigate } from 'react-router-dom';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';
import {
  MapPin,
  DollarSign,
  Briefcase,
  Building,
  ArrowRight,
  Clock
} from 'lucide-react';
import { cn } from '@/lib/utils';
import { formatSalary, formatTimeAgo } from '@/utils/formatters';

/**
 * JobMarkerPopup - Compact job information popup for map markers
 * Displays essential job details when clicking on a marker
 */
const JobMarkerPopup = ({ job }) => {
  const navigate = useNavigate();

  const handleViewDetails = (e) => {
    e.stopPropagation();
    navigate(`/jobs/${job._id}`);
  };

  // Format location string
  const locationString = [
    job.location?.district,
    job.location?.province
  ].filter(Boolean).join(', ');

  // Get salary range
  const salaryRange = formatSalary(job.minSalary, job.maxSalary);

  return (
    <div className="w-[320px] bg-card rounded-lg shadow-lg overflow-hidden">
      {/* Header with company info */}
      <div className="p-4 bg-gradient-to-r from-primary/10 to-primary/5 border-b border-border">
        <div className="flex items-start gap-3">
          <Avatar className="h-12 w-12 border-2 border-background shadow-sm">
            <AvatarImage
              src={job.company?.logo}
              alt={job.company?.name}
            />
            <AvatarFallback className="bg-primary/10 text-primary font-bold">
              {job.company?.name?.charAt(0) || 'C'}
            </AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0">
            <h3 className="font-bold text-sm text-foreground line-clamp-2 mb-1">
              {job.title}
            </h3>
            <div className="flex items-center gap-1.5 text-xs text-muted-foreground">
              <Building className="h-3.5 w-3.5 flex-shrink-0" />
              <span className="truncate">{job.company?.name}</span>
            </div>
          </div>
        </div>
      </div>

      {/* Job details */}
      <div className="p-4 space-y-3">
        {/* Location */}
        <div className="flex items-start gap-2">
          <MapPin className="h-4 w-4 text-primary mt-0.5 flex-shrink-0" />
          <span className="text-sm text-muted-foreground line-clamp-1">
            {locationString || 'Chưa cập nhật'}
          </span>
        </div>

        {/* Salary */}
        {salaryRange && (
          <div className="flex items-center gap-2">
            <DollarSign className="h-4 w-4 text-green-600 flex-shrink-0" />
            <span className="text-sm font-semibold text-green-600">
              {salaryRange}
            </span>
          </div>
        )}

        {/* Experience & Type */}
        <div className="flex flex-wrap gap-2">
          {job.experience && (
            <Badge variant="outline" className="text-xs">
              <Briefcase className="h-3 w-3 mr-1" />
              {job.experience.replace(/_/g, ' ')}
            </Badge>
          )}
          {job.type && (
            <Badge variant="outline" className="text-xs">
              {job.type.replace(/_/g, ' ')}
            </Badge>
          )}
          {job.workType && (
            <Badge variant="secondary" className="text-xs">
              {job.workType.replace(/_/g, ' ')}
            </Badge>
          )}
        </div>

        {/* Deadline */}
        {job.deadline && (
          <div className="flex items-center gap-2 text-xs text-muted-foreground">
            <Clock className="h-3.5 w-3.5 flex-shrink-0" />
            <span>
              Hạn nộp: {formatTimeAgo(job.deadline)}
            </span>
          </div>
        )}
      </div>

      {/* Action button */}
      <div className="p-4 pt-0">
        <Button
          onClick={handleViewDetails}
          className={cn(
            "w-full btn-gradient text-white font-semibold",
            "hover:scale-[1.02] transition-all duration-300",
            "shadow-lg shadow-primary/20"
          )}
          size="sm"
        >
          Xem chi tiết
          <ArrowRight className="h-4 w-4 ml-2" />
        </Button>
      </div>
    </div>
  );
};

export default JobMarkerPopup;
</file>

<file path="src/pages/jobs/components/MapView/MAP_VIEW_IMPLEMENTATION.md">
# 🗺️ Map View Feature - Implementation Summary

## ✅ Completed Tasks

### 1. ✅ Cài đặt Dependencies
- `leaflet` - Library bản đồ tương tác
- `react-leaflet` - React wrapper cho Leaflet
```bash
npm install leaflet react-leaflet
```

### 2. ✅ Tạo Components

#### `JobMarkerPopup.jsx` (140 lines)
- Popup compact 320px width
- Hiển thị thông tin công việc: title, company, location, salary, badges
- Button "Xem chi tiết" navigate đến job detail page
- Sử dụng shadcn/ui components (Badge, Button, Avatar)
- Semantic colors và responsive design

#### `JobMapView.jsx` (290 lines)
- MapContainer với Leaflet
- Custom markers cho jobs (red-orange) và user location (purple gradient)
- Auto-fit bounds để hiển thị tất cả markers
- Floating recenter button
- Job count indicator card
- Loading skeleton state
- Touch-friendly controls
- Popup với JobMarkerPopup component

#### `index.js`
- Export barrel file cho MapView components

### 3. ✅ Tích hợp vào JobSearch.jsx

**Changes made:**
- Import `Map`, `List` icons từ lucide-react
- Import `JobMapView` component
- Thêm state `viewMode` ('list' | 'map')
- Thêm View Mode Toggle buttons trong Results Header
- Conditional rendering: List View hoặc Map View
- Pass props: `jobs`, `isLoading`, `userLocation` vào JobMapView

### 4. ✅ Styling

**`index.css` additions:**
```css
/* Leaflet Map Styles */
@layer components {
  .leaflet-container { @apply rounded-lg; }
  .leaflet-popup-content-wrapper { @apply rounded-lg shadow-xl; }
  /* Custom marker animations */
  @keyframes marker-bounce { ... }
}
```

### 5. ✅ Documentation

**Files created:**
- `README.md` (300+ lines) - Comprehensive documentation
- `testData.js` - Sample data cho testing

## 🎨 UI/UX Features

### View Mode Toggle
- 2 buttons: "Danh sách" và "Bản đồ"
- Button active có gradient styling (`btn-gradient`)
- Smooth transition animations
- Icon + Text labels
- Label "Hiển thị:" trước buttons

### Map Interface
- **Job Markers**: Red-orange (#FF6B35) droplet shape với icon 📍
- **User Marker**: Purple gradient circle với pulse animation
- **Hover Effects**: Bounce animation trên markers
- **Zoom Controls**: Built-in Leaflet controls
- **Recenter Button**: Floating button phía dưới bên phải
- **Job Counter**: Floating card phía trên bên trái

### Popup Design
- Clean card layout với gradient header
- Company logo với fallback
- Job title (max 2 lines)
- Location with MapPin icon
- Salary in green với DollarSign icon
- Badge tags cho experience, type, workType
- Deadline với Clock icon
- Gradient "Xem chi tiết" button

## 🔧 Technical Details

### Data Flow
```
JobSearch (page)
  ↓ (viewMode === 'map')
JobMapView (container)
  ↓ (render markers)
Marker + Popup
  ↓ (content)
JobMarkerPopup (presentational)
```

### Props Interface

**JobMapView:**
```typescript
{
  jobs: Array<Job>,          // Array of job objects with coordinates
  isLoading: boolean,        // Loading state
  userLocation: string,      // JSON string "[lng, lat]"
  className?: string         // Custom CSS classes
}
```

**JobMarkerPopup:**
```typescript
{
  job: Job                   // Single job object
}
```

### Coordinate System
- **MongoDB GeoJSON**: `[longitude, latitude]` (x, y)
- **Leaflet**: `[latitude, longitude]` (y, x)
- **Conversion** handled trong component

### Tile Provider
- **Default**: OpenStreetMap (free, no API key required)
- **Alternative**: Goong Maps (cần API key)
- **Future**: Mapbox, Google Maps

## 📊 Performance Considerations

1. **Lazy Loading**: Map chỉ render khi `viewMode === 'map'`
2. **Marker Filtering**: Chỉ render jobs có coordinates hợp lệ
3. **Memoization**: `useMemo` cho user coords calculation
4. **No Clustering**: OK cho <100 markers, cần clustering cho hàng ngàn
5. **Pagination**: Map view vẫn sử dụng pagination từ API

## 🎯 User Experience Flow

1. User vào trang Job Search
2. Thực hiện search với query/filters
3. Mặc định: Xem danh sách
4. Click "Bản đồ" button → Switch to Map View
5. Map hiển thị với auto-fit bounds
6. Click marker → Popup shows
7. Click "Xem chi tiết" → Navigate to job detail
8. Click "Danh sách" button → Back to List View

## 🔒 Data Requirements

### API Response Structure
```javascript
{
  data: [
    {
      _id: string,
      title: string,
      location: {
        province: string,
        district: string,
        coordinates: {
          type: "Point",
          coordinates: [number, number] // [lng, lat]
        }
      },
      company: {
        name: string,
        logo: string
      },
      minSalary: { $numberDecimal: string },
      maxSalary: { $numberDecimal: string },
      experience: string,
      type: string,
      workType: string,
      deadline: string (ISO date)
    }
  ]
}
```

### Required Fields for Map View
- ✅ `_id` - Unique identifier
- ✅ `location.coordinates.coordinates` - [lng, lat]
- ⚠️ Other fields optional (có fallback)

## 🚀 Testing Checklist

- [x] Install dependencies
- [x] Create components
- [x] Integrate into JobSearch
- [x] Add styling
- [ ] Test with real API data
- [ ] Test with user location
- [ ] Test without coordinates
- [ ] Test empty state
- [ ] Test loading state
- [ ] Test error state
- [ ] Test mobile responsive
- [ ] Test marker clustering (nhiều jobs)

## 📝 Next Steps

### Immediate
1. Test trong dev environment
2. Verify API response format
3. Test với real user geolocation
4. Check performance với nhiều markers

### Future Enhancements
1. **Marker Clustering**: Thêm `react-leaflet-cluster` cho nhiều jobs
2. **Custom Tiles**: Integrate Goong Maps API key
3. **Draw Tools**: Cho phép user vẽ circle/polygon để search
4. **Heatmap**: Density visualization
5. **Filters on Map**: Có thể filter ngay trên map
6. **Dark Mode**: Custom tile style cho dark theme
7. **Save View State**: Remember user's preferred view mode

## 🐛 Known Issues

1. **ESLint warnings** trong `index.css` - Harmless, CSS sẽ compile OK
2. **Goong Maps tile URL** - Chưa config API key (using OpenStreetMap)
3. **No marker clustering** - Cần add nếu có >100 markers

## 📦 Files Changed/Created

### Created:
- `src/pages/jobs/components/MapView/JobMapView.jsx`
- `src/pages/jobs/components/MapView/JobMarkerPopup.jsx`
- `src/pages/jobs/components/MapView/index.js`
- `src/pages/jobs/components/MapView/README.md`
- `src/pages/jobs/components/MapView/testData.js`
- `src/pages/jobs/components/MapView/MAP_VIEW_IMPLEMENTATION.md` (this file)

### Modified:
- `src/pages/jobs/JobSearch.jsx` (imports, state, render)
- `src/index.css` (Leaflet styles)
- `package.json` (dependencies)

## 💡 Key Design Decisions

1. **Leaflet over Mapbox**: Nhẹ hơn, open source, không cần API key
2. **OpenStreetMap tiles**: Free, reliable, không limit
3. **Popup thay vì Tooltip**: Cho phép interaction với buttons
4. **Auto-fit bounds**: Better UX, user thấy all markers ngay
5. **Conditional rendering**: Performance optimization
6. **Semantic colors**: Consistent với design system
7. **shadcn/ui components**: Giữ consistency với codebase

## 🎓 Learning Resources

- [Leaflet Docs](https://leafletjs.com/)
- [React Leaflet](https://react-leaflet.js.org/)
- [OpenStreetMap](https://www.openstreetmap.org/)
- [Goong Maps API](https://docs.goong.io/)

---

**Implementation Date**: January 2025  
**Status**: ✅ Complete and Ready for Testing  
**Estimated Time**: ~2 hours  
**Lines of Code**: ~700 lines
</file>

<file path="src/pages/jobs/components/MapView/QUICK_REFERENCE.md">
# 🚀 Quick Reference Guide - Map View Feature

## 1. Basic Usage

```jsx
import JobMapView from './components/MapView/JobMapView';

const [viewMode, setViewMode] = useState('list'); // or 'map'

<JobMapView
  jobs={searchResults?.data || []}
  isLoading={isLoading}
  userLocation={userLocationParam} // "[lng, lat]" format
/>
```

## 2. Required Data Structure

```javascript
const jobData = {
  _id: "string",
  title: "string",
  location: {
    province: "string",
    district: "string",
    coordinates: {
      type: "Point",
      coordinates: [longitude, latitude] // [number, number]
    }
  },
  company: {
    name: "string",
    logo: "url"
  },
  minSalary: { $numberDecimal: "string" },
  maxSalary: { $numberDecimal: "string" },
  experience: "SENIOR_LEVEL",
  type: "FULL_TIME",
  workType: "HYBRID",
  deadline: "2026-01-30T23:59:59.000Z"
};
```

## 3. User Location Format

```javascript
// Must be JSON string: "[longitude, latitude]"
const userLocation = "[105.8342, 21.0278]"; // Hanoi center
```

## 4. Customization

### Change marker color
```javascript
// In JobMapView.jsx
const createCustomIcon = (color = '#YOUR_COLOR') => {
  // ...
}
```

### Use Goong Maps tiles
```jsx
<TileLayer
  url={`https://tiles.goong.io/.../api_key=${API_KEY}`}
/>
```

### Adjust popup size
```jsx
<Popup maxWidth={400} minWidth={320}>
```

### Change default center
```javascript
const [mapCenter, setMapCenter] = useState([lat, lng]);
const [mapZoom, setMapZoom] = useState(12);
```

## 5. Testing with Sample Data

```javascript
import { sampleMapJobs, sampleUserLocation } from './testData';

<JobMapView
  jobs={sampleMapJobs}
  isLoading={false}
  userLocation={sampleUserLocation}
/>
```

## 6. Common Issues & Fixes

### ❌ Markers not showing
**Fix:** Check coordinates format `[lng, lat]`
```javascript
console.log(job.location.coordinates.coordinates);
```

### ❌ Map not loading
**Fix:** Ensure CSS imported
```javascript
import 'leaflet/dist/leaflet.css';
```

### ❌ Popup cut off
**Fix:** Adjust z-index or maxWidth

## 7. Performance Tips

### Add marker clustering (for 100+ jobs)
```bash
npm install react-leaflet-cluster
```

```jsx
import MarkerClusterGroup from 'react-leaflet-cluster';

<MarkerClusterGroup>
  {jobs.map(job => <Marker key={job._id} ... />)}
</MarkerClusterGroup>
```

## 8. Keyboard Shortcuts

- `+/-` : Zoom in/out
- `Arrow keys` : Pan map
- `Shift + Drag` : Zoom to area

## 9. Mobile Gestures

- **Pinch** : Zoom
- **Drag** : Pan
- **Double tap** : Zoom in

## 10. Useful Leaflet Methods

```javascript
const mapRef = useRef(null);
const map = mapRef.current;

// Programmatic controls
map.panTo([lat, lng]);
map.setZoom(15);
map.fitBounds([[lat1, lng1], [lat2, lng2]]);

// Get current state
const center = map.getCenter();
const zoom = map.getZoom();
```

## File Structure

```
src/pages/jobs/components/MapView/
├── JobMapView.jsx              → Main map component
├── JobMarkerPopup.jsx          → Popup content
├── index.js                    → Exports
├── testData.js                 → Sample data
├── README.md                   → Full documentation
├── MAP_VIEW_IMPLEMENTATION.md  → Technical details
└── QUICK_REFERENCE.md          → This file
```

## Dependencies

```json
{
  "leaflet": "^1.9.x",
  "react-leaflet": "^4.x"
}
```

## Browser Support

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+
- ✅ Mobile browsers

---

**Version:** 1.0.0  
**Status:** Production Ready  
**Last Updated:** January 2025
</file>

<file path="src/pages/jobs/components/MapView/README.md">
# 🗺️ Job Search Map View

## Tổng quan
Tính năng tìm kiếm việc làm dựa trên bản đồ cho phép người dùng tìm kiếm và xem các công việc một cách trực quan trên bản đồ. Đây là một tính năng chuyên nghiệp đặc biệt hữu ích cho các công việc yêu cầu làm việc tại chỗ.

## ✨ Tính năng chính

### 1. **Hai chế độ xem**
- **Xem danh sách**: Hiển thị kết quả tìm kiếm dạng danh sách truyền thống
- **Xem bản đồ**: Hiển thị các công việc dưới dạng markers trên bản đồ tương tác

### 2. **Markers tùy chỉnh**
- **Job Markers**: Markers màu đỏ cam (#FF6B35) hình giọt nước cho các công việc
- **User Marker**: Marker gradient tím với animation pulse cho vị trí người dùng
- **Hover Effects**: Animation bounce khi hover vào markers

### 3. **Popup thông tin chi tiết**
Khi click vào một marker, hiển thị popup với:
- Logo và tên công ty
- Tiêu đề công việc
- Địa điểm làm việc
- Mức lương
- Loại công việc (Full-time, Part-time, etc.)
- Hình thức làm việc (Remote, On-site, Hybrid)
- Kinh nghiệm yêu cầu
- Hạn nộp hồ sơ
- Button "Xem chi tiết"

### 4. **Auto-fit bounds**
Bản đồ tự động zoom và pan để hiển thị tất cả các markers (công việc + vị trí người dùng)

### 5. **Recenter button**
Button floating "Về vị trí của tôi" để nhanh chóng quay về vị trí người dùng

### 6. **Job count indicator**
Card floating hiển thị số lượng công việc đang hiển thị trên bản đồ

## 🏗️ Cấu trúc Components

```
src/pages/jobs/components/MapView/
├── JobMapView.jsx          # Component bản đồ chính
├── JobMarkerPopup.jsx      # Component popup thông tin công việc
└── index.js                # Export file
```

### JobMapView.jsx
Component chính quản lý:
- Leaflet MapContainer với TileLayer từ OpenStreetMap
- Render job markers và user location marker
- Auto-fit bounds cho tất cả markers
- Floating buttons (recenter, job count)
- Loading states

**Props:**
- `jobs` (Array): Danh sách công việc với coordinates
- `isLoading` (Boolean): Trạng thái loading
- `userLocation` (String): Vị trí người dùng dạng JSON string `"[lng, lat]"`
- `className` (String): Custom CSS classes

### JobMarkerPopup.jsx
Component popup hiển thị thông tin công việc:
- Compact design (320px width)
- Company avatar với fallback
- Job details với icons
- Action button để xem chi tiết

**Props:**
- `job` (Object): Object công việc từ API

## 🔧 Cài đặt

### Dependencies đã cài đặt
```bash
npm install leaflet react-leaflet
```

### CSS Import
CSS của Leaflet đã được import trong `JobMapView.jsx`:
```javascript
import 'leaflet/dist/leaflet.css';
```

Custom styles được thêm vào `src/index.css`:
```css
/* Leaflet Map Styles */
@layer components {
  .leaflet-container { @apply rounded-lg; }
  .leaflet-popup-content-wrapper { @apply rounded-lg shadow-xl; }
  /* ... */
}
```

## 📝 Cách sử dụng

### 1. Trong JobSearch.jsx

```jsx
import JobMapView from './components/MapView/JobMapView';

// State để toggle view mode
const [viewMode, setViewMode] = useState('list'); // 'list' or 'map'

// Toggle buttons
<Button onClick={() => setViewMode('list')}>
  <List /> Danh sách
</Button>
<Button onClick={() => setViewMode('map')}>
  <Map /> Bản đồ
</Button>

// Conditional rendering
{viewMode === 'list' ? (
  <JobResultsList jobs={jobs} ... />
) : (
  <JobMapView
    jobs={jobs}
    isLoading={isLoading}
    userLocation={userLocationParam}
  />
)}
```

### 2. Dữ liệu yêu cầu

API phải trả về job objects với structure:
```javascript
{
  _id: "...",
  title: "...",
  location: {
    province: "Thành phố Hà Nội",
    district: "Quận Cầu Giấy",
    coordinates: {
      type: "Point",
      coordinates: [105.833, 21.034] // [longitude, latitude]
    }
  },
  company: {
    name: "...",
    logo: "..."
  },
  minSalary: { $numberDecimal: "..." },
  maxSalary: { $numberDecimal: "..." },
  experience: "SENIOR_LEVEL",
  type: "FULL_TIME",
  workType: "HYBRID",
  deadline: "2026-01-30T23:59:59.000Z"
}
```

**Quan trọng**: `location.coordinates.coordinates` phải có format `[longitude, latitude]` (MongoDB GeoJSON format)

## 🎨 Customization

### 1. Thay đổi màu markers
```javascript
// Trong JobMapView.jsx
const createCustomIcon = (color = '#YOUR_COLOR') => {
  // ...
}
```

### 2. Thay đổi tile provider
```jsx
// Sử dụng Goong Maps
<TileLayer
  url="https://tiles.goong.io/assets/goong_map_web.json?api_key=YOUR_KEY"
/>

// Hoặc Google Maps style
<TileLayer
  url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
/>
```

### 3. Custom popup size
```jsx
<Popup
  maxWidth={400}  // Thay đổi width
  minWidth={320}
  closeButton={true}
>
```

### 4. Custom map center và zoom
```javascript
const [mapCenter, setMapCenter] = useState([21.0285, 105.8542]); // Hanoi
const [mapZoom, setMapZoom] = useState(12);
```

## 🌐 Tile Providers

### OpenStreetMap (Mặc định - Free)
```jsx
<TileLayer
  attribution='&copy; OpenStreetMap'
  url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
/>
```

### Goong Maps (Việt Nam)
Cần API key từ https://goong.io/
```jsx
<TileLayer
  url={`https://tiles.goong.io/assets/goong_map_web.json?api_key=${GOONG_API_KEY}`}
/>
```

### Mapbox (Premium)
Cần access token từ https://mapbox.com/
```jsx
<TileLayer
  url={`https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=${MAPBOX_TOKEN}`}
  id="mapbox/streets-v11"
/>
```

## 🔍 Lọc công việc trên bản đồ

Jobs được filter tự động trong component:
```javascript
const validJobs = jobs.filter(
  (job) => job.location?.coordinates?.coordinates &&
  job.location.coordinates.coordinates.length === 2
);
```

Chỉ các jobs có coordinates hợp lệ mới được hiển thị.

## 🚀 Performance Tips

1. **Lazy load bản đồ**: Map component chỉ render khi `viewMode === 'map'`
2. **Memoization**: Sử dụng `useMemo` cho computed values
3. **Marker clustering**: Với hàng ngàn markers, cân nhắc thêm marker clustering
4. **Pagination**: Map view vẫn sử dụng pagination từ API

## 🐛 Troubleshooting

### Issue: Markers không hiển thị
**Solution**: Kiểm tra `job.location.coordinates.coordinates` có đúng format `[lng, lat]`

### Issue: Map không load
**Solution**: Kiểm tra CSS của Leaflet đã được import chưa

### Issue: Popup bị crop
**Solution**: Thêm `z-index` cao hơn cho `.leaflet-popup-pane`

### Issue: Icons bị lỗi
**Solution**: Icons được fix bằng CDN trong code:
```javascript
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://cdnjs.cloudflare.com/...',
  // ...
});
```

## 📱 Responsive Design

- Map height: `700px` on all screens
- Popup width: `320px` (fixed)
- Touch-friendly controls
- Mobile-optimized zoom controls

## 🎯 Tương lai

Các tính năng có thể mở rộng:
- [ ] Marker clustering cho nhiều jobs
- [ ] Draw circle để search trong radius
- [ ] Heatmap density view
- [ ] Custom map styles (dark mode)
- [ ] Save favorite locations
- [ ] Directions to job location
- [ ] Street view integration

## 📄 License

Component này sử dụng:
- **Leaflet**: BSD-2-Clause License
- **React Leaflet**: Hippocratic License 2.1
- **OpenStreetMap data**: ODbL License

---

**Created by**: AI Assistant  
**Date**: January 2025  
**Version**: 1.0.0
</file>

<file path="src/pages/jobs/components/MapView/testData.js">
/**
 * Sample job data for testing Map View
 * Copy from actual API response structure
 */

export const sampleMapJobs = [
  {
    "_id": "686ff5e761fa499835c4921e",
    "title": "Kỹ Sư Xử Lý Ngôn Ngữ Tự Nhiên (NLP Scientist)",
    "category": "MACHINE_LEARNING",
    "type": "FULL_TIME",
    "workType": "HYBRID",
    "experience": "SENIOR_LEVEL",
    "location": {
      "province": "Thành phố Hà Nội",
      "district": "Quận Cầu Giấy",
      "commune": "",
      "coordinates": {
        "type": "Point",
        "coordinates": [105.83385489269594, 21.034591883707684]
      }
    },
    "minSalary": { "$numberDecimal": "35000000" },
    "maxSalary": { "$numberDecimal": "45000000" },
    "deadline": "2026-01-30T23:59:59.000Z",
    "company": {
      "name": "Tech Recruiters",
      "logo": "https://cdn-new.topcv.vn/unsafe/200x/https://static.topcv.vn/company_logos/s8mPaU5bIBYQXz3sIh3Mp40jEgcz6GrS_1741078962____c015e06ae6183c910ffe00e4576225d5.jpg"
    },
    "isSaved": false
  },
  {
    "_id": "686ff53b61fa499835c491ef",
    "title": "Kỹ Sư Machine Learning",
    "category": "MACHINE_LEARNING",
    "type": "FULL_TIME",
    "workType": "HYBRID",
    "experience": "SENIOR_LEVEL",
    "location": {
      "province": "Thành phố Hà Nội",
      "district": "Quận Cầu Giấy",
      "commune": "",
      "coordinates": {
        "type": "Point",
        "coordinates": [105.8390165212915, 21.02455180631623]
      }
    },
    "minSalary": { "$numberDecimal": "35000000" },
    "maxSalary": { "$numberDecimal": "45000000" },
    "deadline": "2026-01-30T23:59:59.000Z",
    "company": {
      "name": "Vietcomreal",
      "logo": "https://cdn-new.topcv.vn/unsafe/150x/https://static.topcv.vn/company_logos/1uZo3gBu9veW394FSLiJBu2jSzQIXHpe_1753072977____85156a070b498c81dfbf525141891454.jpg"
    },
    "isSaved": false
  },
  {
    "_id": "686ff55261fa499835c49200",
    "title": "Kỹ Sư DevOps Cao Cấp (Senior DevOps Engineer)",
    "category": "IT",
    "type": "FULL_TIME",
    "workType": "REMOTE",
    "experience": "SENIOR_LEVEL",
    "location": {
      "province": "Thành phố Hồ Chí Minh",
      "district": "Thành phố Thủ Đức",
      "commune": "",
      "coordinates": {
        "type": "Point",
        "coordinates": [106.65519593915579, 10.764412812608558]
      }
    },
    "minSalary": { "$numberDecimal": "32000000" },
    "maxSalary": { "$numberDecimal": "42000000" },
    "deadline": "2025-12-15T23:59:59.000Z",
    "company": {
      "name": "PVN",
      "logo": "https://cdn-new.topcv.vn/unsafe/200x/https://static.topcv.vn/company_logos/s8mPaU5bIBYQXz3sIh3Mp40jEgcz6GrS_1741078962____c015e06ae6183c910ffe00e4576225d5.jpg"
    },
    "isSaved": false
  },
  {
    "_id": "686ff55261fa499835c491fe",
    "title": "Trưởng Nhóm Kỹ Thuật (Tech Lead)",
    "category": "SOFTWARE_DEVELOPMENT",
    "type": "FULL_TIME",
    "workType": "HYBRID",
    "experience": "SENIOR_LEVEL",
    "location": {
      "province": "Thành phố Hồ Chí Minh",
      "district": "Quận 1",
      "commune": "",
      "coordinates": {
        "type": "Point",
        "coordinates": [106.66421220091637, 10.761766448614589]
      }
    },
    "minSalary": { "$numberDecimal": "38000000" },
    "maxSalary": { "$numberDecimal": "50000000" },
    "deadline": "2026-01-10T23:59:59.000Z",
    "company": {
      "name": "Hyundai Thành Công",
      "logo": "https://cdn-new.topcv.vn/unsafe/200x/https://static.topcv.vn/company_logos/68bfb4520b1b41757394002.png"
    },
    "isSaved": false
  }
];

export const sampleUserLocation = "[105.8342, 21.0278]"; // Hà Nội center
</file>

<file path="src/pages/jobs/components/SearchInterface/SalaryRangeSlider.jsx">
import React, { useState, useEffect } from 'react';
import { Slider } from '@/components/ui/slider';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { DollarSign, ChevronDown, ChevronUp } from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * SalaryRangeSlider component with dual-handle slider
 * Professional salary range filter with visual feedback
 */
const SalaryRangeSlider = ({
  minSalary = '',
  maxSalary = '',
  onChange,
  className = ''
}) => {
  const [isExpanded, setIsExpanded] = useState(false);
  const [localRange, setLocalRange] = useState([0, 100]);
  const [manualMin, setManualMin] = useState('');
  const [manualMax, setManualMax] = useState('');

  // Salary configuration (in millions VND)
  const MIN_SALARY = 0;
  const MAX_SALARY = 100; // 100 triệu
  const STEP = 1;

  // Convert millions to display format
  const formatSalary = (value) => {
    if (value === 0) return 'Tất cả';
    if (value >= MAX_SALARY) return `${MAX_SALARY}+ triệu`;
    return `${value} triệu`;
  };

  // Initialize from props
  useEffect(() => {
    const min = minSalary ? parseInt(minSalary, 10) / 1000000 : MIN_SALARY;
    const max = maxSalary ? parseInt(maxSalary, 10) / 1000000 : MAX_SALARY;
    
    setLocalRange([Math.max(MIN_SALARY, Math.min(min, MAX_SALARY)), Math.max(MIN_SALARY, Math.min(max, MAX_SALARY))]);
    setManualMin(min > 0 ? min.toString() : '');
    setManualMax(max < MAX_SALARY ? max.toString() : '');
  }, [minSalary, maxSalary]);

  // Handle slider change (only update local state, don't trigger search)
  const handleSliderChange = (newRange) => {
    setLocalRange(newRange);
    setManualMin(newRange[0] > 0 ? newRange[0].toString() : '');
    setManualMax(newRange[1] < MAX_SALARY ? newRange[1].toString() : '');
    // Don't call onChange here - wait for Apply button
  };

  // Handle manual input
  const handleManualMinChange = (value) => {
    const numValue = value.replace(/[^0-9]/g, '');
    setManualMin(numValue);
  };

  const handleManualMaxChange = (value) => {
    const numValue = value.replace(/[^0-9]/g, '');
    setManualMax(numValue);
  };

  // Apply filter - this is the ONLY place that triggers search
  const handleApply = () => {
    const min = manualMin ? Math.max(MIN_SALARY, Math.min(parseInt(manualMin, 10), MAX_SALARY)) : localRange[0];
    const max = manualMax ? Math.max(min, Math.min(parseInt(manualMax, 10), MAX_SALARY)) : localRange[1];
    
    setLocalRange([min, max]);
    
    // Only trigger search when Apply button is clicked
    onChange({
      minSalary: min > 0 ? (min * 1000000).toString() : '',
      maxSalary: max < MAX_SALARY ? (max * 1000000).toString() : ''
    });
  };

  // Clear filter
  const handleClear = () => {
    setLocalRange([MIN_SALARY, MAX_SALARY]);
    setManualMin('');
    setManualMax('');
    onChange({ minSalary: '', maxSalary: '' });
  };

  const hasActiveFilter = localRange[0] > MIN_SALARY || localRange[1] < MAX_SALARY;

  return (
    <div className={cn("space-y-3", className)}>
      {/* Header */}
      <div 
        className={cn(
          "flex items-center justify-between cursor-pointer group",
          "p-3 rounded-lg hover:bg-primary/5 transition-all duration-300"
        )}
        onClick={() => setIsExpanded(!isExpanded)}
      >
        <div className="flex items-center gap-2">
          <div className={cn(
            "flex items-center justify-center w-8 h-8 rounded-lg",
            "bg-gradient-to-br from-emerald-500/20 to-green-500/10",
            "border border-emerald-500/30 transition-all duration-300",
            "group-hover:scale-110"
          )}>
            <DollarSign className="h-4 w-4 text-emerald-600" />
          </div>
          <div>
            <h3 className="text-sm font-bold text-foreground">Mức lương</h3>
            {hasActiveFilter && (
              <p className="text-xs text-muted-foreground">
                {formatSalary(localRange[0])} - {formatSalary(localRange[1])}
              </p>
            )}
          </div>
        </div>
        
        <div className="flex items-center gap-2">
          {hasActiveFilter && (
            <Button
              variant="ghost"
              size="sm"
              onClick={(e) => {
                e.stopPropagation();
                handleClear();
              }}
              className={cn(
                "h-7 px-2 text-xs rounded-lg",
                "text-red-600 hover:text-red-700 hover:bg-red-50/50"
              )}
            >
              Xóa
            </Button>
          )}
          {isExpanded ? (
            <ChevronUp className="h-4 w-4 text-muted-foreground transition-transform duration-300" />
          ) : (
            <ChevronDown className="h-4 w-4 text-muted-foreground transition-transform duration-300" />
          )}
        </div>
      </div>

      {/* Expanded Content */}
      {isExpanded && (
        <div className="space-y-4 animate-in slide-in-from-top-2 duration-300">
          {/* Range Display */}
          <div className="flex items-center justify-between px-3">
            <div className="text-center">
              <p className="text-xs text-muted-foreground mb-1">Tối thiểu</p>
              <p className={cn(
                "text-lg font-bold bg-gradient-to-r from-emerald-600 to-green-600",
                "bg-clip-text text-transparent"
              )}>
                {formatSalary(localRange[0])}
              </p>
            </div>
            <div className="flex-1 mx-4">
              <div className="h-0.5 bg-gradient-to-r from-emerald-500 to-green-500" />
            </div>
            <div className="text-center">
              <p className="text-xs text-muted-foreground mb-1">Tối đa</p>
              <p className={cn(
                "text-lg font-bold bg-gradient-to-r from-emerald-600 to-green-600",
                "bg-clip-text text-transparent"
              )}>
                {formatSalary(localRange[1])}
              </p>
            </div>
          </div>

          {/* Slider */}
          <div className="px-3 py-4">
            <Slider
              value={localRange}
              onValueChange={handleSliderChange}
              min={MIN_SALARY}
              max={MAX_SALARY}
              step={STEP}
              className="w-full"
            />
          </div>

          {/* Manual Input */}
          <div className="grid grid-cols-2 gap-3 px-3">
            <div className="space-y-1">
              <Label htmlFor="manual-min" className="text-xs text-muted-foreground">
                Từ (triệu VND)
              </Label>
              <Input
                id="manual-min"
                type="text"
                placeholder="0"
                value={manualMin}
                onChange={(e) => handleManualMinChange(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter') handleApply();
                }}
                className="h-9 text-sm"
              />
            </div>
            <div className="space-y-1">
              <Label htmlFor="manual-max" className="text-xs text-muted-foreground">
                Đến (triệu VND)
              </Label>
              <Input
                id="manual-max"
                type="text"
                placeholder="100+"
                value={manualMax}
                onChange={(e) => handleManualMaxChange(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter') handleApply();
                }}
                className="h-9 text-sm"
              />
            </div>
          </div>

          {/* Apply Button */}
          <div className="px-3">
            <Button
              onClick={handleApply}
              size="sm"
              className={cn(
                "w-full h-10 rounded-lg font-semibold",
                "bg-gradient-to-r from-emerald-600 to-green-600",
                "hover:from-emerald-700 hover:to-green-700",
                "transition-all duration-300 hover:scale-105"
              )}
            >
              Áp dụng
            </Button>
          </div>

          {/* Quick Presets */}
          <div className="flex flex-wrap gap-2 px-3">
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setLocalRange([0, 10]);
                setManualMin('');
                setManualMax('10');
              }}
              className="text-xs h-7 rounded-lg hover:bg-emerald-50"
            >
              &lt; 10tr
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setLocalRange([10, 20]);
                setManualMin('10');
                setManualMax('20');
              }}
              className="text-xs h-7 rounded-lg hover:bg-emerald-50"
            >
              10-20tr
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setLocalRange([20, 30]);
                setManualMin('20');
                setManualMax('30');
              }}
              className="text-xs h-7 rounded-lg hover:bg-emerald-50"
            >
              20-30tr
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setLocalRange([30, 50]);
                setManualMin('30');
                setManualMax('50');
              }}
              className="text-xs h-7 rounded-lg hover:bg-emerald-50"
            >
              30-50tr
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={() => {
                setLocalRange([50, 100]);
                setManualMin('50');
                setManualMax('');
              }}
              className="text-xs h-7 rounded-lg hover:bg-emerald-50"
            >
              50tr+
            </Button>
          </div>
        </div>
      )}
    </div>
  );
};

export default SalaryRangeSlider;
</file>

<file path="src/pages/jobs/components/SearchResults/ResultsPagination.jsx">
import React from 'react';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight } from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * ResultsPagination component
 * Handles pagination for search results with page navigation and size selection
 */
const ResultsPagination = ({
  currentPage = 1,
  totalPages = 1,
  totalResults = 0,
  pageSize = 10,
  onPageChange,
  onPageSizeChange,
  className,
  showPageSizeSelector = false
}) => {
  // Don't render if there's only one page or no results
  if (totalPages <= 1 && totalResults <= pageSize) {
    return null;
  }

  /**
   * Generate page numbers to display
   * Shows: First, Previous, Current-2, Current-1, Current, Current+1, Current+2, Next, Last
   */
  const getPageNumbers = () => {
    const delta = 2; // Number of pages to show on each side of current page
    const pages = [];
    const rangeStart = Math.max(2, currentPage - delta);
    const rangeEnd = Math.min(totalPages - 1, currentPage + delta);

    // Always show first page
    if (totalPages > 1) {
      pages.push(1);
    }

    // Add ellipsis if there's a gap between first page and range start
    if (rangeStart > 2) {
      pages.push('...');
    }

    // Add pages in range
    for (let i = rangeStart; i <= rangeEnd; i++) {
      if (i !== 1 && i !== totalPages) {
        pages.push(i);
      }
    }

    // Add ellipsis if there's a gap between range end and last page
    if (rangeEnd < totalPages - 1) {
      pages.push('...');
    }

    // Always show last page (if different from first)
    if (totalPages > 1) {
      pages.push(totalPages);
    }

    return pages;
  };

  /**
   * Handle page change
   * @param {number} page - Page number to navigate to
   */
  const handlePageChange = (page) => {
    if (page >= 1 && page <= totalPages && page !== currentPage) {
      onPageChange(page);
    }
  };

  /**
   * Handle page size change
   * @param {string} newSize - New page size
   */
  const handlePageSizeChange = (newSize) => {
    if (onPageSizeChange) {
      onPageSizeChange(parseInt(newSize));
    }
  };

  const pageNumbers = getPageNumbers();

  return (
    <div className={cn("flex flex-col gap-4 items-center", className)}>
      {/* Results Summary */}


      <div className="flex flex-col sm:flex-row items-center gap-4">
        {/* Page Size Selector */}
        {showPageSizeSelector && onPageSizeChange && (
          <div className="flex items-center gap-2">
            <span className="text-sm text-muted-foreground">Hiển thị:</span>
            <Select value={pageSize.toString()} onValueChange={handlePageSizeChange}>
              <SelectTrigger className="w-20 h-8">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="10">10</SelectItem>
                <SelectItem value="20">20</SelectItem>
                <SelectItem value="50">50</SelectItem>
              </SelectContent>
            </Select>
            <span className="text-sm text-muted-foreground">/ trang</span>
          </div>
        )}

        {/* Pagination Controls */}
        <div className="flex items-center gap-1">
          {/* First Page */}
          <Button
            variant="outline"
            size="icon"
            onClick={() => handlePageChange(1)}
            disabled={currentPage === 1}
            className="h-8 w-8"
          >
            <ChevronsLeft className="h-4 w-4" />
          </Button>

          {/* Previous Page */}
          <Button
            variant="outline"
            size="icon"
            onClick={() => handlePageChange(currentPage - 1)}
            disabled={currentPage === 1}
            className="h-8 w-8"
          >
            <ChevronLeft className="h-4 w-4" />
          </Button>

          {/* Page Numbers */}
          <div className="flex items-center gap-1">
            {pageNumbers.map((page, index) => {
              if (page === '...') {
                return (
                  <span key={`ellipsis-${index}`} className="px-2 py-1 text-muted-foreground">
                    ...
                  </span>
                );
              }

              return (
                <Button
                  key={page}
                  variant={currentPage === page ? "default" : "outline"}
                  size="icon"
                  onClick={() => handlePageChange(page)}
                  className={cn(
                    "h-8 w-8",
                    currentPage === page && "bg-primary text-primary-foreground"
                  )}
                >
                  {page}
                </Button>
              );
            })}
          </div>

          {/* Next Page */}
          <Button
            variant="outline"
            size="icon"
            onClick={() => handlePageChange(currentPage + 1)}
            disabled={currentPage === totalPages}
            className="h-8 w-8"
          >
            <ChevronRight className="h-4 w-4" />
          </Button>

          {/* Last Page */}
          <Button
            variant="outline"
            size="icon"
            onClick={() => handlePageChange(totalPages)}
            disabled={currentPage === totalPages}
            className="h-8 w-8"
          >
            <ChevronsRight className="h-4 w-4" />
          </Button>
        </div>
      </div>

      {/* Mobile-friendly page info */}
      <div className="sm:hidden text-xs text-muted-foreground text-center">
        Trang {currentPage} / {totalPages}
      </div>
    </div>
  );
};

export default ResultsPagination;
</file>

<file path="src/pages/jobs/components/SearchStates/SearchEmpty.jsx">
import React from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Search, Filter, RefreshCw } from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * SearchEmpty component
 * Displays empty state when no search results are found
 */
const SearchEmpty = ({
  query = '',
  hasFilters = false,
  onClearFilters,
  onNewSearch,
  className
}) => {
  /**
   * Get appropriate empty state content based on context
   */
  const getEmptyContent = () => {
    if (query && hasFilters) {
      return {
        icon: <Filter className="h-16 w-16 text-muted-foreground" />,
        title: "Không tìm thấy việc làm phù hợp",
        message: `Không có kết quả nào phù hợp với "${query}" và các bộ lọc đã chọn. Hãy thử điều chỉnh bộ lọc hoặc tìm kiếm với từ khóa khác.`,
        actions: [
          {
            label: "Xóa bộ lọc",
            variant: "outline",
            onClick: onClearFilters
          },
          {
            label: "Tìm kiếm mới",
            variant: "default",
            onClick: onNewSearch
          }
        ]
      };
    }

    if (query) {
      return {
        icon: <Search className="h-16 w-16 text-muted-foreground" />,
        title: "Không tìm thấy việc làm nào",
        message: `Không có kết quả nào phù hợp với từ khóa "${query}". Hãy thử tìm kiếm với từ khóa khác hoặc kiểm tra lỗi chính tả.`,
        actions: [
          {
            label: "Tìm kiếm mới",
            variant: "default",
            onClick: onNewSearch
          }
        ]
      };
    }

    if (hasFilters) {
      return {
        icon: <Filter className="h-16 w-16 text-muted-foreground" />,
        title: "Không có việc làm phù hợp với bộ lọc",
        message: "Các bộ lọc bạn đã chọn không có kết quả nào. Hãy thử điều chỉnh bộ lọc để tìm thêm cơ hội việc làm.",
        actions: [
          {
            label: "Xóa bộ lọc",
            variant: "outline",
            onClick: onClearFilters
          }
        ]
      };
    }

    return {
      icon: <Search className="h-16 w-16 text-muted-foreground" />,
      title: "Bắt đầu tìm kiếm việc làm",
      message: "Nhập từ khóa vào ô tìm kiếm để khám phá các cơ hội nghề nghiệp phù hợp với bạn.",
      actions: []
    };
  };

  const content = getEmptyContent();

  return (
    <Card className={cn("border-none shadow-none bg-transparent", className)}>
      <CardContent className="py-12 text-center">
        <div className="max-w-md mx-auto space-y-6">
          {/* Icon */}
          <div className="flex justify-center">
            {content.icon}
          </div>

          {/* Title */}
          <h3 className="text-xl font-semibold text-foreground">
            {content.title}
          </h3>

          {/* Message */}
          <p className="text-muted-foreground leading-relaxed">
            {content.message}
          </p>

          {/* Action Buttons */}
          {content.actions.length > 0 && (
            <div className="flex flex-col sm:flex-row gap-3 justify-center">
              {content.actions.map((action, index) => (
                <Button
                  key={index}
                  variant={action.variant}
                  onClick={action.onClick}
                  className="min-w-[120px]"
                >
                  {action.label}
                </Button>
              ))}
            </div>
          )}

          {/* Search Tips */}
          <div className="text-sm text-muted-foreground space-y-2 pt-4 border-t border-border">
            <p className="font-medium">Gợi ý tìm kiếm:</p>
            <ul className="space-y-1 text-left max-w-sm mx-auto">
              <li>• Thử các từ khóa khác nhau</li>
              <li>• Kiểm tra lỗi chính tả</li>
              <li>• Sử dụng từ khóa tổng quát hơn</li>
              <li>• Điều chỉnh hoặc xóa bộ lọc</li>
            </ul>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default SearchEmpty;
</file>

<file path="src/pages/jobs/components/SearchStates/SearchError.jsx">
import React from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { AlertCircle, RefreshCw, Home } from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * SearchError component
 * Displays error state when search fails
 */
const SearchError = ({
  error,
  onRetry,
  onGoHome,
  className
}) => {
  /**
   * Get error message from error object
   */
  const getErrorMessage = () => {
    if (!error) return "Đã xảy ra lỗi không xác định";
    
    // Handle different error types
    if (error.response?.data?.message) {
      return error.response.data.message;
    }
    
    if (error.message) {
      return error.message;
    }
    
    // Handle network errors
    if (error.code === 'NETWORK_ERROR' || error.name === 'NetworkError') {
      return "Không thể kết nối tới máy chủ. Vui lòng kiểm tra kết nối internet của bạn.";
    }
    
    // Handle timeout errors
    if (error.code === 'ECONNABORTED' || error.message?.includes('timeout')) {
      return "Yêu cầu tìm kiếm đã hết thời gian chờ. Vui lòng thử lại.";
    }
    
    // Handle server errors
    if (error.response?.status >= 500) {
      return "Máy chủ đang gặp sự cố. Vui lòng thử lại sau ít phút.";
    }
    
    // Handle client errors
    if (error.response?.status >= 400) {
      return "Yêu cầu không hợp lệ. Vui lòng kiểm tra lại từ khóa tìm kiếm.";
    }
    
    return "Đã xảy ra lỗi khi tìm kiếm việc làm. Vui lòng thử lại.";
  };

  /**
   * Get error type for appropriate styling and actions
   */
  const getErrorType = () => {
    if (!error) return 'unknown';
    
    if (error.code === 'NETWORK_ERROR' || error.name === 'NetworkError') {
      return 'network';
    }
    
    if (error.response?.status >= 500) {
      return 'server';
    }
    
    if (error.response?.status >= 400) {
      return 'client';
    }
    
    return 'unknown';
  };

  const errorMessage = getErrorMessage();
  const errorType = getErrorType();

  return (
    <Card className={cn("border-none shadow-none bg-transparent", className)}>
      <CardContent className="py-12 text-center">
        <div className="max-w-md mx-auto space-y-6">
          {/* Error Icon */}
          <div className="flex justify-center">
            <div className="p-4 bg-destructive/10 rounded-full">
              <AlertCircle className="h-12 w-12 text-destructive" />
            </div>
          </div>

          {/* Error Title */}
          <h3 className="text-xl font-semibold text-foreground">
            Oops! Có lỗi xảy ra
          </h3>

          {/* Error Message */}
          <p className="text-muted-foreground leading-relaxed">
            {errorMessage}
          </p>

          {/* Action Buttons */}
          <div className="flex flex-col sm:flex-row gap-3 justify-center">
            {onRetry && (
              <Button
                variant="default"
                onClick={onRetry}
                className="min-w-[120px]"
              >
                <RefreshCw className="h-4 w-4 mr-2" />
                Thử lại
              </Button>
            )}
            
            {onGoHome && (
              <Button
                variant="outline"
                onClick={onGoHome}
                className="min-w-[120px]"
              >
                <Home className="h-4 w-4 mr-2" />
                Về trang chủ
              </Button>
            )}
          </div>

          {/* Error Details (for development/debugging) */}
          {process.env.NODE_ENV === 'development' && error && (
            <details className="text-left text-xs text-muted-foreground bg-muted p-3 rounded-md">
              <summary className="cursor-pointer font-medium mb-2">
                Chi tiết lỗi (Development)
              </summary>
              <pre className="whitespace-pre-wrap overflow-auto">
                {JSON.stringify(
                  {
                    message: error.message,
                    status: error.response?.status,
                    data: error.response?.data,
                    code: error.code
                  },
                  null,
                  2
                )}
              </pre>
            </details>
          )}

          {/* Help Text */}
          <div className="text-sm text-muted-foreground space-y-2 pt-4 border-t border-border">
            <p className="font-medium">Nếu lỗi vẫn tiếp tục:</p>
            <ul className="space-y-1 text-left max-w-sm mx-auto">
              {errorType === 'network' && (
                <>
                  <li>• Kiểm tra kết nối internet</li>
                  <li>• Tắt VPN nếu đang sử dụng</li>
                  <li>• Thử tải lại trang</li>
                </>
              )}
              {errorType === 'server' && (
                <>
                  <li>• Chờ một vài phút rồi thử lại</li>
                  <li>• Liên hệ hỗ trợ nếu cần</li>
                </>
              )}
              {errorType === 'client' && (
                <>
                  <li>• Kiểm tra từ khóa tìm kiếm</li>
                  <li>• Thử tìm kiếm đơn giản hơn</li>
                  <li>• Xóa bộ lọc và thử lại</li>
                </>
              )}
              {errorType === 'unknown' && (
                <>
                  <li>• Tải lại trang</li>
                  <li>• Thử với trình duyệt khác</li>
                  <li>• Liên hệ hỗ trợ</li>
                </>
              )}
            </ul>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default SearchError;
</file>

<file path="src/pages/jobs/components/SearchStates/SearchLoading.jsx">
import React from 'react';
import { Skeleton } from '@/components/ui/skeleton';
import { Card, CardContent } from '@/components/ui/card';
import { cn } from '@/lib/utils';

/**
 * SearchLoading component
 * Displays loading skeletons for search results
 */
const SearchLoading = ({ 
  count = 6,
  compact = false,
  className 
}) => {
  return (
    <div className={cn("space-y-4", className)}>
      {Array.from({ length: count }).map((_, index) => (
        <Card key={index} className="border-border animate-pulse">
          <CardContent className={cn("p-6", compact && "p-4")}>
            <div className="flex gap-4">
              {/* Company Logo Skeleton */}
              <Skeleton className={cn(
                "rounded-lg flex-shrink-0",
                compact ? "h-12 w-12" : "h-16 w-16"
              )} />
              
              <div className="flex-1 space-y-3">
                {/* Job Title and Company */}
                <div className="space-y-2">
                  <Skeleton className={cn(
                    "w-3/4",
                    compact ? "h-5" : "h-6"
                  )} />
                  <Skeleton className="h-4 w-1/2" />
                </div>
                
                {/* Badges */}
                <div className="flex gap-2 flex-wrap">
                  <Skeleton className="h-6 w-20" />
                  <Skeleton className="h-6 w-24" />
                  <Skeleton className="h-6 w-28" />
                  {!compact && <Skeleton className="h-6 w-16" />}
                </div>
                
                {/* Description (only in non-compact mode) */}
                {!compact && (
                  <div className="space-y-2">
                    <Skeleton className="h-4 w-full" />
                    <Skeleton className="h-4 w-2/3" />
                  </div>
                )}
                
                {/* Skills (only in non-compact mode) */}
                {!compact && (
                  <div className="flex gap-1 flex-wrap">
                    <Skeleton className="h-5 w-16" />
                    <Skeleton className="h-5 w-20" />
                    <Skeleton className="h-5 w-18" />
                    <Skeleton className="h-5 w-12" />
                  </div>
                )}
                
                {/* Footer */}
                <div className="flex justify-between items-center">
                  <div className="flex gap-4">
                    <Skeleton className="h-4 w-16" />
                    <Skeleton className="h-4 w-20" />
                    {!compact && <Skeleton className="h-4 w-18" />}
                  </div>
                  <div className="flex gap-2">
                    <Skeleton className={cn(
                      compact ? "w-16" : "w-20",
                      "h-8"
                    )} />
                    <Skeleton className={cn(
                      compact ? "w-14" : "w-16",
                      "h-8"
                    )} />
                  </div>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      ))}
    </div>
  );
};

export default SearchLoading;
</file>

<file path="src/pages/jobs/ViewHistory.jsx">
import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Skeleton } from '@/components/ui/skeleton';
import { 
  Eye, 
  MapPin, 
  Building, 
  DollarSign, 
  Clock, 
  Trash2, 
  ExternalLink,
  Calendar,
  AlertCircle
} from 'lucide-react';
import { getViewHistory, deleteViewHistory, clearAllViewHistory } from '@/services/viewHistoryService';
import { toast } from 'sonner';
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";
import { formatDistanceToNow } from 'date-fns';
import { vi } from 'date-fns/locale';

const ViewHistoryPage = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const [page, setPage] = useState(1);
  const [showClearDialog, setShowClearDialog] = useState(false);
  const [deleteItemId, setDeleteItemId] = useState(null);
  const limit = 10;

  // Fetch view history
  const { data, isLoading, isError } = useQuery({
    queryKey: ['viewHistory', page],
    queryFn: () => getViewHistory({ page, limit }),
    keepPreviousData: true,
  });

  const viewHistory = data?.data || [];
  const pagination = data?.pagination || {};

  // Delete single history item
  const deleteMutation = useMutation({
    mutationFn: deleteViewHistory,
    onSuccess: () => {
      toast.success('Đã xóa lịch sử xem');
      queryClient.invalidateQueries(['viewHistory']);
      setDeleteItemId(null);
    },
    onError: (error) => {
      toast.error(error?.response?.data?.message || 'Không thể xóa lịch sử');
    },
  });

  // Clear all history
  const clearAllMutation = useMutation({
    mutationFn: clearAllViewHistory,
    onSuccess: () => {
      toast.success('Đã xóa toàn bộ lịch sử xem');
      queryClient.invalidateQueries(['viewHistory']);
      setShowClearDialog(false);
      setPage(1);
    },
    onError: (error) => {
      toast.error(error?.response?.data?.message || 'Không thể xóa lịch sử');
    },
  });

  const formatSalary = (min, max, currency = 'VND') => {
    if (!min && !max) return 'Thỏa thuận';
    const formatNumber = (num) => {
      if (currency === 'VND') {
        return num >= 1000000 ? `${num / 1000000}tr` : `${num / 1000}k`;
      }
      return num;
    };
    if (min && max) {
      return `${formatNumber(min)} - ${formatNumber(max)} ${currency}`;
    }
    if (min) return `Từ ${formatNumber(min)} ${currency}`;
    if (max) return `Lên đến ${formatNumber(max)} ${currency}`;
  };

  const formatWorkType = (type) => {
    const typeMap = {
      'FULL_TIME': 'Toàn thời gian',
      'PART_TIME': 'Bán thời gian',
      'CONTRACT': 'Hợp đồng',
      'FREELANCE': 'Tự do',
      'INTERNSHIP': 'Thực tập'
    };
    return typeMap[type] || type;
  };

  const formatViewTime = (date) => {
    try {
      return formatDistanceToNow(new Date(date), { 
        addSuffix: true, 
        locale: vi 
      });
    } catch (error) {
      return 'Vừa xong';
    }
  };

  const formatLocation = (location) => {
    if (!location) return '';
    if (typeof location === 'string') return location;
    // location is object: { province, district, commune, coordinates }
    const parts = [location.province, location.district, location.commune].filter(Boolean);
    return parts.join(', ') || '';
  };

  const handleViewJob = (jobId) => {
    navigate(`/jobs/${jobId}`);
  };

  const handleDeleteClick = (itemId) => {
    setDeleteItemId(itemId);
  };

  if (isLoading) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-6xl">
        <Card>
          <CardHeader>
            <Skeleton className="h-8 w-64" />
          </CardHeader>
          <CardContent>
            <div className="space-y-4">
              {[...Array(5)].map((_, i) => (
                <Skeleton key={i} className="h-32 w-full" />
              ))}
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isError) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-6xl">
        <Card>
          <CardContent className="py-12">
            <div className="flex flex-col items-center justify-center text-center">
              <AlertCircle className="h-12 w-12 text-destructive mb-4" />
              <h3 className="text-lg font-semibold mb-2">Không thể tải lịch sử xem</h3>
              <p className="text-muted-foreground">Vui lòng thử lại sau</p>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-6xl">
      <Card>
        <CardHeader>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <Eye className="h-6 w-6" />
              <CardTitle>Lịch sử xem tin tuyển dụng</CardTitle>
            </div>
            {viewHistory.length > 0 && (
              <Button
                variant="destructive"
                size="sm"
                onClick={() => setShowClearDialog(true)}
              >
                Xóa tất cả
              </Button>
            )}
          </div>
        </CardHeader>
        <CardContent>
          {viewHistory.length === 0 ? (
            <div className="py-12 text-center">
              <Eye className="h-16 w-16 mx-auto text-muted-foreground/50 mb-4" />
              <h3 className="text-lg font-semibold mb-2">Chưa có lịch sử xem</h3>
              <p className="text-muted-foreground mb-6">
                Các tin tuyển dụng bạn đã xem sẽ được hiển thị tại đây
              </p>
              <Button onClick={() => navigate('/jobs')}>
                Khám phá việc làm
              </Button>
            </div>
          ) : (
            <div className="space-y-4">
              {viewHistory.map((item) => (
                <Card 
                  key={item._id} 
                  className="hover:shadow-md transition-shadow cursor-pointer"
                  onClick={() => handleViewJob(item.job._id)}
                >
                  <CardContent className="p-6">
                    <div className="flex gap-4">
                      {/* Company Logo */}
                      <div className="flex-shrink-0">
                        <div className="w-16 h-16 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                          {item.job.company?.logo ? (
                            <img 
                              src={item.job.company.logo} 
                              alt={item.job.company.name}
                              className="w-full h-full object-cover"
                            />
                          ) : (
                            <Building className="h-8 w-8 text-gray-400" />
                          )}
                        </div>
                      </div>

                      {/* Job Info */}
                      <div className="flex-1 min-w-0">
                        <div className="flex items-start justify-between gap-4 mb-2">
                          <div className="flex-1 min-w-0">
                            <h3 className="text-lg font-semibold mb-1 hover:text-primary truncate">
                              {item.job.title}
                            </h3>
                            <p className="text-muted-foreground flex items-center gap-2 mb-2">
                              <Building className="h-4 w-4" />
                              {item.job.company?.name || 'Công ty'}
                            </p>
                          </div>
                          <Button
                            variant="ghost"
                            size="icon"
                            onClick={(e) => {
                              e.stopPropagation();
                              handleDeleteClick(item._id);
                            }}
                          >
                            <Trash2 className="h-4 w-4" />
                          </Button>
                        </div>

                        <div className="flex flex-wrap gap-3 mb-3 text-sm text-muted-foreground">
                          {item.job.location && (
                            <span className="flex items-center gap-1">
                              <MapPin className="h-4 w-4" />
                              {formatLocation(item.job.location)}
                            </span>
                          )}
                          {item.job.salary && (
                            <span className="flex items-center gap-1">
                              <DollarSign className="h-4 w-4" />
                              {formatSalary(
                                item.job.salary.min,
                                item.job.salary.max,
                                item.job.salary.currency
                              )}
                            </span>
                          )}
                          {item.job.workType && (
                            <Badge variant="secondary" className="flex items-center gap-1">
                              <Clock className="h-3 w-3" />
                              {formatWorkType(item.job.workType)}
                            </Badge>
                          )}
                        </div>

                        <div className="flex items-center justify-between text-xs text-muted-foreground">
                          <span className="flex items-center gap-1">
                            <Calendar className="h-3 w-3" />
                            Xem {formatViewTime(item.viewedAt)}
                          </span>
                          <span className="flex items-center gap-1 text-primary">
                            Xem chi tiết
                            <ExternalLink className="h-3 w-3" />
                          </span>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              ))}

              {/* Pagination */}
              {pagination.totalPages > 1 && (
                <div className="flex items-center justify-center gap-2 mt-6">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => setPage(p => Math.max(1, p - 1))}
                    disabled={page === 1}
                  >
                    Trang trước
                  </Button>
                  <span className="text-sm text-muted-foreground">
                    Trang {pagination.currentPage} / {pagination.totalPages}
                  </span>
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={() => setPage(p => p + 1)}
                    disabled={page >= pagination.totalPages}
                  >
                    Trang sau
                  </Button>
                </div>
              )}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Delete Single Item Dialog */}
      <AlertDialog open={!!deleteItemId} onOpenChange={() => setDeleteItemId(null)}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Xóa lịch sử xem?</AlertDialogTitle>
            <AlertDialogDescription>
              Bạn có chắc chắn muốn xóa mục này khỏi lịch sử xem không?
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Hủy</AlertDialogCancel>
            <AlertDialogAction
              onClick={() => deleteMutation.mutate(deleteItemId)}
              className="bg-destructive hover:bg-destructive/90"
            >
              Xóa
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Clear All Dialog */}
      <AlertDialog open={showClearDialog} onOpenChange={setShowClearDialog}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Xóa toàn bộ lịch sử?</AlertDialogTitle>
            <AlertDialogDescription>
              Hành động này sẽ xóa toàn bộ lịch sử xem tin tuyển dụng của bạn. 
              Bạn không thể hoàn tác sau khi xóa.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Hủy</AlertDialogCancel>
            <AlertDialogAction
              onClick={() => clearAllMutation.mutate()}
              className="bg-destructive hover:bg-destructive/90"
            >
              Xóa tất cả
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
};

export default ViewHistoryPage;
</file>

<file path="src/pages/messages/MessagesPage.jsx">
import { useState } from 'react';
import ChatInterface from '@/components/chat/ChatInterface';

/**
 * MessagesPage Component
 * Full-page view for the chat interface
 */
const MessagesPage = () => {
  return (
    <div className="container mx-auto py-6 h-[calc(100vh-4rem)]">
      <ChatInterface 
        isOpen={true} 
        onClose={() => {
          // Navigate back or close
          window.history.back();
        }}
      />
    </div>
  );
};

export default MessagesPage;
</file>

<file path="src/pages/NotFound.jsx">
import { Link } from 'react-router-dom';
import { Button } from '@/components/ui/button';

const NotFound = () => {
  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-background text-center">
      <h1 className="text-9xl font-bold text-primary">404</h1>
      <h2 className="mt-4 text-3xl font-semibold text-foreground">Trang không tồn tại</h2>
      <p className="mt-2 text-muted-foreground">Rất tiếc, chúng tôi không thể tìm thấy trang bạn yêu cầu.</p>
      <Button asChild className="mt-6">
        <Link to="/">Về trang chủ</Link>
      </Button>
    </div>
  );
};

export default NotFound;
</file>

<file path="src/pages/notification/components/CreateJobAlertDialog.jsx">
import { useForm, FormProvider } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Label } from '@/components/ui/label';
import { Loader2 } from 'lucide-react';
import { getJobAlertOptions } from '@/services/jobNotificationService';
import LocationPicker from '@/components/common/LocationPicker';

const formSchema = z.object({
  name: z.string().min(1, 'Tên đăng ký là bắt buộc').max(100),
  keyword: z.string().min(1, 'Từ khóa là bắt buộc').max(100),
  location: z.object({
    province: z.string().min(1, 'Tỉnh/Thành phố là bắt buộc'),
    district: z.string().min(1, 'Quận/Huyện là bắt buộc'),
  }),
  frequency: z.enum(['daily', 'weekly']),
  salaryRange: z.string().optional(),
  type: z.string().optional(),
  workType: z.string().optional(),
  experience: z.string().optional(),
  category: z.string().optional(),
});

export const CreateJobAlertDialog = ({ open, onClose, onSubmit, isLoading = false }) => {
  const methods = useForm({
    resolver: zodResolver(formSchema),
    defaultValues: {
      name: '',
      keyword: '',
      location: { province: 'Tất cả tỉnh thành', district: 'Tất cả quận/huyện' },
      frequency: 'weekly',
      salaryRange: 'ALL',
      type: 'ALL',
      workType: 'ALL',
      experience: 'ALL',
      category: 'ALL',
    },
  });
  
  const options = getJobAlertOptions();

  const handleFormSubmit = methods.handleSubmit(async (data) => {
    const apiData = { ...data };
    if (data.location.province === 'Tất cả tỉnh thành') apiData.location.province = 'ALL';
    if (data.location.district === 'Tất cả quận/huyện') apiData.location.district = 'ALL';
    
    apiData.notificationMethod = 'APPLICATION';
    apiData.active = true; // Mặc định là active khi tạo mới

    await onSubmit(apiData);
  });

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-[600px]">
        <DialogHeader>
          <DialogTitle className="text-2xl">Đăng ký nhận thông báo việc làm</DialogTitle>
          <DialogDescription>Tạo một đăng ký mới để nhận việc làm phù hợp.</DialogDescription>
        </DialogHeader>
        <FormProvider {...methods}>
          <form onSubmit={handleFormSubmit} className="space-y-4 pt-4">
            <div>
              <Label htmlFor="name">Tên đăng ký *</Label>
              <Input id="name" {...methods.register('name')} placeholder="VD: Senior Dev (Remote)" />
              {methods.formState.errors.name && <p className="text-sm text-red-500 mt-1">{methods.formState.errors.name.message}</p>}
            </div>
            <div>
              <Label htmlFor="keyword">Từ khóa tìm kiếm *</Label>
              <Input id="keyword" {...methods.register('keyword')} placeholder="VD: Backend, Java, Spring Boot" />
              {methods.formState.errors.keyword && <p className="text-sm text-red-500 mt-1">{methods.formState.errors.keyword.message}</p>}
            </div>
            
            <div>
              <Label>Địa điểm</Label>
              <div className="grid grid-cols-2 gap-4 mt-1">
                <LocationPicker control={methods.control} provinceFieldName="location.province" districtFieldName="location.district" />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <Label htmlFor="salaryRange">Mức lương</Label>
                <Select onValueChange={(value) => methods.setValue('salaryRange', value)} defaultValue="ALL">
                  <SelectTrigger><SelectValue /></SelectTrigger>
                  <SelectContent>
                    {options.salaryRanges.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                  </SelectContent>
                </Select>
              </div>
              <div>
                <Label htmlFor="experience">Kinh nghiệm</Label>
                <Select onValueChange={(value) => methods.setValue('experience', value)} defaultValue="ALL">
                  <SelectTrigger><SelectValue /></SelectTrigger>
                  <SelectContent>
                    {options.experiences.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                  </SelectContent>
                </Select>
              </div>
            </div>

             <div className="grid grid-cols-2 gap-4">
                 <div>
                    <Label htmlFor="category">Ngành nghề</Label>
                    <Select onValueChange={(value) => methods.setValue('category', value)} defaultValue="ALL">
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        {options.categories.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                      </SelectContent>
                    </Select>
                </div>
                 <div>
                    <Label htmlFor="frequency">Tần suất nhận *</Label>
                     <Select onValueChange={(value) => methods.setValue('frequency', value)} defaultValue="weekly">
                       <SelectTrigger><SelectValue /></SelectTrigger>
                       <SelectContent>
                         {options.frequencies.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                       </SelectContent>
                     </Select>
                </div>
            </div>

            <DialogFooter>
              <Button type="button" variant="outline" onClick={onClose} disabled={isLoading}>Hủy</Button>
              <Button type="submit" disabled={isLoading} className="bg-gradient-primary text-white">
                {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
                {isLoading ? 'Đang lưu...' : 'Tạo đăng ký'}
              </Button>
            </DialogFooter>
          </form>
        </FormProvider>
      </DialogContent>
    </Dialog>
  );
};
</file>

<file path="src/pages/notification/components/EditJobAlertDialog.jsx">
import { useEffect } from 'react';
import { useForm, FormProvider } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Label } from '@/components/ui/label';
import { Loader2, X } from 'lucide-react';
import { getJobAlertOptions } from '@/services/jobNotificationService';
import LocationPicker from '@/components/common/LocationPicker';

const formSchema = z.object({
  name: z.string().min(1, 'Tên đăng ký là bắt buộc').max(100),
  keyword: z.string().min(1, 'Từ khóa là bắt buộc').max(100),
  location: z.object({
    province: z.string().min(1, 'Tỉnh/Thành phố là bắt buộc'),
    district: z.string().min(1, 'Quận/Huyện là bắt buộc'),
  }),
  frequency: z.enum(['daily', 'weekly']),
  salaryRange: z.string().optional(),
  type: z.string().optional(),
  workType: z.string().optional(),
  experience: z.string().optional(),
  category: z.string().optional(),
});

export const EditJobAlertDialog = ({ alert, open, onClose, onSubmit, isLoading = false }) => {
  const methods = useForm({
    resolver: zodResolver(formSchema),
  });

  const options = getJobAlertOptions();

  useEffect(() => {
    if (alert) {
      methods.reset({
        name: alert.name || '',
        keyword: alert.keyword || '',
        location: {
          province: alert.rawData?.location?.province || 'Tất cả tỉnh thành',
          district: alert.rawData?.location?.district || 'Tất cả quận/huyện',
        },
        frequency: alert.frequency || 'weekly',
        salaryRange: alert.rawData?.salaryRange || 'ALL',
        type: alert.rawData?.type || 'ALL',
        workType: alert.rawData?.workType || 'ALL',
        experience: alert.rawData?.experience || 'ALL',
        category: alert.rawData?.category || 'ALL',
      });
    }
  }, [alert, methods]);

  const handleFormSubmit = methods.handleSubmit(async (data) => {
    const apiData = { ...data };
    if (data.location.province === 'Tất cả tỉnh thành') apiData.location.province = 'ALL';
    if (data.location.district === 'Tất cả quận/huyện') apiData.location.district = 'ALL';
    
    // API không cần các giá trị 'ALL', chúng ta sẽ loại bỏ chúng
    Object.keys(apiData).forEach(key => {
      if (apiData[key] === 'ALL') {
        delete apiData[key];
      }
    });

    await onSubmit(apiData);
  });

  if (!alert) return null;

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-[600px]">
        <DialogHeader>
          <DialogTitle className="text-2xl">Chỉnh sửa đăng ký</DialogTitle>
          <DialogDescription>Cập nhật tiêu chí cho đăng ký nhận thông báo của bạn.</DialogDescription>
           <Button
                variant="ghost"
                size="icon"
                onClick={onClose}
                className="absolute top-4 right-4 h-8 w-8"
              >
                <X className="h-4 w-4" />
              </Button>
        </DialogHeader>
        <FormProvider {...methods}>
          <form onSubmit={handleFormSubmit} className="space-y-4 pt-4">
             <div>
              <Label htmlFor="name">Tên đăng ký *</Label>
              <Input id="name" {...methods.register('name')} placeholder="VD: Senior Dev (Remote)" />
              {methods.formState.errors.name && <p className="text-sm text-red-500 mt-1">{methods.formState.errors.name.message}</p>}
            </div>
            <div>
              <Label htmlFor="keyword">Từ khóa tìm kiếm *</Label>
              <Input id="keyword" {...methods.register('keyword')} placeholder="VD: Backend, Java, Spring Boot" />
              {methods.formState.errors.keyword && <p className="text-sm text-red-500 mt-1">{methods.formState.errors.keyword.message}</p>}
            </div>
            
            <div>
              <Label>Địa điểm</Label>
              <div className="grid grid-cols-2 gap-4 mt-1">
                <LocationPicker control={methods.control} provinceFieldName="location.province" districtFieldName="location.district" />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <Label htmlFor="salaryRange">Mức lương</Label>
                <Select onValueChange={(value) => methods.setValue('salaryRange', value)} defaultValue={methods.getValues('salaryRange')}>
                  <SelectTrigger><SelectValue /></SelectTrigger>
                  <SelectContent>
                    {options.salaryRanges.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                  </SelectContent>
                </Select>
              </div>
              <div>
                <Label htmlFor="experience">Kinh nghiệm</Label>
                <Select onValueChange={(value) => methods.setValue('experience', value)} defaultValue={methods.getValues('experience')}>
                  <SelectTrigger><SelectValue /></SelectTrigger>
                  <SelectContent>
                    {options.experiences.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                  </SelectContent>
                </Select>
              </div>
            </div>

             <div className="grid grid-cols-2 gap-4">
                 <div>
                    <Label htmlFor="category">Ngành nghề</Label>
                    <Select onValueChange={(value) => methods.setValue('category', value)} defaultValue={methods.getValues('category')}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        {options.categories.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                      </SelectContent>
                    </Select>
                </div>
                 <div>
                    <Label htmlFor="frequency">Tần suất nhận *</Label>
                     <Select onValueChange={(value) => methods.setValue('frequency', value)} defaultValue={methods.getValues('frequency')}>
                       <SelectTrigger><SelectValue /></SelectTrigger>
                       <SelectContent>
                         {options.frequencies.map(opt => <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>)}
                       </SelectContent>
                     </Select>
                </div>
            </div>

            <DialogFooter>
              <Button type="button" variant="outline" onClick={onClose} disabled={isLoading}>Hủy</Button>
              <Button type="submit" disabled={isLoading} className="bg-gradient-primary text-white">
                {isLoading && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
                {isLoading ? 'Đang cập nhật...' : 'Lưu thay đổi'}
              </Button>
            </DialogFooter>
          </form>
        </FormProvider>
      </DialogContent>
    </Dialog>
  );
};
</file>

<file path="src/pages/notification/useJobAlerts.jsx">
import { useState, useEffect, useCallback } from 'react';
import { useSelector } from 'react-redux';
import { toast } from 'sonner';
import {
  getJobAlerts,
  createJobAlert,
  updateJobAlert,
  deleteJobAlert,
  toggleJobAlertStatus
} from '../../services/jobNotificationService';

/**
 * Custom hook để quản lý đăng ký nhận job alert (job subscriptions)
 * Tương thích với JobAlertManager component
 */
export const useJobAlerts = () => {
  const { isAuthenticated } = useSelector((state) => state.auth);
  
  // State quản lý
  const [alerts, setAlerts] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [isDeleting, setIsDeleting] = useState(new Set()); // Set of IDs being deleted
  const [error, setError] = useState(null);
  const [totalItems, setTotalItems] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);

  /**
   * Fetch danh sách job alerts
   */
  const fetchAlerts = useCallback(async (params = {}) => {
    if (!isAuthenticated) return;
    
    try {
      setIsLoading(true);
      setError(null);
      
      const response = await getJobAlerts({
        page: currentPage,
        limit: 10,
        ...params
      });
      
      if (response.data.success) {
        const jobAlerts = response.data.data || [];
        
        // Transform API data to match component expectations
        const transformedAlerts = jobAlerts.map(alert => ({
          _id: alert._id,
          name: alert.name || alert.keyword, // Use name if available, otherwise fallback to keyword
          keyword: alert.keyword,
          location: alert.location?.province || '',
          category: formatCategory(alert.category),
          salaryRange: formatSalaryRange(alert.salaryRange),
          frequency: alert.frequency,
          active: alert.active,
          createdAt: alert.createdAt,
          updatedAt: alert.updatedAt,
          // API không có field này, giữ lại để tương thích UI cũ nếu cần
          lastSent: null, 
          // Lưu raw data để dễ edit
          rawData: alert
        }));
        
        setAlerts(transformedAlerts);
        
        if (response.data.meta) {
          setTotalItems(response.data.meta.totalItems || transformedAlerts.length);
          setTotalPages(response.data.meta.totalPages || 1);
          setCurrentPage(response.data.meta.currentPage || 1);
        } else {
          setTotalItems(transformedAlerts.length);
          setTotalPages(1);
        }
      } else {
        throw new Error(response.data.message || 'Không thể tải danh sách đăng ký');
      }
    } catch (err) {
      console.error('❌ Error fetching job alerts:', err);
      setError(err.response?.data?.message || err.message);
    } finally {
      setIsLoading(false);
    }
  }, [isAuthenticated, currentPage]);

  /**
   * Tạo job alert mới
   */
  const createAlert = useCallback(async (alertData) => {
        if (!isAuthenticated) {
            toast.error('Vui lòng đăng nhập để thực hiện chức năng này.');
            return false;
        }

        try {
            setIsSaving(true);
            const response = await createJobAlert(alertData);
            
            if (response.success) {
                toast.success('Đăng ký nhận thông báo thành công!');
                await fetchAlerts(); // Tải lại danh sách
                return true;
            } else {
                throw new Error(response.message || 'Không thể tạo đăng ký');
            }
        } catch (err) {
            console.error('❌ Error creating job alert:', err);
            const errorMessage = err.response?.data?.message || err.message;
            toast.error(errorMessage);
            return false;
        } finally {
            setIsSaving(false);
        }
    }, [isAuthenticated, fetchAlerts]);

  /**
   * Cập nhật job alert
   */
  const updateAlert = useCallback(async (id, alertData) => {
    try {
      setIsSaving(true);
      
      const response = await updateJobAlert(id, alertData);
      
      if (response.data.success) {
        toast.success('Cập nhật đăng ký thành công!');
        await fetchAlerts(); // Refresh danh sách
        return true;
      } else {
        throw new Error(response.data.message || 'Không thể cập nhật đăng ký');
      }
    } catch (err) {
      console.error('❌ Error updating job alert:', err);
      const errorMessage = err.response?.data?.message || err.message;
      toast.error(errorMessage);
      return false;
    } finally {
      setIsSaving(false);
    }
  }, [fetchAlerts]);

  /**
   * Xóa job alert
   */
  const deleteAlert = useCallback(async (id) => {
    try {
      setIsDeleting(prev => new Set([...prev, id]));
      
      const response = await deleteJobAlert(id);
      
      if (response.data.success) {
        toast.success('Xóa đăng ký thành công!');
        await fetchAlerts(); // Refresh danh sách
        return true;
      } else {
        throw new Error(response.data.message || 'Không thể xóa đăng ký');
      }
    } catch (err) {
      console.error('❌ Error deleting job alert:', err);
      const errorMessage = err.response?.data?.message || err.message;
      toast.error(errorMessage);
      return false;
    } finally {
      setIsDeleting(prev => {
        const newSet = new Set(prev);
        newSet.delete(id);
        return newSet;
      });
    }
  }, [fetchAlerts]);

  /**
   * Bật/tắt trạng thái job alert
   */
  const toggleAlertStatus = useCallback(async (id, currentStatus) => {
    try {
      const newStatus = !currentStatus;
      const response = await toggleJobAlertStatus(id, newStatus);
      
      if (response.data.success) {
        toast.success(newStatus ? 'Đã bật nhận thông báo' : 'Đã tạm dừng nhận thông báo');
        
        setAlerts(prev => 
          prev.map(alert => 
            alert._id === id 
              ? { ...alert, active: newStatus } 
              : alert
          )
        );
        return true;
      } else {
        throw new Error(response.data.message || 'Không thể thay đổi trạng thái');
      }
    } catch (err) {
      console.error('❌ Error toggling job alert status:', err);
      const errorMessage = err.response?.data?.message || err.message;
      toast.error(errorMessage);
      return false;
    }
  }, []);

  /**
   * Thay đổi trang
   */
  const handlePageChange = useCallback((page) => {
    if (page >= 1 && page <= totalPages && page !== currentPage) {
      setCurrentPage(page);
    }
  }, [currentPage, totalPages]);

  // Computed values
  const activeAlerts = alerts.filter(n => n.active);
  const hasAlerts = alerts.length > 0;
  const canCreateMore = true; // Có thể giới hạn số lượng tối đa nếu cần

  // Auto fetch khi component mount hoặc user đăng nhập
  useEffect(() => {
    if (isAuthenticated) {
      fetchAlerts();
    } else {
      // Reset state khi user logout
      setAlerts([]);
      setError(null);
      setCurrentPage(1);
      setTotalItems(0);
      setTotalPages(1);
    }
  }, [isAuthenticated, fetchAlerts]);

  // Format functions
  const formatCategory = (category) => {
    // ... giữ nguyên
    return category || '';
  };

  const formatSalaryRange = (salaryRange) => {
    // ... giữ nguyên
    return salaryRange || '';
  };

  return {
    // Data
    alerts,
    activeAlerts,
    hasAlerts,
    canCreateMore,
    
    // Pagination
    totalItems,
    currentPage,
    totalPages,
    
    // State
    isLoading,
    isSaving,
    isDeleting,
    error,
    
    // Actions
    fetchAlerts,
    createAlert,
    updateAlert,
    deleteAlert,
    toggleAlertStatus,
    handlePageChange
  };
};

export default useJobAlerts;
</file>

<file path="src/pages/payment/PaymentFailure.jsx">
import { Link } from 'react-router-dom';
import { XCircle } from 'lucide-react';
import { Button } from '../../components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';

const PaymentFailure = () => {
  return (
    <div className="flex items-center justify-center min-h-screen bg-gray-100">
      <Card className="w-full max-w-md text-center shadow-lg">
        <CardHeader>
          <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100">
            <XCircle className="h-6 w-6 text-red-600" />
          </div>
          <CardTitle className="mt-4">Thanh toán thất bại</CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-gray-600 mb-6">
            Đã có lỗi xảy ra trong quá trình thanh toán. Vui lòng thử lại hoặc liên hệ bộ phận hỗ trợ.
          </p>
          <Button asChild>
            <Link to="/billing">Thử lại</Link>
          </Button>
        </CardContent>
      </Card>
    </div>
  );
};

export default PaymentFailure;
</file>

<file path="src/pages/payment/PaymentSuccess.jsx">
import { useEffect, useRef } from 'react';
import { useDispatch } from 'react-redux';
import { Link } from 'react-router-dom';
import { CheckCircle2 } from 'lucide-react';
import { Button } from '../../components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';
import { updateCoinBalance } from '../../redux/authSlice';
import { getMyCoinBalance } from '../../services/profileService';
import { toast } from 'sonner';

const PaymentSuccess = () => {
  const dispatch = useDispatch();
  const hasFetched = useRef(false);

  useEffect(() => {
    const fetchCoinBalance = async () => {
      if (hasFetched.current) return;
      hasFetched.current = true;

      try {
        const response = await getMyCoinBalance();
        if (response.success && response.data?.coins !== undefined) {
          dispatch(updateCoinBalance(response.data.coins));
          toast.success("Nạp xu thành công! Số dư đã được cập nhật.");
        } else {
          toast.error(response.message || "Không thể cập nhật số dư.");
        }
      } catch (error) {
        toast.error(error.response?.data?.message || "Lỗi khi lấy số dư xu.");
      }
    };

    fetchCoinBalance();
  }, [dispatch]);

  return (
    <div className="flex items-center justify-center min-h-screen bg-gray-100">
      <Card className="w-full max-w-md text-center shadow-lg">
        <CardHeader>
          <div className="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100">
            <CheckCircle2 className="h-6 w-6 text-green-600" />
          </div>
          <CardTitle className="mt-4">Thanh toán thành công!</CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-gray-600 mb-6">
            Giao dịch nạp xu của bạn đã được hoàn tất. Số dư đã được cập nhật vào tài khoản của bạn.
          </p>
          <Button asChild>
            <Link to="/dashboard">Về trang tổng quan</Link>
          </Button>
        </CardContent>
      </Card>
    </div>
  );
};

export default PaymentSuccess;
</file>

<file path="src/pages/recommendations/RecommendationsPage.jsx">
import React from 'react';
import { JobRecommendations } from '@/components/recommendations';
import { Card, CardContent } from '@/components/ui/card';
import { Sparkles, TrendingUp, Target } from 'lucide-react';

/**
 * RecommendationsPage - Dedicated page for job recommendations
 */
const RecommendationsPage = () => {
  return (
    <div className="container mx-auto px-4 py-8 max-w-7xl">
      {/* Page Header */}
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-3">
          <div className="p-3 bg-gradient-to-br from-primary/20 to-primary/10 rounded-xl">
            <Sparkles className="h-8 w-8 text-primary" />
          </div>
          <div>
            <h1 className="text-3xl font-bold text-foreground">
              Việc làm gợi ý
            </h1>
            <p className="text-muted-foreground">
              Những công việc phù hợp nhất với hồ sơ của bạn
            </p>
          </div>
        </div>

        {/* Info Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
          <Card className="border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-transparent">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-primary/10 rounded-lg">
                  <Target className="h-5 w-5 text-primary" />
                </div>
                <div>
                  <p className="text-sm font-semibold text-foreground">Độ phù hợp cao</p>
                  <p className="text-xs text-muted-foreground">Dựa trên kỹ năng và kinh nghiệm</p>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card className="border-2 border-blue-200 bg-gradient-to-br from-blue-50 to-transparent">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-blue-100 rounded-lg">
                  <TrendingUp className="h-5 w-5 text-blue-600" />
                </div>
                <div>
                  <p className="text-sm font-semibold text-foreground">Cập nhật liên tục</p>
                  <p className="text-xs text-muted-foreground">Gợi ý mới mỗi ngày</p>
                </div>
              </div>
            </CardContent>
          </Card>

          <Card className="border-2 border-green-200 bg-gradient-to-br from-green-50 to-transparent">
            <CardContent className="p-4">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-green-100 rounded-lg">
                  <Sparkles className="h-5 w-5 text-green-600" />
                </div>
                <div>
                  <p className="text-sm font-semibold text-foreground">Cá nhân hóa</p>
                  <p className="text-xs text-muted-foreground">Phù hợp với sở thích của bạn</p>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>

      {/* Recommendations List */}
      <JobRecommendations limit={10} showHeader={false} />
    </div>
  );
};

export default RecommendationsPage;
</file>

<file path="src/pages/RecommendedJobsPage.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useSelector } from 'react-redux';
import {
  MapPin,
  Briefcase,
  DollarSign,
  Clock,
  Building,
  Calendar,
  Sparkles,
  AlertCircle,
  RefreshCw,
  ChevronLeft,
  Filter
} from 'lucide-react';
import { Card, CardContent, CardFooter, CardHeader, CardTitle } from '../components/ui/card';
import { Badge } from '../components/ui/badge';
import { Button } from '../components/ui/button';
import { Avatar, AvatarImage, AvatarFallback } from '../components/ui/avatar';
import { Skeleton } from '../components/ui/skeleton';
import { Alert, AlertDescription } from '../components/ui/alert';
import { getRecommendations, generateRecommendations } from '../services/recommendationService';
import { getOnboardingStatus } from '../services/onboardingService';
import { formatSalaryVND, formatWorkType, formatExperience } from '../utils/formatters';

const RecommendedJobsPage = () => {
  const navigate = useNavigate();
  const { user, isAuthenticated } = useSelector((state) => state.auth);

  const [jobs, setJobs] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);
  const [profileCompleteness, setProfileCompleteness] = useState(0);
  const [isGenerating, setIsGenerating] = useState(false);
  const [pagination, setPagination] = useState({
    currentPage: 1,
    totalPages: 1,
    totalItems: 0,
    itemsPerPage: 20
  });

  useEffect(() => {
    if (!isAuthenticated) {
      navigate('/login');
      return;
    }
    checkProfileAndFetchJobs();
  }, [isAuthenticated]);

  const checkProfileAndFetchJobs = async () => {
    try {
      setIsLoading(true);
      setError(null);

      // Check profile completeness
      const statusResponse = await getOnboardingStatus();
      const completeness = statusResponse?.data?.profileCompleteness?.percentage || 0;
      setProfileCompleteness(completeness);

      if (completeness < 60) {
        setError('profile_incomplete');
        setIsLoading(false);
        return;
      }

      // Fetch recommendations
      await fetchRecommendations(1);
    } catch (err) {
      console.error('❌ Error:', err);
      setError('fetch_error');
    } finally {
      setIsLoading(false);
    }
  };

  const fetchRecommendations = async (page = 1) => {
    try {
      setIsLoading(true);
      const response = await getRecommendations({ page, limit: 20 });
      console.log('📥 Recommendations response:', response);
      
      if (response?.data?.length > 0) {
        console.log('✅ Found recommendations:', response.data.length); 
        
        // Filter out invalid recommendations and map to job format
        const recommendedJobs = response.data
          .filter(rec => {
            if (!rec.jobId) {
              console.warn('⚠️ Recommendation missing jobId:', rec);
              return false;
            }
            if (!rec.jobId._id) {
              console.warn('⚠️ Job missing _id:', rec.jobId);
              return false;
            }
            return true;
          })
          .map(rec => ({
            ...rec.jobId,
            recommendationScore: rec.score,
            recommendationReasons: rec.reasons,
            recommendedAt: rec.generatedAt
          }));
        
        console.log('✅ Valid recommended jobs:', recommendedJobs.length);
        
        if (recommendedJobs.length === 0 && page === 1) {
          // All recommendations were invalid, regenerate
          console.log('🔄 All recommendations invalid, regenerating...');
          await handleGenerateRecommendations();
        } else {
          setJobs(recommendedJobs);
          setPagination(response.pagination || pagination);
        }
      } else if (page === 1) {
        // No recommendations found, auto-generate
        console.log('🔄 No recommendations found, generating...');
        await handleGenerateRecommendations();
      } else {
        setJobs([]);
      }
    } catch (err) {
      console.error('❌ Error fetching recommendations:', err);
      if (page === 1) {
        console.log('🔄 Error occurred, trying to generate...');
        await handleGenerateRecommendations();
      }
    } finally {
      setIsLoading(false);
    }
  };

  const handleGenerateRecommendations = async () => {
    try {
      setIsGenerating(true);
      const genResponse = await generateRecommendations({ limit: 20 });
      console.log('Generate recommendations response:', genResponse);

      if (genResponse?.data?.recommendations?.length > 0) {
        const recommendedJobs = genResponse.data.recommendations.map(rec => ({
          ...rec.job,
          recommendationScore: rec.score,
          recommendationReasons: rec.reasons
        }));

        setJobs(recommendedJobs);
        setPagination({
          currentPage: 1,
          totalPages: 1,
          totalItems: recommendedJobs.length,
          itemsPerPage: 20
        });
      } else {
        setError('no_recommendations');
      }
    } catch (err) {
      console.error('❌ Error generating:', err);
      setError('generate_error');
    } finally {
      setIsGenerating(false);
    }
  };

  const handleJobClick = (jobId) => {
    navigate(`/jobs/${jobId}`);
  };

  const handlePageChange = (newPage) => {
    fetchRecommendations(newPage);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const renderReasonBadges = (reasons) => {
    if (!reasons || reasons.length === 0) return null;

    return (
      <div className="flex flex-wrap gap-2 mt-2">
        {reasons.slice(0, 3).map((reason, idx) => (
          <Badge
            key={idx}
            variant="outline"
            className="text-xs bg-emerald-50 text-emerald-700 border-emerald-200"
          >
            {reason.value}
          </Badge>
        ))}
      </div>
    );
  };

  if (!isAuthenticated) {
    return null;
  }

  return (
    <div className="min-h-screen bg-background">
      {/* Header */}
      <div className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-12">
        <div className="container">
          <Button
            variant="ghost"
            className="text-white hover:bg-white/10 mb-4"
            onClick={() => navigate('/')}
          >
            <ChevronLeft className="mr-2 h-4 w-4" />
            Về trang chủ
          </Button>
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-4xl font-bold mb-2 flex items-center gap-3">
                <Sparkles className="h-8 w-8" />
                Việc làm dành riêng cho bạn
              </h1>
              <p className="text-lg text-white/90">
                {jobs.length > 0
                  ? `${jobs.length} công việc phù hợp với kỹ năng và mong muốn của bạn`
                  : 'Đang tìm kiếm công việc phù hợp...'}
              </p>
            </div>
            <div className="flex gap-3">
              <Button
                variant="secondary"
                onClick={handleGenerateRecommendations}
                disabled={isGenerating || isLoading}
                className="gap-2"
              >
                <RefreshCw className={`h-4 w-4 ${isGenerating ? 'animate-spin' : ''}`} />
                {isGenerating ? 'Đang cập nhật...' : 'Làm mới gợi ý'}
              </Button>
            </div>
          </div>
        </div>
      </div>

      <div className="container py-8">
        {/* Profile incomplete alert */}
        {error === 'profile_incomplete' && (
          <Alert className="mb-6 bg-amber-50 border-amber-200">
            <AlertCircle className="h-4 w-4 text-amber-600" />
            <AlertDescription className="text-amber-800">
              Hồ sơ của bạn đã hoàn thiện {profileCompleteness}%. Cần tối thiểu 60% để nhận gợi ý việc làm phù hợp.{' '}
              <Button
                variant="link"
                className="p-0 h-auto text-amber-700 font-semibold"
                onClick={() => navigate('/profile')}
              >
                Hoàn thiện ngay →
              </Button>
            </AlertDescription>
          </Alert>
        )}

        {/* Error alerts */}
        {error === 'no_recommendations' && (
          <Alert className="mb-6">
            <AlertCircle className="h-4 w-4" />
            <AlertDescription>
              Không tìm thấy việc làm phù hợp. Hãy thử cập nhật thông tin hồ sơ hoặc mở rộng tiêu chí tìm kiếm.
            </AlertDescription>
          </Alert>
        )}

        {/* Jobs grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {isLoading ? (
            [...Array(9)].map((_, i) => (
              <Card key={i} className="h-80">
                <CardContent className="p-6">
                  <div className="space-y-4">
                    <div className="flex items-start justify-between">
                      <Skeleton className="w-16 h-16 rounded-xl" />
                      <Skeleton className="w-20 h-6 rounded-full" />
                    </div>
                    <div className="space-y-3">
                      <Skeleton className="h-6 w-full" />
                      <Skeleton className="h-4 w-3/4" />
                    </div>
                    <div className="space-y-2">
                      <Skeleton className="h-5 w-1/2" />
                      <Skeleton className="h-4 w-2/3" />
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))
          ) : jobs.length > 0 ? (
            jobs.map((job) => (
              <Card
                key={job._id}
                className="group relative overflow-hidden border shadow-lg hover:shadow-2xl cursor-pointer transition-all duration-300 hover:-translate-y-1 rounded-2xl"
                onClick={() => handleJobClick(job._id)}
              >
                {/* Score badge */}
                {job.recommendationScore && (
                  <div className="absolute top-3 right-3 z-10">
                    <Badge className="bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-semibold">
                      <Sparkles className="w-3 h-3 mr-1" />
                      {job.recommendationScore}% phù hợp
                    </Badge>
                  </div>
                )}

                <CardHeader className="pb-3">
                  <div className="flex items-start space-x-4">
                    <Avatar className="w-16 h-16 flex-shrink-0">
                      <AvatarImage
                        src={job.recruiterProfileId?.company?.logo || ''}
                        alt={job.recruiterProfileId?.company?.name || 'Logo'}
                      />
                      <AvatarFallback>
                        {(job.recruiterProfileId?.company?.name || 'C')[0]}
                      </AvatarFallback>
                    </Avatar>
                    <div className="flex-1 min-w-0">
                      <CardTitle className="line-clamp-2 mb-1">{job.title}</CardTitle>
                      <div className="flex flex-col gap-1 text-sm text-muted-foreground">
                        <div className="flex items-center gap-1">
                          <Building className="w-3 h-3 flex-shrink-0" />
                          <span className="truncate">
                            {job.recruiterProfileId?.company?.name || 'Không rõ công ty'}
                          </span>
                        </div>
                        <div className="flex items-center gap-1">
                          <MapPin className="w-3 h-3 flex-shrink-0" />
                          <span className="truncate">
                            {job.location?.district}, {job.location?.province}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </CardHeader>

                <CardContent className="pt-0 pb-4">
                  <div className="flex flex-wrap gap-2">
                    <Badge variant="secondary" className="flex items-center gap-1">
                      <DollarSign className="w-3 h-3" />
                      {formatSalaryVND(job.minSalary, job.maxSalary)}
                    </Badge>
                    <Badge variant="secondary" className="flex items-center gap-1">
                      <Clock className="w-3 h-3" />
                      {formatWorkType(job.workType)}
                    </Badge>
                    <Badge variant="secondary" className="flex items-center gap-1">
                      <Briefcase className="w-3 h-3" />
                      {formatExperience(job.experience)}
                    </Badge>
                  </div>

                  {renderReasonBadges(job.recommendationReasons)}
                </CardContent>

                <CardFooter className="border-t pt-3 text-sm text-muted-foreground">
                  <Calendar className="w-4 h-4 mr-1" />
                  Hạn nộp: {new Date(job.deadline).toLocaleDateString('vi-VN')}
                </CardFooter>
              </Card>
            ))
          ) : (
            <div className="col-span-full text-center py-12">
              <Sparkles className="w-16 h-16 mx-auto text-muted-foreground mb-4" />
              <p className="text-xl font-semibold mb-2">Chưa có gợi ý việc làm</p>
              <p className="text-muted-foreground mb-4">
                Hãy hoàn thiện hồ sơ để nhận được gợi ý phù hợp hơn
              </p>
              <Button onClick={() => navigate('/profile')}>Cập nhật hồ sơ</Button>
            </div>
          )}
        </div>

        {/* Pagination */}
        {jobs.length > 0 && pagination.totalPages > 1 && (
          <div className="flex justify-center gap-2 mt-8">
            <Button
              variant="outline"
              disabled={pagination.currentPage === 1}
              onClick={() => handlePageChange(pagination.currentPage - 1)}
            >
              Trước
            </Button>
            <div className="flex items-center gap-2">
              {[...Array(pagination.totalPages)].map((_, i) => (
                <Button
                  key={i}
                  variant={pagination.currentPage === i + 1 ? 'default' : 'outline'}
                  onClick={() => handlePageChange(i + 1)}
                >
                  {i + 1}
                </Button>
              ))}
            </div>
            <Button
              variant="outline"
              disabled={pagination.currentPage === pagination.totalPages}
              onClick={() => handlePageChange(pagination.currentPage + 1)}
            >
              Sau
            </Button>
          </div>
        )}
      </div>
    </div>
  );
};

export default RecommendedJobsPage;
</file>

<file path="src/pages/ThemeDemo.jsx">
import { useTheme } from '@/contexts/ThemeContext';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import ThemeToggle from '@/components/common/ThemeToggle';
import { Sun, Moon, Monitor } from 'lucide-react';

const ThemeDemo = () => {
  const { theme, isDark } = useTheme();

  return (
    <div className="min-h-screen bg-background py-12 px-4">
      <div className="container max-w-4xl mx-auto space-y-8">
        <div className="text-center space-y-4">
          <h1 className="text-4xl font-bold text-foreground">
            Dark Mode Demo
          </h1>
          <p className="text-muted-foreground">
            Chế độ hiện tại: <Badge variant="outline">{isDark ? 'Dark' : 'Light'}</Badge>
          </p>
          <div className="flex justify-center gap-4">
            <ThemeToggle size="lg" />
          </div>
        </div>

        <div className="grid gap-6 md:grid-cols-2">
          <Card>
            <CardHeader>
              <CardTitle>Primary Colors</CardTitle>
              <CardDescription>Màu chủ đạo của ứng dụng</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-lg bg-primary" />
                <span className="text-sm">Primary</span>
              </div>
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-lg bg-secondary" />
                <span className="text-sm">Secondary</span>
              </div>
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-lg bg-accent" />
                <span className="text-sm">Accent</span>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Status Colors</CardTitle>
              <CardDescription>Màu trạng thái</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-lg bg-success" />
                <span className="text-sm">Success</span>
              </div>
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-lg bg-warning" />
                <span className="text-sm">Warning</span>
              </div>
              <div className="flex items-center gap-4">
                <div className="w-12 h-12 rounded-lg bg-destructive" />
                <span className="text-sm">Destructive</span>
              </div>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Buttons</CardTitle>
              <CardDescription>Các kiểu button</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <Button>Default Button</Button>
              <Button variant="secondary">Secondary Button</Button>
              <Button variant="outline">Outline Button</Button>
              <Button variant="ghost">Ghost Button</Button>
              <Button variant="destructive">Destructive Button</Button>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Typography</CardTitle>
              <CardDescription>Kiểu chữ và màu sắc</CardDescription>
            </CardHeader>
            <CardContent className="space-y-4">
              <p className="text-foreground">Foreground text</p>
              <p className="text-muted-foreground">Muted foreground text</p>
              <p className="text-primary">Primary text</p>
              <p className="text-secondary-foreground">Secondary text</p>
            </CardContent>
          </Card>
        </div>

        <Card>
          <CardHeader>
            <CardTitle>Background Variants</CardTitle>
            <CardDescription>Các biến thể nền</CardDescription>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="p-4 rounded-lg bg-background border">
              <p className="text-sm">Background</p>
            </div>
            <div className="p-4 rounded-lg bg-card border">
              <p className="text-sm">Card</p>
            </div>
            <div className="p-4 rounded-lg bg-muted">
              <p className="text-sm">Muted</p>
            </div>
            <div className="p-4 rounded-lg bg-popover border">
              <p className="text-sm">Popover</p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
};

export default ThemeDemo;
</file>

<file path="src/redux/slices/onboardingThunks.js">
import { createAsyncThunk } from '@reduxjs/toolkit';
import { getOnboardingStatus as getOnboardingStatusAPI } from '@/services/onboardingService';
import { setOnboardingStatus, setLoading, setError } from './onboardingSlice';

/**
 * Fetch onboarding status from API and cache in Redux
 */
export const fetchOnboardingStatus = createAsyncThunk(
  'onboarding/fetchStatus',
  async (_, { dispatch, rejectWithValue }) => {
    try {
      dispatch(setLoading(true));
      const response = await getOnboardingStatusAPI();
      
      if (response.success && response.data) {
        // Transform API response to Redux state format
        const statusData = {
          isCompleted: !response.data.needsOnboarding,
          currentStep: response.data.currentStep || 0,
          completedSteps: response.data.completedSteps || [],
          skippedSteps: response.data.skippedSteps || [],
          completionPercentage: response.data.completionPercentage || 0,
          profileCompleteness: response.data.profileCompleteness || {
            hasBasicInfo: false,
            hasExperience: false,
            hasEducation: false,
            hasSkills: false,
            hasCV: false,
            percentage: 0
          }
        };
        
        dispatch(setOnboardingStatus(statusData));
        dispatch(setLoading(false));
        return statusData;
      }
      
      throw new Error('Invalid response from API');
    } catch (error) {
      dispatch(setError(error.message || 'Failed to fetch onboarding status'));
      return rejectWithValue(error.message);
    }
  }
);

/**
 * Selector to check if onboarding data needs refresh
 * Returns true if data is stale (older than 5 minutes)
 */
export const shouldRefetchOnboardingStatus = (state) => {
  const lastFetch = state.onboarding.lastFetchTime;
  if (!lastFetch) return true;
  
  const FIVE_MINUTES = 5 * 60 * 1000;
  return Date.now() - lastFetch > FIVE_MINUTES;
};
</file>

<file path="src/render.jsx">
import React from 'react';
import { createRoot } from 'react-dom/client';
import { BrowserRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import CVRenderOnlyPage from './pages/cv/CVRenderOnlyPage';
import './index.css';

// Create a client
const queryClient = new QueryClient();

createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <CVRenderOnlyPage />
      </BrowserRouter>
    </QueryClientProvider>
  </React.StrictMode>
);
</file>

<file path="src/services/chatService.js">
import apiClient from './apiClient';

/**
 * Retry configuration for failed requests
 */
const RETRY_CONFIG = {
  maxRetries: 3,
  retryDelay: 1000, // 1 second
  retryableStatuses: [408, 429, 500, 502, 503, 504]
};

/**
 * Helper function to handle API requests with retry logic
 * @param {Function} requestFn - The API request function to execute
 * @param {number} retries - Number of retries remaining
 * @returns {Promise} The API response
 */
const withRetry = async (requestFn, retries = RETRY_CONFIG.maxRetries) => {
  try {
    return await requestFn();
  } catch (error) {
    const shouldRetry = 
      retries > 0 && 
      error.response && 
      RETRY_CONFIG.retryableStatuses.includes(error.response.status);

    if (shouldRetry) {
      console.warn(`Request failed, retrying... (${retries} attempts left)`);
      await new Promise(resolve => setTimeout(resolve, RETRY_CONFIG.retryDelay));
      return withRetry(requestFn, retries - 1);
    }

    throw error;
  }
};

/**
 * Get all conversations for current user
 * @returns {Promise<Array>} List of conversations
 */
export const getConversations = async () => {
  try {
    const response = await withRetry(() =>
      apiClient.get('/chat/conversations')
    );
    // Backend returns { success, message, data: conversations[] }
    return response.data.data || response.data;
  } catch (error) {
    console.error('Error fetching conversations:', error);
    
    // Return empty array on error to prevent UI crashes
    if (error.response?.status >= 500) {
      console.warn('Server error, returning empty conversations list');
      return [];
    }
    
    throw error;
  }
};

/**
 * Get messages in a conversation with pagination
 * @param {string} conversationId - Conversation ID
 * @param {number} page - Page number (default: 1)
 * @param {number} limit - Items per page (default: 50)
 * @returns {Promise<{data: Array, meta: Object}>} Messages with pagination metadata
 */
export const getConversationMessages = async (conversationId, page = 1, limit = 50) => {
  try {
    const response = await withRetry(() =>
      apiClient.get(`/chat/conversations/${conversationId}/messages`, {
        params: { page, limit }
      })
    );
    // Backend returns { success, message, meta, data: messages[] }
    return {
      data: response.data.data || response.data,
      meta: response.data.meta || {}
    };
  } catch (error) {
    console.error('Error fetching conversation messages:', error);
    
    // Handle specific error cases
    if (error.response?.status === 404) {
      throw new Error('Không tìm thấy cuộc trò chuyện');
    }
    
    if (error.response?.status === 403) {
      throw new Error('Bạn không có quyền truy cập cuộc trò chuyện này');
    }
    
    throw error;
  }
};

/**
 * Mark all messages in a conversation as read
 * @param {string} conversationId - Conversation ID
 * @returns {Promise<Object>} Success response
 */
export const markConversationAsRead = async (conversationId) => {
  try {
    const response = await withRetry(() =>
      apiClient.put(`/chat/conversations/${conversationId}/read`)
    );
    return response;
  } catch (error) {
    console.error('Error marking conversation as read:', error);
    
    // Non-critical operation, log but don't throw
    if (error.response?.status >= 500) {
      console.warn('Failed to mark conversation as read, will retry later');
      return { success: false };
    }
    
    throw error;
  }
};

/**
 * Get conversation details by ID
 * @param {string} conversationId - Conversation ID
 * @returns {Promise<Object>} Conversation details
 */
export const getConversationDetails = async (conversationId) => {
  try {
    const response = await withRetry(() =>
      apiClient.get(`/chat/conversations/${conversationId}`)
    );
    return response.data;
  } catch (error) {
    console.error('Error fetching conversation details:', error);
    
    // Handle specific error cases
    if (error.response?.status === 404) {
      throw new Error('Không tìm thấy cuộc trò chuyện');
    }
    
    if (error.response?.status === 403) {
      throw new Error('Bạn không có quyền truy cập cuộc trò chuyện này');
    }
    
    throw error;
  }
};

/**
 * Mark specific messages as read
 * @param {Array<string>} messageIds - Array of message IDs
 * @returns {Promise<Object>} Success response
 */
export const markMessagesAsRead = async (messageIds) => {
  try {
    const response = await withRetry(() =>
      apiClient.patch('/chat/messages/read', { messageIds })
    );
    return response;
  } catch (error) {
    console.error('Error marking messages as read:', error);
    
    // Non-critical operation, log but don't throw
    if (error.response?.status >= 500) {
      console.warn('Failed to mark messages as read, will retry later');
      return { success: false };
    }
    
    throw error;
  }
};
</file>

<file path="src/services/companyService.js">
import apiClient from './apiClient';

/**
 * Lấy danh sách tất cả công ty với filter và pagination
 * @param {Object} params - Query parameters
 * @returns {Promise} Response data
 */
export const getAllCompanies = async (params = {}) => {
  const queryParams = new URLSearchParams();
  if (params.search) queryParams.append('search', params.search);
  if (params.industry) queryParams.append('industry', params.industry);
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);

  const url = `/companies${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  const response = await apiClient.get(url);
  return response;
};

/**
 * Lấy chi tiết một công ty theo ID
 * @param {string} companyId - ID của công ty
 * @returns {Promise} Response data
 */
export const getCompanyById = async (companyId) => {
  const response = await apiClient.get(`/companies/${companyId}`);
  return response;
};

/**
 * Lấy danh sách việc làm của một công ty
 * @param {string} companyId - ID của công ty
 * @param {Object} params - Query parameters (page, limit, province, sortBy)
 * @returns {Promise} Response data
 */
export const getCompanyJobs = async (companyId, params = {}) => {
  const queryParams = new URLSearchParams();
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);
  if (params.province) queryParams.append('province', params.province);
  if (params.sortBy) queryParams.append('sortBy', params.sortBy);
  if (params.search) queryParams.append('search', params.search);

  const url = `/companies/${companyId}/jobs${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  const response = await apiClient.get(url);
  return response;
};

/**
 * Lấy thông tin công ty của recruiter đang đăng nhập
 * @returns {Promise} Response data
 */
export const getMyCompany = async () => {
  const response = await apiClient.get('/companies/my-company');
  return response;
};

/**
 * Tạo công ty mới (cho recruiter)
 * @param {FormData} formData - Form data chứa thông tin công ty
 * @returns {Promise} Response data
 */
export const createCompany = async (formData) => {
  const response = await apiClient.post('/companies', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  });
  return response;
};

/**
 * Cập nhật thông tin công ty (cho recruiter)
 * @param {FormData} formData - Form data chứa thông tin cập nhật
 * @returns {Promise} Response data
 */
export const updateMyCompany = async (formData) => {
  const response = await apiClient.patch('/companies/my-company', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  });
  return response;
};

/**
 * Cập nhật logo công ty (cho recruiter)
 * @param {FormData} formData - Form data chứa file logo
 * @returns {Promise} Response data
 */
export const updateCompanyLogo = async (formData) => {
  const response = await apiClient.post('/companies/my-company/logo', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  });
  return response;
};
</file>

<file path="src/services/creditHistoryService.js">
import apiClient from './apiClient';

/**
 * Get credit transaction history with filters and pagination
 * @param {Object} params - Query parameters
 * @param {number} params.page - Page number (default: 1)
 * @param {number} params.limit - Items per page (default: 20, max: 100)
 * @param {string} params.type - Transaction type filter ('DEPOSIT' | 'USAGE')
 * @param {string} params.category - Category filter (e.g., 'RECHARGE', 'JOB_VIEW', 'CV_UNLOCK')
 * @param {string} params.startDate - Start date filter (ISO 8601 format)
 * @param {string} params.endDate - End date filter (ISO 8601 format)
 * @returns {Promise<Object>} Response with transactions, pagination, and summary
 */
export const getCreditHistory = async (params = {}) => {
  try {
    const response = await apiClient.get('/credit-history', { params });
    return response.data;
  } catch (error) {
    console.error('Error fetching credit history:', error);
    throw error;
  }
};

/**
 * Get credit transaction summary statistics
 * @param {Object} params - Query parameters
 * @param {string} params.startDate - Start date for summary (ISO 8601 format)
 * @param {string} params.endDate - End date for summary (ISO 8601 format)
 * @returns {Promise<Object>} Response with current balance, totals, and category breakdown
 */
export const getCreditSummary = async (params = {}) => {
  try {
    const response = await apiClient.get('/credit-history/summary', { params });
    return response.data;
  } catch (error) {
    console.error('Error fetching credit summary:', error);
    throw error;
  }
};
</file>

<file path="src/services/cvService.js">
import apiClient from './apiClient';

/**
 * Lấy danh sách CV của candidate
 */
export const getCVs = async () => {
  const response = await apiClient.get('/candidate/cvs');
  return response.data;
};

/**
 * Upload CV mới
 */
export const uploadCV = async (formData) => {
  const response = await apiClient.post('/candidate/cvs', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  return response.data;
};

/**
 * Xóa CV
 */
export const deleteCV = async (cvId) => {
  const response = await apiClient.delete(`/candidate/cvs/${cvId}`);
  return response.data;
};

/**
 * Set CV mặc định
 */
export const setDefaultCV = async (cvId) => {
  const response = await apiClient.patch(`/candidate/cvs/${cvId}/set-default`);
  return response.data;
};

/**
 * Đổi tên CV
 */
export const renameCV = async (cvId, newName) => {
  const response = await apiClient.patch(`/candidate/cvs/${cvId}`, { name: newName });
  return response.data;
};
</file>

<file path="src/services/firebase.js">
import { initializeApp } from 'firebase/app';
import { getMessaging, getToken, onMessage } from 'firebase/messaging';
import apiClient from './apiClient';

// IMPORTANT: Replace with your web app's Firebase configuration.
const firebaseConfig = {
  apiKey: "AIzaSyAz6_sm6rkwgMjSWlXpiFOqOAmW-pBlwR0",
  authDomain: "careerzone-53619.firebaseapp.com",
  projectId: "careerzone-53619",
  storageBucket: "careerzone-53619.firebasestorage.app",
  messagingSenderId: "911786085213",
  appId: "1:911786085213:web:0d19671640b5aa6cfcb6b4"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const messaging = getMessaging(app);

/**
 * Registers the device token with the backend server.
 * @param {string} token The FCM device token.
 */
const registerDeviceToken = async (token) => {
  try {
    await apiClient.post('/users/register-device', { token });
    console.log('Device token registered successfully with the backend.');
  } catch (error) {
    console.error('Failed to register device token with the backend:', error);
  }
};

/**
 * Requests permission to receive push notifications and returns the device token.
 * If a token is retrieved, it is also sent to the backend.
 * @returns {Promise<string|null>} The Firebase Cloud Messaging token.
 */
export const requestForToken = async () => {
  try {
    const currentToken = await getToken(messaging, { vapidKey: import.meta.env.VITE_FIREBASE_VAPID_KEY });
    if (currentToken) {
      console.log('FCM Token:', currentToken);
      // Send this token to your server.
      await registerDeviceToken(currentToken);
    } else {
      console.log('No registration token available. Request permission to generate one.');
    }
    return currentToken;
  } catch (err) {
    console.error('An error occurred while retrieving token.', err);
    return null;
  }
};

/**
 * Sets up a listener for incoming foreground messages.
 * @param {function} callback The function to call with the message payload.
 * @returns {import('firebase/messaging').Unsubscribe} A function to unsubscribe the listener.
 */
export const setupOnMessageListener = (callback) => {
  return onMessage(messaging, (payload) => {
    console.log('Foreground message received:', payload);
    callback(payload);
  });
};
</file>

<file path="src/services/interviewService.js">
import apiClient from './apiClient';

/**
 * Interview Service for Candidate
 * Handles API calls for candidate interview operations
 */

/**
 * Get all interviews for the logged-in candidate
 * @param {Object} params - Query parameters
 * @param {string} params.status - Filter by status: 'SCHEDULED', 'STARTED', 'COMPLETED', 'CANCELLED', 'RESCHEDULED'
 * @param {number} params.page - Page number for pagination
 * @param {number} params.limit - Number of results per page
 * @returns {Promise<Object>} Interview list with pagination
 */
export const getMyInterviews = async (params = {}) => {
  const queryParams = new URLSearchParams();
  
  if (params.status) queryParams.append('status', params.status);
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);
  
  const url = `/interviews/my-scheduled-interviews${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  const response = await apiClient.get(url);
  return response.data;
};

/**
 * Get interview details by ID
 * @param {string} interviewId - Interview ID
 * @returns {Promise<Object>} Interview details
 */
export const getInterviewById = async (interviewId) => {
  const response = await apiClient.get(`/interviews/${interviewId}`);
  return response.data;
};

/**
 * Accept an interview invitation
 * @param {string} interviewId - Interview ID to accept
 * @returns {Promise<Object>} Updated interview
 */
export const acceptInterview = async (interviewId) => {
  const response = await apiClient.patch(`/candidate/interviews/${interviewId}/accept`);
  return response.data;
};

/**
 * Decline an interview invitation
 * @param {string} interviewId - Interview ID to decline
 * @param {Object} data - Decline reason
 * @param {string} data.reason - Reason for declining
 * @returns {Promise<Object>} Updated interview
 */
export const declineInterview = async (interviewId, data = {}) => {
  const response = await apiClient.patch(`/candidate/interviews/${interviewId}/decline`, data);
  return response.data;
};

/**
 * Check if candidate can join interview (30 min before to 30 min after)
 * @param {string} scheduledTime - ISO string of interview scheduled time
 * @returns {Object} { canJoin: boolean, reason: string, minutesUntilStart: number }
 */
export const checkCanJoinInterview = (scheduledTime) => {
  const now = new Date();
  const interviewTime = new Date(scheduledTime);
  const diffMinutes = Math.floor((interviewTime - now) / 1000 / 60);
  
  if (diffMinutes > 30) {
    return {
      canJoin: false,
      reason: 'Interview has not started yet. You can join 30 minutes before the scheduled time.',
      minutesUntilStart: diffMinutes
    };
  }
  
  if (diffMinutes < -30) {
    return {
      canJoin: false,
      reason: 'Interview window has closed. You can only join within 30 minutes after the scheduled time.',
      minutesUntilStart: diffMinutes
    };
  }
  
  return {
    canJoin: true,
    reason: 'You can join the interview now.',
    minutesUntilStart: diffMinutes
  };
};

/**
 * Generate Google Calendar link for interview
 * @param {Object} interview - Interview object
 * @returns {string} Google Calendar URL
 */
export const generateGoogleCalendarLink = (interview) => {
  const { scheduledTime, job, duration = 60 } = interview;
  
  const startTime = new Date(scheduledTime);
  const endTime = new Date(startTime.getTime() + duration * 60000);
  
  const formatDate = (date) => {
    return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
  };
  
  const params = new URLSearchParams({
    action: 'TEMPLATE',
    text: `Interview for ${job?.title || 'Position'}`,
    dates: `${formatDate(startTime)}/${formatDate(endTime)}`,
    details: `Online interview for ${job?.title || 'Position'} position at ${job?.company?.name || 'Company'}.\n\nJoin link: ${window.location.origin}/interviews/${interview._id}/room`,
    location: 'Online Video Interview'
  });
  
  return `https://calendar.google.com/calendar/render?${params.toString()}`;
};

/**
 * Generate .ics file content for downloading
 * @param {Object} interview - Interview object
 * @returns {string} iCalendar format content
 */
export const generateICSFile = (interview) => {
  const { scheduledTime, job, duration = 60, _id } = interview;
  
  const startTime = new Date(scheduledTime);
  const endTime = new Date(startTime.getTime() + duration * 60000);
  
  const formatICSDate = (date) => {
    return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
  };
  
  const icsContent = [
    'BEGIN:VCALENDAR',
    'VERSION:2.0',
    'PRODID:-//Job Portal//Interview Calendar//EN',
    'BEGIN:VEVENT',
    `UID:interview-${_id}@jobportal.com`,
    `DTSTAMP:${formatICSDate(new Date())}`,
    `DTSTART:${formatICSDate(startTime)}`,
    `DTEND:${formatICSDate(endTime)}`,
    `SUMMARY:Interview for ${job?.title || 'Position'}`,
    `DESCRIPTION:Online interview for ${job?.title || 'Position'} position at ${job?.company?.name || 'Company'}.\\n\\nJoin link: ${window.location.origin}/interviews/${_id}/room`,
    'LOCATION:Online Video Interview',
    'STATUS:CONFIRMED',
    'BEGIN:VALARM',
    'TRIGGER:-PT15M',
    'ACTION:DISPLAY',
    'DESCRIPTION:Interview starts in 15 minutes',
    'END:VALARM',
    'END:VEVENT',
    'END:VCALENDAR'
  ].join('\r\n');
  
  return icsContent;
};

/**
 * Download .ics file
 * @param {Object} interview - Interview object
 */
export const downloadICSFile = (interview) => {
  const icsContent = generateICSFile(interview);
  const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `interview-${interview.job?.title || 'schedule'}.ics`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(link.href);
};

/**
 * Format interview time for display
 * @param {string} scheduledTime - ISO string
 * @returns {Object} Formatted time parts
 */
export const formatInterviewTime = (scheduledTime) => {
  const date = new Date(scheduledTime);
  const now = new Date();
  
  const dateString = date.toLocaleDateString('vi-VN', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
  
  const timeString = date.toLocaleTimeString('vi-VN', {
    hour: '2-digit',
    minute: '2-digit'
  });
  
  // Calculate relative time
  const diffMinutes = Math.floor((date - now) / 1000 / 60);
  let relativeTime = '';
  
  if (diffMinutes > 0) {
    if (diffMinutes < 60) {
      relativeTime = `in ${diffMinutes} minutes`;
    } else if (diffMinutes < 1440) {
      const hours = Math.floor(diffMinutes / 60);
      relativeTime = `in ${hours} hour${hours > 1 ? 's' : ''}`;
    } else {
      const days = Math.floor(diffMinutes / 1440);
      relativeTime = `in ${days} day${days > 1 ? 's' : ''}`;
    }
  } else if (diffMinutes > -30) {
    relativeTime = 'happening now';
  } else {
    relativeTime = 'completed';
  }
  
  return {
    date: dateString,
    time: timeString,
    relative: relativeTime,
    isPast: diffMinutes < -30,
    isNow: diffMinutes >= -30 && diffMinutes <= 30
  };
};

export default {
  getMyInterviews,
  getInterviewById,
  acceptInterview,
  declineInterview,
  checkCanJoinInterview,
  generateGoogleCalendarLink,
  generateICSFile,
  downloadICSFile,
  formatInterviewTime
};
</file>

<file path="src/services/interviewSocket.service.js">
/**
 * InterviewSocketService for Candidate - Manages Socket.io connections for interview features
 * Handles WebRTC signaling, chat messages, and room management
 */
import { io } from 'socket.io-client';

class InterviewSocketService {
  constructor() {
    this.socket = null;
    this.isConnected = false;
    this.isConnecting = false;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 5;
    this.currentInterviewId = null;
    this.eventHandlers = new Map();
    this.connectionPromise = null;
    this.currentUser = null;
    this.currentUserId = null;
    
    // Get Socket.io URL from environment
    const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';
    this.socketUrl = apiUrl.replace(/\/api$/, '');
  }

  /**
   * Register event handler
   */
  on(event, handler) {
    if (!this.eventHandlers.has(event)) {
      this.eventHandlers.set(event, []);
    }
    this.eventHandlers.get(event).push(handler);
  }

  /**
   * Unregister event handler
   */
  off(event, handler) {
    if (!this.eventHandlers.has(event)) return;
    
    const handlers = this.eventHandlers.get(event);
    const index = handlers.indexOf(handler);
    if (index > -1) {
      handlers.splice(index, 1);
    }
  }

  /**
   * Trigger event handlers
   * @private
   */
  _triggerHandler(event, data) {
    if (!this.eventHandlers.has(event)) return;
    
    const handlers = this.eventHandlers.get(event);
    handlers.forEach(handler => {
      try {
        handler(data);
      } catch (error) {
        console.error(`[InterviewSocket] Error in ${event} handler:`, error);
      }
    });
  }

  /**
   * Connect to Socket.io server with JWT authentication
   */
  async connect(token) {
    if (this.socket && this.isConnected) {
      console.log('[InterviewSocket] Already connected');
      return Promise.resolve();
    }

    if (this.isConnecting && this.connectionPromise) {
      console.log('[InterviewSocket] Connection in progress');
      return this.connectionPromise;
    }

    this.isConnecting = true;
    this.connectionPromise = new Promise((resolve, reject) => {
      if (!token) {
        console.error('[InterviewSocket] No authentication token');
        this.isConnecting = false;
        this.connectionPromise = null;
        reject(new Error('No authentication token'));
        return;
      }

      console.log('[InterviewSocket] Connecting to:', this.socketUrl);

      const connectionTimeout = setTimeout(() => {
        if (!this.isConnected) {
          console.error('[InterviewSocket] Connection timeout');
          this.isConnecting = false;
          this.connectionPromise = null;
          reject(new Error('Connection timeout'));
        }
      }, 10000);

      this.socket = io(this.socketUrl, {
        auth: { token },
        transports: ['websocket', 'polling'],
        reconnection: true,
        reconnectionAttempts: this.maxReconnectAttempts,
        reconnectionDelay: 2000,
        timeout: 20000,
      });

      this.socket.on('connect', () => {
        console.log('[InterviewSocket] Connected, socket ID:', this.socket.id);
        clearTimeout(connectionTimeout);
        this.isConnected = true;
        this.isConnecting = false;
        this.reconnectAttempts = 0;
        this._triggerHandler('onConnect', { socketId: this.socket.id });
        
        // Debug: Log all socket events
        this.socket.onAny((eventName, ...args) => {
          console.log('[InterviewSocket] 🔔 Event received:', eventName, args);
        });
        
        resolve();
      });

      // Listen for authentication success
      this.socket.on('auth:success', (data) => {
        console.log('[InterviewSocket] Auth success:', data);
        this.currentUserId = data.userId;
        this.currentUser = data.user;
        this._triggerHandler('onAuthSuccess', data);
      });

      this.socket.on('connect_error', (error) => {
        console.error('[InterviewSocket] Connection error:', error.message);
        this.isConnected = false;
        this.reconnectAttempts++;
        
        this._triggerHandler('onConnectionError', {
          error,
          attempt: this.reconnectAttempts
        });

        if (this.reconnectAttempts === 1) {
          clearTimeout(connectionTimeout);
          this.isConnecting = false;
          this.connectionPromise = null;
          reject(error);
        }
      });

      this.socket.io.on('reconnect', (attemptNumber) => {
        console.log(`[InterviewSocket] Reconnected after ${attemptNumber} attempts`);
        this.isConnected = true;
        this.reconnectAttempts = 0;
        
        if (this.currentInterviewId) {
          console.log('[InterviewSocket] Rejoining interview after reconnect');
          this.joinInterview(this.currentInterviewId, { role: 'candidate' });
        }
        
        this._triggerHandler('onReconnect', attemptNumber);
      });

      this.socket.on('disconnect', (reason) => {
        console.log('[InterviewSocket] Disconnected:', reason);
        this.isConnected = false;
        this._triggerHandler('onDisconnect', reason);
      });

      this._setupInterviewListeners();
    });

    return this.connectionPromise;
  }

  /**
   * Setup listeners for interview events
   * @private
   */
  _setupInterviewListeners() {
    if (!this.socket) return;

    // User joined
    this.socket.on('interview:user-joined', (data) => {
      console.log('[InterviewSocket] User joined:', data);
      this._triggerHandler('onUserJoined', data);
    });

    // User left
    this.socket.on('interview:user-left', (data) => {
      console.log('[InterviewSocket] User left:', data);
      this._triggerHandler('onUserLeft', data);
    });

    // Peer disconnected abruptly
    this.socket.on('interview:peer-disconnected', (data) => {
      console.log('[InterviewSocket] Peer disconnected abruptly:', data);
      this._triggerHandler('onPeerDisconnected', data);
    });

    // WebRTC signaling - Offer
    this.socket.on('interview:offer', (data) => {
      console.log('[InterviewSocket] Offer received');
      this._triggerHandler('onOffer', data);
    });

    // WebRTC signaling - Answer
    this.socket.on('interview:answer', (data) => {
      console.log('[InterviewSocket] Answer received');
      this._triggerHandler('onAnswer', data);
    });

    // WebRTC signaling - ICE candidate
    this.socket.on('interview:ice-candidate', (data) => {
      console.log('[InterviewSocket] ICE candidate received');
      this._triggerHandler('onIceCandidate', data);
    });

    // WebRTC signaling - Generic signal
    this.socket.on('interview:signal', (data) => {
      console.log('[InterviewSocket] ===== Signal received from socket =====');
      console.log('[InterviewSocket] Signal from:', data.from || data.fromUserId);
      console.log('[InterviewSocket] Signal type:', data.signal?.type);
      console.log('[InterviewSocket] Full data:', data);
      this._triggerHandler('onSignal', data);
      console.log('[InterviewSocket] Signal handler triggered');
    });

    // Chat message
    this.socket.on('interview:chat-message', (data) => {
      console.log('[InterviewSocket] Chat message received');
      this._triggerHandler('onChatMessage', data);
    });

    // Recording started
    this.socket.on('interview:recording-started', (data) => {
      console.log('[InterviewSocket] Recording started');
      this._triggerHandler('onRecordingStarted', data);
    });

    // Recording stopped
    this.socket.on('interview:recording-stopped', (data) => {
      console.log('[InterviewSocket] Recording stopped');
      this._triggerHandler('onRecordingStopped', data);
    });

    // Interview ended
    this.socket.on('interview:ended', (data) => {
      console.log('[InterviewSocket] Interview ended');
      this._triggerHandler('onInterviewEnded', data);
    });

    // Error
    this.socket.on('interview:error', (data) => {
      console.error('[InterviewSocket] Interview error:', data);
      this._triggerHandler('onError', data);
    });
  }

  /**
   * Join interview room
   */
  async joinInterview(interviewId, data = {}) {
    return new Promise((resolve, reject) => {
      if (!this.socket || !this.isConnected) {
        reject(new Error('Socket not connected'));
        return;
      }

      console.log('[InterviewSocket] Joining interview:', interviewId);
      
      this.socket.emit('interview:join', {
        roomId: interviewId, // Backend expects both roomId and interviewId
        interviewId,
        role: 'candidate',
        ...data
      }, (response) => {
        if (response?.success) {
          console.log('[InterviewSocket] Joined interview successfully');
          this.currentInterviewId = interviewId;
          resolve(response);
        } else {
          console.error('[InterviewSocket] Failed to join interview:', response?.error);
          reject(new Error(response?.error || 'Failed to join interview'));
        }
      });
    });
  }

  /**
   * Leave interview room
   */
  leaveInterview(interviewId) {
    if (!this.socket || !this.isConnected) {
      console.warn('[InterviewSocket] Cannot leave - socket not connected');
      return;
    }

    console.log('[InterviewSocket] Leaving interview:', interviewId);
    
    this.socket.emit('interview:leave', { 
      interviewId,
      roomId: interviewId // Backend expects roomId
    });
    this.currentInterviewId = null;
  }

  /**
   * Send answer (Native WebRTC)
   */
  sendAnswer(interviewId, answer, to) {
    if (!this.socket || !this.isConnected) {
      console.error('[InterviewSocket] Cannot send answer - socket not connected');
      return;
    }

    console.log('[InterviewSocket] Sending answer');
    
    this.socket.emit('interview:answer', {
      interviewId,
      roomId: interviewId,
      answer,
      to
    });
  }

  /**
   * Send ICE candidate (Native WebRTC)
   */
  sendIceCandidate(interviewId, candidate, to) {
    if (!this.socket || !this.isConnected) {
      console.error('[InterviewSocket] Cannot send ICE candidate - socket not connected');
      return;
    }

    console.log('[InterviewSocket] Sending ICE candidate');
    
    this.socket.emit('interview:ice-candidate', {
      interviewId,
      roomId: interviewId,
      candidate,
      to
    });
  }

  /**
   * Send WebRTC signal (for simple-peer)
   * Signal can be offer, answer, or ICE candidate
   */
  sendSignal(interviewId, signal, to) {
    if (!this.socket || !this.isConnected) {
      console.error('[InterviewSocket] Cannot send signal - socket not connected');
      return;
    }

    console.log('[InterviewSocket] Sending signal:', signal.type || 'candidate', to ? `to ${to}` : 'to room');
    
    // Use unified interview:signal event for all signal types
    this.socket.emit('interview:signal', {
      interviewId,
      signal,
      to
    });
  }

  /**
   * Send chat message
   */
  sendChatMessage(interviewId, message) {
    return new Promise((resolve, reject) => {
      if (!this.socket || !this.isConnected) {
        console.error('[InterviewSocket] Cannot send message - socket not connected');
        reject(new Error('Socket not connected'));
        return;
      }

      console.log('[InterviewSocket] Sending chat message');
      
      this.socket.emit('interview:chat-message', {
        roomId: interviewId, // Backend expects both roomId and interviewId
        interviewId,
        message
      }, (response) => {
        if (response?.success) {
          console.log('[InterviewSocket] Message sent successfully');
          resolve(response);
        } else {
          console.error('[InterviewSocket] Failed to send message:', response?.error);
          reject(new Error(response?.error || 'Failed to send message'));
        }
      });
    });
  }

  /**
   * Disconnect socket
   */
  disconnect() {
    if (this.socket) {
      console.log('[InterviewSocket] Disconnecting');
      this.socket.disconnect();
      this.socket = null;
    }
    
    this.isConnected = false;
    this.isConnecting = false;
    this.currentInterviewId = null;
    this.connectionPromise = null;
  }

  /**
   * Get current user ID (from JWT decode)
   */
  getCurrentUserId() {
    return this.currentUserId;
  }

  /**
   * Get current user info
   */
  getCurrentUser() {
    return this.currentUser;
  }

  /**
   * Get connection status
   */
  getStatus() {
    return {
      isConnected: this.isConnected,
      isConnecting: this.isConnecting,
      socketId: this.socket?.id,
      currentInterviewId: this.currentInterviewId,
      reconnectAttempts: this.reconnectAttempts,
      currentUserId: this.currentUserId
    };
  }
}

// Export singleton instance
const interviewSocketService = new InterviewSocketService();
export default interviewSocketService;
</file>

<file path="src/services/jobAlertService.js">
import apiClient from './apiClient';

/**
 * Get all job alerts for current user
 */
export const getMyJobAlerts = async () => {
  const { data } = await apiClient.get('/job-alerts');
  return data.data;
};

/**
 * Create a new job alert
 */
export const createJobAlert = async (alertData) => {
  const { data } = await apiClient.post('/job-alerts', alertData);
  return data.data;
};

/**
 * Update a job alert
 */
export const updateJobAlert = async (id, alertData) => {
  const { data } = await apiClient.put(`/job-alerts/${id}`, alertData);
  return data.data;
};

/**
 * Delete a job alert
 */
export const deleteJobAlert = async (id) => {
  const { data } = await apiClient.delete(`/job-alerts/${id}`);
  return data;
};

/**
 * Get notification history for a specific alert
 */
export const getNotificationHistory = async (id, params = {}) => {
  const { data } = await apiClient.get(`/job-alerts/${id}/history`, { params });
  return { data: data.data, meta: data.meta };
};

/**
 * Get all notification history
 */
export const getAllNotificationHistory = async (params = {}) => {
  const { data } = await apiClient.get('/job-alerts/history', { params });
  return { data: data.data, meta: data.meta };
};
</file>

<file path="src/services/paymentService.js">
import apiClient from './apiClient';

/**
 * Creates a new payment order to recharge coins.
 * @param {object} orderData - The data for the payment order.
 * @param {number} orderData.coins - The number of coins to purchase.
 * @param {string} orderData.paymentMethod - The payment method (e.g., 'ZALOPAY').
 * @returns {Promise<object>} The response from the server, containing the payment URL.
 */
export const createPaymentOrder = async (orderData) => {
  try {
    const response = await apiClient.post('/payments/create-order', orderData);
    return response.data; // Trả về response.data để hook xử lý
  } catch (error) {
    console.error('Error creating payment order:', error.response?.data || error.message);
    throw error;
  }
};

/**
 * Queries the result of a payment transaction from the server.
 * @param {string} queryString - The query string from the payment gateway's return URL.
 * @returns {Promise<object>} The response from the server, containing the new coin balance.
 */
export const getPaymentResult = async (queryString) => {
  try {
    const response = await apiClient.get(`/payments/vnpay_return?${queryString}`);
    return response.data;
  } catch (error) {
    console.error('Error querying payment result:', error.response?.data || error.message);
    throw error;
  }
};
</file>

<file path="src/services/recommendationService.js">
import apiClient from './apiClient';

/**
 * Generate job recommendations for the authenticated candidate
 * @param {Object} options - Generation options (maxDistance, limit)
 * @returns {Promise<Object>} Generated recommendations
 */
export const generateRecommendations = async (options = {}) => {
  const response = await apiClient.post('/candidate/recommendations/generate', options);
  return response.data;
};

/**
 * Get job recommendations with pagination
 * @param {Object} params - Query parameters (page, limit, refresh)
 * @returns {Promise<Object>} Paginated recommendations
 */
export const getRecommendations = async (params = {}) => {
  const queryParams = new URLSearchParams();
  
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);
  if (params.refresh !== undefined) queryParams.append('refresh', params.refresh);
  
  const url = `/candidate/recommendations${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  const response = await apiClient.get(url);
  return response.data;
};

/**
 * Refresh recommendations (regenerate based on current profile)
 * @param {Object} options - Generation options
 * @returns {Promise<Object>} Refreshed recommendations
 */
export const refreshRecommendations = async (options = {}) => {
  return getRecommendations({ ...options, refresh: true });
};
</file>

<file path="src/services/searchHistoryService.js">
import apiClient from './apiClient';

/**
 * Lấy lịch sử tìm kiếm của người dùng
 * @param {object} params - Tham số query
 * @param {number} params.limit - Số lượng items mỗi trang (default: 10, max: 50)
 * @param {number} params.page - Trang hiện tại (default: 1)
 * @returns {Promise} Response với data và pagination
 */
export const getUserHistory = async ({ limit = 10, page = 1 } = {}) => {
  try {
    const queryParams = new URLSearchParams();
    if (limit) queryParams.append('limit', Math.min(limit, 50)); // Giới hạn tối đa 50
    if (page) queryParams.append('page', page);

    const url = `/search-history${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
    const response = await apiClient.get(url);
    return response.data;
  } catch (error) {
    console.error('Lỗi khi lấy lịch sử tìm kiếm:', error);
    throw error;
  }
};



/**
 * Lưu lịch sử tìm kiếm
 * @param {object} searchData - Dữ liệu tìm kiếm
 * @param {string} searchData.query - Từ khóa tìm kiếm
 * @returns {Promise} Response với entry đã lưu
 */
export const saveHistory = async (searchData) => {
  try {
    const response = await apiClient.post('/search-history', searchData);
    return response.data;
  } catch (error) {
    console.error('Lỗi khi lưu lịch sử tìm kiếm:', error);
    throw error;
  }
};

/**
 * Xóa một mục lịch sử tìm kiếm
 * @param {string} entryId - ID của mục lịch sử cần xóa
 * @returns {Promise} Response xác nhận xóa thành công
 */
export const deleteHistory = async (entryId) => {
  try {
    const response = await apiClient.delete(`/search-history/${entryId}`);
    return response.data;
  } catch (error) {
    console.error('Lỗi khi xóa lịch sử tìm kiếm:', error);
    throw error;
  }
};

/**
 * Xóa toàn bộ lịch sử tìm kiếm của người dùng
 * @returns {Promise} Response xác nhận xóa thành công
 */
export const clearAllHistory = async () => {
  try {
    const response = await apiClient.delete('/search-history');
    return response.data;
  } catch (error) {
    console.error('Lỗi khi xóa toàn bộ lịch sử tìm kiếm:', error);
    throw error;
  }
};

// Export default object chứa tất cả các methods
const searchHistoryService = {
  getUserHistory,
  saveHistory,
  deleteHistory,
  clearAllHistory
};

export default searchHistoryService;
</file>

<file path="src/services/socketService.js">
import { io } from 'socket.io-client';
import { getAccessToken } from '@/utils/token';

/**
 * SocketService - Singleton service for managing Socket.io connections
 * Handles real-time messaging with auto-reconnect and exponential backoff
 */
class SocketService {
  constructor() {
    this.socket = null;
    this.isConnected = false;
    this.isConnecting = false;
    this.reconnectAttempts = 0;
    this.maxReconnectAttempts = 10;
    this.reconnectDelays = [1000, 2000, 4000, 8000, 30000]; // Exponential backoff: 1s, 2s, 4s, 8s, max 30s
    this.eventHandlers = new Map();
    this.connectionPromise = null;
    
    // Get Socket.io URL from environment
    const apiUrl = import.meta.env.VITE_API_URL || 'http://localhost:5000/api';
    // Extract base URL (remove /api suffix if present)
    this.socketUrl = apiUrl.replace(/\/api$/, '');
  }

  /**
   * Establish Socket.io connection with JWT authentication
   * @param {string} token - JWT access token (optional, will use stored token if not provided)
   * @returns {Promise<void>}
   */
  connect(token = null) {
    // If already connected, resolve immediately
    if (this.socket && this.isConnected) {
      console.log('[SocketService] Already connected');
      return Promise.resolve();
    }

    // If already connecting, return the existing promise
    if (this.isConnecting && this.connectionPromise) {
      console.log('[SocketService] Connection already in progress');
      return this.connectionPromise;
    }

    this.isConnecting = true;
    this.connectionPromise = new Promise((resolve, reject) => {
      // Get token from parameter or storage
      const authToken = token || getAccessToken();
      
      if (!authToken) {
        console.error('[SocketService] No authentication token available');
        this.isConnecting = false;
        this.connectionPromise = null;
        reject(new Error('No authentication token'));
        return;
      }

      console.log('[SocketService] Connecting to:', this.socketUrl);

      // Set a timeout for initial connection
      const connectionTimeout = setTimeout(() => {
        if (!this.isConnected) {
          console.error('[SocketService] Connection timeout after 10 seconds');
          this.isConnecting = false;
          this.connectionPromise = null;
          reject(new Error('Connection timeout'));
        }
      }, 10000);

      // Create socket connection with authentication
      this.socket = io(this.socketUrl, {
        auth: {
          token: authToken
        },
        transports: ['websocket', 'polling'],
        reconnection: true,
        reconnectionAttempts: this.maxReconnectAttempts,
        reconnectionDelay: 1000,
        reconnectionDelayMax: 30000,
        timeout: 20000,
      });

      // Connection successful
      this.socket.on('connect', () => {
        console.log('[SocketService] Connected with socket ID:', this.socket.id);
        clearTimeout(connectionTimeout);
        this.isConnected = true;
        this.isConnecting = false;
        this.reconnectAttempts = 0;
        
        // Trigger connection success callback
        this._triggerHandler('onConnect');
        resolve();
      });

      // Connection error
      this.socket.on('connect_error', (error) => {
        console.error('[SocketService] Connection error:', error.message, error);
        this.isConnected = false;
        
        // Calculate reconnect delay with exponential backoff
        const delayIndex = Math.min(this.reconnectAttempts, this.reconnectDelays.length - 1);
        const delay = this.reconnectDelays[delayIndex];
        
        console.log(`[SocketService] Will reconnect (attempt ${this.reconnectAttempts + 1}), waiting ${delay}ms`);
        
        // Trigger connection error callback with delay info
        this._triggerHandler('onConnectionError', { 
          error, 
          attempt: this.reconnectAttempts + 1,
          nextDelay: delay 
        });
        
        // Only reject on first connection attempt, otherwise let auto-reconnect handle it
        if (this.reconnectAttempts === 0) {
          this.reconnectAttempts++;
          this.isConnecting = false;
          this.connectionPromise = null;
          clearTimeout(connectionTimeout);
          console.error('[SocketService] First connection attempt failed, rejecting promise');
          reject(error);
        } else {
          this.reconnectAttempts++;
          console.log('[SocketService] Subsequent connection attempt failed, letting auto-reconnect handle it');
        }
      });

      // Reconnection attempt
      this.socket.io.on('reconnect_attempt', (attemptNumber) => {
        console.log(`[SocketService] Reconnection attempt ${attemptNumber}`);
        this._triggerHandler('onReconnecting', attemptNumber);
      });

      // Reconnection successful
      this.socket.io.on('reconnect', (attemptNumber) => {
        console.log(`[SocketService] Reconnected after ${attemptNumber} attempts`);
        this.isConnected = true;
        this.reconnectAttempts = 0;
        this._triggerHandler('onReconnect', attemptNumber);
      });

      // Reconnection failed
      this.socket.io.on('reconnect_failed', () => {
        console.error('[SocketService] Reconnection failed after max attempts');
        this.isConnected = false;
        this._triggerHandler('onReconnectFailed');
      });

      // Disconnection
      this.socket.on('disconnect', (reason) => {
        console.log('[SocketService] Disconnected:', reason);
        this.isConnected = false;
        this._triggerHandler('onDisconnect', reason);
      });

      // Setup message event listeners
      this._setupMessageListeners();
    });

    return this.connectionPromise;
  }

  /**
   * Setup listeners for message-related events
   * @private
   */
  _setupMessageListeners() {
    if (!this.socket) return;

    // New message received
    this.socket.on('message:new', (message) => {
      console.log('[SocketService] New message received:', message);
      this._triggerHandler('onNewMessage', message);
    });

    // Message read receipt
    this.socket.on('chat:messageRead', (data) => {
      console.log('[SocketService] Message read:', data);
      this._triggerHandler('onMessageRead', data);
    });

    // Typing indicators
    this.socket.on('chat:typing:start', (data) => {
      console.log('[SocketService] User typing:', data.userId);
      this._triggerHandler('onTypingStart', data);
    });

    this.socket.on('chat:typing:stop', (data) => {
      console.log('[SocketService] User stopped typing:', data.userId);
      this._triggerHandler('onTypingStop', data);
    });

    // User presence
    this.socket.on('user:presence', (data) => {
      console.log('[SocketService] User presence update:', data);
      this._triggerHandler('onUserPresence', data);
    });

    // Conversation created
    this.socket.on('conversation:created', (data) => {
      console.log('[SocketService] Conversation created:', data);
      this._triggerHandler('onConversationCreated', data);
    });

    // Error events
    this.socket.on('chat:error', (error) => {
      console.error('[SocketService] Chat error:', error);
      this._triggerHandler('onChatError', error);
    });
  }

  /**
   * Disconnect from Socket.io server gracefully
   */
  disconnect() {
    if (this.socket) {
      console.log('[SocketService] Disconnecting...');
      this.socket.disconnect();
      this.socket = null;
      this.isConnected = false;
      this.reconnectAttempts = 0;
      this.eventHandlers.clear();
    }
  }

  /**
   * Join a conversation room
   * @param {string} conversationId - Conversation ID to join
   */
  joinConversation(conversationId) {
    if (!this.socket || !this.isConnected) {
      console.warn('[SocketService] Cannot join conversation: not connected');
      return;
    }

    console.log('[SocketService] Joining conversation:', conversationId);
    this.socket.emit('conversation:join', { conversationId });
  }

  /**
   * Leave a conversation room
   * @param {string} conversationId - Conversation ID to leave
   */
  leaveConversation(conversationId) {
    if (!this.socket || !this.isConnected) {
      console.warn('[SocketService] Cannot leave conversation: not connected');
      return;
    }

    console.log('[SocketService] Leaving conversation:', conversationId);
    this.socket.emit('conversation:leave', { conversationId });
  }

  /**
   * Send a message through Socket.io
   * @param {string} conversationId - Conversation ID
   * @param {string} content - Message content
   * @param {string} tempMessageId - Temporary message ID for optimistic updates
   * @param {string} type - Message type (default: 'text')
   * @param {object} metadata - Additional metadata
   * @returns {Promise<object>} Server response with saved message
   */
  sendMessage(conversationId, content, tempMessageId, type = 'text', metadata = null) {
    return new Promise((resolve, reject) => {
      if (!this.socket || !this.isConnected) {
        reject(new Error('Socket not connected'));
        return;
      }

      console.log('[SocketService] Sending message:', { conversationId, content, tempMessageId });

      // Set timeout for response
      const timeout = setTimeout(() => {
        console.error('[SocketService] Message send timeout - no response from server');
        reject(new Error('Timeout: Server did not respond'));
      }, 10000); // 10 second timeout

      // Emit message with callback
      this.socket.emit('message:send', 
        {
          conversationId,
          content,
          type,
          metadata,
          tempMessageId
        },
        (response) => {
          clearTimeout(timeout);
          console.log('[SocketService] Message sent, server response:', response);
          if (response.success) {
            console.log('[SocketService] Message sent successfully:', response.message);
            resolve(response);
          } else {
            console.error('[SocketService] Message send failed:', response.message);
            reject(new Error(response.message || 'Failed to send message'));
          }
        }
      );
    });
  }

  /**
   * Mark messages as read
   * @param {string[]} messageIds - Array of message IDs to mark as read
   * @param {string} senderId - ID of the original message sender
   */
  markMessagesAsRead(messageIds, senderId) {
    if (!this.socket || !this.isConnected) {
      console.warn('[SocketService] Cannot mark messages as read: not connected');
      return;
    }

    console.log('[SocketService] Marking messages as read:', messageIds);
    this.socket.emit('chat:markRead', { messageIds, senderId });
  }

  /**
   * Start typing indicator
   * @param {string} conversationId - Conversation ID
   */
  startTyping(conversationId) {
    if (!this.socket || !this.isConnected) {
      return;
    }

    this.socket.emit('chat:typing:start', { conversationId });
  }

  /**
   * Stop typing indicator
   * @param {string} conversationId - Conversation ID
   */
  stopTyping(conversationId) {
    if (!this.socket || !this.isConnected) {
      return;
    }

    this.socket.emit('chat:typing:stop', { conversationId });
  }

  /**
   * Register event handler
   * @param {string} eventName - Event name (e.g., 'onNewMessage')
   * @param {function} callback - Callback function
   */
  on(eventName, callback) {
    if (!this.eventHandlers.has(eventName)) {
      this.eventHandlers.set(eventName, []);
    }
    this.eventHandlers.get(eventName).push(callback);
  }

  /**
   * Unregister event handler
   * @param {string} eventName - Event name
   * @param {function} callback - Callback function to remove
   */
  off(eventName, callback) {
    if (!this.eventHandlers.has(eventName)) {
      return;
    }

    const handlers = this.eventHandlers.get(eventName);
    const index = handlers.indexOf(callback);
    if (index > -1) {
      handlers.splice(index, 1);
    }
  }

  /**
   * Trigger registered event handlers
   * @private
   * @param {string} eventName - Event name
   * @param {*} data - Event data
   */
  _triggerHandler(eventName, data) {
    if (!this.eventHandlers.has(eventName)) {
      return;
    }

    const handlers = this.eventHandlers.get(eventName);
    handlers.forEach(handler => {
      try {
        handler(data);
      } catch (error) {
        console.error(`[SocketService] Error in ${eventName} handler:`, error);
      }
    });
  }

  /**
   * Convenience methods for registering event handlers
   */
  onNewMessage(callback) {
    this.on('onNewMessage', callback);
  }

  onMessageRead(callback) {
    this.on('onMessageRead', callback);
  }

  onTypingStart(callback) {
    this.on('onTypingStart', callback);
  }

  onTypingStop(callback) {
    this.on('onTypingStop', callback);
  }

  onUserPresence(callback) {
    this.on('onUserPresence', callback);
  }

  onConversationCreated(callback) {
    this.on('onConversationCreated', callback);
  }

  onConnect(callback) {
    this.on('onConnect', callback);
  }

  onDisconnect(callback) {
    this.on('onDisconnect', callback);
  }

  onConnectionError(callback) {
    this.on('onConnectionError', callback);
  }

  onReconnecting(callback) {
    this.on('onReconnecting', callback);
  }

  onReconnect(callback) {
    this.on('onReconnect', callback);
  }

  onReconnectFailed(callback) {
    this.on('onReconnectFailed', callback);
  }

  onChatError(callback) {
    this.on('onChatError', callback);
  }

  /**
   * Get connection status
   * @returns {boolean} True if connected
   */
  getConnectionStatus() {
    return this.isConnected;
  }

  /**
   * Get socket instance (use with caution)
   * @returns {Socket|null} Socket.io client instance
   */
  getSocket() {
    return this.socket;
  }

  /**
   * Sync missed messages after reconnection
   * @param {string} conversationId - Conversation ID to sync
   * @param {string} lastMessageTimestamp - Timestamp of last received message
   * @returns {Promise<Array>} Array of missed messages
   */
  async syncMissedMessages(conversationId, lastMessageTimestamp) {
    return new Promise((resolve, reject) => {
      if (!this.socket || !this.isConnected) {
        reject(new Error('Socket not connected'));
        return;
      }

      console.log('[SocketService] Syncing missed messages for conversation:', conversationId);

      this.socket.emit('messages:sync', 
        {
          conversationId,
          since: lastMessageTimestamp
        },
        (response) => {
          if (response.success) {
            console.log('[SocketService] Synced missed messages:', response.messages?.length || 0);
            resolve(response.messages || []);
          } else {
            console.error('[SocketService] Failed to sync messages:', response.message);
            reject(new Error(response.message || 'Failed to sync messages'));
          }
        }
      );
    });
  }
}

// Export singleton instance
const socketService = new SocketService();
export default socketService;
</file>

<file path="src/services/sonioxService.js">
import apiClient from './apiClient';

/**
 * Get temporary Soniox API key from backend
 * @returns {Promise<{apiKey: string, expiresAt: string}>}
 */
export const getTemporarySonioxApiKey = async () => {
  const { data } = await apiClient.get('/soniox/temporary-api-key');
  return data.data; // { apiKey, expiresAt }
};

/**
 * Refresh Soniox API key if expired or about to expire
 * @param {string} currentExpiresAt - Current expiration time
 * @returns {Promise<{apiKey: string, expiresAt: string} | null>}
 */
export const refreshSonioxApiKeyIfNeeded = async (currentExpiresAt) => {
  if (!currentExpiresAt) {
    return await getTemporarySonioxApiKey();
  }

  const expiresAt = new Date(currentExpiresAt);
  const now = new Date();
  const timeUntilExpiry = expiresAt - now;
  
  // Refresh if less than 5 minutes until expiry
  if (timeUntilExpiry < 5 * 60 * 1000) {
    return await getTemporarySonioxApiKey();
  }

  return null; // No refresh needed
};
</file>

<file path="src/services/viewHistoryService.js">
import apiClient from './apiClient';

/**
 * Service quản lý lịch sử xem tin tuyển dụng
 */

/**
 * Lấy lịch sử xem tin tuyển dụng của người dùng
 * @param {object} params - Tham số query
 * @param {number} params.limit - Số lượng items mỗi trang (default: 10, max: 50)
 * @param {number} params.page - Trang hiện tại (default: 1)
 * @returns {Promise} Response với data và pagination
 */
export const getViewHistory = async ({ limit = 10, page = 1 } = {}) => {
  try {
    const queryParams = new URLSearchParams();
    if (limit) queryParams.append('limit', Math.min(limit, 50));
    if (page) queryParams.append('page', page);

    const url = `/job-view-history${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
    const response = await apiClient.get(url);
    return response.data;
  } catch (error) {
    console.error('Lỗi khi lấy lịch sử xem tin tuyển dụng:', error);
    throw error;
  }
};

/**
 * Lưu lịch sử xem tin tuyển dụng
 * @param {string} jobId - ID của tin tuyển dụng
 * @returns {Promise} Response với entry đã lưu
 */
export const saveViewHistory = async (jobId) => {
  try {
    const response = await apiClient.post('/job-view-history', { jobId });
    return response.data;
  } catch (error) {
    console.error('Lỗi khi lưu lịch sử xem tin tuyển dụng:', error);
    throw error;
  }
};

/**
 * Xóa một mục lịch sử xem
 * @param {string} entryId - ID của mục lịch sử cần xóa
 * @returns {Promise} Response xác nhận xóa thành công
 */
export const deleteViewHistory = async (entryId) => {
  try {
    const response = await apiClient.delete(`/job-view-history/${entryId}`);
    return response.data;
  } catch (error) {
    console.error('Lỗi khi xóa lịch sử xem:', error);
    throw error;
  }
};

/**
 * Xóa toàn bộ lịch sử xem của người dùng
 * @returns {Promise} Response xác nhận xóa thành công
 */
export const clearAllViewHistory = async () => {
  try {
    const response = await apiClient.delete('/job-view-history');
    return response.data;
  } catch (error) {
    console.error('Lỗi khi xóa toàn bộ lịch sử xem:', error);
    throw error;
  }
};

/**
 * Lấy thống kê lịch sử xem
 * @returns {Promise} Response với thống kê
 */
export const getViewHistoryStats = async () => {
  try {
    const response = await apiClient.get('/job-view-history/stats');
    return response.data;
  } catch (error) {
    console.error('Lỗi khi lấy thống kê lịch sử xem:', error);
    throw error;
  }
};

// Export default object chứa tất cả các methods
const viewHistoryService = {
  getViewHistory,
  saveViewHistory,
  deleteViewHistory,
  clearAllViewHistory,
  getViewHistoryStats
};

export default viewHistoryService;
</file>

<file path="src/services/webrtc-native.service.js">
/**
 * WebRTC Service (Native) for Candidate - WITHOUT simple-peer
 * Pure WebRTC implementation for video call interviews
 * Candidate is the ANSWERER (receives offer, creates answer)
 */

class WebRTCNativeService {
  constructor() {
    this.peerConnection = null;
    this.localStream = null;
    this.remoteStream = null;
    this.connectionState = 'disconnected';
    this.eventHandlers = new Map();
    this.iceCandidatesQueue = [];
    this.isAnswerCreated = false;
    
    // ICE servers configuration
    this.config = {
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' },
        {
          urls: 'turn:openrelay.metered.ca:80',
          username: 'openrelayproject',
          credential: 'openrelayproject'
        },
        {
          urls: 'turn:openrelay.metered.ca:443',
          username: 'openrelayproject',
          credential: 'openrelayproject'
        },
        {
          urls: 'turn:openrelay.metered.ca:443?transport=tcp',
          username: 'openrelayproject',
          credential: 'openrelayproject'
        }
      ],
      iceCandidatePoolSize: 10
    };
  }

  /**
   * Register event handler
   */
  on(event, handler) {
    if (!this.eventHandlers.has(event)) {
      this.eventHandlers.set(event, []);
    }
    this.eventHandlers.get(event).push(handler);
  }

  /**
   * Unregister event handler
   */
  off(event, handler) {
    if (!this.eventHandlers.has(event)) return;
    
    const handlers = this.eventHandlers.get(event);
    const index = handlers.indexOf(handler);
    if (index > -1) {
      handlers.splice(index, 1);
    }
  }

  /**
   * Trigger event handlers
   * @private
   */
  _triggerHandler(event, data) {
    if (!this.eventHandlers.has(event)) return;
    
    const handlers = this.eventHandlers.get(event);
    handlers.forEach(handler => {
      try {
        handler(data);
      } catch (error) {
        console.error(`[WebRTC Native] Error in ${event} handler:`, error);
      }
    });
  }

  /**
   * Get user media (camera and microphone)
   */
  async getUserMedia(constraints = { video: true, audio: true }) {
    try {
      console.log('[WebRTC Native] Requesting user media:', constraints);
      
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      this.localStream = stream;
      
      const videoTrack = stream.getVideoTracks()[0];
      const audioTrack = stream.getAudioTracks()[0];
      
      if (videoTrack) {
        console.log('[WebRTC Native] Video device:', videoTrack.label);
      }
      if (audioTrack) {
        console.log('[WebRTC Native] Audio device:', audioTrack.label);
      }
      
      console.log('[WebRTC Native] Got local stream successfully');
      return stream;
    } catch (error) {
      console.error('[WebRTC Native] Failed to get user media:', error);
      
      // Fallback to minimal constraints
      if (error.name === 'OverconstrainedError') {
        try {
          const minimalConstraints = { video: true, audio: true };
          const stream = await navigator.mediaDevices.getUserMedia(minimalConstraints);
          this.localStream = stream;
          console.log('[WebRTC Native] Got stream with minimal constraints');
          return stream;
        } catch (fallbackError) {
          console.error('[WebRTC Native] Fallback also failed:', fallbackError);
        }
      }
      
      this._triggerHandler('onError', {
        type: 'media-access',
        error,
        message: 'Không thể truy cập camera/microphone'
      });
      throw error;
    }
  }

  /**
   * Initialize peer connection as ANSWERER (Candidate receives offer)
   */
  async initializePeerConnection(stream) {
    try {
      console.log('[WebRTC Native] Initializing peer connection as ANSWERER (Candidate)');
      
      // Close existing connection if any
      if (this.peerConnection) {
        console.log('[WebRTC Native] Closing existing peer connection');
        this.peerConnection.close();
        this.peerConnection = null;
      }

      this.localStream = stream;
      this.connectionState = 'connecting';
      this.isAnswerCreated = false;
      this.iceCandidatesQueue = [];

      // Create RTCPeerConnection
      this.peerConnection = new RTCPeerConnection(this.config);

      // Add local stream tracks to peer connection
      stream.getTracks().forEach(track => {
        console.log('[WebRTC Native] Adding track:', track.kind);
        this.peerConnection.addTrack(track, stream);
      });

      // Setup event handlers
      this._setupPeerConnectionHandlers();

      console.log('[WebRTC Native] Peer connection initialized');
      this._triggerHandler('onConnectionInitialized');

      return this.peerConnection;
    } catch (error) {
      console.error('[WebRTC Native] Failed to initialize peer connection:', error);
      this.connectionState = 'failed';
      this._triggerHandler('onError', {
        type: 'initialization',
        error,
        message: 'Không thể khởi tạo kết nối WebRTC'
      });
      throw error;
    }
  }

  /**
   * Setup RTCPeerConnection event handlers
   * @private
   */
  _setupPeerConnectionHandlers() {
    if (!this.peerConnection) return;

    // ICE candidate event
    this.peerConnection.onicecandidate = (event) => {
      if (event.candidate) {
        console.log('[WebRTC Native] New ICE candidate:', event.candidate.type);
        this._triggerHandler('onIceCandidate', event.candidate);
      } else {
        console.log('[WebRTC Native] ICE gathering completed');
      }
    };

    // Track event - remote stream received
    this.peerConnection.ontrack = (event) => {
      console.log('[WebRTC Native] Remote track received:', event.track.kind);
      
      if (!this.remoteStream) {
        this.remoteStream = new MediaStream();
      }
      
      this.remoteStream.addTrack(event.track);
      
      console.log('[WebRTC Native] Remote stream tracks:', this.remoteStream.getTracks().length);
      this._triggerHandler('onRemoteStream', this.remoteStream);
    };

    // Connection state change
    this.peerConnection.onconnectionstatechange = () => {
      const state = this.peerConnection.connectionState;
      console.log('[WebRTC Native] Connection state:', state);
      this.connectionState = state;
      
      if (state === 'connected') {
        this._triggerHandler('onConnectionEstablished');
      } else if (state === 'failed' || state === 'closed') {
        this._triggerHandler('onConnectionClosed');
      }
    };

    // ICE connection state change
    this.peerConnection.oniceconnectionstatechange = () => {
      const state = this.peerConnection.iceConnectionState;
      console.log('[WebRTC Native] ICE connection state:', state);
      
      if (state === 'failed') {
        console.error('[WebRTC Native] ICE connection failed');
        this._triggerHandler('onError', {
          type: 'ice-failed',
          message: 'Kết nối ICE thất bại'
        });
      }
    };

    // Signaling state change
    this.peerConnection.onsignalingstatechange = () => {
      console.log('[WebRTC Native] Signaling state:', this.peerConnection.signalingState);
    };
  }

  /**
   * Handle offer from remote peer (Recruiter's offer)
   */
  async handleOffer(offer) {
    try {
      if (!this.peerConnection) {
        throw new Error('Peer connection not initialized');
      }

      console.log('[WebRTC Native] Handling offer from recruiter');

      const remoteDesc = new RTCSessionDescription(offer);
      await this.peerConnection.setRemoteDescription(remoteDesc);

      console.log('[WebRTC Native] Offer set as remote description');

      // Create answer
      const answer = await this.peerConnection.createAnswer();
      await this.peerConnection.setLocalDescription(answer);
      this.isAnswerCreated = true;

      console.log('[WebRTC Native] Answer created and set as local description');

      // Trigger event to send answer via signaling
      this._triggerHandler('onAnswer', answer);

      // Process queued ICE candidates
      if (this.iceCandidatesQueue.length > 0) {
        console.log(`[WebRTC Native] Processing ${this.iceCandidatesQueue.length} queued ICE candidates`);
        for (const candidate of this.iceCandidatesQueue) {
          await this.addIceCandidate(candidate);
        }
        this.iceCandidatesQueue = [];
      }

      return answer;
    } catch (error) {
      console.error('[WebRTC Native] Failed to handle offer:', error);
      this._triggerHandler('onError', {
        type: 'offer-handling',
        error,
        message: 'Không thể xử lý offer'
      });
      throw error;
    }
  }

  /**
   * Add ICE candidate from remote peer
   */
  async addIceCandidate(candidate) {
    try {
      if (!this.peerConnection) {
        console.warn('[WebRTC Native] Peer connection not ready, queuing ICE candidate');
        this.iceCandidatesQueue.push(candidate);
        return;
      }

      if (!this.peerConnection.remoteDescription) {
        console.warn('[WebRTC Native] Remote description not set, queuing ICE candidate');
        this.iceCandidatesQueue.push(candidate);
        return;
      }

      const iceCandidate = new RTCIceCandidate(candidate);
      await this.peerConnection.addIceCandidate(iceCandidate);
      console.log('[WebRTC Native] ICE candidate added successfully');

    } catch (error) {
      console.error('[WebRTC Native] Failed to add ICE candidate:', error);
      // Don't throw - ICE candidates can fail without breaking the connection
    }
  }

  /**
   * Toggle audio track
   */
  async toggleAudio(enabled) {
    if (!this.localStream) return false;

    const audioTrack = this.localStream.getAudioTracks()[0];

    if (enabled) {
      if (audioTrack && audioTrack.readyState === 'live') {
        audioTrack.enabled = true;
        console.log('[WebRTC Native] Audio enabled');
        return true;
      }
      
      // Get new audio track
      try {
        const savedSettings = localStorage.getItem('interviewDeviceSettings');
        const deviceSettings = savedSettings ? JSON.parse(savedSettings) : {};
        
        const audioConstraints = deviceSettings.audioDeviceId 
          ? { 
              deviceId: { exact: deviceSettings.audioDeviceId },
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true
            }
          : { 
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true
            };
        
        const newStream = await navigator.mediaDevices.getUserMedia({ audio: audioConstraints });
        const newTrack = newStream.getAudioTracks()[0];
        
        // Replace track in peer connection
        if (this.peerConnection) {
          const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'audio');
          if (sender) {
            await sender.replaceTrack(newTrack);
          }
        }
        
        if (audioTrack) {
          audioTrack.stop();
          this.localStream.removeTrack(audioTrack);
        }
        this.localStream.addTrack(newTrack);
        
        console.log('[WebRTC Native] Audio enabled with new track');
        this._triggerHandler('onLocalStreamUpdate', this.localStream);
        return true;
      } catch (error) {
        console.error('[WebRTC Native] Failed to enable audio:', error);
        return false;
      }
    } else {
      if (audioTrack) {
        audioTrack.enabled = false;
      }
      console.log('[WebRTC Native] Audio disabled');
      return true;
    }
  }

  /**
   * Toggle video track
   */
  async toggleVideo(enabled) {
    if (!this.localStream) return false;

    const videoTrack = this.localStream.getVideoTracks()[0];

    if (enabled) {
      try {
        const savedSettings = localStorage.getItem('interviewDeviceSettings');
        const deviceSettings = savedSettings ? JSON.parse(savedSettings) : {};
        
        const videoConstraints = deviceSettings.videoDeviceId
          ? { deviceId: { exact: deviceSettings.videoDeviceId } }
          : true;
        
        const newStream = await navigator.mediaDevices.getUserMedia({ video: videoConstraints });
        const newTrack = newStream.getVideoTracks()[0];
        
        // Replace track in peer connection
        if (this.peerConnection) {
          const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'video');
          if (sender) {
            await sender.replaceTrack(newTrack);
          }
        }
        
        if (videoTrack) {
          videoTrack.stop();
          this.localStream.removeTrack(videoTrack);
        }
        this.localStream.addTrack(newTrack);
        
        console.log('[WebRTC Native] Video enabled with new track');
        this._triggerHandler('onLocalStreamUpdate', this.localStream);
        return true;
      } catch (error) {
        console.error('[WebRTC Native] Failed to enable video:', error);
        return false;
      }
    } else {
      if (videoTrack) {
        videoTrack.enabled = false;
        this._triggerHandler('onLocalStreamUpdate', this.localStream);
      }
      console.log('[WebRTC Native] Video disabled');
      return true;
    }
  }

  /**
   * Switch camera device
   */
  async switchCamera(deviceId) {
    try {
      const videoTrack = this.localStream?.getVideoTracks()[0];
      
      const newStream = await navigator.mediaDevices.getUserMedia({
        video: { deviceId: { exact: deviceId } }
      });
      
      const newTrack = newStream.getVideoTracks()[0];
      
      // Replace track in peer connection
      if (this.peerConnection) {
        const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'video');
        if (sender) {
          await sender.replaceTrack(newTrack);
        }
      }
      
      if (videoTrack) {
        videoTrack.stop();
        this.localStream.removeTrack(videoTrack);
      }
      this.localStream.addTrack(newTrack);
      
      this._triggerHandler('onLocalStreamUpdate', this.localStream);
      console.log('[WebRTC Native] Camera switched successfully');
      
      return true;
    } catch (error) {
      console.error('[WebRTC Native] Failed to switch camera:', error);
      return false;
    }
  }

  /**
   * Switch microphone device
   */
  async switchMicrophone(deviceId) {
    try {
      const audioTrack = this.localStream?.getAudioTracks()[0];
      
      const newStream = await navigator.mediaDevices.getUserMedia({
        audio: { 
          deviceId: { exact: deviceId },
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        }
      });
      
      const newTrack = newStream.getAudioTracks()[0];
      
      // Replace track in peer connection
      if (this.peerConnection) {
        const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'audio');
        if (sender) {
          await sender.replaceTrack(newTrack);
        }
      }
      
      if (audioTrack) {
        audioTrack.stop();
        this.localStream.removeTrack(audioTrack);
      }
      this.localStream.addTrack(newTrack);
      
      this._triggerHandler('onLocalStreamUpdate', this.localStream);
      console.log('[WebRTC Native] Microphone switched successfully');
      
      return true;
    } catch (error) {
      console.error('[WebRTC Native] Failed to switch microphone:', error);
      return false;
    }
  }

  /**
   * Get available media devices
   */
  async getDevices() {
    try {
      const devices = await navigator.mediaDevices.enumerateDevices();
      
      const videoDevices = devices.filter(d => d.kind === 'videoinput');
      const audioDevices = devices.filter(d => d.kind === 'audioinput');
      
      console.log('[WebRTC Native] Available devices:', {
        video: videoDevices.length,
        audio: audioDevices.length
      });
      
      return {
        videoDevices,
        audioDevices
      };
    } catch (error) {
      console.error('[WebRTC Native] Failed to get devices:', error);
      return {
        videoDevices: [],
        audioDevices: []
      };
    }
  }

  /**
   * Close peer connection and cleanup
   */
  destroy() {
    console.log('[WebRTC Native] Destroying peer connection');

    if (this.peerConnection) {
      this.peerConnection.close();
      this.peerConnection = null;
    }

    if (this.localStream) {
      this.localStream.getTracks().forEach(track => track.stop());
      this.localStream = null;
    }

    this.remoteStream = null;
    this.connectionState = 'disconnected';
    this.isAnswerCreated = false;
    this.iceCandidatesQueue = [];

    console.log('[WebRTC Native] Peer connection destroyed');
    this._triggerHandler('onConnectionClosed');
  }

  /**
   * Get connection state
   */
  getConnectionState() {
    return this.connectionState;
  }

  /**
   * Check if connected
   */
  isConnected() {
    return this.connectionState === 'connected';
  }

  /**
   * Get local stream
   */
  getLocalStream() {
    return this.localStream;
  }

  /**
   * Get remote stream
   */
  getRemoteStream() {
    return this.remoteStream;
  }

  // Compatibility methods
  closePeerConnection() {
    this.destroy();
  }
}

// Create singleton instance
const webrtcNativeService = new WebRTCNativeService();

export default webrtcNativeService;
</file>

<file path="src/styles/onboarding.css">
/* Onboarding Modal Animations */

@keyframes float {
  0%, 100% {
    transform: translateY(0) translateX(0);
  }
  25% {
    transform: translateY(-20px) translateX(10px);
  }
  50% {
    transform: translateY(-10px) translateX(-10px);
  }
  75% {
    transform: translateY(-30px) translateX(5px);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideInFromRight {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes zoomIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Custom Scrollbar for Onboarding Modal */
.onboarding-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.onboarding-scrollbar::-webkit-scrollbar-track {
  background: transparent;
}

.onboarding-scrollbar::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 4px;
  transition: background 0.2s;
}

.onboarding-scrollbar::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

/* Smooth transitions for step changes */
.onboarding-step-transition {
  animation: slideInFromRight 0.3s ease-out;
}

/* Modal backdrop blur effect */
.onboarding-backdrop {
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

/* Progress bar animation */
.onboarding-progress {
  transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Button hover effects */
.onboarding-button {
  transition: all 0.2s ease;
}

.onboarding-button:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.onboarding-button:active {
  transform: translateY(0);
}

/* Card hover effects */
.onboarding-card {
  transition: all 0.3s ease;
}

.onboarding-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

/* Glassmorphism effect for modal */
.onboarding-glass {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

@media (prefers-color-scheme: dark) {
  .onboarding-glass {
    background: rgba(0, 0, 0, 0.85);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
}

/* Loading spinner */
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.onboarding-spinner {
  animation: spin 1s linear infinite;
}

/* Pulse animation for active step */
@keyframes pulse-glow {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.onboarding-pulse {
  animation: pulse-glow 2s ease-in-out infinite;
}

/* Smooth height transitions */
.onboarding-collapse {
  transition: height 0.3s ease, opacity 0.3s ease;
}

/* Focus styles for accessibility */
.onboarding-focus:focus-visible {
  outline: 2px solid hsl(var(--primary));
  outline-offset: 2px;
}
</file>

<file path="src/styles/preloader.css">
/* TikTok-style Preloader Styles */

/* Prevent body scroll during loading */
body.preloader-active {
  overflow: hidden;
}

/* TikTok brand colors */
:root {
  --tiktok-cyan: #00F7EF;
  --tiktok-pink: #FE2C55;
  --tiktok-white: #FFFFFF;
  --tiktok-black: #000000;
}

/* Smooth animations for circles */
@keyframes tiktok-slide-left {
  0%, 100% {
    transform: translateX(-60px);
  }
  50% {
    transform: translateX(0);
  }
}

@keyframes tiktok-slide-right {
  0%, 100% {
    transform: translateX(60px);
  }
  50% {
    transform: translateX(0);
  }
}

@keyframes tiktok-pulse-center {
  0%, 100% {
    transform: scale(0);
    opacity: 0;
  }
  50% {
    transform: scale(1);
    opacity: 0.8;
  }
}

/* Enhanced glow effects for TikTok style */
.tiktok-circle-cyan {
  background: var(--tiktok-cyan);
  box-shadow: 
    0 0 60px rgba(0, 247, 239, 0.8),
    0 0 100px rgba(0, 247, 239, 0.4),
    0 0 140px rgba(0, 247, 239, 0.2);
}

.tiktok-circle-pink {
  background: var(--tiktok-pink);
  mix-blend-mode: lighten;
  box-shadow: 
    0 0 60px rgba(254, 44, 85, 0.8),
    0 0 100px rgba(254, 44, 85, 0.4),
    0 0 140px rgba(254, 44, 85, 0.2);
}

.tiktok-circle-white {
  background: var(--tiktok-white);
  mix-blend-mode: lighten;
  box-shadow: 
    0 0 40px rgba(255, 255, 255, 0.6),
    0 0 80px rgba(255, 255, 255, 0.3);
}

/* Text glow effect */
.tiktok-text-glow {
  color: var(--tiktok-white);
  text-shadow: 
    0 0 20px rgba(255, 255, 255, 0.5),
    0 0 40px rgba(255, 255, 255, 0.3),
    0 0 60px rgba(255, 255, 255, 0.1);
}

/* Loading dots */
@keyframes tiktok-dot-pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 0.4;
  }
  50% {
    transform: scale(1.4);
    opacity: 1;
  }
}

.tiktok-loading-dot {
  animation: tiktok-dot-pulse 1.2s ease-in-out infinite;
}

.tiktok-loading-dot:nth-child(2) {
  animation-delay: 0.15s;
}

.tiktok-loading-dot:nth-child(3) {
  animation-delay: 0.3s;
}

/* Smooth fade out */
@keyframes tiktok-fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
</file>

<file path="src/styles/voice-search-animations.css">
/**
 * Voice Search Animations
 * Professional animations for voice search UI components
 * 
 * Usage: Import this file in your component or main CSS
 * import '@/styles/voice-search-animations.css';
 */

/* ============================================
   SOUND WAVE ANIMATIONS (Breathing Effect)
   ============================================ */

@keyframes sound-wave-1 {
  0%, 100% {
    transform: scale(1);
    opacity: 0.6;
  }
  50% {
    transform: scale(1.8);
    opacity: 0.3;
  }
}

@keyframes sound-wave-2 {
  0%, 100% {
    transform: scale(1);
    opacity: 0.5;
  }
  50% {
    transform: scale(1.6);
    opacity: 0.25;
  }
}

@keyframes sound-wave-3 {
  0%, 100% {
    transform: scale(1);
    opacity: 0.4;
  }
  50% {
    transform: scale(1.4);
    opacity: 0.2;
  }
}

.animate-sound-wave-1 {
  animation: sound-wave-1 2s ease-in-out infinite;
}

.animate-sound-wave-2 {
  animation: sound-wave-2 2.2s ease-in-out infinite;
}

.animate-sound-wave-3 {
  animation: sound-wave-3 2.4s ease-in-out infinite;
}

/* ============================================
   GLOW EFFECTS
   ============================================ */

@keyframes pulse-glow {
  0%, 100% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.6;
  }
}

.animate-pulse-glow {
  animation: pulse-glow 2s ease-in-out infinite;
}

/* ============================================
   VOICE PULSE (Microphone Icon)
   ============================================ */

@keyframes voice-pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.15);
  }
}

.animate-voice-pulse {
  animation: voice-pulse 1s ease-in-out infinite;
}

/* ============================================
   FADE IN
   ============================================ */

@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.animate-fade-in {
  animation: fade-in 0.3s ease-out;
}

/* ============================================
   SLIDE IN (From Bottom)
   ============================================ */

@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slide-in {
  animation: slide-in 0.4s ease-out;
}

/* ============================================
   SHAKE (Error State)
   ============================================ */

@keyframes shake {
  0%, 100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-5px);
  }
  75% {
    transform: translateX(5px);
  }
}

.animate-shake {
  animation: shake 0.5s ease-in-out;
}

/* ============================================
   WAVE BACKGROUNDS
   ============================================ */

@keyframes wave-1 {
  0%, 100% {
    transform: translateX(-100%) skewX(-15deg);
  }
  50% {
    transform: translateX(100%) skewX(15deg);
  }
}

@keyframes wave-2 {
  0%, 100% {
    transform: translateX(100%) skewX(15deg);
  }
  50% {
    transform: translateX(-100%) skewX(-15deg);
  }
}

.animate-wave-1 {
  animation: wave-1 3s ease-in-out infinite;
}

.animate-wave-2 {
  animation: wave-2 4s ease-in-out infinite;
}

/* ============================================
   SCALE BOUNCE
   ============================================ */

@keyframes scale-bounce {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

.animate-scale-bounce {
  animation: scale-bounce 2s ease-in-out infinite;
}

/* ============================================
   ROTATE SLOW
   ============================================ */

@keyframes rotate-slow {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.animate-rotate-slow {
  animation: rotate-slow 8s linear infinite;
}

/* ============================================
   RADIANCE PULSE (Phát quang)
   ============================================ */

@keyframes radiance-pulse {
  0%, 100% {
    opacity: 0.3;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.1);
  }
}

.animate-radiance-pulse {
  animation: radiance-pulse 2.5s ease-in-out infinite;
}

/* ============================================
   SPARKLE PARTICLES (Hạt sáng)
   ============================================ */

@keyframes sparkle-1 {
  0%, 100% {
    opacity: 0;
    transform: translate(-50%, 0) scale(0);
  }
  50% {
    opacity: 1;
    transform: translate(-50%, -10px) scale(1.5);
  }
}

@keyframes sparkle-2 {
  0%, 100% {
    opacity: 0;
    transform: translate(0, -50%) scale(0);
  }
  50% {
    opacity: 1;
    transform: translate(10px, -50%) scale(1.5);
  }
}

@keyframes sparkle-3 {
  0%, 100% {
    opacity: 0;
    transform: translate(-50%, 0) scale(0);
  }
  50% {
    opacity: 1;
    transform: translate(-50%, 10px) scale(1.5);
  }
}

@keyframes sparkle-4 {
  0%, 100% {
    opacity: 0;
    transform: translate(0, -50%) scale(0);
  }
  50% {
    opacity: 1;
    transform: translate(-10px, -50%) scale(1.5);
  }
}

.animate-sparkle-1 {
  animation: sparkle-1 2s ease-in-out infinite;
}

.animate-sparkle-2 {
  animation: sparkle-2 2s ease-in-out infinite 0.5s;
}

.animate-sparkle-3 {
  animation: sparkle-3 2s ease-in-out infinite 1s;
}

.animate-sparkle-4 {
  animation: sparkle-4 2s ease-in-out infinite 1.5s;
}

/* ============================================
   ENERGY RING (Vòng năng lượng)
   ============================================ */

@keyframes energy-ring {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  50% {
    opacity: 0.6;
    transform: scale(1.2);
  }
  100% {
    opacity: 0;
    transform: scale(1.5);
  }
}

.animate-energy-ring {
  animation: energy-ring 2s ease-out infinite;
}

/* ============================================
   UTILITY CLASSES
   ============================================ */

/* Smooth transitions for all properties */
.transition-smooth {
  transition: all 0.3s ease-out;
}

/* GPU acceleration for better performance */
.gpu-accelerated {
  will-change: transform, opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Backdrop blur utilities */
.backdrop-blur-light {
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
}

.backdrop-blur-medium {
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
}

.backdrop-blur-heavy {
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
}

/* ============================================
   RESPONSIVE ANIMATIONS
   ============================================ */

/* Reduce motion for users who prefer it */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Disable heavy animations on mobile for performance */
@media (max-width: 768px) {
  .animate-wave-1,
  .animate-wave-2 {
    animation-duration: 4s; /* Slower on mobile */
  }
  
  .animate-sound-wave-1,
  .animate-sound-wave-2,
  .animate-sound-wave-3 {
    animation-duration: 2s; /* Slower on mobile */
  }
}

/* ============================================
   CUSTOM PROPERTIES (CSS Variables)
   ============================================ */

:root {
  /* Animation durations */
  --voice-wave-duration: 1.5s;
  --voice-glow-duration: 2s;
  --voice-pulse-duration: 1s;
  --voice-fade-duration: 0.3s;
  --voice-slide-duration: 0.4s;
  
  /* Animation timing functions */
  --voice-ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --voice-ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
  
  /* Wave scales */
  --voice-wave-1-scale: 2.5;
  --voice-wave-2-scale: 2.2;
  --voice-wave-3-scale: 2.0;
  
  /* Opacities */
  --voice-wave-1-opacity: 0.6;
  --voice-wave-2-opacity: 0.5;
  --voice-wave-3-opacity: 0.4;
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  :root {
    --voice-wave-1-opacity: 0.4;
    --voice-wave-2-opacity: 0.3;
    --voice-wave-3-opacity: 0.2;
  }
}

/* ============================================
   PERFORMANCE OPTIMIZATIONS
   ============================================ */

/* Optimize animations for better performance */
.voice-search-button,
.voice-search-wave,
.voice-search-glow {
  will-change: transform, opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Prevent layout shifts during animations */
.voice-search-container {
  contain: layout style paint;
}

/* ============================================
   ACCESSIBILITY
   ============================================ */

/* High contrast mode support */
@media (prefers-contrast: high) {
  .animate-sound-wave-1,
  .animate-sound-wave-2,
  .animate-sound-wave-3 {
    border-width: 3px;
  }
}

/* Focus visible for keyboard navigation */
.voice-search-button:focus-visible {
  outline: 2px solid currentColor;
  outline-offset: 2px;
}

/* ============================================
   GRADIENT UTILITIES
   ============================================ */

/* Radial gradient for glow effects */
.bg-gradient-radial {
  background: radial-gradient(circle, var(--tw-gradient-stops));
}

/* Conic gradient for rotating effects */
.bg-gradient-conic {
  background: conic-gradient(var(--tw-gradient-stops));
}

/* ============================================
   GLOW SHADOW UTILITIES
   ============================================ */

.glow-red {
  box-shadow: 0 0 20px rgba(239, 68, 68, 0.5),
              0 0 40px rgba(239, 68, 68, 0.3),
              0 0 60px rgba(239, 68, 68, 0.1);
}

.glow-pink {
  box-shadow: 0 0 20px rgba(236, 72, 153, 0.5),
              0 0 40px rgba(236, 72, 153, 0.3),
              0 0 60px rgba(236, 72, 153, 0.1);
}

.glow-white {
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.8),
              0 0 20px rgba(255, 255, 255, 0.5),
              0 0 30px rgba(255, 255, 255, 0.3);
}
</file>

<file path="src/utils/errorHandling.js">
/**
 * Error handling utilities for onboarding and form validation
 */

// Error types
export const ErrorType = {
  VALIDATION: 'validation',
  NETWORK: 'network',
  SERVER: 'server',
  TIMEOUT: 'timeout',
  UNAUTHORIZED: 'unauthorized',
  FORBIDDEN: 'forbidden',
  NOT_FOUND: 'not_found',
  CONFLICT: 'conflict',
  UNKNOWN: 'unknown'
};

/**
 * Determine error type from error object
 * @param {Error} error - Error object
 * @returns {string} Error type
 */
export const getErrorType = (error) => {
  if (!error) return ErrorType.UNKNOWN;

  // Network errors
  if (error.message === 'Network Error' || !error.response) {
    return ErrorType.NETWORK;
  }

  // Timeout errors
  if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
    return ErrorType.TIMEOUT;
  }

  // HTTP status code errors
  if (error.response) {
    const status = error.response.status;
    
    switch (status) {
      case 400:
        return ErrorType.VALIDATION;
      case 401:
        return ErrorType.UNAUTHORIZED;
      case 403:
        return ErrorType.FORBIDDEN;
      case 404:
        return ErrorType.NOT_FOUND;
      case 409:
        return ErrorType.CONFLICT;
      case 500:
      case 502:
      case 503:
      case 504:
        return ErrorType.SERVER;
      default:
        return ErrorType.UNKNOWN;
    }
  }

  return ErrorType.UNKNOWN;
};

/**
 * Get user-friendly error message
 * @param {Error} error - Error object
 * @param {string} context - Context of the error (e.g., 'saving profile')
 * @returns {string} User-friendly error message
 */
export const getErrorMessage = (error, context = '') => {
  const errorType = getErrorType(error);
  const contextPrefix = context ? `${context}: ` : '';

  // Check for custom error message from backend
  if (error.response?.data?.message) {
    return `${contextPrefix}${error.response.data.message}`;
  }

  // Default messages based on error type
  const messages = {
    [ErrorType.VALIDATION]: 'Dữ liệu không hợp lệ. Vui lòng kiểm tra lại thông tin.',
    [ErrorType.NETWORK]: 'Không thể kết nối đến máy chủ. Vui lòng kiểm tra kết nối mạng.',
    [ErrorType.TIMEOUT]: 'Yêu cầu quá thời gian chờ. Vui lòng thử lại.',
    [ErrorType.UNAUTHORIZED]: 'Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại.',
    [ErrorType.FORBIDDEN]: 'Bạn không có quyền thực hiện thao tác này.',
    [ErrorType.NOT_FOUND]: 'Không tìm thấy dữ liệu yêu cầu.',
    [ErrorType.CONFLICT]: 'Dữ liệu đã tồn tại hoặc xung đột.',
    [ErrorType.SERVER]: 'Lỗi máy chủ. Vui lòng thử lại sau.',
    [ErrorType.UNKNOWN]: 'Đã xảy ra lỗi không xác định. Vui lòng thử lại.'
  };

  return `${contextPrefix}${messages[errorType] || messages[ErrorType.UNKNOWN]}`;
};

/**
 * Check if error is retryable
 * @param {Error} error - Error object
 * @returns {boolean} Whether the error is retryable
 */
export const isRetryableError = (error) => {
  const errorType = getErrorType(error);
  
  // Retryable error types
  const retryableTypes = [
    ErrorType.NETWORK,
    ErrorType.TIMEOUT,
    ErrorType.SERVER
  ];

  return retryableTypes.includes(errorType);
};

/**
 * Get retry delay based on attempt number (exponential backoff)
 * @param {number} attempt - Attempt number (0-indexed)
 * @param {number} baseDelay - Base delay in milliseconds
 * @returns {number} Delay in milliseconds
 */
export const getRetryDelay = (attempt, baseDelay = 1000) => {
  // Exponential backoff: 1s, 2s, 4s, 8s, max 10s
  const delay = Math.min(baseDelay * Math.pow(2, attempt), 10000);
  // Add jitter to prevent thundering herd
  const jitter = Math.random() * 500;
  return delay + jitter;
};

/**
 * Format validation errors from Zod
 * @param {Array} zodErrors - Zod error array
 * @returns {Object} Formatted errors by field
 */
export const formatZodErrors = (zodErrors) => {
  if (!zodErrors || !Array.isArray(zodErrors)) return {};

  return zodErrors.reduce((acc, error) => {
    const path = error.path.join('.');
    acc[path] = error.message;
    return acc;
  }, {});
};

/**
 * Format validation errors from backend
 * @param {Object} backendErrors - Backend error object
 * @returns {Object} Formatted errors by field
 */
export const formatBackendErrors = (backendErrors) => {
  if (!backendErrors || typeof backendErrors !== 'object') return {};

  // Handle different backend error formats
  if (Array.isArray(backendErrors)) {
    return backendErrors.reduce((acc, error) => {
      if (error.field && error.message) {
        acc[error.field] = error.message;
      }
      return acc;
    }, {});
  }

  // Handle object format
  return backendErrors;
};

/**
 * Retry function with exponential backoff
 * @param {Function} fn - Async function to retry
 * @param {number} maxAttempts - Maximum number of attempts
 * @param {Function} shouldRetry - Function to determine if should retry
 * @returns {Promise} Result of the function
 */
export const retryWithBackoff = async (
  fn,
  maxAttempts = 3,
  shouldRetry = isRetryableError
) => {
  let lastError;

  for (let attempt = 0; attempt < maxAttempts; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error;

      // Don't retry if it's the last attempt or error is not retryable
      if (attempt === maxAttempts - 1 || !shouldRetry(error)) {
        throw error;
      }

      // Wait before retrying
      const delay = getRetryDelay(attempt);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }

  throw lastError;
};

/**
 * Check if user is online
 * @returns {boolean} Whether user is online
 */
export const isOnline = () => {
  return typeof navigator !== 'undefined' && navigator.onLine;
};

/**
 * Wait for online connection
 * @param {number} timeout - Timeout in milliseconds
 * @returns {Promise<boolean>} Whether connection was restored
 */
export const waitForOnline = (timeout = 30000) => {
  return new Promise((resolve) => {
    if (isOnline()) {
      resolve(true);
      return;
    }

    const timeoutId = setTimeout(() => {
      window.removeEventListener('online', onlineHandler);
      resolve(false);
    }, timeout);

    const onlineHandler = () => {
      clearTimeout(timeoutId);
      window.removeEventListener('online', onlineHandler);
      resolve(true);
    };

    window.addEventListener('online', onlineHandler);
  });
};

/**
 * Create error object with additional context
 * @param {Error} error - Original error
 * @param {Object} context - Additional context
 * @returns {Object} Enhanced error object
 */
export const enhanceError = (error, context = {}) => {
  return {
    type: getErrorType(error),
    message: getErrorMessage(error),
    originalError: error,
    isRetryable: isRetryableError(error),
    timestamp: new Date().toISOString(),
    ...context
  };
};

/**
 * Log error for debugging (can be extended to send to error tracking service)
 * @param {Error} error - Error object
 * @param {Object} context - Additional context
 */
export const logError = (error, context = {}) => {
  const enhancedError = enhanceError(error, context);
  
  console.error('[Error]', {
    ...enhancedError,
    stack: error.stack
  });

  // TODO: Send to error tracking service (e.g., Sentry)
  // if (process.env.NODE_ENV === 'production') {
  //   sendToErrorTracking(enhancedError);
  // }
};
</file>

<file path="src/utils/interviewErrorHandler.js">
/**
 * Interview Error Handler Utility
 * Provides user-friendly error messages and handling for interview-related errors
 * Requirements: 8.1, 8.2, 8.3, 8.4, 10.1, 10.2, 10.3, 10.4, 10.5
 */

export const ERROR_CODES = {
  // WebRTC Errors
  WEBRTC_NOT_SUPPORTED: 'WEBRTC_NOT_SUPPORTED',
  MEDIA_PERMISSION_DENIED: 'MEDIA_PERMISSION_DENIED',
  MEDIA_DEVICE_NOT_FOUND: 'MEDIA_DEVICE_NOT_FOUND',
  PEER_CONNECTION_FAILED: 'PEER_CONNECTION_FAILED',
  ICE_CONNECTION_FAILED: 'ICE_CONNECTION_FAILED',
  SIGNALING_ERROR: 'SIGNALING_ERROR',
  
  // Recording Errors
  RECORDING_NOT_SUPPORTED: 'RECORDING_NOT_SUPPORTED',
  RECORDING_START_FAILED: 'RECORDING_START_FAILED',
  RECORDING_UPLOAD_FAILED: 'RECORDING_UPLOAD_FAILED',
  
  // Network Errors
  SOCKET_CONNECTION_FAILED: 'SOCKET_CONNECTION_FAILED',
  SOCKET_DISCONNECTED: 'SOCKET_DISCONNECTED',
  NETWORK_ERROR: 'NETWORK_ERROR',
  
  // Interview Errors
  INTERVIEW_NOT_FOUND: 'INTERVIEW_NOT_FOUND',
  INTERVIEW_ACCESS_DENIED: 'INTERVIEW_ACCESS_DENIED',
  INTERVIEW_TIME_WINDOW_INVALID: 'INTERVIEW_TIME_WINDOW_INVALID',
  INTERVIEW_ALREADY_ENDED: 'INTERVIEW_ALREADY_ENDED',
};

export const ERROR_MESSAGES = {
  // WebRTC Errors
  [ERROR_CODES.WEBRTC_NOT_SUPPORTED]: {
    title: 'Trình duyệt không hỗ trợ',
    message: 'Trình duyệt của bạn không hỗ trợ WebRTC. Vui lòng sử dụng Chrome, Firefox, Safari hoặc Edge phiên bản mới nhất.',
    action: 'Cập nhật trình duyệt',
    actionUrl: 'https://www.google.com/chrome/'
  },
  [ERROR_CODES.MEDIA_PERMISSION_DENIED]: {
    title: 'Quyền truy cập bị từ chối',
    message: 'Vui lòng cấp quyền truy cập camera và microphone để tham gia phỏng vấn.',
    action: 'Hướng dẫn cấp quyền',
    instructions: [
      'Nhấp vào biểu tượng khóa/camera trên thanh địa chỉ',
      'Chọn "Cho phép" cho Camera và Microphone',
      'Tải lại trang và thử lại'
    ]
  },
  [ERROR_CODES.MEDIA_DEVICE_NOT_FOUND]: {
    title: 'Không tìm thấy thiết bị',
    message: 'Không tìm thấy camera hoặc microphone. Vui lòng kiểm tra kết nối thiết bị.',
    action: 'Kiểm tra lại',
    instructions: [
      'Đảm bảo camera/microphone đã được kết nối',
      'Kiểm tra xem thiết bị có hoạt động với ứng dụng khác không',
      'Thử rút và cắm lại thiết bị'
    ]
  },
  [ERROR_CODES.PEER_CONNECTION_FAILED]: {
    title: 'Kết nối thất bại',
    message: 'Không thể kết nối với người phỏng vấn. Vui lòng kiểm tra kết nối mạng.',
    action: 'Thử lại',
    instructions: [
      'Kiểm tra kết nối internet của bạn',
      'Tắt VPN nếu đang sử dụng',
      'Thử kết nối lại'
    ]
  },
  [ERROR_CODES.ICE_CONNECTION_FAILED]: {
    title: 'Kết nối mạng gặp sự cố',
    message: 'Không thể thiết lập kết nối. Có thể do tường lửa hoặc cấu hình mạng.',
    action: 'Khắc phục',
    instructions: [
      'Kiểm tra firewall/tường lửa',
      'Tắt phần mềm chặn quảng cáo',
      'Liên hệ IT nếu đang ở mạng công ty'
    ]
  },
  [ERROR_CODES.SIGNALING_ERROR]: {
    title: 'Lỗi kết nối server',
    message: 'Không thể giao tiếp với server. Vui lòng thử lại.',
    action: 'Thử lại'
  },
  
  // Recording Errors
  [ERROR_CODES.RECORDING_NOT_SUPPORTED]: {
    title: 'Không hỗ trợ ghi hình',
    message: 'Trình duyệt của bạn không hỗ trợ tính năng ghi hình.',
    action: 'Cập nhật trình duyệt'
  },
  [ERROR_CODES.RECORDING_START_FAILED]: {
    title: 'Không thể bắt đầu ghi hình',
    message: 'Đã xảy ra lỗi khi bắt đầu ghi hình. Vui lòng thử lại.',
    action: 'Thử lại'
  },
  [ERROR_CODES.RECORDING_UPLOAD_FAILED]: {
    title: 'Tải lên thất bại',
    message: 'Không thể tải video lên server. Vui lòng kiểm tra kết nối.',
    action: 'Thử lại'
  },
  
  // Network Errors
  [ERROR_CODES.SOCKET_CONNECTION_FAILED]: {
    title: 'Mất kết nối',
    message: 'Không thể kết nối với server. Vui lòng kiểm tra internet.',
    action: 'Kết nối lại'
  },
  [ERROR_CODES.SOCKET_DISCONNECTED]: {
    title: 'Mất kết nối',
    message: 'Kết nối với server bị gián đoạn. Đang thử kết nối lại...',
    action: 'Đang kết nối lại'
  },
  
  // Interview Errors
  [ERROR_CODES.INTERVIEW_NOT_FOUND]: {
    title: 'Không tìm thấy phỏng vấn',
    message: 'Phỏng vấn không tồn tại hoặc đã bị xóa.',
    action: 'Quay lại'
  },
  [ERROR_CODES.INTERVIEW_ACCESS_DENIED]: {
    title: 'Không có quyền truy cập',
    message: 'Bạn không có quyền tham gia phỏng vấn này.',
    action: 'Quay lại'
  },
  [ERROR_CODES.INTERVIEW_TIME_WINDOW_INVALID]: {
    title: 'Chưa đến giờ phỏng vấn',
    message: 'Bạn chỉ có thể tham gia phỏng vấn trong khoảng thời gian cho phép.',
    action: 'Đồng ý'
  },
  [ERROR_CODES.INTERVIEW_ALREADY_ENDED]: {
    title: 'Phỏng vấn đã kết thúc',
    message: 'Phỏng vấn này đã kết thúc.',
    action: 'Xem chi tiết'
  },
};

/**
 * Get user-friendly error message for error code
 */
export const getErrorMessage = (errorCode, defaultMessage = null) => {
  const errorInfo = ERROR_MESSAGES[errorCode];
  
  if (!errorInfo) {
    return {
      title: 'Đã xảy ra lỗi',
      message: defaultMessage || 'Đã xảy ra lỗi không xác định. Vui lòng thử lại.',
      action: 'Đóng'
    };
  }
  
  return errorInfo;
};

/**
 * Handle camera/microphone permission errors
 */
export const handleMediaPermissionError = (error) => {
  console.error('[ErrorHandler] Media permission error:', error);
  
  if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
    return ERROR_CODES.MEDIA_PERMISSION_DENIED;
  }
  
  if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
    return ERROR_CODES.MEDIA_DEVICE_NOT_FOUND;
  }
  
  if (error.name === 'NotSupportedError') {
    return ERROR_CODES.WEBRTC_NOT_SUPPORTED;
  }
  
  return ERROR_CODES.PEER_CONNECTION_FAILED;
};

/**
 * Handle WebRTC connection errors
 */
export const handleWebRTCError = (error, connectionState) => {
  console.error('[ErrorHandler] WebRTC error:', error, connectionState);
  
  if (connectionState?.iceConnectionState === 'failed') {
    return ERROR_CODES.ICE_CONNECTION_FAILED;
  }
  
  if (connectionState?.connectionState === 'failed') {
    return ERROR_CODES.PEER_CONNECTION_FAILED;
  }
  
  return ERROR_CODES.PEER_CONNECTION_FAILED;
};

/**
 * Handle socket connection errors
 */
export const handleSocketError = (error) => {
  console.error('[ErrorHandler] Socket error:', error);
  
  if (error.message?.includes('timeout')) {
    return ERROR_CODES.NETWORK_ERROR;
  }
  
  return ERROR_CODES.SOCKET_CONNECTION_FAILED;
};

/**
 * Handle recording errors
 */
export const handleRecordingError = (error, phase = 'start') => {
  console.error('[ErrorHandler] Recording error:', error, phase);
  
  if (error.name === 'NotSupportedError') {
    return ERROR_CODES.RECORDING_NOT_SUPPORTED;
  }
  
  if (phase === 'upload') {
    return ERROR_CODES.RECORDING_UPLOAD_FAILED;
  }
  
  return ERROR_CODES.RECORDING_START_FAILED;
};

/**
 * Check browser compatibility for WebRTC
 */
export const checkBrowserCompatibility = () => {
  const hasGetUserMedia = !!(
    navigator.mediaDevices && navigator.mediaDevices.getUserMedia
  );
  
  const hasRTCPeerConnection = !!(
    window.RTCPeerConnection ||
    window.webkitRTCPeerConnection ||
    window.mozRTCPeerConnection
  );
  
  const hasMediaRecorder = !!window.MediaRecorder;
  
  return {
    isCompatible: hasGetUserMedia && hasRTCPeerConnection,
    hasGetUserMedia,
    hasRTCPeerConnection,
    hasMediaRecorder,
    recommendedBrowsers: ['Chrome 90+', 'Firefox 88+', 'Safari 14+', 'Edge 90+']
  };
};

/**
 * Get troubleshooting steps for an error
 */
export const getTroubleshootingSteps = (errorCode) => {
  const errorInfo = ERROR_MESSAGES[errorCode];
  return errorInfo?.instructions || [];
};

/**
 * Log error for analytics
 */
export const logError = (errorCode, context = {}) => {
  console.error('[Interview Error]', {
    code: errorCode,
    message: ERROR_MESSAGES[errorCode]?.message,
    ...context,
    timestamp: new Date().toISOString()
  });
  
  // Send to analytics service if available
  if (window.gtag) {
    window.gtag('event', 'interview_error', {
      error_code: errorCode,
      error_context: JSON.stringify(context)
    });
  }
};
</file>

<file path="src/utils/templateHelpers.js">
// Template Helper Functions

/**
 * Kiểm tra xem template có phải là layout 2 cột không
 */
export const isTwoColumnTemplate = (templateId) => {
  return templateId === 'two-column-sidebar' || templateId === 'creative-split';
};

/**
 * Lấy cấu hình layout cho template 2 cột
 */
export const getTwoColumnLayout = (templateId) => {
  const layouts = {
    'two-column-sidebar': {
      sidebar: ['skills', 'education'],
      main: ['summary', 'experience', 'projects', 'certificates']
    },
    'creative-split': {
      sidebar: ['skills', 'education', 'certificates'],
      main: ['summary', 'experience', 'projects']
    }
  };
  
  return layouts[templateId] || null;
};

/**
 * Phân chia sections thành sidebar và main dựa trên template
 */
export const splitSectionsByColumn = (sectionOrder, templateId) => {
  if (!isTwoColumnTemplate(templateId)) {
    return { sidebar: [], main: sectionOrder };
  }
  
  const layout = getTwoColumnLayout(templateId);
  if (!layout) {
    return { sidebar: [], main: sectionOrder };
  }
  
  const sidebar = sectionOrder.filter(s => layout.sidebar.includes(s));
  const main = sectionOrder.filter(s => layout.main.includes(s));
  
  return { sidebar, main };
};

/**
 * Kiểm tra section có thuộc sidebar không
 */
export const isSidebarSection = (sectionId, templateId) => {
  const layout = getTwoColumnLayout(templateId);
  return layout ? layout.sidebar.includes(sectionId) : false;
};

/**
 * Validate section order cho template cụ thể
 */
export const validateSectionOrder = (sectionOrder, templateId) => {
  const validSections = ['summary', 'experience', 'education', 'skills', 'projects', 'certificates'];
  
  // Kiểm tra tất cả sections có hợp lệ không
  const allValid = sectionOrder.every(s => validSections.includes(s));
  if (!allValid) return false;
  
  // Nếu là template 2 cột, kiểm tra sections có đúng vị trí không
  if (isTwoColumnTemplate(templateId)) {
    const layout = getTwoColumnLayout(templateId);
    const { sidebar, main } = splitSectionsByColumn(sectionOrder, templateId);
    
    // Kiểm tra không có section nào bị thiếu hoặc thừa
    const allSidebarValid = sidebar.every(s => layout.sidebar.includes(s));
    const allMainValid = main.every(s => layout.main.includes(s));
    
    return allSidebarValid && allMainValid;
  }
  
  return true;
};

/**
 * Lấy default section order cho template
 */
export const getDefaultSectionOrder = (templateId) => {
  if (isTwoColumnTemplate(templateId)) {
    const layout = getTwoColumnLayout(templateId);
    return [...layout.main, ...layout.sidebar];
  }
  
  return ['summary', 'experience', 'education', 'skills', 'projects', 'certificates'];
};

/**
 * Di chuyển section trong cùng column (cho template 2 cột)
 */
export const moveSectionInColumn = (sectionOrder, templateId, sectionId, direction) => {
  if (!isTwoColumnTemplate(templateId)) {
    // Template thường: di chuyển trong toàn bộ array
    const currentIndex = sectionOrder.indexOf(sectionId);
    if (currentIndex === -1) return sectionOrder;
    
    const targetIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
    if (targetIndex < 0 || targetIndex >= sectionOrder.length) return sectionOrder;
    
    const newOrder = [...sectionOrder];
    [newOrder[currentIndex], newOrder[targetIndex]] = [newOrder[targetIndex], newOrder[currentIndex]];
    return newOrder;
  }
  
  // Template 2 cột: di chuyển trong column của nó
  const { sidebar, main } = splitSectionsByColumn(sectionOrder, templateId);
  const isInSidebar = sidebar.includes(sectionId);
  const columnSections = isInSidebar ? sidebar : main;
  
  const currentIndex = columnSections.indexOf(sectionId);
  if (currentIndex === -1) return sectionOrder;
  
  const targetIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
  if (targetIndex < 0 || targetIndex >= columnSections.length) return sectionOrder;
  
  const newColumnSections = [...columnSections];
  [newColumnSections[currentIndex], newColumnSections[targetIndex]] = 
    [newColumnSections[targetIndex], newColumnSections[currentIndex]];
  
  // Ghép lại với column còn lại
  if (isInSidebar) {
    return [...main, ...newColumnSections];
  } else {
    return [...newColumnSections, ...sidebar];
  }
};

/**
 * Lấy thông tin metadata của section
 */
export const getSectionMetadata = (sectionId) => {
  const metadata = {
    summary: {
      id: 'summary',
      name: 'Professional Summary',
      icon: 'FileText',
      description: 'Brief overview of your professional background',
      required: true
    },
    experience: {
      id: 'experience',
      name: 'Work Experience',
      icon: 'Briefcase',
      description: 'Your work history and achievements',
      required: true
    },
    education: {
      id: 'education',
      name: 'Education',
      icon: 'GraduationCap',
      description: 'Your educational background',
      required: true
    },
    skills: {
      id: 'skills',
      name: 'Skills',
      icon: 'Award',
      description: 'Technical and soft skills',
      required: false
    },
    projects: {
      id: 'projects',
      name: 'Projects',
      icon: 'FolderOpen',
      description: 'Personal and professional projects',
      required: false
    },
    certificates: {
      id: 'certificates',
      name: 'Certificates',
      icon: 'Certificate',
      description: 'Professional certifications and achievements',
      required: false
    }
  };
  
  return metadata[sectionId] || null;
};
</file>

<file path=".env.example">
# Environment Variables Template
# Copy this file to .env.local and fill in your actual values

# Google OAuth Client ID (for @react-oauth/google)
# Get this from Google Cloud Console → APIs & Services → Credentials
VITE_GOONG_MAPS_API_KEY=zezmDr9yRepNMT4ImBxgu6wZHgB958ueXuMmx6ax
VITE_GOOGLE_CLIENT_ID=952720183712-fiqpqldbvcm0goorgu3okv85chlgrp59.apps.googleusercontent.com

# API Base URL
VITE_API_BASE_URL=http://localhost:5000
</file>

<file path="src/components/background/GradientOverlay.jsx">
import React from 'react';
import { cn } from '@/lib/utils';

/**
 * GradientOverlay component renders subtle gradient effects
 */
const GradientOverlay = ({ 
  intensity = 'subtle', 
  className,
  theme = 'light'
}) => {
  const intensityValues = {
    subtle: 0.01,
    medium: 0.02,
    strong: 0.04
  };

  const currentIntensity = intensityValues[intensity] || intensityValues.subtle;

  // Theme-aware gradient colors with enhanced visibility
  const gradientColors = theme === 'dark' 
    ? {
        primary: `rgba(156, 163, 175, ${currentIntensity})`,      // gray-400 (lighter)
        secondary: `rgba(107, 114, 128, ${currentIntensity})`,    // gray-500
        tertiary: `rgba(75, 85, 99, ${currentIntensity * 0.7})`,  // gray-600
        accent1: `rgba(147, 197, 253, ${currentIntensity * 0.5})`, // blue-300 (lighter)
        accent2: `rgba(110, 231, 183, ${currentIntensity * 0.4})`  // emerald-300 (lighter)
      }
    : {
        primary: `rgba(209, 213, 219, ${currentIntensity})`,      // gray-300 (lighter)
        secondary: `rgba(156, 163, 175, ${currentIntensity})`,    // gray-400 (lighter)
        tertiary: `rgba(107, 114, 128, ${currentIntensity * 0.7})`, // gray-500
        accent1: `rgba(96, 165, 250, ${currentIntensity * 0.5})`, // blue-400
        accent2: `rgba(52, 211, 153, ${currentIntensity * 0.4})`  // emerald-400
      };

  const gradientStyle = {
    background: `
      radial-gradient(circle at 20% 30%, ${gradientColors.primary} 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, ${gradientColors.secondary} 0%, transparent 50%),
      radial-gradient(circle at 40% 80%, ${gradientColors.tertiary} 0%, transparent 50%),
      radial-gradient(circle at 60% 20%, ${gradientColors.primary} 0%, transparent 40%),
      radial-gradient(circle at 10% 90%, ${gradientColors.secondary} 0%, transparent 45%),
      radial-gradient(circle at 75% 15%, ${gradientColors.accent1} 0%, transparent 35%),
      radial-gradient(circle at 25% 65%, ${gradientColors.accent2} 0%, transparent 40%),
      radial-gradient(circle at 90% 45%, ${gradientColors.tertiary} 0%, transparent 30%),
      radial-gradient(circle at 5% 55%, ${gradientColors.primary} 0%, transparent 35%),
      radial-gradient(circle at 65% 85%, ${gradientColors.accent1} 0%, transparent 25%)
    `
  };

  return (
    <div 
      className={cn(
        "absolute inset-0 pointer-events-none transition-opacity duration-1000",
        className
      )}
      style={gradientStyle}
      aria-hidden="true"
    />
  );
};

export default GradientOverlay;
</file>

<file path="src/components/buildCV/TemplateGallery.jsx">
import React, { useState } from 'react';
import { cvTemplates } from '@/data/templates';
import { Check, Sparkles } from 'lucide-react';
import { cn } from '@/lib/utils';
import { Card, CardContent } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';

const TemplatePreview = ({ template, isSelected, onSelect }) => {
  const [isHovered, setIsHovered] = useState(false);
  const baseClasses = "w-full h-full rounded-lg border-2 transition-all duration-300 cursor-pointer relative overflow-hidden bg-white shadow-sm";
  const selectedClasses = isSelected 
    ? "border-primary ring-4 ring-primary/20 shadow-lg scale-[1.02]" 
    : "border-gray-200 hover:border-primary/60 hover:shadow-md hover:scale-[1.02]";

  const previews = {
    'modern-blue': (
      <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="h-10 bg-blue-600"></div>
        <div className="p-3 space-y-1.5">
          <div className="h-2.5 bg-gray-300 rounded w-3/4"></div>
          <div className="h-1.5 bg-gray-200 rounded w-1/2"></div>
          <div className="h-1.5 bg-gray-200 rounded w-2/3"></div>
        </div>
      </div>
    ),
    'classic-white': (
      <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="p-3 space-y-1.5 border-b-4 border-gray-800">
          <div className="h-2.5 bg-gray-800 rounded w-3/4 mx-auto"></div>
          <div className="h-1.5 bg-gray-400 rounded w-1/2 mx-auto"></div>
        </div>
        <div className="p-3 space-y-1.5">
          <div className="h-1.5 bg-gray-300 rounded w-2/3"></div>
          <div className="h-1.5 bg-gray-200 rounded w-3/4"></div>
        </div>
      </div>
    ),
    'creative-gradient': (
       <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="h-10 bg-gradient-to-br from-purple-500 via-pink-500 to-orange-400"></div>
        <div className="p-3 space-y-1.5">
          <div className="h-2.5 bg-pink-200 rounded w-3/4"></div>
          <div className="h-1.5 bg-orange-100 rounded w-1/2"></div>
          <div className="h-1.5 bg-purple-100 rounded w-2/3"></div>
        </div>
      </div>
    ),
     'minimal-gray': (
      <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="p-3 space-y-2">
          <div className="h-3 bg-gray-900 rounded w-3/4"></div>
          <div className="h-1 bg-gray-300 rounded w-1/3 mb-2"></div>
          <div className="h-1.5 bg-gray-200 rounded w-2/3"></div>
          <div className="h-1.5 bg-gray-200 rounded w-3/4"></div>
        </div>
      </div>
    ),
    'two-column-sidebar': (
      <div className={cn(baseClasses, 'flex')} onClick={onSelect}>
        <div className="w-1/3 bg-gray-800 p-2 space-y-2">
          <div className="w-8 h-8 bg-gray-600 rounded-full mx-auto"></div>
          <div className="h-1.5 bg-gray-600 rounded w-3/4"></div>
          <div className="h-1.5 bg-gray-600 rounded w-1/2"></div>
        </div>
        <div className="w-2/3 p-2 space-y-1.5">
          <div className="h-2 bg-gray-300 rounded w-3/4"></div>
          <div className="h-1.5 bg-gray-200 rounded w-1/2"></div>
        </div>
      </div>
    ),
    'elegant-serif': (
      <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="p-3 space-y-1 border-b-2 border-gray-300">
           <div className="h-3 bg-gray-800 rounded w-3/4 mx-auto"></div>
           <div className="h-1.5 bg-gray-500 rounded w-1/2 mx-auto"></div>
        </div>
        <div className="p-3 space-y-1.5">
          <div className="h-1.5 bg-gray-300 rounded w-2/3"></div>
          <div className="h-1.5 bg-gray-200 rounded w-3/4"></div>
        </div>
      </div>
    ),
    'modern-sans': (
       <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="h-10 bg-gray-900"></div>
        <div className="p-3 space-y-1.5">
          <div className="h-2 bg-blue-500 rounded w-1/4"></div>
          <div className="h-2.5 bg-gray-800 rounded w-3/4"></div>
        </div>
      </div>
    ),
    'compact-dense': (
      <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="p-2 border-b-2 border-gray-800 flex items-center space-x-2">
            <div className="w-6 h-6 bg-gray-300 rounded"></div>
            <div className="space-y-1 flex-1">
              <div className="h-2 bg-gray-800 rounded w-2/3"></div>
            </div>
        </div>
        <div className="p-2 space-y-1">
          <div className="h-1 bg-gray-300 rounded w-3/4"></div>
          <div className="h-1 bg-gray-200 rounded w-1/2"></div>
        </div>
      </div>
    ),
    'creative-split': (
      <div className={cn(baseClasses, 'flex')} onClick={onSelect}>
        <div className="w-1/3 bg-gradient-to-br from-purple-600 to-pink-500 p-2 space-y-2">
            <div className="w-8 h-8 bg-white/30 rounded-full mx-auto"></div>
            <div className="h-1.5 bg-white/60 rounded w-3/4"></div>
        </div>
        <div className="w-2/3 p-2 space-y-1.5">
          <div className="h-2 bg-pink-200 rounded w-3/4"></div>
          <div className="h-1.5 bg-gray-200 rounded w-1/2"></div>
        </div>
      </div>
    ),
    'executive-formal': (
       <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}>
        <div className="p-3 border-b-4 border-gray-800 text-center">
          <div className="w-8 h-8 bg-gray-300 rounded-full mx-auto mb-1"></div>
          <div className="h-2.5 bg-gray-800 rounded w-2/3 mx-auto"></div>
        </div>
        <div className="p-3 space-y-1.5">
          <div className="h-1.5 bg-gray-300 rounded w-3/4"></div>
          <div className="h-1.5 bg-gray-200 rounded w-1/2"></div>
        </div>
      </div>
    ),
  };

  return (
    <div 
      className="relative group"
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <div className="aspect-[1/1.414] relative">
        {previews[template.id] || <div className={cn(baseClasses, selectedClasses)} onClick={onSelect}><p>Preview</p></div>}
        
        {/* Overlay khi hover */}
        {isHovered && !isSelected && (
          <div className="absolute inset-0 bg-black/5 rounded-lg transition-opacity duration-300 pointer-events-none" />
        )}
      </div>
      
      {/* Check icon khi selected */}
      {isSelected && (
        <div className="absolute top-3 right-3 w-7 h-7 bg-primary rounded-full flex items-center justify-center text-white ring-4 ring-white shadow-lg animate-in zoom-in duration-200">
          <Check className="w-4 h-4" />
        </div>
      )}
      
      {/* Badge "Phổ biến" cho một số template */}
      {['modern-blue', 'two-column-sidebar'].includes(template.id) && (
        <div className="absolute top-3 left-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1 shadow-md">
          <Sparkles className="w-3 h-3" />
          Phổ biến
        </div>
      )}
    </div>
  );
};

const TemplateGallery = ({ selectedTemplate, onSelectTemplate }) => {
  const [selectedCategory, setSelectedCategory] = useState('all');
  
  // Lấy danh sách categories duy nhất
  const categories = ['all', ...new Set(cvTemplates.map(t => t.category))];
  
  // Filter templates theo category
  const filteredTemplates = selectedCategory === 'all' 
    ? cvTemplates 
    : cvTemplates.filter(t => t.category === selectedCategory);

  return (
    <div className="space-y-8">
      {/* Header */}
      <div className="text-center space-y-3">
        <h2 className="text-3xl font-bold tracking-tight text-gray-900">
          Chọn Mẫu CV Phù Hợp
        </h2>
        <p className="text-muted-foreground text-lg max-w-2xl mx-auto">
          Khám phá bộ sưu tập mẫu CV chuyên nghiệp, được thiết kế để tạo ấn tượng với nhà tuyển dụng
        </p>
      </div>

      {/* Category Filter */}
      <div className="flex flex-wrap justify-center gap-2">
        {categories.map((category) => (
          <button
            key={category}
            onClick={() => setSelectedCategory(category)}
            className={cn(
              "px-4 py-2 rounded-full text-sm font-medium transition-all duration-200",
              selectedCategory === category
                ? "bg-primary text-white shadow-md"
                : "bg-gray-100 text-gray-700 hover:bg-gray-200"
            )}
          >
            {category === 'all' ? 'Tất cả' : category}
          </button>
        ))}
      </div>

      {/* Templates Grid - 4 columns */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {filteredTemplates.map((template) => (
          <Card 
            key={template.id} 
            className={cn(
              "overflow-hidden transition-all duration-300 hover:shadow-lg",
              selectedTemplate === template.id && "ring-2 ring-primary"
            )}
          >
            <CardContent className="p-0">
              {/* Preview */}
              <div className="p-4 pb-3">
                <TemplatePreview
                  template={template}
                  isSelected={selectedTemplate === template.id}
                  onSelect={() => onSelectTemplate(template.id)}
                />
              </div>
              
              {/* Info */}
              <div className="px-4 pb-4 space-y-2">
                <div className="flex items-start justify-between gap-2">
                  <h3 className="font-semibold text-gray-900 text-base leading-tight">
                    {template.name}
                  </h3>
                  <Badge variant="secondary" className="shrink-0 text-xs">
                    {template.category}
                  </Badge>
                </div>
                
                <p className="text-sm text-muted-foreground line-clamp-2 leading-relaxed">
                  {template.shortDesc}
                </p>
                
                {/* Best For Tags */}
                {template.bestFor && (
                  <div className="flex flex-wrap gap-1 pt-1">
                    {template.bestFor.slice(0, 2).map((tag, idx) => (
                      <span 
                        key={idx}
                        className="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded"
                      >
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Empty State */}
      {filteredTemplates.length === 0 && (
        <div className="text-center py-12">
          <p className="text-muted-foreground">Không tìm thấy mẫu CV nào trong danh mục này.</p>
        </div>
      )}
    </div>
  );
};

export default TemplateGallery;
</file>

<file path="src/components/buildCV/TemplateSelector_new.jsx">
import React from 'react';
import { cvTemplates } from '../../data/templates';
import { Check } from 'lucide-react';

const TemplateSelector = ({ selectedTemplate, onSelectTemplate }) => {
  const getTemplatePreview = (template) => {
    const baseClasses = "w-full h-48 rounded-lg border-2 transition-all duration-200 cursor-pointer relative overflow-hidden";
    const selectedClasses = selectedTemplate === template.id ? "border-blue-500 ring-2 ring-blue-200" : "border-gray-200 hover:border-gray-300";
    
    switch (template.id) {
      case 'modern-blue':
        return (
          <div className={`${baseClasses} ${selectedClasses}`} onClick={() => onSelectTemplate(template.id)}>
            <div className="h-16 bg-gradient-to-r from-blue-600 to-blue-700"></div>
            <div className="p-4 space-y-2">
              <div className="h-3 bg-gray-200 rounded w-3/4"></div>
              <div className="h-2 bg-gray-100 rounded w-1/2"></div>
              <div className="h-2 bg-blue-100 rounded w-2/3"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'classic-white':
        return (
          <div className={`${baseClasses} ${selectedClasses} bg-white`} onClick={() => onSelectTemplate(template.id)}>
            <div className="p-4 space-y-2 border-b-4 border-gray-800">
              <div className="h-3 bg-gray-800 rounded w-3/4 mx-auto"></div>
              <div className="h-2 bg-gray-400 rounded w-1/2 mx-auto"></div>
            </div>
            <div className="p-4 space-y-2">
              <div className="h-2 bg-gray-300 rounded w-2/3"></div>
              <div className="h-2 bg-gray-200 rounded w-3/4"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'creative-gradient':
        return (
          <div className={`${baseClasses} ${selectedClasses}`} onClick={() => onSelectTemplate(template.id)}>
            <div className="h-16 bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400"></div>
            <div className="p-4 space-y-2">
              <div className="h-3 bg-gradient-to-r from-purple-200 to-pink-200 rounded w-3/4"></div>
              <div className="h-2 bg-gradient-to-r from-orange-100 to-red-100 rounded w-1/2"></div>
              <div className="h-2 bg-gradient-to-r from-blue-100 to-indigo-100 rounded w-2/3"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'minimal-gray':
        return (
          <div className={`${baseClasses} ${selectedClasses} bg-white`} onClick={() => onSelectTemplate(template.id)}>
            <div className="p-4 space-y-3">
              <div className="h-4 bg-gray-900 rounded w-3/4"></div>
              <div className="h-1 bg-gray-300 rounded w-1/4"></div>
              <div className="space-y-1">
                <div className="h-2 bg-gray-200 rounded w-2/3"></div>
                <div className="h-2 bg-gray-100 rounded w-3/4"></div>
                <div className="h-2 bg-gray-100 rounded w-1/2"></div>
              </div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'two-column-sidebar':
        return (
          <div className={`${baseClasses} ${selectedClasses} flex`} onClick={() => onSelectTemplate(template.id)}>
            <div className="w-2/5 bg-gray-800 p-2">
              <div className="w-8 h-8 bg-gray-600 rounded-full mx-auto mb-2"></div>
              <div className="space-y-1">
                <div className="h-1 bg-gray-600 rounded w-3/4"></div>
                <div className="h-1 bg-gray-600 rounded w-1/2"></div>
              </div>
            </div>
            <div className="w-3/5 p-2 space-y-1">
              <div className="h-2 bg-blue-200 rounded w-3/4"></div>
              <div className="h-1 bg-gray-200 rounded w-1/2"></div>
              <div className="h-1 bg-gray-100 rounded w-2/3"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'elegant-serif':
        return (
          <div className={`${baseClasses} ${selectedClasses} bg-gray-50`} onClick={() => onSelectTemplate(template.id)}>
            <div className="p-4 space-y-3 border-b-2 border-gray-300">
              <div className="h-4 bg-gray-800 rounded w-3/4 mx-auto" style={{fontFamily: 'serif'}}></div>
              <div className="h-1 bg-gray-400 rounded w-1/2 mx-auto"></div>
            </div>
            <div className="p-4 space-y-2">
              <div className="h-2 bg-gray-300 rounded w-2/3"></div>
              <div className="h-2 bg-gray-200 rounded w-3/4"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'modern-sans':
        return (
          <div className={`${baseClasses} ${selectedClasses}`} onClick={() => onSelectTemplate(template.id)}>
            <div className="h-12 bg-gradient-to-r from-gray-900 to-gray-800"></div>
            <div className="p-4 space-y-2">
              <div className="h-2 bg-blue-500 rounded w-1/4"></div>
              <div className="h-3 bg-gray-800 rounded w-3/4"></div>
              <div className="h-2 bg-gray-200 rounded w-1/2"></div>
              <div className="h-2 bg-gray-100 rounded w-2/3"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'compact-dense':
        return (
          <div className={`${baseClasses} ${selectedClasses} bg-white`} onClick={() => onSelectTemplate(template.id)}>
            <div className="p-2 border-b-2 border-gray-800">
              <div className="flex items-center space-x-2">
                <div className="w-6 h-6 bg-gray-300 rounded"></div>
                <div className="space-y-1 flex-1">
                  <div className="h-2 bg-gray-800 rounded w-2/3"></div>
                  <div className="h-1 bg-gray-400 rounded w-1/2"></div>
                </div>
              </div>
            </div>
            <div className="p-2 space-y-1">
              <div className="h-1 bg-gray-300 rounded w-3/4"></div>
              <div className="h-1 bg-gray-200 rounded w-1/2"></div>
              <div className="h-1 bg-gray-100 rounded w-2/3"></div>
              <div className="h-1 bg-gray-100 rounded w-1/3"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'creative-split':
        return (
          <div className={`${baseClasses} ${selectedClasses} flex`} onClick={() => onSelectTemplate(template.id)}>
            <div className="w-2/5 bg-gradient-to-br from-purple-600 to-pink-500 p-2">
              <div className="w-8 h-8 bg-white/30 rounded-full mx-auto mb-2"></div>
              <div className="space-y-1">
                <div className="h-1 bg-white/60 rounded w-3/4"></div>
                <div className="h-1 bg-white/40 rounded w-1/2"></div>
              </div>
            </div>
            <div className="w-3/5 p-2 space-y-1">
              <div className="h-2 bg-pink-200 rounded w-3/4"></div>
              <div className="h-1 bg-gray-200 rounded w-1/2"></div>
              <div className="h-1 bg-gray-100 rounded w-2/3"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      case 'executive-formal':
        return (
          <div className={`${baseClasses} ${selectedClasses} bg-gray-100`} onClick={() => onSelectTemplate(template.id)}>
            <div className="p-4 border-b-4 border-gray-800 text-center">
              <div className="w-8 h-8 bg-gray-300 rounded-full mx-auto mb-2"></div>
              <div className="h-3 bg-gray-800 rounded w-2/3 mx-auto mb-1"></div>
              <div className="h-1 bg-gray-500 rounded w-1/2 mx-auto"></div>
            </div>
            <div className="p-4 space-y-2 text-center">
              <div className="h-2 bg-gray-300 rounded w-3/4 mx-auto"></div>
              <div className="h-2 bg-gray-200 rounded w-1/2 mx-auto"></div>
            </div>
            {selectedTemplate === template.id && (
              <div className="absolute top-2 right-2 w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center">
                <Check className="w-4 h-4 text-white" />
              </div>
            )}
          </div>
        );
      default:
        return (
          <div className={`${baseClasses} ${selectedClasses} bg-gray-100`} onClick={() => onSelectTemplate(template.id)}>
            <div className="flex items-center justify-center h-full text-gray-400">
              Preview
            </div>
          </div>
        );
    }
  };

  return (
    <div className="space-y-6">
      <h3 className="text-lg font-semibold text-gray-800">Chọn Mẫu CV</h3>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {cvTemplates.map((template) => (
          <div key={template.id} className="space-y-3">
            {getTemplatePreview(template)}
            <div className="text-center space-y-1">
              <h4 className="font-medium text-gray-800">{template.name}</h4>
              <p className="text-xs text-gray-600 line-clamp-2">{template.shortDesc}</p>
              <span className="inline-block px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full mt-1">
                {template.category}
              </span>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default TemplateSelector;
</file>

<file path="src/components/common/AutocompleteDropdown.jsx">
import React, { useRef, useEffect } from 'react';
import { Loader2, AlertCircle } from 'lucide-react';
import { cn } from '@/lib/utils';
import SuggestionItem from './SuggestionItem';
import { Skeleton } from '@/components/ui/skeleton';

/**
 * Component dropdown chứa autocomplete suggestions với keyboard navigation
 * 
 * @param {Object} props
 * @param {Array} props.suggestions - Mảng suggestions
 * @param {string} props.query - Query string hiện tại
 * @param {boolean} props.isLoading - Trạng thái loading
 * @param {string} props.error - Error message nếu có
 * @param {number} props.selectedIndex - Index của item được chọn
 * @param {boolean} props.isVisible - Có hiển thị dropdown không
 * @param {function} props.onSuggestionClick - Handler khi click suggestion
 * @param {function} props.onSuggestionHover - Handler khi hover suggestion
 * @param {function} props.onClose - Handler để đóng dropdown
 * @param {function} props.onRetry - Handler để retry khi có lỗi
 * @param {string} props.className - Additional CSS classes
 */
const AutocompleteDropdown = ({
  suggestions = [],
  query = '',
  isLoading = false,
  error = null,
  selectedIndex = -1,
  isVisible = false,
  onSuggestionClick,
  onSuggestionHover,
  onClose,
  onRetry,
  className
}) => {
  const dropdownRef = useRef(null);

  /**
   * Đóng dropdown khi click outside
   */
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        onClose?.();
      }
    };

    if (isVisible) {
      document.addEventListener('mousedown', handleClickOutside);
      return () => {
        document.removeEventListener('mousedown', handleClickOutside);
      };
    }
  }, [isVisible, onClose]);

  /**
   * Auto scroll để đảm bảo selected item visible
   */
  useEffect(() => {
    if (selectedIndex >= 0 && dropdownRef.current) {
      const selectedElement = dropdownRef.current.querySelector(
        `[data-index="${selectedIndex}"]`
      );
      if (selectedElement) {
        selectedElement.scrollIntoView({
          block: 'nearest',
          behavior: 'smooth'
        });
      }
    }
  }, [selectedIndex]);

  // Không render nếu không visible
  if (!isVisible) return null;

  return (
    <div
      ref={dropdownRef}
      className={cn(
        "bg-background border border-border rounded-lg shadow-lg",
        "max-h-[300px] overflow-hidden",
        "animate-in fade-in-0 zoom-in-95 duration-200",
        // Match the width of the parent container
        "w-full",
        className
      )}
    >
      {/* Error State - Show above suggestions if there are any */}
      {error && (
        <div className="px-4 py-3 border-b border-border">
          <div className="flex items-start space-x-3">
            <AlertCircle className="h-4 w-4 text-destructive flex-shrink-0 mt-0.5" />
            <div className="space-y-1 flex-1">
              <p className="text-xs font-medium text-destructive">
                Không thể tải gợi ý mới
              </p>
              {onRetry && (
                <button
                  onClick={onRetry}
                  className="text-xs text-primary hover:text-primary/80 font-medium underline-offset-4 hover:underline"
                >
                  Thử lại
                </button>
              )}
            </div>
          </div>
        </div>
      )}

      {/* Suggestions List - Show even when loading */}
      {!error && suggestions.length > 0 && (
        <div className="max-h-[240px] overflow-y-auto">
          <ul
            role="listbox"
            aria-label="Gợi ý tiêu đề công việc"
            className="py-1"
          >
            {suggestions.map((suggestion, index) => (
              <div key={suggestion.title + index} data-index={index}>
                <SuggestionItem
                  suggestion={suggestion}
                  query={query}
                  isSelected={index === selectedIndex}
                  onClick={onSuggestionClick}
                  onMouseEnter={onSuggestionHover}
                  index={index}
                />
              </div>
            ))}
          </ul>
          
          {/* Footer với keyboard shortcuts hint */}
          <div className="border-t border-border px-4 py-2 bg-muted/30">
            <div className="flex items-center justify-between text-xs text-muted-foreground">
              <span>
                <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">↑↓</kbd> điều hướng
              </span>
              <span>
                <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">Enter</kbd> chọn
              </span>
              <span>
                <kbd className="px-1.5 py-0.5 text-xs bg-background border border-border rounded">Esc</kbd> đóng
              </span>
            </div>
          </div>
        </div>
      )}

      {/* Loading State - Only show when no suggestions */}
      {isLoading && suggestions.length === 0 && (
        <div className="px-4 py-8">
          <div className="flex items-center space-x-2 text-muted-foreground">
            <Loader2 className="h-4 w-4 animate-spin" />
            <span className="text-sm">Đang tìm kiếm...</span>
          </div>
          
          {/* Loading Skeleton */}
          <div className="mt-4 space-y-2">
            {[...Array(3)].map((_, index) => (
              <div key={index} className="px-4 py-3 flex items-center space-x-3">
                <Skeleton className="w-4 h-4 rounded" />
                <Skeleton className="h-4 flex-1" />
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Empty State - Only show when not loading and no suggestions */}
      {!isLoading && !error && suggestions.length === 0 && query.length > 0 && (
        <div className="px-4 py-6">
          <div className="flex items-start space-x-3">
            <div className="w-5 h-5 rounded-full bg-muted flex items-center justify-center flex-shrink-0 mt-0.5">
              <svg
                className="w-3 h-3 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
            <div className="space-y-1 flex-1">
              <p className="text-sm font-medium text-foreground">
                Không tìm thấy gợi ý nào
              </p>
              <p className="text-xs text-muted-foreground">
                Thử tìm kiếm với từ khóa khác
              </p>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default AutocompleteDropdown;
</file>

<file path="src/components/common/JobDetail/Sidebar.jsx">
import {
    Avatar,
    AvatarFallback,
    AvatarImage
} from '@/components/ui/avatar';
import {
    Badge
} from '@/components/ui/badge';
import {
    Button
} from '@/components/ui/button';
import {
    Card,
    CardContent,
    CardHeader,
    CardTitle
} from '@/components/ui/card';
import {
    Separator
} from '@/components/ui/separator';
import { Skeleton } from '@/components/ui/skeleton';
import {
    formatSalary
} from '@/utils/formatters';
import {
    Briefcase,
    ChevronLeft,
    ChevronRight,
    MapPin
} from 'lucide-react';
import {
    useNavigate
} from 'react-router-dom';

const JobDetailSidebar = ({
    relatedJobs,
    isLoadingRelated,
    currentJobs,
    totalPages,
    relatedJobsPage,
    handlePrevPage,
    handleNextPage
}) => {
    const navigate = useNavigate();

    return (
        <div className="space-y-6">
            <Card className="border-0 shadow-sm">
                <CardHeader>
                    <CardTitle className="text-lg font-bold">Việc làm cùng công ty</CardTitle>
                </CardHeader>
                <CardContent>
                    {isLoadingRelated ? (
                        <div className="grid gap-3">
                            {[...Array(6)].map((_, i) => (
                                <div key={i} className="p-3 border rounded-lg">
                                    <div className="flex gap-3">
                                        <Skeleton className="w-10 h-10 rounded" />
                                        <div className="flex-1 space-y-2">
                                            <Skeleton className="h-3 w-3/4" />
                                            <Skeleton className="h-3 w-1/2" />
                                            <Skeleton className="h-3 w-1/4" />
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : relatedJobs && relatedJobs.length > 0 ? (
                        <>
                            <div className="grid gap-3">
                                {currentJobs.map((relatedJob) => (
                                    <div
                                        key={relatedJob._id}
                                        className="p-3 border rounded-lg"
                                        onClick={() => navigate(`/jobs/${relatedJob._id}`)}
                                    >
                                        <div className="flex gap-3 mb-2">
                                            <Avatar className="w-10 h-10 border">
                                                <AvatarImage src={relatedJob.company?.logo} alt={relatedJob.company?.name} />
                                                <AvatarFallback className="text-xs">
                                                    {relatedJob.company?.name?.charAt(0)}
                                                </AvatarFallback>
                                            </Avatar>
                                            <div className="flex-1 min-w-0">
                                                <h4 className="font-medium text-sm text-foreground truncate">
                                                    {relatedJob.title}
                                                </h4>
                                                <p className="text-xs text-muted-foreground truncate">
                                                    {relatedJob.company?.name}
                                                </p>
                                            </div>
                                        </div>
                                        <div className="space-y-1">
                                            <Badge variant="secondary" className="text-xs px-2 py-0 w-fit">
                                                {formatSalary(relatedJob.minSalary, relatedJob.maxSalary)}
                                            </Badge>
                                            <div className="flex items-center gap-1">
                                                <MapPin className="w-3 h-3 text-muted-foreground" />
                                                <span className="text-xs text-muted-foreground">
                                                    {relatedJob.location?.province}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            {/* Pagination Controls */}
                            {totalPages > 1 && (
                                <div className="flex items-center justify-between mt-4 pt-3 border-t">
                                    <Button
                                        variant="outline"
                                        size="sm"
                                        onClick={handlePrevPage}
                                        disabled={relatedJobsPage === 1}
                                        className="flex items-center gap-1 text-xs"
                                    >
                                        <ChevronLeft className="w-3 h-3" />
                                        Trước
                                    </Button>

                                    <span className="text-xs text-muted-foreground">
                                        {relatedJobsPage} / {totalPages}
                                    </span>

                                    <Button
                                        variant="outline"
                                        size="sm"
                                        onClick={handleNextPage}
                                        disabled={relatedJobsPage === totalPages}
                                        className="flex items-center gap-1 text-xs"
                                    >
                                        Sau
                                        <ChevronRight className="w-3 h-3" />
                                    </Button>
                                </div>
                            )}
                        </>
                    ) : (
                        <div className="text-center py-12 text-muted-foreground">
                            <Briefcase className="w-16 h-16 mx-auto mb-4 opacity-50" />
                            <p className="text-lg font-medium mb-2">Không có việc làm khác</p>
                            <p className="text-sm">Công ty này chưa có vị trí tuyển dụng nào khác</p>
                        </div>
                    )}
                </CardContent>
            </Card>
        </div>
    )
}

export default JobDetailSidebar;
</file>

<file path="src/components/common/JobLocationMap.jsx">
import { useEffect, useRef, useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { MapPin, AlertCircle } from 'lucide-react';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Skeleton } from '@/components/ui/skeleton';
import { Button } from '@/components/ui/button';
import { ExternalLink } from 'lucide-react';

const JobLocationMap = ({ location, address, companyName }) => {
  const mapContainer = useRef(null);
  const map = useRef(null);
  const [isLoading, setIsLoading] = useState(true);
  const [mapError, setMapError] = useState(false);

  const hasCoordinates = location?.coordinates?.coordinates && location.coordinates.coordinates.length === 2;
  const [longitude, latitude] = hasCoordinates ? location.coordinates.coordinates : [null, null];

  useEffect(() => {
    if (hasCoordinates && mapContainer.current) {
      const apiKey = import.meta.env.VITE_GOONG_MAPS_API_KEY;
      // Ensure goongjs and API key are available
      if (typeof window.goongjs === 'undefined') {
        console.error('Goong Maps JS SDK is not loaded.');
        setMapError(true);
        setIsLoading(false);
        return;
      }

      if (!apiKey) {
        console.error('Goong Maps API key is missing.');
        setMapError(true);
        setIsLoading(false);
        return;
      }
      
      // Prevent re-initialization
      if (map.current) return;

      try {
        // Set Goong Maps API key immediately before initialization
        window.goongjs.accessToken = apiKey;
        
        map.current = new window.goongjs.Map({
          container: mapContainer.current,
          style: 'https://tiles.goong.io/assets/goong_map_web.json',
          center: [longitude, latitude],
          zoom: 14,
        });

        // Add marker
        new window.goongjs.Marker({ color: '#c026d3' }) // Using a purple color to match the theme
          .setLngLat([longitude, latitude])
          .addTo(map.current);

        map.current.on('load', () => {
          setIsLoading(false);
        });

        map.current.on('error', () => {
          setMapError(true);
          setIsLoading(false);
        });
      } catch (error) {
        console.error("Failed to initialize Goong Map:", error);
        setMapError(true);
        setIsLoading(false);
      }
    } else {
      setIsLoading(false);
    }
    
    // Cleanup map instance on component unmount
    return () => {
      if (map.current) {
        map.current.remove();
        map.current = null;
      }
    };
  }, [longitude, latitude, hasCoordinates]);

  const displayAddress = address || [location?.commune, location?.district, location?.province].filter(Boolean).join(', ');

  const getGoogleMapsUrl = () => {
    if (!latitude || !longitude) return '#';
    return `https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`;
  };

  return (
    <Card className="shadow-lg border-0 bg-white/80 backdrop-blur-sm hover:shadow-xl transition-all duration-300">
      <CardHeader className="pb-4">
        <CardTitle className="text-xl font-bold flex items-center gap-3">
          <div className="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
            <MapPin className="w-5 h-5 text-purple-600" />
          </div>
          Bản đồ
        </CardTitle>
      </CardHeader>
      <CardContent className="p-0">
        <div className="relative h-[300px] overflow-hidden">
          {!hasCoordinates ? (
            <div className="flex items-center justify-center h-full p-4">
              <Alert>
                <AlertCircle className="h-4 w-4" />
                <AlertDescription>
                  Không có dữ liệu tọa độ để hiển thị bản đồ.
                </AlertDescription>
              </Alert>
            </div>
          ) : mapError ? (
            <div className="flex items-center justify-center h-full p-4">
              <Alert variant="destructive">
                <AlertCircle className="h-4 w-4" />
                <AlertDescription>
                  Không thể tải bản đồ. Vui lòng kiểm tra lại cấu hình hoặc thử lại sau.
                </AlertDescription>
              </Alert>
            </div>
          ) : (
            <div
              ref={mapContainer}
              className="absolute top-0 bottom-0 w-full h-full"
            />
          )}
          {isLoading && hasCoordinates && (
            <div className="absolute inset-0 bg-muted/30 flex items-center justify-center z-10">
              <Skeleton className="w-full h-full" />
              <div className="absolute flex items-center space-x-2 text-muted-foreground">
                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-primary"></div>
                <span className="text-sm font-medium">Đang tải bản đồ...</span>
              </div>
            </div>
          )}
          {hasCoordinates && !mapError && (
            <Button
              asChild
              size="sm"
              className="absolute top-3 right-3 z-10 bg-white/80 backdrop-blur-sm text-foreground hover:bg-white shadow-lg"
            >
              <a href={getGoogleMapsUrl()} target="_blank" rel="noopener noreferrer">
                <ExternalLink className="w-4 h-4 mr-2" />
                Xem trên Google Maps
              </a>
            </Button>
          )}
        </div>
        
        {displayAddress && (
          <div className="p-4 bg-muted/30 border-t rounded-b-lg">
            <div className="flex items-start space-x-3">
              <MapPin className="w-4 h-4 text-muted-foreground mt-0.5 shrink-0" />
              <div className="text-sm">
                <p className="font-medium text-foreground">{companyName}</p>
                <p className="text-muted-foreground">{displayAddress}</p>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
};

export default JobLocationMap;
</file>

<file path="src/components/common/LocationPicker.jsx">
import { useState, useEffect } from 'react';
import { useFormContext, useWatch } from 'react-hook-form';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Skeleton } from '@/components/ui/skeleton';
import locationData from '@/data/oldtree.json'; // Tải dữ liệu

// Hàm xử lý dữ liệu, chỉ lấy Tỉnh và Quận
const processLocationData = (tree) => {
  if (!tree) return null;

  const provinceNames = ['Tất cả tỉnh thành'];
  const districtMap = { 'Tất cả tỉnh thành': ['Tất cả quận/huyện'] };

  tree.forEach(province => {
    if (!province?.name) return;
    provinceNames.push(province.name);
    const currentDistricts = ['Tất cả quận/huyện']; // Thêm option "Tất cả" cho mỗi tỉnh
    (province.districts || []).forEach(district => {
      if (district?.name) {
        currentDistricts.push(district.name);
      }
    });
    districtMap[province.name] = currentDistricts;
  });

  return { provinceNames, districtMap };
};

const LocationPicker = ({ control, provinceFieldName, districtFieldName }) => {
  const { setValue, getValues } = useFormContext();
  const [processedData, setProcessedData] = useState(null);
  const [availableDistricts, setAvailableDistricts] = useState([]);

  // Tải và xử lý dữ liệu một lần
  useEffect(() => {
    const data = processLocationData(locationData);
    setProcessedData(data);
  }, []);

  const watchedProvince = useWatch({ control, name: provinceFieldName });
  const watchedDistrict = useWatch({ control, name: districtFieldName });

  // Cập nhật danh sách Quận/Huyện khi Tỉnh/Thành phố thay đổi
  useEffect(() => {
    if (watchedProvince && processedData) {
      // Nếu chọn "Tất cả tỉnh thành", set quận/huyện là "ALL" và vô hiệu hóa
      if (watchedProvince === 'Tất cả tỉnh thành') {
        setValue(districtFieldName, 'Tất cả quận/huyện');
        setAvailableDistricts(['Tất cả quận/huyện']);
      } else {
        const districts = processedData.districtMap[watchedProvince] || [];
        setAvailableDistricts(districts);
        const currentDistrict = getValues(districtFieldName);
        if (currentDistrict && !districts.includes(currentDistrict)) {
          setValue(districtFieldName, 'Tất cả quận/huyện'); // Mặc định là "Tất cả" khi đổi tỉnh
        }
      }
    } else {
      setAvailableDistricts([]);
    }
  }, [watchedProvince, processedData, setValue, districtFieldName, getValues]);

  if (!processedData) {
    return (
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <Skeleton className="h-10 w-full" />
        <Skeleton className="h-10 w-full" />
      </div>
    );
  }

  return (
    <>
      {/* Province Picker */}
      <Select onValueChange={(value) => setValue(provinceFieldName, value)} value={watchedProvince || ''}>
        <SelectTrigger>
          <SelectValue placeholder="Chọn tỉnh/thành phố" />
        </SelectTrigger>
        <SelectContent>
          {processedData.provinceNames.map((p) => <SelectItem key={p} value={p}>{p}</SelectItem>)}
        </SelectContent>
      </Select>

      {/* District Picker */}
      <Select
        onValueChange={(value) => setValue(districtFieldName, value)}
        value={watchedDistrict || ''}
        disabled={!watchedProvince || watchedProvince === 'Tất cả tỉnh thành'}
      >
        <SelectTrigger>
          <SelectValue placeholder="Chọn quận/huyện" />
        </SelectTrigger>
        <SelectContent key={watchedProvince}>
          {availableDistricts.map((d) => <SelectItem key={d} value={d}>{d}</SelectItem>)}
        </SelectContent>
      </Select>
    </>
  );
};

export default LocationPicker;
</file>

<file path="src/components/common/ShareButtons.jsx">
import React, { useState } from 'react';
import { Link, Check, Share2 } from 'lucide-react';
import { FaFacebook, FaLinkedin } from 'react-icons/fa';
import { Button } from '@/components/ui/button';
import { toast } from 'sonner';

/**
 * ShareButtons Component
 * Hiển thị nút chia sẻ với các icon mạng xã hội, hover để xem tùy chọn
 * 
 * @param {Object} props
 * @param {string} props.shareUrl - URL để chia sẻ (mặc định là URL hiện tại)
 * @param {string} props.jobId - ID của job để tạo share preview URL (cho Facebook OG)
 * @param {string} props.className - Class CSS tùy chỉnh
 */
const ShareButtons = ({ shareUrl, jobId, className = '' }) => {
  const [copied, setCopied] = useState(false);
  const [showOptions, setShowOptions] = useState(false);

  // Lấy URL trang hiện tại nếu không được cung cấp
  const urlToShare = shareUrl || window.location.href;
  
  // URL cho Facebook share - sử dụng backend preview endpoint nếu có jobId
  const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000';
  const facebookShareUrl = jobId 
    ? `${API_BASE_URL}/api/share-preview/jobs/${jobId}`
    : urlToShare;
    console.log("facebookShareUrl:", facebookShareUrl);

  /**
   * Xử lý sao chép liên kết vào clipboard
   */
  const handleCopyLink = async () => {
    try {
      await navigator.clipboard.writeText(urlToShare);
      setCopied(true);

      // Reset trạng thái "Copied!" sau 2 giây
      setTimeout(() => setCopied(false), 2000);
    } catch (err) {
      console.error('Failed to copy text:', err);
      toast.error('Không thể sao chép liên kết');
    }
  };

  /**
   * Xử lý chia sẻ lên Facebook
   * Sử dụng backend preview endpoint để Facebook crawler có thể lấy được OG tags
   */
  const handleFacebookShare = () => {
    const shareLink = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(facebookShareUrl)}`;

    const width = 600;
    const height = 400;
    const left = (window.screen.width - width) / 2;
    const top = (window.screen.height - height) / 2;

    window.open(
      shareLink,
      'facebook-share-dialog',
      `width=${width},height=${height},left=${left},top=${top}`
    );
  };

  /**
   * Xử lý chia sẻ lên LinkedIn
   */
  const handleLinkedInShare = () => {
    const linkedInShareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(urlToShare)}`;

    const width = 600;
    const height = 400;
    const left = (window.screen.width - width) / 2;
    const top = (window.screen.height - height) / 2;

    window.open(
      linkedInShareUrl,
      'linkedin-share-dialog',
      `width=${width},height=${height},left=${left},top=${top}`
    );
  };

  return (
    <div
      className={`relative ${className}`}
      onMouseEnter={() => setShowOptions(true)}
      onMouseLeave={() => setShowOptions(false)}
    >
      {/* Main Share Button */}
      <Button
        variant="outline"
        className="px-6 py-2.5 font-medium transition-all duration-200 hover:bg-muted flex items-center gap-2"
      >
        <Share2 className="w-4 h-4" />
        <span>Chia sẻ</span>
        <div className="flex items-center gap-1.5 ml-2 pl-2 border-l border-border">
          <FaFacebook className="w-5 h-5 text-[#1877F2]" />
          <FaLinkedin className="w-5 h-5 text-[#0A66C2]" />
        </div>
      </Button>

      {/* Hover Options - Wrapper với padding để tránh mất hover */}
      {showOptions && (
        <div className="absolute top-full right-0 pt-1 z-50">
          <div className="bg-white border border-border rounded-lg shadow-lg py-2 w-56 animate-in fade-in slide-in-from-top-2 duration-200">
            <button
              onClick={handleFacebookShare}
              className="w-full px-4 py-2.5 flex items-center gap-3 hover:bg-muted transition-colors text-left"
            >
              <FaFacebook className="w-5 h-5 text-[#1877F2]" />
              <span className="text-sm font-medium">Chia sẻ lên Facebook</span>
            </button>

            <button
              onClick={handleLinkedInShare}
              className="w-full px-4 py-2.5 flex items-center gap-3 hover:bg-muted transition-colors text-left"
            >
              <FaLinkedin className="w-5 h-5 text-[#0A66C2]" />
              <span className="text-sm font-medium">Chia sẻ lên LinkedIn</span>
            </button>

            <div className="border-t border-border my-1"></div>

            <button
              onClick={handleCopyLink}
              className="w-full px-4 py-2.5 flex items-center gap-3 hover:bg-muted transition-colors text-left"
            >
              {copied ? (
                <>
                  <Check className="w-5 h-5 text-green-600" />
                  <span className="text-sm font-medium text-green-600">Đã sao chép!</span>
                </>
              ) : (
                <>
                  <Link className="w-5 h-5" />
                  <span className="text-sm font-medium">Sao chép liên kết</span>
                </>
              )}
            </button>
          </div>
        </div>
      )}
    </div>
  );
};

export default ShareButtons;
</file>

<file path="src/components/common/TikTokPreloader.jsx">
import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

const TikTokPreloader = ({ minLoadTime = 1500 }) => {
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const startTime = Date.now();

    const handleLoad = () => {
      const elapsedTime = Date.now() - startTime;
      const remainingTime = Math.max(0, minLoadTime - elapsedTime);

      setTimeout(() => {
        setIsLoading(false);
      }, remainingTime);
    };

    if (document.readyState === 'complete') {
      handleLoad();
    } else {
      window.addEventListener('load', handleLoad);
      return () => window.removeEventListener('load', handleLoad);
    }
  }, [minLoadTime]);

  return (
    <AnimatePresence mode="wait">
      {isLoading && (
        <motion.div
          initial={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          transition={{ duration: 0.4, ease: "easeOut" }}
          className="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-black"
        >
          {/* Brand Name - Appears First with Letter Animation */}
          <div className="mb-4 flex items-center justify-center">
            {['C', 'a', 'r', 'e', 'e', 'r', 'Z', 'o', 'n', 'e'].map((letter, i) => (
              <motion.span
                key={i}
                className="text-5xl md:text-6xl font-bold"
                initial={{ opacity: 0, y: -30, scale: 0.5 }}
                animate={{ opacity: 1, y: 0, scale: 1 }}
                transition={{
                  duration: 0.5,
                  delay: i * 0.05,
                  ease: [0.43, 0.13, 0.23, 0.96],
                }}
                style={{
                  background: 'linear-gradient(135deg, #ffffff 0%, #a0aec0 100%)',
                  WebkitBackgroundClip: 'text',
                  WebkitTextFillColor: 'transparent',
                  backgroundClip: 'text',
                  textShadow: '0 0 40px rgba(255, 255, 255, 0.5)',
                  filter: 'drop-shadow(0 0 20px rgba(255, 255, 255, 0.4)) drop-shadow(0 0 40px rgba(255, 255, 255, 0.2))',
                  fontFamily: 'system-ui, -apple-system, sans-serif',
                  fontWeight: '800',
                  letterSpacing: i === 5 ? '0.1em' : '0.02em',
                }}
              >
                {letter}
              </motion.span>
            ))}
          </div>

          {/* Tagline */}
          <motion.p
            className="mb-12 text-gray-400 text-sm md:text-base font-medium tracking-wide"
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{
              duration: 0.6,
              delay: 0.6,
              ease: "easeOut",
            }}
          >
            Nền tảng tuyển dụng và tìm việc số 1 Việt Nam
          </motion.p>

          {/* 3 White Glowing Circles - Appears After Text */}
          <motion.div
            className="flex gap-4"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{
              delay: 0.5,
              duration: 0.4,
            }}
          >
            {[0, 1, 2].map((i) => (
              <motion.div
                key={i}
                className="w-4 h-4 rounded-full bg-white"
                animate={{
                  y: [0, -25, 0],
                }}
                transition={{
                  duration: 0.6,
                  repeat: Infinity,
                  delay: 0.5 + i * 0.15,
                  ease: "easeInOut",
                }}
                style={{
                  boxShadow: '0 0 20px rgba(255, 255, 255, 0.8), 0 0 40px rgba(255, 255, 255, 0.4), 0 0 60px rgba(255, 255, 255, 0.2)',
                }}
              />
            ))}
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
};

export default TikTokPreloader;
</file>

<file path="src/components/cv/CVPreview.jsx">
import React, { useState } from 'react';
import { Loader2 } from 'lucide-react';

const CVPreview = ({ cv, className = "", onClick }) => {
    const [isLoading, setIsLoading] = useState(true);
    const [hasError, setHasError] = useState(false);

    // URL của trang render CV
    const renderUrl = `/render.html?cvId=${cv._id}`;

    const handleIframeLoad = () => {
        setIsLoading(false);
    };

    const handleIframeError = () => {
        setIsLoading(false);
        setHasError(true);
    };

    const handleClick = (e) => {
        // Ngăn sự kiện lan truyền lên parent
        e.stopPropagation();
        
        if (onClick) {
            onClick(e);
        } else {
            // Mặc định mở trong tab mới
            window.open(renderUrl, '_blank');
        }
    };

    // Fallback preview nếu iframe không load được
    const renderFallback = () => {
        const cvData = cv.cvData || {};
        const personalInfo = cvData.personalInfo || {};
        
        return (
            <div className="w-full h-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm">
                <div className="bg-gray-50 p-3 border-b">
                    <div className="text-sm font-semibold text-gray-900 truncate">
                        {personalInfo.fullName || 'Họ và tên'}
                    </div>
                    <div className="text-xs text-gray-600 truncate">
                        {personalInfo.title || 'Vị trí ứng tuyển'}
                    </div>
                </div>
                <div className="p-3 space-y-2">
                    <div className="text-xs text-gray-500 text-center">
                        Không thể tải preview
                    </div>
                </div>
            </div>
        );
    };

    const renderPreview = () => {
        if (hasError) {
            return renderFallback();
        }

        return (
            <>
                {/* Loading state */}
                {isLoading && (
                    <div className="absolute inset-0 flex items-center justify-center bg-gray-50 rounded-lg">
                        <div className="text-center">
                            <Loader2 className="h-8 w-8 animate-spin text-blue-600 mx-auto mb-2" />
                            <p className="text-xs text-gray-500">Đang tải preview...</p>
                        </div>
                    </div>
                )}
                
                {/* Iframe hiển thị CV thực tế */}
                <div className="w-full h-full overflow-hidden rounded-lg border border-gray-200 bg-white">
                    <iframe
                        src={renderUrl}
                        className={`w-full h-full border-0 ${isLoading ? 'opacity-0' : 'opacity-100'} transition-opacity duration-300`}
                        title={`CV Preview - ${cv.name}`}
                        onLoad={handleIframeLoad}
                        onError={handleIframeError}
                        sandbox="allow-same-origin allow-scripts"
                        style={{
                            pointerEvents: 'none', // Ngăn tương tác với iframe trong preview
                            transform: 'scale(0.25)', // Thu nhỏ để vừa khung (A4 -> thumbnail)
                            transformOrigin: 'top left',
                            width: '400%', // Tăng kích thước để scale về đúng tỷ lệ
                            height: '400%'
                        }}
                    />
                </div>
            </>
        );
    };

    return (
        <div 
            className={`aspect-[3/4] relative group cursor-pointer ${className}`}
            onClick={handleClick}
        >
            {renderPreview()}

            {/* Overlay khi hover - chỉ hiển thị khi không loading */}
            {!isLoading && !hasError && (
                <div className="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-all duration-200 rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100 pointer-events-none">
                    <div className="bg-white/95 backdrop-blur-sm px-4 py-2 rounded-full text-sm font-medium text-gray-700 shadow-lg">
                        Click để xem chi tiết
                    </div>
                </div>
            )}
        </div>
    );
};

export default CVPreview;
</file>

<file path="src/components/cv/UploadedCVManager.jsx">
import React, { useState, useRef } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardFooter } from '@/components/ui/card';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Skeleton } from '@/components/ui/skeleton';
import { FileText, Download, Trash2, Pencil, Eye, Star, AlertTriangle, Upload, Plus } from 'lucide-react';
import apiClient from '@/services/apiClient';
import PDFViewer from './PDFViewer';

/**
 * Component quản lý CV đã upload
 */
const UploadedCVManager = () => {
  const queryClient = useQueryClient();
  const fileInputRef = useRef(null);
  const [isRenameDialogOpen, setIsRenameDialogOpen] = useState(false);
  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);
  const [isUploadDialogOpen, setIsUploadDialogOpen] = useState(false);
  const [selectedCv, setSelectedCv] = useState(null);
  const [newName, setNewName] = useState('');
  const [viewingCv, setViewingCv] = useState(null);
  const [selectedFile, setSelectedFile] = useState(null);
  const [previewUrl, setPreviewUrl] = useState(null);
  const [newlyUploadedCvId, setNewlyUploadedCvId] = useState(null);

  // Fetch uploaded CVs
  const { data: cvsData, isLoading, isError, refetch } = useQuery({
    queryKey: ['uploaded-cvs'],
    queryFn: async () => {
      const response = await apiClient.get('/candidate/cvs');
      return response.data;
    },
  });

  // Rename CV mutation
  const renameMutation = useMutation({
    mutationFn: async ({ cvId, name }) => {
      const response = await apiClient.patch(`/candidate/cvs/${cvId}`, { name });
      return response.data;
    },
    onSuccess: () => {
      toast.success('Đổi tên CV thành công!');
      queryClient.invalidateQueries({ queryKey: ['uploaded-cvs'] });
      setIsRenameDialogOpen(false);
      setSelectedCv(null);
      setNewName('');
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể đổi tên CV.');
    },
  });

  // Delete CV mutation
  const deleteMutation = useMutation({
    mutationFn: async (cvId) => {
      const response = await apiClient.delete(`/candidate/cvs/${cvId}`);
      return response.data;
    },
    onSuccess: () => {
      toast.success('Xóa CV thành công!');
      queryClient.invalidateQueries({ queryKey: ['uploaded-cvs'] });
      setIsDeleteDialogOpen(false);
      setSelectedCv(null);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể xóa CV.');
    },
  });

  // Set default CV mutation
  const setDefaultMutation = useMutation({
    mutationFn: async (cvId) => {
      const response = await apiClient.patch(`/candidate/cvs/${cvId}/set-default`);
      return response.data;
    },
    onSuccess: () => {
      toast.success('Đã đặt làm CV mặc định!');
      queryClient.invalidateQueries({ queryKey: ['uploaded-cvs'] });
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể đặt CV mặc định.');
    },
  });

  // Upload CV mutation
  const uploadMutation = useMutation({
    mutationFn: async (file) => {
      const formData = new FormData();
      formData.append('cv', file);
      const response = await apiClient.post('/candidate/cvs', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      return response.data;
    },
    onSuccess: (data) => {
      toast.success('Tải lên CV thành công!');
      queryClient.invalidateQueries({ queryKey: ['uploaded-cvs'] });
      
      // Set newly uploaded CV ID for highlighting
      const uploadedCv = data?.data;
      if (uploadedCv?._id) {
        setNewlyUploadedCvId(uploadedCv._id);
        // Auto view the newly uploaded CV
        setViewingCv(uploadedCv);
        // Remove highlight after 3 seconds
        setTimeout(() => {
          setNewlyUploadedCvId(null);
        }, 3000);
      }
      
      setIsUploadDialogOpen(false);
      setSelectedFile(null);
      setPreviewUrl(null);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể tải lên CV.');
    },
  });

  const handleOpenRenameDialog = (cv) => {
    setSelectedCv(cv);
    setNewName(cv.name || '');
    setIsRenameDialogOpen(true);
  };

  const handleOpenDeleteDialog = (cv) => {
    setSelectedCv(cv);
    setIsDeleteDialogOpen(true);
  };

  const handleRename = () => {
    if (!newName.trim()) {
      toast.error('Vui lòng nhập tên cho CV.');
      return;
    }
    renameMutation.mutate({ cvId: selectedCv._id, name: newName });
  };

  const handleDelete = () => {
    if (selectedCv) {
      deleteMutation.mutate(selectedCv._id);
    }
  };

  const handleSetDefault = (cv) => {
    setDefaultMutation.mutate(cv._id);
  };

  const handleDownload = (cv) => {
    const link = document.createElement('a');
    link.href = cv.path;
    link.download = cv.name || 'CV.pdf';
    link.target = '_blank';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  const handleFileSelect = (event) => {
    const file = event.target.files?.[0];
    if (file) {
      // Validate file type
      if (file.type !== 'application/pdf') {
        toast.error('Chỉ chấp nhận file PDF');
        return;
      }
      // Validate file size (max 10MB)
      if (file.size > 10 * 1024 * 1024) {
        toast.error('Kích thước file không được vượt quá 10MB');
        return;
      }
      
      // Create preview URL
      const url = URL.createObjectURL(file);
      setPreviewUrl(url);
      setSelectedFile(file);
      setIsUploadDialogOpen(true);
    }
  };

  const handleUpload = () => {
    if (!selectedFile) {
      toast.error('Vui lòng chọn file CV');
      return;
    }
    uploadMutation.mutate(selectedFile);
  };

  const handleCancelUpload = () => {
    setIsUploadDialogOpen(false);
    setSelectedFile(null);
    if (previewUrl) {
      URL.revokeObjectURL(previewUrl);
      setPreviewUrl(null);
    }
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  if (isLoading) {
    return (
      <div className="space-y-4">
        <Skeleton className="h-8 w-1/4" />
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {[...Array(3)].map((_, i) => (
            <Skeleton key={i} className="h-48 w-full" />
          ))}
        </div>
      </div>
    );
  }

  if (isError) {
    return (
      <div className="text-center py-8">
        <p className="text-red-600 mb-4">Không thể tải danh sách CV</p>
        <Button onClick={() => refetch()}>Thử lại</Button>
      </div>
    );
  }

  const cvs = cvsData?.data || [];

  const handleViewInPanel = (cv) => {
    setViewingCv(cv);
  };

  return (
    <div className="flex gap-6 h-[calc(100vh-12rem)]">
      {/* Hidden file input */}
      <input
        ref={fileInputRef}
        type="file"
        accept=".pdf"
        onChange={handleFileSelect}
        className="hidden"
      />
      
      {/* Left Panel - CV List */}
      <div className="w-full lg:w-96 flex-shrink-0 space-y-4 overflow-y-auto pr-2">
        <div className="sticky top-0 bg-white pb-3 border-b z-10">
          <div className="flex justify-between items-center mb-2">
            <h2 className="text-xl font-semibold text-gray-900">Danh sách CV</h2>
            <Button
              onClick={() => fileInputRef.current?.click()}
              size="sm"
              className="gap-2"
            >
              <Plus className="h-4 w-4" />
              Tải lên
            </Button>
          </div>
          <span className="text-sm text-gray-500">{cvs.length} CV</span>
        </div>

        {cvs.length === 0 ? (
          <Card className="text-center py-12">
            <CardContent>
              <FileText className="h-16 w-16 text-gray-300 mx-auto mb-4" />
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Chưa có CV nào được tải lên
              </h3>
              <p className="text-gray-600 mb-4">
                Tải lên CV của bạn để dễ dàng ứng tuyển công việc
              </p>
              <Button
                onClick={() => fileInputRef.current?.click()}
                className="gap-2"
              >
                <Upload className="h-4 w-4" />
                Tải lên CV đầu tiên
              </Button>
            </CardContent>
          </Card>
        ) : (
          <div className="space-y-3">
            {cvs.map((cv) => (
              <Card
                key={cv._id}
                className={`transition-all duration-200 cursor-pointer hover:shadow-md ${
                  cv.isDefault ? 'border-2 border-blue-500' : ''
                } ${viewingCv?._id === cv._id ? 'ring-2 ring-blue-500 bg-blue-50' : ''} ${
                  newlyUploadedCvId === cv._id 
                    ? 'animate-pulse ring-4 ring-green-400 shadow-lg shadow-green-200 border-2 border-green-500' 
                    : ''
                }`}
                onClick={() => handleViewInPanel(cv)}
              >
                <CardHeader className="pb-3">
                  <div className="flex items-start justify-between gap-2">
                    <div className="flex-1 min-w-0">
                      <CardTitle className="truncate text-sm flex items-center gap-2">
                        <FileText className="h-4 w-4 flex-shrink-0" />
                        <span className="truncate">{cv.name}</span>
                        {newlyUploadedCvId === cv._id && (
                          <span className="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 animate-bounce">
                            MỚI
                          </span>
                        )}
                      </CardTitle>
                      {cv.isDefault && (
                        <div className="flex items-center gap-1 text-xs text-blue-600 mt-1">
                          <Star className="h-3 w-3 fill-current" />
                          <span>CV mặc định</span>
                        </div>
                      )}
                      <div className="text-xs text-gray-500 mt-1">
                        {new Date(cv.uploadedAt).toLocaleDateString('vi-VN')}
                      </div>
                    </div>
                    <Button
                      variant="ghost"
                      size="sm"
                      className="h-8 w-8 p-0 flex-shrink-0"
                      onClick={(e) => {
                        e.stopPropagation();
                        handleOpenRenameDialog(cv);
                      }}
                    >
                      <Pencil className="h-4 w-4 text-gray-500" />
                    </Button>
                  </div>
                </CardHeader>

                <CardContent className="space-y-2">
                  <div className="flex gap-2">
                    <Button
                      variant="outline"
                      size="sm"
                      className="flex-1"
                      onClick={(e) => {
                        e.stopPropagation();
                        handleDownload(cv);
                      }}
                    >
                      <Download className="h-3 w-3 mr-1" />
                      Tải
                    </Button>
                    {!cv.isDefault && (
                      <Button
                        variant="outline"
                        size="sm"
                        className="flex-1"
                        onClick={(e) => {
                          e.stopPropagation();
                          handleSetDefault(cv);
                        }}
                        disabled={setDefaultMutation.isPending}
                      >
                        <Star className="h-3 w-3 mr-1" />
                        Mặc định
                      </Button>
                    )}
                    <Button
                      variant="destructive"
                      size="sm"
                      onClick={(e) => {
                        e.stopPropagation();
                        handleOpenDeleteDialog(cv);
                      }}
                    >
                      <Trash2 className="h-3 w-3" />
                    </Button>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        )}
      </div>

      {/* Right Panel - PDF Viewer */}
      <div className="flex-1 hidden lg:block">
        {viewingCv ? (
          <Card className="h-full flex flex-col">
            <CardHeader className="border-b bg-white flex-shrink-0">
              <div className="flex items-center justify-between">
                <CardTitle className="text-lg truncate flex-1">
                  {viewingCv.name}
                </CardTitle>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => setViewingCv(null)}
                  className="ml-2"
                >
                  <span className="text-xs">Đóng</span>
                </Button>
              </div>
              <p className="text-xs text-gray-500 mt-1">
                Tải lên: {new Date(viewingCv.uploadedAt).toLocaleDateString('vi-VN', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </p>
            </CardHeader>
            <CardContent className="flex-1 p-0 overflow-hidden">
              <PDFViewer
                pdfUrl={viewingCv.path}
                fileName={viewingCv.name}
                onDownload={() => handleDownload(viewingCv)}
              />
            </CardContent>
          </Card>
        ) : (
          <Card className="h-full flex items-center justify-center bg-gray-50">
            <CardContent className="text-center">
              <Eye className="h-16 w-16 text-gray-300 mx-auto mb-4" />
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Chọn CV để xem
              </h3>
              <p className="text-gray-600">
                Click vào CV ở danh sách bên trái để xem nội dung
              </p>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Rename Dialog */}
      <Dialog open={isRenameDialogOpen} onOpenChange={setIsRenameDialogOpen}>
        <DialogContent className="sm:max-w-[425px]">
          <DialogHeader>
            <DialogTitle>Đổi tên CV</DialogTitle>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label htmlFor="cv-name">Tên CV mới</Label>
              <Input
                id="cv-name"
                value={newName}
                onChange={(e) => setNewName(e.target.value)}
                placeholder="Nhập tên mới cho CV"
                autoFocus
              />
            </div>
          </div>
          <DialogFooter>
            <Button
              variant="outline"
              onClick={() => setIsRenameDialogOpen(false)}
              disabled={renameMutation.isPending}
            >
              Hủy
            </Button>
            <Button onClick={handleRename} disabled={renameMutation.isPending}>
              {renameMutation.isPending ? 'Đang lưu...' : 'Lưu'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Delete Dialog */}
      <Dialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>
        <DialogContent className="sm:max-w-[425px]">
          <DialogHeader>
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-red-100">
                <AlertTriangle className="h-5 w-5 text-red-600" />
              </div>
              <DialogTitle className="text-xl">Xác nhận xóa CV</DialogTitle>
            </div>
          </DialogHeader>
          <div className="space-y-4 py-4">
            <p className="text-sm text-gray-600">
              Bạn có chắc chắn muốn xóa CV{' '}
              <span className="font-semibold text-gray-900">
                "{selectedCv?.name}"
              </span>{' '}
              không?
            </p>
            <div className="bg-red-50 border border-red-200 rounded-lg p-3">
              <p className="text-sm text-red-800">
                <strong>Cảnh báo:</strong> Hành động này không thể hoàn tác.
              </p>
            </div>
          </div>
          <DialogFooter>
            <Button
              variant="outline"
              onClick={() => setIsDeleteDialogOpen(false)}
              disabled={deleteMutation.isPending}
            >
              Hủy
            </Button>
            <Button
              variant="destructive"
              onClick={handleDelete}
              disabled={deleteMutation.isPending}
            >
              {deleteMutation.isPending ? 'Đang xóa...' : 'Xóa CV'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Upload Dialog */}
      <Dialog open={isUploadDialogOpen} onOpenChange={setIsUploadDialogOpen}>
        <DialogContent className="sm:max-w-4xl h-[90vh] flex flex-col">
          <DialogHeader className="flex-shrink-0">
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100">
                <Upload className="h-5 w-5 text-blue-600" />
              </div>
              <DialogTitle className="text-xl">Xác nhận tải lên CV</DialogTitle>
            </div>
          </DialogHeader>
          
          <div className="flex-1 overflow-y-auto space-y-4 py-4">
            {selectedFile && (
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div className="flex items-center gap-3">
                  <FileText className="h-8 w-8 text-blue-600" />
                  <div className="flex-1 min-w-0">
                    <p className="text-sm font-semibold text-gray-900 truncate">
                      {selectedFile.name}
                    </p>
                    <p className="text-xs text-gray-500">
                      {(selectedFile.size / 1024 / 1024).toFixed(2)} MB
                    </p>
                  </div>
                </div>
              </div>
            )}
            
            {/* PDF Preview */}
            {previewUrl && (
              <div className="border rounded-lg overflow-hidden bg-gray-50">
                <div className="bg-white border-b px-4 py-2">
                  <p className="text-sm font-medium text-gray-700">Preview CV</p>
                </div>
                <div className="p-4">
                  <iframe
                    src={`${previewUrl}#toolbar=0&navpanes=0&scrollbar=1`}
                    className="w-full h-[500px] border-0 rounded"
                    title="CV Preview"
                  />
                </div>
              </div>
            )}
            
            <div className="bg-gray-50 border border-gray-200 rounded-lg p-3">
              <p className="text-xs text-gray-600">
                <strong>Lưu ý:</strong> Vui lòng kiểm tra kỹ nội dung CV trước khi tải lên. File phải là PDF và không quá 10MB.
              </p>
            </div>
          </div>
          
          <DialogFooter className="flex-shrink-0 border-t pt-4">
            <Button
              variant="outline"
              onClick={handleCancelUpload}
              disabled={uploadMutation.isPending}
            >
              Hủy
            </Button>
            <Button
              onClick={handleUpload}
              disabled={uploadMutation.isPending || !selectedFile}
            >
              {uploadMutation.isPending ? 'Đang tải lên...' : 'Xác nhận tải lên'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
};

export default UploadedCVManager;
</file>

<file path="src/components/CVPreview/PaginatedCVPreview.jsx">
import React, { useEffect, useState, useRef } from 'react';
import ModernBlueTemplate from './templates/ModernBlueTemplate';
import ClassicWhiteTemplate from './templates/ClassicWhiteTemplate';
import CreativeGradientTemplate from './templates/CreativeGradientTemplate';
import MinimalGrayTemplate from './templates/MinimalGrayTemplate';
import TwoColumnSidebarTemplate from './templates/TwoColumnSidebarTemplate';
import ElegantSerifTemplate from './templates/ElegantSerifTemplate';
import ModernSansTemplate from './templates/ModernSansTemplate';
import CompactDenseTemplate from './templates/CompactDenseTemplate';
import CreativeSplitTemplate from './templates/CreativeSplitTemplate';
import ExecutiveFormalTemplate from './templates/ExecutiveFormalTemplate';

// A4 page constants
const A4_HEIGHT_MM = 297;
const A4_WIDTH_MM = 210;
const MM_TO_PX = 3.7795275591; // 1mm = 3.7795275591px at 96 DPI
const A4_HEIGHT_PX = A4_HEIGHT_MM * MM_TO_PX;

// Layout constants (adjust these based on your template design)
const HEADER_HEIGHT_PX = 160; // Header height for first page
const CONTENT_PADDING = 64; // Padding for content area (top + bottom)
const PAGE_MARGIN = 20; // Safety margin
const SECTION_SPACING = 32; // Space between sections

/**
 * PaginatedCVPreview Component
 * Automatically splits CV content across multiple A4 pages
 * Prevents section content from being cut across pages
 */
const PaginatedCVPreview = React.forwardRef(({ cvData, className = '' }, ref) => {
  const [pages, setPages] = useState([]);
  const measureRef = useRef(null);

  // Ensure sectionOrder exists
  const sectionOrder = cvData.sectionOrder || [
    'summary',
    'experience',
    'education',
    'skills',
    'projects',
    'certificates'
  ];

  // Use the template from cvData
  const selectedTemplate = cvData.template || 'modern-blue';

  /**
   * Measure section heights and paginate content
   */
  useEffect(() => {
    const measureAndPaginate = async () => {
      if (!measureRef.current) return;
// Xóa tín hiệu cũ đi trước khi bắt đầu tính toán lại
      document.body.removeAttribute('data-cv-ready');
      const tempContainer = measureRef.current;
      const sectionsData = [];

      // Measure each section
      for (const sectionId of sectionOrder) {
        const sectionElement = tempContainer.querySelector(`[data-section="${sectionId}"]`);
        if (sectionElement) {
          const height = sectionElement.offsetHeight;
          sectionsData.push({
            id: sectionId,
            height: height,
            element: sectionElement.cloneNode(true)
          });
        }
      }

      // Paginate sections
      const paginatedPages = [];
      let currentPage = [];
      let currentPageHeight = HEADER_HEIGHT_PX + CONTENT_PADDING;
      const availableHeight = A4_HEIGHT_PX - CONTENT_PADDING - PAGE_MARGIN;

      sectionsData.forEach((section, index) => {
        const sectionWithMargin = section.height + SECTION_SPACING;

        if (index === 0) {
          // First section always goes on first page
          if (currentPageHeight + sectionWithMargin <= availableHeight) {
            currentPage.push(section);
            currentPageHeight += sectionWithMargin;
          } else {
            // Section too large for first page with header
            currentPage.push(section);
            paginatedPages.push({ sections: [...currentPage], isFirstPage: true });
            currentPage = [];
            currentPageHeight = CONTENT_PADDING;
          }
        } else {
          // Try to fit section on current page
          if (currentPageHeight + sectionWithMargin <= availableHeight) {
            currentPage.push(section);
            currentPageHeight += sectionWithMargin;
          } else {
            // Start new page
            paginatedPages.push({
              sections: [...currentPage],
              isFirstPage: paginatedPages.length === 0
            });
            currentPage = [section];
            currentPageHeight = CONTENT_PADDING + sectionWithMargin;
          }
        }
      });

      // Add remaining sections
      if (currentPage.length > 0) {
        paginatedPages.push({
          sections: currentPage,
          isFirstPage: paginatedPages.length === 0
        });
      }

      setPages(paginatedPages);
      // ✅ BƯỚC QUAN TRỌNG: BÁO HIỆU CHO PUPPETEER RẰNG ĐÃ XONG!
      // Dùng setTimeout nhỏ để đảm bảo React đã render xong sau khi setPages
      setTimeout(() => {
        document.body.setAttribute('data-cv-ready', 'true');
        console.log('✅ CV is ready for PDF export!');
      }, 0);
    };

    // Delay measurement to ensure DOM is ready
    const timeoutId = setTimeout(measureAndPaginate, 100);
    return () => clearTimeout(timeoutId);
  }, [cvData, sectionOrder, selectedTemplate]);

  /**
   * Get template component based on selection
   */
  const getTemplateComponent = () => {
    switch (selectedTemplate) {
      case 'modern-blue':
        return ModernBlueTemplate;
      case 'classic-white':
        return ClassicWhiteTemplate;
      case 'creative-gradient':
        return CreativeGradientTemplate;
      case 'minimal-gray':
        return MinimalGrayTemplate;
      case 'two-column-sidebar':
        return TwoColumnSidebarTemplate;
      case 'elegant-serif':
        return ElegantSerifTemplate;
      case 'modern-sans':
        return ModernSansTemplate;
      case 'compact-dense':
        return CompactDenseTemplate;
      case 'creative-split':
        return CreativeSplitTemplate;
      case 'executive-formal':
        return ExecutiveFormalTemplate;
      default:
        return ModernBlueTemplate;
    }
  };

  /**
   * Render a single page with selected template
   */
  const renderTemplate = (pageData, pageIndex) => {
    const isFirstPage = pageData.isFirstPage;
    const sectionsToShow = pageData.sections.map(s => s.id);

    const TemplateComponent = getTemplateComponent();

    return (
      <TemplateComponent
        cvData={{
          ...cvData,
          sectionOrder: sectionsToShow
        }}
        showHeader={isFirstPage}
        pageNumber={pageIndex + 1}
      />
    );
  };

  const TemplateComponent = getTemplateComponent();

  return (
    <>
      {/* Hidden measurement container */}
      <div
        ref={measureRef}
        className="fixed opacity-0 pointer-events-none"
        style={{ left: '-9999px', top: 0 }}
        aria-hidden="true"
      >
        <TemplateComponent cvData={cvData} showHeader={true} measureMode={true} />
      </div>

      {/* Paginated CV output */}
      <div ref={ref} className={`cv-preview ${className}`} id="cv-preview">
        {pages.map((pageData, pageIndex) => (
          <div
            key={pageIndex}
            className="a4-page bg-white shadow-lg mb-6"
            style={{
              width: `${A4_WIDTH_MM}mm`,
              minHeight: `${A4_HEIGHT_MM}mm`,
              pageBreakAfter: 'always',
              breakAfter: 'page'
            }}
          >
            {renderTemplate(pageData, pageIndex)}
          </div>
        ))}
      </div>
    </>
  );
});

PaginatedCVPreview.displayName = 'PaginatedCVPreview';

export default PaginatedCVPreview;
</file>

<file path="src/components/CVPreview/templates/ClassicWhiteTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github } from 'lucide-react';

const ClassicWhiteTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-8 break-inside-avoid">
        <h2 className="text-xl font-bold text-gray-800 mb-3 uppercase tracking-wide break-after-avoid">
          Professional Summary
        </h2>
        <hr className="border-gray-300 mb-4" />
        <p className="text-gray-700 leading-relaxed">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-8">
        <h2 className="text-xl font-bold text-gray-800 mb-3 uppercase tracking-wide break-after-avoid">
          Work Experience
        </h2>
        <hr className="border-gray-300 mb-4" />
        <div className="space-y-6">
          {workExperience.map((job) => (
            <div key={job.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <div>
                  <h3 className="text-lg font-bold text-gray-800">{job.position}</h3>
                  <p className="text-gray-600 font-medium">{job.company}</p>
                </div>
                <div className="text-sm text-gray-500 text-right">
                  {job.startDate} - {job.isCurrentJob ? 'Present' : job.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-3">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="list-disc list-inside text-gray-700 space-y-1 ml-4">
                  {job.achievements.map((achievement, index) => (
                    <li key={index}>{achievement}</li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section data-section="education" className="mb-8">
        <h2 className="text-xl font-bold text-gray-800 mb-3 uppercase tracking-wide break-after-avoid">
          Education
        </h2>
        <hr className="border-gray-300 mb-4" />
        <div className="space-y-4">
          {education.map((edu) => (
            <div key={edu.id} className="flex justify-between items-start break-inside-avoid mb-4">
              <div>
                <h3 className="text-lg font-bold text-gray-800">{edu.degree}</h3>
                <p className="text-gray-600">{edu.institution}</p>
                <p className="text-gray-600">{edu.fieldOfStudy}</p>
                {edu.gpa && <p className="text-sm text-gray-500">GPA: {edu.gpa}</p>}
                {edu.honors && <p className="text-sm text-gray-500">{edu.honors}</p>}
              </div>
              <div className="text-sm text-gray-500 text-right">
                {edu.startDate} - {edu.endDate}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section data-section="skills" className="mb-8 break-inside-avoid">
        <h2 className="text-xl font-bold text-gray-800 mb-3 uppercase tracking-wide">
          Skills
        </h2>
        <hr className="border-gray-300 mb-4" />
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="font-bold text-gray-800 mb-3">{category}</h3>
                <ul className="space-y-1">
                  {categorySkills.map((skill) => (
                    <li key={skill.id} className="flex justify-between">
                      <span className="text-gray-700">{skill.name}</span>
                      <span className="text-gray-500">{skill.level}</span>
                    </li>
                  ))}
                </ul>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-8">
        <h2 className="text-xl font-bold text-gray-800 mb-3 uppercase tracking-wide break-after-avoid">
          Projects
        </h2>
        <hr className="border-gray-300 mb-4" />
        <div className="space-y-4">
          {projects.map((project) => (
            <div key={project.id} className="break-inside-avoid mb-4">
              <div className="flex justify-between items-start mb-2">
                <h3 className="text-lg font-bold text-gray-800">{project.name}</h3>
                <div className="text-sm text-gray-500">
                  {project.startDate} - {project.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-2">{project.description}</p>
              <div className="flex flex-wrap gap-2">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-2 py-1 bg-gray-200 text-gray-700 rounded text-sm">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section data-section="certificates" className="mb-8">
        <h2 className="text-xl font-bold text-gray-800 mb-3 uppercase tracking-wide break-after-avoid">
          Certifications
        </h2>
        <hr className="border-gray-300 mb-4" />
        <div className="space-y-3">
          {certificates.map((cert) => (
            <div key={cert.id} className="flex justify-between items-start break-inside-avoid mb-3">
              <div>
                <h3 className="font-bold text-gray-800">{cert.name}</h3>
                <p className="text-gray-600">{cert.issuer}</p>
                {cert.credentialId && (
                  <p className="text-sm text-gray-500">ID: {cert.credentialId}</p>
                )}
              </div>
              <div className="text-sm text-gray-500">
                {cert.issueDate}
                {cert.expiryDate && ` - ${cert.expiryDate}`}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white">
      {/* Header - only show when showHeader is true */}
      {showHeader && (
        <div className="border-b-4 border-gray-800 p-8">
          <div className="text-center">
            {personalInfo.profileImage && (
              <img
                src={personalInfo.profileImage}
                alt={personalInfo.fullName}
                className="w-20 h-20 rounded-full mx-auto mb-4 object-cover border-2 border-gray-300"
              />
            )}
            <h1 className="text-4xl font-bold text-gray-800 mb-4">{personalInfo.fullName}</h1>
            <div className="flex flex-wrap justify-center gap-4 text-sm text-gray-600">
              {personalInfo.email && (
                <div className="flex items-center">
                  <Mail className="w-4 h-4 mr-1" />
                  {personalInfo.email}
                </div>
              )}
              {personalInfo.phone && (
                <div className="flex items-center">
                  <Phone className="w-4 h-4 mr-1" />
                  {personalInfo.phone}
                </div>
              )}
              {personalInfo.address && (
                <div className="flex items-center">
                  <MapPin className="w-4 h-4 mr-1" />
                  {personalInfo.address}
                </div>
              )}
              {personalInfo.website && (
                <div className="flex items-center">
                  <Globe className="w-4 h-4 mr-1" />
                  {personalInfo.website}
                </div>
              )}
              {personalInfo.linkedin && (
                <div className="flex items-center">
                  <Linkedin className="w-4 h-4 mr-1" />
                  LinkedIn
                </div>
              )}
              {personalInfo.github && (
                <div className="flex items-center">
                  <Github className="w-4 h-4 mr-1" />
                  GitHub
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* Dynamic Content based on sectionOrder */}
      <div className="p-8">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default ClassicWhiteTemplate;
</file>

<file path="src/components/CVPreview/templates/CompactDenseTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github } from 'lucide-react';

const CompactDenseTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-4 break-inside-avoid">
        <h2 className="text-sm font-bold text-gray-800 mb-2 uppercase break-after-avoid">Summary</h2>
        <p className="text-xs text-gray-700 leading-tight">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-4">
        <h2 className="text-sm font-bold text-gray-800 mb-2 uppercase break-after-avoid">Experience</h2>
        <div className="space-y-3">
          {workExperience.map((job) => (
            <div key={job.id} className="break-inside-avoid mb-4">
              <div className="flex justify-between items-baseline mb-1">
                <h3 className="text-sm font-semibold text-gray-800">{job.position}</h3>
                <span className="text-xs text-gray-500">
                  {job.startDate} - {job.isCurrentJob ? 'Present' : job.endDate}
                </span>
              </div>
              <p className="text-xs text-gray-600 mb-1">{job.company}</p>
              <p className="text-xs text-gray-700 leading-tight mb-1">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="text-xs text-gray-700 space-y-0.5">
                  {job.achievements.slice(0, 2).map((achievement, index) => (
                    <li key={index} className="flex items-start">
                      <span className="text-gray-400 mr-1">•</span>
                      <span className="leading-tight">{achievement}</span>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section data-section="education" className="mb-4">
        <h2 className="text-sm font-bold text-gray-800 mb-2 uppercase break-after-avoid">Education</h2>
        <div className="space-y-2">
          {education.map((edu) => (
            <div key={edu.id} className="break-inside-avoid mb-4">
              <div className="flex justify-between items-baseline">
                <div>
                  <h3 className="text-sm font-semibold text-gray-800">{edu.degree}</h3>
                  <p className="text-xs text-gray-600">{edu.institution}</p>
                  {edu.gpa && <p className="text-xs text-gray-500">GPA: {edu.gpa}</p>}
                </div>
                <span className="text-xs text-gray-500">
                  {edu.startDate} - {edu.endDate}
                </span>
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section data-section="skills" className="mb-4 break-inside-avoid">
        <h2 className="text-sm font-bold text-gray-800 mb-2 uppercase break-after-avoid">Skills</h2>
        <div className="grid grid-cols-3 gap-3">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="text-xs font-semibold text-gray-700 mb-1">{category}</h3>
                <div className="space-y-1">
                  {categorySkills.slice(0, 4).map((skill) => (
                    <div key={skill.id} className="text-xs text-gray-600">
                      {skill.name} ({skill.level})
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-4">
        <h2 className="text-sm font-bold text-gray-800 mb-2 uppercase break-after-avoid">Projects</h2>
        <div className="space-y-2">
          {projects.slice(0, 3).map((project) => (
            <div key={project.id} className="break-inside-avoid mb-4">
              <div className="flex justify-between items-baseline mb-1">
                <h3 className="text-sm font-semibold text-gray-800">{project.name}</h3>
                <span className="text-xs text-gray-500">
                  {project.startDate} - {project.endDate}
                </span>
              </div>
              <p className="text-xs text-gray-700 leading-tight mb-1">{project.description}</p>
              <div className="flex flex-wrap gap-1">
                {project.technologies && project.technologies.slice(0, 4).map((tech, index) => (
                  <span key={index} className="px-1 py-0.5 bg-gray-100 text-gray-600 rounded text-xs">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section data-section="certificates" className="mb-4">
        <h2 className="text-sm font-bold text-gray-800 mb-2 uppercase break-after-avoid">Certifications</h2>
        <div className="space-y-1">
          {certificates.slice(0, 4).map((cert) => (
            <div key={cert.id} className="flex justify-between items-baseline break-inside-avoid mb-4">
              <div>
                <h3 className="text-xs font-semibold text-gray-800">{cert.name}</h3>
                <p className="text-xs text-gray-600">{cert.issuer}</p>
              </div>
              <span className="text-xs text-gray-500">{cert.issueDate}</span>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white text-xs leading-tight">
      {/* Compact Header - only show when showHeader is true */}
      {showHeader && (
        <div className="border-b-2 border-gray-800 p-4">
          <div className="flex items-center space-x-4">
            {personalInfo.profileImage && (
              <img
                src={personalInfo.profileImage}
                alt={personalInfo.fullName}
                className="w-16 h-16 rounded object-cover border border-gray-300"
              />
            )}
            <div className="flex-1">
              <h1 className="text-2xl font-bold text-gray-800 mb-1">{personalInfo.fullName}</h1>
              <div className="grid grid-cols-3 gap-2 text-xs text-gray-600">
                {personalInfo.email && (
                  <div className="flex items-center">
                    <Mail className="w-3 h-3 mr-1" />
                    {personalInfo.email}
                  </div>
                )}
                {personalInfo.phone && (
                  <div className="flex items-center">
                    <Phone className="w-3 h-3 mr-1" />
                    {personalInfo.phone}
                  </div>
                )}
                {personalInfo.address && (
                  <div className="flex items-center">
                    <MapPin className="w-3 h-3 mr-1" />
                    {personalInfo.address}
                  </div>
                )}
                {personalInfo.website && (
                  <div className="flex items-center">
                    <Globe className="w-3 h-3 mr-1" />
                    Website
                  </div>
                )}
                {personalInfo.linkedin && (
                  <div className="flex items-center">
                    <Linkedin className="w-3 h-3 mr-1" />
                    LinkedIn
                  </div>
                )}
                {personalInfo.github && (
                  <div className="flex items-center">
                    <Github className="w-3 h-3 mr-1" />
                    GitHub
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Compact Content */}
      <div className="p-4 space-y-4">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default CompactDenseTemplate;
</file>

<file path="src/components/CVPreview/templates/CreativeGradientTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github, Calendar } from 'lucide-react';

const CreativeGradientTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-8 break-inside-avoid">
        <div className="relative">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-500 bg-clip-text text-transparent mb-4 break-after-avoid">
            Professional Summary
          </h2>
          <div className="absolute left-0 top-8 w-12 h-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded"></div>
        </div>
        <p className="text-gray-700 leading-relaxed mt-6 text-lg">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-8">
        <div className="relative">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-500 bg-clip-text text-transparent mb-4 break-after-avoid">
            Work Experience
          </h2>
          <div className="absolute left-0 top-8 w-12 h-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded"></div>
        </div>
        <div className="space-y-8 mt-6">
          {workExperience.map((job, index) => (
            <div key={job.id} className="relative break-inside-avoid mb-6">
              <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border-l-4 border-gradient-to-b from-purple-500 to-pink-500">
                <div className="flex justify-between items-start mb-3">
                  <div>
                    <h3 className="text-xl font-bold text-gray-800">{job.position}</h3>
                    <p className="text-purple-600 font-semibold text-lg">{job.company}</p>
                  </div>
                  <div className="text-sm text-gray-500 flex items-center bg-white px-3 py-1 rounded-full">
                    <Calendar className="w-4 h-4 mr-1" />
                    {job.startDate} - {job.isCurrentJob ? 'Present' : job.endDate}
                  </div>
                </div>
                <p className="text-gray-700 mb-4 text-lg">{job.description}</p>
                {job.achievements && job.achievements.length > 0 && (
                  <ul className="list-disc list-inside text-gray-700 space-y-2">
                    {job.achievements.map((achievement, index) => (
                      <li key={index} className="leading-relaxed">{achievement}</li>
                    ))}
                  </ul>
                )}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section data-section="education" className="mb-8">
        <div className="relative">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-500 bg-clip-text text-transparent mb-4 break-after-avoid">
            Education
          </h2>
          <div className="absolute left-0 top-8 w-12 h-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded"></div>
        </div>
        <div className="space-y-4 mt-6">
          {education.map((edu) => (
            <div key={edu.id} className="bg-gradient-to-r from-orange-50 to-red-50 rounded-lg p-4 border-l-4 border-orange-400 break-inside-avoid mb-6">
              <div className="flex justify-between items-start">
                <div>
                  <h3 className="text-lg font-bold text-gray-800">{edu.degree}</h3>
                  <p className="text-orange-600 font-semibold">{edu.institution}</p>
                  <p className="text-gray-600">{edu.fieldOfStudy}</p>
                  {edu.gpa && <p className="text-sm text-gray-500">GPA: {edu.gpa}</p>}
                  {edu.honors && <p className="text-sm text-gray-500">{edu.honors}</p>}
                </div>
                <div className="text-sm text-gray-500 flex items-center bg-white px-2 py-1 rounded">
                  <Calendar className="w-4 h-4 mr-1" />
                  {edu.startDate} - {edu.endDate}
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section data-section="skills" className="mb-8 break-inside-avoid">
        <div className="relative">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-500 bg-clip-text text-transparent mb-4 break-after-avoid">
            Skills
          </h2>
          <div className="absolute left-0 top-8 w-12 h-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded"></div>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category} className="bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg p-4">
                <h3 className="font-bold text-gray-800 mb-3 text-lg">{category}</h3>
                <div className="space-y-3">
                  {categorySkills.map((skill) => (
                    <div key={skill.id}>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="font-medium">{skill.name}</span>
                        <span className="text-purple-600 font-semibold">{skill.level}</span>
                      </div>
                      <div className="w-full bg-white rounded-full h-2">
                        <div
                          className="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-500"
                          style={{
                            width: skill.level === 'Expert' ? '100%' : 
                                   skill.level === 'Advanced' ? '80%' : 
                                   skill.level === 'Intermediate' ? '60%' : '40%'
                          }}
                        ></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-8">
        <div className="relative">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-500 bg-clip-text text-transparent mb-4 break-after-avoid">
            Projects
          </h2>
          <div className="absolute left-0 top-8 w-12 h-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded"></div>
        </div>
        <div className="space-y-4 mt-6">
          {projects.map((project) => (
            <div key={project.id} className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border-l-4 border-blue-400 break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <h3 className="text-lg font-bold text-gray-800">{project.name}</h3>
                <div className="text-sm text-gray-500 flex items-center bg-white px-2 py-1 rounded">
                  <Calendar className="w-4 h-4 mr-1" />
                  {project.startDate} - {project.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-3">{project.description}</p>
              <div className="flex flex-wrap gap-2">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-3 py-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-full text-sm font-medium">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section data-section="certificates" className="mb-8">
        <div className="relative">
          <h2 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-500 bg-clip-text text-transparent mb-4 break-after-avoid">
            Certifications
          </h2>
          <div className="absolute left-0 top-8 w-12 h-1 bg-gradient-to-r from-purple-600 to-pink-500 rounded"></div>
        </div>
        <div className="space-y-3 mt-6">
          {certificates.map((cert) => (
            <div key={cert.id} className="bg-gradient-to-r from-green-50 to-teal-50 rounded-lg p-4 border-l-4 border-green-400 break-inside-avoid mb-6">
              <div className="flex justify-between items-start">
                <div>
                  <h3 className="font-bold text-gray-800 text-lg">{cert.name}</h3>
                  <p className="text-green-600 font-semibold">{cert.issuer}</p>
                  {cert.credentialId && (
                    <p className="text-sm text-gray-500">ID: {cert.credentialId}</p>
                  )}
                </div>
                <div className="text-sm text-gray-500 bg-white px-2 py-1 rounded">
                  {cert.issueDate}
                  {cert.expiryDate && ` - ${cert.expiryDate}`}
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white overflow-hidden">
      {/* Header with gradient - only show when showHeader is true */}
      {showHeader && (
        <div className="bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400 text-white p-8 relative">
          <div className="absolute inset-0 bg-black opacity-10"></div>
          <div className="relative z-10">
            <div className="flex items-center space-x-6">
              {personalInfo.profileImage && (
                <img
                  src={personalInfo.profileImage}
                  alt={personalInfo.fullName}
                  className="w-28 h-28 rounded-full border-4 border-white/50 object-cover shadow-lg"
                />
              )}
              <div className="flex-1">
                <h1 className="text-5xl font-bold mb-3 drop-shadow-lg">{personalInfo.fullName}</h1>
                <div className="grid grid-cols-2 gap-3 text-sm opacity-95">
                  {personalInfo.email && (
                    <div className="flex items-center bg-white/20 rounded-full px-3 py-1">
                      <Mail className="w-4 h-4 mr-2" />
                      {personalInfo.email}
                    </div>
                  )}
                  {personalInfo.phone && (
                    <div className="flex items-center bg-white/20 rounded-full px-3 py-1">
                      <Phone className="w-4 h-4 mr-2" />
                      {personalInfo.phone}
                    </div>
                  )}
                  {personalInfo.address && (
                    <div className="flex items-center bg-white/20 rounded-full px-3 py-1">
                      <MapPin className="w-4 h-4 mr-2" />
                      {personalInfo.address}
                    </div>
                  )}
                  {personalInfo.website && (
                    <div className="flex items-center bg-white/20 rounded-full px-3 py-1">
                      <Globe className="w-4 h-4 mr-2" />
                      {personalInfo.website}
                    </div>
                  )}
                  {personalInfo.linkedin && (
                    <div className="flex items-center bg-white/20 rounded-full px-3 py-1">
                      <Linkedin className="w-4 h-4 mr-2" />
                      LinkedIn
                    </div>
                  )}
                  {personalInfo.github && (
                    <div className="flex items-center bg-white/20 rounded-full px-3 py-1">
                      <Github className="w-4 h-4 mr-2" />
                      GitHub
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Dynamic Content based on sectionOrder */}
      <div className="p-8">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default CreativeGradientTemplate;
</file>

<file path="src/components/CVPreview/templates/CreativeSplitTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github, Calendar } from 'lucide-react';

const CreativeSplitTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Left side sections (colored background)
  const renderLeftSideSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <div className="mb-8">
        <h2 className="text-xl font-bold text-white mb-4">Skills</h2>
        <div className="space-y-6">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="text-sm font-semibold text-pink-200 mb-3 uppercase tracking-wide">{category}</h3>
                <div className="space-y-2">
                  {categorySkills.map((skill) => (
                    <div key={skill.id}>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="text-white">{skill.name}</span>
                        <span className="text-pink-200">{skill.level}</span>
                      </div>
                      <div className="w-full bg-white/20 rounded-full h-2">
                        <div
                          className="bg-gradient-to-r from-pink-300 to-yellow-300 h-2 rounded-full"
                          style={{
                            width: skill.level === 'Expert' ? '100%' : 
                                   skill.level === 'Advanced' ? '80%' : 
                                   skill.level === 'Intermediate' ? '60%' : '40%'
                          }}
                        ></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  const renderLeftSideEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <div className="mb-8">
        <h2 className="text-xl font-bold text-white mb-4">Education</h2>
        <div className="space-y-4">
          {education.map((edu) => (
            <div key={edu.id} className="bg-white/10 rounded-lg p-4">
              <h3 className="text-lg font-bold text-white">{edu.degree}</h3>
              <p className="text-pink-200">{edu.institution}</p>
              <p className="text-sm text-pink-100">{edu.startDate} - {edu.endDate}</p>
              {edu.gpa && <p className="text-sm text-pink-100">GPA: {edu.gpa}</p>}
            </div>
          ))}
        </div>
      </div>
    );
  };

  const renderLeftSideCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <div className="mb-8">
        <h2 className="text-xl font-bold text-white mb-4">Certifications</h2>
        <div className="space-y-3">
          {certificates.map((cert) => (
            <div key={cert.id} className="bg-white/10 rounded-lg p-3">
              <h3 className="font-bold text-white text-sm">{cert.name}</h3>
              <p className="text-pink-200 text-sm">{cert.issuer}</p>
              <p className="text-xs text-pink-100">{cert.issueDate}</p>
            </div>
          ))}
        </div>
      </div>
    );
  };

  // Right side sections (white background)
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-8 break-inside-avoid">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 break-after-avoid">About Me</h2>
        <p className="text-gray-700 leading-relaxed text-lg">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-8">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 break-after-avoid">Experience</h2>
        <div className="space-y-6">
          {workExperience.map((job) => (
            <div key={job.id} className="border-l-4 border-pink-500 pl-6 break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <div>
                  <h3 className="text-xl font-bold text-gray-800">{job.position}</h3>
                  <p className="text-pink-600 font-semibold">{job.company}</p>
                </div>
                <div className="text-sm text-gray-500 flex items-center bg-pink-100 px-3 py-1 rounded-full">
                  <Calendar className="w-4 h-4 mr-1" />
                  {job.startDate} - {job.isCurrentJob ? 'Present' : job.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-3">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="text-gray-700 space-y-1">
                  {job.achievements.map((achievement, index) => (
                    <li key={index} className="flex items-start">
                      <span className="w-2 h-2 bg-pink-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                      <span>{achievement}</span>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-8">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 break-after-avoid">Projects</h2>
        <div className="space-y-4">
          {projects.map((project) => (
            <div key={project.id} className="bg-gradient-to-r from-pink-50 to-yellow-50 rounded-lg p-4 border border-pink-200 break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <h3 className="text-lg font-bold text-gray-800">{project.name}</h3>
                <div className="text-sm text-gray-500">
                  {project.startDate} - {project.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-3">{project.description}</p>
              <div className="flex flex-wrap gap-2">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-3 py-1 bg-gradient-to-r from-pink-500 to-yellow-500 text-white rounded-full text-sm font-medium">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping for right side
  const rightSectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    projects: renderProjects
  };

  return (
    <div className="w-full bg-white flex">
      {/* Left Side - Colored Background - only show when showHeader is true */}
      {showHeader && (
        <div className="w-2/5 bg-gradient-to-br from-purple-600 via-pink-600 to-red-500 p-8 text-white">
          {/* Profile Section */}
          <div className="text-center mb-8">
            {personalInfo.profileImage && (
              <img
                src={personalInfo.profileImage}
                alt={personalInfo.fullName}
                className="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-white/30 object-cover shadow-lg"
              />
            )}
            <h1 className="text-3xl font-bold mb-2">{personalInfo.fullName}</h1>
          </div>

          {/* Contact Info */}
          <div className="mb-8">
            <h2 className="text-xl font-bold text-white mb-4">Contact</h2>
            <div className="space-y-3 text-sm">
              {personalInfo.email && (
                <div className="flex items-center">
                  <Mail className="w-4 h-4 mr-3 flex-shrink-0" />
                  <span className="break-all">{personalInfo.email}</span>
                </div>
              )}
              {personalInfo.phone && (
                <div className="flex items-center">
                  <Phone className="w-4 h-4 mr-3 flex-shrink-0" />
                  <span>{personalInfo.phone}</span>
                </div>
              )}
              {personalInfo.address && (
                <div className="flex items-center">
                  <MapPin className="w-4 h-4 mr-3 flex-shrink-0" />
                  <span>{personalInfo.address}</span>
                </div>
              )}
              {personalInfo.website && (
                <div className="flex items-center">
                  <Globe className="w-4 h-4 mr-3 flex-shrink-0" />
                  <span className="break-all">{personalInfo.website}</span>
                </div>
              )}
              {personalInfo.linkedin && (
                <div className="flex items-center">
                  <Linkedin className="w-4 h-4 mr-3 flex-shrink-0" />
                  <span>LinkedIn</span>
                </div>
              )}
              {personalInfo.github && (
                <div className="flex items-center">
                  <Github className="w-4 h-4 mr-3 flex-shrink-0" />
                  <span>GitHub</span>
                </div>
              )}
            </div>
          </div>

          {/* Left Side Content */}
          {renderLeftSideSkills()}
          {renderLeftSideEducation()}
          {renderLeftSideCertificates()}
        </div>
      )}

      {/* Right Side - White Background */}
      <div className={showHeader ? "w-3/5 p-8" : "w-full p-8"}>
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = rightSectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default CreativeSplitTemplate;
</file>

<file path="src/components/CVPreview/templates/ElegantSerifTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github } from 'lucide-react';

const ElegantSerifTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-10 break-inside-avoid">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 font-serif border-b border-gray-300 pb-2 break-after-avoid">
          Professional Summary
        </h2>
        <p className="text-gray-700 leading-loose text-lg font-serif">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-10">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 font-serif border-b border-gray-300 pb-2 break-after-avoid">
          Professional Experience
        </h2>
        <div className="space-y-8">
          {workExperience.map((job) => (
            <div key={job.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-baseline mb-3">
                <div>
                  <h3 className="text-xl font-bold text-gray-800 font-serif">{job.position}</h3>
                  <p className="text-lg text-gray-600 font-serif italic">{job.company}</p>
                </div>
                <div className="text-sm text-gray-500 font-sans">
                  {job.startDate} — {job.isCurrentJob ? 'Present' : job.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-4 leading-loose font-serif">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="text-gray-700 space-y-2 font-serif">
                  {job.achievements.map((achievement, index) => (
                    <li key={index} className="flex items-start leading-loose">
                      <span className="text-gray-400 mr-3 mt-2">•</span>
                      <span>{achievement}</span>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section data-section="education" className="mb-10">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 font-serif border-b border-gray-300 pb-2 break-after-avoid">
          Education
        </h2>
        <div className="space-y-6">
          {education.map((edu) => (
            <div key={edu.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-baseline mb-2">
                <div>
                  <h3 className="text-xl font-bold text-gray-800 font-serif">{edu.degree}</h3>
                  <p className="text-lg text-gray-600 font-serif italic">{edu.institution}</p>
                  <p className="text-gray-600 font-serif">{edu.fieldOfStudy}</p>
                </div>
                <div className="text-sm text-gray-500 font-sans">
                  {edu.startDate} — {edu.endDate}
                </div>
              </div>
              {edu.gpa && <p className="text-sm text-gray-500 font-serif">GPA: {edu.gpa}</p>}
              {edu.honors && <p className="text-sm text-gray-600 font-serif italic">{edu.honors}</p>}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section data-section="skills" className="mb-10 break-inside-avoid">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 font-serif border-b border-gray-300 pb-2 break-after-avoid">
          Core Competencies
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="text-lg font-bold text-gray-800 mb-4 font-serif">{category}</h3>
                <div className="space-y-3">
                  {categorySkills.map((skill) => (
                    <div key={skill.id} className="flex justify-between items-center">
                      <span className="text-gray-700 font-serif">{skill.name}</span>
                      <span className="text-sm text-gray-500 font-sans">{skill.level}</span>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-10">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 font-serif border-b border-gray-300 pb-2 break-after-avoid">
          Notable Projects
        </h2>
        <div className="space-y-6">
          {projects.map((project) => (
            <div key={project.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-baseline mb-2">
                <h3 className="text-xl font-bold text-gray-800 font-serif">{project.name}</h3>
                <div className="text-sm text-gray-500 font-sans">
                  {project.startDate} — {project.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-3 leading-loose font-serif">{project.description}</p>
              <div className="flex flex-wrap gap-2">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-sans">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section data-section="certificates" className="mb-10">
        <h2 className="text-2xl font-bold text-gray-800 mb-6 font-serif border-b border-gray-300 pb-2 break-after-avoid">
          Professional Certifications
        </h2>
        <div className="space-y-4">
          {certificates.map((cert) => (
            <div key={cert.id} className="flex justify-between items-start break-inside-avoid mb-6">
              <div>
                <h3 className="font-bold text-gray-800 font-serif text-lg">{cert.name}</h3>
                <p className="text-gray-600 font-serif italic">{cert.issuer}</p>
                {cert.credentialId && (
                  <p className="text-sm text-gray-500 font-sans">Credential ID: {cert.credentialId}</p>
                )}
              </div>
              <div className="text-sm text-gray-500 font-sans">
                {cert.issueDate}
                {cert.expiryDate && ` — ${cert.expiryDate}`}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white" style={{ fontFamily: 'Georgia, serif' }}>
      {/* Header - only show when showHeader is true */}
      {showHeader && (
        <div className="border-b-2 border-gray-800 p-10 bg-gray-50">
          <div className="text-center">
            {personalInfo.profileImage && (
              <img
                src={personalInfo.profileImage}
                alt={personalInfo.fullName}
                className="w-28 h-28 rounded-full mx-auto mb-6 object-cover border-4 border-gray-300 shadow-lg"
              />
            )}
            <h1 className="text-5xl font-bold text-gray-800 mb-4 font-serif">{personalInfo.fullName}</h1>
            <div className="flex flex-wrap justify-center gap-6 text-gray-600 font-sans">
              {personalInfo.email && (
                <div className="flex items-center">
                  <Mail className="w-4 h-4 mr-2" />
                  {personalInfo.email}
                </div>
              )}
              {personalInfo.phone && (
                <div className="flex items-center">
                  <Phone className="w-4 h-4 mr-2" />
                  {personalInfo.phone}
                </div>
              )}
              {personalInfo.address && (
                <div className="flex items-center">
                  <MapPin className="w-4 h-4 mr-2" />
                  {personalInfo.address}
                </div>
              )}
              {personalInfo.website && (
                <div className="flex items-center">
                  <Globe className="w-4 h-4 mr-2" />
                  {personalInfo.website}
                </div>
              )}
              {personalInfo.linkedin && (
                <div className="flex items-center">
                  <Linkedin className="w-4 h-4 mr-2" />
                  LinkedIn
                </div>
              )}
              {personalInfo.github && (
                <div className="flex items-center">
                  <Github className="w-4 h-4 mr-2" />
                  GitHub
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* Dynamic Content based on sectionOrder */}
      <div className="p-10">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default ElegantSerifTemplate;
</file>

<file path="src/components/CVPreview/templates/MinimalGrayTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github } from 'lucide-react';

const MinimalGrayTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-8 break-inside-avoid">
        <h2 className="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-4 break-after-avoid">
          About
        </h2>
        <p className="text-gray-700 leading-relaxed">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-8">
        <h2 className="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-4 break-after-avoid">
          Experience
        </h2>
        <div className="space-y-6">
          {workExperience.map((job) => (
            <div key={job.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-baseline mb-1">
                <h3 className="text-lg font-medium text-gray-900">{job.position}</h3>
                <span className="text-sm text-gray-500">
                  {job.startDate} — {job.isCurrentJob ? 'Present' : job.endDate}
                </span>
              </div>
              <p className="text-gray-600 mb-2">{job.company}</p>
              <p className="text-gray-700 mb-3 leading-relaxed">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="text-gray-700 space-y-1">
                  {job.achievements.map((achievement, index) => (
                    <li key={index} className="flex items-start">
                      <span className="text-gray-400 mr-2 mt-2 w-1 h-1 bg-gray-400 rounded-full flex-shrink-0"></span>
                      <span className="leading-relaxed">{achievement}</span>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section data-section="education" className="mb-8">
        <h2 className="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-4 break-after-avoid">
          Education
        </h2>
        <div className="space-y-4">
          {education.map((edu) => (
            <div key={edu.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-baseline mb-1">
                <h3 className="text-lg font-medium text-gray-900">{edu.degree}</h3>
                <span className="text-sm text-gray-500">
                  {edu.startDate} — {edu.endDate}
                </span>
              </div>
              <p className="text-gray-600">{edu.institution}</p>
              <p className="text-gray-600">{edu.fieldOfStudy}</p>
              {edu.gpa && <p className="text-sm text-gray-500">GPA: {edu.gpa}</p>}
              {edu.honors && <p className="text-sm text-gray-600">{edu.honors}</p>}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section data-section="skills" className="mb-8 break-inside-avoid">
        <h2 className="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-4 break-after-avoid">
          Skills
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="text-sm font-medium text-gray-700 mb-3">{category}</h3>
                <div className="space-y-2">
                  {categorySkills.map((skill) => (
                    <div key={skill.id} className="flex justify-between">
                      <span className="text-gray-700">{skill.name}</span>
                      <span className="text-xs text-gray-500">{skill.level}</span>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-8">
        <h2 className="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-4 break-after-avoid">
          Projects
        </h2>
        <div className="space-y-4">
          {projects.map((project) => (
            <div key={project.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-baseline mb-1">
                <h3 className="text-lg font-medium text-gray-900">{project.name}</h3>
                <span className="text-sm text-gray-500">
                  {project.startDate} — {project.endDate}
                </span>
              </div>
              <p className="text-gray-700 mb-2 leading-relaxed">{project.description}</p>
              <div className="flex flex-wrap gap-2">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section data-section="certificates" className="mb-8">
        <h2 className="text-xs font-semibold text-gray-500 uppercase tracking-widest mb-4 break-after-avoid">
          Certifications
        </h2>
        <div className="space-y-3">
          {certificates.map((cert) => (
            <div key={cert.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-baseline">
                <div>
                  <h3 className="font-medium text-gray-900">{cert.name}</h3>
                  <p className="text-gray-600">{cert.issuer}</p>
                  {cert.credentialId && (
                    <p className="text-xs text-gray-500">ID: {cert.credentialId}</p>
                  )}
                </div>
                <div className="text-sm text-gray-500">
                  {cert.issueDate}
                  {cert.expiryDate && ` — ${cert.expiryDate}`}
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white">
      {/* Header - only show when showHeader is true */}
      {showHeader && (
        <div className="p-8 pb-6">
          <div className="flex items-start space-x-8">
            {personalInfo.profileImage && (
              <img
                src={personalInfo.profileImage}
                alt={personalInfo.fullName}
                className="w-24 h-24 rounded object-cover grayscale"
              />
            )}
            <div className="flex-1">
              <h1 className="text-5xl font-light text-gray-900 mb-4">{personalInfo.fullName}</h1>
              <div className="space-y-1 text-sm text-gray-600">
                {personalInfo.email && (
                  <div className="flex items-center">
                    <Mail className="w-4 h-4 mr-3 text-gray-400" />
                    {personalInfo.email}
                  </div>
                )}
                {personalInfo.phone && (
                  <div className="flex items-center">
                    <Phone className="w-4 h-4 mr-3 text-gray-400" />
                    {personalInfo.phone}
                  </div>
                )}
                {personalInfo.address && (
                  <div className="flex items-center">
                    <MapPin className="w-4 h-4 mr-3 text-gray-400" />
                    {personalInfo.address}
                  </div>
                )}
                {personalInfo.website && (
                  <div className="flex items-center">
                    <Globe className="w-4 h-4 mr-3 text-gray-400" />
                    {personalInfo.website}
                  </div>
                )}
                {personalInfo.linkedin && (
                  <div className="flex items-center">
                    <Linkedin className="w-4 h-4 mr-3 text-gray-400" />
                    LinkedIn Profile
                  </div>
                )}
                {personalInfo.github && (
                  <div className="flex items-center">
                    <Github className="w-4 h-4 mr-3 text-gray-400" />
                    GitHub Profile
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Dynamic Content based on sectionOrder */}
      <div className="px-8 pb-8">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default MinimalGrayTemplate;
</file>

<file path="src/components/CVPreview/templates/ModernSansTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github, Calendar } from 'lucide-react';

const ModernSansTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-8 break-inside-avoid">
        <h2 className="text-xl font-black text-gray-900 mb-4 uppercase tracking-wider break-after-avoid">
          About
        </h2>
        <p className="text-gray-600 leading-relaxed text-base">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-8">
        <h2 className="text-xl font-black text-gray-900 mb-4 uppercase tracking-wider break-after-avoid">
          Experience
        </h2>
        <div className="space-y-6">
          {workExperience.map((job) => (
            <div key={job.id} className="border-l-4 border-blue-500 pl-6 break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <div>
                  <h3 className="text-lg font-bold text-gray-900">{job.position}</h3>
                  <p className="text-blue-600 font-semibold">{job.company}</p>
                </div>
                <div className="text-sm text-gray-500 flex items-center bg-gray-100 px-3 py-1 rounded-full">
                  <Calendar className="w-3 h-3 mr-1" />
                  {job.startDate} - {job.isCurrentJob ? 'Now' : job.endDate}
                </div>
              </div>
              <p className="text-gray-600 mb-3 leading-relaxed">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="text-gray-600 space-y-1">
                  {job.achievements.map((achievement, index) => (
                    <li key={index} className="flex items-start">
                      <span className="w-2 h-2 bg-blue-500 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                      <span className="leading-relaxed">{achievement}</span>
                    </li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section data-section="education" className="mb-8">
        <h2 className="text-xl font-black text-gray-900 mb-4 uppercase tracking-wider break-after-avoid">
          Education
        </h2>
        <div className="space-y-4">
          {education.map((edu) => (
            <div key={edu.id} className="bg-gray-50 rounded-lg p-4 break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <div>
                  <h3 className="text-lg font-bold text-gray-900">{edu.degree}</h3>
                  <p className="text-blue-600 font-semibold">{edu.institution}</p>
                  <p className="text-gray-600">{edu.fieldOfStudy}</p>
                </div>
                <div className="text-sm text-gray-500">
                  {edu.startDate} - {edu.endDate}
                </div>
              </div>
              {edu.gpa && <p className="text-sm text-gray-500">GPA: {edu.gpa}</p>}
              {edu.honors && <p className="text-sm text-blue-600 font-medium">{edu.honors}</p>}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section data-section="skills" className="mb-8 break-inside-avoid">
        <h2 className="text-xl font-black text-gray-900 mb-4 uppercase tracking-wider break-after-avoid">
          Skills
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wide">{category}</h3>
                <div className="space-y-3">
                  {categorySkills.map((skill) => (
                    <div key={skill.id}>
                      <div className="flex justify-between text-sm mb-1">
                        <span className="font-medium text-gray-700">{skill.name}</span>
                        <span className="text-gray-500 text-xs">{skill.level}</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-1.5">
                        <div
                          className="bg-gradient-to-r from-blue-500 to-blue-600 h-1.5 rounded-full transition-all duration-300"
                          style={{
                            width: skill.level === 'Expert' ? '100%' : 
                                   skill.level === 'Advanced' ? '80%' : 
                                   skill.level === 'Intermediate' ? '60%' : '40%'
                          }}
                        ></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-8">
        <h2 className="text-xl font-black text-gray-900 mb-4 uppercase tracking-wider break-after-avoid">
          Projects
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {projects.map((project) => (
            <div key={project.id} className="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <h3 className="text-lg font-bold text-gray-900">{project.name}</h3>
                <div className="text-xs text-gray-500">
                  {project.startDate} - {project.endDate}
                </div>
              </div>
              <p className="text-gray-600 mb-3 text-sm leading-relaxed">{project.description}</p>
              <div className="flex flex-wrap gap-1">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section data-section="certificates" className="mb-8">
        <h2 className="text-xl font-black text-gray-900 mb-4 uppercase tracking-wider break-after-avoid">
          Certifications
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {certificates.map((cert) => (
            <div key={cert.id} className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-100 break-inside-avoid mb-6">
              <h3 className="font-bold text-gray-900 mb-1">{cert.name}</h3>
              <p className="text-blue-600 font-semibold text-sm">{cert.issuer}</p>
              <p className="text-xs text-gray-500 mt-1">{cert.issueDate}</p>
              {cert.credentialId && (
                <p className="text-xs text-gray-400">ID: {cert.credentialId}</p>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white" style={{ fontFamily: 'Inter, system-ui, sans-serif' }}>
      {/* Header - only show when showHeader is true */}
      {showHeader && (
        <div className="bg-gradient-to-r from-gray-900 to-gray-800 text-white p-8">
          <div className="flex items-center space-x-6">
            {personalInfo.profileImage && (
              <img
                src={personalInfo.profileImage}
                alt={personalInfo.fullName}
                className="w-24 h-24 rounded-full border-4 border-white/20 object-cover"
              />
            )}
            <div className="flex-1">
              <h1 className="text-4xl font-black mb-3 tracking-tight">{personalInfo.fullName}</h1>
              <div className="grid grid-cols-2 gap-3 text-sm text-gray-300">
                {personalInfo.email && (
                  <div className="flex items-center">
                    <Mail className="w-4 h-4 mr-2" />
                    {personalInfo.email}
                  </div>
                )}
                {personalInfo.phone && (
                  <div className="flex items-center">
                    <Phone className="w-4 h-4 mr-2" />
                    {personalInfo.phone}
                  </div>
                )}
                {personalInfo.address && (
                  <div className="flex items-center">
                    <MapPin className="w-4 h-4 mr-2" />
                    {personalInfo.address}
                  </div>
                )}
                {personalInfo.website && (
                  <div className="flex items-center">
                    <Globe className="w-4 h-4 mr-2" />
                    {personalInfo.website}
                  </div>
                )}
                {personalInfo.linkedin && (
                  <div className="flex items-center">
                    <Linkedin className="w-4 h-4 mr-2" />
                    LinkedIn
                  </div>
                )}
                {personalInfo.github && (
                  <div className="flex items-center">
                    <Github className="w-4 h-4 mr-2" />
                    GitHub
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Dynamic Content based on sectionOrder */}
      <div className="p-8">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default ModernSansTemplate;
</file>

<file path="src/components/CVPreview/templates/TwoColumnSidebarTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github, Calendar } from 'lucide-react';

const TwoColumnSidebarTemplate = ({ cvData, showHeader = true, measureMode = false, pageNumber = 1 }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Left sidebar sections
  const renderPersonalInfo = () => (
    <div className="mb-8">
      <h2 className="text-lg font-bold text-white mb-4 uppercase tracking-wide">Contact</h2>
      <div className="space-y-3 text-sm">
        {personalInfo.email && (
          <div className="flex items-center text-gray-200">
            <Mail className="w-4 h-4 mr-3 flex-shrink-0" />
            <span className="break-all">{personalInfo.email}</span>
          </div>
        )}
        {personalInfo.phone && (
          <div className="flex items-center text-gray-200">
            <Phone className="w-4 h-4 mr-3 flex-shrink-0" />
            <span>{personalInfo.phone}</span>
          </div>
        )}
        {personalInfo.address && (
          <div className="flex items-center text-gray-200">
            <MapPin className="w-4 h-4 mr-3 flex-shrink-0" />
            <span>{personalInfo.address}</span>
          </div>
        )}
        {personalInfo.website && (
          <div className="flex items-center text-gray-200">
            <Globe className="w-4 h-4 mr-3 flex-shrink-0" />
            <span className="break-all">{personalInfo.website}</span>
          </div>
        )}
        {personalInfo.linkedin && (
          <div className="flex items-center text-gray-200">
            <Linkedin className="w-4 h-4 mr-3 flex-shrink-0" />
            <span>LinkedIn</span>
          </div>
        )}
        {personalInfo.github && (
          <div className="flex items-center text-gray-200">
            <Github className="w-4 h-4 mr-3 flex-shrink-0" />
            <span>GitHub</span>
          </div>
        )}
      </div>
    </div>
  );

  const renderSidebarSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <div className="mb-8">
        <h2 className="text-lg font-bold text-white mb-4 uppercase tracking-wide">Skills</h2>
        <div className="space-y-4">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="text-sm font-semibold text-gray-300 mb-2">{category}</h3>
                <div className="space-y-2">
                  {categorySkills.map((skill) => (
                    <div key={skill.id}>
                      <div className="flex justify-between text-xs mb-1">
                        <span className="text-gray-200">{skill.name}</span>
                        <span className="text-gray-400">{skill.level}</span>
                      </div>
                      <div className="w-full bg-gray-600 rounded-full h-1">
                        <div
                          className="bg-blue-400 h-1 rounded-full"
                          style={{
                            width: skill.level === 'Expert' ? '100%' : 
                                   skill.level === 'Advanced' ? '80%' : 
                                   skill.level === 'Intermediate' ? '60%' : '40%'
                          }}
                        ></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  const renderSidebarEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <div className="mb-8">
        <h2 className="text-lg font-bold text-white mb-4 uppercase tracking-wide">Education</h2>
        <div className="space-y-4">
          {education.map((edu) => (
            <div key={edu.id}>
              <h3 className="text-sm font-semibold text-gray-200">{edu.degree}</h3>
              <p className="text-xs text-gray-300">{edu.institution}</p>
              <p className="text-xs text-gray-400">{edu.startDate} - {edu.endDate}</p>
              {edu.gpa && <p className="text-xs text-gray-400">GPA: {edu.gpa}</p>}
            </div>
          ))}
        </div>
      </div>
    );
  };

  // Main content sections
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section data-section="summary" className="mb-6 break-inside-avoid">
        <h2 className="text-xl font-bold text-gray-800 mb-3 border-b-2 border-blue-600 pb-1 break-after-avoid">
          Professional Summary
        </h2>
        <p className="text-gray-700 leading-relaxed">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section data-section="experience" className="mb-6">
        <h2 className="text-xl font-bold text-gray-800 mb-3 border-b-2 border-blue-600 pb-1 break-after-avoid">
          Work Experience
        </h2>
        <div className="space-y-5">
          {workExperience.map((job) => (
            <div key={job.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-2">
                <div>
                  <h3 className="text-lg font-semibold text-gray-800">{job.position}</h3>
                  <p className="text-blue-600 font-medium">{job.company}</p>
                </div>
                <div className="text-sm text-gray-500 flex items-center">
                  <Calendar className="w-4 h-4 mr-1" />
                  {job.startDate} - {job.isCurrentJob ? 'Present' : job.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-2">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="list-disc list-inside text-gray-700 space-y-1 text-sm">
                  {job.achievements.map((achievement, index) => (
                    <li key={index}>{achievement}</li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section data-section="projects" className="mb-6">
        <h2 className="text-xl font-bold text-gray-800 mb-3 border-b-2 border-blue-600 pb-1 break-after-avoid">
          Projects
        </h2>
        <div className="space-y-4">
          {projects.map((project) => (
            <div key={project.id} className="break-inside-avoid mb-6">
              <div className="flex justify-between items-start mb-1">
                <h3 className="text-lg font-semibold text-gray-800">{project.name}</h3>
                <div className="text-sm text-gray-500">
                  {project.startDate} - {project.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-2 text-sm">{project.description}</p>
              <div className="flex flex-wrap gap-1">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section data-section="certificates" className="mb-6">
        <h2 className="text-xl font-bold text-gray-800 mb-3 border-b-2 border-blue-600 pb-1 break-after-avoid">
          Certifications
        </h2>
        <div className="space-y-3">
          {certificates.map((cert) => (
            <div key={cert.id} className="break-inside-avoid mb-6">
              <h3 className="font-semibold text-gray-800">{cert.name}</h3>
              <p className="text-blue-600 text-sm">{cert.issuer}</p>
              <p className="text-xs text-gray-500">{cert.issueDate}</p>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping for main content
  const mainSectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white flex">
      {/* Left Sidebar - only show when showHeader is true */}
      {showHeader && (
        <div className="w-1/3 bg-gray-800 p-6">
          {/* Profile Image */}
          {personalInfo.profileImage && (
            <div className="text-center mb-6">
              <img
                src={personalInfo.profileImage}
                alt={personalInfo.fullName}
                className="w-24 h-24 rounded-full mx-auto border-4 border-gray-600 object-cover"
              />
            </div>
          )}
          
          {/* Name */}
          <div className="text-center mb-8">
            <h1 className="text-2xl font-bold text-white mb-2">{personalInfo.fullName}</h1>
          </div>

          {/* Sidebar Content */}
          {renderPersonalInfo()}
          {renderSidebarSkills()}
          {renderSidebarEducation()}
        </div>
      )}

      {/* Main Content */}
      <div className={showHeader ? "w-2/3 p-6" : "w-full p-6"}>
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = mainSectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default TwoColumnSidebarTemplate;
</file>

<file path="src/components/forms/PersonalInfoForm.jsx">
import React from 'react';
import { User, Mail, Phone, MapPin, Globe, Linkedin, Github } from 'lucide-react';

const PersonalInfoForm = ({ personalInfo, onChange }) => {
  const handleChange = (field, value) => {
    onChange({
      ...personalInfo,
      [field]: value
    });
  };

  return (
    <div className="space-y-6">
      <h3 className="text-lg font-semibold text-gray-800 flex items-center">
        <User className="w-5 h-5 mr-2 text-blue-600" />
        Personal Information
      </h3>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Full Name *
          </label>
          <input
            type="text"
            value={personalInfo?.fullName || ''}
            onChange={(e) => handleChange('fullName', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="John Doe"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            <Mail className="w-4 h-4 inline mr-1" />
            Email *
          </label>
          <input
            type="email"
            value={personalInfo?.email || ''}
            onChange={(e) => handleChange('email', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="john@example.com"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            <Phone className="w-4 h-4 inline mr-1" />
            Phone *
          </label>
          <input
            type="tel"
            value={personalInfo?.phone || ''}
            onChange={(e) => handleChange('phone', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="+1 (555) 123-4567"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            <MapPin className="w-4 h-4 inline mr-1" />
            Address *
          </label>
          <input
            type="text"
            value={personalInfo?.address || ''}
            onChange={(e) => handleChange('address', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="City, State, Country"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            <Globe className="w-4 h-4 inline mr-1" />
            Website
          </label>
          <input
            type="url"
                        value={personalInfo?.website || ''}
            onChange={(e) => handleChange('website', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="https://yourwebsite.com"
          />
        </div>

        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">
            <Linkedin className="w-4 h-4 inline mr-1" />
            LinkedIn
          </label>
          <input
            type="url"
                        value={personalInfo?.linkedin || ''}
            onChange={(e) => handleChange('linkedin', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="https://linkedin.com/in/yourprofile"
          />
        </div>

        <div className="md:col-span-2">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            <Github className="w-4 h-4 inline mr-1" />
            GitHub
          </label>
          <input
            type="url"
            value={personalInfo?.github || ''}
            onChange={(e) => handleChange('github', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="https://github.com/yourusername"
          />
        </div>

        <div className="md:col-span-2">
          <label className="block text-sm font-medium text-gray-700 mb-1">
            Profile Image URL
          </label>
          <input
            type="url"
            value={personalInfo?.profileImage || ''}
            onChange={(e) => handleChange('profileImage', e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="https://example.com/your-photo.jpg"
          />
          <p className="text-xs text-gray-500 mt-1">
            Add a URL to your profile photo (optional)
          </p>
        </div>
      </div>
    </div>
  );
};

export default PersonalInfoForm;
</file>

<file path="src/components/interviews/ChatPanel.jsx">
import { useState, useRef, useEffect } from 'react';
import { Send, X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Separator } from '@/components/ui/separator';
import { format } from 'date-fns';
import { vi } from 'date-fns/locale';

const ChatPanel = ({ messages = [], onSendMessage, onClose, currentUserId }) => {
  const [messageText, setMessageText] = useState('');
  const scrollAreaRef = useRef(null);
  const messagesEndRef = useRef(null);

  // Auto-scroll to bottom when new messages arrive
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const handleSubmit = (e) => {
    e.preventDefault();
    
    if (messageText.trim()) {
      onSendMessage(messageText.trim());
      setMessageText('');
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSubmit(e);
    }
  };

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b border-gray-700">
        <h3 className="text-white font-semibold">Tin nhắn</h3>
        <Button
          variant="ghost"
          size="icon-sm"
          onClick={onClose}
          className="text-gray-400 hover:text-white"
        >
          <X className="h-4 w-4" />
        </Button>
      </div>

      {/* Messages */}
      <div className="flex-1 overflow-y-auto p-4">
        <div className="space-y-4">
          {messages.length === 0 ? (
            <div className="text-center text-gray-500 py-8">
              <p className="text-sm">Chưa có tin nhắn nào</p>
              <p className="text-xs mt-1">Gửi tin nhắn để bắt đầu trò chuyện</p>
            </div>
          ) : (
            messages.map((message) => {
              const isOwnMessage = message.senderId === currentUserId;
              return (
                <div
                  key={message.id}
                  className={`flex flex-col ${
                    isOwnMessage ? 'items-end' : 'items-start'
                  }`}
                >
                  <div
                    className={`max-w-[80%] rounded-lg px-3 py-2 ${
                      isOwnMessage
                        ? 'bg-blue-600 text-white'
                        : 'bg-gray-700 text-white'
                    }`}
                  >
                    {!isOwnMessage && message.senderName && (
                      <p className="text-xs font-semibold mb-1 opacity-80">
                        {message.senderName}
                      </p>
                    )}
                    <p className="text-sm break-words">{message.message}</p>
                  </div>
                  <span className="text-xs text-gray-500 mt-1">
                    {format(new Date(message.timestamp), 'HH:mm', { locale: vi })}
                  </span>
                </div>
              );
            })
          )}
          <div ref={messagesEndRef} />
        </div>
      </div>

      <Separator className="bg-gray-700" />

      {/* Input */}
      <form onSubmit={handleSubmit} className="p-4">
        <div className="flex gap-2">
          <Input
            value={messageText}
            onChange={(e) => setMessageText(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="Nhập tin nhắn..."
            className="flex-1 bg-gray-700 border-gray-600 text-white placeholder:text-gray-400"
            maxLength={500}
          />
          <Button
            type="submit"
            size="icon"
            disabled={!messageText.trim()}
            className="shrink-0"
          >
            <Send className="h-4 w-4" />
          </Button>
        </div>
        <p className="text-xs text-gray-500 mt-2">
          {messageText.length}/500 ký tự
        </p>
      </form>
    </div>
  );
};

export default ChatPanel;
</file>

<file path="src/components/jobs/JobMapView.jsx">
import { useCallback, useEffect, useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { GoogleMap, Marker, MarkerClusterer, InfoWindow } from '@react-google-maps/api';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';
import { Card as EnhancedCard, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { MapPin, Briefcase, DollarSign } from 'lucide-react';
import { searchJobsOnMap, getJobClusters } from '@/services/jobService';
import { useNavigate } from 'react-router-dom';

const mapContainerStyle = {
  width: '100%',
  height: '600px',
};

const defaultCenter = {
  lat: 10.8231, // Ho Chi Minh City
  lng: 106.6297,
};

const JobMapView = ({ useCluster = true }) => {
  const navigate = useNavigate();
  const [map, setMap] = useState(null);
  const [bounds, setBounds] = useState(null);
  const [zoom, setZoom] = useState(12);
  const [selectedJob, setSelectedJob] = useState(null);

  // Fetch jobs or clusters based on bounds
  const { data, isLoading, isError, error, refetch } = useQuery({
    queryKey: ['mapJobs', bounds, zoom, useCluster],
    queryFn: async () => {
      if (!bounds) return { data: [] };
      
      if (useCluster) {
        return await getJobClusters(bounds, zoom);
      } else {
        return await searchJobsOnMap(bounds);
      }
    },
    enabled: !!bounds,
    staleTime: 30000, // Cache for 30 seconds
  });

  // Handle map bounds change
  const handleBoundsChanged = useCallback(() => {
    if (!map) return;

    const mapBounds = map.getBounds();
    if (!mapBounds) return;

    const ne = mapBounds.getNorthEast();
    const sw = mapBounds.getSouthWest();

    setBounds({
      ne_lat: ne.lat(),
      ne_lng: ne.lng(),
      sw_lat: sw.lat(),
      sw_lng: sw.lng(),
    });

    setZoom(map.getZoom());
  }, [map]);

  // Handle marker click
  const handleMarkerClick = (job) => {
    setSelectedJob(job);
  };

  // Handle cluster click - zoom in
  const handleClusterClick = (cluster) => {
    if (map && cluster.coordinates) {
      map.panTo({ lat: cluster.coordinates[1], lng: cluster.coordinates[0] });
      map.setZoom(map.getZoom() + 2);
    }
  };

  const jobs = data?.data || [];

  if (isLoading && !bounds) {
    return <Skeleton className="h-[600px] w-full" />;
  }

  return (
    <EnhancedCard variant="glass">
      <CardContent className="p-0">
        <GoogleMap
          mapContainerStyle={mapContainerStyle}
          center={defaultCenter}
          zoom={zoom}
          onLoad={setMap}
          onIdle={handleBoundsChanged}
          options={{
            zoomControl: true,
            streetViewControl: false,
            mapTypeControl: false,
            fullscreenControl: true,
          }}
        >
          {isError && (
            <div className="absolute top-4 left-1/2 transform -translate-x-1/2 z-10">
              <ErrorState 
                onRetry={refetch} 
                message={error?.response?.data?.message || error?.message} 
              />
            </div>
          )}

          {jobs.map((item, index) => {
            const [lng, lat] = item.coordinates;
            const position = { lat, lng };

            if (item.cluster) {
              // Render cluster marker
              return (
                <Marker
                  key={`cluster-${index}`}
                  position={position}
                  icon={{
                    path: window.google.maps.SymbolPath.CIRCLE,
                    scale: 20,
                    fillColor: '#3b82f6',
                    fillOpacity: 0.8,
                    strokeColor: '#1e40af',
                    strokeWeight: 2,
                  }}
                  label={{
                    text: String(item.count),
                    color: 'white',
                    fontSize: '14px',
                    fontWeight: 'bold',
                  }}
                  onClick={() => handleClusterClick(item)}
                />
              );
            } else {
              // Render individual job marker
              return (
                <Marker
                  key={item.jobId || item._id}
                  position={position}
                  onClick={() => handleMarkerClick(item)}
                />
              );
            }
          })}

          {selectedJob && (
            <InfoWindow
              position={{
                lat: selectedJob.coordinates[1],
                lng: selectedJob.coordinates[0],
              }}
              onCloseClick={() => setSelectedJob(null)}
            >
              <div className="p-2 max-w-xs">
                <h3 className="font-semibold text-base mb-2">{selectedJob.title}</h3>
                
                {selectedJob.company && (
                  <div className="flex items-center gap-2 mb-2">
                    {selectedJob.company.logo && (
                      <img 
                        src={selectedJob.company.logo} 
                        alt={selectedJob.company.name}
                        className="w-8 h-8 rounded object-cover"
                      />
                    )}
                    <span className="text-sm text-muted-foreground">
                      {selectedJob.company.name}
                    </span>
                  </div>
                )}

                <div className="space-y-1 text-sm">
                  <div className="flex items-center gap-2">
                    <MapPin className="w-4 h-4 text-muted-foreground" />
                    <span className="text-muted-foreground">{selectedJob.address}</span>
                  </div>

                  {(selectedJob.minSalary || selectedJob.maxSalary) && (
                    <div className="flex items-center gap-2">
                      <DollarSign className="w-4 h-4 text-muted-foreground" />
                      <span className="text-muted-foreground">
                        {selectedJob.minSalary && selectedJob.maxSalary
                          ? `${selectedJob.minSalary} - ${selectedJob.maxSalary} triệu`
                          : selectedJob.minSalary
                          ? `Từ ${selectedJob.minSalary} triệu`
                          : `Lên đến ${selectedJob.maxSalary} triệu`}
                      </span>
                    </div>
                  )}

                  <div className="flex items-center gap-2">
                    <Briefcase className="w-4 h-4 text-muted-foreground" />
                    <span className="text-muted-foreground">
                      {selectedJob.type} • {selectedJob.workType}
                    </span>
                  </div>
                </div>

                <Button
                  className="w-full mt-3 btn-gradient"
                  size="sm"
                  onClick={() => navigate(`/jobs/${selectedJob.jobId || selectedJob._id}`)}
                >
                  Xem chi tiết
                </Button>
              </div>
            </InfoWindow>
          )}
        </GoogleMap>
      </CardContent>
    </EnhancedCard>
  );
};

export default JobMapView;
</file>

<file path="src/components/layout/CVDropdownMenu.jsx">
import { useState, useRef } from 'react';
import { Link } from 'react-router-dom';
import { FileText, FileEdit, Upload, ChevronDown } from 'lucide-react';
import { cn } from '@/lib/utils';

const CVDropdownMenu = ({ isHeaderWhite }) => {
  const [isOpen, setIsOpen] = useState(false);
  const timeoutRef = useRef(null);

  const menuItems = [
    {
      to: '/my-cvs/builder',
      label: 'CV Builder',
      icon: <FileEdit className="h-4 w-4" />,
      description: 'Tạo CV với template có sẵn',
    },
    {
      to: '/my-cvs/uploaded',
      label: 'CV đã tải lên',
      icon: <Upload className="h-4 w-4" />,
      description: 'Quản lý CV đã upload',
    },
  ];

  const handleMouseEnter = () => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    setIsOpen(true);
  };

  const handleMouseLeave = () => {
    timeoutRef.current = setTimeout(() => {
      setIsOpen(false);
    }, 150); // 150ms delay before closing
  };

  return (
    <div
      className="relative"
      onMouseEnter={handleMouseEnter}
      onMouseLeave={handleMouseLeave}
    >
      {/* Trigger Button */}
      <button
        className={cn(
          "relative px-4 py-2 rounded-lg transition-all duration-300 font-semibold group flex items-center gap-1",
          "hover:bg-primary/5 hover:scale-105",
          isHeaderWhite
            ? "text-foreground hover:text-primary"
            : "text-muted-foreground hover:text-primary"
        )}
      >
        <span className="relative z-10">Quản lý CV</span>
        <ChevronDown
          className={cn(
            "h-4 w-4 transition-transform duration-300",
            isOpen && "rotate-180"
          )}
        />
        {/* Hover effect background */}
        <div className="absolute inset-0 rounded-lg bg-gradient-to-r from-primary/10 to-blue-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
        {/* Bottom border animation */}
        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-gradient-to-r from-primary to-blue-600 group-hover:w-3/4 transition-all duration-300" />
      </button>

      {/* Dropdown Menu */}
      {isOpen && (
        <div
          className={cn(
            "absolute top-full left-0 pt-2 w-72 z-50",
            "animate-in slide-in-from-top-2 fade-in-0 duration-300"
          )}
        >
          <div className={cn(
            "bg-background/95 backdrop-blur-xl",
            "border-2 border-border/50 rounded-2xl overflow-hidden",
            // Enhanced shadow for depth
            "shadow-[0_20px_70px_-15px_rgba(0,0,0,0.3)]",
            "dark:shadow-[0_20px_70px_-15px_rgba(0,0,0,0.6)]",
            // Ring effect
            "ring-1 ring-black/5 dark:ring-white/10"
          )}>
            <div className="py-2">
              {menuItems.map((item, index) => (
                <Link
                  key={item.to}
                  to={item.to}
                  className={cn(
                    "flex items-start gap-3 px-4 py-3 transition-colors duration-200",
                    "hover:bg-muted/50",
                    index !== menuItems.length - 1 && "border-b border-border/30"
                  )}
                >
                  <div className="flex-shrink-0 mt-0.5 text-primary">
                    {item.icon}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="text-sm font-medium text-foreground">
                      {item.label}
                    </div>
                    <div className="text-xs text-muted-foreground mt-0.5">
                      {item.description}
                    </div>
                  </div>
                </Link>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default CVDropdownMenu;
</file>

<file path="src/components/layout/Footer.jsx">
import { Link } from 'react-router-dom';
import { Button } from '../ui/button';
import { Input } from '../ui/input';
import { Facebook, Twitter, Linkedin, Instagram } from 'lucide-react';

const Footer = () => {
  return (
    // Sử dụng màu từ theme
    <footer className="bg-footer text-footer-foreground">
      <div className="container py-12">
        <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
          {/* About Section */}
          <div className="md:col-span-1">
            <h3 className="text-xl font-bold mb-4">Career<span className="text-primary">Zone</span></h3>
            <p className="text-footer-muted">
              Kết nối tài năng với cơ hội. Tìm kiếm công việc mơ ước của bạn và phát triển sự nghiệp cùng chúng tôi.
            </p>
          </div>

          {/* Quick Links */}
          <div>
            <h4 className="font-semibold mb-4 text-footer-foreground">Liên kết nhanh</h4>
            <ul className="space-y-2">
              <li><Link to="/jobs" className="text-footer-muted hover:text-primary transition-colors">Việc làm</Link></li>
              <li><Link to="/companies" className="text-footer-muted hover:text-primary transition-colors">Công ty</Link></li>
              <li><Link to="/about" className="text-footer-muted hover:text-primary transition-colors">Về chúng tôi</Link></li>
              <li><Link to="/contact" className="text-footer-muted hover:text-primary transition-colors">Liên hệ</Link></li>
            </ul>
          </div>

          {/* Legal */}
          <div>
            <h4 className="font-semibold mb-4 text-footer-foreground">Pháp lý</h4>
            <ul className="space-y-2">
              <li><Link to="/terms" className="text-footer-muted hover:text-primary transition-colors">Điều khoản dịch vụ</Link></li>
              <li><Link to="/privacy" className="text-footer-muted hover:text-primary transition-colors">Chính sách bảo mật</Link></li>
            </ul>
          </div>

          {/* Newsletter */}
          <div>
            <h4 className="font-semibold mb-4 text-footer-foreground">Đăng ký nhận bản tin</h4>
            <p className="text-footer-muted mb-4">Nhận thông tin việc làm mới nhất và các mẹo nghề nghiệp.</p>
            <div className="flex gap-2">
              <Input
                type="email"
                placeholder="Email của bạn"
                // Tùy chỉnh input cho phù hợp theme
                className="bg-background border-border placeholder:text-muted-foreground focus:border-primary"
              />
              <Button>Đăng ký</Button>
            </div>
          </div>
        </div>

        <div className="mt-8 border-t border-border pt-8 flex flex-col md:flex-row justify-between items-center">
          <p className="text-footer-muted text-sm">&copy; {new Date().getFullYear()} CareerZone. All rights reserved.</p>
          <div className="flex space-x-4 mt-4 md:mt-0">
            <a href="#" className="text-footer-muted hover:text-primary transition-colors p-2"><Facebook className="h-5 w-5" /></a>
            <a href="#" className="text-footer-muted hover:text-primary transition-colors p-2"><Twitter className="h-5 w-5" /></a>
            <a href="#" className="text-footer-muted hover:text-primary transition-colors p-2"><Linkedin className="h-5 w-5" /></a>
            <a href="#" className="text-footer-muted hover:text-primary transition-colors p-2"><Instagram className="h-5 w-5" /></a>
          </div>
        </div>
      </div>
    </footer>
  );
};

export default Footer;
</file>

<file path="src/components/onboarding/ErrorState.jsx">
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { AlertCircle, RefreshCw } from 'lucide-react';

export const ErrorState = ({ 
  title = 'Đã xảy ra lỗi',
  message = 'Không thể tải dữ liệu. Vui lòng thử lại.',
  onRetry 
}) => {
  return (
    <div className="flex items-center justify-center min-h-[400px]">
      <Alert variant="destructive" className="max-w-md">
        <AlertCircle className="h-4 w-4" />
        <AlertTitle>{title}</AlertTitle>
        <AlertDescription className="mt-2">
          {message}
        </AlertDescription>
        {onRetry && (
          <Button
            variant="outline"
            size="sm"
            onClick={onRetry}
            className="mt-4"
          >
            <RefreshCw className="w-4 h-4 mr-2" />
            Thử lại
          </Button>
        )}
      </Alert>
    </div>
  );
};

export const InlineError = ({ message }) => {
  if (!message) return null;
  
  // Clean up technical error messages to be more user-friendly
  let displayMessage = message;
  
  // Replace technical enum errors with friendly messages
  if (message.includes('Invalid enum value') || message.includes('expected one of')) {
    displayMessage = 'Vui lòng chọn một trong các tùy chọn được cung cấp';
  }
  
  // Replace other technical messages
  if (message.toLowerCase().includes('required') && !message.includes('Vui lòng')) {
    displayMessage = 'Trường này là bắt buộc';
  }
  
  if (message.includes('Invalid type') || message.includes('invalid_type')) {
    displayMessage = 'Giá trị không hợp lệ';
  }
  
  return (
    <div className="flex items-center gap-2 text-sm text-red-600 dark:text-red-400 mt-1 animate-in slide-in-from-top-1 duration-200">
      <AlertCircle className="w-4 h-4 flex-shrink-0" />
      <span>{displayMessage}</span>
    </div>
  );
};
</file>

<file path="src/components/onboarding/index.js">
export { OnboardingWrapper } from './OnboardingWrapper';
export { OnboardingBackground } from './OnboardingBackground';
export { OnboardingErrorBoundary } from './OnboardingErrorBoundary';
export { ProgressIndicator } from './ProgressIndicator';
export { SkipConfirmationModal } from './SkipConfirmationModal';
export { ProfileCompletenessBar } from './ProfileCompletenessBar';
export { LoadingState, FormLoadingOverlay } from './LoadingState';
export { ErrorState, InlineError } from './ErrorState';
export { BasicInfoStep } from './steps/BasicInfoStep';
export { SkillsExperienceStep } from './steps/SkillsExperienceStep';
export { SalaryPreferencesStep } from './steps/SalaryPreferencesStep';
</file>

<file path="src/components/onboarding/SkipConfirmationModal.jsx">
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { AlertTriangle } from 'lucide-react';

export const SkipConfirmationModal = ({ 
  isOpen, 
  onClose, 
  onConfirm, 
  skipType = 'step',
  currentStep 
}) => {
  const getImpactMessage = () => {
    if (skipType === 'all') {
      return {
        title: 'Bỏ qua hoàn thiện hồ sơ?',
        description: 'Nếu bỏ qua, bạn sẽ không nhận được gợi ý việc làm phù hợp. Hồ sơ chưa hoàn thiện có thể ảnh hưởng đến cơ hội tìm việc của bạn.',
        impacts: [
          'Không nhận được gợi ý việc làm cá nhân hóa',
          'Nhà tuyển dụng khó tìm thấy hồ sơ của bạn',
          'Giảm khả năng được mời phỏng vấn'
        ]
      };
    }

    // Step-specific impacts
    const stepImpacts = {
      'Thông tin cơ bản': [
        'Nhà tuyển dụng không thể liên hệ với bạn',
        'Hồ sơ thiếu thông tin cơ bản'
      ],
      'Kỹ năng & Kinh nghiệm': [
        'Không thể gợi ý việc làm phù hợp với kỹ năng',
        'Giảm độ chính xác của gợi ý việc làm'
      ],
      'Mức lương & Điều kiện': [
        'Có thể nhận gợi ý việc làm không phù hợp với mong muốn',
        'Khó lọc công việc theo điều kiện mong muốn'
      ]
    };

    return {
      title: `Bỏ qua bước "${currentStep}"?`,
      description: 'Bạn có thể hoàn thiện thông tin này sau, nhưng điều này có thể ảnh hưởng đến trải nghiệm của bạn.',
      impacts: stepImpacts[currentStep] || ['Giảm chất lượng gợi ý việc làm']
    };
  };

  const { title, description, impacts } = getImpactMessage();

  return (
    <AlertDialog open={isOpen} onOpenChange={onClose}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <div className="flex items-center gap-2 mb-2">
            <AlertTriangle className="w-5 h-5 text-amber-500" />
            <AlertDialogTitle>{title}</AlertDialogTitle>
          </div>
          <AlertDialogDescription asChild>
            <div className="space-y-3">
              <p>{description}</p>
              <div className="bg-amber-50 dark:bg-amber-950 border border-amber-200 dark:border-amber-800 rounded-lg p-3">
                <p className="font-medium text-amber-900 dark:text-amber-100 text-sm mb-2">
                  Tác động:
                </p>
                <ul className="space-y-1 text-sm text-amber-800 dark:text-amber-200">
                  {impacts.map((impact, index) => (
                    <li key={index} className="flex items-start gap-2">
                      <span className="text-amber-500 mt-0.5">•</span>
                      <span>{impact}</span>
                    </li>
                  ))}
                </ul>
              </div>
              <p className="text-xs text-muted-foreground">
                Bạn có thể quay lại hoàn thiện hồ sơ bất cứ lúc nào từ trang cá nhân.
              </p>
            </div>
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel onClick={onClose}>
            Tiếp tục hoàn thiện
          </AlertDialogCancel>
          <AlertDialogAction 
            onClick={onConfirm}
            className="bg-amber-600 hover:bg-amber-700"
          >
            Bỏ qua
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
};
</file>

<file path="src/components/onboarding/steps/SalaryPreferencesStep.jsx">
import { useForm, Controller } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Slider } from '@/components/ui/slider';
import { DollarSign, Briefcase, FileText } from 'lucide-react';
import { salaryPreferencesSchema, workTypeEnum, contractTypeEnum } from '@/schemas/onboardingSchemas';
import { InlineError } from '../ErrorState';

const formatCurrency = (value) => {
  return new Intl.NumberFormat('vi-VN', {
    style: 'currency',
    currency: 'VND',
    maximumFractionDigits: 0
  }).format(value);
};

export const SalaryPreferencesStep = ({ initialData = {}, onNext, isLoading, onLoadingChange }) => {
  const [selectedWorkTypes, setSelectedWorkTypes] = useState(initialData.workTypes || []);
  const [selectedContractTypes, setSelectedContractTypes] = useState(initialData.contractTypes || []);

  const {
    register,
    handleSubmit,
    control,
    formState: { errors },
    setValue,
    watch
  } = useForm({
    resolver: zodResolver(salaryPreferencesSchema),
    defaultValues: {
      expectedSalary: {
        min: initialData.expectedSalary?.min || 5000000,
        max: initialData.expectedSalary?.max || 20000000,
        currency: 'VND'
      },
      workTypes: initialData.workTypes || [],
      contractTypes: initialData.contractTypes || []
    }
  });

  const minSalary = watch('expectedSalary.min');
  const maxSalary = watch('expectedSalary.max');

  const toggleWorkType = (type) => {
    let updated;
    if (selectedWorkTypes.includes(type)) {
      updated = selectedWorkTypes.filter(t => t !== type);
    } else {
      updated = [...selectedWorkTypes, type];
    }
    setSelectedWorkTypes(updated);
    setValue('workTypes', updated);
  };

  const toggleContractType = (type) => {
    let updated;
    if (selectedContractTypes.includes(type)) {
      updated = selectedContractTypes.filter(t => t !== type);
    } else {
      updated = [...selectedContractTypes, type];
    }
    setSelectedContractTypes(updated);
    setValue('contractTypes', updated);
  };

  const onSubmit = (data) => {
    onNext(data);
  };

  const workTypeDescriptions = {
    'Full-time': 'Làm việc toàn thời gian, 8 giờ/ngày',
    'Part-time': 'Làm việc bán thời gian, linh hoạt giờ giấc',
    'Remote': 'Làm việc từ xa, không cần đến văn phòng',
    'Hybrid': 'Kết hợp làm việc tại văn phòng và từ xa'
  };

  const contractTypeDescriptions = {
    'Chính thức': 'Hợp đồng lao động chính thức, đầy đủ quyền lợi',
    'Thực tập': 'Hợp đồng thực tập sinh',
    'Freelance': 'Làm việc tự do, theo dự án'
  };

  const salaryRanges = [
    { label: 'Dưới 10 triệu', min: 0, max: 10000000 },
    { label: '10-20 triệu', min: 10000000, max: 20000000 },
    { label: '20-30 triệu', min: 20000000, max: 30000000 },
    { label: '30-50 triệu', min: 30000000, max: 50000000 },
    { label: 'Trên 50 triệu', min: 50000000, max: 100000000 }
  ];

  const setSalaryRange = (range) => {
    setValue('expectedSalary.min', range.min);
    setValue('expectedSalary.max', range.max);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* Expected Salary */}
      <Card>
        <CardHeader>
          <CardTitle>Mức lương mong muốn</CardTitle>
          <CardDescription>
            Chọn khoảng lương bạn mong muốn nhận được
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Quick Salary Ranges */}
          <div>
            <Label className="text-sm font-medium mb-2 block">Khoảng lương phổ biến</Label>
            <div className="flex flex-wrap gap-2">
              {salaryRanges.map((range) => (
                <Badge
                  key={range.label}
                  variant="outline"
                  className="cursor-pointer hover:bg-primary hover:text-primary-foreground"
                  onClick={() => setSalaryRange(range)}
                >
                  {range.label}
                </Badge>
              ))}
            </div>
          </div>

          {/* Min Salary */}
          <div className="space-y-2">
            <Label htmlFor="minSalary">
              Mức lương tối thiểu <span className="text-red-500">*</span>
            </Label>
            <div className="relative">
              <DollarSign className="absolute left-3 top-3 w-4 h-4 text-muted-foreground" />
              <Input
                id="minSalary"
                type="number"
                {...register('expectedSalary.min', { valueAsNumber: true })}
                placeholder="5000000"
                className="pl-10"
              />
            </div>
            <p className="text-sm text-muted-foreground">
              {formatCurrency(minSalary || 0)}
            </p>
            <InlineError message={errors.expectedSalary?.min?.message} />
          </div>

          {/* Max Salary */}
          <div className="space-y-2">
            <Label htmlFor="maxSalary">
              Mức lương tối đa <span className="text-red-500">*</span>
            </Label>
            <div className="relative">
              <DollarSign className="absolute left-3 top-3 w-4 h-4 text-muted-foreground" />
              <Input
                id="maxSalary"
                type="number"
                {...register('expectedSalary.max', { valueAsNumber: true })}
                placeholder="20000000"
                className="pl-10"
              />
            </div>
            <p className="text-sm text-muted-foreground">
              {formatCurrency(maxSalary || 0)}
            </p>
            <InlineError message={errors.expectedSalary?.max?.message} />
          </div>

          {/* Salary Range Display */}
          <div className="p-4 bg-primary/10 rounded-lg">
            <p className="text-sm font-medium text-foreground mb-1">
              Khoảng lương của bạn:
            </p>
            <p className="text-lg font-bold text-primary">
              {formatCurrency(minSalary || 0)} - {formatCurrency(maxSalary || 0)}
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Work Types */}
      <Card>
        <CardHeader>
          <CardTitle>Hình thức làm việc</CardTitle>
          <CardDescription>
            Chọn các hình thức làm việc bạn quan tâm
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
            {workTypeEnum.map((type) => (
              <div
                key={type}
                className={`p-4 rounded-lg border cursor-pointer transition-colors ${
                  selectedWorkTypes.includes(type)
                    ? 'bg-primary text-primary-foreground border-primary'
                    : 'hover:bg-muted'
                }`}
                onClick={() => toggleWorkType(type)}
              >
                <div className="flex items-start gap-3">
                  <Briefcase className="w-5 h-5 mt-0.5 flex-shrink-0" />
                  <div>
                    <p className="font-medium">{type}</p>
                    <p className={`text-xs mt-1 ${
                      selectedWorkTypes.includes(type)
                        ? 'text-primary-foreground/80'
                        : 'text-muted-foreground'
                    }`}>
                      {workTypeDescriptions[type]}
                    </p>
                  </div>
                </div>
              </div>
            ))}
          </div>
          <InlineError message={errors.workTypes?.message} />
        </CardContent>
      </Card>

      {/* Contract Types */}
      <Card>
        <CardHeader>
          <CardTitle>Loại hợp đồng</CardTitle>
          <CardDescription>
            Chọn các loại hợp đồng bạn quan tâm
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
            {contractTypeEnum.map((type) => (
              <div
                key={type}
                className={`p-4 rounded-lg border cursor-pointer transition-colors ${
                  selectedContractTypes.includes(type)
                    ? 'bg-primary text-primary-foreground border-primary'
                    : 'hover:bg-muted'
                }`}
                onClick={() => toggleContractType(type)}
              >
                <div className="flex items-start gap-3">
                  <FileText className="w-5 h-5 mt-0.5 flex-shrink-0" />
                  <div>
                    <p className="font-medium">{type}</p>
                    <p className={`text-xs mt-1 ${
                      selectedContractTypes.includes(type)
                        ? 'text-primary-foreground/80'
                        : 'text-muted-foreground'
                    }`}>
                      {contractTypeDescriptions[type]}
                    </p>
                  </div>
                </div>
              </div>
            ))}
          </div>
          <InlineError message={errors.contractTypes?.message} />
        </CardContent>
      </Card>

      {/* Hidden submit button - Form sẽ được submit từ footer của OnboardingWrapper */}
      <button type="submit" className="hidden" />
    </form>
  );
};
</file>

<file path="src/components/onboarding/steps/SkillsStep.jsx">
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useState } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Plus, X, Briefcase } from 'lucide-react';
import { skillsSchema } from '@/schemas/onboardingSchemas';
import { InlineError } from '../ErrorState';
import { popularSkills } from '@/constants/skills';
import { JOB_CATEGORIES, POPULAR_CATEGORIES } from '@/constants/jobCategories';

export const SkillsStep = ({ initialData = {}, onNext, isLoading, onLoadingChange }) => {
  const [selectedSkills, setSelectedSkills] = useState(initialData.skills || []);
  const [selectedCategories, setSelectedCategories] = useState(initialData.preferredCategories || []);
  const [customSkill, setCustomSkill] = useState('');

  const {
    handleSubmit,
    formState: { errors },
    setValue
  } = useForm({
    resolver: zodResolver(skillsSchema),
    defaultValues: {
      skills: initialData.skills || [],
      preferredCategories: initialData.preferredCategories || [],
      customSkills: initialData.customSkills || []
    }
  });

  const toggleSkill = (skill) => {
    let updated;
    if (selectedSkills.includes(skill)) {
      updated = selectedSkills.filter(s => s !== skill);
    } else {
      if (selectedSkills.length >= 20) return;
      updated = [...selectedSkills, skill];
    }
    setSelectedSkills(updated);
    setValue('skills', updated);
  };

  const toggleCategory = (categoryValue) => {
    let updated;
    if (selectedCategories.includes(categoryValue)) {
      updated = selectedCategories.filter(c => c !== categoryValue);
    } else {
      if (selectedCategories.length >= 5) return; // Max 5 categories
      updated = [...selectedCategories, categoryValue];
    }
    setSelectedCategories(updated);
    setValue('preferredCategories', updated);
  };

  const addCustomSkill = () => {
    if (!customSkill.trim()) return;
    if (selectedSkills.length >= 20) return;
    if (selectedSkills.includes(customSkill.trim())) return;

    const updated = [...selectedSkills, customSkill.trim()];
    setSelectedSkills(updated);
    setValue('skills', updated);
    setCustomSkill('');
  };

  const onSubmit = (data) => {
    onNext(data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* Preferred Categories */}
      <Card>
        <CardHeader>
          <CardTitle className="flex items-center gap-2">
            <Briefcase className="w-5 h-5" />
            Ngành nghề mong muốn
          </CardTitle>
          <CardDescription>
            Chọn ít nhất 1 ngành nghề bạn quan tâm (tối đa 5)
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* Selected Categories */}
          {selectedCategories.length > 0 && (
            <div className="flex flex-wrap gap-2 p-3 bg-muted rounded-lg">
              {selectedCategories.map((catValue) => {
                const category = JOB_CATEGORIES.find(c => c.value === catValue);
                return (
                  <Badge
                    key={catValue}
                    variant="secondary"
                    className="px-3 py-1.5 text-sm cursor-pointer hover:bg-destructive hover:text-destructive-foreground"
                    onClick={() => toggleCategory(catValue)}
                  >
                    <span className="mr-1">{category?.icon}</span>
                    {category?.label}
                    <X className="w-3 h-3 ml-1.5" />
                  </Badge>
                );
              })}
            </div>
          )}

          {/* Categories Counter */}
          <div className="text-sm text-muted-foreground">
            Đã chọn: {selectedCategories.length}/5 ngành nghề
            {selectedCategories.length < 1 && (
              <span className="text-destructive ml-2">
                (Cần chọn ít nhất 1 ngành nghề)
              </span>
            )}
          </div>

          {/* Popular Categories */}
          <div>
            <Label className="text-sm font-medium mb-2 block">Ngành nghề phổ biến</Label>
            <div className="flex flex-wrap gap-2">
              {POPULAR_CATEGORIES.map((catValue) => {
                const category = JOB_CATEGORIES.find(c => c.value === catValue);
                return (
                  <Badge
                    key={catValue}
                    variant={selectedCategories.includes(catValue) ? 'default' : 'outline'}
                    className="cursor-pointer hover:bg-primary hover:text-primary-foreground px-3 py-1.5"
                    onClick={() => toggleCategory(catValue)}
                  >
                    <span className="mr-1">{category?.icon}</span>
                    {category?.label}
                  </Badge>
                );
              })}
            </div>
          </div>

          {/* All Categories Grid */}
          <div>
            <Label className="text-sm font-medium mb-2 block">Tất cả ngành nghề</Label>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-2 max-h-[300px] overflow-y-auto p-2 border rounded-lg">
              {JOB_CATEGORIES.map((category) => (
                <Badge
                  key={category.value}
                  variant={selectedCategories.includes(category.value) ? 'default' : 'outline'}
                  className="cursor-pointer hover:bg-primary hover:text-primary-foreground justify-start text-left px-3 py-2"
                  onClick={() => toggleCategory(category.value)}
                >
                  <span className="mr-2">{category.icon}</span>
                  <span className="text-xs">{category.label}</span>
                </Badge>
              ))}
            </div>
          </div>

          <InlineError message={errors.preferredCategories?.message} />
        </CardContent>
      </Card>

      {/* Skills Selection */}
      <Card>
        <CardHeader>
          <CardTitle>Kỹ năng của bạn</CardTitle>
          <CardDescription>
            Chọn ít nhất 3 kỹ năng chuyên môn của bạn (tối đa 20)
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          {/* Selected Skills */}
          {selectedSkills.length > 0 && (
            <div className="flex flex-wrap gap-2 p-3 bg-muted rounded-lg">
              {selectedSkills.map((skill) => (
                <Badge
                  key={skill}
                  variant="secondary"
                  className="px-3 py-1 cursor-pointer hover:bg-destructive hover:text-destructive-foreground"
                  onClick={() => toggleSkill(skill)}
                >
                  {skill}
                  <X className="w-3 h-3 ml-1" />
                </Badge>
              ))}
            </div>
          )}

          {/* Skills Counter */}
          <div className="text-sm text-muted-foreground">
            Đã chọn: {selectedSkills.length}/20 kỹ năng
            {selectedSkills.length < 3 && (
              <span className="text-destructive ml-2">
                (Cần thêm {3 - selectedSkills.length} kỹ năng)
              </span>
            )}
          </div>

          {/* Popular Skills */}
          <div>
            <Label className="text-sm font-medium mb-2 block">Kỹ năng phổ biến</Label>
            <div className="flex flex-wrap gap-2">
              {popularSkills.map((skill) => (
                <Badge
                  key={skill}
                  variant={selectedSkills.includes(skill) ? 'default' : 'outline'}
                  className="cursor-pointer hover:bg-primary hover:text-primary-foreground"
                  onClick={() => toggleSkill(skill)}
                >
                  {skill}
                </Badge>
              ))}
            </div>
          </div>

          {/* Custom Skill Input */}
          <div className="space-y-2">
            <Label>Thêm kỹ năng khác</Label>
            <div className="flex gap-2">
              <Input
                value={customSkill}
                onChange={(e) => setCustomSkill(e.target.value)}
                placeholder="Nhập kỹ năng..."
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    addCustomSkill();
                  }
                }}
              />
              <Button
                type="button"
                variant="outline"
                onClick={addCustomSkill}
                disabled={!customSkill.trim() || selectedSkills.length >= 20}
              >
                <Plus className="w-4 h-4" />
              </Button>
            </div>
            <p className="text-xs text-muted-foreground">
              Nhấn Enter hoặc click nút + để thêm kỹ năng
            </p>
          </div>

          <InlineError message={errors.skills?.message} />
        </CardContent>
      </Card>

      {/* Hidden submit button - Form sẽ được submit từ footer của OnboardingWrapper */}
      <button type="submit" className="hidden" />
    </form>
  );
};
</file>

<file path="src/components/profile/CertificatesSection.jsx">
import { useState, useCallback } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Plus, Edit2, Trash2, Award, ExternalLink, Save, X } from 'lucide-react';
import { toast } from 'sonner';

const CertificateForm = ({ formData, onFormChange, onCancel, onSave, isUpdating }) => {
  return (
    <div className="space-y-4 p-4 border rounded-lg bg-card">
      <div>
        <Label htmlFor="name">Tên chứng chỉ <span className="text-destructive">*</span></Label>
        <Input
          id="name"
          value={formData.name}
          onChange={(e) => onFormChange('name', e.target.value)}
          placeholder="VD: AWS Certified Solutions Architect"
        />
      </div>

      <div>
        <Label htmlFor="issuer">Đơn vị cấp <span className="text-destructive">*</span></Label>
        <Input
          id="issuer"
          value={formData.issuer}
          onChange={(e) => onFormChange('issuer', e.target.value)}
          placeholder="VD: Amazon Web Services"
        />
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div>
          <Label htmlFor="issueDate">Ngày cấp <span className="text-destructive">*</span></Label>
          <Input
            id="issueDate"
            type="month"
            value={formData.issueDate}
            onChange={(e) => onFormChange('issueDate', e.target.value)}
          />
        </div>
        <div>
          <Label htmlFor="expiryDate">Ngày hết hạn</Label>
          <Input
            id="expiryDate"
            type="month"
            value={formData.expiryDate}
            onChange={(e) => onFormChange('expiryDate', e.target.value)}
          />
        </div>
      </div>

      <div>
        <Label htmlFor="credentialId">Mã chứng chỉ</Label>
        <Input
          id="credentialId"
          value={formData.credentialId}
          onChange={(e) => onFormChange('credentialId', e.target.value)}
          placeholder="VD: ABC123XYZ"
        />
      </div>

      <div>
        <Label htmlFor="url">Link xác thực</Label>
        <Input
          id="url"
          type="url"
          value={formData.url}
          onChange={(e) => onFormChange('url', e.target.value)}
          placeholder="https://..."
        />
      </div>

      <div className="flex gap-2 justify-end">
        <Button variant="outline" onClick={onCancel} disabled={isUpdating}>
          <X className="w-4 h-4 mr-2" />
          Hủy
        </Button>
        <Button onClick={onSave} disabled={isUpdating}>
          <Save className="w-4 h-4 mr-2" />
          {isUpdating ? 'Đang lưu...' : 'Lưu'}
        </Button>
      </div>
    </div>
  );
};

export const CertificatesSection = ({ certificates = [], onUpdate }) => {
  const [isAdding, setIsAdding] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [currentCertificateFormData, setCurrentCertificateFormData] = useState({
    name: '',
    issuer: '',
    issueDate: '',
    expiryDate: '',
    credentialId: '',
    url: ''
  });
  const [isUpdating, setIsUpdating] = useState(false);

  const handleFormChange = useCallback((field, value) => {
    setCurrentCertificateFormData(prev => ({ ...prev, [field]: value }));
  }, []);

  const formatDate = (dateString) => {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('vi-VN', { month: '2-digit', year: 'numeric' });
  };

  const handleAdd = () => {
    setCurrentCertificateFormData({
      name: '',
      issuer: '',
      issueDate: '',
      expiryDate: '',
      credentialId: '',
      url: ''
    });
    setIsAdding(true);
    setEditingId(null);
  };

  const handleEdit = (cert) => {
    setEditingId(cert._id);
    setCurrentCertificateFormData({
      ...cert,
      issueDate: cert.issueDate ? new Date(cert.issueDate).toISOString().split('T')[0] : '',
      expiryDate: cert.expiryDate ? new Date(cert.expiryDate).toISOString().split('T')[0] : ''
    });
    setIsAdding(false);
  };

  const handleCancel = () => {
    setIsAdding(false);
    setEditingId(null);
    setCurrentCertificateFormData({
      name: '',
      issuer: '',
      issueDate: '',
      expiryDate: '',
      credentialId: '',
      url: ''
    });
  };

  const handleSave = async () => {
    if (!currentCertificateFormData.name || !currentCertificateFormData.issuer || !currentCertificateFormData.issueDate) {
      toast.error('Vui lòng điền đầy đủ thông tin bắt buộc');
      return;
    }

    try {
      setIsUpdating(true);
      let updatedCertificates;

      if (isAdding) {
        updatedCertificates = [...certificates, currentCertificateFormData];
      } else {
        updatedCertificates = certificates.map(cert =>
          cert._id === editingId ? { ...cert, ...currentCertificateFormData } : cert
        );
      }

      await onUpdate({ certificates: updatedCertificates });
      toast.success(isAdding ? 'Thêm chứng chỉ thành công' : 'Cập nhật chứng chỉ thành công');
      handleCancel(); // Reset form and editing state
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  const handleDelete = async (certId) => {
    if (!window.confirm('Bạn có chắc chắn muốn xóa chứng chỉ này?')) return;

    try {
      setIsUpdating(true);
      const updatedCertificates = certificates.filter(cert => cert._id !== certId);
      await onUpdate({ certificates: updatedCertificates });
      toast.success('Xóa chứng chỉ thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between">
        <CardTitle className="flex items-center gap-2">
          <Award className="w-5 h-5" />
          Chứng chỉ
        </CardTitle>
        {!isAdding && !editingId && (
          <Button onClick={handleAdd} size="sm">
            <Plus className="w-4 h-4 mr-2" />
            Thêm chứng chỉ
          </Button>
        )}
      </CardHeader>
      <CardContent>
        {isAdding && (
          <CertificateForm
            formData={currentCertificateFormData}
            onFormChange={handleFormChange}
            onCancel={handleCancel}
            onSave={handleSave}
            isUpdating={isUpdating}
          />
        )}

        {certificates.length === 0 && !isAdding ? (
          <div className="text-center py-8 text-muted-foreground">
            <Award className="w-12 h-12 mx-auto mb-3 opacity-50" />
            <p>Chưa có chứng chỉ nào</p>
            <p className="text-sm mt-1">Thêm chứng chỉ để tăng uy tín với nhà tuyển dụng</p>
          </div>
        ) : (
          <div className="space-y-4">
            {certificates.map((cert) => (
              <div key={cert._id} className="space-y-2">
                {editingId === cert._id ? (
                  <CertificateForm
                    formData={currentCertificateFormData}
                    onFormChange={handleFormChange}
                    onCancel={handleCancel}
                    onSave={handleSave}
                    isUpdating={isUpdating}
                  />
                ) : (
                  <div className="border-l-2 border-primary/20 pl-4 pb-4">
                    <div className="flex justify-between items-start">
                      <div className="flex-1">
                        <h4 className="font-semibold text-lg text-foreground">{cert.name}</h4>
                        <p className="text-sm text-muted-foreground">{cert.issuer}</p>
                        <div className="flex items-center gap-4 mt-2 text-sm text-muted-foreground">
                          <span>Cấp: {formatDate(cert.issueDate)}</span>
                          {cert.expiryDate && (
                            <span>Hết hạn: {formatDate(cert.expiryDate)}</span>
                          )}
                        </div>
                        {cert.credentialId && (
                          <p className="text-xs text-muted-foreground mt-1">
                            Mã: {cert.credentialId}
                          </p>
                        )}
                        {cert.url && (
                          <a
                            href={cert.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-xs text-primary hover:underline flex items-center gap-1 mt-1"
                          >
                            Xem chứng chỉ <ExternalLink className="w-3 h-3" />
                          </a>
                        )}
                      </div>
                      <div className="flex gap-2">
                        <Button
                          size="sm"
                          variant="ghost"
                          onClick={() => handleEdit(cert)}
                          disabled={isUpdating}
                        >
                          <Edit2 className="w-4 h-4" />
                        </Button>
                        <Button
                          size="sm"
                          variant="ghost"
                          className="text-destructive hover:text-destructive"
                          onClick={() => handleDelete(cert._id)}
                          disabled={isUpdating}
                        >
                          <Trash2 className="w-4 h-4 text-destructive" />
                        </Button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/profile/ProfileCompletenessTest.jsx">
// Test component để verify profileCompleteness display
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';

export const ProfileCompletenessTest = ({ profile }) => {
  const data = profile?.profileCompleteness;

  return (
    <Card className="border-2 border-blue-500">
      <CardHeader>
        <CardTitle className="text-lg">
          {'✓ Profile Completeness'}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="text-center">
          <div className="text-5xl font-bold text-blue-600 mb-2">
            {data.percentage}%
          </div>
          <Progress value={data.percentage} className="h-3" />
        </div>

        <div className="space-y-2 text-sm">
          <div className="flex justify-between">
            <span>Has Basic Info:</span>
            <span className="font-bold">{data.hasBasicInfo ? '✓' : '✗'}</span>
          </div>
          <div className="flex justify-between">
            <span>Has Skills (≥3):</span>
            <span className="font-bold">{data.hasSkills ? '✓' : '✗'}</span>
          </div>
          <div className="flex justify-between">
            <span>Has CV:</span>
            <span className="font-bold">{data.hasCV ? '✓' : '✗'}</span>
          </div>
          <div className="flex justify-between">
            <span>Has Experience:</span>
            <span className="font-bold">{data.hasExperience ? '✓' : '✗'}</span>
          </div>
          <div className="flex justify-between">
            <span>Has Education:</span>
            <span className="font-bold">{data.hasEducation ? '✓' : '✗'}</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/profile/ProfileCompletionBanner.jsx">
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { TrendingUp, CheckCircle2 } from 'lucide-react';
import { cn } from '@/lib/utils';

export const ProfileCompletionBanner = ({ profileCompleteness, profile }) => {
  // Debug log
  console.log('ProfileCompletionBanner received:', profileCompleteness);
  
  // If backend doesn't return profileCompleteness, calculate it on frontend
  let data = profileCompleteness;
  
  if (!data && profile) {
    console.log('Calculating profileCompleteness on frontend for banner');
    data = {
      hasBasicInfo: !!(profile.phone && profile.bio && profile.avatar),
      hasExperience: (profile.experiences || []).length > 0,
      hasEducation: (profile.educations || []).length > 0,
      hasSkills: (profile.skills || []).length >= 3,
      hasCV: (profile.cvs || []).length > 0,
      percentage: 0
    };
    
    // Calculate percentage
    const weights = {
      hasBasicInfo: 40,
      hasSkills: 15,
      hasCV: 15,
      hasExperience: 15,
      hasEducation: 15
    };
    
    data.percentage = Math.round(
      (data.hasBasicInfo ? weights.hasBasicInfo : 0) +
      (data.hasSkills ? weights.hasSkills : 0) +
      (data.hasCV ? weights.hasCV : 0) +
      (data.hasExperience ? weights.hasExperience : 0) +
      (data.hasEducation ? weights.hasEducation : 0)
    );
  }
  
  if (!data) {
    console.log('No profileCompleteness data - returning null');
    return null;
  }

  const { percentage = 0 } = data;

  // Don't show if 100% complete
  if (percentage === 100) {
    return (
      <div className="bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-950/20 dark:to-teal-950/20 rounded-lg p-4 border border-emerald-200 dark:border-emerald-800">
        <div className="flex items-center gap-3">
          <CheckCircle2 className="w-8 h-8 text-emerald-600 flex-shrink-0" />
          <div className="flex-1">
            <h3 className="text-lg font-semibold text-emerald-900 dark:text-emerald-100">
              🎉 Hồ sơ hoàn chỉnh!
            </h3>
            <p className="text-sm text-emerald-700 dark:text-emerald-300 mt-0.5">
              Hồ sơ của bạn đã được hoàn thiện 100%. Bạn có thể bắt đầu ứng tuyển ngay!
            </p>
          </div>
        </div>
      </div>
    );
  }

  const getColorClass = (pct) => {
    if (pct >= 70) return 'from-blue-50 to-indigo-50 dark:from-blue-950/20 dark:to-indigo-950/20 border-blue-200 dark:border-blue-800';
    if (pct >= 40) return 'from-amber-50 to-orange-50 dark:from-amber-950/20 dark:to-orange-950/20 border-amber-200 dark:border-amber-800';
    return 'from-rose-50 to-pink-50 dark:from-rose-950/20 dark:to-pink-950/20 border-rose-200 dark:border-rose-800';
  };

  const getTextColor = (pct) => {
    if (pct >= 70) return 'text-blue-900 dark:text-blue-100';
    if (pct >= 40) return 'text-amber-900 dark:text-amber-100';
    return 'text-rose-900 dark:text-rose-100';
  };

  const getMutedTextColor = (pct) => {
    if (pct >= 70) return 'text-blue-700 dark:text-blue-300';
    if (pct >= 40) return 'text-amber-700 dark:text-amber-300';
    return 'text-rose-700 dark:text-rose-300';
  };

  const getIconColor = (pct) => {
    if (pct >= 70) return 'text-blue-600';
    if (pct >= 40) return 'text-amber-600';
    return 'text-rose-600';
  };

  const missingItems = [];
  if (!data.hasBasicInfo) missingItems.push('thông tin cơ bản');
  if (!data.hasSkills) missingItems.push('kỹ năng');
  if (!data.hasCV) missingItems.push('CV');

  return (
    <div className={cn(
      "bg-gradient-to-r rounded-lg p-4 border",
      getColorClass(percentage)
    )}>
      <div className="flex items-start gap-3">
        <TrendingUp className={cn("w-6 h-6 flex-shrink-0 mt-0.5", getIconColor(percentage))} />
        <div className="flex-1 min-w-0">
          <div className="flex items-center justify-between gap-4 mb-2">
            <h3 className={cn("text-base font-semibold", getTextColor(percentage))}>
              Hồ sơ chưa hoàn chỉnh
            </h3>
            <Badge 
              variant="secondary" 
              className={cn("font-bold text-sm", getTextColor(percentage))}
            >
              {percentage}%
            </Badge>
          </div>
          
          <Progress value={percentage} className="h-2 mb-2" />
          
          <p className={cn("text-sm", getMutedTextColor(percentage))}>
            {missingItems.length > 0 ? (
              <>
                Còn thiếu: <strong>{missingItems.join(', ')}</strong>. 
                Hoàn thiện hồ sơ để tăng cơ hội được tuyển dụng lên đến 70%!
              </>
            ) : (
              <>
                Thêm kinh nghiệm và học vấn để hồ sơ của bạn nổi bật hơn!
              </>
            )}
          </p>
        </div>
      </div>
    </div>
  );
};
</file>

<file path="src/components/sections/HowItWorks.jsx">
import { UserPlus, Search, FileText, CheckCircle } from 'lucide-react';
import { Card, CardContent } from '../ui/card';
import { SectionHeader } from '../common/SectionHeader';

const steps = [
  {
    icon: <UserPlus className="h-10 w-10" />,
    title: 'Tạo tài khoản',
    description: 'Đăng ký miễn phí và tạo hồ sơ chuyên nghiệp của bạn',
    color: 'from-emerald-500 to-teal-500',
    step: '01'
  },
  {
    icon: <Search className="h-10 w-10" />,
    title: 'Tìm kiếm việc làm',
    description: 'Khám phá hàng nghìn cơ hội việc làm phù hợp với bạn',
    color: 'from-blue-500 to-cyan-500',
    step: '02'
  },
  {
    icon: <FileText className="h-10 w-10" />,
    title: 'Nộp hồ sơ',
    description: 'Ứng tuyển nhanh chóng với CV được tối ưu hóa',
    color: 'from-purple-500 to-pink-500',
    step: '03'
  },
  {
    icon: <CheckCircle className="h-10 w-10" />,
    title: 'Nhận việc làm',
    description: 'Nhận phản hồi và bắt đầu sự nghiệp mới của bạn',
    color: 'from-orange-500 to-red-500',
    step: '04'
  }
];

const HowItWorks = () => {
  return (
    <section className="py-20 bg-gradient-to-b from-muted/30 to-background relative overflow-hidden">
      {/* Background decoration */}
      <div className="absolute top-0 left-0 w-full h-full opacity-5 dark:opacity-10">
        <div className="absolute top-20 left-10 w-72 h-72 bg-emerald-500 rounded-full blur-3xl"></div>
        <div className="absolute bottom-20 right-10 w-96 h-96 bg-blue-500 rounded-full blur-3xl"></div>
      </div>

      <div className="container relative z-10">
        <SectionHeader
          badgeText="🚀 Quy trình đơn giản"
          title={<>Cách thức <span className="bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">hoạt động</span></>}
          description="Chỉ với 4 bước đơn giản, bạn có thể tìm được công việc mơ ước"
          className="mb-16"
        />

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 relative">
          {/* Connection lines for desktop */}
          <div className="hidden lg:block absolute top-20 left-0 right-0 h-0.5 bg-gradient-to-r from-emerald-200 via-blue-200 to-orange-200"></div>

          {steps.map((step, index) => (
            <div key={index} className="relative">
              <Card className="border-0 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 bg-card">
                <CardContent className="p-8 text-center">
                  {/* Step number */}
                  <div className="absolute -top-4 -right-4 w-12 h-12 bg-gradient-to-br from-muted to-muted/80 rounded-full flex items-center justify-center font-bold text-muted-foreground shadow-md">
                    {step.step}
                  </div>

                  {/* Icon */}
                  <div className={`inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br ${step.color} text-white mb-6 shadow-lg`}>
                    {step.icon}
                  </div>

                  {/* Content */}
                  <h3 className="text-xl font-bold text-foreground mb-3">
                    {step.title}
                  </h3>
                  <p className="text-muted-foreground leading-relaxed">
                    {step.description}
                  </p>
                </CardContent>
              </Card>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

export default HowItWorks;
</file>

<file path="src/components/sections/JobSearchIntegratedSection.jsx">
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { toast } from 'sonner';
import {
  Search, Building, MapPin, DollarSign, Clock, Users, TrendingUp, Star,
  Heart, ChevronRight, Sparkles, Briefcase, Building2, ArrowRight, CheckCircle2
} from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from '../ui/card';
import { Button } from '../ui/button';
import { Badge } from '../ui/badge';
import { Input } from '../ui/input';
import { Avatar, AvatarImage, AvatarFallback } from '../ui/avatar';
import { Skeleton } from '../ui/skeleton';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../ui/select';
import { getAllJobs } from '../../services/jobService';
import { saveJob, unsaveJob } from '../../services/jobService';
import { formatSalary, formatTimeAgo } from '../../utils/formatters';

const JobSearchSection = () => {
  const navigate = useNavigate();
  
  // State for featured jobs
  const [featuredJobs, setFeaturedJobs] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);
  
  // Filter states
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedLocation, setSelectedLocation] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('');

  // Filter options
  const locations = [
    'Hà Nội', 'TP. Hồ Chí Minh', 'Đà Nẵng', 'Hải Phòng', 'Cần Thơ',
    'Biên Hòa', 'Nha Trang', 'Huế', 'Buôn Ma Thuột', 'Vũng Tàu'
  ];

  const categories = [
    'Công nghệ thông tin', 'Marketing', 'Kinh doanh', 'Tài chính - Ngân hàng',
    'Nhân sự', 'Kế toán', 'Thiết kế', 'Giáo dục', 'Y tế', 'Xây dựng'
  ];

  // Fetch featured jobs
  useEffect(() => {
    const fetchFeaturedJobs = async () => {
      try {
        setIsLoading(true);
        const response = await getAllJobs({ 
          page: 1, 
          limit: 6,
          featured: true 
        });
        setFeaturedJobs(response.data || []);
      } catch (err) {
        console.error('Error fetching featured jobs:', err);
        setError('Không thể tải danh sách việc làm nổi bật');
      } finally {
        setIsLoading(false);
      }
    };

    fetchFeaturedJobs();
  }, []);

  // Handle search
  const handleSearch = () => {
    const params = new URLSearchParams();
    if (searchTerm) params.set('query', searchTerm);
    if (selectedLocation) params.set('province', selectedLocation);
    if (selectedCategory) params.set('category', selectedCategory);

    navigate(`/jobs/search?${params.toString()}`);
  };

  // Handle save/unsave job
  const handleSaveJob = async (jobId, isSaved) => {
    try {
      if (isSaved) {
        await unsaveJob(jobId);
        toast.success('Đã bỏ lưu công việc');
      } else {
        await saveJob(jobId);
        toast.success('Đã lưu công việc');
      }
      
      // Update the job in state
      setFeaturedJobs(prevJobs => 
        prevJobs.map(job => 
          job.id === jobId ? { ...job, isSaved: !isSaved } : job
        )
      );
    } catch (err) {
      console.error('Error saving job:', err);
      toast.error('Có lỗi xảy ra khi lưu công việc');
    }
  };

  // Removed local format functions - now using utils/formatters.js

  return (
    <section className="py-20 bg-background">
      <div className="container px-4">
        {/* Header */}
        <div className="text-center mb-12">
          <h2 className="text-3xl lg:text-4xl font-bold text-foreground mb-4">
            Tìm kiếm công việc
            <br />
            <span className="text-primary">định hình tương lai của bạn</span>
          </h2>
          <p className="text-muted-foreground text-lg max-w-2xl mx-auto">
            Khám phá cơ hội nghề nghiệp tuyệt vời từ các công ty hàng đầu và bắt đầu hành trình sự nghiệp của bạn ngay hôm nay
          </p>
        </div>

        {/* Search Filters */}
        <div className="max-w-4xl mx-auto mb-12">
          <Card className="shadow-lg border-0 bg-white">
            <CardContent className="p-6">
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div className="relative">
                  <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-5 w-5" />
                  <Input
                    type="text"
                    placeholder="Tìm kiếm công việc..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="pl-10 h-12 border-border focus:border-primary"
                    onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                  />
                </div>
                
                <Select value={selectedLocation} onValueChange={setSelectedLocation}>
                  <SelectTrigger className="h-12 border-border">
                    <SelectValue placeholder="Địa điểm" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="">Tất cả địa điểm</SelectItem>
                    {locations.map((location) => (
                      <SelectItem key={location} value={location}>
                        {location}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>

                <Select value={selectedCategory} onValueChange={setSelectedCategory}>
                  <SelectTrigger className="h-12 border-border">
                    <SelectValue placeholder="Lĩnh vực" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="">Tất cả lĩnh vực</SelectItem>
                    {categories.map((category) => (
                      <SelectItem key={category} value={category}>
                        {category}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>

                <Button 
                  onClick={handleSearch}
                  className="h-12 bg-primary hover:bg-primary/90 text-primary-foreground font-semibold"
                >
                  <Search className="mr-2 h-5 w-5" />
                  Tìm kiếm
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Featured Jobs */}
        <div className="mb-12">
          <div className="flex items-center justify-between mb-8">
            <div>
              <h3 className="text-2xl font-bold text-foreground mb-2">Việc làm nổi bật</h3>
              <p className="text-muted-foreground">Những cơ hội nghề nghiệp tốt nhất dành cho bạn</p>
            </div>
            <Button
              variant="outline"
              onClick={() => navigate('/jobs/search')}
              className="hidden sm:flex items-center gap-2"
            >
              Xem tất cả
              <ArrowRight className="h-4 w-4" />
            </Button>
          </div>

          {/* Jobs Grid */}
          {isLoading ? (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {[...Array(6)].map((_, index) => (
                <Card key={index} className="overflow-hidden">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex items-center gap-3">
                        <Skeleton className="h-12 w-12 rounded-lg" />
                        <div>
                          <Skeleton className="h-4 w-32 mb-2" />
                          <Skeleton className="h-3 w-24" />
                        </div>
                      </div>
                      <Skeleton className="h-8 w-8 rounded-full" />
                    </div>
                    <Skeleton className="h-6 w-full mb-2" />
                    <Skeleton className="h-4 w-3/4 mb-4" />
                    <div className="flex gap-2 mb-4">
                      <Skeleton className="h-6 w-16 rounded-full" />
                      <Skeleton className="h-6 w-20 rounded-full" />
                    </div>
                    <Skeleton className="h-10 w-full" />
                  </CardContent>
                </Card>
              ))}
            </div>
          ) : error ? (
            <Card className="text-center py-12">
              <CardContent>
                <AlertCircle className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
                <h3 className="text-lg font-semibold text-foreground mb-2">Có lỗi xảy ra</h3>
                <p className="text-muted-foreground">{error}</p>
              </CardContent>
            </Card>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {featuredJobs.map((job) => (
                <Card 
                  key={job.id} 
                  className="group hover:shadow-xl transition-all duration-300 cursor-pointer border-0 shadow-md hover:shadow-primary/10"
                  onClick={() => navigate(`/jobs/${job.id}`)}
                >
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between mb-4">
                      <div className="flex items-center gap-3">
                        <Avatar className="h-12 w-12">
                          <AvatarImage 
                            src={job.company?.logo} 
                            alt={job.company?.name}
                            className="object-cover"
                          />
                          <AvatarFallback className="bg-primary/10 text-primary font-semibold">
                            {job.company?.name?.charAt(0)}
                          </AvatarFallback>
                        </Avatar>
                        <div>
                          <h4 className="font-semibold text-foreground text-sm">
                            {job.company?.name}
                          </h4>
                          <div className="flex items-center gap-1 text-xs text-muted-foreground">
                            <MapPin className="h-3 w-3" />
                            {job.location}
                          </div>
                        </div>
                      </div>
                      <Button
                        variant="ghost"
                        size="sm"
                        className="p-2 hover:bg-red-50 hover:text-red-500"
                        onClick={(e) => {
                          e.stopPropagation();
                          handleSaveJob(job.id, job.isSaved);
                        }}
                      >
                        <Heart 
                          className={`h-5 w-5 ${job.isSaved ? 'fill-red-500 text-red-500' : 'text-muted-foreground'}`} 
                        />
                      </Button>
                    </div>

                    <h3 className="font-bold text-lg text-foreground mb-2 group-hover:text-primary transition-colors">
                      {job.title}
                    </h3>
                    
                    <p className="text-muted-foreground text-sm mb-4 line-clamp-2">
                      {job.description}
                    </p>

                    <div className="flex gap-2 mb-4 flex-wrap">
                      <Badge variant="secondary" className="text-xs">
                        <Briefcase className="h-3 w-3 mr-1" />
                        {job.type}
                      </Badge>
                      <Badge variant="outline" className="text-xs">
                        <DollarSign className="h-3 w-3 mr-1" />
                        {formatSalary(job.salaryMin || job.minSalary, job.salaryMax || job.maxSalary)}
                      </Badge>
                    </div>

                    <div className="flex items-center justify-between text-xs text-muted-foreground mb-4">
                      <div className="flex items-center gap-2">
                        <Clock className="h-3 w-3" />
                        {formatTimeAgo(job.createdAt)}
                      </div>
                      {job.applicants && (
                        <div className="flex items-center gap-1">
                          <Users className="h-3 w-3" />
                          {job.applicants} ứng viên
                        </div>
                      )}
                    </div>

                    <Button 
                      className="w-full bg-primary hover:bg-primary/90 text-primary-foreground"
                      onClick={(e) => {
                        e.stopPropagation();
                        navigate(`/jobs/${job.id}`);
                      }}
                    >
                      Xem chi tiết
                      <ArrowRight className="ml-2 h-4 w-4" />
                    </Button>
                  </CardContent>
                </Card>
              ))}
            </div>
          )}
        </div>

        {/* View All Button for Mobile */}
        <div className="text-center sm:hidden">
          <Button
            onClick={() => navigate('/jobs/search')}
            className="bg-primary hover:bg-primary/90 text-primary-foreground"
          >
            Xem tất cả việc làm
            <ArrowRight className="ml-2 h-4 w-4" />
          </Button>
        </div>
      </div>
    </section>
  );
};

export default JobSearchSection;
</file>

<file path="src/components/sections/NewsletterBanner.jsx">
import { Mail, Check } from 'lucide-react';
import { Input } from '../ui/input';
import { Button } from '../ui/button';

const NewsletterBanner = () => {
  return (
    <section className="relative bg-linear-to-r from-green-500 via-teal-500 to-blue-600 py-20">
      {/* Background pattern overlay */}
      <div className="absolute inset-0 opacity-10">
        <div className="absolute inset-0" style={{
          backgroundImage: `radial-gradient(circle at 2px 2px, white 1px, transparent 0)`,
          backgroundSize: '30px 30px'
        }}></div>
      </div>
      
      <div className="container relative z-10 px-4">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center max-w-7xl mx-auto">
          
          {/* Left Content */}
          <div className="text-white">
            <div className="flex items-center mb-6">
              <Mail className="h-8 w-8 mr-3" />
              <div className="h-1 w-12 bg-white/30 rounded"></div>
            </div>
            
            <h2 className="text-3xl lg:text-4xl font-bold mb-4 leading-tight">
              Nhận thông báo về <span className="text-teal-200">việc làm mới nhất</span>
            </h2>
            
            <p className="text-lg text-white/90 mb-8 leading-relaxed">
              Đăng ký nhận bản tin của chúng tôi để cập nhật những cơ hội việc làm 
              mới nhất và nhận các mẹo hữu ích để phát triển sự nghiệp của bạn.
            </p>
            
            {/* Features List */}
            <div className="space-y-4 mb-8">
              <div className="flex items-center">
                <Check className="h-5 w-5 mr-3 text-teal-200" />
                <span className="text-white/90">Nhận thông báo về các vị trí việc làm mới nhất phù hợp với bạn</span>
              </div>
              <div className="flex items-center">
                <Check className="h-5 w-5 mr-3 text-teal-200" />
                <span className="text-white/90">Cập nhật tin tức và xu hướng thị trường lao động</span>
              </div>
              <div className="flex items-center">
                <Check className="h-5 w-5 mr-3 text-teal-200" />
                <span className="text-white/90">Chia sẻ mẹo và bí quyết tìm việc thành công</span>
              </div>
              <div className="flex items-center">
                <Check className="h-5 w-5 mr-3 text-teal-200" />
                <span className="text-white/90">Hoàn toàn miễn phí và dễ dàng hủy đăng ký bất kỳ lúc nào</span>
              </div>
            </div>
            
            {/* Newsletter Signup */}
            <div className="flex flex-col sm:flex-row gap-4 max-w-md">
              <Input
                type="email"
                placeholder="Email của bạn"
                className="flex-1 h-12 bg-white/10 border-white/20 text-white placeholder:text-white/60 focus:border-white/40 focus:ring-2 focus:ring-white/20 backdrop-blur-sm"
              />
              <Button 
                className="h-12 bg-white text-blue-600 hover:bg-white/90 font-semibold px-8 whitespace-nowrap"
              >
                Đăng ký ngay →
              </Button>
            </div>
            
            <p className="text-sm text-white/70 mt-4">
              Bằng cách đăng ký, bạn đồng ý với{' '}
              <a href="#" className="underline hover:text-white">chính sách bảo mật</a> của chúng tôi.
            </p>
          </div>
          
          {/* Right Content */}
          <div className="text-center">
            <div className="bg-white/10 backdrop-blur-sm rounded-3xl p-8 border border-white/20">
              <h3 className="text-2xl lg:text-3xl font-bold text-white mb-4">
                Tăng 70% cơ hội tìm việc
              </h3>
              <p className="text-lg text-white/90 leading-relaxed">
                Những người đăng ký nhận thông báo việc làm có khả năng tìm được công việc 
                phù hợp cao hơn 70% so với những người không đăng ký.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
  );
};

export default NewsletterBanner;
</file>

<file path="src/components/sections/NewsletterSection.jsx">
import { Mail, ArrowRight, CheckCircle } from 'lucide-react';
import { Card, CardContent } from '../ui/card';
import { Input } from '../ui/input';
import { Button } from '../ui/button';

const features = [
  'Nhận thông báo về các vị trí việc làm mới nhất phù hợp với bạn',
  'Cập nhật tin tức và xu hướng thị trường lao động',
  'Chia sẻ mẹo và bí quyết tìm việc thành công',
  'Hoàn toàn miễn phí và dễ dàng hủy đăng ký bất kỳ lúc nào'
];

const NewsletterSection = () => {
  return (
    <section className="py-20 bg-primary/5">
      <div className="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6">
        <Card className="shadow-xl border-0 overflow-hidden bg-background">
          <CardContent className="p-0">
            <div className="grid md:grid-cols-2 gap-0">
              <div className="p-8 md:p-12 flex flex-col justify-center">
                <div className="inline-flex items-center justify-center h-12 w-12 rounded-full bg-primary/10 text-primary mb-6">
                  <Mail className="h-6 w-6" />
                </div>
                <h2 className="text-3xl font-bold mb-4 text-foreground">
                  Nhận thông báo về <span className="text-gradient-primary">việc làm mới nhất</span>
                </h2>
                <p className="text-muted-foreground mb-8">
                  Đăng ký nhận bản tin của chúng tôi để cập nhật những cơ hội việc làm mới nhất 
                  và nhận các mẹo hữu ích để phát triển sự nghiệp của bạn.
                </p>
                
                <div className="space-y-4 mb-8">
                  {features.map((feature, index) => (
                    <div key={index} className="flex items-start">
                      <CheckCircle className="h-5 w-5 text-primary mr-3 mt-0.5 shrink-0" />
                      <span className="text-muted-foreground">{feature}</span>
                    </div>
                  ))}
                </div>
                
                <div className="flex flex-col sm:flex-row gap-3">
                  <Input 
                    type="email" 
                    placeholder="Email của bạn" 
                    className="h-12 sm:max-w-sm"
                  />
                  <Button size="lg" className="h-12 bg-gradient-primary hover:opacity-90 text-white">
                    Đăng ký ngay <ArrowRight className="ml-2 h-4 w-4" />
                  </Button>
                </div>
                <p className="text-xs text-muted-foreground mt-3">
                  Bằng cách đăng ký, bạn đồng ý với <a href="#" className="underline hover:text-primary">chính sách bảo mật</a> của chúng tôi.
                </p>
              </div>
              
              <div className="relative h-64 md:h-auto overflow-hidden bg-gradient-primary">
                <div className="absolute inset-0 flex items-center justify-center p-8">
                  <div className="text-center text-primary-foreground">
                    <h3 className="text-2xl font-bold mb-3">Tăng 70% cơ hội tìm việc</h3>
                    <p className="text-primary-foreground/80">
                      Những người đăng ký nhận thông báo việc làm có khả năng tìm được công việc phù hợp cao hơn 70% 
                      so với những người không đăng ký.
                    </p>
                  </div>
                </div>
                <div className="absolute inset-0 bg-black/10"></div>
                {/* Background pattern */}
                <div className="absolute inset-0 opacity-10">
                  <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="white" strokeWidth="1" />
                      </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)" />
                  </svg>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </section>
  );
};

export default NewsletterSection;
</file>

<file path="src/components/sections/StatsSection.jsx">
import { TrendingUp, Users, Building2, Briefcase } from 'lucide-react';

const stats = [
  {
    icon: <Briefcase className="h-8 w-8" />,
    value: '10,000+',
    label: 'Việc làm đang tuyển',
    color: 'from-emerald-500 to-teal-500'
  },
  {
    icon: <Building2 className="h-8 w-8" />,
    value: '5,000+',
    label: 'Công ty uy tín',
    color: 'from-blue-500 to-cyan-500'
  },
  {
    icon: <Users className="h-8 w-8" />,
    value: '50,000+',
    label: 'Ứng viên đã tìm việc',
    color: 'from-purple-500 to-pink-500'
  },
  {
    icon: <TrendingUp className="h-8 w-8" />,
    value: '95%',
    label: 'Tỷ lệ hài lòng',
    color: 'from-orange-500 to-red-500'
  }
];

const StatsSection = () => {
  return (
    <section className="py-16 bg-gradient-to-b from-background to-muted/30">
      <div className="container">
        <div className="grid grid-cols-2 md:grid-cols-4 gap-8">
          {stats.map((stat, index) => (
            <div 
              key={index} 
              className="text-center group cursor-pointer"
            >
              <div className={`inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br ${stat.color} text-white mb-4 transform group-hover:scale-110 transition-transform duration-300 shadow-lg`}>
                {stat.icon}
              </div>
              <div className="text-3xl md:text-4xl font-bold text-foreground mb-2">
                {stat.value}
              </div>
              <div className="text-sm md:text-base text-muted-foreground font-medium">
                {stat.label}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

export default StatsSection;
</file>

<file path="src/components/sections/TrendingCompanies.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { 
  Building2, 
  Users, 
  Briefcase, 
  ArrowRight,
  Target
} from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { SectionHeader } from '../common/SectionHeader';
import apiClient from '../../services/apiClient';

export const TrendingCompanies = ({ limit = 6, showHeader = true }) => {
  const navigate = useNavigate();

  // Fetch most applied companies (công ty được nộp CV nhiều nhất) với React Query
  const { data, isLoading, error } = useQuery({
    queryKey: ['trending-companies', limit],
    queryFn: async () => {
      const response = await apiClient.get(`/analytics/most-applied-companies?limit=${limit}`);
      console.log('🔥 TRENDING API Response:', response.data); // DEBUG LOG
      return response.data;
    },
    staleTime: 0, // TẮT CACHE TẠM THỜI ĐỂ DEBUG
    cacheTime: 0, // TẮT CACHE TẠM THỜI ĐỂ DEBUG
  });

  const companies = data?.data || [];

  // DEBUG: Log ra để xem data
  console.log('🔥 TRENDING COMPANIES:', companies.map(c => ({
    name: c.companyName,
    apps: c.applicationCount,
    jobs: c.activeJobCount
  })));

  // Format số nhân viên
  const formatEmployees = (employees) => {
    if (!employees) return 'Chưa cập nhật';
    if (employees >= 10000) return `${Math.floor(employees / 1000)}K+ nhân viên`;
    if (employees >= 1000) return `${Math.floor(employees / 1000)}K+ nhân viên`;
    return `${employees}+ nhân viên`;
  };

  // Handler khi click vào công ty
  const handleCompanyClick = (companyId) => {
    navigate(`/company/${companyId}`);
  };

  // Handler cho nút "Xem tất cả công ty"
  const handleViewAllCompanies = () => {
    navigate('/companies');
  };

  return (
    <section className="py-20 bg-background">
      <div className="container">
        {showHeader && (
          <SectionHeader
            badgeText="🔥 Đang hot"
            title={<>Top công ty <span className="bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">được săn đón nhất</span></>}
            description="Những công ty được ứng viên quan tâm và nộp CV nhiều nhất. Nơi có cơ hội việc làm thu hút và hấp dẫn nhất."
            className="mb-12"
          />
        )}

        {isLoading ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {[...Array(6)].map((_, i) => (
              <Card key={i} className="animate-pulse bg-muted h-80" />
            ))}
          </div>
        ) : companies.length === 0 ? (
          <div className="text-center py-12 text-muted-foreground">
            <Building2 className="h-16 w-16 mx-auto mb-4 opacity-50" />
            <p>Chưa có dữ liệu công ty</p>
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {companies.map((company, index) => (
              <Card 
                key={company._id} 
                className="group flex flex-col text-center relative border shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 rounded-2xl bg-card cursor-pointer"
                onClick={() => handleCompanyClick(company._id)}
              >
                <CardHeader>
                  <div className="mb-3 mx-auto">
                    <img
                      src={company.logo || 'https://i.pinimg.com/736x/ec/d9/c2/ecd9c2e8ed0dbbc96ac472a965e4afda.jpg'}
                      alt={company.companyName}
                      className="h-24 w-24 mx-auto object-contain rounded-lg border-2 border-gray-100"
                      onError={(e) => {
                        e.target.src = 'https://i.pinimg.com/736x/ec/d9/c2/ecd9c2e8ed0dbbc96ac472a965e4afda.jpg';
                      }}
                    />
                  </div>
                  <CardTitle className="text-xl font-bold text-foreground line-clamp-1">
                    {company.companyName}
                  </CardTitle>
                  <CardDescription className="text-muted-foreground">
                    {company.industry || 'Đa lĩnh vực'}
                  </CardDescription>

                  {index < 3 && (
                    <Badge className="absolute top-4 right-4 bg-gradient-to-r from-orange-500 to-red-500 text-white border-0 shadow-md">
                      Top {index + 1}
                    </Badge>
                  )}
                </CardHeader>
                <CardContent className="grow">
                  <div className="space-y-3 text-sm text-muted-foreground">
                    <div className="flex items-center justify-center gap-2">
                      <Users className="h-4 w-4 text-primary" /> 
                      <span className="font-medium">{formatEmployees(company.employees)}</span>
                    </div>
                    <div className="flex items-center justify-center gap-2">
                      <Target className="h-4 w-4 text-orange-600" /> 
                      <span className="font-medium text-orange-600 font-semibold">
                        {company.applicationCount || 0} CV nhận được
                      </span>
                    </div>
                    <div className="flex items-center justify-center gap-2">
                      <Briefcase className="h-4 w-4 text-emerald-600" /> 
                      <span className="font-medium text-emerald-600">
                        {company.activeJobCount} tin tuyển dụng
                      </span>
                    </div>
                    {company.location?.province && (
                      <div className="flex items-center justify-center gap-2 text-xs">
                        <span>📍 {company.location.province}</span>
                      </div>
                    )}
                  </div>
                </CardContent>
                <CardFooter>
                  <Button 
                    variant="outline" 
                    className="w-full border-2 border-orange-200 text-orange-600 hover:bg-orange-600 hover:text-white hover:border-orange-600 transition-all duration-300 rounded-xl font-semibold"
                    onClick={(e) => {
                      e.stopPropagation();
                      handleCompanyClick(company._id);
                    }}
                  >
                    Xem công ty <ArrowRight className="ml-2 h-4 w-4" />
                  </Button>
                </CardFooter>
              </Card>
            ))}
          </div>
        )}

        <div className="text-center mt-12">
          <Button 
            size="lg" 
            className="px-8 py-6 bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
            onClick={handleViewAllCompanies}
          >
            Xem tất cả công ty
            <ArrowRight className="ml-2 h-5 w-5" />
          </Button>
        </div>
      </div>
    </section>
  );
};

export default TrendingCompanies;
</file>

<file path="src/components/ui/button.jsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva } from "class-variance-authority";

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props} />
  );
}

export { Button, buttonVariants }
</file>

<file path="src/components/ui/label.jsx">
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props} />
  );
}

export { Label }
</file>

<file path="src/constants/skills.js">
export const popularSkills = [
  
  // 🧩 Other General Skills
  'Agile/Scrum',
  'Testing',
  'Documentation',
  'Customer Service',
  'Research',
  'Analytical Thinking',
  'CI/CD',
  'Git',
  'Jenkins',

  // 📱 Mobile
  'React Native',
  'Flutter',
  'Android Development',
  'iOS Development',

  // 🤖 Data & AI
  'Data Visualization',
  'TensorFlow',

  // 🎨 Design & Creative
  'UI/UX Design',
  'Figma',
  'Canva',
  '3D Modeling',
  'Video Editing',

  // 📈 Business & Marketing
  'Digital Marketing',
  'SEO',
  'Content Marketing',
  'Google Ads',
  'Facebook Ads',
  'Email Marketing',
  'Copywriting',
  'Market Research',
  'CRM',
  'Branding',
  'Project Management',

  // 💼 Finance & Management
  'Accounting',
  'Financial Analysis',
  'Budgeting',
  'Leadership',
  'Negotiation',
  'Risk Management',

  // 🧠 Soft Skills
  'Problem Solving',
  'Critical Thinking',
  'Teamwork',
  'Decision Making',

  // ⚙️ Engineering & Technical
  'AutoCAD',
  'Mechanical Design',
  'Quality Assurance',

  // 🌍 Languages & Communication
  'English',
  'Japanese',
  'Public Speaking',
  'Technical Writing',
  'Translation',

];


export const jobFields = [
  'Công nghệ thông tin',
  'Phát triển phần mềm',
  'Data Science',
  'Machine Learning/AI',
  'Phát triển Web',
  'Phát triển Mobile',
  'DevOps',
  'Bán hàng',
  'Marketing',
  'Kế toán',
  'Thiết kế đồ họa',
  'Viết nội dung',
  'Y tế',
  'Giáo dục',
  'Kỹ thuật',
  'Sản xuất',
  'Logistics',
  'Khách sạn',
  'Bất động sản',
  'Luật',
  'Tài chính',
  'Nhân sự',
  'Chăm sóc khách hàng',
  'Hành chính',
  'Quản lý'
];
</file>

<file path="src/data/sampleData.js">
export const sampleCVData = {
  personalInfo: {
    fullName: 'Nguyễn Văn An',
    email: 'nguyenvanan@email.com',
    phone: '+84 123 456 789',
    address: 'Hà Nội, Việt Nam',
    website: 'https://nguyenvanan.dev',
    linkedin: 'https://linkedin.com/in/nguyenvanan',
    github: 'https://github.com/nguyenvanan',
    profileImage: 'https://images.pexels.com/photos/2379004/pexels-photo-2379004.jpeg?auto=compress&cs=tinysrgb&w=300&h=300&dpr=1'
  },
  professionalSummary: 'Kỹ sư phần mềm với 5+ năm kinh nghiệm phát triển ứng dụng web và mobile. Chuyên sâu về React, Node.js và cloud technologies. Đam mê tạo ra những sản phẩm có tác động tích cực đến người dùng và có kinh nghiệm dẫn dắt team phát triển.',
  workExperience: [
    {
      id: 'exp-1',
      company: 'TechViet Solutions',
      position: 'Senior Full-Stack Developer',
      startDate: '2022-01',
      endDate: '',
      isCurrentJob: true,
      description: 'Phát triển và duy trì các ứng dụng web quy mô lớn phục vụ hơn 100,000 người dùng. Dẫn dắt team 5 developers và chịu trách nhiệm về kiến trúc hệ thống.',
      achievements: [
        'Tăng hiệu suất ứng dụng lên 40% thông qua tối ưu hóa database và caching',
        'Xây dựng CI/CD pipeline giảm thời gian deploy từ 2 giờ xuống 15 phút',
        'Mentor 3 junior developers và giúp họ thăng tiến lên mid-level'
      ]
    }
  ],
  education: [
    {
      id: 'edu-1',
      institution: 'Đại học Bách Khoa Hà Nội',
      degree: 'Cử nhân Khoa học Máy tính',
      fieldOfStudy: 'Công nghệ Phần mềm',
      startDate: '2015-09',
      endDate: '2019-06',
      gpa: '3.7/4.0',
      honors: 'Tốt nghiệp Loại Giỏi, Học bổng Khuyến học'
    }
  ],
  skills: [
    { id: 'skill-1', name: 'JavaScript', level: 'Expert', category: 'Technical' },
    { id: 'skill-2', name: 'React', level: 'Expert', category: 'Technical' },
    { id: 'skill-3', name: 'Node.js', level: 'Advanced', category: 'Technical' },
    { id: 'skill-9', name: 'Leadership', level: 'Advanced', category: 'Soft Skills' },
    { id: 'skill-10', name: 'Communication', level: 'Expert', category: 'Soft Skills' },
    { id: 'skill-14', name: 'English', level: 'Advanced', category: 'Language' }
  ],
  projects: [
    {
      id: 'proj-1',
      name: 'E-commerce Platform',
      description: 'Nền tảng thương mại điện tử full-stack với React, Node.js và MongoDB.',
      technologies: ['React', 'Node.js', 'MongoDB', 'Stripe'],
      startDate: '2023-01',
      endDate: '2023-06',
    }
  ],
  certificates: [
    {
      id: 'cert-1',
      name: 'AWS Certified Solutions Architect - Associate',
      issuer: 'Amazon Web Services',
      issueDate: '2023-03',
    }
  ],
  sectionOrder: ['summary', 'experience', 'education', 'skills', 'projects', 'certificates'],
};

export const creativeSampleData = {
  ...sampleCVData,
  personalInfo: {
    ...sampleCVData.personalInfo,
    fullName: 'Trần Thị Minh',
    email: 'tranthiminh@email.com',
    profileImage: 'https://images.pexels.com/photos/3763188/pexels-photo-3763188.jpeg?auto=compress&cs=tinysrgb&w=300&h=300&dpr=1'
  },
  professionalSummary: 'Nhà thiết kế UI/UX với đam mê tạo ra các giao diện đẹp mắt và thân thiện với người dùng. Có kinh nghiệm làm việc với Figma, Sketch và Adobe Creative Suite.',
  template: 'creative-gradient',
  sectionOrder: ['summary', 'projects', 'skills', 'experience', 'education', 'certificates']
};

export const minimalSampleData = {
  ...sampleCVData,
  personalInfo: {
    ...sampleCVData.personalInfo,
    fullName: 'Lê Văn Đức',
    email: 'levanduc@email.com',
    profileImage: 'https://images.pexels.com/photos/2182970/pexels-photo-2182970.jpeg?auto=compress&cs=tinysrgb&w=300&h=300&dpr=1'
  },
  professionalSummary: 'Chuyên gia Marketing với tư duy phân tích và khả năng xây dựng chiến lược hiệu quả. Tập trung vào việc tối ưu hóa ROI và tăng trưởng người dùng.',
  template: 'minimal-gray',
  sectionOrder: ['summary', 'skills', 'experience', 'education', 'projects', 'certificates']
};
</file>

<file path="src/hooks/useAutocomplete.js">
import { useState, useEffect, useRef, useCallback } from 'react';
import { getJobTitleSuggestions } from '@/services/jobService';
import { useDebounce } from './useDebounce';

/**
 * Custom hook để xử lý logic autocomplete
 * Bao gồm API calls, caching, error handling, và loading states
 * 
 * @param {Object} options - Tùy chọn cấu hình
 * @param {number} options.delay - Thời gian debounce (ms), mặc định 300ms
 * @param {number} options.minLength - Độ dài tối thiểu để trigger autocomplete, mặc định 1
 * @param {number} options.maxSuggestions - Số lượng suggestions tối đa, mặc định 10
 * @param {number} options.cacheSize - Kích thước cache tối đa, mặc định 50
 * @returns {Object} - Object chứa states và methods cho autocomplete
 */
export const useAutocomplete = (options = {}) => {
  const {
    delay = 10, //10ms
    minLength = 1,
    maxSuggestions = 10,
    cacheSize = 50
  } = options;

  // States
  const [query, setQuery] = useState('');
  const [suggestions, setSuggestions] = useState([]);
  const [previousSuggestions, setPreviousSuggestions] = useState([]); // Store previous results
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);
  const [selectedIndex, setSelectedIndex] = useState(-1);
  const [showDropdown, setShowDropdown] = useState(false);

  // Refs để quản lý request cancellation và caching
  const abortControllerRef = useRef(null);
  const cacheRef = useRef(new Map());

  // Debounce query để tối ưu hóa API calls
  const debouncedQuery = useDebounce(query, delay);

  /**
   * Reset selected index khi suggestions thay đổi
   */
  useEffect(() => {
    setSelectedIndex(-1);
  }, [suggestions]);

  /**
   * Fetch suggestions từ API hoặc cache
   */
  const fetchSuggestions = useCallback(async (searchQuery) => {
    // Kiểm tra điều kiện để fetch
    if (!searchQuery || searchQuery.length < minLength) {
      setSuggestions([]);
      setPreviousSuggestions([]);
      setShowDropdown(false);
      return;
    }

    // Kiểm tra cache trước
    const normalizedQuery = searchQuery.toLowerCase().trim();
    if (cacheRef.current.has(normalizedQuery)) {
      const cachedData = cacheRef.current.get(normalizedQuery);
      setSuggestions(cachedData);
      setPreviousSuggestions(cachedData);
      setShowDropdown(true);
      return;
    }

    // Giữ kết quả cũ thay vì hiển thị loading
    // Chỉ hiển thị loading nếu chưa có suggestions nào
    if (suggestions.length === 0) {
      setIsLoading(true);
    }

    // Cancel request trước đó nếu có
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }

    // Tạo AbortController mới
    abortControllerRef.current = new AbortController();
    
    try {
      setError(null);

      const response = await getJobTitleSuggestions(searchQuery, maxSuggestions);
      
      // Kiểm tra nếu request bị cancel
      if (abortControllerRef.current?.signal.aborted) {
        return;
      }

      if (response.success && response.data) {
        const suggestionData = response.data;
        
        // Cache kết quả (với giới hạn kích thước)
        if (cacheRef.current.size >= cacheSize) {
          // Xóa entry cũ nhất khi cache đầy
          const firstKey = cacheRef.current.keys().next().value;
          cacheRef.current.delete(firstKey);
        }
        cacheRef.current.set(normalizedQuery, suggestionData);

        setSuggestions(suggestionData);
        setPreviousSuggestions(suggestionData);
        setShowDropdown(true);
      } else {
        // API thành công nhưng không có data hoặc thất bại
        // Giữ kết quả cũ nếu có, nếu không thì clear
        if (previousSuggestions.length === 0) {
          setSuggestions([]);
          setShowDropdown(false);
        }
        if (!response.success) {
          console.warn('Autocomplete API warning:', response.message);
        }
      }
    } catch (err) {
      // Kiểm tra nếu error do request bị cancel
      if (err.name === 'AbortError' || abortControllerRef.current?.signal.aborted) {
        return;
      }
      
      console.error('Autocomplete error:', err);
      setError(err.message || 'Có lỗi xảy ra khi tải gợi ý');
      // Giữ kết quả cũ nếu có lỗi, không clear suggestions
      if (previousSuggestions.length === 0) {
        setSuggestions([]);
        setShowDropdown(false);
      }
    } finally {
      setIsLoading(false);
      abortControllerRef.current = null;
    }
  }, [minLength, maxSuggestions, cacheSize]);

  /**
   * Effect để trigger fetch khi debouncedQuery thay đổi
   */
  useEffect(() => {
    fetchSuggestions(debouncedQuery);
  }, [debouncedQuery, fetchSuggestions]);

  /**
   * Cleanup effect để cancel requests khi component unmount
   */
  useEffect(() => {
    return () => {
      if (abortControllerRef.current) {
        abortControllerRef.current.abort();
      }
    };
  }, []);

  /**
   * Xử lý thay đổi input
   */
  const handleInputChange = useCallback((value) => {
    setQuery(value);
    if (!value || value.length < minLength) {
      setShowDropdown(false);
      setSuggestions([]);
      setPreviousSuggestions([]);
    }
  }, [minLength]);

  /**
   * Xử lý keyboard navigation
   */
  const handleKeyDown = useCallback((event) => {
    if (!showDropdown || suggestions.length === 0) return;

    switch (event.key) {
      case 'ArrowDown':
        event.preventDefault();
        setSelectedIndex(prev => 
          prev < suggestions.length - 1 ? prev + 1 : 0
        );
        break;
      
      case 'ArrowUp':
        event.preventDefault();
        setSelectedIndex(prev => 
          prev > 0 ? prev - 1 : suggestions.length - 1
        );
        break;
      
      case 'Enter':
        event.preventDefault();
        if (selectedIndex >= 0 && selectedIndex < suggestions.length) {
          const selectedSuggestion = suggestions[selectedIndex];
          return selectedSuggestion.title; // Return selected suggestion
        }
        return query; // Return current query if no selection
      
      case 'Escape':
        event.preventDefault();
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;
      
      case 'Tab':
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;
      
      default:
        break;
    }
    return null;
  }, [showDropdown, suggestions, selectedIndex, query]);

  /**
   * Xử lý click trên suggestion
   */
  const handleSuggestionClick = useCallback((suggestion) => {
    setQuery(suggestion.title);
    setShowDropdown(false);
    setSelectedIndex(-1);
    return suggestion.title;
  }, []);

  /**
   * Xử lý mouse hover trên suggestion
   */
  const handleSuggestionHover = useCallback((index) => {
    setSelectedIndex(index);
  }, []);

  /**
   * Đóng dropdown
   */
  const closeDropdown = useCallback(() => {
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, []);

  /**
   * Clear all states
   */
  const clear = useCallback(() => {
    setQuery('');
    setSuggestions([]);
    setPreviousSuggestions([]);
    setShowDropdown(false);
    setSelectedIndex(-1);
    setError(null);
    setIsLoading(false);
  }, []);

  /**
   * Retry fetch (để sử dụng khi có lỗi)
   */
  const retry = useCallback(() => {
    setError(null);
    fetchSuggestions(query);
  }, [query, fetchSuggestions]);

  return {
    // States
    query,
    suggestions,
    isLoading,
    error,
    selectedIndex,
    showDropdown,
    
    // Actions
    handleInputChange,
    handleKeyDown,
    handleSuggestionClick,
    handleSuggestionHover,
    closeDropdown,
    clear,
    retry,
    
    // Computed values
    hasResults: suggestions.length > 0,
    isEmpty: !isLoading && suggestions.length === 0 && query.length >= minLength,
    selectedSuggestion: selectedIndex >= 0 ? suggestions[selectedIndex] : null
  };
};

export default useAutocomplete;
</file>

<file path="src/hooks/useHeaderTheme.js">
import { useState, useEffect } from 'react';
import { useLocation } from 'react-router-dom';

/**
 * Hook để theo dõi vị trí scroll và xác định xem có nên sử dụng theme trắng cho header hay không.
 * Hiệu ứng này chỉ được áp dụng trên trang chủ.
 * @param {number} threshold - Ngưỡng scroll để chuyển đổi theme (mặc định: 500px)
 * @returns {boolean} isHeaderWhite - true nếu header nên có theme trắng
 */
export const useHeaderTheme = (threshold = 500) => {
  const location = useLocation();
  const isHomepage = location.pathname === '/';
  
  // Chỉ bắt đầu với theme trắng nếu ở trang chủ, ngược lại thì không.
  const [isHeaderWhite, setIsHeaderWhite] = useState(isHomepage);

  useEffect(() => {
    // Nếu không phải trang chủ, đảm bảo header không phải màu trắng và không làm gì thêm.
    if (!isHomepage) {
      setIsHeaderWhite(false);
      return;
    }

    const handleScroll = () => {
      const scrollY = window.scrollY;
      // Chỉ khi ở trang chủ, ta mới cập nhật theme dựa trên vị trí cuộn
      setIsHeaderWhite(scrollY < threshold);
    };

    // Gọi ngay lập tức để set initial state cho trang chủ
    handleScroll();

    // Thêm event listener với throttle để tối ưu performance
    let ticking = false;
    const throttledHandleScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    };

    window.addEventListener('scroll', throttledHandleScroll, { passive: true });

    // Cleanup listener khi component unmount hoặc khi không còn ở trang chủ
    return () => {
      window.removeEventListener('scroll', throttledHandleScroll);
    };
  }, [isHomepage, threshold]); // Chạy lại effect khi isHomepage hoặc threshold thay đổi

  return isHeaderWhite;
};
</file>

<file path="src/pages/company/CompanyDetail.jsx">
import React, { useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { Input } from '@/components/ui/input';
import { Skeleton } from '@/components/ui/skeleton';
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';
import {
  Building,
  MapPin,
  Users,
  Globe,
  Mail,
  Phone,
  Briefcase,
  ArrowLeft,
  Search,
  ChevronLeft,
  ChevronRight,
  AlertCircle,
  Star,
  Calendar,
  DollarSign,
  Clock
} from 'lucide-react';
import { getCompanyById, getCompanyJobs } from '@/services/companyService';
import { formatSalary, formatTimeAgo } from '@/utils/formatters';
import { toast } from 'sonner';
import JobLocationMap from '@/components/common/JobLocationMap';

const CompanyDetail = () => {
  const { companyId } = useParams();
  const navigate = useNavigate();
  const [currentPage, setCurrentPage] = useState(1);
  const [searchQuery, setSearchQuery] = useState('');
  const [searchInput, setSearchInput] = useState('');
  const [isFollowing, setIsFollowing] = useState(false);
  const jobsPerPage = 6;

  // Fetch company details
  const { data: companyData, isLoading: isLoadingCompany, error: companyError } = useQuery({
    queryKey: ['company', companyId],
    queryFn: async () => {
      const response = await getCompanyById(companyId);
      return response.data.data;
    },
    enabled: !!companyId,
    retry: 1
  });

  // Fetch company jobs
  const { data: jobsData, isLoading: isLoadingJobs } = useQuery({
    queryKey: ['companyJobs', companyId, currentPage, searchQuery],
    queryFn: async () => {
      const response = await getCompanyJobs(companyId, {
        page: currentPage,
        limit: jobsPerPage,
        search: searchQuery || undefined,
        sortBy: 'createdAt:desc'
      });
      return response.data;
    },
    enabled: !!companyId,
    keepPreviousData: true
  });

  const handleSearch = (e) => {
    e.preventDefault();
    setSearchQuery(searchInput);
    setCurrentPage(1);
  };

  const handleClearSearch = () => {
    setSearchInput('');
    setSearchQuery('');
    setCurrentPage(1);
  };

  const handleFollowCompany = () => {
    // TODO: Implement follow company logic
    setIsFollowing(!isFollowing);
    toast.success(isFollowing ? 'Đã bỏ theo dõi công ty' : 'Đã theo dõi công ty');
  };

  const handleJobClick = (jobId) => {
    navigate(`/jobs/${jobId}`);
  };

  if (companyError) {
    return (
      <div className="container py-10">
        <Button variant="ghost" onClick={() => navigate(-1)} className="mb-6">
          <ArrowLeft className="mr-2 h-4 w-4" />
          Quay lại
        </Button>
        <Card>
          <CardContent className="py-20">
            <div className="text-center">
              <AlertCircle className="h-12 w-12 text-destructive mx-auto mb-4" />
              <h2 className="text-2xl font-semibold mb-2">Không tìm thấy công ty</h2>
              <p className="text-muted-foreground">
                Công ty này không tồn tại hoặc đã bị xóa.
              </p>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-background to-muted/20">
      <div className="container py-8 max-w-7xl">
        {/* Back Button */}
        <Button variant="ghost" onClick={() => navigate(-1)} className="mb-6">
          <ArrowLeft className="mr-2 h-4 w-4" />
          Quay lại
        </Button>

        {isLoadingCompany ? (
          <CompanyDetailSkeleton />
        ) : (
          <>
            {/* Company Header Card */}
            <Card className="mb-8 overflow-hidden border-0 shadow-lg">
              {/* Cover Image */}
              <div className="h-32 bg-gradient-to-r from-primary/20 via-primary/10 to-primary/5" />
              
              <CardContent className="relative pt-0 pb-6">
                {/* Company Logo */}
                <div className="flex flex-col md:flex-row gap-6 -mt-16 md:-mt-12">
                  <Avatar className="h-32 w-32 border-4 border-background shadow-xl rounded-2xl">
                    <AvatarImage src={companyData?.logo} alt={companyData?.name} />
                    <AvatarFallback className="rounded-2xl text-3xl bg-gradient-to-br from-primary/20 to-primary/5">
                      <Building className="h-16 w-16" />
                    </AvatarFallback>
                  </Avatar>

                  {/* Company Info */}
                  <div className="flex-1 mt-16 md:mt-4">
                    <div className="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4">
                      <div>
                        <h1 className="text-3xl md:text-4xl font-bold mb-2">{companyData?.name}</h1>
                        {companyData?.industry && (
                          <Badge variant="secondary" className="gap-1 text-sm">
                            <Briefcase className="h-3 w-3" />
                            {companyData.industry}
                          </Badge>
                        )}
                      </div>
                      
                      {/* Follow Button */}
                      <Button
                        onClick={handleFollowCompany}
                        variant={isFollowing ? "outline" : "default"}
                        className="gap-2"
                      >
                        <Star className={`h-4 w-4 ${isFollowing ? 'fill-current' : ''}`} />
                        {isFollowing ? 'Đang theo dõi' : 'Theo dõi'}
                      </Button>
                    </div>

                    {/* Company Stats */}
                    <div className="flex flex-wrap gap-6 text-sm mb-4">
                      {companyData?.size && (
                        <div className="flex items-center gap-2">
                          <Users className="h-4 w-4 text-muted-foreground" />
                          <span className="font-medium">{companyData.size}</span>
                        </div>
                      )}
                      {companyData?.location && (
                        <div className="flex items-center gap-2">
                          <MapPin className="h-4 w-4 text-muted-foreground" />
                          <span>{companyData.location.province}</span>
                        </div>
                      )}
                      {jobsData?.meta?.totalItems !== undefined && (
                        <div className="flex items-center gap-2">
                          <Briefcase className="h-4 w-4 text-muted-foreground" />
                          <span>{jobsData.meta.totalItems} việc làm đang tuyển</span>
                        </div>
                      )}
                    </div>

                    {/* Contact Links */}
                    <div className="flex flex-wrap gap-4">
                      {companyData?.website && (
                        <a
                          href={companyData.website}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="flex items-center gap-2 text-sm text-primary hover:underline"
                        >
                          <Globe className="h-4 w-4" />
                          Website
                        </a>
                      )}
                      {companyData?.contactInfo?.email && (
                        <a
                          href={`mailto:${companyData.contactInfo.email}`}
                          className="flex items-center gap-2 text-sm text-primary hover:underline"
                        >
                          <Mail className="h-4 w-4" />
                          Email
                        </a>
                      )}
                      {companyData?.contactInfo?.phone && (
                        <a
                          href={`tel:${companyData.contactInfo.phone}`}
                          className="flex items-center gap-2 text-sm text-primary hover:underline"
                        >
                          <Phone className="h-4 w-4" />
                          {companyData.contactInfo.phone}
                        </a>
                      )}
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              {/* Left Column - Main Content */}
              <div className="lg:col-span-2 space-y-6">
                {/* About Company */}
                <Card className="border-0 shadow-lg">
                  <CardHeader>
                    <CardTitle className="flex items-center gap-2">
                      <Building className="h-5 w-5" />
                      Giới thiệu công ty
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <p className="text-muted-foreground whitespace-pre-wrap leading-relaxed">
                      {companyData?.about}
                    </p>
                  </CardContent>
                </Card>

                {/* Jobs Section */}
                <Card className="border-0 shadow-lg">
                  <CardHeader>
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                      <CardTitle className="flex items-center gap-2">
                        <Briefcase className="h-5 w-5" />
                        Việc làm đang tuyển
                        {jobsData?.meta?.totalItems > 0 && (
                          <Badge variant="secondary">{jobsData.meta.totalItems}</Badge>
                        )}
                      </CardTitle>
                      
                      {/* Search Form */}
                      <form onSubmit={handleSearch} className="flex gap-2 w-full sm:w-auto">
                        <Input
                          placeholder="Tìm kiếm việc làm..."
                          value={searchInput}
                          onChange={(e) => setSearchInput(e.target.value)}
                          className="w-full sm:w-64"
                        />
                        <Button type="submit" size="icon">
                          <Search className="h-4 w-4" />
                        </Button>
                      </form>
                    </div>
                  </CardHeader>
                  <CardContent>
                    {isLoadingJobs ? (
                      <JobListSkeleton />
                    ) : jobsData?.data?.length > 0 ? (
                      <>
                        <div className="grid gap-4">
                          {jobsData.data.map((job) => (
                            <JobCard key={job._id} job={job} onClick={() => handleJobClick(job._id)} />
                          ))}
                        </div>

                        {/* Pagination */}
                        {jobsData.meta && jobsData.meta.totalPages > 1 && (
                          <div className="flex justify-center items-center gap-2 mt-6 pt-6 border-t">
                            <Button
                              variant="outline"
                              size="sm"
                              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}
                              disabled={currentPage === 1}
                            >
                              <ChevronLeft className="h-4 w-4 mr-1" />
                              Trước
                            </Button>
                            
                            <div className="flex items-center gap-2">
                              <span className="text-sm font-medium">
                                Trang {currentPage}
                              </span>
                              <span className="text-sm text-muted-foreground">
                                / {jobsData.meta.totalPages}
                              </span>
                            </div>
                            
                            <Button
                              variant="outline"
                              size="sm"
                              onClick={() => setCurrentPage(p => Math.min(jobsData.meta.totalPages, p + 1))}
                              disabled={currentPage === jobsData.meta.totalPages}
                            >
                              Sau
                              <ChevronRight className="h-4 w-4 ml-1" />
                            </Button>
                          </div>
                        )}
                      </>
                    ) : (
                      <div className="text-center py-12">
                        <Briefcase className="h-12 w-12 text-muted-foreground mx-auto mb-4" />
                        <p className="text-muted-foreground mb-4">
                          {searchQuery ? 'Không tìm thấy việc làm phù hợp' : 'Công ty chưa có việc làm nào'}
                        </p>
                        {searchQuery && (
                          <Button variant="outline" size="sm" onClick={handleClearSearch}>
                            Xóa bộ lọc
                          </Button>
                        )}
                      </div>
                    )}
                  </CardContent>
                </Card>
              </div>

              {/* Right Column - Sidebar */}
              <div className="space-y-6">
                {/* Location Map */}
                {companyData?.location?.coordinates && (
                  <JobLocationMap
                    location={companyData.location}
                    address={companyData.address}
                    companyName={companyData.name}
                  />
                )}

                {/* Company Info Card */}
                <Card className="border-0 shadow-lg">
                  <CardHeader>
                    <CardTitle className="text-lg">Thông tin công ty</CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {companyData?.location && (
                      <div>
                        <div className="flex items-center gap-2 text-sm font-medium mb-1">
                          <MapPin className="h-4 w-4 text-muted-foreground" />
                          Địa chỉ
                        </div>
                        <p className="text-sm text-muted-foreground pl-6">
                          {companyData.address}
                          {companyData.location.commune && `, ${companyData.location.commune}`}
                          {companyData.location.district && `, ${companyData.location.district}`}
                          {companyData.location.province && `, ${companyData.location.province}`}
                        </p>
                      </div>
                    )}

                    {companyData?.size && (
                      <div>
                        <div className="flex items-center gap-2 text-sm font-medium mb-1">
                          <Users className="h-4 w-4 text-muted-foreground" />
                          Quy mô
                        </div>
                        <p className="text-sm text-muted-foreground pl-6">{companyData.size}</p>
                      </div>
                    )}

                    {companyData?.industry && (
                      <div>
                        <div className="flex items-center gap-2 text-sm font-medium mb-1">
                          <Briefcase className="h-4 w-4 text-muted-foreground" />
                          Lĩnh vực
                        </div>
                        <p className="text-sm text-muted-foreground pl-6">{companyData.industry}</p>
                      </div>
                    )}
                  </CardContent>
                </Card>
              </div>
            </div>
          </>
        )}
      </div>
    </div>
  );
};

// Job Card Component
const JobCard = ({ job, onClick }) => {
  const formatJobType = (type) => {
    const typeMap = {
      'FULL_TIME': 'Toàn thời gian',
      'PART_TIME': 'Bán thời gian',
      'CONTRACT': 'Hợp đồng',
      'FREELANCE': 'Tự do',
      'INTERNSHIP': 'Thực tập'
    };
    return typeMap[type] || type;
  };

  const formatWorkType = (type) => {
    const typeMap = {
      'ON_SITE': 'Tại văn phòng',
      'REMOTE': 'Từ xa',
      'HYBRID': 'Hybrid'
    };
    return typeMap[type] || type;
  };

  return (
    <div
      onClick={onClick}
      className="group border rounded-xl p-5 hover:border-primary hover:shadow-lg transition-all cursor-pointer bg-card"
    >
      <div className="flex justify-between items-start mb-3">
        <h3 className="font-bold text-lg group-hover:text-primary transition-colors line-clamp-2 flex-1">
          {job.title}
        </h3>
        {job.featured && (
          <Badge variant="default" className="ml-2 shrink-0">
            <Star className="h-3 w-3 mr-1" />
            Nổi bật
          </Badge>
        )}
      </div>

      <div className="space-y-2 mb-4">
        {job.location && (
          <div className="flex items-center gap-2 text-sm text-muted-foreground">
            <MapPin className="h-4 w-4 shrink-0" />
            <span className="line-clamp-1">
              {[job.location.district, job.location.province].filter(Boolean).join(', ')}
            </span>
          </div>
        )}
        
        {(job.minSalary || job.maxSalary) && (
          <div className="flex items-center gap-2 text-sm">
            <DollarSign className="h-4 w-4 text-muted-foreground shrink-0" />
            <span className="font-semibold text-primary">
              {formatSalary(job.minSalary, job.maxSalary)}
            </span>
          </div>
        )}

        {job.deadline && (
          <div className="flex items-center gap-2 text-sm text-muted-foreground">
            <Calendar className="h-4 w-4 shrink-0" />
            <span>Hạn nộp: {new Date(job.deadline).toLocaleDateString('vi-VN')}</span>
          </div>
        )}
      </div>

      <div className="flex flex-wrap gap-2 mb-3">
        {job.type && (
          <Badge variant="outline" className="text-xs">
            {formatJobType(job.type)}
          </Badge>
        )}
        {job.workType && (
          <Badge variant="outline" className="text-xs">
            {formatWorkType(job.workType)}
          </Badge>
        )}
        {job.experience && (
          <Badge variant="secondary" className="text-xs">
            {job.experience}
          </Badge>
        )}
      </div>

      <div className="flex items-center gap-2 text-xs text-muted-foreground pt-3 border-t">
        <Clock className="h-3 w-3" />
        <span>Đăng {formatTimeAgo(job.createdAt)}</span>
      </div>
    </div>
  );
};

// Skeleton Components
const CompanyDetailSkeleton = () => (
  <div className="space-y-8">
    <Card className="overflow-hidden border-0 shadow-lg">
      <div className="h-32 bg-muted" />
      <CardContent className="pt-0 pb-6">
        <div className="flex gap-6 -mt-16">
          <Skeleton className="h-32 w-32 rounded-2xl" />
          <div className="flex-1 mt-16 space-y-3">
            <Skeleton className="h-10 w-96" />
            <Skeleton className="h-6 w-32" />
            <Skeleton className="h-4 w-full max-w-2xl" />
          </div>
        </div>
      </CardContent>
    </Card>
    
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div className="lg:col-span-2 space-y-6">
        <Card className="border-0 shadow-lg">
          <CardHeader>
            <Skeleton className="h-6 w-48" />
          </CardHeader>
          <CardContent className="space-y-2">
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-full" />
            <Skeleton className="h-4 w-3/4" />
          </CardContent>
        </Card>
      </div>
      <div className="space-y-6">
        <Skeleton className="h-64 w-full rounded-lg" />
      </div>
    </div>
  </div>
);

const JobListSkeleton = () => (
  <div className="grid gap-4">
    {[1, 2, 3].map((i) => (
      <div key={i} className="border rounded-xl p-5">
        <Skeleton className="h-6 w-3/4 mb-3" />
        <div className="space-y-2 mb-4">
          <Skeleton className="h-4 w-1/2" />
          <Skeleton className="h-4 w-1/3" />
        </div>
        <div className="flex gap-2">
          <Skeleton className="h-6 w-24" />
          <Skeleton className="h-6 w-20" />
        </div>
      </div>
    ))}
  </div>
);

export default CompanyDetail;
</file>

<file path="src/pages/cv/CV.jsx">
import React from 'react';
import { Link } from 'react-router-dom';
import CVListPage from './CVListPage';

const CV = () => {
  return (
    <div className="container mx-auto p-4 ">
      <div className="flex justify-between items-center mb-4">
        <h1 className="text-2xl font-bold">CV Management</h1>
        <Link
          to="/editor"
          className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        >
          Create New CV
        </Link>
      </div>
      <CVListPage />
    </div>
  );
};

export default CV;
</file>

<file path="src/pages/cv/CVRenderOnlyPage.jsx">
import React, { useState, useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import CVPreview from '../../components/CVPreview/CVPreview';
// Đảm bảo bạn import hàm lấy CV từ API
import { getCvById } from '../../services/api'; 
import { mapToFrontend } from '../../utils/dataMapper'; // Import hàm map dữ liệu

const CVRenderOnlyPage = () => {
  const [searchParams] = useSearchParams();
  const cvId = searchParams.get('cvId');
  const [cvData, setCvData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchCvData = async () => {
      if (!cvId) {
        setError("CV ID is missing. Please ensure you are accessing this page with a 'cvId' query parameter, e.g., /render.html?cvId=your_cv_id_here");
        setLoading(false);
        return;
      }
      try {
        // Gọi API để lấy dữ liệu CV từ backend
        const dataFromApi = await getCvById(cvId);
        if (dataFromApi) {
          // Sử dụng dataMapper để chuyển đổi dữ liệu cho phù hợp với component Preview
          setCvData(mapToFrontend(dataFromApi.data));
          // setCvData(mapToFrontend(dataFromApi));
        } else {
          throw new Error(`CV with ID "${cvId}" not found.`);
        }
      } catch (err) {
        console.error("Error fetching CV data:", err);
        console.error(err);
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchCvData();
  }, [cvId]);

  if (loading) {
    return <div>Loading Document...</div>;
  }

  if (error) {
    return <div style={{ color: 'red', padding: '2rem' }}>Error: {error}</div>;
  }

  // Component CVPreview sẽ nhận dữ liệu đã được map
  return (
    <div id="cv-preview" style={{
      margin: 0,
      padding: 0,
      backgroundColor: 'white',
      width: '100%',
      minHeight: '100vh'
    }}>
      <style>{`
        * {
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
          color-adjust: exact !important;
        }
        body {
          margin: 0 !important;
          padding: 0 !important;
        }
        @page {
          size: A4;
          margin: 0;
        }
      `}</style>
      <CVPreview cvData={cvData} />
    </div>
  );
};

export default CVRenderOnlyPage;
</file>

<file path="src/pages/dashboard/settings/PrivacySettings.jsx">
import { useState, useEffect } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import { Shield, Eye, EyeOff, Info, FileText, CheckCircle2 } from 'lucide-react';
import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Switch } from '@/components/ui/switch';
import { Label } from '@/components/ui/label';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';
import { Button } from '@/components/ui/button';
import { getMe } from '@/services/profileService';
import { updatePrivacySettings, getAllowSearchSettings, toggleAllowSearch } from '@/services/profileService';
import { getCVs } from '@/services/cvService';
import { cn } from '@/lib/utils';

const PrivacySettings = () => {
  const queryClient = useQueryClient();
  const [allowSearch, setAllowSearch] = useState(false);
  const [selectedCvId, setSelectedCvId] = useState(null);
  const [showCvSelector, setShowCvSelector] = useState(false);

  // Fetch current allow search settings
  const { data: settingsData, isLoading: settingsLoading } = useQuery({
    queryKey: ['allowSearchSettings'],
    queryFn: getAllowSearchSettings,
  });

  // Fetch user CVs
  const { data: cvsData, isLoading: cvsLoading } = useQuery({
    queryKey: ['userCVs'],
    queryFn: getCVs,
  });

  // Fetch user data
  const { data: userData, isLoading, isError, error } = useQuery({
    queryKey: ['currentUser'],
    queryFn: getMe,
  });

  // Set initial state when data loads
  useEffect(() => {
    if (settingsData?.data) {
      setAllowSearch(settingsData.data.allowSearch);
      setSelectedCvId(settingsData.data.selectedCvId);
    }
  }, [settingsData]);

  // Toggle allow search mutation
  const toggleMutation = useMutation({
    mutationFn: (data) => toggleAllowSearch(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['allowSearchSettings'] });
      queryClient.invalidateQueries({ queryKey: ['currentUser'] });
      toast.success('Đã cập nhật cài đặt tìm kiếm thành công');
      setShowCvSelector(false);
    },
    onError: (error) => {
      setAllowSearch(!allowSearch);
      toast.error(error.response?.data?.message || 'Không thể cập nhật cài đặt');
    },
  });

  const handleToggleAllowSearch = (checked) => {
    if (checked) {
      // Nếu bật, kiểm tra xem đã có CV chưa
      const cvs = cvsData?.data || [];
      if (cvs.length === 0) {
        toast.error('Bạn cần upload ít nhất 1 CV trước khi bật tìm việc');
        return;
      }
      
      // Nếu đã có CV được chọn trước đó, dùng luôn
      if (selectedCvId) {
        setAllowSearch(true);
        toggleMutation.mutate({ allowSearch: true, selectedCvId });
      } else {
        // Hiển thị CV selector
        setShowCvSelector(true);
      }
    } else {
      // Nếu tắt, không cần chọn CV
      setAllowSearch(false);
      toggleMutation.mutate({ allowSearch: false });
    }
  };

  const handleSelectCv = (cvId) => {
    setSelectedCvId(cvId);
    setAllowSearch(true);
    toggleMutation.mutate({ allowSearch: true, selectedCvId: cvId });
  };

  const handleChangeCv = () => {
    setShowCvSelector(true);
  };

  const cvs = cvsData?.data || [];
  const selectedCv = cvs.find(cv => cv._id === selectedCvId);

  if (isLoading || settingsLoading) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        <div className="mb-6">
          <Skeleton className="h-8 w-64 mb-2" />
          <Skeleton className="h-4 w-96" />
        </div>
        <Card>
          <CardHeader>
            <Skeleton className="h-6 w-48" />
          </CardHeader>
          <CardContent>
            <Skeleton className="h-20 w-full" />
          </CardContent>
        </Card>
      </div>
    );
  }

  if (isError) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-4xl">
        <ErrorState
          title="Không thể tải cài đặt"
          message={error?.response?.data?.message || 'Đã xảy ra lỗi khi tải cài đặt riêng tư'}
        />
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-4xl">
      {/* Header */}
      <div className="mb-6">
        <div className="flex items-center gap-3 mb-2">
          <Shield className="h-8 w-8 text-primary" />
          <h1 className="text-3xl font-bold text-gray-900">Cài đặt riêng tư</h1>
        </div>
        <p className="text-gray-600">
          Quản lý quyền riêng tư và khả năng hiển thị hồ sơ của bạn
        </p>
      </div>

      {/* Privacy Settings Card */}
      <Card>
        <CardHeader>
          <div className="flex items-center gap-2">
            <Eye className="h-5 w-5 text-gray-600" />
            <h2 className="text-xl font-semibold">Khả năng tìm kiếm hồ sơ</h2>
          </div>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Allow Search Toggle */}
          <div className="flex items-start justify-between gap-4 p-4 rounded-lg border border-gray-200 bg-gray-50">
            <div className="flex-1 space-y-2">
              <div className="flex items-center gap-2">
                <Label
                  htmlFor="allow-search"
                  className="text-base font-medium cursor-pointer"
                >
                  Cho phép nhà tuyển dụng tìm thấy tôi
                </Label>
                {allowSearch ? (
                  <Eye className="h-4 w-4 text-green-600" />
                ) : (
                  <EyeOff className="h-4 w-4 text-gray-400" />
                )}
              </div>
              <p className="text-sm text-gray-600">
                Khi bật, hồ sơ của bạn sẽ xuất hiện trong danh sách gợi ý ứng viên
                phù hợp cho các nhà tuyển dụng dựa trên AI. Bạn cần chọn 1 CV để hiển thị.
                Thông tin liên hệ trong CV sẽ được che cho đến khi nhà tuyển dụng mua quyền xem.
              </p>
            </div>
            <Switch
              id="allow-search"
              checked={allowSearch}
              onCheckedChange={handleToggleAllowSearch}
              disabled={toggleMutation.isPending}
              className={cn(
                toggleMutation.isPending && 'opacity-50 cursor-not-allowed'
              )}
            />
          </div>

          {/* Selected CV Display */}
          {allowSearch && selectedCv && !showCvSelector && (
            <div className="p-4 rounded-lg border border-green-200 bg-green-50">
              <div className="flex items-start justify-between gap-4">
                <div className="flex items-start gap-3 flex-1">
                  <FileText className="h-5 w-5 text-green-600 flex-shrink-0 mt-0.5" />
                  <div className="space-y-1">
                    <p className="text-sm font-medium text-green-900">
                      CV đang sử dụng để tìm việc:
                    </p>
                    <p className="text-sm text-green-700 font-semibold">
                      {selectedCv.name}
                    </p>
                    <p className="text-xs text-green-600">
                      Tải lên: {new Date(selectedCv.uploadedAt).toLocaleDateString('vi-VN')}
                    </p>
                  </div>
                </div>
                <Button
                  variant="outline"
                  size="sm"
                  onClick={handleChangeCv}
                  disabled={toggleMutation.isPending}
                  className="border-green-300 text-green-700 hover:bg-green-100"
                >
                  Đổi CV
                </Button>
              </div>
            </div>
          )}

          {/* CV Selector */}
          {showCvSelector && (
            <div className="space-y-3">
              <div className="flex items-center justify-between">
                <Label className="text-base font-medium">
                  Chọn CV để hiển thị cho nhà tuyển dụng:
                </Label>
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => setShowCvSelector(false)}
                  disabled={toggleMutation.isPending}
                >
                  Hủy
                </Button>
              </div>
              
              {cvsLoading ? (
                <div className="space-y-2">
                  <Skeleton className="h-20 w-full" />
                  <Skeleton className="h-20 w-full" />
                </div>
              ) : cvs.length === 0 ? (
                <div className="p-4 rounded-lg border border-gray-200 bg-gray-50 text-center">
                  <p className="text-sm text-gray-600">
                    Bạn chưa có CV nào. Vui lòng upload CV trước.
                  </p>
                  <Button
                    variant="link"
                    className="mt-2"
                    onClick={() => window.location.href = '/cv'}
                  >
                    Đi đến trang quản lý CV
                  </Button>
                </div>
              ) : (
                <div className="space-y-2">
                  {cvs.map((cv) => (
                    <button
                      key={cv._id}
                      onClick={() => handleSelectCv(cv._id)}
                      disabled={toggleMutation.isPending}
                      className={cn(
                        'w-full p-4 rounded-lg border-2 text-left transition-all',
                        'hover:border-primary hover:bg-primary/5',
                        'disabled:opacity-50 disabled:cursor-not-allowed',
                        selectedCvId === cv._id
                          ? 'border-primary bg-primary/10'
                          : 'border-gray-200 bg-white'
                      )}
                    >
                      <div className="flex items-start gap-3">
                        <FileText className={cn(
                          'h-5 w-5 flex-shrink-0 mt-0.5',
                          selectedCvId === cv._id ? 'text-primary' : 'text-gray-400'
                        )} />
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2">
                            <p className="font-medium text-gray-900 truncate">
                              {cv.name}
                            </p>
                            {selectedCvId === cv._id && (
                              <CheckCircle2 className="h-4 w-4 text-primary flex-shrink-0" />
                            )}
                          </div>
                          <p className="text-xs text-gray-500 mt-1">
                            Tải lên: {new Date(cv.uploadedAt).toLocaleDateString('vi-VN')}
                          </p>
                        </div>
                      </div>
                    </button>
                  ))}
                </div>
              )}
            </div>
          )}

          {/* Information Box */}
          <div className="flex gap-3 p-4 rounded-lg bg-blue-50 border border-blue-200">
            <Info className="h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5" />
            <div className="space-y-2 text-sm text-blue-900">
              <p className="font-medium">Thông tin quan trọng:</p>
              <ul className="list-disc list-inside space-y-1 ml-2">
                <li>
                  Hồ sơ của bạn chỉ hiển thị cho nhà tuyển dụng khi có độ phù hợp cao
                  với công việc họ đang tuyển dụng
                </li>
                <li>
                  <strong>Chỉ CV bạn chọn</strong> sẽ hiển thị cho nhà tuyển dụng chưa mở khóa.
                  Các CV khác sẽ bị ẩn hoàn toàn
                </li>
                <li>
                  Email và số điện thoại trong CV sẽ được <strong>che bằng hình chữ nhật xám</strong> cho
                  đến khi nhà tuyển dụng mua quyền xem hồ sơ đầy đủ
                </li>
                <li>
                  Sau khi nhà tuyển dụng mở khóa, họ sẽ xem được tất cả CV và thông tin đầy đủ của bạn
                </li>
                <li>
                  Bạn có thể đổi CV hoặc tắt tính năng này bất cứ lúc nào
                </li>
              </ul>
            </div>
          </div>

          {/* Status Indicator */}
          <div className="flex items-center gap-2 text-sm">
            <div
              className={cn(
                'h-2 w-2 rounded-full',
                allowSearch ? 'bg-green-500' : 'bg-gray-400'
              )}
            />
            <span className="text-gray-600">
              Trạng thái:{' '}
              <span className={cn('font-medium', allowSearch ? 'text-green-600' : 'text-gray-600')}>
                {allowSearch ? 'Đang bật - Hồ sơ có thể được tìm thấy' : 'Đang tắt - Hồ sơ không hiển thị'}
              </span>
            </span>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default PrivacySettings;
</file>

<file path="src/pages/interviews/InterviewRoom.jsx">
import { useState, useEffect, useRef } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { 
  Mic, 
  MicOff, 
  Video, 
  VideoOff, 
  PhoneOff, 
  MessageSquare,
  HelpCircle,
  Loader2,
  AlertCircle
} from 'lucide-react';
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import ChatPanel from '@/components/interviews/ChatPanel';
import ConnectionQualityIndicator from '@/components/interviews/ConnectionQualityIndicator';
import HelpPanel from '@/components/interviews/HelpPanel';
import webrtcService from '@/services/webrtc.service';
import interviewSocketService from '@/services/interviewSocket.service';
import { getInterviewById } from '@/services/interviewService';

/**
 * InterviewRoom Component for Candidate
 * Main interview interface for candidates
 */
const InterviewRoom = () => {
  const { interviewId } = useParams();
  const navigate = useNavigate();
  
  // Video refs
  const localVideoRef = useRef(null);
  const remoteVideoRef = useRef(null);
  
  // State management
  const [isAudioEnabled, setIsAudioEnabled] = useState(true);
  const [isVideoEnabled, setIsVideoEnabled] = useState(true);
  const [isChatOpen, setIsChatOpen] = useState(false);
  const [connectionQuality, setConnectionQuality] = useState('good');
  const [qualityDetails, setQualityDetails] = useState(null);
  const [isConnected, setIsConnected] = useState(false);
  const [isRemoteUserJoined, setIsRemoteUserJoined] = useState(false);
  const [interviewData, setInterviewData] = useState(null);
  const [chatMessages, setChatMessages] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isRecording, setIsRecording] = useState(false);
  const [currentUserId, setCurrentUserId] = useState(null);
  const [hasReceivedRemoteStream, setHasReceivedRemoteStream] = useState(false);
  const [localStream, setLocalStream] = useState(null);

  // Load interview data
  useEffect(() => {
    const loadInterviewData = async () => {
      try {
        setIsLoading(true);
        const data = await getInterviewById(interviewId);
        setInterviewData(data);
        setIsLoading(false);
      } catch (err) {
        console.error('[InterviewRoom] Failed to load interview:', err);
        setError('Không thể tải thông tin phỏng vấn');
        toast.error('Không thể tải thông tin phỏng vấn');
        setIsLoading(false);
      }
    };

    if (interviewId) {
      loadInterviewData();
    }
  }, [interviewId]);

  // Setup socket connection and event handlers
  useEffect(() => {
    const setupInterview = async () => {
      try {
        // Get token
        const token = localStorage.getItem('accessToken');
        if (!token) {
          throw new Error('No authentication token');
        }

        // Connect socket
        await interviewSocketService.connect(token);
        console.log('[InterviewRoom] Socket connected');

        // Get user ID from JWT decode (via socket service)
        const userId = interviewSocketService.getCurrentUserId();
        if (userId) {
          setCurrentUserId(userId); // Still set state for other parts of the UI
          console.log('[InterviewRoom] Current user ID from JWT:', userId);
        } else {
          console.warn('[InterviewRoom] Could not get user ID immediately after connect.');
        }

        // Setup WebRTC FIRST to get local media stream
        console.log('[InterviewRoom] Starting WebRTC setup...');
        await setupWebRTC();
        console.log('[InterviewRoom] WebRTC setup completed, now setting up socket handlers...');

        // Join interview room
        const joinResponse = await interviewSocketService.joinInterview(interviewId, {
          role: 'candidate'
        });
        console.log('[InterviewRoom] Joined interview room, response:', joinResponse);

        // Check if there are existing users in the room
        if (joinResponse.existingUsers && joinResponse.existingUsers.length > 0) {
          console.log('[InterviewRoom] Found existing users:', joinResponse.existingUsers);
          setIsRemoteUserJoined(true);
        } else {
          console.log('[InterviewRoom] No existing users found, waiting for recruiter to join');
        }

        // Setup socket event handlers, passing the stable userId
        setupSocketEventHandlers(userId);
        console.log('[InterviewRoom] Socket event handlers setup completed');

        setIsConnected(true);
      } catch (err) {
        console.error('[InterviewRoom] Setup failed:', err);
        toast.error('Không thể kết nối đến phòng phỏng vấn: ' + err.message);
        setError(err.message);
      }
    };

    if (interviewId && !isLoading) {
      setupInterview();
    }

    // Cleanup
    return () => {
      cleanupInterview();
    };
  }, [interviewId, isLoading]);

  // Debug: Monitor isRemoteUserJoined state changes
  useEffect(() => {
    console.log('[InterviewRoom] isRemoteUserJoined state changed to:', isRemoteUserJoined);
  }, [isRemoteUserJoined]);

  // Effect to update local video when stream or video state changes
  useEffect(() => {
    if (localVideoRef.current && localStream) {
      console.log('[InterviewRoom] Effect: Updating local video element');
      console.log('[InterviewRoom] Video enabled:', isVideoEnabled);
      console.log('[InterviewRoom] Stream active:', localStream.active);
      
      localVideoRef.current.srcObject = localStream;
      
      if (isVideoEnabled) {
        localVideoRef.current.play().catch(e => {
          console.log('[InterviewRoom] Effect: Play failed:', e);
        });
      }
    }
  }, [isVideoEnabled, localStream]);

  const setupSocketEventHandlers = (userId) => {
    // User joined
    interviewSocketService.on('onUserJoined', (data) => {
      console.log('[InterviewRoom] ===== User joined event =====');
      console.log('[InterviewRoom] User data:', data);
      console.log('[InterviewRoom] Setting isRemoteUserJoined to TRUE (user joined event)');
      setIsRemoteUserJoined(true);
      toast.success(`${data.userName || 'Nhà tuyển dụng'} đã tham gia phỏng vấn`);
      
      // Candidate doesn't initiate - waits for offer from recruiter
      console.log('[InterviewRoom] Candidate waiting for offer from recruiter...');
    });

    // User left
    interviewSocketService.on('onUserLeft', (data) => {
      console.log('[InterviewRoom] User left event received:', data);
      console.log('[InterviewRoom] Setting isRemoteUserJoined to FALSE (user left)');
      setIsRemoteUserJoined(false);
      toast.warning(`${data.userName || 'Nhà tuyển dụng'} đã rời khỏi phỏng vấn`);
      
      // Clean up WebRTC peer connection when remote user leaves
      if (webrtcService.peerConnection && webrtcService.peerConnection.connectionState !== 'closed') {
        console.log('[InterviewRoom] Cleaning up peer connection due to user leaving');
        webrtcService.closePeerConnection(); // Only close peer, keep local stream
      }
      
      // Clear remote video
      if (remoteVideoRef.current) {
        remoteVideoRef.current.srcObject = null;
      }
      
      // IMPORTANT: Keep local stream active - don't destroy it
      // Local video should remain visible even when peer disconnects
      console.log('[InterviewRoom] Local stream preserved after peer disconnect');
    });
    
    // Handle peer disconnected event (for abrupt disconnections)
    interviewSocketService.on('onPeerDisconnected', (data) => {
      console.log('[InterviewRoom] Peer disconnected abruptly:', data);
      setIsRemoteUserJoined(false);
      
      // Clean up peer connection
      if (webrtcService.peerConnection) {
        console.log('[InterviewRoom] Cleaning up peer connection after abrupt disconnect');
        webrtcService.closePeerConnection();
      }
      
      // Clear remote video
      if (remoteVideoRef.current) {
        remoteVideoRef.current.srcObject = null;
      }
      
      // Keep local stream active
      console.log('[InterviewRoom] Local stream preserved after abrupt disconnect');
    });

    // Auth success - get user ID from JWT
    interviewSocketService.on('onAuthSuccess', (data) => {
      console.log('[InterviewRoom] Auth success, user ID:', data.userId);
      // This is a fallback, as we already pass userId to the handler setup
      if (!userId) {
        setCurrentUserId(data.userId);
      }
    });

    // WebRTC signaling - Unified signal handler for native WebRTC
    // Handles offer, answer, and ICE candidates in one event
    interviewSocketService.on('onSignal', async (data) => {
      console.log('[InterviewRoom] ===== Signal received =====');
      console.log('[InterviewRoom] Signal from:', data.from || data.fromUserId || 'remote peer');
      console.log('[InterviewRoom] Current user ID:', userId);
      console.log('[InterviewRoom] Signal type:', data.signal?.type || 'candidate');
      console.log('[InterviewRoom] Peer initialized:', !!webrtcService.peerConnection);
      
      // Ignore signals from ourselves (avoid self-signaling loop)
      const signalFrom = data.from || data.fromUserId;
      if (signalFrom && signalFrom === userId) {
        console.log('[InterviewRoom] Ignoring signal from self');
        return;
      }
      
      // Candidate logic: create peer only when receiving the first offer signal
      if (!webrtcService.peerConnection && data.signal?.type === 'offer') {
        console.log('[InterviewRoom] First signal (offer) received, creating peer as answerer');
        try {
          // Ensure we have a valid stream before initializing peer
          const streamToUse = webrtcService.localStream || localStream;
          if (!streamToUse) {
            console.error('[InterviewRoom] No local stream available to create peer. Cannot proceed.');
            toast.error('Không có tín hiệu camera/mic để bắt đầu cuộc gọi.');
            return;
          }
          
          // Verify stream has tracks
          const hasVideoTrack = streamToUse.getVideoTracks().length > 0;
          const hasAudioTrack = streamToUse.getAudioTracks().length > 0;
          console.log('[InterviewRoom] Stream validation - Video:', hasVideoTrack, 'Audio:', hasAudioTrack);
          
          if (!hasVideoTrack && !hasAudioTrack) {
            console.error('[InterviewRoom] Stream has no tracks!');
            toast.error('Không thể khởi tạo kết nối - không có audio/video track');
            return;
          }
          
          console.log('[InterviewRoom] Initializing peer connection as answerer');
          webrtcService.initializePeerConnection(streamToUse);
          console.log('[InterviewRoom] Peer initialized successfully');
          
          // Process the offer signal immediately
          console.log('[InterviewRoom] Processing offer signal');
          await webrtcService.handleSignal(data.signal);
          return;
        } catch (error) {
          console.error('[InterviewRoom] Failed to initialize peer on-the-fly:', error);
          toast.error('Lỗi khởi tạo kết nối: ' + error.message);
          return;
        }
      }
      
      // Handle signal if peer already exists
      if (webrtcService.peerConnection) {
        console.log('[InterviewRoom] Handling signal with existing peer. Signal data:', data.signal);
        await webrtcService.handleSignal(data.signal);
      } else if (data.signal?.type !== 'offer') {
        console.warn('[InterviewRoom] Peer not ready for non-offer signal');
      }
    });

    // Chat message
    interviewSocketService.on('onChatMessage', (data) => {
      console.log('[InterviewRoom] Chat message received:', data);
      console.log('[InterviewRoom] Comparing senderId:', data.senderId, 'with userId:', userId);
      
      // Skip if this is our own message (shouldn't happen with socket.to(), but just in case)
      // Convert both to string for comparison
      if (String(data.senderId) === String(userId)) {
        console.log('[InterviewRoom] Skipping own message from socket event');
        return;
      }
      
      const newMessage = {
        id: data._id || data.messageId || Date.now(),
        senderId: data.senderId,
        senderName: data.senderName || 'Nhà tuyển dụng',
        message: data.message,
        timestamp: new Date(data.timestamp)
      };
      setChatMessages(prev => [...prev, newMessage]);
    });

    // Recording notifications
    interviewSocketService.on('onRecordingStarted', (data) => {
      console.log('[InterviewRoom] Recording started:', data);
setIsRecording(true);
      toast.info('Nhà tuyển dụng đã bắt đầu ghi hình', {
        description: 'Cuộc phỏng vấn đang được ghi lại.'
      });
    });

    interviewSocketService.on('onRecordingStopped', (data) => {
      console.log('[InterviewRoom] Recording stopped:', data);
      setIsRecording(false);
      toast.info('Nhà tuyển dụng đã dừng ghi hình');
    });

    // Interview ended
    interviewSocketService.on('onInterviewEnded', (data) => {
      console.log('[InterviewRoom] Interview ended:', data);
      toast.info('Phỏng vấn đã kết thúc', {
        description: 'Cảm ơn bạn đã tham gia!'
      });
      setTimeout(() => {
        navigate('/interviews');
      }, 3000);
    });

    // Socket disconnect/reconnect
    interviewSocketService.on('onDisconnect', (reason) => {
      console.warn('[InterviewRoom] Socket disconnected:', reason);
      setIsConnected(false);
      toast.warning('Mất kết nối. Đang thử kết nối lại...');
    });

    interviewSocketService.on('onReconnect', () => {
      console.log('[InterviewRoom] Socket reconnected');
      setIsConnected(true);
      toast.success('Đã kết nối lại');
    });
  };

  const setupWebRTC = async () => {
    try {
      console.log('[InterviewRoom] Setting up WebRTC');

      // Load device settings from localStorage
      const savedSettings = localStorage.getItem('interviewDeviceSettings');
      const deviceSettings = savedSettings ? JSON.parse(savedSettings) : {};
      console.log('[InterviewRoom] Using device settings:', deviceSettings);

      // Build constraints with specific device IDs using EXACT match
      let constraints = {
        video: isVideoEnabled ? {
          deviceId: deviceSettings.videoDeviceId ? { exact: deviceSettings.videoDeviceId } : undefined,
          width: { ideal: 1280 },
          height: { ideal: 720 }
        } : false,
        audio: isAudioEnabled ? {
          deviceId: deviceSettings.audioDeviceId ? { exact: deviceSettings.audioDeviceId } : undefined,
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        } : false
      };

      // Try to get user media with specific device constraints
      let stream;
      try {
        console.log('[InterviewRoom] Requesting media with exact device IDs:', {
          video: deviceSettings.videoDeviceId,
          audio: deviceSettings.audioDeviceId
        });
        stream = await webrtcService.getUserMedia(constraints);
        console.log('[InterviewRoom] Successfully got media with selected devices');
      } catch (error) {
        console.warn('[InterviewRoom] Failed with exact device IDs, trying fallback:', error);
        
        // Fallback to basic constraints without specific device IDs
        const fallbackConstraints = {
          video: isVideoEnabled ? {
            width: { ideal: 1280 },
            height: { ideal: 720 }
          } : false,
          audio: isAudioEnabled ? {
            echoCancellation: true,
            noiseSuppression: true,
            autoGainControl: true
          } : false
        };
        
        stream = await webrtcService.getUserMedia(fallbackConstraints);
        console.log('[InterviewRoom] Using fallback default devices');
        toast.warning('Không thể sử dụng thiết bị đã chọn, đang dùng thiết bị mặc định');
      }

      // Log which devices are actually being used
      const videoTrack = stream.getVideoTracks()[0];
      const audioTrack = stream.getAudioTracks()[0];
      if (videoTrack) {
        const settings = videoTrack.getSettings();
        console.log('[InterviewRoom] ✓ Using video device:', videoTrack.label, 'ID:', settings.deviceId);
      }
      if (audioTrack) {
        const settings = audioTrack.getSettings();
        console.log('[InterviewRoom] ✓ Using audio device:', audioTrack.label, 'ID:', settings.deviceId);
      }

      // Attach to local video
      if (localVideoRef.current) {
        localVideoRef.current.srcObject = stream;
      }

      // Setup WebRTC event handlers BEFORE initializing peer connection
      // Clear any existing handlers first to avoid duplicates
      webrtcService.eventHandlers.clear();
      
      // With simple-peer, all signaling (offer/answer/ICE) goes through onSignal
      webrtcService.on('onSignal', (signal) => {
        console.log('[InterviewRoom] Sending signal:', signal.type || 'candidate');
        interviewSocketService.sendSignal(interviewId, signal);
      });

      webrtcService.on('onRemoteStream', (remoteStream) => {
        console.log('[InterviewRoom] ===== Remote stream received =====');
        console.log('[InterviewRoom] Stream ID:', remoteStream.id);
        
        if (remoteVideoRef.current) {
          console.log('[InterviewRoom] Remote video ref available, setting stream directly.');
          // To be safe, check if we're trying to set the same stream object
          if (remoteVideoRef.current.srcObject !== remoteStream) {
            remoteVideoRef.current.srcObject = remoteStream;
            setHasReceivedRemoteStream(true);
            
            // Attempt to play, catching any errors
            remoteVideoRef.current.play().catch(e => {
                console.error('[InterviewRoom] Remote video auto-play failed.', e);
            });
          }
        } else {
            // This case is highly unlikely, but good to have a log for.
            console.error('[InterviewRoom] CRITICAL: Remote stream received but remoteVideoRef is not available!');
        }
      });

      webrtcService.on('onQualityUpdate', ({ metrics }) => {
        console.log('[InterviewRoom] Quality update:', metrics);
        setConnectionQuality(metrics.quality);
        setQualityDetails(metrics.details);

        if (metrics.quality === 'poor') {
          toast.warning('Chất lượng kết nối kém', {
            id: 'poor-quality',
            description: 'Hãy kiểm tra kết nối mạng của bạn.',
            duration: 5000
          });
        }
      });

      webrtcService.on('onConnectionFailed', ({ reason }) => {
        console.error('[InterviewRoom] Connection failed:', reason);
        toast.error('Mất kết nối', {
          description: 'Không thể kết nối với nhà tuyển dụng. Vui lòng thử lại.'
        });
      });

      webrtcService.on('onError', ({ message }) => {
        toast.error(message);
      });

      webrtcService.on('onLocalStreamUpdate', (stream) => {
       console.log('[InterviewRoom] ===== Local stream updated =====');
        console.log('[InterviewRoom] Stream active:', stream.active);
        // Update state to trigger effect
        setLocalStream(stream);
      });

      // Store stream for peer initialization when receiving signal
      console.log('[InterviewRoom] Stream ready for candidate, waiting for signal from recruiter');
      setLocalStream(stream); // Store stream in component state as backup
      console.log('[InterviewRoom] Candidate ready - will create peer when receiving first signal (offer)');
      
      // Debug: Check video elements after a short delay
      setTimeout(() => {
        console.log('[InterviewRoom] ===== Video Elements Debug =====');
        if (localVideoRef.current) {
          console.log('[InterviewRoom] Local video srcObject:', localVideoRef.current.srcObject);
          console.log('[InterviewRoom] Local video readyState:', localVideoRef.current.readyState);
          console.log('[InterviewRoom] Local video paused:', localVideoRef.current.paused);
        }
        if (remoteVideoRef.current) {
          console.log('[InterviewRoom] Remote video srcObject:', remoteVideoRef.current.srcObject);
          console.log('[InterviewRoom] Remote video readyState:', remoteVideoRef.current.readyState);
          console.log('[InterviewRoom] Remote video paused:', remoteVideoRef.current.paused);
        }
      }, 2000);

      console.log('[InterviewRoom] WebRTC setup complete');
    } catch (error) {
      console.error('[InterviewRoom] WebRTC setup failed:', error);
      toast.error('Không thể thiết lập kết nối video: ' + error.message);
      throw error;
    }
  };

  const cleanupInterview = () => {
    console.log('[InterviewRoom] Cleaning up');

    // Remove event handlers
    interviewSocketService.off('onAuthSuccess');
    interviewSocketService.off('onUserJoined');
    interviewSocketService.off('onUserLeft');
    interviewSocketService.off('onPeerDisconnected');
    interviewSocketService.off('onSignal');
    interviewSocketService.off('onChatMessage');
    interviewSocketService.off('onRecordingStarted');
    interviewSocketService.off('onRecordingStopped');
    interviewSocketService.off('onInterviewEnded');
    interviewSocketService.off('onDisconnect');
    interviewSocketService.off('onReconnect');

    webrtcService.off('onSignal');
    webrtcService.off('onRemoteStream');
    webrtcService.off('onConnectionEstablished');
    webrtcService.off('onConnectionFailed');
    webrtcService.off('onError');
    webrtcService.off('onLocalStreamUpdate');

    // Leave interview and disconnect
    interviewSocketService.leaveInterview(interviewId);
    webrtcService.closePeerConnection();
  };

  const toggleAudio = async () => {
    const enabled = !isAudioEnabled;
    setIsAudioEnabled(enabled);
    const success = await webrtcService.toggleAudio(enabled);
    if (success) {
      // toast.info(enabled ? 'Đã bật microphone' : 'Đã tắt microphone');
    } else {
      setIsAudioEnabled(!enabled);
    }
  };

  const toggleVideo = async () => {
    const enabled = !isVideoEnabled;
    console.log('[InterviewRoom] Toggling video to:', enabled);
    
    const success = await webrtcService.toggleVideo(enabled);
    if (success) {
      console.log('[InterviewRoom] Video toggle successful');
      setIsVideoEnabled(enabled);
      
      // Update local stream state to trigger effect
      const updatedStream = webrtcService.getLocalStream();
      if (updatedStream) {
        setLocalStream(updatedStream);
      }
      
      // toast.info(enabled ? 'Đã bật camera' : 'Đã tắt camera');
    } else {
      console.error('[InterviewRoom] Video toggle failed');
      setIsVideoEnabled(!enabled);
    }
  };

  const handleEndCall = () => {
    if (confirm('Bạn có chắc muốn rời khỏi phỏng vấn?')) {
      cleanupInterview();
      navigate('/interviews');
    }
  };

  const handleSendMessage = async (message) => {
    try {
      const response = await interviewSocketService.sendChatMessage(interviewId, message);
      
      // Add message to local state immediately for better UX
      const newMessage = {
        id: response.message?._id || Date.now(),
        senderId: currentUserId,
        senderName: 'Bạn',
        message,
        timestamp: response.message?.timestamp || new Date()
      };
      setChatMessages(prev => [...prev, newMessage]);
    } catch (error) {
      console.error('[InterviewRoom] Failed to send message:', error);
      toast.error('Không thể gửi tin nhắn');
    }
  };

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-screen bg-gray-900">
        <div className="text-center">
          <Loader2 className="h-12 w-12 animate-spin text-white mx-auto mb-4" />
          <p className="text-white text-lg">Đang tải phỏng vấn...</p>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="flex items-center justify-center h-screen bg-gray-900 p-4">
        <Card className="max-w-md p-6">
          <Alert variant="destructive">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>Lỗi</AlertTitle>
            <AlertDescription>{error}</AlertDescription>
          </Alert>
          <Button
            className="w-full mt-4"
            onClick={() => navigate('/interviews')}
          >
            Quay lại danh sách phỏng vấn
          </Button>
        </Card>
      </div>
    );
  }

  return (
    <div className="h-screen bg-gray-900 flex flex-col">
      {/* Header */}
      <div className="bg-gray-800 border-b border-gray-700 px-6 py-4">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-white text-xl font-semibold">
              {interviewData?.jobTitle || 'Phỏng vấn trực tuyến'}
            </h1>
            <p className="text-gray-400 text-sm">
              {interviewData?.companyName || 'Công ty'}
            </p>
          </div>
          <div className="flex items-center gap-3">
            {isRecording && (
              <Badge variant="destructive" className="flex items-center gap-1">
                <span className="h-2 w-2 bg-red-500 rounded-full animate-pulse" />
                Đang ghi hình
              </Badge>
            )}
            <ConnectionQualityIndicator
              quality={connectionQuality}
              details={qualityDetails}
            />
          </div>
        </div>
      </div>

      {/* Video Grid */}
      <div className="flex-1 p-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
        {/* Remote Video (Recruiter) */}
        <Card className="relative bg-gray-800 overflow-hidden h-full">
          <video
            ref={remoteVideoRef}
            autoPlay
            playsInline
            className="w-full h-full object-cover"
          />
          {!isRemoteUserJoined && (
            <div className="absolute inset-0 flex flex-col items-center justify-center bg-gray-800">
              <Loader2 className="h-12 w-12 animate-spin text-gray-400 mb-4" />
              <p className="text-white text-lg">Đang chờ nhà tuyển dụng tham gia...</p>
              <p className="text-gray-400 text-sm mt-2">Vui lòng đợi trong giây lát</p>
            </div>
          )}
          <div className="absolute bottom-4 left-4">
            <Badge className="bg-gray-900/80 text-white">
              Nhà tuyển dụng
            </Badge>
          </div>
        </Card>

        {/* Local Video (Self) */}
        <Card className="relative bg-gray-800 overflow-hidden h-full">
          {isVideoEnabled ? (
            <video
              ref={localVideoRef}
              autoPlay
              playsInline
              muted
              className="w-full h-full object-cover mirror"
            />
          ) : (
            <div className="absolute inset-0 flex flex-col items-center justify-center bg-gray-800">
              <VideoOff className="h-12 w-12 text-gray-400 mb-2" />
              <p className="text-white">Camera đã tắt</p>
            </div>
          )}
          <div className="absolute bottom-4 left-4">
            <Badge className="bg-gray-900/80 text-white">Bạn</Badge>
          </div>
        </Card>
      </div>

      {/* Controls */}
      <div className="bg-gray-800 border-t border-gray-700 px-6 py-4">
        <div className="flex items-center justify-center gap-4">
          {/* Audio Toggle */}
          <Button
            size="lg"
            variant={isAudioEnabled ? 'default' : 'destructive'}
            onClick={toggleAudio}
            className="rounded-full w-14 h-14"
          >
            {isAudioEnabled ? (
              <Mic className="h-6 w-6" />
            ) : (
              <MicOff className="h-6 w-6" />
            )}
          </Button>

          {/* Video Toggle */}
          <Button
            size="lg"
            variant={isVideoEnabled ? 'default' : 'destructive'}
            onClick={toggleVideo}
            className="rounded-full w-14 h-14"
          >
            {isVideoEnabled ? (
              <Video className="h-6 w-6" />
            ) : (
              <VideoOff className="h-6 w-6" />
            )}
          </Button>

          {/* End Call */}
          <Button
            size="lg"
            variant="destructive"
            onClick={handleEndCall}
            className="rounded-full w-14 h-14"
          >
            <PhoneOff className="h-6 w-6" />
          </Button>

          {/* Chat Toggle */}
          <Button
            size="lg"
            variant="outline"
            onClick={() => setIsChatOpen(!isChatOpen)}
            className="rounded-full w-14 h-14 bg-gray-700 border-gray-600 text-white hover:bg-gray-600"
          >
            <MessageSquare className="h-6 w-6" />
          </Button>

          {/* Help Button */}
          <HelpPanel />
        </div>
      </div>

      {/* Chat Panel */}
      {isChatOpen && (
        <div className="fixed right-0 top-0 bottom-0 w-96 bg-gray-800 border-l border-gray-700 shadow-xl z-50">
          <ChatPanel
            messages={chatMessages}
            onSendMessage={handleSendMessage}
            onClose={() => setIsChatOpen(false)}
            currentUserId={currentUserId}
          />
        </div>
      )}

      {/* Connection Status Warning */}
      {!isConnected && (
        <div className="fixed top-20 left-1/2 transform -translate-x-1/2 z-50">
          <Alert variant="destructive" className="shadow-lg">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>Mất kết nối</AlertTitle>
            <AlertDescription>
              Đang cố gắng kết nối lại...
            </AlertDescription>
          </Alert>
        </div>
      )}
    </div>
  );
};

export default InterviewRoom;
</file>

<file path="src/pages/interviews/MyInterviews.jsx">
import React, { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';
import { 
  Calendar, 
  Clock, 
  Video, 
  CheckCircle, 
  XCircle,
  AlertCircle,
  Search,
  Filter,
  ArrowLeft,
  Lightbulb
} from 'lucide-react';
import { Button } from '../../components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';
import { Badge } from '../../components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../../components/ui/tabs';
import { Input } from '../../components/ui/input';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../components/ui/select';
import { Alert, AlertDescription, AlertTitle } from '../../components/ui/alert';
import { Skeleton } from '../../components/ui/skeleton';
import { EmptyState } from '../../components/common/EmptyState';
import { ErrorState } from '../../components/common/ErrorState';

import { 
  getMyInterviews, 
  checkCanJoinInterview,
  formatInterviewTime 
} from '../../services/interviewService';
import { toast } from 'sonner';

/**
 * MyInterviews Page
 * Displays candidate's interviews with tabs for upcoming and past interviews
 */
const MyInterviews = () => {
  const navigate = useNavigate();
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const [activeTab, setActiveTab] = useState('upcoming');

  // Fetch all interviews
  const { 
    data: interviewsData, 
    isLoading, 
    isError, 
    error,
    refetch 
  } = useQuery({
    queryKey: ['myInterviews'],
    queryFn: () => getMyInterviews(),
    refetchInterval: 60000, // Refetch every minute to update join buttons
  });
  const interviews = interviewsData?.data || [];

  // Categorize interviews - Backend uses uppercase status values
  const upcomingInterviews = interviews.filter((interview) => {
    // SCHEDULED or RESCHEDULED interviews that haven't passed yet
    if (interview.status !== 'SCHEDULED' && interview.status !== 'RESCHEDULED') return false;
    const { isPast } = formatInterviewTime(interview.scheduledTime);
    return !isPast;
  });

  const pastInterviews = interviews.filter((interview) => {
    if (interview.status === 'CANCELLED') return true;
    if (interview.status === 'COMPLETED') return true;
    if (interview.status === 'SCHEDULED' || interview.status === 'RESCHEDULED') {
      const { isPast } = formatInterviewTime(interview.scheduledTime);
      return isPast;
    }
    return false;
  });

  // Filter interviews based on search term
  const filterInterviews = (interviewList) => {
    if (!searchTerm) return interviewList;
    
    const lowerSearch = searchTerm.toLowerCase();
    return interviewList.filter((interview) => {
      const jobSnapshot = interview.application?.jobSnapshot || {};
      return (
        jobSnapshot.title?.toLowerCase().includes(lowerSearch) ||
        jobSnapshot.company?.toLowerCase().includes(lowerSearch) ||
        interview.roomName?.toLowerCase().includes(lowerSearch)
      );
    });
  };

  const filteredUpcoming = filterInterviews(upcomingInterviews);
  const filteredPast = filterInterviews(pastInterviews);

  const handleJoinInterview = (interviewId, scheduledTime) => {
    const { canJoin, reason } = checkCanJoinInterview(scheduledTime);
    
    if (!canJoin) {
      toast.error('Cannot join interview', {
        description: reason
      });
      return;
    }
    
    // Go to device test first
    navigate(`/interviews/${interviewId}/device-test`);
  };

  const handleDeviceTest = () => {
    navigate('/interviews/device-test');
  };



  if (isLoading) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-7xl">
        <Skeleton className="h-8 w-64 mb-6" />
        <Skeleton className="h-12 w-full mb-6" />
        <div className="space-y-4">
          {[1, 2, 3].map((i) => (
            <Skeleton key={i} className="h-64 w-full" />
          ))}
        </div>
      </div>
    );
  }

  if (isError) {
    return (
      <div className="container mx-auto px-4 py-8 max-w-7xl">
        <Button variant="ghost" onClick={() => navigate(-1)} className="mb-6">
          <ArrowLeft className="w-4 h-4 mr-2" />
          Back
        </Button>
        <ErrorState 
          message={error?.response?.data?.message || 'Failed to load interviews'} 
          onRetry={refetch}
        />
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-7xl">
      {/* Header */}
      <div className="mb-6">
        <Button variant="ghost" onClick={() => navigate(-1)} className="mb-4">
          <ArrowLeft className="w-4 h-4 mr-2" />
          Back
        </Button>
        <h1 className="text-3xl font-bold text-gray-900 dark:text-gray-100">
          My Interviews
        </h1>
        <p className="text-gray-600 dark:text-gray-400 mt-2">
          Manage your interview invitations and scheduled interviews
        </p>
      </div>

      {/* Search and Filter */}
      <Card className="mb-6">
        <CardContent className="pt-6">
          <div className="flex flex-col md:flex-row gap-4">
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
              <Input
                placeholder="Search by job title, company, or location..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="pl-10"
              />
            </div>
            <Button variant="outline" onClick={handleDeviceTest}>
              <Video className="w-4 h-4 mr-2" />
              Test Device
            </Button>
          </div>
        </CardContent>
      </Card>

      {/* Tabs */}
      <Tabs value={activeTab} onValueChange={setActiveTab} className="space-y-6">
        <TabsList className="grid w-full grid-cols-2">
          <TabsTrigger value="upcoming" className="relative">
            Upcoming
            {filteredUpcoming.length > 0 && (
              <Badge variant="default" className="ml-2 px-1.5 min-w-[20px] h-5">
                {filteredUpcoming.length}
              </Badge>
            )}
          </TabsTrigger>
          <TabsTrigger value="past">Past</TabsTrigger>
        </TabsList>

        {/* Upcoming Interviews Tab */}
        <TabsContent value="upcoming" className="space-y-4">
          {filteredUpcoming.length === 0 ? (
            <EmptyState
              icon={Video}
              title="No upcoming interviews"
              description="Your accepted interviews will appear here."
            />
          ) : (
            <>
              {/* Interview Preparation Tips */}
              <Alert className="bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-900">
                <Lightbulb className="h-4 w-4 text-blue-600" />
                <AlertTitle className="text-blue-900 dark:text-blue-100">
                  Interview Preparation Tips
                </AlertTitle>
                <AlertDescription className="text-blue-800 dark:text-blue-200">
                  <ul className="list-disc list-inside space-y-1 mt-2">
                    <li>Test your camera and microphone 15 minutes before the interview</li>
                    <li>Ensure you have a stable internet connection</li>
                    <li>Prepare your resume and job description for reference</li>
                    <li>Find a quiet, well-lit space for the interview</li>
                  </ul>
                </AlertDescription>
              </Alert>

              <div className="grid gap-6">
                {filteredUpcoming.map((interview) => (
                  <InterviewCard
                    key={interview.id}
                    interview={interview}
                    onJoin={handleJoinInterview}
                    onDeviceTest={handleDeviceTest}
                  />
                ))}
              </div>
            </>
          )}
        </TabsContent>

        {/* Past Interviews Tab */}
        <TabsContent value="past" className="space-y-4">
          {filteredPast.length === 0 ? (
            <EmptyState
              icon={CheckCircle}
              title="No past interviews"
              description="Your completed or cancelled interviews will appear here."
            />
          ) : (
            <div className="grid gap-6">
              {filteredPast.map((interview) => (
                <PastInterviewCard key={interview.id} interview={interview} />
              ))}
            </div>
          )}
        </TabsContent>
      </Tabs>
    </div>
  );
};

/**
 * InterviewCard Component
 * Displays upcoming interview details with join button
 */
const InterviewCard = ({ interview, onJoin, onDeviceTest }) => {
  const jobSnapshot = interview.application?.jobSnapshot || {};
  const { date, time, relative, isNow } = formatInterviewTime(interview.scheduledTime);
  const { canJoin, reason, minutesUntilStart } = checkCanJoinInterview(interview.scheduledTime);

  return (
    <Card className="overflow-hidden hover:shadow-lg transition-shadow duration-300">
      <CardHeader className="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-950/20 dark:to-emerald-950/20">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            <div className="flex items-center gap-2 mb-2">
              <Badge variant="default" className={interview.status === 'RESCHEDULED' ? 'bg-amber-600' : 'bg-green-600'}>
                {interview.status === 'RESCHEDULED' ? 'Rescheduled' : 'Scheduled'}
              </Badge>
              {isNow && (
                <Badge variant="default" className="bg-red-600 animate-pulse">
                  Happening Now
                </Badge>
              )}
            </div>
            <CardTitle className="text-xl">{jobSnapshot.title || 'Interview'}</CardTitle>
            <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
              {jobSnapshot.company || 'Company'}
            </p>
          </div>
          <Video className="w-8 h-8 text-green-600" />
        </div>
      </CardHeader>

      <CardContent className="pt-6">
        <div className="space-y-3 mb-6">
          <div className="flex items-center gap-3 text-gray-700 dark:text-gray-300">
            <Calendar className="w-5 h-5 text-green-600 flex-shrink-0" />
            <div>
              <p className="font-medium">{date}</p>
              <p className="text-sm text-gray-500 dark:text-gray-400">{relative}</p>
            </div>
          </div>

          <div className="flex items-center gap-3 text-gray-700 dark:text-gray-300">
            <Clock className="w-5 h-5 text-green-600 flex-shrink-0" />
            <span>{time}</span>
          </div>
        </div>

        {!canJoin && (
          <Alert className="mb-4">
            <AlertCircle className="h-4 w-4" />
            <AlertDescription>{reason}</AlertDescription>
          </Alert>
        )}

        <div className="flex gap-3">
          <Button
            variant="outline"
            onClick={onDeviceTest}
            className="flex-1"
          >
            <Video className="w-4 h-4 mr-2" />
            Test Device
          </Button>
          <Button
            variant="default"
            onClick={() => onJoin(interview.id, interview.scheduledTime)}
            disabled={!canJoin}
            className="flex-1 bg-green-600 hover:bg-green-700"
          >
            <Video className="w-4 h-4 mr-2" />
            Join Interview
          </Button>
        </div>
      </CardContent>
    </Card>
  );
};

/**
 * PastInterviewCard Component
 * Displays completed or cancelled interview details
 */
const PastInterviewCard = ({ interview }) => {
  const jobSnapshot = interview.application?.jobSnapshot || {};
  const { date, time } = formatInterviewTime(interview.scheduledTime);

  const statusConfig = {
    COMPLETED: {
      badge: { variant: 'default', className: 'bg-blue-600', text: 'Completed' },
      icon: CheckCircle,
      iconColor: 'text-blue-600'
    },
    CANCELLED: {
      badge: { variant: 'destructive', text: 'Cancelled' },
      icon: XCircle,
      iconColor: 'text-red-600'
    },
    RESCHEDULED: {
      badge: { variant: 'default', className: 'bg-amber-600', text: 'Rescheduled (Past)' },
      icon: Clock,
      iconColor: 'text-amber-600'
    }
  };

  const config = statusConfig[interview.status] || statusConfig.COMPLETED;
  const StatusIcon = config.icon;

  return (
    <Card className="opacity-90">
      <CardHeader className="bg-gray-50 dark:bg-gray-900/50">
        <div className="flex items-start justify-between">
          <div className="flex-1">
            <div className="mb-2">
              <Badge {...config.badge}>{config.badge.text}</Badge>
            </div>
            <CardTitle className="text-xl">{jobSnapshot.title || 'Interview'}</CardTitle>
            <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
              {jobSnapshot.company || 'Company'}
            </p>
          </div>
          <StatusIcon className={`w-8 h-8 ${config.iconColor}`} />
        </div>
      </CardHeader>

      <CardContent className="pt-6">
        <div className="space-y-3">
          <div className="flex items-center gap-3 text-gray-700 dark:text-gray-300">
            <Calendar className="w-5 h-5 text-gray-400 flex-shrink-0" />
            <span>{date}</span>
          </div>

          <div className="flex items-center gap-3 text-gray-700 dark:text-gray-300">
            <Clock className="w-5 h-5 text-gray-400 flex-shrink-0" />
            <span>{time}</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};

export default MyInterviews;
</file>

<file path="src/pages/JobMapPage.jsx">
import React, { useState } from 'react';
import { JobMapLeaflet } from '@/components/jobs/JobMapLeaflet';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Label } from '@/components/ui/label';

export default function JobMapPage() {
  const [filters, setFilters] = useState({});

  const handleFilterChange = (key, value) => {
    setFilters(prev => ({
      ...prev,
      [key]: value === 'all' ? undefined : value
    }));
  };

  return (
    <div className="container mx-auto py-8 space-y-6">
      <div className="space-y-2">
        <h1 className="text-3xl font-bold text-gradient-primary">
          Tìm kiếm công việc trên bản đồ
        </h1>
        <p className="text-muted-foreground">
          Khám phá các cơ hội việc làm xung quanh bạn
        </p>
      </div>

      {/* Filters */}
      <Card variant="glass">
        <CardHeader>
          <CardTitle>Bộ lọc</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="space-y-2">
              <Label>Ngành nghề</Label>
              <Select onValueChange={(value) => handleFilterChange('category', value)}>
                <SelectTrigger>
                  <SelectValue placeholder="Tất cả ngành nghề" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Tất cả</SelectItem>
                  <SelectItem value="IT">Công nghệ thông tin</SelectItem>
                  <SelectItem value="MARKETING">Marketing</SelectItem>
                  <SelectItem value="SALES">Kinh doanh</SelectItem>
                  <SelectItem value="ACCOUNTING">Kế toán</SelectItem>
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-2">
              <Label>Loại công việc</Label>
              <Select onValueChange={(value) => handleFilterChange('type', value)}>
                <SelectTrigger>
                  <SelectValue placeholder="Tất cả loại" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Tất cả</SelectItem>
                  <SelectItem value="FULL_TIME">Toàn thời gian</SelectItem>
                  <SelectItem value="PART_TIME">Bán thời gian</SelectItem>
                  <SelectItem value="INTERNSHIP">Thực tập</SelectItem>
                  <SelectItem value="CONTRACT">Hợp đồng</SelectItem>
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-2">
              <Label>Hình thức làm việc</Label>
              <Select onValueChange={(value) => handleFilterChange('workType', value)}>
                <SelectTrigger>
                  <SelectValue placeholder="Tất cả hình thức" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">Tất cả</SelectItem>
                  <SelectItem value="ON_SITE">Tại văn phòng</SelectItem>
                  <SelectItem value="REMOTE">Từ xa</SelectItem>
                  <SelectItem value="HYBRID">Kết hợp</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Map */}
      <Card variant="glass" className="overflow-hidden">
        <div className="h-[600px]">
          <JobMapLeaflet 
            filters={filters}
            initialCenter={[10.762622, 106.660172]}
            initialZoom={12}
          />
        </div>
      </Card>

      {/* Instructions */}
      <Card variant="glass">
        <CardContent className="pt-6">
          <div className="space-y-2 text-sm text-muted-foreground">
            <p>💡 <strong>Hướng dẫn sử dụng:</strong></p>
            <ul className="list-disc list-inside space-y-1 ml-4">
              <li>Di chuyển bản đồ để khám phá các khu vực khác nhau</li>
              <li>Phóng to để xem chi tiết các công việc trong cụm</li>
              <li>Click vào marker để xem thông tin công việc</li>
              <li>Sử dụng bộ lọc để tìm kiếm chính xác hơn</li>
            </ul>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
</file>

<file path="src/pages/jobs/ApplicationDetailPage.jsx">
import React from 'react';
import { useQuery } from '@tanstack/react-query';
import { useParams, useLocation, useNavigate, Link } from 'react-router-dom';
import { getApplicationById } from '../../services/jobService';
import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from '../../components/ui/card';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '../../components/ui/dialog';
import { Button } from '../../components/ui/button';
import { Badge } from '../../components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '../../components/ui/avatar';
import { Skeleton } from '../../components/ui/skeleton';
import { ErrorState } from '../../components/common/ErrorState';
import { cn } from '../../lib/utils';
import {
  FileText,
  Calendar,
  Clock,
  User,
  Mail,
  Phone,
  Download,
  ExternalLink,
  ArrowLeft,
  Building,
  Eye,
  CheckCircle,
  XCircle,
  AlertCircle,
  Hourglass,
  FileIcon,
  Star,
} from 'lucide-react';

const getStatusInfo = (status) => {
  const statusMap = {
    PENDING: {
      label: 'Đang chờ',
      icon: <Hourglass className="h-4 w-4" />,
      textColor: 'text-yellow-700',
      borderColor: 'border-yellow-200',
      bgColor: 'bg-yellow-50',
    },
    REVIEWING: {
      label: 'Đang xem xét',
      icon: <Eye className="h-4 w-4" />,
      textColor: 'text-blue-700',
      borderColor: 'border-blue-200',
      bgColor: 'bg-blue-50',
    },
    SCHEDULED_INTERVIEW: {
      label: 'Đã xếp lịch phỏng vấn',
      icon: <Calendar className="h-4 w-4" />,
      textColor: 'text-cyan-700',
      borderColor: 'border-cyan-200',
      bgColor: 'bg-cyan-50',
    },
    INTERVIEW: {
      label: 'Phỏng vấn',
      icon: <AlertCircle className="h-4 w-4" />,
      textColor: 'text-purple-700',
      borderColor: 'border-purple-200',
      bgColor: 'bg-purple-50',
    },
    ACCEPTED: {
      label: 'Đã chấp nhận',
      icon: <CheckCircle className="h-4 w-4" />,
      textColor: 'text-green-700',
      borderColor: 'border-green-200',
      bgColor: 'bg-green-50',
    },
    REJECTED: {
      label: 'Đã từ chối',
      icon: <XCircle className="h-4 w-4" />,
      textColor: 'text-red-700',
      borderColor: 'border-red-200',
      bgColor: 'bg-red-50',
    },
  };
  return statusMap[status] || statusMap['PENDING'];
};

const getRatingInfo = (rating) => {
  if (!rating) return null;
  const ratingMap = {
    SUITABLE: {
      label: 'Phù hợp',
      icon: <Star className="h-4 w-4" />,
      textColor: 'text-green-700',
      borderColor: 'border-green-200',
      bgColor: 'bg-green-50',
    },
    NOT_SUITABLE: {
      label: 'Không phù hợp',
      icon: <XCircle className="h-4 w-4" />,
      textColor: 'text-red-700',
      borderColor: 'border-red-200',
      bgColor: 'bg-red-50',
    },
    CONSIDERING: {
      label: 'Đang cân nhắc',
      icon: <Eye className="h-4 w-4" />,
      textColor: 'text-blue-700',
      borderColor: 'border-blue-200',
      bgColor: 'bg-blue-50',
    },
  };
  return ratingMap[rating];
};

const formatDateTime = (dateString) => {
  if (!dateString) return 'N/A';
  return new Date(dateString).toLocaleString('vi-VN', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  });
};

const DetailSkeleton = () => (
  <div className="space-y-6">
    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
      <Card>
        <CardHeader>
          <Skeleton className="h-5 w-1/2" />
        </CardHeader>
        <CardContent className="space-y-3">
          <Skeleton className="h-8 w-1/3" />
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-full" />
        </CardContent>
      </Card>
      <Card>
        <CardHeader>
          <Skeleton className="h-5 w-1/2" />
        </CardHeader>
        <CardContent className="space-y-3">
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-full" />
          <Skeleton className="h-4 w-full" />
        </CardContent>
      </Card>
    </div>
    <Card>
      <CardHeader>
        <Skeleton className="h-5 w-1/4" />
      </CardHeader>
      <CardContent>
        <Skeleton className="h-20 w-full" />
      </CardContent>
    </Card>
    <Card>
      <CardHeader>
        <Skeleton className="h-5 w-1/4" />
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <Skeleton className="h-12 w-12 rounded-lg" />
            <div>
              <Skeleton className="h-5 w-32" />
              <Skeleton className="h-4 w-24 mt-1" />
            </div>
          </div>
          <div className="flex gap-2">
            <Skeleton className="h-9 w-24" />
            <Skeleton className="h-9 w-24" />
          </div>
        </div>
      </CardContent>
    </Card>
  </div>
);

const ApplicationDetailPage = () => {
  const { id } = useParams();
  const location = useLocation();
  const navigate = useNavigate();
  const initialData = location.state?.application;

  const {
    data: application,
    isLoading,
    isError,
    error,
    refetch,
  } = useQuery({
    queryKey: ['application', id],
    queryFn: () => getApplicationById(id),
    initialData: initialData,
  });
  if (isLoading && !initialData) {
    return (
      <div className="container mx-auto px-4 py-6">
        <DetailSkeleton />
      </div>
    );
  }

  if (isError) {
    return (
      <div className="container mx-auto px-4 py-6">
        <ErrorState
          message={error.response?.data?.message || 'Không thể tải chi tiết đơn ứng tuyển.'}
          onRetry={refetch}
        />
      </div>
    );
  }

  if (!application) {
    return (
      <div className="container mx-auto px-4 py-6">
        <ErrorState message="Không tìm thấy đơn ứng tuyển." />
      </div>
    );
  }

  const statusInfo = getStatusInfo(application.status);
  const ratingInfo = getRatingInfo(application.candidateRating);
  const jobSnapshot = application.jobSnapshot || {};

  return (
    <div className="container mx-auto px-4 py-6">
      <div className="max-w-4xl mx-auto">
        <Button
          variant="outline"
          onClick={() => navigate('/dashboard/applications')}
          className="mb-4"
        >
          <ArrowLeft className="h-4 w-4 mr-2" />
          Quay lại danh sách
        </Button>

        <div className="bg-white rounded-2xl p-6 md:p-8 mt-4 border shadow-sm">
          {/* Header */}
          <div className="flex items-center gap-4">
            <Avatar className="h-16 w-16">
              <AvatarImage src={jobSnapshot.logo} alt={jobSnapshot.company} />
              <AvatarFallback className="text-xl">
                {jobSnapshot.company?.charAt(0) || 'C'}
              </AvatarFallback>
            </Avatar>
            <div>
              <h1 className="text-2xl font-bold">{jobSnapshot.title}</h1>
              <p className="text-muted-foreground flex items-center gap-2">
                <Building className="h-4 w-4" />
                {jobSnapshot.company}
              </p>
            </div>
          </div>

          <hr className="my-6 border-gray-200" />

          {/* Body */}
          <div className="space-y-6">
            {/* Status and Info */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <Card>
                <CardHeader>
                  <CardTitle className="text-base">Trạng thái</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="flex flex-wrap gap-4 items-center">
                    <Badge
                      variant="outline"
                      className={cn(
                        'flex items-center gap-2 w-fit px-4 py-2 text-sm',
                        statusInfo.textColor,
                        statusInfo.borderColor,
                        statusInfo.bgColor,
                      )}
                    >
                      {statusInfo.icon}
                      {statusInfo.label}
                    </Badge>
                    {ratingInfo && (
                      <Badge
                        variant="outline"
                        className={cn(
                          'flex items-center gap-2 w-fit px-4 py-2 text-sm',
                          ratingInfo.textColor,
                          ratingInfo.borderColor,
                          ratingInfo.bgColor,
                        )}
                      >
                        {ratingInfo.icon}
                        {ratingInfo.label}
                      </Badge>
                    )}
                  </div>
                  <div className="mt-4 space-y-2 text-sm text-muted-foreground">
                    <div className="flex items-center gap-2">
                      <Calendar className="h-4 w-4" />
                      <span>Ứng tuyển: {formatDateTime(application.appliedAt)}</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <Clock className="h-4 w-4" />
                      <span>Cập nhật: {formatDateTime(application.lastStatusUpdateAt)}</span>
                    </div>
                  </div>
                </CardContent>
              </Card>
              <Card>
                <CardHeader>
                  <CardTitle className="text-base">Thông tin của bạn</CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <div className="flex items-center gap-2">
                    <User className="h-4 w-4 text-primary" />
                    <span className="font-medium">{application.candidateName}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Mail className="h-4 w-4 text-primary" />
                    <span>{application.candidateEmail}</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Phone className="h-4 w-4 text-primary" />
                    <span>{application.candidatePhone}</span>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Cover Letter */}
            {application.coverLetter && (
              <Card>
                <CardHeader>
                  <CardTitle className="text-base">Thư giới thiệu</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="bg-muted/50 p-4 rounded-lg border">
                    <p className="text-sm leading-relaxed whitespace-pre-wrap text-foreground">
                      {application.coverLetter}
                    </p>
                  </div>
                </CardContent>
              </Card>
            )}

            {/* Submitted CV */}
            {application.submittedCV && (
              <Dialog>
                <Card>
                  <CardHeader>
                    <CardTitle className="text-base flex items-center gap-2">
                      <FileIcon className="h-5 w-5" />
                      CV đã nộp
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="flex items-center justify-between p-4 bg-muted/50 rounded-lg border">
                      <div className="flex items-center gap-3">
                        <div className="p-2 bg-primary/10 rounded-lg">
                          <FileText className="h-5 w-5 text-primary" />
                        </div>
                        <div>
                          <p className="font-medium">{application.submittedCV.name}</p>
                          <p className="text-sm text-muted-foreground">
                            Nguồn: {application.submittedCV.source === 'UPLOADED' ? 'Tải lên' : 'Từ hồ sơ'}
                          </p>
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <Button
                          variant="outline"
                          size="sm"
                          asChild
                        >
                          <a href={application.submittedCV.path} target="_blank" rel="noopener noreferrer">
                            <Download className="h-4 w-4 mr-2" />
                            Tải xuống
                          </a>
                        </Button>
                        <DialogTrigger asChild>
                          <Button size="sm" className="bg-gradient-primary">
                            <Eye className="h-4 w-4 mr-2" />
                            Xem CV
                          </Button>
                        </DialogTrigger>
                      </div>
                    </div>
                  </CardContent>
                </Card>
                <DialogContent className="max-w-4xl w-full h-[90vh] flex flex-col p-0">
                  <DialogHeader className="p-4 border-b shrink-0">
                    <DialogTitle>{application.submittedCV.name}</DialogTitle>
                  </DialogHeader>
                  <div className="flex-1 overflow-hidden">
                    <iframe
                      src={`https://docs.google.com/gview?url=${encodeURIComponent(application.submittedCV.path)}&embedded=true`}
                      className="w-full h-full"
                      title={application.submittedCV.name}
                    />
                  </div>
                </DialogContent>
              </Dialog>
            )}

            {/* Actions */}
            <div className="flex justify-end pt-6 border-t">
              <Button asChild>
                <Link to={`/jobs/${application.jobId}`}>
                  <ExternalLink className="h-4 w-4 mr-2" />
                  Xem tin tuyển dụng gốc
                </Link>
              </Button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ApplicationDetailPage;
</file>

<file path="src/pages/jobs/components/SearchInterface/DistanceFilter.jsx">
import React, { useState, useEffect } from 'react';
import { Label } from '@/components/ui/label';
import { Slider } from '@/components/ui/slider';
import { Button } from '@/components/ui/button';
import { MapPin, Navigation, X, HelpCircle } from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';
import LocationPermissionGuide from '@/components/common/LocationPermissionGuide';
import LocationPermissionAlert from '@/components/common/LocationPermissionAlert';

/**
 * DistanceFilter - Component lọc công việc theo khoảng cách
 * Cho phép user chọn bán kính tìm kiếm từ vị trí hiện tại
 */
const DistanceFilter = ({ 
  distance = '', 
  latitude = '',
  longitude = '',
  onChange 
}) => {
  const [isEnabled, setIsEnabled] = useState(false);
  const [distanceValue, setDistanceValue] = useState(10); // Default 10km
  const [userCoords, setUserCoords] = useState(null);
  const [isGettingLocation, setIsGettingLocation] = useState(false);
  const [showPermissionGuide, setShowPermissionGuide] = useState(false);
  const [permissionDenied, setPermissionDenied] = useState(false);

  // Distance presets in km
  const distancePresets = [
    { value: 5, label: '5km' },
    { value: 10, label: '10km' },
    { value: 20, label: '20km' },
    { value: 50, label: '50km' },
  ];

  // Initialize from props
  useEffect(() => {
    if (distance && latitude && longitude) {
      setIsEnabled(true);
      setDistanceValue(Number(distance));
      setUserCoords([Number(longitude), Number(latitude)]);
    } else {
      setIsEnabled(false);
    }
  }, [distance, latitude, longitude]);

  /**
   * Get user's current location
   */
  const getUserLocation = () => {
    if (!navigator.geolocation) {
      toast.error('Trình duyệt của bạn không hỗ trợ định vị.');
      return;
    }

    setIsGettingLocation(true);
    setPermissionDenied(false); // Reset permission denied state
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const { longitude, latitude } = position.coords;
        setUserCoords([longitude, latitude]);
        setIsGettingLocation(false);
        toast.success('Đã lấy vị trí của bạn!');
        
        // Enable filter and apply
        setIsEnabled(true);
        onChange({
          distance: distanceValue,
          latitude: latitude,
          longitude: longitude
        });
      },
      (error) => {
        setIsGettingLocation(false);
        console.error('Geolocation error:', error);
        
        let errorMessage = 'Không thể lấy vị trí của bạn.';
        let showGuide = false;
        
        if (error.code === error.PERMISSION_DENIED) {
          errorMessage = 'Quyền truy cập vị trí bị từ chối. Nhấn "Xem hướng dẫn" để biết cách bật.';
          showGuide = true;
          setPermissionDenied(true);
        } else if (error.code === error.POSITION_UNAVAILABLE) {
          errorMessage = 'Thông tin vị trí không khả dụng. Vui lòng kiểm tra cài đặt thiết bị.';
        } else if (error.code === error.TIMEOUT) {
          errorMessage = 'Yêu cầu lấy vị trí đã hết thời gian. Vui lòng thử lại.';
        }
        
        toast.error(errorMessage, {
          duration: 5000,
          action: showGuide ? {
            label: 'Xem hướng dẫn',
            onClick: () => setShowPermissionGuide(true)
          } : undefined
        });
        
        // Auto show guide for permission denied after a short delay
        if (showGuide) {
          setTimeout(() => setShowPermissionGuide(true), 1500);
        }
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 0
      }
    );
  };

  /**
   * Handle distance change from slider
   */
  const handleDistanceChange = (value) => {
    const newDistance = value[0];
    setDistanceValue(newDistance);
    
    if (isEnabled && userCoords) {
      onChange({
        distance: newDistance,
        latitude: userCoords[1], // latitude
        longitude: userCoords[0] // longitude
      });
    }
  };

  /**
   * Handle preset button click
   */
  const handlePresetClick = (presetValue) => {
    setDistanceValue(presetValue);
    
    if (isEnabled && userCoords) {
      onChange({
        distance: presetValue,
        latitude: userCoords[1],
        longitude: userCoords[0]
      });
    }
  };

  /**
   * Enable/disable distance filter
   */
  const toggleFilter = () => {
    if (!isEnabled) {
      // Enabling - get location if not already have
      if (!userCoords) {
        getUserLocation();
      } else {
        setIsEnabled(true);
        onChange({
          distance: distanceValue,
          latitude: userCoords[1],
          longitude: userCoords[0]
        });
      }
    } else {
      // Disabling - clear filter
      setIsEnabled(false);
      onChange({
        distance: '',
        latitude: '',
        longitude: ''
      });
    }
  };

  /**
   * Clear filter completely
   */
  const handleClear = () => {
    setIsEnabled(false);
    setUserCoords(null);
    onChange({
      distance: '',
      latitude: '',
      longitude: ''
    });
  };

  return (
    <>
      <div className="space-y-4">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <MapPin className="h-4 w-4 text-primary" />
            <Label className="font-semibold text-sm">Lọc theo khoảng cách</Label>
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setShowPermissionGuide(true)}
              className="h-6 w-6 p-0 text-muted-foreground hover:text-primary"
              title="Hướng dẫn bật quyền vị trí"
            >
              <HelpCircle className="h-3.5 w-3.5" />
            </Button>
          </div>
          {isEnabled && (
            <Button
              variant="ghost"
              size="sm"
              onClick={handleClear}
              className="h-7 px-2 text-xs text-muted-foreground hover:text-destructive"
            >
              <X className="h-3 w-3" />
            </Button>
          )}
        </div>

        {/* Permission Denied Alert */}
        {!isEnabled && permissionDenied && (
          <LocationPermissionAlert 
            onShowGuide={() => setShowPermissionGuide(true)}
          />
        )}

        {/* Enable/Get Location Button */}
        {!isEnabled && (
          <Button
            onClick={toggleFilter}
            disabled={isGettingLocation}
            variant="outline"
            size="sm"
            className={cn(
              "w-full transition-all duration-300",
              "border-2 border-primary/40 hover:border-primary",
              "hover:bg-primary/10"
            )}
          >
            <Navigation className={cn(
              "h-4 w-4 mr-2",
              isGettingLocation && "animate-pulse"
            )} />
            {isGettingLocation ? 'Đang lấy vị trí...' : 'Bật lọc theo vị trí'}
          </Button>
        )}

      {/* Distance Slider & Controls (when enabled) */}
      {isEnabled && userCoords && (
        <div className="space-y-4 p-4 rounded-lg bg-primary/5 border-2 border-primary/20">
          {/* Current Distance Display */}
          <div className="flex items-center justify-between">
            <span className="text-sm text-muted-foreground">
              Bán kính tìm kiếm
            </span>
            <span className="text-lg font-bold text-primary">
              {distanceValue} km
            </span>
          </div>

          {/* Slider */}
          <div className="px-2">
            <Slider
              value={[distanceValue]}
              onValueChange={handleDistanceChange}
              min={1}
              max={100}
              step={1}
              className="w-full"
            />
            <div className="flex items-center justify-between mt-2 text-xs text-muted-foreground">
              <span>1 km</span>
              <span>100 km</span>
            </div>
          </div>

          {/* Preset Buttons */}
          <div className="grid grid-cols-4 gap-2">
            {distancePresets.map((preset) => (
              <Button
                key={preset.value}
                variant={distanceValue === preset.value ? 'default' : 'outline'}
                size="sm"
                onClick={() => handlePresetClick(preset.value)}
                className={cn(
                  "text-xs transition-all duration-300",
                  distanceValue === preset.value && "btn-gradient text-white"
                )}
              >
                {preset.label}
              </Button>
            ))}
          </div>

          {/* Location Info */}
          <div className="pt-2 border-t border-border">
            <div className="flex items-start gap-2 text-xs text-muted-foreground">
              <Navigation className="h-3 w-3 mt-0.5 flex-shrink-0 text-primary" />
              <div>
                <p className="font-medium text-foreground mb-1">Vị trí của bạn:</p>
                <p className="font-mono">
                  {userCoords[1].toFixed(6)}, {userCoords[0].toFixed(6)}
                </p>
              </div>
            </div>
          </div>

          {/* Disable Button */}
          <Button
            onClick={toggleFilter}
            variant="ghost"
            size="sm"
            className="w-full text-xs text-muted-foreground hover:text-destructive"
          >
            Tắt lọc theo khoảng cách
          </Button>
        </div>
      )}

        {/* Help Text */}
        {!isEnabled && (
          <p className="text-xs text-muted-foreground">
            Tìm công việc trong bán kính tùy chọn từ vị trí hiện tại của bạn.
          </p>
        )}
      </div>

      {/* Permission Guide Modal */}
      <LocationPermissionGuide
        isOpen={showPermissionGuide}
        onClose={() => setShowPermissionGuide(false)}
        onRetry={getUserLocation}
      />
    </>
  );
};

export default DistanceFilter;
</file>

<file path="src/pages/jobs/components/SearchInterface/FilterGroup.jsx">
import React, { useState } from 'react';
import { ChevronDown, ChevronUp, ChevronRight, X } from 'lucide-react';

const FilterGroup = ({
  title,
  value,
  options = [],
  onChange,
  className = '',
  showClearButton = true,
  layout = 'vertical', // 'vertical' or 'horizontal'
  collapsible = true,
  defaultExpanded = false,
  maxVisibleItems = 5,
  allowFullCollapse = true
}) => {
  const [isExpanded, setIsExpanded] = useState(defaultExpanded);
  const [isFullyCollapsed, setIsFullyCollapsed] = useState(false);

  const handleValueChange = (newValue) => {
    const valueToSet = newValue === value ? '' : newValue;
    onChange(valueToSet);
  };

  const handleClear = (e) => {
    e.stopPropagation();
    onChange('');
  };

  const toggleFullCollapse = () => {
    setIsFullyCollapsed(!isFullyCollapsed);
  };

  const toggleExpanded = () => {
    setIsExpanded(!isExpanded);
  };

  const shouldCollapse = collapsible && options.length > maxVisibleItems;
  const visibleOptions = shouldCollapse && !isExpanded 
    ? options.slice(0, maxVisibleItems)
    : options;
  const hiddenCount = options.length - maxVisibleItems;

  return (
    <div className={`border rounded-lg bg-white shadow-sm transition-all duration-300 ${className}`}>
      <div 
        className={`
          flex items-center justify-between p-4 cursor-pointer
          bg-gray-50 hover:bg-gray-100 transition-colors duration-200
          rounded-t-lg
          ${isFullyCollapsed ? 'rounded-b-lg' : ''}
        `}
        onClick={allowFullCollapse ? toggleFullCollapse : undefined}
        role={allowFullCollapse ? 'button' : undefined}
        aria-expanded={!isFullyCollapsed}
      >
        <div className="flex items-center gap-3">
          <ChevronRight 
            className={`
              h-5 w-5 text-gray-500 transition-transform duration-300
              ${isFullyCollapsed ? 'rotate-0' : 'rotate-90'}
            `}
          />
          <h3 className="text-lg font-semibold text-gray-800">
            {title}
          </h3>
          {isFullyCollapsed && value && (
            <span className="text-sm text-blue-600 bg-blue-100 px-2.5 py-1 rounded-full font-medium">
              {options.find(opt => (typeof opt === 'string' ? opt : opt.value) === value)?.label || value}
            </span>
          )}
        </div>
        {showClearButton && value && !isFullyCollapsed && (
          <button
            onClick={handleClear}
            className="p-1 text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full"
            aria-label="Xóa bộ lọc"
          >
            <X className="h-5 w-5" />
          </button>
        )}
      </div>

      {!isFullyCollapsed && (
        <div className="p-4 animate-slide-down">
          <div 
            className={`
              ${layout === 'horizontal' ? 'flex flex-wrap gap-3' : 'space-y-2'}
            `}
            role="radiogroup"
            aria-label={title}
          >
            {visibleOptions.map((option) => {
              const optionValue = typeof option === 'string' ? option : option.value;
              const optionLabel = typeof option === 'string' ? option : option.label;

              return (
                <label
                  key={optionValue}
                  className={`
                    flex items-center gap-2 p-2 rounded-md cursor-pointer
                    transition-all duration-200
                    hover:bg-gray-100
                    ${value === optionValue ? 'bg-blue-50 border border-blue-200' : ''}
                    ${layout === 'horizontal' ? 'flex-none' : ''}
                  `}
                >
                  <input
                    type="radio"
                    value={optionValue}
                    checked={value === optionValue}
                    onChange={() => handleValueChange(optionValue)}
                    className="
                      h-4 w-4 text-blue-600 border-gray-300 
                      focus:ring-2 focus:ring-blue-500 focus:ring-offset-1
                    "
                    id={`${title}-${optionValue}`}
                  />
                  <span className="text-sm text-gray-700 font-medium">
                    {optionLabel}
                  </span>
                </label>
              );
            })}
          </div>

          {shouldCollapse && (
            <div className="mt-4 pt-3 border-t border-gray-200">
              <button
                onClick={toggleExpanded}
                className="
                  w-full flex items-center justify-center gap-1
                  text-sm text-gray-500 hover:text-gray-700
                  py-2 transition-colors duration-200
                  focus:outline-none focus:ring-2 focus:ring-blue-500
                "
              >
                {isExpanded ? (
                  <>
                    <ChevronUp className="h-4 w-4" />
                    Thu gọn
                  </>
                ) : (
                  <>
                    <ChevronDown className="h-4 w-4" />
                    Xem thêm {hiddenCount} mục
                  </>
                )}
              </button>
            </div>
          )}

          {options.length === 0 && (
            <p className="text-sm text-gray-500 py-2">
              Không có tùy chọn nào
            </p>
          )}
        </div>
      )}
    </div>
  );
};

export default FilterGroup;
</file>

<file path="src/pages/jobs/components/SearchInterface/LocationFilter.jsx">
import React, { useState, useEffect } from 'react';
import { ChevronRight, X, MapPin } from 'lucide-react';
import locationData from '@/data/oldtree.json';

const LocationFilter = ({
  province = '',
  district = '',
  onChange,
  className = '',
  allowFullCollapse = true
}) => {
  const [selectedProvince, setSelectedProvince] = useState(province);
  const [selectedDistrict, setSelectedDistrict] = useState(district);
  const [isFullyCollapsed, setIsFullyCollapsed] = useState(false);
  const [locationHierarchy, setLocationHierarchy] = useState({ provinces: [], districts: {} });

  useEffect(() => {
    const provinces = locationData.map(p => p.name);
    const districts = locationData.reduce((acc, p) => {
      acc[p.name] = p.districts.map(d => d.name);
      return acc;
    }, {});
    setLocationHierarchy({ provinces, districts });
  }, []);

  useEffect(() => {
    setSelectedProvince(province);
    setSelectedDistrict(district);
  }, [province, district]);

  const handleProvinceChange = (provinceName) => {
    const actualProvince = provinceName === 'ALL_PROVINCES' ? '' : provinceName;
    setSelectedProvince(actualProvince);
    setSelectedDistrict('');
    onChange({
      province: actualProvince,
      district: ''
    });
  };

  const handleDistrictChange = (districtName) => {
    const actualDistrict = districtName === 'ALL_DISTRICTS' ? '' : districtName;
    setSelectedDistrict(actualDistrict);
    onChange({
      province: selectedProvince,
      district: actualDistrict
    });
  };

  const handleClear = (e) => {
    e.stopPropagation();
    setSelectedProvince('');
    setSelectedDistrict('');
    onChange({
      province: '',
      district: ''
    });
  };

  const toggleFullCollapse = () => {
    setIsFullyCollapsed(!isFullyCollapsed);
  };

  const availableDistricts = selectedProvince
    ? locationHierarchy.districts[selectedProvince] || []
    : [];

  const hasActiveFilter = selectedProvince || selectedDistrict;

  return (
    <div className={`border rounded-lg bg-white shadow-sm transition-all duration-300 ${className}`}>
      <div 
        className={`
          flex items-center justify-between p-4 cursor-pointer
          bg-gray-50 hover:bg-gray-100 transition-colors duration-200
          rounded-t-lg
          ${isFullyCollapsed ? 'rounded-b-lg' : ''}
        `}
        onClick={allowFullCollapse ? toggleFullCollapse : undefined}
        role={allowFullCollapse ? 'button' : undefined}
        aria-expanded={!isFullyCollapsed}
      >
        <div className="flex items-center gap-3">
          <ChevronRight 
            className={`
              h-5 w-5 text-gray-500 transition-transform duration-300
              ${isFullyCollapsed ? 'rotate-0' : 'rotate-90'}
            `}
          />
          <h3 className="text-lg font-semibold text-gray-800 flex items-center gap-2">
            <MapPin className="h-5 w-5" />
            Địa điểm
          </h3>
          {isFullyCollapsed && hasActiveFilter && (
            <span className="text-sm text-blue-600 bg-blue-100 px-2.5 py-1 rounded-full font-medium">
              {selectedProvince && selectedDistrict 
                ? `${selectedProvince} > ${selectedDistrict}`
                : selectedProvince || selectedDistrict}
            </span>
          )}
        </div>
        {hasActiveFilter && !isFullyCollapsed && (
          <button
            onClick={handleClear}
            className="p-1 text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full"
            aria-label="Xóa bộ lọc"
          >
            <X className="h-5 w-5" />
          </button>
        )}
      </div>

      {!isFullyCollapsed && (
        <div className="p-4 animate-slide-down space-y-4">
          <div className="space-y-1">
            <label htmlFor="province" className="text-sm font-medium text-gray-700">
              Tỉnh/Thành phố
            </label>
            <select
              id="province"
              value={selectedProvince || 'ALL_PROVINCES'}
              onChange={(e) => handleProvinceChange(e.target.value)}
              className="
                w-full h-10 px-3 rounded-md border border-gray-300
                focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                text-sm text-gray-700
              "
            >
              <option value="ALL_PROVINCES">Tất cả tỉnh/thành phố</option>
              {locationHierarchy.provinces.map((provinceName) => (
                <option key={provinceName} value={provinceName}>
                  {provinceName}
                </option>
              ))}
            </select>
          </div>

          <div className="space-y-1">
            <label htmlFor="district" className="text-sm font-medium text-gray-700">
              Quận/Huyện
            </label>
            <select
              id="district"
              value={selectedDistrict || 'ALL_DISTRICTS'}
              onChange={(e) => handleDistrictChange(e.target.value)}
              disabled={!selectedProvince}
              className={`
                w-full h-10 px-3 rounded-md border border-gray-300
                focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                text-sm text-gray-700
                ${!selectedProvince ? 'opacity-50 cursor-not-allowed' : ''}
              `}
            >
              <option value="ALL_DISTRICTS">
                {selectedProvince ? 'Tất cả quận/huyện' : 'Chọn tỉnh/thành phố trước'}
              </option>
              {availableDistricts.map((district) => (
                <option key={district} value={district}>
                  {district}
                </option>
              ))}
            </select>
          </div>

          {hasActiveFilter && (
            <div className="pt-3 border-t border-gray-200">
              <div className="text-sm text-gray-500">
                <span className="font-medium">Vị trí đã chọn:</span>
                <div className="mt-1">
                  {selectedProvince && (
                    <span className="text-gray-700">{selectedProvince}</span>
                  )}
                  {selectedDistrict && (
                    <span className="text-gray-700">
                      {selectedProvince ? ` > ${selectedDistrict}` : selectedDistrict}
                    </span>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );
};

export default LocationFilter;
</file>

<file path="src/pages/jobs/components/SearchInterface/SalaryRangeFilter.jsx">
import React, { useState, useEffect } from 'react';
import { ChevronRight, X, DollarSign } from 'lucide-react';

const SalaryRangeFilter = ({
  minSalary = '',
  maxSalary = '',
  onChange,
  className = '',
  allowFullCollapse = true
}) => {
  const [selectedRange, setSelectedRange] = useState('');
  const [customMin, setCustomMin] = useState('');
  const [customMax, setCustomMax] = useState('');
  const [isCustomMode, setIsCustomMode] = useState(false);
  const [isFullyCollapsed, setIsFullyCollapsed] = useState(false);

  const salaryRanges = [
    { value: '', label: 'Tất cả mức lương', min: null, max: null },
    { value: '0-10', label: 'Dưới 10 triệu', min: 0, max: 10 },
    { value: '10-15', label: '10 - 15 triệu', min: 10, max: 15 },
    { value: '15-20', label: '15 - 20 triệu', min: 15, max: 20 },
    { value: '20-30', label: '20 - 30 triệu', min: 20, max: 30 },
    { value: '30-50', label: '30 - 50 triệu', min: 30, max: 50 },
    { value: '50+', label: 'Trên 50 triệu', min: 50, max: null }
  ];

  useEffect(() => {
    const min = minSalary ? parseInt(minSalary, 10) / 1000000 : '';
    const max = maxSalary ? parseInt(maxSalary, 10) / 1000000 : '';

    if (minSalary || maxSalary) {
      const matchingRange = salaryRanges.find(range => range.min === min && range.max === max);
      if (matchingRange) {
        setSelectedRange(matchingRange.value);
        setIsCustomMode(false);
      } else {
        setSelectedRange('custom');
        setCustomMin(min.toString());
        setCustomMax(max.toString());
        setIsCustomMode(true);
      }
    } else {
      setSelectedRange('');
      setCustomMin('');
      setCustomMax('');
      setIsCustomMode(false);
    }
  }, [minSalary, maxSalary]);

  const handleRangeChange = (rangeValue) => {
    setSelectedRange(rangeValue);
    if (rangeValue === 'custom') {
      setIsCustomMode(true);
      onChange({
        minSalary: customMin ? (parseInt(customMin, 10) * 1000000).toString() : '',
        maxSalary: customMax ? (parseInt(customMax, 10) * 1000000).toString() : ''
      });
    } else if (rangeValue === '') {
      setIsCustomMode(false);
      setCustomMin('');
      setCustomMax('');
      onChange({ minSalary: '', maxSalary: '' });
    } else {
      setIsCustomMode(false);
      const range = salaryRanges.find(r => r.value === rangeValue);
      if (range) {
        onChange({
          minSalary: range.min !== null ? (range.min * 1000000).toString() : '',
          maxSalary: range.max !== null ? (range.max * 1000000).toString() : ''
        });
      }
    }
  };

  const handleCustomSalaryChange = () => {
    onChange({
      minSalary: customMin ? (parseInt(customMin, 10) * 1000000).toString() : '',
      maxSalary: customMax ? (parseInt(customMax, 10) * 1000000).toString() : ''
    });
  };

  const formatNumberInput = (value) => value.replace(/[^0-9]/g, '');

  const handleCustomMinChange = (value) => {
    const formatted = formatNumberInput(value);
    setCustomMin(formatted);
  };

  const handleCustomMaxChange = (value) => {
    const formatted = formatNumberInput(value);
    setCustomMax(formatted);
  };

  const handleClear = (e) => {
    e.stopPropagation();
    setSelectedRange('');
    setCustomMin('');
    setCustomMax('');
    setIsCustomMode(false);
    onChange({ minSalary: '', maxSalary: '' });
  };

  const toggleFullCollapse = () => {
    setIsFullyCollapsed(!isFullyCollapsed);
  };

  const hasActiveFilter = selectedRange !== '' && selectedRange !== 'all';

  const getSelectedRangeLabel = () => {
    if (selectedRange === 'custom') {
      return `${customMin || '0'} - ${customMax || '∞'} triệu`;
    }
    const range = salaryRanges.find(r => r.value === selectedRange);
    return range ? range.label : '';
  };

  return (
    <div className={`border rounded-lg bg-white shadow-sm transition-all duration-300 ${className}`}>
      <div 
        className={`
          flex items-center justify-between p-4 cursor-pointer
          bg-gray-50 hover:bg-gray-100 transition-colors duration-200
          rounded-t-lg
          ${isFullyCollapsed ? 'rounded-b-lg' : ''}
        `}
        onClick={allowFullCollapse ? toggleFullCollapse : undefined}
        role={allowFullCollapse ? 'button' : undefined}
        aria-expanded={!isFullyCollapsed}
      >
        <div className="flex items-center gap-3">
          <ChevronRight 
            className={`
              h-5 w-5 text-gray-500 transition-transform duration-300
              ${isFullyCollapsed ? 'rotate-0' : 'rotate-90'}
            `}
          />
          <h3 className="text-lg font-semibold text-gray-800 flex items-center gap-2">
            <DollarSign className="h-5 w-5" />
            Mức lương
          </h3>
          {isFullyCollapsed && hasActiveFilter && (
            <span className="text-sm text-blue-600 bg-blue-100 px-2.5 py-1 rounded-full font-medium">
              {getSelectedRangeLabel()}
            </span>
          )}
        </div>
        {hasActiveFilter && !isFullyCollapsed && (
          <button
            onClick={handleClear}
            className="p-1 text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full"
            aria-label="Xóa bộ lọc"
          >
            <X className="h-5 w-5" />
          </button>
        )}
      </div>

      {!isFullyCollapsed && (
        <div className="p-4 animate-slide-down space-y-4">
          <div className="space-y-2" role="radiogroup" aria-label="Mức lương">
            {salaryRanges.map((range) => (
              <label
                key={range.value}
                className={`
                  flex items-center gap-2 p-2 rounded-md cursor-pointer
                  transition-all duration-200
                  hover:bg-gray-100
                  ${selectedRange === range.value ? 'bg-blue-50 border border-blue-200' : ''}
                `}
              >
                <input
                  type="radio"
                  value={range.value}
                  checked={selectedRange === range.value}
                  onChange={() => handleRangeChange(range.value)}
                  className="
                    h-4 w-4 text-blue-600 border-gray-300 
                    focus:ring-2 focus:ring-blue-500 focus:ring-offset-1
                  "
                  id={`salary-${range.value}`}
                />
                <span className="text-sm text-gray-700 font-medium">
                  {range.label}
                </span>
              </label>
            ))}
            <label
              className={`
                flex items-center gap-2 p-2 rounded-md cursor-pointer
                transition-all duration-200
                hover:bg-gray-100
                ${selectedRange === 'custom' ? 'bg-blue-50 border border-blue-200' : ''}
              `}
            >
              <input
                type="radio"
                value="custom"
                checked={selectedRange === 'custom'}
                onChange={() => handleRangeChange('custom')}
                className="
                  h-4 w-4 text-blue-600 border-gray-300 
                  focus:ring-2 focus:ring-blue-500 focus:ring-offset-1
                "
                id="salary-custom"
              />
              <span className="text-sm text-gray-700 font-medium">
                Tùy chỉnh
              </span>
            </label>
          </div>

          {isCustomMode && (
            <div className="space-y-3 pt-3 border-t border-gray-200">
              <div className="space-y-1">
                <label htmlFor="min-salary" className="text-sm font-medium text-gray-700">
                  Lương tối thiểu (triệu VND)
                </label>
                <input
                  id="min-salary"
                  type="text"
                  placeholder="VD: 10"
                  value={customMin}
                  onChange={(e) => handleCustomMinChange(e.target.value)}
                  onBlur={handleCustomSalaryChange}
                  className="
                    w-full h-10 px-3 rounded-md border border-gray-300
                    focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                    text-sm text-gray-700
                  "
                />
              </div>
              <div className="space-y-1">
                <label htmlFor="max-salary" className="text-sm font-medium text-gray-700">
                  Lương tối đa (triệu VND)
                </label>
                <input
                  id="max-salary"
                  type="text"
                  placeholder="VD: 20"
                  value={customMax}
                  onChange={(e) => handleCustomMaxChange(e.target.value)}
                  onBlur={handleCustomSalaryChange}
                  className="
                    w-full h-10 px-3 rounded-md border border-gray-300
                    focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                    text-sm text-gray-700
                  "
                />
              </div>
              <button
                onClick={handleCustomSalaryChange}
                className="
                  w-full h-10 rounded-md bg-blue-600 text-white
                  hover:bg-blue-700 focus:ring-2 focus:ring-blue-500
                  transition-colors duration-200
                "
              >
                Áp dụng
              </button>
            </div>
          )}
        </div>
      )}
    </div>
  );
};

export default SalaryRangeFilter;
</file>

<file path="src/pages/OnboardingPage.jsx">
import { OnboardingWrapper } from '@/components/onboarding';
import { BasicInfoStep } from '@/components/onboarding/steps/BasicInfoStep';
import { SkillsStep } from '@/components/onboarding/steps/SkillsStep';
import { SalaryPreferencesStep } from '@/components/onboarding/steps/SalaryPreferencesStep';
import { ExperienceEducationStep } from '@/components/onboarding/steps/ExperienceEducationStep';
import { CertificatesProjectsStep } from '@/components/onboarding/steps/CertificatesProjectsStep';

const OnboardingPage = () => {
  const handleComplete = () => {
    // This will be handled by OnboardingWrapper
    console.log('Onboarding completed');
  };

  return (
    <OnboardingWrapper onComplete={handleComplete}>
      {({ currentStep, stepData, onNext, isLoading, onLoadingChange }) => {
        switch (currentStep) {
          case 1:
            return (
              <BasicInfoStep
                initialData={stepData}
                onNext={onNext}
                isLoading={isLoading}
                onLoadingChange={onLoadingChange}
              />
            );
          case 2:
            return (
              <SkillsStep
                initialData={stepData}
                onNext={onNext}
                isLoading={isLoading}
                onLoadingChange={onLoadingChange}
              />
            );
          case 3:
            return (
              <SalaryPreferencesStep
                initialData={stepData}
                onNext={onNext}
                isLoading={isLoading}
                onLoadingChange={onLoadingChange}
              />
            );
          case 4:
            return (
              <ExperienceEducationStep
                initialData={stepData}
                onNext={onNext}
                isLoading={isLoading}
                onLoadingChange={onLoadingChange}
              />
            );
          case 5:
            return (
              <CertificatesProjectsStep
                initialData={stepData}
                onNext={onNext}
                isLoading={isLoading}
                onLoadingChange={onLoadingChange}
              />
            );
          default:
            return null;
        }
      }}
    </OnboardingWrapper>
  );
};

export default OnboardingPage;
</file>

<file path="src/redux/notificationSlice.js">
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import * as notificationService from '@/services/notificationService';

// Async thunk để fetch notifications
export const fetchNotifications = createAsyncThunk(
  'notifications/fetchNotifications',
  async (params = {}, { rejectWithValue }) => {
    try {
      const response = await notificationService.getNotifications({
        page: params.page || 1,
        limit: params.limit || 10,
        ...params
      });
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'Failed to fetch notifications');
    }
  }
);

// Async thunk để fetch unread count
export const fetchUnreadCount = createAsyncThunk(
  'notifications/fetchUnreadCount',
  async (_, { rejectWithValue }) => {
    try {
      const count = await notificationService.getUnreadCount();
      return count;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'Failed to fetch unread count');
    }
  }
);

// Async thunk để fetch recent notifications
export const fetchRecentNotifications = createAsyncThunk(
  'notifications/fetchRecentNotifications',
  async (_, { rejectWithValue }) => {
    try {
      const notifications = await notificationService.getRecentNotifications();
      return notifications;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'Failed to fetch recent notifications');
    }
  }
);

// Async thunk để mark as read
export const markNotificationAsRead = createAsyncThunk(
  'notifications/markAsRead',
  async (notificationId, { rejectWithValue }) => {
    try {
      await notificationService.markNotificationAsRead(notificationId);
      return notificationId;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'Failed to mark as read');
    }
  }
);

// Async thunk để mark all as read
export const markAllNotificationsAsRead = createAsyncThunk(
  'notifications/markAllAsRead',
  async (_, { rejectWithValue }) => {
    try {
      await notificationService.markAllAsRead();
      return true;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'Failed to mark all as read');
    }
  }
);

const notificationSlice = createSlice({
  name: 'notifications',
  initialState: {
    notifications: [],
    recentNotifications: [],
    unreadCount: 0,
    pagination: {
      page: 1,
      limit: 10,
      total: 0,
      pages: 0
    },
    loading: false,
    error: null,
    initialized: false // Track if notifications have been loaded
  },
  reducers: {
    // Action để thêm notification mới (khi nhận từ Firebase push)
    addNewNotification: (state, action) => {
      const newNotification = action.payload;
      
      // Thêm vào recent notifications nếu chưa có
      const existsInRecent = state.recentNotifications.some(n => n._id === newNotification._id);
      if (!existsInRecent) {
        state.recentNotifications.unshift(newNotification);
        // Giữ tối đa 5 notifications
        if (state.recentNotifications.length > 5) {
          state.recentNotifications.pop();
        }
      }
      
      // Thêm vào list notifications nếu đang ở trang 1
      if (state.pagination.page === 1) {
        const existsInList = state.notifications.some(n => n._id === newNotification._id);
        if (!existsInList) {
          state.notifications.unshift(newNotification);
        }
      }
      
      // Tăng unread count nếu notification chưa đọc
      if (!newNotification.isRead) {
        state.unreadCount += 1;
      }
    },
    
    // Action để clear notifications khi logout
    clearNotifications: (state) => {
      state.notifications = [];
      state.recentNotifications = [];
      state.unreadCount = 0;
      state.pagination = {
        page: 1,
        limit: 10,
        total: 0,
        pages: 0
      };
      state.loading = false;
      state.error = null;
      state.initialized = false;
    },
    
    // Action để update notification locally
    updateNotification: (state, action) => {
      const { id, updates } = action.payload;
      
      // Update in notifications list
      const notifIndex = state.notifications.findIndex(n => n._id === id);
      if (notifIndex !== -1) {
        state.notifications[notifIndex] = {
          ...state.notifications[notifIndex],
          ...updates
        };
      }
      
      // Update in recent notifications
      const recentIndex = state.recentNotifications.findIndex(n => n._id === id);
      if (recentIndex !== -1) {
        state.recentNotifications[recentIndex] = {
          ...state.recentNotifications[recentIndex],
          ...updates
        };
      }
    }
  },
  extraReducers: (builder) => {
    builder
      // Fetch notifications
      .addCase(fetchNotifications.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchNotifications.fulfilled, (state, action) => {
        state.loading = false;
        state.notifications = action.payload.data;
        state.pagination = {
          page: action.payload.meta.page,
          limit: action.payload.meta.limit,
          total: action.payload.meta.total,
          pages: action.payload.meta.pages
        };
        state.initialized = true;
      })
      .addCase(fetchNotifications.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      
      // Fetch unread count
      .addCase(fetchUnreadCount.fulfilled, (state, action) => {
        state.unreadCount = action.payload;
      })
      
      // Fetch recent notifications
      .addCase(fetchRecentNotifications.fulfilled, (state, action) => {
        state.recentNotifications = action.payload;
      })
      
      // Mark as read
      .addCase(markNotificationAsRead.fulfilled, (state, action) => {
        const notificationId = action.payload;
        
        // Update in notifications list
        const notifIndex = state.notifications.findIndex(n => n._id === notificationId);
        if (notifIndex !== -1 && !state.notifications[notifIndex].isRead) {
          state.notifications[notifIndex].isRead = true;
          state.unreadCount = Math.max(0, state.unreadCount - 1);
        }
        
        // Update in recent notifications
        const recentIndex = state.recentNotifications.findIndex(n => n._id === notificationId);
        if (recentIndex !== -1 && !state.recentNotifications[recentIndex].isRead) {
          state.recentNotifications[recentIndex].isRead = true;
        }
      })
      
      // Mark all as read
      .addCase(markAllNotificationsAsRead.fulfilled, (state) => {
        state.notifications = state.notifications.map(n => ({ ...n, isRead: true }));
        state.recentNotifications = state.recentNotifications.map(n => ({ ...n, isRead: true }));
        state.unreadCount = 0;
      });
  }
});

export const { addNewNotification, clearNotifications, updateNotification } = notificationSlice.actions;
export default notificationSlice.reducer;
</file>

<file path="src/redux/searchHistorySlice.js">
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

// Note: searchHistoryService will be implemented in task 6.1
// For now, we'll import it with the expectation it will be created
let searchHistoryService;
try {
  const module = await import('../services/searchHistoryService.js');
  searchHistoryService = module.searchHistoryService || module.default;
} catch (error) {
  // Service not yet implemented, will be added in task 6.1
  searchHistoryService = {
    getUserHistory: async () => ({ data: { data: [], pagination: { total: 0, page: 1, limit: 10, totalPages: 0 } } }),
    saveHistory: async () => ({ data: { data: {} } }),
    deleteHistory: async () => ({ data: { success: true } }),
  };
}

// Initial state
const initialState = {
  entries: [],
  loading: false,
  error: null,
  pagination: {
    total: 0,
    page: 1,
    limit: 10,
    totalPages: 0,
  },
};

// Async thunks
export const fetchSearchHistory = createAsyncThunk(
  'searchHistory/fetch',
  async ({ limit = 10, page = 1 } = {}, { rejectWithValue }) => {
    try {
      const response = await searchHistoryService.getUserHistory({ limit, page });
      return response.data;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'Không thể tải lịch sử tìm kiếm');
    }
  }
);

export const saveSearchHistory = createAsyncThunk(
  'searchHistory/save',
  async (searchData, { rejectWithValue }) => {
    try {
      const response = await searchHistoryService.saveHistory(searchData);
      return response.data;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'Không thể lưu lịch sử tìm kiếm');
    }
  }
);

export const deleteSearchHistory = createAsyncThunk(
  'searchHistory/delete',
  async (entryId, { rejectWithValue, dispatch }) => {
    // Optimistic update: Xóa ngay trên UI trước
    dispatch(removeEntry(entryId));

    try {
      // Gọi API ở background
      await searchHistoryService.deleteHistory(entryId);
      return entryId;
    } catch (error) {
      // Nếu lỗi, rollback lại (sẽ được xử lý ở rejected case)
      return rejectWithValue({
        message: error.response?.data?.message || 'Không thể xóa lịch sử tìm kiếm',
        entryId
      });
    }
  }
);

// Slice
const searchHistorySlice = createSlice({
  name: 'searchHistory',
  initialState,
  reducers: {
    // Sync reducers
    setEntries: (state, action) => {
      state.entries = action.payload;
    },
    removeEntry: (state, action) => {
      state.entries = state.entries.filter(entry => entry._id !== action.payload);
      state.pagination.total = Math.max(0, state.pagination.total - 1);
    },
    clearAll: (state) => {
      state.entries = [];
      state.pagination = {
        total: 0,
        page: 1,
        limit: 10,
        totalPages: 0,
      };
    },
    setLoading: (state, action) => {
      state.loading = action.payload;
    },
    setError: (state, action) => {
      state.error = action.payload;
    },
  },
  extraReducers: (builder) => {
    builder
      // fetchSearchHistory
      .addCase(fetchSearchHistory.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchSearchHistory.fulfilled, (state, action) => {
        state.loading = false;
        state.entries = action.payload || [];
        state.pagination = action.payload.pagination || initialState.pagination;
        state.error = null;
      })
      .addCase(fetchSearchHistory.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      // saveSearchHistory
      .addCase(saveSearchHistory.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(saveSearchHistory.fulfilled, (state, action) => {
        state.loading = false;
        const newEntry = action.payload;

        // Check if entry already exists (update case)
        const existingIndex = state.entries.findIndex(
          entry => entry._id === newEntry._id
        );

        if (existingIndex !== -1) {
          // Update existing entry
          state.entries[existingIndex] = newEntry;
        } else {
          // Add new entry at the beginning
          state.entries.unshift(newEntry);
          state.pagination.total += 1;
        }

        state.error = null;
      })
      .addCase(saveSearchHistory.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      // deleteSearchHistory
      .addCase(deleteSearchHistory.pending, (state) => {
        // Không set loading vì đã xóa optimistically
        state.error = null;
      })
      .addCase(deleteSearchHistory.fulfilled, (state) => {
        // Entry đã được xóa trong optimistic update, không cần làm gì thêm
        state.error = null;
      })
      .addCase(deleteSearchHistory.rejected, (state, action) => {
        // Rollback: Thêm lại entry nếu có trong payload
        // (Cần lưu entry trước khi xóa để có thể rollback)
        state.error = action.payload?.message || action.payload;
      });
  },
});

// Export actions
export const { setEntries, removeEntry, clearAll, setLoading, setError } = searchHistorySlice.actions;

// Selectors
export const selectSearchHistory = (state) => state.searchHistory.entries;
export const selectSearchHistoryLoading = (state) => state.searchHistory.loading;
export const selectSearchHistoryError = (state) => state.searchHistory.error;
export const selectSearchHistoryPagination = (state) => state.searchHistory.pagination;

// Export reducer
export default searchHistorySlice.reducer;
</file>

<file path="src/services/jobNotificationService.js">
import apiClient from './apiClient';

/**
 * Service để quản lý đăng ký thông báo việc làm theo từ khóa
 * API Endpoints: /job-alerts
 */

// Lấy danh sách job alerts
export const getJobAlerts = async (params = {}) => {
  const queryParams = new URLSearchParams();
  
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);
  if (params.active !== undefined) queryParams.append('active', params.active);
  if (params.keyword) queryParams.append('keyword', params.keyword);
  
  const url = `/job-alerts${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;  
  const response = await apiClient.get(url);
  return response;
};

// THÊM MỚI: Tạo job alert mới
export const createJobAlert = async (alertData) => {
  console.log('🆕 Creating job alert:', alertData);
  const response = await apiClient.post('/job-alerts', alertData);
  return response; // Giờ đây apiClient tự trả về response.data
};

// Cập nhật job alert
export const updateJobAlert = async (id, alertData) => {
  console.log('📝 Updating job alert:', id, alertData);
  const response = await apiClient.put(`/job-alerts/${id}`, alertData);
  return response;
};

// Xóa job alert
export const deleteJobAlert = async (id) => {
  console.log('🗑️ Deleting job alert:', id);
  const response = await apiClient.delete(`/job-alerts/${id}`);
  return response;
};

// Bật/tắt trạng thái active của job alert
export const toggleJobAlertStatus = async (id, active) => {
  console.log('🔄 Toggling job alert status:', id, active);
  const response = await apiClient.patch(`/job-alerts/${id}`, { active });
  return response;
};

// CHỈNH SỬA: Lấy danh sách options cho form để khớp với backend ứng viên
export const getJobAlertOptions = () => {
  return {
    frequencies: [
      { value: 'daily', label: 'Hàng ngày' },
      { value: 'weekly', label: 'Hàng tuần' },
    ],
    salaryRanges: [
      { value: 'ALL', label: 'Tất cả mức lương' },
      { value: 'UNDER_10M', label: 'Dưới 10 triệu' },
      { value: '10M_20M', label: '10-20 triệu' }, // Thay đổi giá trị cho khớp backend
      { value: '20M_30M', label: '20-30 triệu' }, // Thay đổi giá trị cho khớp backend
      { value: 'OVER_30M', label: 'Trên 30 triệu' }, // Thay đổi giá trị cho khớp backend
    ],
    jobTypes: [
      { value: 'ALL', label: 'Tất cả loại hình' },
      { value: 'FULL_TIME', label: 'Toàn thời gian' },
      { value: 'PART_TIME', label: 'Bán thời gian' },
      { value: 'INTERNSHIP', label: 'Thực tập' },
      // ... thêm các loại khác từ schema
    ],
    workTypes: [
      { value: 'ALL', label: 'Tất cả hình thức' },
      { value: 'ON_SITE', label: 'Tại văn phòng' },
      { value: 'REMOTE', label: 'Làm việc từ xa' },
      { value: 'HYBRID', label: 'Hybrid' },
    ],
    experiences: [
      { value: 'ALL', label: 'Tất cả cấp độ' },
      { value: 'NO_EXPERIENCE', label: 'Không yêu cầu kinh nghiệm' },
      { value: 'INTERN', label: 'Thực tập sinh' },
      { value: 'FRESHER', label: 'Fresher' },
      { value: 'ENTRY_LEVEL', label: 'Entry Level' },
      { value: 'MID_LEVEL', label: 'Mid Level' },
      { value: 'SENIOR_LEVEL', label: 'Senior Level' },
      { value: 'EXECUTIVE', label: 'Executive' },
    ],
    categories: [
      { value: 'ALL', label: 'Tất cả ngành nghề' },
      { value: 'SOFTWARE_DEVELOPMENT', label: 'Phát triển phần mềm' },
      { value: 'WEB_DEVELOPMENT', label: 'Phát triển web' },
      { value: 'DATA_SCIENCE', label: 'Khoa học dữ liệu' },
      // ... thêm các ngành nghề khác từ schema
    ],
  };
};

export default {
  getJobAlerts,
  updateJobAlert,
  deleteJobAlert,
  toggleJobAlertStatus,
  createJobAlert, // Thêm export
  getJobAlertOptions,
};
</file>

<file path="src/services/notificationService.js">
// src/services/notificationService.js
import apiClient from './apiClient';

/**
 * Lấy danh sách thông báo có phân trang.
 * @param {object} params
 * @param {number} params.page - Số trang (bắt đầu từ 1)
 * @param {number} params.limit - Số lượng mục trên mỗi trang
 * @param {string} params.type - Lọc theo loại thông báo
 * @param {string} params.read - Lọc theo trạng thái đọc (true/false/all)
 * @returns {Promise<{data: Notification[], meta: object}>}
 */
export const getNotifications = async ({ page = 1, limit = 10, type, read }) => {
  const params = new URLSearchParams();
  params.append('page', page);
  params.append('limit', limit);
  if (type) params.append('type', type);
  if (read !== undefined) params.append('read', read);

  const response = await apiClient.get(`/notifications?${params.toString()}`);
  return response.data;
};

/**
 * Lấy số lượng thông báo chưa đọc.
 * @returns {Promise<number>}
 */
export const getUnreadCount = async () => {
  const response = await apiClient.get('/notifications/unread-count');
  return response.data.data.unreadCount;
};

/**
 * Đánh dấu một thông báo là đã đọc.
 * @param {string} notificationId - ID của thông báo
 * @returns {Promise<object>}
 */
export const markNotificationAsRead = async (notificationId) => {
  const response = await apiClient.patch(`/notifications/${notificationId}/read`);
  return response.data;
};

/**
 * Đánh dấu tất cả thông báo là đã đọc.
 * @returns {Promise<{success: boolean}>}
 */
export const markAllAsRead = async () => {
  const response = await apiClient.patch('/notifications/read-all');
  return { success: response.success };
};

/**
 * Lấy thông báo gần nhất chưa đọc (dùng cho dropdown).
 * @returns {Promise<Notification[]>}
 */
export const getRecentNotifications = async () => {
  const response = await apiClient.get('/notifications?page=1&limit=5&read=false');
  return response.data.data;
};
</file>

<file path="src/services/onboardingService.js">
import apiClient from './apiClient';
import { logError } from '@/utils/errorHandling';

/**
 * Get onboarding status - Kiểm tra profile completeness
 * GET /api/candidate/onboarding/status
 */
export const getOnboardingStatus = async () => {
  try {
    const response = await apiClient.get('/candidate/onboarding/status');
    return response.data;
  } catch (error) {
    logError(error, { context: 'getOnboardingStatus' });
    throw error;
  }
};

/**
 * Get profile improvement recommendations
 * GET /api/candidate/onboarding/recommendations
 */
export const getRecommendations = async () => {
  try {
    const response = await apiClient.get('/candidate/onboarding/recommendations');
    return response.data;
  } catch (error) {
    logError(error, { context: 'getRecommendations' });
    throw error;
  }
};

/**
 * Update profile data - Không cần step ID
 * PUT /api/candidate/onboarding/update
 * @param {Object} profileData - Profile data to update
 */
export const updateProfileData = async (profileData) => {
  try {
    if (!profileData || typeof profileData !== 'object') {
      throw new Error('Invalid profile data');
    }

    const response = await apiClient.put('/candidate/onboarding/update', {
      profileData
    });
    return response.data;
  } catch (error) {
    logError(error, {
      context: 'updateProfileData',
      profileData
    });
    throw error;
  }
};

/**
 * Upload avatar
 * POST /api/candidate/onboarding/upload-avatar
 * @param {File} file - Avatar file
 */
export const uploadAvatar = async (file) => {
  try {
    const formData = new FormData();
    formData.append('avatar', file);

    const response = await apiClient.post('/candidate/onboarding/upload-avatar', formData, {
      headers: {
        'Content-Type': 'multipart/form-data'
      }
    });
    return response.data;
  } catch (error) {
    logError(error, { context: 'uploadAvatar' });
    throw error;
  }
};

/**
 * Dismiss onboarding reminder - Tạm thời bỏ qua
 * POST /api/candidate/onboarding/dismiss
 */
export const dismissOnboarding = async () => {
  try {
    const response = await apiClient.post('/candidate/onboarding/dismiss');
    return response.data;
  } catch (error) {
    logError(error, { context: 'dismissOnboarding' });
    throw error;
  }
};

// ===== DEPRECATED - Giữ lại để backward compatibility =====

/**
 * @deprecated Use updateProfileData instead
 */
export const updateOnboardingStep = async (stepId, stepData, completed = false) => {
  console.warn('updateOnboardingStep is deprecated. Use updateProfileData instead.');
  return updateProfileData(stepData);
};

/**
 * @deprecated Use dismissOnboarding instead
 */
export const skipOnboardingStep = async (stepId, reason = null) => {
  console.warn('skipOnboardingStep is deprecated. Use dismissOnboarding instead.');
  return dismissOnboarding();
};

/**
 * @deprecated No longer needed - profile completeness is checked automatically
 */
export const startOnboarding = async () => {
  console.warn('startOnboarding is deprecated. Profile completeness is checked automatically on login.');
  return getOnboardingStatus();
};

/**
 * Complete onboarding - Đánh dấu user đã hoàn thành onboarding
 * POST /api/candidate/onboarding/complete
 */
export const completeOnboarding = async () => {
  try {
    const response = await apiClient.post('/candidate/onboarding/complete');
    return response.data;
  } catch (error) {
    logError(error, { context: 'completeOnboarding' });
    throw error;
  }
};
</file>

<file path="src/services/walletService.js">
import apiClient from './apiClient';

/**
 * Lấy thông tin ví của user
 */
export const getWalletInfo = async () => {
  try {
    const response = await apiClient.get('/wallet');
    return response.data;
  } catch (error) {
    console.error('Error fetching wallet info:', error);
    throw error;
  }
};

/**
 * Lấy lịch sử giao dịch
 * @param {Object} params - Tham số query (page, limit, type)
 */
export const getTransactionHistory = async (params = {}) => {
  try {
    const response = await apiClient.get('/wallet/transactions', { params });
    return response.data;
  } catch (error) {
    console.error('Error fetching transaction history:', error);
    throw error;
  }
};

/**
 * Nạp xu vào ví
 * @param {Object} rechargeData - Dữ liệu nạp xu (amount, paymentMethod)
 */
export const rechargeWallet = async (rechargeData) => {
  try {
    const response = await apiClient.post('/wallet/recharge', rechargeData);
    return response.data;
  } catch (error) {
    console.error('Error recharging wallet:', error);
    throw error;
  }
};

/**
 * Chi tiêu xu (xem số ứng viên, mở khóa tính năng, etc.)
 * @param {Object} spendData - Dữ liệu chi tiêu (amount, purpose, targetId)
 */
export const spendCoins = async (spendData) => {
  try {
    const response = await apiClient.post('/wallet/spend', spendData);
    return response.data;
  } catch (error) {
    console.error('Error spending coins:', error);
    throw error;
  }
};

/**
 * Lấy các gói nạp xu có sẵn
 */
export const getRechargePackages = async () => {
  try {
    const response = await apiClient.get('/wallet/packages');
    return response.data;
  } catch (error) {
    console.error('Error fetching recharge packages:', error);
    throw error;
  }
};

/**
 * Lấy lịch sử nạp xu
 * @param {Object} params - Tham số query (page, limit)
 */
export const getRechargeHistory = async (params = {}) => {
  try {
    const response = await apiClient.get('/users/me/recharge-history', { params });
    return response.data;
  } catch (error) {
    console.error('Error fetching recharge history:', error);
    throw error;
  }
};
</file>

<file path="src/services/webrtc.service.js">
/**
 * WebRTC Service (Native) for Candidate
 * Pure WebRTC implementation for video call interviews
 * Candidate is the ANSWERER (receives offer, creates answer)
 */

class WebRTCService {
  constructor() {
    this.peerConnection = null;
    this.localStream = null;
    this.remoteStream = null;
    this.connectionState = 'disconnected';
    this.eventHandlers = new Map();
    this.isInitiator = false;
    
    // Track processed signals to prevent duplicates
    this.processedSignals = new Map(); // Map<signalType, timestamp>
    this.signalDebounceTime = 1000; // 1 second debounce
    
    // ICE servers configuration
    this.config = {
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' },
        {
          urls: 'turn:openrelay.metered.ca:80',
          username: 'openrelayproject',
          credential: 'openrelayproject'
        },
        {
          urls: 'turn:openrelay.metered.ca:443',
          username: 'openrelayproject',
          credential: 'openrelayproject'
        }
      ]
    };
  }

  /**
   * Register event handler
   */
  on(event, handler) {
    if (!this.eventHandlers.has(event)) {
      this.eventHandlers.set(event, []);
    }
    this.eventHandlers.get(event).push(handler);
  }

  /**
   * Unregister event handler
   */
  off(event, handler) {
    if (!this.eventHandlers.has(event)) return;
    
    const handlers = this.eventHandlers.get(event);
    const index = handlers.indexOf(handler);
    if (index > -1) {
      handlers.splice(index, 1);
    }
  }

  /**
   * Trigger event handlers
   * @private
   */
  _triggerHandler(event, data) {
    if (!this.eventHandlers.has(event)) return;
    
    const handlers = this.eventHandlers.get(event);
    handlers.forEach(handler => {
      try {
        handler(data);
      } catch (error) {
        console.error(`[WebRTC] Error in ${event} handler:`, error);
      }
    });
  }

  /**
   * Get user media (camera and microphone)
   */
  async getUserMedia(constraints = { video: true, audio: true }) {
    try {
      console.log('[WebRTC] Requesting user media with constraints:', constraints);
      
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      this.localStream = stream;
      
      const videoTrack = stream.getVideoTracks()[0];
      const audioTrack = stream.getAudioTracks()[0];
      if (videoTrack) {
        console.log('[WebRTC] Using video device:', videoTrack.label);
      }
      if (audioTrack) {
        console.log('[WebRTC] Using audio device:', audioTrack.label);
      }
      
      console.log('[WebRTC] Got local stream successfully');
      return stream;
    } catch (error) {
      console.error('[WebRTC] Failed to get user media:', error);
      
      this._triggerHandler('onError', {
        type: 'media-access',
        error,
        message: 'Không thể truy cập camera/microphone'
      });
      throw error;
    }
  }

  /**
   * Initialize peer connection as answerer (candidate receives offer)
   * @param {MediaStream} stream - Local media stream
   */
  initializePeerConnection(stream) {
    try {
      console.log('[WebRTC] Initializing peer connection as answerer (candidate)');
      
      // Prevent multiple initializations
      if (this.peerConnection && this.peerConnection.connectionState !== 'closed') {
        console.warn('[WebRTC] Peer connection already exists, skipping initialization');
        return this.peerConnection;
      }

      if (this.peerConnection) {
        console.log('[WebRTC] Closing existing peer connection');
        this.peerConnection.close();
        this.peerConnection = null;
      }

      this.localStream = stream;
      this.connectionState = 'connecting';
      this.isInitiator = false;

      // Create RTCPeerConnection
      this.peerConnection = new RTCPeerConnection(this.config);
      console.log('[WebRTC] RTCPeerConnection created');

      // Add local stream tracks to peer connection
      stream.getTracks().forEach(track => {
        console.log('[WebRTC] Adding track:', track.kind);
        this.peerConnection.addTrack(track, stream);
      });

      // Setup event handlers
      this._setupPeerConnectionHandlers();

      console.log('[WebRTC] Peer connection initialized successfully');
      this._triggerHandler('onConnectionInitialized');

      return this.peerConnection;
    } catch (error) {
      console.error('[WebRTC] Failed to initialize peer connection:', error);
      this._triggerHandler('onError', { 
        type: 'initialization', 
        error,
        message: 'Không thể khởi tạo kết nối WebRTC'
      });
      throw error;
    }
  }

  /**
   * Setup event handlers for RTCPeerConnection
   * @private
   */
  _setupPeerConnectionHandlers() {
    if (!this.peerConnection) return;

    // ICE candidate event
    this.peerConnection.onicecandidate = (event) => {
      if (event.candidate) {
        console.log('[WebRTC] ICE candidate generated');
        this._triggerHandler('onSignal', {
          type: 'candidate',
          candidate: event.candidate.candidate,
          sdpMLineIndex: event.candidate.sdpMLineIndex,
          sdpMid: event.candidate.sdpMid
        });
      } else {
        console.log('[WebRTC] ICE gathering complete');
      }
    };

    // Track event - remote stream received
    this.peerConnection.ontrack = (event) => {
      console.log('[WebRTC] Remote track received:', event.track.kind);
      
      if (event.streams && event.streams[0]) {
        if (!this.remoteStream) {
          console.log('[WebRTC] Setting remote stream');
          this.remoteStream = event.streams[0];
          this._triggerHandler('onRemoteStream', this.remoteStream);
        }
      }
    };

    // Connection state change
    this.peerConnection.onconnectionstatechange = () => {
      const state = this.peerConnection.connectionState;
      console.log('[WebRTC] Connection state:', state);
      this.connectionState = state;

      if (state === 'connected') {
        console.log('[WebRTC] Connection established!');
        this._triggerHandler('onConnectionEstablished');
      } else if (state === 'disconnected') {
        console.log('[WebRTC] Connection disconnected');
        this._triggerHandler('onConnectionClosed');
      } else if (state === 'failed') {
        console.error('[WebRTC] Connection failed');
        this._triggerHandler('onError', {
          type: 'connection-failed',
          message: 'Kết nối WebRTC thất bại'
        });
      } else if (state === 'closed') {
        console.log('[WebRTC] Connection closed');
        this._triggerHandler('onConnectionClosed');
      }
    };

    // ICE connection state change
    this.peerConnection.oniceconnectionstatechange = () => {
      const state = this.peerConnection.iceConnectionState;
      console.log('[WebRTC] ICE connection state:', state);
      
      if (state === 'failed' || state === 'disconnected') {
        console.warn('[WebRTC] ICE connection issue:', state);
      }
    };

    // Signaling state change
    this.peerConnection.onsignalingstatechange = () => {
      console.log('[WebRTC] Signaling state:', this.peerConnection.signalingState);
    };
  }

  /**
   * Handle signal from remote peer (offer, answer, or ice candidate)
   * @param {Object} signal - Signal data from remote peer
   */
  async handleSignal(signal) {
    try {
      if (!signal || typeof signal !== 'object') {
        console.warn('[WebRTC] Invalid signal data, ignoring:', signal);
        return;
      }

      if (!this.peerConnection) {
        console.warn('[WebRTC] Peer connection not initialized');
        return;
      }

      const signalType = signal.type;
      console.log('[WebRTC] ===== Handling Signal =====');
      console.log('[WebRTC] Signal type:', signalType);
      console.log('[WebRTC] Current signaling state:', this.peerConnection.signalingState);
      
      // Debounce offer/answer signals to prevent duplicates (but not ICE candidates)
      if (signalType === 'offer' || signalType === 'answer') {
        const now = Date.now();
        const lastProcessed = this.processedSignals.get(signalType);
        
        if (lastProcessed && (now - lastProcessed) < this.signalDebounceTime) {
          console.log(`[WebRTC] Ignoring duplicate ${signalType} signal (debounced)`);
          return;
        }
        
        this.processedSignals.set(signalType, now);
      }

      if (signalType === 'offer') {
        // Candidate receives offer from recruiter
        console.log('[WebRTC] Received offer, creating answer...');
        console.log('[WebRTC] Current signaling state:', this.peerConnection.signalingState);
        
        // Check if we're in the correct state to receive offer
        if (this.peerConnection.signalingState === 'stable' && this.peerConnection.remoteDescription) {
          console.log('[WebRTC] Already in stable state with remote description, ignoring duplicate offer');
          return;
        }
        
        const offerDesc = new RTCSessionDescription({
          type: 'offer',
          sdp: signal.sdp
        });
        
        await this.peerConnection.setRemoteDescription(offerDesc);
        console.log('[WebRTC] Remote description set (offer)');

        const answer = await this.peerConnection.createAnswer();
        await this.peerConnection.setLocalDescription(answer);
        console.log('[WebRTC] Local description set (answer)');
        console.log('[WebRTC] Answer SDP:', answer.sdp);

        // Send answer back
        this._triggerHandler('onSignal', {
          type: 'answer',
          sdp: answer.sdp
        });
        
      } else if (signalType === 'answer') {
        // Recruiter receives answer from candidate (candidate shouldn't receive this)
        console.warn('[WebRTC] Candidate received answer - ignoring (candidate should not receive answers)');
        
      } else if (signalType === 'candidate') {
        // ICE candidate
        if (!signal.candidate) {
          console.log('[WebRTC] Ignoring empty candidate');
          return;
        }

        console.log('[WebRTC] Adding ICE candidate');
        const candidate = new RTCIceCandidate({
          candidate: signal.candidate,
          sdpMLineIndex: signal.sdpMLineIndex,
          sdpMid: signal.sdpMid
        });
        
        await this.peerConnection.addIceCandidate(candidate);
        console.log('[WebRTC] ICE candidate added successfully');
        
      } else {
        console.warn('[WebRTC] Unknown signal type:', signalType);
      }
      
    } catch (error) {
      console.error('[WebRTC] Failed to handle signal:', error);
      this._triggerHandler('onError', {
        type: 'signal-handling',
        error,
        message: 'Không thể xử lý tín hiệu kết nối'
      });
    }
  }

  /**
   * Toggle audio track
   */
  async toggleAudio(enabled) {
    if (!this.localStream) return false;

    const audioTrack = this.localStream.getAudioTracks()[0];

    if (enabled) {
      if (audioTrack && audioTrack.readyState === 'live') {
        audioTrack.enabled = true;
        console.log('[WebRTC] Audio enabled');
        return true;
      }
      try {
        const savedSettings = localStorage.getItem('interviewDeviceSettings');
        const deviceSettings = savedSettings ? JSON.parse(savedSettings) : {};
        
        const audioConstraints = deviceSettings.audioDeviceId 
          ? { 
              deviceId: { exact: deviceSettings.audioDeviceId },
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true
            }
          : { 
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true
            };
        
        const newStream = await navigator.mediaDevices.getUserMedia({ audio: audioConstraints });
        const newTrack = newStream.getAudioTracks()[0];
        console.log('[WebRTC] Toggling audio ON with device:', newTrack.label);
        
        // Replace track in peer connection
        if (this.peerConnection) {
          const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'audio');
          if (sender) {
            await sender.replaceTrack(newTrack);
          }
        }
        
        if (audioTrack) {
          audioTrack.stop();
          this.localStream.removeTrack(audioTrack);
        }
        this.localStream.addTrack(newTrack);
        
        console.log('[WebRTC] Audio enabled with new track');
        this._triggerHandler('onLocalStreamUpdate', this.localStream);
        return true;
      } catch (error) {
        console.error('[WebRTC] Failed to enable audio:', error);
        this._triggerHandler('onError', { 
          type: 'media-access', 
          error, 
          message: 'Không thể bật microphone' 
        });
        return false;
      }
    } else {
      if (audioTrack) {
        audioTrack.enabled = false;
      }
      console.log('[WebRTC] Audio disabled');
      return true;
    }
  }

  /**
   * Toggle video track
   */
  async toggleVideo(enabled) {
    if (!this.localStream) return false;

    const videoTrack = this.localStream.getVideoTracks()[0];

    if (enabled) {
      if (videoTrack && videoTrack.readyState === 'live') {
        videoTrack.enabled = true;
        console.log('[WebRTC] Video enabled');
        return true;
      }
      try {
        const savedSettings = localStorage.getItem('interviewDeviceSettings');
        const deviceSettings = savedSettings ? JSON.parse(savedSettings) : {};
        
        const videoConstraints = deviceSettings.videoDeviceId
          ? { deviceId: { exact: deviceSettings.videoDeviceId } }
          : true;
        
        const newStream = await navigator.mediaDevices.getUserMedia({ video: videoConstraints });
        const newTrack = newStream.getVideoTracks()[0];
        console.log('[WebRTC] Toggling video ON with device:', newTrack.label);
        
        // Replace track in peer connection
        if (this.peerConnection) {
          const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'video');
          if (sender) {
            await sender.replaceTrack(newTrack);
          }
        }
        
        if (videoTrack) {
          videoTrack.stop();
          this.localStream.removeTrack(videoTrack);
        }
        this.localStream.addTrack(newTrack);
        
        console.log('[WebRTC] Video enabled with new track');
        this._triggerHandler('onLocalStreamUpdate', this.localStream);
        return true;
      } catch (error) {
        console.error('[WebRTC] Failed to enable video:', error);
        this._triggerHandler('onError', { 
          type: 'media-access', 
          error, 
          message: 'Không thể bật camera' 
        });
        return false;
      }
    } else {
      if (videoTrack) {
        videoTrack.enabled = false;
      }
      console.log('[WebRTC] Video disabled');
      return true;
    }
  }

  /**
   * Switch camera device
   */
  async switchCamera(deviceId) {
    try {
      console.log('[WebRTC] Switching camera to:', deviceId);
      
      const videoTrack = this.localStream?.getVideoTracks()[0];
      
      const newStream = await navigator.mediaDevices.getUserMedia({
        video: { deviceId: { exact: deviceId } }
      });
      
      const newTrack = newStream.getVideoTracks()[0];
      console.log('[WebRTC] New camera:', newTrack.label);
      
      // Replace track in peer connection
      if (this.peerConnection && videoTrack) {
        const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'video');
        if (sender) {
          await sender.replaceTrack(newTrack);
        }
      }
      
      if (videoTrack) {
        videoTrack.stop();
        this.localStream.removeTrack(videoTrack);
      }
      this.localStream.addTrack(newTrack);
      
      this._triggerHandler('onLocalStreamUpdate', this.localStream);
      console.log('[WebRTC] Camera switched successfully');
      
      return true;
    } catch (error) {
      console.error('[WebRTC] Failed to switch camera:', error);
      this._triggerHandler('onError', { 
        type: 'media-access', 
        error, 
        message: 'Không thể chuyển camera' 
      });
      return false;
    }
  }

  /**
   * Switch microphone device
   */
  async switchMicrophone(deviceId) {
    try {
      console.log('[WebRTC] Switching microphone to:', deviceId);
      
      const audioTrack = this.localStream?.getAudioTracks()[0];
      
      const newStream = await navigator.mediaDevices.getUserMedia({
        audio: { 
          deviceId: { exact: deviceId },
          echoCancellation: true,
          noiseSuppression: true,
          autoGainControl: true
        }
      });
      
      const newTrack = newStream.getAudioTracks()[0];
      console.log('[WebRTC] New microphone:', newTrack.label);
      
      // Replace track in peer connection
      if (this.peerConnection && audioTrack) {
        const sender = this.peerConnection.getSenders().find(s => s.track?.kind === 'audio');
        if (sender) {
          await sender.replaceTrack(newTrack);
        }
      }
      
      if (audioTrack) {
        audioTrack.stop();
        this.localStream.removeTrack(audioTrack);
      }
      this.localStream.addTrack(newTrack);
      
      this._triggerHandler('onLocalStreamUpdate', this.localStream);
      console.log('[WebRTC] Microphone switched successfully');
      
      return true;
    } catch (error) {
      console.error('[WebRTC] Failed to switch microphone:', error);
      this._triggerHandler('onError', { 
        type: 'media-access', 
        error, 
        message: 'Không thể chuyển microphone' 
      });
      return false;
    }
  }

  /**
   * Get available media devices
   */
  async getDevices() {
    try {
      const devices = await navigator.mediaDevices.enumerateDevices();
      
      const videoDevices = devices.filter(d => d.kind === 'videoinput');
      const audioDevices = devices.filter(d => d.kind === 'audioinput');
      
      console.log('[WebRTC] Available devices:', {
        video: videoDevices.length,
        audio: audioDevices.length
      });
      
      return {
        videoDevices,
        audioDevices
      };
    } catch (error) {
      console.error('[WebRTC] Failed to get devices:', error);
      return {
        videoDevices: [],
        audioDevices: []
      };
    }
  }

  /**
   * Close only peer connection (keep local stream alive)
   * Use this when remote peer disconnects but you want to keep local camera/mic active
   */
  closePeerConnection() {
    console.log('[WebRTC] Closing peer connection (keeping local stream)');

    if (this.peerConnection) {
      this.peerConnection.close();
      this.peerConnection = null;
    }

    this.remoteStream = null;
    this.connectionState = 'disconnected';
    
    // Clear processed signals tracking
    this.processedSignals.clear();

    console.log('[WebRTC] Peer connection closed, local stream preserved');
    this._triggerHandler('onConnectionClosed');
  }

  /**
   * Destroy everything including local stream
   * Use this when completely leaving the interview
   */
  destroy() {
    console.log('[WebRTC] Destroying peer connection and local stream');

    if (this.peerConnection) {
      this.peerConnection.close();
      this.peerConnection = null;
    }

    if (this.localStream) {
      this.localStream.getTracks().forEach(track => track.stop());
      this.localStream = null;
    }

    this.remoteStream = null;
    this.connectionState = 'disconnected';
    
    // Clear processed signals tracking
    this.processedSignals.clear();

    console.log('[WebRTC] Peer connection and local stream destroyed');
    this._triggerHandler('onConnectionClosed');
  }

  /**
   * Get connection state
   */
  getConnectionState() {
    return this.connectionState;
  }

  /**
   * Check if connected
   */
  isConnected() {
    return this.connectionState === 'connected';
  }

  addLocalStream() {
    // No-op for native WebRTC (stream passed to init)
    console.log('[WebRTC] addLocalStream called (no-op for native WebRTC)');
  }

  stopQualityMonitoring() {
    // Quality monitoring not implemented yet
    console.log('[WebRTC] stopQualityMonitoring called (not implemented)');
  }

  startQualityMonitoring() {
    // Quality monitoring not implemented yet
    console.log('[WebRTC] startQualityMonitoring called (not implemented)');
  }

  getLocalStream() {
    return this.localStream;
  }

  getRemoteStream() {
    return this.remoteStream;
  }
}

// Create singleton instance
const webrtcService = new WebRTCService();

export default webrtcService;
</file>

<file path="src/utils/dataMapper.js">
// src/utils/dataMapper.js

/**
 * Ánh xạ dữ liệu CV từ state của frontend sang cấu trúc mà backend mong đợi.
 * @param {Object} frontendCv - Dữ liệu CV từ state của frontend.
 * @returns {Object} - Dữ liệu CV đã được định dạng cho backend.
 */
export const mapToBackend = (frontendCv) => {
  const {
    personalInfo,
    professionalSummary,
    workExperience,
    education,
    skills,
    projects,
    certificates,
    sectionOrder,
    hiddenSections, // Thêm hiddenSections
    template // Thêm template
  } = frontendCv;

  return {
    // Backend mong muốn một 'title', 'templateId' và một object 'cvData'
    title: personalInfo?.fullName || 'Untitled CV',
    templateId: template,
    cvData: {
      personalInfo,
      professionalSummary,
      workExperience,
      education,
      skills,
      projects,
      certificates,
      sectionOrder,
      hiddenSections: hiddenSections || [], // Đảm bảo luôn có array
      template,
    },
  };
};

/**
 * Ánh xạ dữ liệu CV từ API của backend sang cấu trúc state của frontend.
 * @param {Object} backendCv - Dữ liệu CV từ API.
 * @returns {Object} - Dữ liệu CV đã được định dạng cho state frontend.
 */
export const mapToFrontend = (backendCv) => {
  const { _id, templateId, cvData, createdAt, updatedAt } = backendCv;

  // Dữ liệu mặc định để tránh lỗi khi các trường không tồn tại
  const defaults = {
    personalInfo: {},
    professionalSummary: '',
    workExperience: [],
    education: [],
    skills: [],
    projects: [],
    certificates: [],
    sectionOrder: ['summary', 'experience', 'education', 'skills', 'projects', 'certificates'],
    hiddenSections: [], // Thêm hiddenSections mặc định
  };
  
  return {
    id: _id, // Chuyển _id thành id
    ...defaults,
    ...cvData, // Giải nén các trường từ object cvData lồng nhau
    // Ưu tiên template từ cvData, nếu không có thì dùng templateId ở cấp cao nhất
    // để đảm bảo tương thích ngược và xử lý đúng khi tạo CV mới.
    template: cvData.template || templateId,
    // Đảm bảo hiddenSections luôn là array
    hiddenSections: cvData.hiddenSections || [],
    createdAt,
    updatedAt,
  };
};
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*
.kilocode
.trae
node_modules
dist
dist-ssr
*.local
.vscode/*
!.vscode/extensions.json
.idea
.kiro
.DS_Store
*.suo
*.ntvs*
.clinerules/*
.clinerules
*.njsproj
*.sln
*.sw?
.env
.github
digest.txt
.rar
.qoder
pnpm-lock.yaml
package-lock.json
</file>

<file path="index.html">
<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Primary Meta Tags -->
    <title>CareerZone - Nền tảng tìm việc làm hàng đầu</title>
    <meta name="title" content="CareerZone - Nền tảng tìm việc làm hàng đầu" />
    <meta name="description" content="Tìm kiếm công việc mơ ước của bạn tại CareerZone. Kết nối với hàng ngàn nhà tuyển dụng uy tín và cơ hội nghề nghiệp hấp dẫn." />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://careerzone.com/" />
    <meta property="og:title" content="CareerZone - Nền tảng tìm việc làm hàng đầu" />
    <meta property="og:description" content="Tìm kiếm công việc mơ ước của bạn tại CareerZone. Kết nối với hàng ngàn nhà tuyển dụng uy tín và cơ hội nghề nghiệp hấp dẫn." />
    <meta property="og:image" content="https://careerzone.com/logo-share.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="CareerZone Logo" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://careerzone.com/" />
    <meta property="twitter:title" content="CareerZone - Nền tảng tìm việc làm hàng đầu" />
    <meta property="twitter:description" content="Tìm kiếm công việc mơ ước của bạn tại CareerZone. Kết nối với hàng ngàn nhà tuyển dụng uy tín và cơ hội nghề nghiệp hấp dẫn." />
    <meta property="twitter:image" content="https://careerzone.com/logo-share.png" />
    
    <script src="https://cdn.jsdelivr.net/npm/@goongmaps/goong-js@1.0.9/dist/goong-js.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@goongmaps/goong-js@1.0.9/dist/goong-js.css" rel="stylesheet" />
  </head>
  <body>
    <div id="root"></div>
    <div id="fb-root"></div>
    <script type="module" src="/src/main.jsx"></script>
    <script>
  window.fbAsyncInit = function() {
    FB.init({
      appId: '787212570783616',
      autoLogAppEvents: true,
      xfbml: true,
      version: 'v18.0'
    });
  };
</script>
<script async defer crossorigin="anonymous" 
  src="https://connect.facebook.net/vi_VN/sdk.js"></script>
  </body>
</html>
</file>

<file path="src/components/CVPreview/templates/ModernBlueTemplate.jsx">
import React from 'react';
import { Mail, Phone, MapPin, Globe, Linkedin, Github, Calendar } from 'lucide-react';

const ModernBlueTemplate = ({ cvData, showHeader = true, measureMode = false }) => {
  const { personalInfo, professionalSummary, workExperience, education, skills, projects, certificates, sectionOrder } = cvData;

  // Section rendering functions
  const renderSummary = () => {
    if (!professionalSummary) return null;
    return (
      <section className="mb-8 break-inside-avoid" data-section="summary">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2">
          Professional Summary
        </h2>
        <p className="text-gray-700 leading-relaxed">{professionalSummary}</p>
      </section>
    );
  };

  const renderExperience = () => {
    if (!workExperience || workExperience.length === 0) return null;
    return (
      <section className="mb-8" data-section="experience">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2 break-after-avoid">
          Work Experience
        </h2>
        <div className="space-y-6">
          {workExperience.map((job) => (
            <div key={job.id} className="relative pl-6 border-l-2 border-blue-200 break-inside-avoid mb-6">
              <div className="absolute w-4 h-4 bg-blue-600 rounded-full -left-2 top-0"></div>
              <div className="flex justify-between items-start mb-2">
                <div>
                  <h3 className="text-xl font-semibold text-gray-800">{job.position}</h3>
                  <p className="text-blue-600 font-medium">{job.company}</p>
                </div>
                <div className="text-sm text-gray-500 flex items-center">
                  <Calendar className="w-4 h-4 mr-1" />
                  {job.startDate} - {job.isCurrentJob ? 'Present' : job.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-3">{job.description}</p>
              {job.achievements && job.achievements.length > 0 && (
                <ul className="list-disc list-inside text-gray-700 space-y-1">
                  {job.achievements.map((achievement, index) => (
                    <li key={index}>{achievement}</li>
                  ))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderEducation = () => {
    if (!education || education.length === 0) return null;
    return (
      <section className="mb-8" data-section="education">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2 break-after-avoid">
          Education
        </h2>
        <div className="space-y-4">
          {education.map((edu) => (
            <div key={edu.id} className="flex justify-between items-start break-inside-avoid mb-4">
              <div>
                <h3 className="text-lg font-semibold text-gray-800">{edu.degree}</h3>
                <p className="text-blue-600">{edu.institution}</p>
                <p className="text-gray-600">{edu.fieldOfStudy}</p>
                {edu.gpa && <p className="text-sm text-gray-500">GPA: {edu.gpa}</p>}
                {edu.honors && <p className="text-sm text-gray-500">{edu.honors}</p>}
              </div>
              <div className="text-sm text-gray-500 flex items-center">
                <Calendar className="w-4 h-4 mr-1" />
                {edu.startDate} - {edu.endDate}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderSkills = () => {
    if (!skills || skills.length === 0) return null;
    return (
      <section className="mb-8 break-inside-avoid" data-section="skills">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2">
          Skills
        </h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {['Technical', 'Soft Skills', 'Language'].map((category) => {
            const categorySkills = skills.filter(skill => skill.category === category);
            if (categorySkills.length === 0) return null;
            
            return (
              <div key={category}>
                <h3 className="font-semibold text-gray-800 mb-2">{category}</h3>
                <div className="space-y-2">
                  {categorySkills.map((skill) => (
                    <div key={skill.id}>
                      <div className="flex justify-between text-sm">
                        <span>{skill.name}</span>
                        <span className="text-blue-600">{skill.level}</span>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div
                          className="bg-blue-600 h-2 rounded-full"
                          style={{
                            width: skill.level === 'Expert' ? '100%' : 
                                   skill.level === 'Advanced' ? '80%' : 
                                   skill.level === 'Intermediate' ? '60%' : '40%'
                          }}
                        ></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            );
          })}
        </div>
      </section>
    );
  };

  const renderProjects = () => {
    if (!projects || projects.length === 0) return null;
    return (
      <section className="mb-8" data-section="projects">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2 break-after-avoid">
          Projects
        </h2>
        <div className="space-y-4">
          {projects.map((project) => (
            <div key={project.id} className="break-inside-avoid mb-4">
              <div className="flex justify-between items-start mb-2">
                <h3 className="text-lg font-semibold text-gray-800">{project.name}</h3>
                <div className="text-sm text-gray-500 flex items-center">
                  <Calendar className="w-4 h-4 mr-1" />
                  {project.startDate} - {project.endDate}
                </div>
              </div>
              <p className="text-gray-700 mb-2">{project.description}</p>
              <div className="flex flex-wrap gap-2">
                {project.technologies && project.technologies.map((tech, index) => (
                  <span key={index} className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  const renderCertificates = () => {
    if (!certificates || certificates.length === 0) return null;
    return (
      <section className="mb-8" data-section="certificates">
        <h2 className="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-blue-600 pb-2 break-after-avoid">
          Certifications
        </h2>
        <div className="space-y-3">
          {certificates.map((cert) => (
            <div key={cert.id} className="flex justify-between items-start break-inside-avoid mb-3">
              <div>
                <h3 className="font-semibold text-gray-800">{cert.name}</h3>
                <p className="text-blue-600">{cert.issuer}</p>
                {cert.credentialId && (
                  <p className="text-sm text-gray-500">ID: {cert.credentialId}</p>
                )}
              </div>
              <div className="text-sm text-gray-500">
                {cert.issueDate}
                {cert.expiryDate && ` - ${cert.expiryDate}`}
              </div>
            </div>
          ))}
        </div>
      </section>
    );
  };

  // Section mapping
  const sectionComponents = {
    summary: renderSummary,
    experience: renderExperience,
    education: renderEducation,
    skills: renderSkills,
    projects: renderProjects,
    certificates: renderCertificates
  };

  return (
    <div className="w-full bg-white">
      {/* Header */}
      {showHeader && (
      <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-8">
        <div className="flex items-center space-x-6">
          {personalInfo.profileImage && (
            <img
              src={personalInfo.profileImage}
              alt={personalInfo.fullName}
              className="w-24 h-24 rounded-full border-4 border-white object-cover"
            />
          )}
          <div className="flex-1">
            <h1 className="text-4xl font-bold mb-2">{personalInfo.fullName}</h1>
            <div className="grid grid-cols-2 gap-2 text-sm opacity-90">
              {personalInfo.email && (
                <div className="flex items-center">
                  <Mail className="w-4 h-4 mr-2" />
                  {personalInfo.email}
                </div>
              )}
              {personalInfo.phone && (
                <div className="flex items-center">
                  <Phone className="w-4 h-4 mr-2" />
                  {personalInfo.phone}
                </div>
              )}
              {personalInfo.address && (
                <div className="flex items-center">
                  <MapPin className="w-4 h-4 mr-2" />
                  {personalInfo.address}
                </div>
              )}
              {personalInfo.website && (
                <div className="flex items-center">
                  <Globe className="w-4 h-4 mr-2" />
                  {personalInfo.website}
                </div>
              )}
              {personalInfo.linkedin && (
                <div className="flex items-center">
                  <Linkedin className="w-4 h-4 mr-2" />
                  LinkedIn
                </div>
              )}
              {personalInfo.github && (
                <div className="flex items-center">
                  <Github className="w-4 h-4 mr-2" />
                  GitHub
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
      )}

      {/* Dynamic Content based on sectionOrder */}
      <div className="p-8">
        {sectionOrder && sectionOrder.map((sectionId) => {
          const renderFunction = sectionComponents[sectionId];
          return renderFunction ? renderFunction() : null;
        })}
      </div>
    </div>
  );
};

export default ModernBlueTemplate;
</file>

<file path="src/components/layout/DashboardLayout.jsx">
import { Outlet } from 'react-router-dom';
import Header from "./Header";
import Footer from "./Footer";

const DashboardLayout = () => {
  return (
    <div className="min-h-screen flex flex-col">
      <Header />
      <main className="grow">
        <div className="container py-8">
          <Outlet />
        </div>
      </main>
      <Footer />
    </div>
  );
};

export default DashboardLayout;
</file>

<file path="src/components/layout/JobsDropdownMenu.jsx">
import { useState, useRef } from 'react';
import { Link } from 'react-router-dom';
import { useSelector } from 'react-redux';
import { Briefcase, Bookmark, FileCheck, Bell, Shield, ChevronDown } from 'lucide-react';
import { cn } from '@/lib/utils';

const JobsDropdownMenu = ({ isHeaderWhite }) => {
  const [isOpen, setIsOpen] = useState(false);
  const { isAuthenticated } = useSelector((state) => state.auth);
  const timeoutRef = useRef(null);

  const menuItems = [
    {
      to: '/jobs/search',
      label: 'Tìm việc làm',
      icon: <Briefcase className="h-4 w-4" />,
      description: 'Khám phá cơ hội nghề nghiệp',
      public: true,
    },
    {
      to: '/dashboard/saved-jobs',
      label: 'Việc làm đã lưu',
      icon: <Bookmark className="h-4 w-4" />,
      description: 'Danh sách công việc yêu thích',
      public: false,
    },
    {
      to: '/dashboard/applications',
      label: 'Việc làm đã ứng tuyển',
      icon: <FileCheck className="h-4 w-4" />,
      description: 'Theo dõi đơn ứng tuyển',
      public: false,
    },
    {
      to: '/dashboard/settings/job-alerts',
      label: 'Quản lý thông báo việc làm',
      icon: <Bell className="h-4 w-4" />,
      description: 'Cài đặt thông báo việc làm',
      public: false,
    },
    {
      to: '/dashboard/settings/privacy',
      label: 'Cài đặt riêng tư',
      icon: <Shield className="h-4 w-4" />,
      description: 'Quản lý quyền riêng tư hồ sơ',
      public: false,
    },
  ];

  const visibleItems = isAuthenticated 
    ? menuItems 
    : menuItems.filter(item => item.public);

  const handleMouseEnter = () => {
    if (timeoutRef.current) {
      clearTimeout(timeoutRef.current);
    }
    setIsOpen(true);
  };

  const handleMouseLeave = () => {
    timeoutRef.current = setTimeout(() => {
      setIsOpen(false);
    }, 150); // 150ms delay before closing
  };

  return (
    <div
      className="relative"
      onMouseEnter={handleMouseEnter}
      onMouseLeave={handleMouseLeave}
    >
      {/* Trigger Button */}
      <Link
        to="/jobs/search"
        className={cn(
          "relative px-4 py-2 rounded-lg transition-all duration-300 font-semibold group flex items-center gap-1",
          "hover:bg-primary/5 hover:scale-105",
          isHeaderWhite
            ? "text-foreground hover:text-primary"
            : "text-muted-foreground hover:text-primary"
        )}
      >
        <span className="relative z-10">Việc làm</span>
        <ChevronDown
          className={cn(
            "h-4 w-4 transition-transform duration-300",
            isOpen && "rotate-180"
          )}
        />
        {/* Hover effect background */}
        <div className="absolute inset-0 rounded-lg bg-gradient-to-r from-primary/10 to-blue-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
        {/* Bottom border animation */}
        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-gradient-to-r from-primary to-blue-600 group-hover:w-3/4 transition-all duration-300" />
      </Link>

      {/* Dropdown Menu */}
      {isOpen && (
        <div
          className={cn(
            "absolute top-full left-0 pt-2 w-72 z-50",
            "animate-in slide-in-from-top-2 fade-in-0 duration-300"
          )}
        >
          <div className={cn(
            "bg-background/95 backdrop-blur-xl",
            "border-2 border-border/50 rounded-2xl overflow-hidden",
            // Enhanced shadow for depth
            "shadow-[0_20px_70px_-15px_rgba(0,0,0,0.3)]",
            "dark:shadow-[0_20px_70px_-15px_rgba(0,0,0,0.6)]",
            // Ring effect
            "ring-1 ring-black/5 dark:ring-white/10"
          )}>
            <div className="py-2">
              {visibleItems.map((item, index) => (
                <Link
                  key={item.to}
                  to={item.to}
                  className={cn(
                    "flex items-start gap-3 px-4 py-3 transition-colors duration-200",
                    "hover:bg-muted/50",
                    index !== visibleItems.length - 1 && "border-b border-border/30"
                  )}
                >
                  <div className="flex-shrink-0 mt-0.5 text-primary">
                    {item.icon}
                  </div>
                  <div className="flex-1 min-w-0">
                    <div className="text-sm font-medium text-foreground">
                      {item.label}
                    </div>
                    <div className="text-xs text-muted-foreground mt-0.5">
                      {item.description}
                    </div>
                  </div>
                </Link>
              ))}
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default JobsDropdownMenu;
</file>

<file path="src/components/onboarding/steps/SkillsExperienceStep.jsx">
// Legacy component - redirects to new SkillsStep
// This file is kept for backward compatibility
import { SkillsStep } from './SkillsStep';

// Legacy component wrapper for backward compatibility
export const SkillsExperienceStep = (props) => {
  return <SkillsStep {...props} />;
};
</file>

<file path="src/components/profile/index.js">
export { BasicInfoSection } from './BasicInfoSection';
export { ExperienceSection } from './ExperienceSection';
export { EducationSection } from './EducationSection';
export { SkillsSection } from './SkillsSection';
export { CVSection } from './CVSection';
export { ProfileCompletenessCard } from './ProfileCompletenessCard';
export { ProfileCompletionBanner } from './ProfileCompletionBanner';
export { ProfileCompletionBadge } from './ProfileCompletionBadge';
export { ProfileCompletionReminder } from './ProfileCompletionReminder';
</file>

<file path="src/components/profile/ProjectsSection.jsx">
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';
import { Plus, Edit2, Trash2, FolderGit2, ExternalLink, X, Save } from 'lucide-react';
import { toast } from 'sonner';
import { useCallback } from 'react';

const ProjectForm = ({ formData, onFormChange, onCancel, onSave, isUpdating }) => {
  const [techInput, setTechInput] = useState('');

  const handleAddTechnology = () => {
    if (techInput.trim() && !formData.technologies.includes(techInput.trim())) {
      onFormChange('technologies', [...formData.technologies, techInput.trim()]);
      setTechInput('');
    }
  };

  const handleRemoveTechnology = (tech) => {
    onFormChange('technologies', formData.technologies.filter(t => t !== tech));
  };

  return (
    <div className="space-y-4 p-4 border rounded-lg bg-card">
      <div>
        <Label htmlFor="name">Tên dự án <span className="text-destructive">*</span></Label>
        <Input
          id="name"
          value={formData.name}
          onChange={(e) => onFormChange('name', e.target.value)}
          placeholder="VD: E-commerce Platform"
        />
      </div>

      <div>
        <Label htmlFor="description">Mô tả</Label>
        <Textarea
          id="description"
          value={formData.description}
          onChange={(e) => onFormChange('description', e.target.value)}
          placeholder="Mô tả ngắn về dự án..."
          rows={3}
        />
      </div>

      <div>
        <Label htmlFor="url">Link dự án</Label>
        <Input
          id="url"
          type="url"
          value={formData.url}
          onChange={(e) => onFormChange('url', e.target.value)}
          placeholder="https://github.com/..."
        />
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div>
          <Label htmlFor="startDate">Ngày bắt đầu</Label>
          <Input
            id="startDate"
            type="month"
            value={formData.startDate}
            onChange={(e) => onFormChange('startDate', e.target.value)}
          />
        </div>
        <div>
          <Label htmlFor="endDate">Ngày kết thúc</Label>
          <Input
            id="endDate"
            type="month"
            value={formData.endDate}
            onChange={(e) => onFormChange('endDate', e.target.value)}
          />
        </div>
      </div>

      <div>
        <Label htmlFor="technologies">Công nghệ sử dụng</Label>
        <div className="flex gap-2">
          <Input
            id="technologies"
            value={techInput}
            onChange={(e) => setTechInput(e.target.value)}
            onKeyPress={(e) => {
              if (e.key === 'Enter') {
                e.preventDefault();
                handleAddTechnology();
              }
            }}
            placeholder="VD: React, Node.js..."
          />
          <Button type="button" onClick={handleAddTechnology}>
            Thêm
          </Button>
        </div>
        {formData.technologies.length > 0 && (
          <div className="flex flex-wrap gap-2 mt-2">
            {formData.technologies.map((tech, i) => (
              <Badge key={i} variant="secondary" className="gap-1">
                {tech}
                <X
                  className="w-3 h-3 cursor-pointer"
                  onClick={() => handleRemoveTechnology(tech)}
                />
              </Badge>
            ))}
          </div>
        )}
      </div>

      <div className="flex gap-2 justify-end">
        <Button variant="outline" onClick={onCancel} disabled={isUpdating}>
          <X className="w-4 h-4 mr-2" />
          Hủy
        </Button>
        <Button onClick={onSave} disabled={isUpdating}>
          <Save className="w-4 h-4 mr-2" />
          {isUpdating ? 'Đang lưu...' : 'Lưu'}
        </Button>
      </div>
    </div>
  );
};

export const ProjectsSection = ({ projects = [], onUpdate }) => {
  const [isAdding, setIsAdding] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [currentProjectFormData, setCurrentProjectFormData] = useState({
    name: '',
    description: '',
    url: '',
    startDate: '',
    endDate: '',
    technologies: []
  });
  const [isUpdating, setIsUpdating] = useState(false);

  const handleFormChange = useCallback((field, value) => {
    setCurrentProjectFormData(prev => ({ ...prev, [field]: value }));
  }, []);

  const formatDate = (dateString) => {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('vi-VN', { month: '2-digit', year: 'numeric' });
  };

  const handleAdd = () => {
    setCurrentProjectFormData({
      name: '',
      description: '',
      url: '',
      startDate: '',
      endDate: '',
      technologies: []
    });
    setIsAdding(true);
    setEditingId(null);
  };

  const handleEdit = (project) => {
    setEditingId(project._id);
    setCurrentProjectFormData({
      ...project,
      startDate: project.startDate ? new Date(project.startDate).toISOString().slice(0, 7) : '',
      endDate: project.endDate ? new Date(project.endDate).toISOString().slice(0, 7) : ''
    });
    setIsAdding(false);
  };

  const handleCancel = () => {
    setIsAdding(false);
    setEditingId(null);
    setCurrentProjectFormData({
      name: '',
      description: '',
      url: '',
      startDate: '',
      endDate: '',
      technologies: []
    });
  };

  const handleSave = async () => {
    if (!currentProjectFormData.name) {
      toast.error('Vui lòng nhập tên dự án');
      return;
    }

    try {
      setIsUpdating(true);
      let updatedProjects;

      if (isAdding) {
        updatedProjects = [...projects, currentProjectFormData];
      } else {
        updatedProjects = projects.map(proj =>
          proj._id === editingId ? { ...proj, ...currentProjectFormData } : proj
        );
      }

      await onUpdate({ projects: updatedProjects });
      toast.success(isAdding ? 'Thêm dự án thành công' : 'Cập nhật dự án thành công');
      handleCancel(); // Reset form and editing state
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  const handleDelete = async (projId) => {
    if (!window.confirm('Bạn có chắc chắn muốn xóa dự án này?')) return;

    try {
      setIsUpdating(true);
      const updatedProjects = projects.filter(proj => proj._id !== projId);
      await onUpdate({ projects: updatedProjects });
      toast.success('Xóa dự án thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  return (
    <Card>
      <CardHeader className="flex flex-row items-center justify-between">
        <CardTitle className="flex items-center gap-2">
          <FolderGit2 className="w-5 h-5" />
          Dự án
        </CardTitle>
        {!isAdding && !editingId && (
          <Button onClick={handleAdd} size="sm">
            <Plus className="w-4 h-4 mr-2" />
            Thêm dự án
          </Button>
        )}
      </CardHeader>
      <CardContent>
        {isAdding && (
          <ProjectForm
            formData={currentProjectFormData}
            onFormChange={handleFormChange}
            onCancel={handleCancel}
            onSave={handleSave}
            isUpdating={isUpdating}
          />
        )}

        {projects.length === 0 && !isAdding ? (
          <div className="text-center py-8 text-muted-foreground">
            <FolderGit2 className="w-12 h-12 mx-auto mb-3 opacity-50" />
            <p>Chưa có dự án nào</p>
            <p className="text-sm mt-1">Thêm dự án để thể hiện kinh nghiệm thực tế</p>
          </div>
        ) : (
          <div className="space-y-4">
            {projects.map((project) => (
              <div key={project._id} className="space-y-2">
                {editingId === project._id ? (
                  <ProjectForm
                    formData={currentProjectFormData}
                    onFormChange={handleFormChange}
                    onCancel={handleCancel}
                    onSave={handleSave}
                    isUpdating={isUpdating}
                  />
                ) : (
                  <div className="border-l-2 border-primary/20 pl-4 pb-4">
                    <div className="flex justify-between items-start">
                      <div className="flex-1">
                        <h4 className="font-semibold text-lg text-foreground">{project.name}</h4>
                        {project.description && (
                          <p className="text-sm text-muted-foreground mt-1">{project.description}</p>
                        )}
                        {(project.startDate || project.endDate) && (
                          <p className="text-xs text-muted-foreground mt-2">
                            {formatDate(project.startDate)} - {project.endDate ? formatDate(project.endDate) : 'Hiện tại'}
                          </p>
                        )}
                        {project.technologies && project.technologies.length > 0 && (
                          <div className="flex flex-wrap gap-1 mt-2">
                            {project.technologies.map((tech, i) => (
                              <Badge key={i} variant="secondary" className="text-xs">
                                {tech}
                              </Badge>
                            ))}
                          </div>
                        )}
                        {project.url && (
                          <a
                            href={project.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-xs text-primary hover:underline flex items-center gap-1 mt-2"
                          >
                            Xem dự án <ExternalLink className="w-3 h-3" />
                          </a>
                        )}
                      </div>
                      <div className="flex gap-2">
                        <Button
                          size="sm"
                          variant="ghost"
                          onClick={() => handleEdit(project)}
                          disabled={isUpdating}
                        >
                          <Edit2 className="w-4 h-4" />
                        </Button>
                        <Button
                          size="sm"
                          variant="ghost"
                          className="text-destructive hover:text-destructive"
                          onClick={() => handleDelete(project._id)}
                          disabled={isUpdating}
                        >
                          <Trash2 className="w-4 h-4" />
                        </Button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/sections/Testimonials.jsx">
import { Star, Quote, ChevronLeft, ChevronRight } from 'lucide-react';
import { Card, CardContent } from '../ui/card';
import { Avatar, AvatarFallback, AvatarImage } from '../ui/avatar';
import { Button } from '../ui/button';
import { Badge } from '../ui/badge';

const testimonials = [
  { 
    id: 1, 
    name: 'Nguyễn Văn An', 
    position: 'Frontend Developer tại TechCorp', 
    content: 'CareerZone đã giúp tôi tìm được công việc mơ ước. Giao diện thân thiện, thông tin việc làm chi tiết và quy trình ứng tuyển rất thuận tiện. Tôi đã nhận được 3 lời mời phỏng vấn chỉ trong tuần đầu tiên.',
    avatar: 'https://randomuser.me/api/portraits/men/44.jpg', 
    rating: 5,
    company: 'TechCorp',
    companyLogo: 'https://randomuser.me/api/portraits/lego/5.jpg'
  },
  { 
    id: 2, 
    name: 'Trần Thị Mai', 
    position: 'Marketing Manager tại StartupXYZ', 
    content: 'Tôi rất ấn tượng với chất lượng các cơ hội việc làm trên CareerZone. Đặc biệt là các công ty đều rất uy tín và môi trường làm việc chuyên nghiệp. Hệ thống thông báo việc làm mới cũng rất hữu ích.',
    avatar: 'https://randomuser.me/api/portraits/women/63.jpg', 
    rating: 5,
    company: 'StartupXYZ',
    companyLogo: 'https://randomuser.me/api/portraits/lego/1.jpg'
  },
  { 
    id: 3, 
    name: 'Lê Minh Tuấn', 
    position: 'UI/UX Designer tại Creative Agency', 
    content: 'Platform tuyệt vời cho người tìm việc! Tôi đã nhận được nhiều lời mời phỏng vấn chỉ trong vòng 2 tuần sau khi đăng ký. Khả năng kết nối với nhà tuyển dụng rất tốt và tôi đánh giá cao sự hỗ trợ từ đội ngũ CareerZone.',
    avatar: 'https://randomuser.me/api/portraits/men/35.jpg', 
    rating: 5,
    company: 'Creative Agency',
    companyLogo: 'https://randomuser.me/api/portraits/lego/8.jpg'
  },
];

const Testimonials = () => {
  return (
    <section className="py-20 bg-muted/30">
      <div className="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6">
        <div className="flex flex-col md:flex-row md:items-end justify-between mb-12">
          <div>
            <Badge variant="outline" className="text-primary mb-4 bg-background border-primary/30">
              👥 Người dùng chia sẻ
            </Badge>
            <h2 className="text-3xl md:text-4xl font-bold mb-4 text-foreground">
              Câu chuyện <span className="text-gradient-primary">thành công</span>
            </h2>
            <p className="text-lg text-muted-foreground max-w-2xl">
              Hàng ngàn người đã tìm được công việc mơ ước thông qua nền tảng CareerZone. 
              Dưới đây là một số câu chuyện thành công của họ.
            </p>
          </div>
          <div className="flex gap-2 mt-6 md:mt-0">
            <Button variant="outline" size="icon" className="h-10 w-10 rounded-full border-primary/30 hover:bg-primary hover:text-primary-foreground">
              <ChevronLeft className="h-6 w-6" />
            </Button>
            <Button variant="outline" size="icon" className="h-10 w-10 rounded-full border-primary/30 hover:bg-primary hover:text-primary-foreground">
              <ChevronRight className="h-6 w-6" />
            </Button>
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          {testimonials.map((testimonial) => (
            <Card key={testimonial.id} variant="interactive" className="overflow-visible relative">
              <div className="absolute -top-5 left-8 w-10 h-10 bg-gradient-primary rounded-full flex items-center justify-center shadow-lg">
                <Quote className="h-5 w-5 text-primary-foreground" />
              </div>
              <CardContent className="p-8 pt-10">
                <div className="flex items-center mb-6">
                  {[...Array(testimonial.rating)].map((_, i) => (
                    <Star key={i} className="h-5 w-5 text-warning fill-warning" />
                  ))}
                </div>
                
                <p className="text-muted-foreground mb-6 italic leading-relaxed">"{testimonial.content}"</p>
                
                <div className="flex items-center gap-4">
                  <Avatar className="h-14 w-14 border-2 border-primary/20">
                    <AvatarImage src={testimonial.avatar} alt={testimonial.name} />
                    <AvatarFallback className="bg-primary/10 text-primary font-semibold">{testimonial.name.charAt(0)}</AvatarFallback>
                  </Avatar>
                  <div>
                    <p className="font-bold text-lg text-foreground">{testimonial.name}</p>
                    <p className="text-sm text-muted-foreground font-medium">{testimonial.position}</p>
                  </div>
                </div>
                
                <div className="mt-6 pt-6 border-t border-border flex items-center justify-between">
                  <span className="text-sm text-muted-foreground font-medium">Công ty:</span>
                  <div className="flex items-center gap-2">
                    <Avatar className="h-6 w-6">
                      <AvatarImage src={testimonial.companyLogo} alt={testimonial.company} />
                      <AvatarFallback className="bg-primary/10 text-primary text-xs font-bold">{testimonial.company.charAt(0)}</AvatarFallback>
                    </Avatar>
                    <span className="font-semibold text-foreground">{testimonial.company}</span>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>

        <div className="mt-20 text-center">
          <Card className="max-w-4xl mx-auto bg-gradient-primary text-white p-8 md:p-12 shadow-2xl border-0">
            <CardContent className="p-0">
              <h3 className="text-2xl md:text-3xl font-bold mb-4">
                Bạn cũng muốn có câu chuyện thành công như vậy?
              </h3>
              <p className="text-white/90 mb-8 max-w-2xl mx-auto leading-relaxed">
                Hãy tham gia CareerZone ngay hôm nay và khám phá hàng ngàn cơ hội việc làm tuyệt vời!
                Việc làm mơ ước của bạn đang chờ phía trước.
              </p>
              <div className="flex flex-col sm:flex-row gap-4 justify-center">
                <Button variant="secondary" size="lg" className="bg-background text-foreground hover:bg-background/90 font-semibold shadow-lg">
                  Tìm việc làm
                </Button>
                <Button size="lg" className="bg-background text-primary hover:bg-background/90 font-semibold shadow-lg">
                  Đăng ký ngay
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </section>
  );
};

export default Testimonials;
</file>

<file path="src/data/templates.js">
export const cvTemplates = [
  {
    id: 'modern-blue',
    name: 'Hiện Đại Xanh Dương',
    nameEn: 'Modern Blue',
    description: 'Thiết kế hiện đại với điểm nhấn màu xanh dương chuyên nghiệp. Phù hợp cho các vị trí công nghệ, kỹ thuật và doanh nghiệp.',
    shortDesc: 'Chuyên nghiệp, hiện đại',
    thumbnail: '/assets/modern-blue-preview.png',
    category: 'Hiện Đại',
    categoryEn: 'Modern',
    bestFor: ['Công nghệ', 'Kỹ thuật', 'Kinh doanh']
  },
  {
    id: 'classic-white',
    name: 'Cổ Điển Trắng',
    nameEn: 'Classic White',
    description: 'Bố cục truyền thống với kiểu chữ rõ ràng, tạo ấn tượng chuyên nghiệp và đáng tin cậy. Lựa chọn an toàn cho mọi ngành nghề.',
    shortDesc: 'Truyền thống, tin cậy',
    thumbnail: '/assets/classic-white-preview.png',
    category: 'Cổ Điển',
    categoryEn: 'Classic',
    bestFor: ['Tài chính', 'Luật', 'Hành chính']
  },
  {
    id: 'creative-gradient',
    name: 'Sáng Tạo Gradient',
    nameEn: 'Creative Gradient',
    description: 'Thiết kế bắt mắt với hiệu ứng gradient màu sắc. Thể hiện sự sáng tạo và cá tính, phù hợp cho ngành nghệ thuật và thiết kế.',
    shortDesc: 'Sáng tạo, nổi bật',
    thumbnail: '/assets/creative-gradient-preview.png',
    category: 'Sáng Tạo',
    categoryEn: 'Creative',
    bestFor: ['Thiết kế', 'Marketing', 'Nghệ thuật']
  },
  {
    id: 'minimal-gray',
    name: 'Tối Giản Xám',
    nameEn: 'Minimal Gray',
    description: 'Phong cách tối giản thanh lịch với tông màu xám tinh tế. Tập trung vào nội dung, phù hợp cho người có kinh nghiệm.',
    shortDesc: 'Tối giản, thanh lịch',
    thumbnail: '/assets/minimal-gray-preview.png',
    category: 'Tối Giản',
    categoryEn: 'Minimal',
    bestFor: ['Kiến trúc', 'Tư vấn', 'Quản lý']
  },
  {
    id: 'two-column-sidebar',
    name: 'Hai Cột Sidebar',
    nameEn: 'Two Column Sidebar',
    description: 'Bố cục 2 cột chuyên nghiệp với thanh bên nổi bật. Tối ưu không gian, dễ đọc và tổ chức thông tin rõ ràng.',
    shortDesc: 'Tối ưu, dễ đọc',
    thumbnail: '/assets/two-column-sidebar-preview.png',
    category: 'Hai Cột',
    categoryEn: 'Two Column',
    bestFor: ['IT', 'Kỹ sư', 'Phân tích']
  },
  {
    id: 'elegant-serif',
    name: 'Thanh Lịch Serif',
    nameEn: 'Elegant Serif',
    description: 'Kiểu chữ serif tinh tế mang phong cách cổ điển sang trọng. Thể hiện sự chuyên nghiệp và đẳng cấp cao.',
    shortDesc: 'Sang trọng, đẳng cấp',
    thumbnail: '/assets/elegant-serif-preview.png',
    category: 'Cổ Điển',
    categoryEn: 'Classic',
    bestFor: ['Giáo dục', 'Xuất bản', 'Nghiên cứu']
  },
  {
    id: 'modern-sans',
    name: 'Hiện Đại Sans',
    nameEn: 'Modern Sans',
    description: 'Kiểu chữ sans-serif hiện đại với khoảng cách hợp lý. Gọn gàng, dễ đọc và phù hợp với xu hướng đương đại.',
    shortDesc: 'Hiện đại, gọn gàng',
    thumbnail: '/assets/modern-sans-preview.png',
    category: 'Hiện Đại',
    categoryEn: 'Modern',
    bestFor: ['Startup', 'Digital', 'Media']
  },
  {
    id: 'compact-dense',
    name: 'Gọn Gàng Tối Ưu',
    nameEn: 'Compact Dense',
    description: 'Bố cục tối ưu không gian cho nội dung phong phú. Lý tưởng khi bạn có nhiều kinh nghiệm cần trình bày.',
    shortDesc: 'Tối ưu không gian',
    thumbnail: '/assets/compact-dense-preview.png',
    category: 'Gọn Gàng',
    categoryEn: 'Compact',
    bestFor: ['Senior', 'Đa kinh nghiệm', 'Học thuật']
  },
  {
    id: 'creative-split',
    name: 'Sáng Tạo Chia Đôi',
    nameEn: 'Creative Split',
    description: 'Thiết kế táo bạo với màn hình chia đôi và khối màu nổi bật. Tạo ấn tượng mạnh mẽ và khác biệt.',
    shortDesc: 'Táo bạo, khác biệt',
    thumbnail: '/assets/creative-split-preview.png',
    category: 'Sáng Tạo',
    categoryEn: 'Creative',
    bestFor: ['UX/UI', 'Branding', 'Creative Director']
  },
  {
    id: 'executive-formal',
    name: 'Quản Lý Cao Cấp',
    nameEn: 'Executive Formal',
    description: 'Thiết kế cao cấp trang trọng dành cho vị trí quản lý cấp cao. Thể hiện uy tín, kinh nghiệm và tầm nhìn lãnh đạo.',
    shortDesc: 'Cao cấp, lãnh đạo',
    thumbnail: '/assets/executive-formal-preview.png',
    category: 'Quản Lý',
    categoryEn: 'Executive',
    bestFor: ['C-Level', 'Director', 'Manager']
  }
];
</file>

<file path="src/main.jsx">
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { Provider } from 'react-redux';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { store } from './redux/store';
import App from '@/App.jsx';
import '@/index.css';
import '@/styles/onboarding.css';
import { Button } from './components/ui/button';

const queryClient = new QueryClient();

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <Provider store={store}>
      <QueryClientProvider client={queryClient}>
        <App />
      </QueryClientProvider>
    </Provider>
  </StrictMode>
);
</file>

<file path="src/pages/billing/Billing.jsx">
import { useState } from 'react';
import { usePayment } from '../../hooks/usePayment';
import { Button } from '../../components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../../components/ui/tabs';
import { RadioGroup, RadioGroupItem } from '../../components/ui/radio-group';
import { Label } from '../../components/ui/label';
import { Input } from '../../components/ui/input';
import { CreditCard, History, Receipt } from 'lucide-react';
import { Link } from 'react-router-dom';
import { cn } from '../../lib/utils';
import RechargeHistory from '../../components/billing/RechargeHistory';

// Helper function
const formatCurrency = (value) => new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);

const coinPackages = [
  { amount: 100, price: 10000, popular: false },
  { amount: 150, price: 15000, popular: false },
  { amount: 200, price: 20000, popular: true },
  { amount: 500, price: 50000, popular: false },
  { amount: 1000, price: 100000, popular: false },
];

const BillingPage = () => {
  const [selectedOption, setSelectedOption] = useState(coinPackages.find(p => p.popular).amount);
  const [customAmount, setCustomAmount] = useState('');
  const [paymentMethod, setPaymentMethod] = useState('ZALOPAY');
  const { isProcessing, handlePayment } = usePayment();

  const getPackageDetails = () => {
    if (selectedOption === 'custom') {
      const amount = parseInt(customAmount, 10);
      if (!isNaN(amount) && amount > 0) {
        return { amount, price: amount * 100 };
      }
      return { amount: 0, price: 0 };
    }
    return coinPackages.find(p => p.amount === selectedOption);
  };

  const selectedPackage = getPackageDetails();
  const finalAmount = selectedPackage?.amount || 0;

  const handleSubmit = () => {
    if (finalAmount > 0) {
      handlePayment({ coins: finalAmount, paymentMethod });
    }
  };

  return (
    <div className="w-full min-h-[calc(100vh-80px)] flex items-center justify-center p-4 md:p-8 bg-muted/30">
      <Card className="w-full max-w-6xl shadow-lg">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div>
              <CardTitle>Quản lý Xu</CardTitle>
              <CardDescription>Nạp xu và xem lịch sử giao dịch để sử dụng các tính năng cao cấp.</CardDescription>
            </div>
            <Link to="/dashboard/credit-history">
              <Button variant="outline" className="gap-2">
                <Receipt className="h-4 w-4" />
                Lịch sử chi tiết
              </Button>
            </Link>
          </div>
        </CardHeader>
        <CardContent className="pt-6">
          <Tabs defaultValue="recharge" className="w-full">
            <TabsList className="grid w-full grid-cols-2">
              <TabsTrigger value="recharge" className="flex items-center gap-2">
                <CreditCard className="h-4 w-4" />
                Nạp Xu
              </TabsTrigger>
              <TabsTrigger value="history" className="flex items-center gap-2">
                <History className="h-4 w-4" />
                Lịch sử
              </TabsTrigger>
            </TabsList>
            
            <TabsContent value="recharge" className="mt-6">
              <div className="grid md:grid-cols-3 gap-8">
                {/* Left Column: Coin Packages */}
                <div className="md:col-span-2 space-y-4">
                  <Label className="text-lg font-semibold">Chọn gói xu</Label>
                  <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    {coinPackages.map((pkg) => (
                      <div
                        key={pkg.amount}
                        className={cn(
                          "relative rounded-lg border p-4 flex flex-col items-center justify-center cursor-pointer transition-all h-28",
                          selectedOption === pkg.amount ? "border-primary ring-2 ring-primary" : "hover:border-gray-400"
                        )}
                        onClick={() => setSelectedOption(pkg.amount)}
                      >
                        {pkg.popular && (
                          <div className="absolute -top-3 bg-primary text-primary-foreground px-2 py-0.5 text-xs font-bold rounded-full">
                            Phổ biến
                          </div>
                        )}
                        <div className="text-2xl font-bold">{pkg.amount} xu</div>
                        <div className="text-sm text-muted-foreground">{formatCurrency(pkg.price)}</div>
                      </div>
                    ))}
                    {/* Custom Amount Option */}
                    <div
                      className={cn(
                        "relative rounded-lg border p-4 flex flex-col items-center justify-center cursor-pointer transition-all h-28",
                        selectedOption === 'custom' ? "border-primary ring-2 ring-primary" : "hover:border-gray-400"
                      )}
                      onClick={() => setSelectedOption('custom')}
                    >
                      <div className="text-lg font-semibold">Tùy chỉnh</div>
                      <div className="text-sm text-muted-foreground">Nhập số xu</div>
                    </div>
                  </div>
                   {selectedOption === 'custom' && (
                    <div className="pt-4">
                      <Label htmlFor="custom-amount">Nhập số xu bạn muốn nạp</Label>
                      <Input
                         id="custom-amount"
                         type="number"
                         placeholder="Ví dụ: 150"
                         value={customAmount}
                         onChange={(e) => setCustomAmount(e.target.value)}
                         className="mt-2"
                         min="1"
                      />
                    </div>
                  )}
                </div>

                {/* Right Column: Payment Method & Summary */}
                <div className="md:col-span-1 space-y-6">
                  {/* Payment Method */}
                  <div className="space-y-4">
                    <Label className="text-lg font-semibold">Chọn phương thức thanh toán</Label>
                    <div className="mt-2 flex flex-col gap-4">
                       <label htmlFor="ZALOPAY" className="flex items-center gap-3 p-3 border rounded-md cursor-pointer hover:border-gray-400">
                        <input type="radio" name="paymentMethod" value="ZALOPAY" id="ZALOPAY" checked={paymentMethod === 'ZALOPAY'} onChange={() => setPaymentMethod('ZALOPAY')} />
                         <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/10/Logo-ZaloPay-Square.png" alt="ZaloPay" className="h-8 w-8" />
                         <span>ZaloPay</span>
                       </label>
                       <label htmlFor="VNPAY" className="flex items-center gap-3 p-3 border rounded-md cursor-pointer hover:border-gray-400">
                         <input type="radio" name="paymentMethod" value="VNPAY" id="VNPAY" checked={paymentMethod === 'VNPAY'} onChange={() => setPaymentMethod('VNPAY')} />
                         <img src="https://vnpay.vn/s1/statics.vnpay.vn/2023/9/06ncktiwd6dc1694418196384.png" alt="VNPAY" className="h-8 w-8" />
                         <span>VNPAY</span>
                       </label>
                    </div>
                  </div>
                  
                  {/* Payment Summary */}
                  <div className="space-y-4">
                      <div className="text-lg font-semibold">Tổng thanh toán</div>
                      <div className="text-3xl font-bold text-primary">
                          {selectedPackage ? formatCurrency(selectedPackage.price) : '0 VNĐ'}
                      </div>
                  </div>

                  {/* Submit Button */}
                  <Button onClick={handleSubmit} disabled={isProcessing || finalAmount <= 0} size="lg" className="w-full">
                      {isProcessing ? 'Đang xử lý...' : `Thanh toán với ${paymentMethod}`}
                  </Button>
                </div>
              </div>
            </TabsContent>
            
            <TabsContent value="history" className="mt-6">
              <RechargeHistory />
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>
    </div>
  );
};

export default BillingPage;
</file>

<file path="src/pages/dashboard/settings/JobAlertSettings.jsx">
import { useState } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import {
  Plus,
  Pencil,
  Trash2,
  Bell,
  BellOff,
  MapPin,
  Briefcase,
  Clock,
  DollarSign,
  Laptop,
  GraduationCap,
  Mail,
  Smartphone,
  MoreVertical
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';
import { EmptyState } from '@/components/common/EmptyState';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { getMyJobAlerts, deleteJobAlert, updateJobAlert } from '@/services/jobAlertService';
import {
  getFrequencyLabel,
  getSalaryRangeLabel,
  getWorkTypeLabel,
  getExperienceLabel,
  getCategoryLabel,
  getNotificationMethodLabel,
} from '@/constants/jobAlertEnums';
import JobAlertDialog from '@/components/jobs/JobAlertDialog';
import { cn } from '@/lib/utils';

const JobAlertSettings = () => {
  const queryClient = useQueryClient();
  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);
  const [selectedAlert, setSelectedAlert] = useState(null);
  const [editDialogOpen, setEditDialogOpen] = useState(false);

  // Fetch job alerts
  const { data: alerts, isLoading, isError, error, refetch } = useQuery({
    queryKey: ['jobAlerts'],
    queryFn: getMyJobAlerts,
  });

  // Delete mutation
  const deleteMutation = useMutation({
    mutationFn: (id) => deleteJobAlert(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['jobAlerts'] });
      toast.success('Đã xóa thông báo việc làm');
      setDeleteDialogOpen(false);
      setSelectedAlert(null);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể xóa thông báo');
    },
  });

  // Toggle active mutation
  const toggleActiveMutation = useMutation({
    mutationFn: ({ id, alertData }) => updateJobAlert(id, alertData),
    onSuccess: (_, variables) => {
      queryClient.invalidateQueries({ queryKey: ['jobAlerts'] });
      toast.success(variables.alertData.active ? 'Đã bật thông báo' : 'Đã tắt thông báo');
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể cập nhật thông báo');
    },
  });

  const handleDelete = (alert) => {
    setSelectedAlert(alert);
    setDeleteDialogOpen(true);
  };

  const handleEdit = (alert) => {
    setSelectedAlert(alert);
    setEditDialogOpen(true);
  };

  const handleToggleActive = (alert) => {
    // Send full alert data with only active field changed
    const alertData = {
      keyword: alert.keyword,
      location: alert.location,
      frequency: alert.frequency,
      salaryRange: alert.salaryRange,
      type: alert.type,
      workType: alert.workType,
      experience: alert.experience,
      category: alert.category,
      notificationMethod: alert.notificationMethod,
      active: !alert.active,
    };
    toggleActiveMutation.mutate({ id: alert._id, alertData });
  };

  const confirmDelete = () => {
    if (selectedAlert) {
      deleteMutation.mutate(selectedAlert._id);
    }
  };

  if (isLoading) {
    return (
      <div className="space-y-6">
        {/* Header Skeleton */}
        <div className="flex items-start justify-between">
          <div className="space-y-2">
            <Skeleton className="h-9 w-80" />
            <Skeleton className="h-5 w-96" />
          </div>
          <Skeleton className="h-10 w-40" />
        </div>

        {/* Cards Skeleton */}
        <div className="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
          {[1, 2, 3].map((i) => (
            <Card key={i} className="border-2 shadow-sm">
              <CardHeader className="pb-4 pl-5">
                <div className="flex items-start justify-between gap-3">
                  <div className="flex-1 space-y-3">
                    <div className="flex items-center gap-2.5">
                      <Skeleton className="h-10 w-10 rounded-lg" />
                      <Skeleton className="h-6 w-40" />
                    </div>
                    <div className="flex items-center gap-2 pl-0.5">
                      <Skeleton className="h-4 w-4" />
                      <Skeleton className="h-4 w-32" />
                    </div>
                  </div>
                  <Skeleton className="h-9 w-9 rounded-md" />
                </div>
              </CardHeader>
              <CardContent className="space-y-4 pl-5">
                <div className="space-y-2">
                  <Skeleton className="h-3 w-16" />
                  <div className="flex gap-2">
                    <Skeleton className="h-6 w-20" />
                    <Skeleton className="h-6 w-24" />
                    <Skeleton className="h-6 w-20" />
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-3 pt-3">
                  <Skeleton className="h-12 w-full" />
                  <Skeleton className="h-12 w-full" />
                </div>
                <Skeleton className="h-11 w-full rounded-lg" />
              </CardContent>
            </Card>
          ))}
        </div>
      </div>
    );
  }

  if (isError) {
    const errorMessage = error.response?.data?.message || error.message;
    return <ErrorState onRetry={refetch} message={errorMessage} />;
  }

  const canAddMore = !alerts || alerts.length < 3;

  const getNotificationIcon = (method) => {
    switch (method) {
      case 'EMAIL':
        return <Mail className="h-3.5 w-3.5" />;
      case 'APPLICATION':
        return <Smartphone className="h-3.5 w-3.5" />;
      case 'BOTH':
        return <Mail className="h-3.5 w-3.5" />;
      default:
        return <Bell className="h-3.5 w-3.5" />;
    }
  };

  return (
    <div className="space-y-6">
      {/* Header Section */}
      <div className="flex items-start justify-between">
        <div>
          <h1 className="text-3xl font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text">
            Quản lý thông báo việc làm
          </h1>
          <p className="text-muted-foreground mt-2">
            Nhận thông báo khi có việc làm phù hợp với tiêu chí của bạn. Tối đa 3 thông báo.
          </p>
        </div>
        <JobAlertDialog
          trigger={
            <Button disabled={!canAddMore} className="btn-gradient">
              <Plus className="h-4 w-4 mr-2" />
              Thêm thông báo
            </Button>
          }
          onSuccess={() => {
            queryClient.invalidateQueries({ queryKey: ['jobAlerts'] });
          }} message="Bạn chưa có thông báo việc làm nào. Tạo thông báo để nhận cơ hội việc làm phù hợp!"
        />
      </div>

      {/* Limit Warning */}
      {!canAddMore && (
        <div className="p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3">
          <Bell className="h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5" />
          <div>
            <p className="text-sm font-medium text-amber-900">
              Đã đạt giới hạn thông báo
            </p>
            <p className="text-sm text-amber-700 mt-1">
              Bạn đã tạo tối đa 3 thông báo. Xóa thông báo cũ để thêm mới.
            </p>
          </div>
        </div>
      )}

      {/* Alerts Grid */}
      {!alerts || alerts.length === 0 ? (
        <Card className="border-dashed">
          <CardContent className="pt-6">
            <EmptyState
              message="Bạn chưa có thông báo việc làm nào. Tạo thông báo để nhận cơ hội việc làm phù hợp!"
              actionText="Tạo thông báo đầu tiên"
              onAction={() => setEditDialogOpen(true)}
            />
          </CardContent>
        </Card>
      ) : (
        <div className="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
          {alerts.map((alert) => (
            <Card
              key={alert._id}
              className={cn(
                "relative overflow-hidden transition-all duration-300 group",
                "bg-card border-2 shadow-sm hover:shadow-xl",
                alert.active
                  ? "border-emerald-200 hover:border-emerald-300"
                  : "border-border opacity-80 hover:opacity-100"
              )}
            >
              {/* Status Indicator - Left Border */}
              <div
                className={cn(
                  "absolute top-0 left-0 bottom-0 w-1.5",
                  alert.active
                    ? "bg-gradient-to-b from-emerald-500 via-green-500 to-emerald-600"
                    : "bg-gray-300"
                )}
              />

              <CardHeader className="pb-4 pl-5">
                <div className="flex items-start justify-between gap-3">
                  <div className="flex-1 min-w-0">
                    {/* Keyword with Icon */}
                    <div className="flex items-center gap-2.5 mb-3">
                      <div className={cn(
                        "p-2 rounded-lg transition-colors",
                        alert.active 
                          ? "bg-emerald-100 text-emerald-700" 
                          : "bg-muted text-muted-foreground"
                      )}>
                        <Briefcase className="h-4 w-4" />
                      </div>
                      <h3 className="font-bold text-lg truncate text-foreground">
                        {alert.keyword || 'Tất cả công việc'}
                      </h3>
                    </div>
                    
                    {/* Location */}
                    <div className="flex items-center gap-2 text-sm text-muted-foreground pl-0.5">
                      <MapPin className="h-4 w-4 flex-shrink-0" />
                      <span className="truncate font-medium">
                        {alert.location?.province || 'Toàn quốc'}
                        {alert.location?.district && alert.location.district !== 'ALL' && (
                          <span className="text-xs font-normal"> • {alert.location.district}</span>
                        )}
                      </span>
                    </div>
                  </div>

                  {/* Actions Dropdown */}
                  <DropdownMenu>
                    <DropdownMenuTrigger asChild>
                      <Button 
                        variant="ghost" 
                        size="sm" 
                        className="h-9 w-9 p-0 hover:bg-muted"
                      >
                        <MoreVertical className="h-4 w-4" />
                      </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent align="end" className="w-48">
                      <DropdownMenuItem onClick={() => handleToggleActive(alert)}>
                        {alert.active ? (
                          <>
                            <BellOff className="h-4 w-4 mr-2" />
                            Tạm dừng
                          </>
                        ) : (
                          <>
                            <Bell className="h-4 w-4 mr-2" />
                            Kích hoạt
                          </>
                        )}
                      </DropdownMenuItem>
                      <DropdownMenuItem onClick={() => handleEdit(alert)}>
                        <Pencil className="h-4 w-4 mr-2" />
                        Chỉnh sửa
                      </DropdownMenuItem>
                      <DropdownMenuSeparator />
                      <DropdownMenuItem
                        onClick={() => handleDelete(alert)}
                        className="text-destructive focus:text-destructive"
                      >
                        <Trash2 className="h-4 w-4 mr-2" />
                        Xóa
                      </DropdownMenuItem>
                    </DropdownMenuContent>
                  </DropdownMenu>
                </div>
              </CardHeader>

              <CardContent className="space-y-4 pl-5">
                {/* Filters Section */}
                <div className="space-y-2">
                  <p className="text-xs font-semibold text-muted-foreground uppercase tracking-wide">
                    Bộ lọc
                  </p>
                  <div className="flex flex-wrap gap-2">
                    {alert.category !== 'ALL' && (
                      <Badge 
                        variant="outline" 
                        className="text-xs font-medium border-primary/30 bg-primary/5 text-primary"
                      >
                        {getCategoryLabel(alert.category)}
                      </Badge>
                    )}
                    {alert.experience !== 'ALL' && (
                      <Badge 
                        variant="outline" 
                        className="text-xs font-medium border-blue-300 bg-blue-50 text-blue-700 flex items-center gap-1"
                      >
                        <GraduationCap className="h-3 w-3" />
                        {getExperienceLabel(alert.experience)}
                      </Badge>
                    )}
                    {alert.salaryRange !== 'ALL' && (
                      <Badge 
                        variant="outline" 
                        className="text-xs font-medium border-amber-300 bg-amber-50 text-amber-700 flex items-center gap-1"
                      >
                        <DollarSign className="h-3 w-3" />
                        {getSalaryRangeLabel(alert.salaryRange)}
                      </Badge>
                    )}
                    {alert.workType !== 'ALL' && (
                      <Badge 
                        variant="outline" 
                        className="text-xs font-medium border-purple-300 bg-purple-50 text-purple-700 flex items-center gap-1"
                      >
                        <Laptop className="h-3 w-3" />
                        {getWorkTypeLabel(alert.workType)}
                      </Badge>
                    )}
                  </div>
                </div>

                {/* Info Section */}
                <div className="grid grid-cols-2 gap-3 pt-3 border-t border-border/50">
                  <div className="flex items-center gap-2 text-sm">
                    <div className="p-1.5 rounded-md bg-muted">
                      <Clock className="h-3.5 w-3.5 text-muted-foreground" />
                    </div>
                    <div>
                      <p className="text-xs text-muted-foreground">Tần suất</p>
                      <p className="font-medium text-foreground">{getFrequencyLabel(alert.frequency)}</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-2 text-sm">
                    <div className="p-1.5 rounded-md bg-muted">
                      {getNotificationIcon(alert.notificationMethod)}
                    </div>
                    <div>
                      <p className="text-xs text-muted-foreground">Phương thức</p>
                      <p className="font-medium text-foreground truncate">
                        {getNotificationMethodLabel(alert.notificationMethod)}
                      </p>
                    </div>
                  </div>
                </div>

                {/* Status Badge */}
                <div className="pt-3">
                  {alert.active ? (
                    <div className="flex items-center justify-center gap-2 py-2.5 px-4 rounded-lg bg-emerald-50 border border-emerald-200">
                      <Bell className="h-4 w-4 text-emerald-600" />
                      <span className="text-sm font-semibold text-emerald-700">
                        Đang hoạt động
                      </span>
                    </div>
                  ) : (
                    <div className="flex items-center justify-center gap-2 py-2.5 px-4 rounded-lg bg-gray-50 border border-gray-200">
                      <BellOff className="h-4 w-4 text-gray-500" />
                      <span className="text-sm font-semibold text-gray-600">
                        Tạm dừng
                      </span>
                    </div>
                  )}
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      )}

      {/* Delete Confirmation Dialog */}
      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle>Xác nhận xóa</AlertDialogTitle>
            <AlertDialogDescription>
              Bạn có chắc chắn muốn xóa thông báo việc làm "{selectedAlert?.keyword || 'này'}"?
              Hành động này không thể hoàn tác.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel>Hủy</AlertDialogCancel>
            <AlertDialogAction
              onClick={confirmDelete}
              className="bg-destructive hover:bg-destructive/90"
            >
              Xóa
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Edit Dialog */}
      {editDialogOpen && (
        <JobAlertDialog
          open={editDialogOpen}
          onOpenChange={setEditDialogOpen}
          alert={selectedAlert}
          onSuccess={() => {
            queryClient.invalidateQueries({ queryKey: ['jobAlerts'] });
            setEditDialogOpen(false);
            setSelectedAlert(null);
          }}
        />
      )}
    </div>
  );
};

export default JobAlertSettings;
</file>

<file path="src/pages/jobs/components/SearchInterface/SearchFilters.jsx">
import React from 'react';
import { Separator } from '@/components/ui/separator';
import {
  jobCategoryEnum,
  jobTypeEnum,
  workTypeEnum,
  experienceEnum
} from '@/schemas/searchSchemas';
import FilterGroup from './FilterGroup';
import SalaryRangeSlider from './SalaryRangeSlider';
import LocationFilter from './LocationFilter';
import DistanceFilter from './DistanceFilter';

/**
 * Main SearchFilters component that combines all filter types
 * Manages the filter state and passes changes to parent component
 */
const SearchFilters = ({
  filters = {},
  onFilterChange
}) => {
  // Filter configurations aligned with searchSchemas.js
  const categoryOptions = [
    { value: '', label: 'Tất cả' },
    ...jobCategoryEnum.map(value => ({
      value,
      label: {
        IT: 'Công nghệ thông tin',
        SOFTWARE_DEVELOPMENT: 'Phát triển phần mềm',
        DATA_SCIENCE: 'Khoa học dữ liệu',
        MACHINE_LEARNING: 'Học máy',
        WEB_DEVELOPMENT: 'Phát triển web',
        SALES: 'Bán hàng',
        MARKETING: 'Marketing',
        ACCOUNTING: 'Kế toán',
        GRAPHIC_DESIGN: 'Thiết kế đồ họa',
        CONTENT_WRITING: 'Viết nội dung',
        MEDICAL: 'Y tế',
        TEACHING: 'Giảng dạy',
        ENGINEERING: 'Kỹ thuật',
        PRODUCTION: 'Sản xuất',
        LOGISTICS: 'Logistics',
        HOSPITALITY: 'Khách sạn - Du lịch',
        REAL_ESTATE: 'Bất động sản',
        LAW: 'Pháp lý',
        FINANCE: 'Tài chính',
        HUMAN_RESOURCES: 'Nhân sự',
        CUSTOMER_SERVICE: 'Chăm sóc khách hàng',
        ADMINISTRATION: 'Hành chính',
        MANAGEMENT: 'Quản lý',
        OTHER: 'Khác'
      }[value] || value
    }))
  ];

  const jobTypeOptions = [
    { value: '', label: 'Tất cả' },
    ...jobTypeEnum.map(value => ({
      value,
      label: {
        FULL_TIME: 'Toàn thời gian',
        PART_TIME: 'Bán thời gian',
        CONTRACT: 'Hợp đồng',
        TEMPORARY: 'Tạm thời',
        INTERNSHIP: 'Thực tập',
        FREELANCE: 'Tự do'
      }[value] || value
    }))
  ];

  const workTypeOptions = [
    { value: '', label: 'Tất cả' },
    ...workTypeEnum.map(value => ({
      value,
      label: {
        ON_SITE: 'Tại văn phòng',
        REMOTE: 'Từ xa',
        HYBRID: 'Linh hoạt'
      }[value] || value
    }))
  ];

  const experienceOptions = [
    { value: '', label: 'Tất cả' },
    ...experienceEnum.map(value => ({
      value,
      label: {
        ENTRY_LEVEL: 'Nhân viên',
        MID_LEVEL: 'Trung cấp',
        SENIOR_LEVEL: 'Cao cấp',
        EXECUTIVE: 'Điều hành',
        NO_EXPERIENCE: 'Không yêu cầu kinh nghiệm',
        INTERN: 'Thực tập sinh',
        FRESHER: 'Mới tốt nghiệp'
      }[value] || value
    }))
  ];

  /**
   * Handle individual filter changes
   * @param {string} filterType - Type of filter (category, type, etc.)
   * @param {string} value - New value for the filter
   */
  const handleFilterChange = (filterType, value) => {
    onFilterChange({
      ...filters,
      [filterType]: value
    });
  };

  /**
   * Handle salary range changes
   * @param {Object} salaryData - Object with minSalary and maxSalary
   */
  const handleSalaryChange = (salaryData) => {
    onFilterChange({
      ...filters,
      minSalary: salaryData.minSalary,
      maxSalary: salaryData.maxSalary
    });
  };

  /**
   * Handle location changes
   * @param {Object} locationData - Object with province and district
   */
  const handleLocationChange = (locationData) => {
    onFilterChange({
      ...filters,
      province: locationData.province,
      district: locationData.district
    });
  };

  /**
   * Handle distance filter changes
   * @param {Object} distanceData - Object with distance, latitude, longitude
   */
  const handleDistanceChange = (distanceData) => {
    onFilterChange({
      ...filters,
      distance: distanceData.distance,
      latitude: distanceData.latitude,
      longitude: distanceData.longitude
    });
  };

  return (
    <div className="space-y-4">
      {/* Distance Filter - New */}
      <DistanceFilter
        distance={filters.distance || ''}
        latitude={filters.latitude || ''}
        longitude={filters.longitude || ''}
        onChange={handleDistanceChange}
      />
      
      <Separator />
      {/* Job Category Filter */}
      <FilterGroup
        title="Lĩnh vực"
        value={filters.category || ''}
        options={categoryOptions}
        onChange={(value) => handleFilterChange('category', value)}
        collapsible={true}
        defaultExpanded={false}
        maxVisibleItems={6}
      />

      <Separator />

      {/* Job Type Filter */}
      <FilterGroup
        title="Loại hình công việc"
        value={filters.type || ''}
        options={jobTypeOptions}
        onChange={(value) => handleFilterChange('type', value)}
        collapsible={true}
        defaultExpanded={true}
        maxVisibleItems={4}
      />

      <Separator />

      {/* Work Type Filter */}
      <FilterGroup
        title="Hình thức làm việc"
        value={filters.workType || ''}
        options={workTypeOptions}
        onChange={(value) => handleFilterChange('workType', value)}
        collapsible={true}
        defaultExpanded={true}
        maxVisibleItems={3}
      />

      <Separator />

      {/* Experience Level Filter */}
      <FilterGroup
        title="Kinh nghiệm"
        value={filters.experience || ''}
        options={experienceOptions}
        onChange={(value) => handleFilterChange('experience', value)}
        collapsible={true}
        defaultExpanded={false}
        maxVisibleItems={4}
      />

      <Separator />

      {/* Location Filter */}
      <LocationFilter
        province={filters.province || ''}
        district={filters.district || ''}
        onChange={handleLocationChange}
      />

      <Separator />

      {/* Salary Range Slider - New Interactive Component */}
      <SalaryRangeSlider
        minSalary={filters.minSalary || ''}
        maxSalary={filters.maxSalary || ''}
        onChange={handleSalaryChange}
      />
    </div>
  );
};

export default SearchFilters;
</file>

<file path="src/pages/jobs/components/SearchResults/SearchResultsHeader.jsx">
import React from 'react';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Separator } from '@/components/ui/separator';
import { Search, Sparkles, Filter, X, TrendingUp } from 'lucide-react';
import { cn } from '@/lib/utils';

/**
 * SearchResultsHeader component
 * Displays search results count, pagination info, and filter controls
 */
const SearchResultsHeader = ({
  query = '',
  currentPage = 1,
  totalPages = 0,
  hasActiveFilters = false,
  onClearFilters,
  className
}) => {
  /**
   * Get pagination text
   */
  const getPaginationText = () => {
    if (totalPages <= 1) return null;
    
    return (
      <div className={cn(
        "flex items-center gap-2 px-4 py-2 rounded-lg",
        "bg-gradient-to-r from-primary/10 to-primary/5",
        "border border-primary/20"
      )}>
        <span className="text-sm font-semibold text-primary">
          Trang {currentPage} / {totalPages}
        </span>
      </div>
    );
  };

  return (
    <div className={cn("space-y-4 mb-6", className)}>
      {/* Main Results Info */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div className="space-y-2">
          <div className="flex items-center gap-3">
            {query ? (
              <>
                <div className="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 border-2 border-primary/30">
                  <Search className="h-5 w-5 text-primary" />
                </div>
                <div>
                  <h1 className="text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent">
                    Kết quả tìm kiếm
                  </h1>
                  <p className="text-sm text-muted-foreground font-medium">
                    Từ khóa: <span className="text-foreground font-semibold">"{query}"</span>
                  </p>
                </div>
              </>
            ) : (
              <>
                <div className="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 border-2 border-primary/30 animate-pulse">
                  <TrendingUp className="h-5 w-5 text-primary" />
                </div>
                <div>
                  <h1 className="text-2xl font-bold bg-gradient-to-r from-primary via-primary/80 to-primary/70 bg-clip-text text-transparent">
                    Tất cả việc làm
                  </h1>
                  <p className="text-sm text-muted-foreground font-medium flex items-center gap-1">
                    <Sparkles className="h-3 w-3 text-primary" />
                    Khám phá các cơ hội việc làm mới nhất
                  </p>
                </div>
              </>
            )}
          </div>
        </div>
        
        <div className="flex items-center gap-2">
          {getPaginationText()}
        </div>
      </div>

      {/* Active Filters & Controls */}
      {(hasActiveFilters || query) && (
        <div className="flex flex-wrap items-center gap-2">
          {query && (
            <Badge 
              variant="secondary" 
              className={cn(
                "px-4 py-2 rounded-lg font-semibold",
                "bg-gradient-to-r from-blue-500/15 to-cyan-500/10",
                "text-blue-600 border border-blue-500/30",
                "hover:from-blue-500/25 hover:to-cyan-500/15",
                "transition-all duration-300"
              )}
            >
              <Search className="h-3 w-3 mr-2" />
              <span className="text-sm">"{query}"</span>
            </Badge>
          )}
          
          {hasActiveFilters && (
            <>
              <Badge 
                variant="outline" 
                className={cn(
                  "px-4 py-2 rounded-lg font-semibold",
                  "bg-gradient-to-r from-primary/10 to-primary/5",
                  "text-primary border-2 border-primary/30",
                  "hover:from-primary/20 hover:to-primary/10",
                  "transition-all duration-300 animate-pulse"
                )}
              >
                <Filter className="h-3 w-3 mr-2" />
                <span className="text-sm">Bộ lọc đang áp dụng</span>
              </Badge>
              
              <Button
                variant="ghost"
                size="sm"
                onClick={onClearFilters}
                className={cn(
                  "h-9 px-4 rounded-lg font-semibold",
                  "text-muted-foreground hover:text-red-600",
                  "hover:bg-red-50/20 border-2 border-transparent",
                  "hover:border-red-500/30",
                  "transition-all duration-300 hover:scale-105"
                )}
              >
                <X className="h-4 w-4 mr-1" />
                Xóa bộ lọc
              </Button>
            </>
          )}
        </div>
      )}

      <Separator className="bg-gradient-to-r from-transparent via-border to-transparent" />
    </div>
  );
};

export default SearchResultsHeader;
</file>

<file path="src/redux/store.js">
import { configureStore } from '@reduxjs/toolkit';
import authReducer from './authSlice';
import searchHistoryReducer from './searchHistorySlice';
import onboardingReducer from './slices/onboardingSlice';
import notificationReducer from './notificationSlice';

export const store = configureStore({
  reducer: {
    auth: authReducer,
    searchHistory: searchHistoryReducer,
    onboarding: onboardingReducer,
    notifications: notificationReducer,
  },
});
</file>

<file path="src/schemas/onboardingSchemas.js">
import { z } from 'zod';

// Experience level enum
export const experienceLevelEnum = [
  'Fresher',
  'Junior',
  'Mid-level',
  'Senior'
];

// Work type enum
export const workTypeEnum = [
  'Full-time',
  'Part-time',
  'Remote',
  'Hybrid'
];

// Contract type enum
export const contractTypeEnum = [
  'Chính thức',
  'Thực tập',
  'Freelance'
];

// Custom error messages for better UX
const errorMessages = {
  required: 'Trường này là bắt buộc',
  invalidFormat: 'Định dạng không hợp lệ',
  tooShort: (min) => `Phải có ít nhất ${min} ký tự`,
  tooLong: (max) => `Không được vượt quá ${max} ký tự`,
  invalidPhone: 'Số điện thoại không hợp lệ. Vui lòng nhập số điện thoại Việt Nam (VD: 0912345678)',
  invalidName: 'Họ tên chỉ được chứa chữ cái, khoảng trắng và dấu tiếng Việt',
  minItems: (min) => `Vui lòng chọn ít nhất ${min} mục`,
  maxItems: (max) => `Chỉ được chọn tối đa ${max} mục`,
  invalidNumber: 'Vui lòng nhập số hợp lệ',
  minValue: (min) => `Giá trị phải lớn hơn hoặc bằng ${min}`,
  maxValue: (max) => `Giá trị không được vượt quá ${max}`
};

// Basic Info Step Schema with enhanced validation
export const basicInfoSchema = z.object({
  fullName: z.string({
    required_error: errorMessages.required,
    invalid_type_error: errorMessages.invalidFormat
  })
    .trim()
    .min(2, { message: errorMessages.tooShort(2) })
    .max(100, { message: errorMessages.tooLong(100) })
    .regex(/^[a-zA-ZÀ-ỹ\s]+$/, { message: errorMessages.invalidName })
    .refine((val) => val.split(' ').filter(Boolean).length >= 2, {
      message: 'Vui lòng nhập họ và tên đầy đủ (ít nhất 2 từ)'
    }),
  phone: z.string({
    required_error: errorMessages.required,
    invalid_type_error: errorMessages.invalidFormat
  })
    .trim()
    .regex(/^(0|\+84)[0-9]{9,10}$/, { message: errorMessages.invalidPhone })
    .refine((val) => {
      // Additional validation for Vietnamese phone numbers
      const cleaned = val.replace(/\+84/, '0');
      return cleaned.length === 10 || cleaned.length === 11;
    }, {
      message: 'Số điện thoại phải có 10-11 chữ số'
    }),
  avatar: z.any().optional(),
  preferredLocations: z.array(z.object({
    province: z.string().min(1, 'Vui lòng chọn tỉnh/thành phố'),
    district: z.string().nullable().optional() // null = tất cả quận/huyện
  }), {
    required_error: errorMessages.required,
    invalid_type_error: errorMessages.invalidFormat
  })
    .min(1, { message: errorMessages.minItems(1) })
    .max(5, { message: errorMessages.maxItems(5) })
});

// Skills Step Schema (Bước 2)
export const skillsSchema = z.object({
  preferredCategories: z.array(z.string(), {
    required_error: 'Vui lòng chọn ít nhất 1 ngành nghề',
    invalid_type_error: errorMessages.invalidFormat
  })
    .min(1, { message: 'Vui lòng chọn ít nhất 1 ngành nghề' })
    .max(5, { message: errorMessages.maxItems(5) + ' ngành nghề' }),
  skills: z.array(z.string().trim().min(1, 'Kỹ năng không được để trống'), {
    required_error: errorMessages.required,
    invalid_type_error: errorMessages.invalidFormat
  })
    .min(3, { message: errorMessages.minItems(3) + ' kỹ năng' })
    .max(20, { message: errorMessages.maxItems(20) + ' kỹ năng' })
    .refine((skills) => {
      // Check for duplicate skills (case-insensitive)
      const uniqueSkills = new Set(skills.map(s => s.toLowerCase()));
      return uniqueSkills.size === skills.length;
    }, {
      message: 'Không được chọn kỹ năng trùng lặp'
    }),
  customSkills: z.array(z.string()).optional()
});

// Salary & Preferences Step Schema (Bước 3)
export const salaryPreferencesSchema = z.object({
  expectedSalary: z.object({
    min: z.coerce.number({
      required_error: errorMessages.required,
      invalid_type_error: errorMessages.invalidNumber
    })
      .min(1000000, { message: 'Mức lương tối thiểu phải từ 1 triệu VNĐ trở lên' })
      .max(1000000000, { message: errorMessages.maxValue('1 tỷ VNĐ') })
      .int('Mức lương phải là số nguyên'),
    max: z.coerce.number({
      required_error: errorMessages.required,
      invalid_type_error: errorMessages.invalidNumber
    })
      .min(1000000, { message: 'Mức lương tối đa phải từ 1 triệu VNĐ trở lên' })
      .max(1000000000, { message: errorMessages.maxValue('1 tỷ VNĐ') })
      .int('Mức lương phải là số nguyên'),
    currency: z.string().default('VND')
  }).refine(data => data.max >= data.min, {
    message: 'Mức lương tối đa phải lớn hơn hoặc bằng mức lương tối thiểu',
    path: ['max']
  }).refine(data => {
    // Check if salary range is reasonable (max should not be more than 10x min)
    return data.max <= data.min * 10;
  }, {
    message: 'Khoảng lương quá rộng. Mức tối đa không nên vượt quá 10 lần mức tối thiểu',
    path: ['max']
  }),
  workTypes: z.array(z.enum(workTypeEnum), {
    required_error: errorMessages.required,
    invalid_type_error: errorMessages.invalidFormat
  })
    .min(1, { message: errorMessages.minItems(1) + ' hình thức làm việc' })
    .max(4, { message: 'Không nên chọn quá nhiều hình thức làm việc' }),
  contractTypes: z.array(z.enum(contractTypeEnum), {
    required_error: errorMessages.required,
    invalid_type_error: errorMessages.invalidFormat
  })
    .min(1, { message: errorMessages.minItems(1) + ' loại hợp đồng' })
    .max(3, { message: 'Không nên chọn quá nhiều loại hợp đồng' })
});

// Experience & Education Step Schema (Bước 4 - Optional)
export const experienceEducationSchema = z.object({
  experienceLevel: z.enum(experienceLevelEnum, {
    required_error: 'Vui lòng chọn mức độ kinh nghiệm',
    invalid_type_error: 'Mức độ kinh nghiệm không hợp lệ'
  }).optional(),
  experiences: z.array(z.object({
    company: z.string().min(1, 'Tên công ty là bắt buộc'),
    position: z.string().min(1, 'Vị trí là bắt buộc'),
    startDate: z.string().min(1, 'Ngày bắt đầu là bắt buộc'),
    endDate: z.string().optional(),
    description: z.string().optional(),
    isCurrentJob: z.boolean().optional()
  })).optional(),
  educations: z.array(z.object({
    school: z.string().min(1, 'Tên trường là bắt buộc'),
    major: z.string().min(1, 'Chuyên ngành là bắt buộc'),
    degree: z.string().min(1, 'Bằng cấp là bắt buộc'),
    startDate: z.string().min(1, 'Ngày bắt đầu là bắt buộc'),
    endDate: z.string().optional(),
    gpa: z.string().optional()
  })).optional()
});

// Certificates & Projects Step Schema (Bước 5 - Optional)
export const certificatesProjectsSchema = z.object({
  certificates: z.array(z.object({
    name: z.string().min(1, 'Tên chứng chỉ là bắt buộc'),
    issuer: z.string().min(1, 'Tổ chức cấp là bắt buộc'),
    issueDate: z.string().min(1, 'Ngày cấp là bắt buộc'),
    expiryDate: z.string().optional(),
    credentialId: z.string().optional(),
    url: z.string().url('URL không hợp lệ').optional().or(z.literal(''))
  })).optional(),
  projects: z.array(z.object({
    name: z.string().min(1, 'Tên dự án là bắt buộc'),
    description: z.string().optional(),
    url: z.string().url('URL không hợp lệ').optional().or(z.literal('')),
    startDate: z.string().optional(),
    endDate: z.string().optional(),
    technologies: z.array(z.string()).optional()
  })).optional(),
  linkedin: z.string().url('URL LinkedIn không hợp lệ').optional().or(z.literal('')),
  github: z.string().url('URL Github không hợp lệ').optional().or(z.literal('')),
  website: z.string().url('URL Website không hợp lệ').optional().or(z.literal(''))
});

// Validation helper functions
export const validateBasicInfo = (data) => {
  try {
    return {
      success: true,
      data: basicInfoSchema.parse(data),
      errors: null
    };
  } catch (error) {
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};

export const validateSkills = (data) => {
  try {
    return {
      success: true,
      data: skillsSchema.parse(data),
      errors: null
    };
  } catch (error) {
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};

export const validateExperienceEducation = (data) => {
  try {
    return {
      success: true,
      data: experienceEducationSchema.parse(data),
      errors: null
    };
  } catch (error) {
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};

export const validateCertificatesProjects = (data) => {
  try {
    return {
      success: true,
      data: certificatesProjectsSchema.parse(data),
      errors: null
    };
  } catch (error) {
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};

export const validateSalaryPreferences = (data) => {
  try {
    return {
      success: true,
      data: salaryPreferencesSchema.parse(data),
      errors: null
    };
  } catch (error) {
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};
</file>

<file path="src/schemas/searchSchemas.js">
import { z } from 'zod';

// Job category enum values
export const jobCategoryEnum = [
  'IT',
  'SOFTWARE_DEVELOPMENT',
  'DATA_SCIENCE',
  'MACHINE_LEARNING',
  'WEB_DEVELOPMENT',
  'SALES',
  'MARKETING',
  'ACCOUNTING',
  'GRAPHIC_DESIGN',
  'CONTENT_WRITING',
  'MEDICAL',
  'TEACHING',
  'ENGINEERING',
  'PRODUCTION',
  'LOGISTICS',
  'HOSPITALITY',
  'REAL_ESTATE',
  'LAW',
  'FINANCE',
  'HUMAN_RESOURCES',
  'CUSTOMER_SERVICE',
  'ADMINISTRATION',
  'MANAGEMENT',
  'OTHER'
];

// Job type enum values
export const jobTypeEnum = [
  'FULL_TIME',
  'PART_TIME', 
  'CONTRACT',
  'TEMPORARY',
  'INTERNSHIP',
  'FREELANCE'
];

// Work type enum values
export const workTypeEnum = [
  'ON_SITE',
  'REMOTE',
  'HYBRID'
];

// Experience level enum values
export const experienceEnum = [
  'ENTRY_LEVEL',
  'MID_LEVEL',
  'SENIOR_LEVEL',
  'EXECUTIVE',
  'NO_EXPERIENCE',
  'INTERN',
  'FRESHER'
];


// User location schema (flexible)
export const userLocationFlexible = z.array(z.number()).length(2).optional();

// Schema for hybrid search request
export const hybridSearchJobSchema = z.object({
  query: z.string().max(200, 'Query không được vượt quá 200 ký tự').default(''),
  page: z.coerce.number().int().min(1, 'Trang phải lớn hơn 0').default(1),
  size: z.coerce.number().int().min(1, 'Kích thước trang phải lớn hơn 0').max(50, 'Kích thước trang không được vượt quá 50').default(10),
  // Filters cho tìm kiếm
  category: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(jobCategoryEnum).optional()),
  type: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(jobTypeEnum).optional()),
  workType: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(workTypeEnum).optional()),
  experience: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(experienceEnum).optional()),
  province: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.string().optional()),
  district: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.string().optional()),
  // Salary range filters
  minSalary: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(0, 'Mức lương tối thiểu không thể âm').optional()),
  maxSalary: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(0, 'Mức lương tối đa không thể âm').optional()),

  // Weight parameters for RRF
  textWeight: z.coerce.number().min(0).max(1).default(0.4),
  vectorWeight: z.coerce.number().min(0).max(1).default(0.6),
  
  // Location filter by distance (exact radius filtering)
  latitude: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(-90, 'Latitude phải trong khoảng -90 đến 90').max(90, 'Latitude phải trong khoảng -90 đến 90').optional()),
  longitude: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(-180, 'Longitude phải trong khoảng -180 đến 180').max(180, 'Longitude phải trong khoảng -180 đến 180').optional()),
  distance: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(1, 'Khoảng cách phải lớn hơn 0 km').optional()), // Bán kính lọc (km)
})
  .refine(data => !data.minSalary || !data.maxSalary || data.maxSalary >= data.minSalary, {
    message: 'Mức lương tối đa phải lớn hơn hoặc bằng mức lương tối thiểu',
    path: ['maxSalary'],
  })
  .refine(data => Math.abs((data.textWeight + data.vectorWeight) - 1) < 0.001, {
    message: 'Tổng trọng số text và vector phải bằng 1',
    path: ['vectorWeight'],
  })
  .refine(data => {
    // Nếu có distance, phải có cả latitude và longitude
    if (data.distance && (!data.latitude || !data.longitude)) {
      return false;
    }
    return true;
  }, {
    message: 'Để lọc theo khoảng cách, bạn phải cung cấp cả latitude và longitude',
    path: ['distance'],
  })
  .refine(data => {
    // Nếu có district nhưng không có province, thì không hợp lệ
    if (data.district && !data.province) {
      return false;
    }
    return true;
  }, {
    message: 'Quận/Huyện phải có Tỉnh/Thành phố đi kèm',
    path: ['district'],
  });

// Schema for autocomplete request
export const autocompleteJobSchema = z.object({
  query: z.string({
    required_error: 'Query là bắt buộc cho autocomplete'
  }).trim().min(1, 'Query không được để trống').max(100, 'Query không được vượt quá 100 ký tự'),
  limit: z.coerce.number().int().min(1, 'Limit phải lớn hơn 0').max(20, 'Limit không được vượt quá 20').default(10),
});

// Schema for search URL parameters (more flexible for frontend)
export const searchParamsSchema = z.object({
  query: z.string().optional(),
  page: z.coerce.number().int().min(1).default(1).optional(),
  size: z.coerce.number().int().min(1).max(50).default(10).optional(),
  category: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(jobCategoryEnum).optional()),
  type: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(jobTypeEnum).optional()),
  workType: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(workTypeEnum).optional()),
  experience: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.enum(experienceEnum).optional()),
  province: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.string().optional()),
  district: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.string().optional()),
  minSalary: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(0).optional()),
  maxSalary: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(0).optional()),
  latitude: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(-90).max(90).optional()),
  longitude: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(-180).max(180).optional()),
  distance: z.preprocess((val) => val === '' || val === null || val === undefined ? undefined : val, z.coerce.number().min(1).optional()),
});

// Validation helper functions
export const validateSearchParams = (params) => {
  try {
    return {
      success: true,
      data: searchParamsSchema.parse(params),
      errors: null
    };
  } catch (error) {
    console.log(error);
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};

export const validateHybridSearchRequest = (params) => {
  try {
    console.log('Input params to validate:', params);
    const result = hybridSearchJobSchema.parse(params);
    console.log('Validated result:', result);
    return {
      success: true,
      data: result
    };
  } catch (error) {
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};

export const validateAutocompleteRequest = (params) => {
  try {
    return {
      success: true,
      data: autocompleteJobSchema.parse(params),
      errors: null
    };
  } catch (error) {
    return {
      success: false,
      data: null,
      errors: error.errors
    };
  }
};
</file>

<file path="src/services/authService.js">
import axios from 'axios';
import apiClient from './apiClient';

// Separate client for auth endpoints that don't require authentication
const authClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL + '/api',
});

export const login = async (credentials) => {
  const response = await apiClient.post('/auth/login', credentials, {
     withCredentials: true
  });
  return response.data;
};

export const googleLogin = async (token) => {
  const response = await authClient.post('/auth/google-login', {
    token,
    role: 'candidate'
  },
{
    withCredentials: true
});
  return response.data;
};

export const getMe = async () => {
  const response = await apiClient.get('/users/me');
  return response.data;
};

// Lấy thông tin profile đầy đủ từ candidate API
export const getMyProfile = async () => {
  const response = await apiClient.get('/candidate/my-profile');
  return response.data;
};

export const register = async (userData) => {
  const response = await authClient.post('/auth/register', userData);
  return response.data;
};

export const logout = async () => {
  const response = await apiClient.post('/auth/logout', null, {
    withCredentials: true
  });
  return response.data;
};

export const forgotPassword = async (email) => {
  const response = await authClient.post('/auth/forgot-password', { email });
  return response.data;
};

export const resetPassword = async (token, newPassword) => {
  console.log('Reset password request:', { token, password: newPassword }); // Debug log

  try {
    // Try different field names that backend might expect
    const requestData = {
      password: newPassword,
      newPassword: newPassword, // Some backends use newPassword
      confirmPassword: newPassword, // Some backends require confirmation
    };

    console.log('Sending request data:', requestData); // Debug log

    // Try with token in Authorization header (common pattern)
    const response = await authClient.post('/auth/reset-password', requestData, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });

    console.log('Reset password response:', response); // Debug log
    return response.data;
  } catch (error) {
    console.error('Reset password error:', error.response?.data || error.message); // Debug log

    // If Authorization header fails, try with token in body
    if (error.response?.status === 400) {
      console.log('Trying with token in request body...');
      try {
        const requestDataWithToken = {
          token,
          password: newPassword,
          newPassword: newPassword,
          confirmPassword: newPassword,
        };

        const response = await authClient.post('/auth/reset-password', requestDataWithToken);
        console.log('Reset password response (body):', response);
        return response.data;
      } catch (secondError) {
        console.error('Reset password error (body):', secondError.response?.data || secondError.message);
        throw secondError;
      }
    }

    throw error;
  }
};
</file>

<file path="src/utils/formatters.js">
/**
 * Utility functions for formatting data
 */

/**
 * Format currency value from MongoDB (handles $numberDecimal objects)
 * @param {*} value - Value from MongoDB (can be number, string, or object with $numberDecimal)
 * @returns {number|null} - Parsed number or null if invalid
 */
export const parseCurrencyValue = (value) => {
  if (!value) return null;

  // Handle MongoDB $numberDecimal objects
  if (typeof value === 'object' && value.$numberDecimal) {
    const num = Number(value.$numberDecimal);
    return isNaN(num) ? null : num;
  }

  // Handle regular numbers and strings
  if (typeof value === 'string') {
    // Remove dots (thousand separators) before parsing
    const cleanedValue = value.replace(/\./g, '');
    const num = Number(cleanedValue);
    return isNaN(num) ? null : num;
  }

  const num = Number(value);
  return isNaN(num) ? null : num;
};

/**
 * Format salary range for display
 * @param {*} minSalary - Minimum salary (can be MongoDB object)
 * @param {*} maxSalary - Maximum salary (can be MongoDB object)
 * @param {string} unit - Unit to display (default: 'triệu')
 * @returns {string} - Formatted salary string
 */
export const formatSalary = (minSalary, maxSalary, unit = 'triệu') => {
  const min = parseCurrencyValue(minSalary);
  const max = parseCurrencyValue(maxSalary);

  if (!min && !max) return 'Thỏa thuận';

  const formatToMillion = (num) => {
    if (num === null || num === undefined) return null;
    const millions = num / 1000000;
    // Use toFixed to handle decimals and remove unnecessary trailing zeros
    return parseFloat(millions.toFixed(1)).toString();
  };

  const formattedMin = formatToMillion(min);
  const formattedMax = formatToMillion(max);

  if (formattedMin && formattedMax) {
    return `${formattedMin} - ${formattedMax} ${unit}`;
  }

  if (formattedMin) {
    return `Từ ${formattedMin} ${unit}`;
  }

  if (formattedMax) {
    return `Đến ${formattedMax} ${unit}`;
  }

  return 'Thỏa thuận';
};

/**
 * Format salary with VND currency
 * @param {*} minSalary - Minimum salary
 * @param {*} maxSalary - Maximum salary
 * @returns {string} - Formatted salary with VND
 */
export const formatSalaryVND = (minSalary, maxSalary) => {
  let min = parseCurrencyValue(minSalary);
  let max = parseCurrencyValue(maxSalary);

  if (!min && !max) return 'Thỏa thuận';

  const formatNumber = (num) => {
    return new Intl.NumberFormat('vi-VN').format(num);
  };

  if (min && max) {
    return `${formatNumber(min)} - ${formatNumber(max)} VNĐ`;
  }

  if (min) {
    return `Từ ${formatNumber(min)} VNĐ`;
  }

  if (max) {
    return `Đến ${formatNumber(max)} VNĐ`;
  }

  return 'Thỏa thuận';
};

/**
 * Format work type for display
 * @param {string} type - Work type code
 * @returns {string} - Formatted work type
 */
export const formatWorkType = (type) => {
  const typeMap = {
    'FULL_TIME': 'Toàn thời gian',
    'PART_TIME': 'Bán thời gian',
    'CONTRACT': 'Hợp đồng',
    'FREELANCE': 'Tự do',
    'INTERNSHIP': 'Thực tập',
    'TEMPORARY': 'Tạm thời'
  };
  return typeMap[type] || type || 'Linh hoạt';
};

/**
 * Format experience level for display
 * @param {string} level - Experience level code
 * @returns {string} - Formatted experience level
 */
export const formatExperience = (level) => {
  const levelMap = {
    'INTERN': 'Thực tập sinh',
    'FRESHER': 'Fresher',
    'JUNIOR_LEVEL': 'Junior',
    'MID_LEVEL': 'Middle',
    'SENIOR_LEVEL': 'Senior',
    'MANAGER_LEVEL': 'Quản lý',
    'DIRECTOR_LEVEL': 'Giám đốc',
    'FRESH': 'Sinh viên mới tốt nghiệp',
    'JUNIOR': 'Dưới 1 năm',
    'SENIOR': '3-5 năm',
    'EXPERT': 'Trên 5 năm',
    'MANAGER': 'Quản lý',
    'DIRECTOR': 'Giám đốc'
  };
  return levelMap[level] || level || 'Không yêu cầu';
};

/**
 * Format location for display
 * @param {*} location - Location object or string
 * @returns {string} - Formatted location
 */
export const formatLocation = (location) => {
  if (!location) return 'Chưa xác định';
  
  if (typeof location === 'string') return location;
  
  if (typeof location === 'object') {
    const provinceName = location.province?.name || location.province;
    const districtName = location.district?.name || location.district;
    
    if (provinceName && districtName) {
      return `${districtName}, ${provinceName}`;
    }
    
    if (provinceName) return provinceName;
    if (districtName) return districtName;
  }
  
  return 'Chưa xác định';
};

/**
 * Format time ago
 * @param {string} dateString - Date string
 * @returns {string} - Time ago string
 */
export const formatTimeAgo = (dateString) => {
  const now = new Date();
  const date = new Date(dateString);
  const diffTime = now - date;
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  
  if (diffDays === 0) return 'Hôm nay';
  if (diffDays === 1) return 'Hôm qua';
  if (diffDays < 7) return `${diffDays} ngày trước`;
  if (diffDays < 30) return `${Math.ceil(diffDays / 7)} tuần trước`;
  return `${Math.ceil(diffDays / 30)} tháng trước`;
};

/**
 * Format distance for display
 * @param {number} distanceInMeters - Distance in meters
 * @returns {string|null} - Formatted distance string or null
 */
export const formatDistance = (distanceInMeters) => {
  if (distanceInMeters === null || distanceInMeters === undefined) {
    return null;
  }

  if (distanceInMeters < 1000) {
    return `cách ${Math.round(distanceInMeters)} m`;
  }

  const distanceInKm = distanceInMeters / 1000;
  return `cách ${distanceInKm.toFixed(1)} km`;
};

/**
 * Calculate the distance between two coordinates using Haversine formula
 * @param {[number, number]} coords1 - [longitude, latitude]
 * @param {[number, number]} coords2 - [longitude, latitude]
 * @returns {number} - Distance in meters
 */
export const calculateDistance = (coords1, coords2) => {
  if (!coords1 || !coords2 || coords1.length !== 2 || coords2.length !== 2) {
    return null;
  }

  const toRad = (value) => (value * Math.PI) / 180;

  const R = 6371e3; // Earth's radius in meters
  const [lon1, lat1] = coords1;
  const [lon2, lat2] = coords2;

  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
    Math.sin(dLon / 2) * Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

  return R * c; // in meters
};
</file>

<file path="tailwind.config.js">
// tailwind.config.js
import animate from "tailwindcss-animate"

/** @type {import('tailwindcss').Config} */
export default {
  darkMode: "class",
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "var(--border)",
        input: "var(--input)",
        ring: "var(--ring)",
        background: "var(--background)",
        foreground: "var(--foreground)",
        primary: {
          DEFAULT: "var(--primary)",
          foreground: "var(--primary-foreground))",
          light: "var(--primary-light)",
        },
        secondary: {
          DEFAULT: "var(--secondary)",
          foreground: "var(--secondary-foreground)",
        },
        destructive: {
          DEFAULT: "var(--destructive)",
          foreground: "var(--destructive-foreground)",
        },
        muted: {
          DEFAULT: "var(--muted)",
          foreground: "var(--muted-foreground)",
        },
        accent: {
          DEFAULT: "var(--accent)",
          foreground: "var(--accent-foreground)",
        },
        popover: {
          DEFAULT: "var(--popover)",
          foreground: "var(--popover-foreground)",
        },
        card: {
          DEFAULT: "var(--card)",
          foreground: "var(--card-foreground)",
        },
        info: "var(--info)",
        warning: "var(--warning)",
        success: "var(--success)",
        footer: {
            DEFAULT: "var(--footer)",
            foreground: "var(--footer-foreground)",
            muted: "var(--footer-muted)",
        }
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: 0 },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: 0 },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [
    animate
  ],
}
</file>

<file path="src/components/common/HomeSearchAutocomplete.jsx">
import React, { useRef, forwardRef, useImperativeHandle, useEffect, useState, useCallback } from 'react';
import { Search } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import { useDispatch, useSelector } from 'react-redux';
import { Input } from '@/components/ui/input';
import { cn } from '@/lib/utils';
import SearchHistoryDropdown from '@/components/jobs/SearchHistoryDropdown';
import {
  fetchSearchHistory,
  saveSearchHistory,
  deleteSearchHistory,
  selectSearchHistory
} from '@/redux/searchHistorySlice';
import { getJobTitleSuggestions } from '@/services/jobService';
import { toast } from 'sonner';

/**
 * Component tìm kiếm với autocomplete cho job titles (phiên bản cho trang Home)
 * Tích hợp với navigation để chuyển đến trang kết quả tìm kiếm
 * 
 * @param {Object} props
 * @param {string} props.placeholder - Placeholder text cho input
 * @param {string} props.initialValue - Giá trị ban đầu
 * @param {function} props.onSearch - Callback khi search (optional, mặc định là navigate)
 * @param {string} props.className - Additional CSS classes
 * @param {Object} props.inputProps - Additional props cho Input component
 * @param {Object} props.autocompleteOptions - Options cho useAutocomplete hook
 */
const HomeSearchAutocomplete = forwardRef(({
  placeholder = "Vị trí công việc, kỹ năng, công ty...",
  initialValue = "",
  onSearch,
  className,
  inputProps = {}
}, ref) => {
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const inputRef = useRef(null);
  const containerRef = useRef(null);
  const searchHistory = useSelector(selectSearchHistory);

  // State management
  const [query, setQuery] = useState(initialValue || '');
  const [showDropdown, setShowDropdown] = useState(false);
  const [selectedIndex, setSelectedIndex] = useState(-1);
  const [suggestions, setSuggestions] = useState({
    history: [],
    autocomplete: []
  });
  const [isLoadingAutocomplete, setIsLoadingAutocomplete] = useState(false);

  // Load search history on mount
  useEffect(() => {
    dispatch(fetchSearchHistory({ limit: 10, page: 1 }));
  }, [dispatch]);

  // Set initial value if provided
  useEffect(() => {
    if (initialValue && initialValue !== query) {
      setQuery(initialValue);
    }
  }, [initialValue]);

  // Effect for history suggestions (no debounce)
  useEffect(() => {
    if (query.trim().length > 0) {
      const filteredHistory = Array.isArray(searchHistory)
        ? searchHistory.filter(item => item.query.toLowerCase().includes(query.toLowerCase()))
        : [];
      setSuggestions(prev => ({
        ...prev,
        history: filteredHistory.slice(0, 5)
      }));
    } else {
      // When query is empty, show recent history
      setSuggestions(prev => ({
        ...prev,
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : []
      }));
    }
  }, [query, searchHistory]);

  // Effect for autocomplete suggestions (with debounce to avoid excessive API calls)
  useEffect(() => {
    // Clear autocomplete if query is too short
    if (!query || query.trim().length < 1) {
      setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      setIsLoadingAutocomplete(false);
      return;
    }

    // Set loading state immediately
    setIsLoadingAutocomplete(true);

    // Debounce API call
    const timeoutId = setTimeout(async () => {
      try {
        const autocompleteResults = await getJobTitleSuggestions(query, 5).catch(() => ({ data: [] }));
        setSuggestions(prev => ({
          ...prev,
          autocomplete: Array.isArray(autocompleteResults.data) ? autocompleteResults.data : []
        }));
      } catch (error) {
        console.error('Error fetching autocomplete suggestions:', error);
        setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      } finally {
        setIsLoadingAutocomplete(false);
      }
    }, 300); // 300ms debounce delay

    // Cleanup function to cancel pending API call
    return () => {
      clearTimeout(timeoutId);
    };
  }, [query]);

  /**
   * Handle focus - show history when input is empty
   */
  const handleFocus = useCallback(() => {
    // Always show dropdown on focus
    setShowDropdown(true);
    // Load history immediately if query is empty (even if empty array to show empty state)
    if (!query.trim()) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [query, searchHistory]);

  /**
   * Handle input change
   */
  const handleInputChange = useCallback((value) => {
    setQuery(value);
    setShowDropdown(true);
    if (!value || value.trim().length === 0) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [searchHistory]);

  /**
   * Xử lý search action - navigate đến trang JobList với query params
   */
  const handleSearch = useCallback(async (searchQuery = query) => {
    const trimmedQuery = searchQuery.trim();
    if (!trimmedQuery) return;

    setShowDropdown(false);

    // Save to history
    try {
      await dispatch(saveSearchHistory({
        query: trimmedQuery
      })).unwrap();
    } catch (error) {
      console.error('Failed to save search history:', error);
    }

    if (onSearch) {
      // Nếu có custom onSearch handler
      onSearch(trimmedQuery, {
        page: 1,
        size: 10,
        query: trimmedQuery
      });
    } else {
      // Mặc định navigate đến /jobs với query parameters
      const searchParams = new URLSearchParams();
      searchParams.set('query', trimmedQuery);
      searchParams.set('page', '1');
      searchParams.set('size', '10');

      navigate(`/jobs?${searchParams.toString()}`);
    }
  }, [query, dispatch, onSearch, navigate]);

  /**
   * Handle suggestion click
   */
  const handleSuggestionClick = useCallback((suggestion, isHistory) => {
    if (isHistory) {
      // Apply search from history
      setQuery(suggestion.query || '');
      setShowDropdown(false);
      setSelectedIndex(-1);
      handleSearch(suggestion.query || '');
    } else {
      // Just set query for autocomplete
      setQuery(suggestion.title);
      setShowDropdown(false);
      setSelectedIndex(-1);
      handleSearch(suggestion.title);
    }
  }, [handleSearch]);

  /**
   * Handle delete history entry with optimistic update
   */
  const handleDeleteHistory = useCallback(async (e, entryId) => {
    e.stopPropagation();
    
    // Optimistic update: Xóa ngay trên UI
    setSuggestions(prev => ({
      ...prev,
      history: prev.history.filter(h => h._id !== entryId)
    }));
    
    // Hiển thị toast ngay lập tức
    toast.success('Đã xóa lịch sử tìm kiếm');
    
    try {
      // Gọi API ở background (không cần await)
      dispatch(deleteSearchHistory(entryId));
    } catch (error) {
      // Nếu có lỗi, không cần làm gì vì đã xóa trên UI
      console.error('Error deleting history:', error);
    }
  }, [dispatch]);

  /**
   * Handle keyboard navigation
   */
  const handleKeyDown = useCallback((event) => {
    const totalSuggestions = suggestions.history.length + suggestions.autocomplete.length;

    if (!showDropdown || totalSuggestions === 0) {
      if (event.key === 'Enter') {
        event.preventDefault();
        handleSearch();
      }
      return;
    }

    switch (event.key) {
      case 'ArrowDown':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev < totalSuggestions - 1 ? prev + 1 : 0
        );
        break;

      case 'ArrowUp':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev > 0 ? prev - 1 : totalSuggestions - 1
        );
        break;

      case 'Enter':
        event.preventDefault();
        if (selectedIndex >= 0 && selectedIndex < totalSuggestions) {
          // Determine if it's history or autocomplete
          if (selectedIndex < suggestions.history.length) {
            const selectedSuggestion = suggestions.history[selectedIndex];
            handleSuggestionClick(selectedSuggestion, true);
          } else {
            const autocompleteIndex = selectedIndex - suggestions.history.length;
            const selectedSuggestion = suggestions.autocomplete[autocompleteIndex];
            handleSuggestionClick(selectedSuggestion, false);
          }
        } else {
          handleSearch();
        }
        break;

      case 'Escape':
        event.preventDefault();
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      case 'Tab':
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      default:
        break;
    }
  }, [showDropdown, suggestions, selectedIndex, handleSuggestionClick, handleSearch]);

  const closeDropdown = useCallback(() => {
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, []);

  const clear = useCallback(() => {
    setQuery('');
    setSuggestions({
      history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
      autocomplete: []
    });
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, [searchHistory]);

  /**
   * Focus vào input
   */
  const focus = () => {
    inputRef.current?.focus();
  };

  /**
   * Expose methods qua ref
   */
  useImperativeHandle(ref, () => ({
    focus,
    clear,
    getValue: () => query,
    setValue: handleInputChange
  }));

  return (
    <div ref={containerRef} className={cn("relative w-full", className)}>
      <div className="relative">
        {/* Search Icon */}
        <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-muted-foreground h-5 w-5 z-10" />

        {/* Input Field */}
        <Input
          ref={inputRef}
          type="text"
          placeholder={placeholder}
          value={query}
          onChange={(e) => handleInputChange(e.target.value)}
          onKeyDown={handleKeyDown}
          onFocus={handleFocus}
          className={cn(
            "pl-12 pr-4 h-12 text-base",
            "border-2 border-border focus:border-primary",
            "focus:ring-4 focus:ring-primary/20",
            "bg-background rounded-xl font-medium",
            "placeholder:text-muted-foreground text-foreground",
            "transition-all duration-200",
            showDropdown && "rounded-b-none border-b-0"
          )}
          autoComplete="off"
          role="combobox"
          aria-expanded={showDropdown}
          aria-haspopup="listbox"
          aria-activedescendant={
            selectedIndex >= 0 ? `suggestion-${selectedIndex}` : undefined
          }
          {...inputProps}
        />

        {/* Search History Dropdown */}
        <SearchHistoryDropdown
          historySuggestions={suggestions.history}
          autocompleteSuggestions={suggestions.autocomplete}
          query={query}
          isLoading={isLoadingAutocomplete}
          error={null}
          selectedIndex={selectedIndex}
          isVisible={showDropdown}
          onSuggestionClick={handleSuggestionClick}
          onSuggestionHover={(index) => setSelectedIndex(index)}
          onDeleteHistory={handleDeleteHistory}
          onClose={closeDropdown}
          onRetry={() => { }}
          className={cn(
            "absolute top-full left-0 z-50 w-full",
            "border-t-0 rounded-t-none rounded-b-xl",
            "border-2 border-primary focus-within:border-primary",
            "shadow-lg shadow-primary/20",
             // Make dropdown span to align with search button
            // Input is 6/12 cols (50%), location is 3/12 (25%), button is 3/12 (25%)
            // Total: 200% width + 2 gaps (1rem each) = calc(200% + 2rem)
            "w-[calc(200%)]",
            // Ensure proper alignment
            "lg:w-[calc(200%+1rem)]"
          )}
        />
      </div>
    </div>
  );
});

HomeSearchAutocomplete.displayName = 'HomeSearchAutocomplete';

export default HomeSearchAutocomplete;
</file>

<file path="src/components/common/JobDetail/Header.jsx">
import {
    Bookmark,
    CheckCircle,
    DollarSign,
    UserCheck,
    Eye
} from 'lucide-react';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import {
    formatSalary
} from '@/utils/formatters';

import {
    Card,
    CardContent,
    CardHeader,
    CardTitle
} from '@/components/ui/card';
import {
    Separator
} from '@/components/ui/separator';
import {
    MapPin
} from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import ShareButtons from '@/components/common/ShareButtons';
const JobDetailHeader = ({
    job,
    isAuthenticated,
    handleApply,
    handleSave,
    applicantCount,
    hasViewedApplicants,
    isLoadingApplicants,
    handleViewApplicants
}) => {
    const navigate = useNavigate();
    return (
        <div className="mb-8">
            <div className="bg-card rounded-xl shadow-sm border p-6">
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    {/* Left Column (2/3 width) */}
                    <div className="lg:col-span-2">
                        <div className="flex items-center gap-4 mb-4">
                            <div>
                                <h1 className="text-2xl lg:text-3xl font-bold text-foreground mb-1">{job.title}</h1>
                                <p className="text-lg text-muted-foreground">{job.company?.name}</p>
                                <div className="flex items-center gap-2 mt-2 text-muted-foreground">
                                    <MapPin className="w-4 h-4 text-primary/80" />
                                    <span className="text-sm">{[job.address, job.location?.commune, job.location?.district, job.location?.province].filter(p => p && p !== 'OTHER').join(', ') || 'Địa điểm chưa được cập nhật'}</span>
                                </div>
                            </div>
                        </div>

                        {(isAuthenticated || job.minSalary || job.maxSalary) && (
                            <div className="mb-6">
                                <div className="flex items-center gap-2 text-xl font-semibold text-primary">
                                    <DollarSign className="w-5 h-5" />
                                    <span>{formatSalary(job.minSalary, job.maxSalary)}</span>
                                </div>
                            </div>
                        )}

                        {isAuthenticated && (
                            <div className="mb-6 p-4 bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg border border-orange-200">
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                                            <UserCheck className="w-5 h-5 text-orange-600" />
                                        </div>
                                        <div>
                                            <div className="flex items-center gap-2">
                                                <h3 className="text-sm font-medium text-gray-900">Thông tin ứng viên</h3>
                                                <Badge variant="destructive" className="text-xs px-1.5 py-0.5 animate-pulse">MỚI</Badge>
                                            </div>
                                            <p className="text-xs text-muted-foreground">
                                                {hasViewedApplicants && applicantCount !== null
                                                    ? `${applicantCount} người đã ứng tuyển`
                                                    : 'Xem số lượng ứng viên đã ứng tuyển'}
                                            </p>
                                        </div>
                                    </div>

                                    {hasViewedApplicants && applicantCount !== null ? (
                                        <Badge variant="secondary" className="bg-orange-100 text-orange-700 border-orange-200 font-semibold">
                                            {applicantCount} người
                                        </Badge>
                                    ) : (
                                        <Button
                                            variant="outline"
                                            size="sm"
                                            onClick={handleViewApplicants}
                                            disabled={isLoadingApplicants}
                                            className="border-orange-300 text-orange-600 hover:bg-orange-100 hover:text-orange-700 font-medium"
                                        >
                                            {isLoadingApplicants ? (
                                                <>
                                                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"></div>
                                                    Đang xử lý...
                                                </>
                                            ) : (
                                                <>
                                                    <Eye className="w-4 h-4 mr-2" />
                                                    Xem (50 xu)
                                                </>
                                            )}
                                        </Button>
                                    )}
                                </div>
                            </div>
                        )}

                        <div className="flex flex-col sm:flex-row gap-3">
                            {job.isApplied ? (
                                <Badge variant="secondary" className="bg-green-100 text-green-700 border-green-200 px-6 py-2 text-sm font-medium justify-center">
                                    <CheckCircle className="w-4 h-4 mr-2" />
                                    Đã ứng tuyển
                                </Badge>
                            ) : (
                                <Button
                                    onClick={handleApply}
                                    className="bg-primary hover:bg-primary/90 text-primary-foreground px-8 py-2.5 font-medium"
                                    disabled={job?.status !== 'ACTIVE'}
                                >
                                    <CheckCircle className="w-4 h-4 mr-2" />
                                    {job.status === 'ACTIVE' ? 'Ứng tuyển ngay' : 'Việc làm đã đóng'}
                                </Button>
                            )}

                            <Button
                                variant="outline"
                                onClick={handleSave}
                                className={`px-6 py-2.5 font-medium transition-all duration-200 ${job.isSaved
                                    ? "bg-yellow-50 border-yellow-300 text-yellow-700 hover:bg-yellow-100"
                                    : "hover:bg-muted"
                                    }`}
                            >
                                <Bookmark className={`w-4 h-4 mr-2 ${job.isSaved ? "fill-current" : ""}`} />
                                {job.isSaved ? "Đã lưu" : "Lưu việc làm"}
                            </Button>

                            {/* Share Button with Dropdown - truyền jobId để tạo preview URL */}
                            <ShareButtons jobId={job?._id} jobTitle={job?.title} />
                        </div>
                    </div>

                    {/* Right Column (1/3 width) */}
                    <div className="lg:col-span-1">
                        <Card className="h-full border-0 shadow-none bg-muted/50">
                            <CardHeader>
                                <CardTitle className="text-lg font-bold">Thông tin công ty</CardTitle>
                            </CardHeader>
                            <CardContent className="space-y-4">
                                <div className="flex items-center gap-4">
                                    <Avatar className="w-14 h-14 border-2 border-border">
                                        <AvatarImage src={job.company?.logo} alt={job.company?.name} />
                                        <AvatarFallback className="bg-muted text-foreground text-base font-bold">
                                            {job.company?.name?.charAt(0)}
                                        </AvatarFallback>
                                    </Avatar>
                                    <div className="flex-1">
                                        <h3 className="font-bold text-md text-foreground">{job.company?.name}</h3>
                                        <p className="text-sm text-muted-foreground">{job.company?.industry || 'Chưa cập nhật'}</p>
                                    </div>
                                </div>

                                <Separator />

                                <div className="space-y-3">
                                    <Button
                                        className="w-full"
                                        variant="outline"
                                        onClick={() => navigate(`/company/${job.company?._id}`)}
                                    >
                                        Xem chi tiết công ty
                                    </Button>
                                </div>
                            </CardContent>
                        </Card>
                    </div>
                </div>
            </div>
        </div>
    )
}

export default JobDetailHeader;
</file>

<file path="src/components/layout/NotificationDropdown.jsx">
import { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { fetchRecentNotifications, fetchUnreadCount } from '@/redux/notificationSlice';
import { Link } from 'react-router-dom';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { Skeleton } from '@/components/ui/skeleton';
import { Bell, BellRing } from 'lucide-react';
import { formatDistanceToNow } from 'date-fns';
import { vi } from 'date-fns/locale';


const NotificationDropdownItem = ({ notification }) => (
  <DropdownMenuItem asChild>
    <Link to={`/notifications`} className="flex items-start gap-3 p-2.5">
       <div className="shrink-0 mt-1">
         <BellRing size={16} className="text-primary"/>
       </div>
       <div className="grow">
        <p className="font-semibold text-sm leading-tight">{notification.title}</p>
        <p className="text-xs text-muted-foreground mt-0.5">
           {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true, locale: vi })}
        </p>
       </div>
    </Link>
  </DropdownMenuItem>
);


const NotificationDropdown = () => {
  const dispatch = useDispatch();
  const { recentNotifications, unreadCount, loading } = useSelector((state) => state.notifications);
  const { isAuthenticated } = useSelector((state) => state.auth);

  // Load notifications lần đầu khi component mount
  useEffect(() => {
    if (isAuthenticated) {
      dispatch(fetchRecentNotifications());
      dispatch(fetchUnreadCount());
    }
  }, [dispatch, isAuthenticated]);

  const hasUnread = !loading && recentNotifications && recentNotifications.length > 0;

  const renderContent = () => {
    if (loading) {
      return (
        <div className="p-2.5 space-y-3">
          {[...Array(2)].map((_, i) => (
            <div key={i} className="flex items-start gap-3">
              <Skeleton className="w-4 h-4 rounded-full" />
              <div className="grow space-y-1.5">
                <Skeleton className="h-3 w-3/4" />
                <Skeleton className="h-2 w-1/4" />
              </div>
            </div>
          ))}
        </div>
      );
    }

    if (!hasUnread) {
      return <p className="p-4 text-center text-sm text-muted-foreground">Bạn không có thông báo mới.</p>;
    }

    return recentNotifications.map(n => <NotificationDropdownItem key={n._id} notification={n} />);
  };

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="ghost" size="icon" className="relative">
          <Bell className="h-[1.2rem] w-[1.2rem]" />
          {unreadCount > 0 && (
            <Badge 
              variant="destructive" 
              className="absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs font-bold rounded-full"
            >
              {unreadCount > 99 ? '99+' : unreadCount}
            </Badge>
          )}
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="w-80" align="end">
        <DropdownMenuLabel className="flex justify-between items-center">
            <span>Thông báo mới</span>
            {hasUnread && unreadCount > 0 && <span className="text-xs font-normal text-muted-foreground">({unreadCount} chưa đọc)</span>}
        </DropdownMenuLabel>
        <DropdownMenuSeparator />
        
        <div className="max-h-80 overflow-y-auto">
            {renderContent()}
        </div>

        <DropdownMenuSeparator />
        <DropdownMenuItem asChild>
            <Link to="/notifications" className="flex items-center justify-center py-2">
                Xem tất cả thông báo
            </Link>
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
};

export default NotificationDropdown;
</file>

<file path="src/components/onboarding/steps/BasicInfoStep.jsx">
import { useForm, Controller } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useState, useEffect, useMemo, memo, useCallback } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { User, Phone, MapPin, Upload, X, AlertCircle, Wifi, WifiOff } from 'lucide-react';
import { basicInfoSchema } from '@/schemas/onboardingSchemas';
import { InlineError } from '../ErrorState';
import locationData from '@/data/oldtree.json';
import { isOnline } from '@/utils/errorHandling';

// Process location data từ oldtree.json - CHỈ 1 LẦN khi module load
const processLocationData = () => {
  const provinceNames = [];
  const districtMap = new Map();

  locationData.forEach(province => {
    if (!province?.name) return;
    provinceNames.push(province.name);
    const districts = (province.districts || []).map(d => ({ name: d.name }));
    districtMap.set(province.name, { districts });
  });

  return { provinceNames, districtMap };
};

const { provinceNames, districtMap: locationMap } = processLocationData();

// Memoize component để tránh re-render không cần thiết
export const BasicInfoStep = memo(({ initialData = {}, onNext, isLoading, error: externalError, onLoadingChange }) => {
  const [avatarPreview, setAvatarPreview] = useState(initialData.avatar || null);
  const [selectedLocations, setSelectedLocations] = useState(initialData.preferredLocations || []);
  const [online, setOnline] = useState(isOnline());
  const [avatarError, setAvatarError] = useState(null);
  const [avatarFile, setAvatarFile] = useState(null);
  const [uploadingAvatar, setUploadingAvatar] = useState(false);

  const {
    register,
    handleSubmit,
    control,
    formState: { errors, isValidating, touchedFields },
    setValue,
    watch,
    trigger
  } = useForm({
    resolver: zodResolver(basicInfoSchema),
    mode: 'onBlur', // Validate on blur for better UX
    defaultValues: {
      fullName: initialData.fullName || '',
      phone: initialData.phone || '',
      avatar: initialData.avatar || null,
      preferredLocations: initialData.preferredLocations || []
    }
  });

  // Monitor online status
  useEffect(() => {
    const handleOnline = () => setOnline(true);
    const handleOffline = () => setOnline(false);

    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);

    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  const handleAvatarChange = (e) => {
    const file = e.target.files?.[0];
    setAvatarError(null);

    if (file) {
      // Validate file size (max 5MB)
      const maxSize = 5 * 1024 * 1024;
      if (file.size > maxSize) {
        setAvatarError('Kích thước ảnh không được vượt quá 5MB');
        return;
      }

      // Validate file type
      const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
      if (!validTypes.includes(file.type)) {
        setAvatarError('Chỉ chấp nhận file ảnh JPG, PNG hoặc GIF');
        return;
      }

      // Lưu file để upload sau
      setAvatarFile(file);
      
      // Preview ảnh
      const reader = new FileReader();
      reader.onloadend = () => {
        setAvatarPreview(reader.result);
      };
      reader.onerror = () => {
        setAvatarError('Không thể đọc file ảnh');
      };
      reader.readAsDataURL(file);
    }
  };

  // Memoize handlers để tránh tái tạo
  const addLocation = useCallback((province) => {
    if (selectedLocations.length >= 5) return;
    
    // Chỉ lưu province và district (null = tất cả quận/huyện)
    const newLocation = { province, district: null };
    const updated = [...selectedLocations, newLocation];
    setSelectedLocations(updated);
    setValue('preferredLocations', updated, { shouldValidate: true });
    // Trigger validation after adding location
    trigger('preferredLocations');
  }, [selectedLocations, setValue, trigger]);

  const removeLocation = useCallback((index) => {
    const updated = selectedLocations.filter((_, i) => i !== index);
    setSelectedLocations(updated);
    setValue('preferredLocations', updated, { shouldValidate: true });
    // Trigger validation after removing location
    trigger('preferredLocations');
  }, [selectedLocations, setValue, trigger]);

  const updateLocationDistrict = useCallback((index, district) => {
    const updated = [...selectedLocations];
    updated[index].district = district;
    setSelectedLocations(updated);
    setValue('preferredLocations', updated);
  }, [selectedLocations, setValue]);

  const onSubmit = useCallback(async (data) => {
    // Final validation before submit
    if (!online) {
      return;
    }

    // Prevent double submission
    if (uploadingAvatar || isLoading) {
      return;
    }

    try {
      // Normalize phone number to match backend format (remove spaces, keep only digits and optional +)
      if (data.phone) {
        // Remove all spaces, dashes, parentheses
        let normalizedPhone = data.phone.replace(/[\s\-\(\)]/g, '');
        // If starts with +84, keep it; if starts with 0, keep it as is
        data.phone = normalizedPhone;
      }

      // Upload avatar nếu có
      if (avatarFile) {
        console.log('🔄 Starting avatar upload...');
        setUploadingAvatar(true);
        onLoadingChange?.(true); // Notify parent about loading state
        try {
          const { uploadAvatar } = await import('@/services/onboardingService');
          console.log('📤 Uploading avatar to server...');
          const uploadResult = await uploadAvatar(avatarFile);
          console.log('✅ Avatar uploaded successfully:', uploadResult.data.avatarUrl);
          // Avatar URL đã được lưu vào backend, không cần gửi trong data
          data.avatar = uploadResult.data.avatarUrl;
        } catch (uploadError) {
          console.error('❌ Avatar upload error:', uploadError);
          setAvatarError('Không thể tải ảnh lên. Vui lòng thử lại.');
          setUploadingAvatar(false);
          onLoadingChange?.(false);
          return; // Stop submission if avatar upload fails
        } finally {
          console.log('🏁 Avatar upload finished');
          setUploadingAvatar(false);
          onLoadingChange?.(false);
        }
      }

      // Xóa avatar khỏi data nếu không có file mới
      if (!avatarFile && !data.avatar) {
        delete data.avatar;
      }

      // Call onNext which will trigger the parent's loading state
      await onNext(data);
    } catch (error) {
      console.error('Form submission error:', error);
    }
  }, [online, uploadingAvatar, isLoading, avatarFile, onLoadingChange, onNext]);

  // Memoize filtered provinces để tránh filter mỗi lần render
  const availableProvinces = useMemo(() => {
    return provinceNames.filter(p => !selectedLocations.some(loc => loc.province === p));
  }, [selectedLocations]);

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6" noValidate>
      {/* Offline Warning */}
      {!online && (
        <Alert variant="destructive">
          <WifiOff className="h-4 w-4" />
          <AlertDescription>
            Không có kết nối mạng. Vui lòng kiểm tra kết nối và thử lại.
          </AlertDescription>
        </Alert>
      )}

      {/* External Error Display */}
      {externalError && (
        <Alert variant="destructive">
          <AlertCircle className="h-4 w-4" />
          <AlertDescription>{externalError}</AlertDescription>
        </Alert>
      )}

      <Card>
        <CardHeader>
          <CardTitle>Thông tin cơ bản</CardTitle>
          <CardDescription>
            Cung cấp thông tin cơ bản để nhà tuyển dụng có thể liên hệ với bạn
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Avatar Upload */}
          <div className="flex items-center gap-4">
            <div className="relative">
              <Avatar className="w-20 h-20">
                <AvatarImage src={avatarPreview} />
                <AvatarFallback>
                  <User className="w-10 h-10" />
                </AvatarFallback>
              </Avatar>
              {uploadingAvatar && (
                <div className="absolute inset-0 flex items-center justify-center bg-black/50 rounded-full">
                  <div className="w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                </div>
              )}
            </div>
            <div className="flex-1">
              <Label htmlFor="avatar" className="cursor-pointer">
                <div className="flex items-center gap-2 text-sm text-primary hover:underline">
                  <Upload className="w-4 h-4" />
                  {uploadingAvatar ? 'Đang tải ảnh lên...' : 'Tải ảnh đại diện (không bắt buộc)'}
                </div>
              </Label>
              <Input
                id="avatar"
                type="file"
                accept="image/jpeg,image/jpg,image/png,image/gif"
                className="hidden"
                onChange={handleAvatarChange}
                disabled={uploadingAvatar || isLoading}
              />
              <p className="text-xs text-muted-foreground mt-1">
                JPG, PNG hoặc GIF. Tối đa 5MB
              </p>
              {avatarError && <InlineError message={avatarError} />}
              {uploadingAvatar && (
                <p className="text-xs text-primary mt-1 flex items-center gap-1">
                  <div className="w-3 h-3 border-2 border-primary/30 border-t-primary rounded-full animate-spin" />
                  Đang tải ảnh lên...
                </p>
              )}
            </div>
          </div>

          {/* Full Name */}
          <div className="space-y-2">
            <Label htmlFor="fullName">
              Họ và tên <span className="text-red-500">*</span>
            </Label>
            <div className="relative">
              <User className="absolute left-3 top-3 w-4 h-4 text-muted-foreground" />
              <Input
                id="fullName"
                {...register('fullName')}
                placeholder="Nguyễn Văn A"
                className="pl-10"
              />
            </div>
            <InlineError message={errors.fullName?.message} />
          </div>

          {/* Phone */}
          <div className="space-y-2">
            <Label htmlFor="phone">
              Số điện thoại <span className="text-red-500">*</span>
            </Label>
            <div className="relative">
              <Phone className="absolute left-3 top-3 w-4 h-4 text-muted-foreground" />
              <Input
                id="phone"
                {...register('phone')}
                placeholder="0912345678"
                className="pl-10"
              />
            </div>
            <InlineError message={errors.phone?.message} />
          </div>

          {/* Preferred Locations */}
          <div className="space-y-2">
            <Label>
              Địa điểm làm việc mong muốn <span className="text-red-500">*</span>
            </Label>
            <p className="text-xs text-muted-foreground">
              Chọn tối đa 5 địa điểm
            </p>

            {/* Selected Locations */}
            <div className="space-y-2">
              {selectedLocations.map((location, index) => (
                <div key={index} className="flex items-center gap-2 p-3 bg-muted rounded-lg">
                  <MapPin className="w-4 h-4 text-muted-foreground flex-shrink-0" />
                  <div className="flex-1 grid grid-cols-2 gap-2">
                    <div>
                      <p className="text-sm font-medium">{location.province}</p>
                    </div>
                    <div>
                      <Select
                        value={location.district || 'all'}
                        onValueChange={(value) => updateLocationDistrict(index, value === 'all' ? null : value)}
                      >
                        <SelectTrigger className="h-8">
                          <SelectValue placeholder="Chọn quận/huyện" />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="all">
                            <span className="font-medium">Tất cả quận/huyện</span>
                          </SelectItem>
                          {locationMap.get(location.province)?.districts.map((district) => (
                            <SelectItem key={district.name} value={district.name}>
                              {district.name}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                      {!location.district && (
                        <p className="text-xs text-muted-foreground mt-1">Tất cả quận/huyện</p>
                      )}
                    </div>
                  </div>
                  <Button
                    type="button"
                    variant="ghost"
                    size="sm"
                    onClick={() => removeLocation(index)}
                  >
                    <X className="w-4 h-4" />
                  </Button>
                </div>
              ))}
            </div>

            {/* Add Location */}
            {selectedLocations.length < 5 && (
              <Select onValueChange={addLocation}>
                <SelectTrigger>
                  <SelectValue placeholder="Thêm địa điểm" />
                </SelectTrigger>
                <SelectContent>
                  {availableProvinces.map((province) => (
                    <SelectItem key={province} value={province}>
                      {province}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            )}
            <InlineError message={errors.preferredLocations?.message} />
          </div>
        </CardContent>
      </Card>

      {/* Status messages */}
      <div className="flex items-center gap-2 text-sm text-muted-foreground">
        {!online && (
          <>
            <WifiOff className="w-4 h-4" />
            <span>Không có kết nối mạng</span>
          </>
        )}
        {online && isValidating && (
          <>
            <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-primary"></div>
            <span>Đang kiểm tra...</span>
          </>
        )}
      </div>

      {/* Hidden submit button - Form sẽ được submit từ footer của OnboardingWrapper */}
      <button type="submit" className="hidden" />
    </form>
  );
});
</file>

<file path="src/components/profile/EducationSection.jsx">
import { useState, useCallback } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { GraduationCap, Calendar, Plus, Edit3, Trash2, Save, X } from 'lucide-react';
import { toast } from 'sonner';

const EducationForm = ({ formData, onFormChange, onCancel, onSave, isUpdating }) => {
  return (
    <div className="space-y-4 p-4 border rounded-lg bg-card">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="school">Trường <span className="text-destructive">*</span></Label>
          <Input
            id="school"
            value={formData.school}
            onChange={(e) => onFormChange('school', e.target.value)}
            placeholder="VD: Đại học Bách Khoa"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="major">Chuyên ngành <span className="text-destructive">*</span></Label>
          <Input
            id="major"
            value={formData.major}
            onChange={(e) => onFormChange('major', e.target.value)}
            placeholder="VD: Công nghệ thông tin"
          />
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="degree">Bằng cấp <span className="text-destructive">*</span></Label>
          <Input
            id="degree"
            value={formData.degree}
            onChange={(e) => onFormChange('degree', e.target.value)}
            placeholder="VD: Cử nhân"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="gpa">GPA</Label>
          <Input
            id="gpa"
            value={formData.gpa}
            onChange={(e) => onFormChange('gpa', e.target.value)}
            placeholder="VD: 3.5/4.0"
          />
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="location">Địa điểm</Label>
        <Input
          id="location"
          value={formData.location || ''}
          onChange={(e) => onFormChange('location', e.target.value)}
          placeholder="VD: TP. Hồ Chí Minh"
        />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="startDate">Ngày bắt đầu <span className="text-destructive">*</span></Label>
          <Input
            id="startDate"
            type="date"
            value={formData.startDate}
            onChange={(e) => onFormChange('startDate', e.target.value)}
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="endDate">Ngày kết thúc</Label>
          <Input
            id="endDate"
            type="date"
            value={formData.endDate}
            onChange={(e) => onFormChange('endDate', e.target.value)}
          />
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="description">Mô tả</Label>
        <Textarea
          id="description"
          value={formData.description}
          onChange={(e) => onFormChange('description', e.target.value)}
          placeholder="Mô tả về quá trình học tập..."
          rows={3}
        />
      </div>

      <div className="space-y-2">
        <Label htmlFor="honors">Giải thưởng / Danh hiệu</Label>
        <Textarea
          id="honors"
          value={formData.honors || ''}
          onChange={(e) => onFormChange('honors', e.target.value)}
          placeholder="VD: Học bổng xuất sắc, Sinh viên 5 tốt..."
          rows={2}
        />
      </div>

      <div className="flex gap-2 justify-end">
        <Button variant="outline" onClick={onCancel} disabled={isUpdating}>
          <X className="w-4 h-4 mr-2" />
          Hủy
        </Button>
        <Button onClick={onSave} disabled={isUpdating}>
          <Save className="w-4 h-4 mr-2" />
          {isUpdating ? 'Đang lưu...' : 'Lưu'}
        </Button>
      </div>
    </div>
  );
};

export const EducationSection = ({ educations = [], onUpdate }) => {
  const [isAdding, setIsAdding] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [formData, setFormData] = useState({
    school: '',
    major: '',
    degree: '',
    startDate: '',
    endDate: '',
    description: '',
    gpa: '',
    type: '',
    location: '',
    honors: ''
  });
  const [isUpdating, setIsUpdating] = useState(false);

  // Memoized handler to prevent re-render
  const handleFormChange = useCallback((field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  }, []);

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('vi-VN');
  };

  const handleAdd = () => {
    setFormData({
      school: '',
      major: '',
      degree: '',
      startDate: '',
      endDate: '',
      description: '',
      gpa: '',
      type: '',
      location: '',
      honors: ''
    });
    setIsAdding(true);
  };

  const handleEdit = (edu) => {
    setFormData({
      ...edu,
      startDate: edu.startDate ? new Date(edu.startDate).toISOString().split('T')[0] : '',
      endDate: edu.endDate ? new Date(edu.endDate).toISOString().split('T')[0] : ''
    });
    setEditingId(edu._id);
  };

  const handleCancel = () => {
    setIsAdding(false);
    setEditingId(null);
  };

  const handleSave = async () => {
    if (!formData.school || !formData.major || !formData.degree || !formData.startDate) {
      toast.error('Vui lòng điền đầy đủ thông tin bắt buộc');
      return;
    }

    try {
      setIsUpdating(true);
      let updatedEducations;

      if (isAdding) {
        updatedEducations = [...educations, formData];
      } else {
        updatedEducations = educations.map(edu => 
          edu._id === editingId ? { ...edu, ...formData } : edu
        );
      }

      await onUpdate({ educations: updatedEducations });
      setIsAdding(false);
      setEditingId(null);
      toast.success(isAdding ? 'Thêm học vấn thành công' : 'Cập nhật học vấn thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  const handleDelete = async (eduId) => {
    if (!window.confirm('Bạn có chắc chắn muốn xóa học vấn này?')) return;

    try {
      setIsUpdating(true);
      const updatedEducations = educations.filter(edu => edu._id !== eduId);
      await onUpdate({ educations: updatedEducations });
      toast.success('Xóa học vấn thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <div className="flex items-center">
            <GraduationCap className="w-5 h-5 mr-2 text-primary" />
            Học vấn
          </div>
          {!isAdding && !editingId && (
            <Button size="sm" onClick={handleAdd}>
              <Plus className="w-4 h-4 mr-2" />
              Thêm
            </Button>
          )}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {isAdding && <EducationForm 
          formData={formData}
          onFormChange={handleFormChange}
          onCancel={handleCancel}
          onSave={handleSave}
          isUpdating={isUpdating}
        />}

        {educations.length === 0 && !isAdding ? (
          <p className="text-muted-foreground text-center py-8">
            Chưa có thông tin học vấn. Nhấn "Thêm" để bắt đầu.
          </p>
        ) : (
          educations.map((edu) => (
            <div key={edu._id} className="space-y-2">
              {editingId === edu._id ? (
                <EducationForm 
                  formData={formData}
                  onFormChange={handleFormChange}
                  onCancel={handleCancel}
                  onSave={handleSave}
                  isUpdating={isUpdating}
                />
              ) : (
                <div className="border-l-2 border-primary/20 pl-4 pb-4">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <h3 className="font-semibold text-lg text-foreground">{edu.school}</h3>
                      <div className="text-primary font-medium mb-1">{edu.major}</div>
                      <div className="flex items-center gap-4 text-sm text-muted-foreground mb-2">
                        <span>{edu.degree}</span>
                        {edu.gpa && <span>GPA: {edu.gpa}</span>}
                      </div>
                      <div className="flex items-center text-muted-foreground text-sm mb-2">
                        <Calendar className="w-4 h-4 mr-1" />
                        {formatDate(edu.startDate)} - {edu.endDate ? formatDate(edu.endDate) : 'Hiện tại'}
                      </div>
                      {edu.location && (
                        <p className="text-sm text-muted-foreground mb-2">📍 {edu.location}</p>
                      )}
                      {edu.description && (
                        <p className="text-muted-foreground mt-2">{edu.description}</p>
                      )}
                      {edu.honors && (
                        <div className="mt-2">
                          <p className="text-xs font-medium text-muted-foreground mb-1">🏆 Giải thưởng:</p>
                          <p className="text-sm text-muted-foreground">{edu.honors}</p>
                        </div>
                      )}
                    </div>
                    <div className="flex gap-2">
                      <Button 
                        size="sm" 
                        variant="ghost" 
                        onClick={() => handleEdit(edu)}
                        disabled={isUpdating}
                      >
                        <Edit3 className="w-4 h-4" />
                      </Button>
                      <Button 
                        size="sm" 
                        variant="ghost" 
                        className="text-destructive hover:text-destructive"
                        onClick={() => handleDelete(edu._id)}
                        disabled={isUpdating}
                      >
                        <Trash2 className="w-4 h-4" />
                      </Button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          ))
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/profile/ExperienceSection.jsx">
import { useState, useCallback } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Briefcase, Calendar, Building, Plus, Edit3, Trash2, Save, X, MapPin } from 'lucide-react';
import { Checkbox } from '@/components/ui/checkbox';
import { toast } from 'sonner';

const ExperienceForm = ({ formData, onFormChange, onCancel, onSave, isUpdating }) => {
  const handleAddAchievement = () => {
    const achievements = formData.achievements || [];
    onFormChange('achievements', [...achievements, '']);
  };

  const handleRemoveAchievement = (index) => {
    const achievements = formData.achievements || [];
    onFormChange('achievements', achievements.filter((_, i) => i !== index));
  };

  const handleAchievementChange = (index, value) => {
    const achievements = formData.achievements || [];
    const newAchievements = [...achievements];
    newAchievements[index] = value;
    onFormChange('achievements', newAchievements);
  };

  return (
    <div className="space-y-4 p-4 border rounded-lg bg-card">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="position">Vị trí <span className="text-destructive">*</span></Label>
          <Input
            id="position"
            value={formData.position}
            onChange={(e) => onFormChange('position', e.target.value)}
            placeholder="VD: Senior Developer"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="company">Công ty <span className="text-destructive">*</span></Label>
          <Input
            id="company"
            value={formData.company}
            onChange={(e) => onFormChange('company', e.target.value)}
            placeholder="VD: ABC Company"
          />
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="location">Địa điểm</Label>
        <Input
          id="location"
          value={formData.location || ''}
          onChange={(e) => onFormChange('location', e.target.value)}
          placeholder="VD: TP. Hồ Chí Minh"
        />
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div className="space-y-2">
          <Label htmlFor="startDate">Ngày bắt đầu <span className="text-destructive">*</span></Label>
          <Input
            id="startDate"
            type="date"
            value={formData.startDate}
            onChange={(e) => onFormChange('startDate', e.target.value)}
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="endDate">Ngày kết thúc</Label>
          <Input
            id="endDate"
            type="date"
            value={formData.endDate}
            onChange={(e) => onFormChange('endDate', e.target.value)}
            disabled={formData.isCurrentJob}
          />
          <div className="flex items-center space-x-2 mt-2">
            <input
              type="checkbox"
              id="isCurrentJob"
              checked={formData.isCurrentJob || false}
              onChange={(e) => {
                onFormChange('isCurrentJob', e.target.checked);
                if (e.target.checked) {
                  onFormChange('endDate', '');
                }
              }}
              className="rounded border-gray-300"
            />
            <Label htmlFor="isCurrentJob" className="text-sm font-normal cursor-pointer">
              Đây là công việc hiện tại
            </Label>
          </div>
        </div>
      </div>

      <div className="space-y-2">
        <Label htmlFor="description">Mô tả công việc</Label>
        <Textarea
          id="description"
          value={formData.description}
          onChange={(e) => onFormChange('description', e.target.value)}
          placeholder="Mô tả về công việc và trách nhiệm..."
          rows={3}
        />
      </div>

      <div className="space-y-2">
        <Label>Thành tựu nổi bật</Label>
        <div className="space-y-2">
          {(formData.achievements || []).map((achievement, index) => (
            <div key={index} className="flex gap-2">
              <Input
                value={achievement}
                onChange={(e) => handleAchievementChange(index, e.target.value)}
                placeholder="VD: Tăng doanh thu 30%"
              />
              <Button
                type="button"
                variant="ghost"
                size="sm"
                onClick={() => handleRemoveAchievement(index)}
              >
                <X className="w-4 h-4" />
              </Button>
            </div>
          ))}
          <Button
            type="button"
            variant="outline"
            size="sm"
            onClick={handleAddAchievement}
          >
            <Plus className="w-4 h-4 mr-2" />
            Thêm thành tựu
          </Button>
        </div>
      </div>

      <div className="flex gap-2 justify-end">
        <Button variant="outline" onClick={onCancel} disabled={isUpdating}>
          <X className="w-4 h-4 mr-2" />
          Hủy
        </Button>
        <Button onClick={onSave} disabled={isUpdating}>
          <Save className="w-4 h-4 mr-2" />
          {isUpdating ? 'Đang lưu...' : 'Lưu'}
        </Button>
      </div>
    </div>
  );
};

export const ExperienceSection = ({ experiences = [], onUpdate }) => {
  const [isAdding, setIsAdding] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [formData, setFormData] = useState({
    company: '',
    position: '',
    startDate: '',
    endDate: '',
    description: '',
    responsibilities: [],
    location: '',
    isCurrentJob: false,
    achievements: []
  });
  const [isUpdating, setIsUpdating] = useState(false);

  // Memoized handler to prevent re-render
  const handleFormChange = useCallback((field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  }, []);

  const calculateExperience = (experiences) => {
    if (!experiences || experiences.length === 0) return '0 năm';
    
    let totalMonths = 0;
    experiences.forEach(exp => {
      const start = new Date(exp.startDate);
      const end = exp.endDate ? new Date(exp.endDate) : new Date();
      const months = (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());
      totalMonths += months;
    });
    
    const years = Math.floor(totalMonths / 12);
    const months = totalMonths % 12;
    
    if (years === 0) return `${months} tháng`;
    if (months === 0) return `${years} năm`;
    return `${years} năm ${months} tháng`;
  };

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('vi-VN');
  };

  const handleAdd = () => {
    setFormData({
      company: '',
      position: '',
      startDate: '',
      endDate: '',
      description: '',
      responsibilities: [],
      location: '',
      isCurrentJob: false,
      achievements: []
    });
    setIsAdding(true);
  };

  const handleEdit = (exp) => {
    setFormData({
      ...exp,
      startDate: exp.startDate ? new Date(exp.startDate).toISOString().split('T')[0] : '',
      endDate: exp.endDate ? new Date(exp.endDate).toISOString().split('T')[0] : ''
    });
    setEditingId(exp._id);
  };

  const handleCancel = () => {
    setIsAdding(false);
    setEditingId(null);
  };

  const handleSave = async () => {
    if (!formData.company || !formData.position || !formData.startDate) {
      toast.error('Vui lòng điền đầy đủ thông tin bắt buộc');
      return;
    }

    try {
      setIsUpdating(true);
      let updatedExperiences;

      if (isAdding) {
        updatedExperiences = [...experiences, formData];
      } else {
        updatedExperiences = experiences.map(exp => 
          exp._id === editingId ? { ...exp, ...formData } : exp
        );
      }

      await onUpdate({ experiences: updatedExperiences });
      setIsAdding(false);
      setEditingId(null);
      toast.success(isAdding ? 'Thêm kinh nghiệm thành công' : 'Cập nhật kinh nghiệm thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  const handleDelete = async (expId) => {
    if (!window.confirm('Bạn có chắc chắn muốn xóa kinh nghiệm này?')) return;

    try {
      setIsUpdating(true);
      const updatedExperiences = experiences.filter(exp => exp._id !== expId);
      await onUpdate({ experiences: updatedExperiences });
      toast.success('Xóa kinh nghiệm thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Briefcase className="w-5 h-5 text-primary" />
            Kinh nghiệm làm việc
            {experiences.length > 0 && (
              <Badge variant="outline">{calculateExperience(experiences)}</Badge>
            )}
          </div>
          {!isAdding && !editingId && (
            <Button size="sm" onClick={handleAdd}>
              <Plus className="w-4 h-4 mr-2" />
              Thêm
            </Button>
          )}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-4">
        {isAdding && <ExperienceForm 
          formData={formData}
          onFormChange={handleFormChange}
          onCancel={handleCancel}
          onSave={handleSave}
          isUpdating={isUpdating}
        />}

        {experiences.length === 0 && !isAdding ? (
          <p className="text-muted-foreground text-center py-8">
            Chưa có kinh nghiệm làm việc. Nhấn "Thêm" để bắt đầu.
          </p>
        ) : (
          experiences.map((exp) => (
            <div key={exp._id} className="space-y-2">
              {editingId === exp._id ? (
                <ExperienceForm 
                  formData={formData}
                  onFormChange={handleFormChange}
                  onCancel={handleCancel}
                  onSave={handleSave}
                  isUpdating={isUpdating}
                />
              ) : (
                <div className="border-l-2 border-primary/20 pl-4 pb-4">
                  <div className="flex items-start justify-between">
                    <div className="flex-1">
                      <h3 className="font-semibold text-lg text-foreground">{exp.position}</h3>
                      <div className="flex items-center text-primary font-medium mb-2">
                        <Building className="w-4 h-4 mr-1" />
                        {exp.company}
                      </div>
                      <div className="flex items-center gap-2 text-muted-foreground text-sm mb-2">
                        <div className="flex items-center">
                          <Calendar className="w-4 h-4 mr-1" />
                          {formatDate(exp.startDate)} - {exp.endDate ? formatDate(exp.endDate) : 'Hiện tại'}
                        </div>
                        {exp.isCurrentJob && (
                          <Badge variant="secondary" className="text-xs">
                            Hiện tại
                          </Badge>
                        )}
                      </div>
                      {exp.location && (
                        <p className="text-sm text-muted-foreground mb-2">📍 {exp.location}</p>
                      )}
                      {exp.description && (
                        <p className="text-muted-foreground mt-2">{exp.description}</p>
                      )}
                      {exp.achievements && exp.achievements.length > 0 && (
                        <div className="mt-2">
                          <p className="text-xs font-medium text-muted-foreground mb-1">🎯 Thành tựu:</p>
                          <ul className="text-sm text-muted-foreground list-disc list-inside">
                            {exp.achievements.map((achievement, i) => (
                              <li key={i}>{achievement}</li>
                            ))}
                          </ul>
                        </div>
                      )}
                    </div>
                    <div className="flex gap-2">
                      <Button 
                        size="sm" 
                        variant="ghost" 
                        onClick={() => handleEdit(exp)}
                        disabled={isUpdating}
                      >
                        <Edit3 className="w-4 h-4" />
                      </Button>
                      <Button 
                        size="sm" 
                        variant="ghost" 
                        className="text-destructive hover:text-destructive"
                        onClick={() => handleDelete(exp._id)}
                        disabled={isUpdating}
                      >
                        <Trash2 className="w-4 h-4" />
                      </Button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          ))
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/profile/PreferencesSection.jsx">
import { useState, useEffect } from 'react';
import { useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { MapPin, DollarSign, Edit3, Save, X, Plus, Trash2, Briefcase, Layers } from 'lucide-react';
import { toast } from 'sonner';
import locationData from '@/data/oldtree.json';
import { JOB_CATEGORIES, getCategoryLabel, getCategoryIcon } from '@/constants/jobCategories';

// Process location data từ oldtree.json
const processLocationData = () => {
    const provinces = [];
    const districtMap = new Map();

    locationData.forEach(province => {
        if (!province?.name) return;
        provinces.push({ name: province.name });
        const districts = (province.districts || []).map(d => ({ name: d.name }));
        districtMap.set(province.name, districts);
    });

    return { provinces, districtMap };
};

const { provinces: PROVINCES, districtMap: DISTRICT_MAP } = processLocationData();

const WORK_TYPES = [
    { value: 'ON_SITE', label: 'Tại văn phòng', icon: '🏢' },
    { value: 'REMOTE', label: 'Từ xa', icon: '🏠' },
    { value: 'HYBRID', label: 'Linh hoạt', icon: '🔄' }
];

const CONTRACT_TYPES = [
    { value: 'FULL_TIME', label: 'Toàn thời gian' },
    { value: 'PART_TIME', label: 'Bán thời gian' },
    { value: 'CONTRACT', label: 'Hợp đồng' },
    { value: 'INTERNSHIP', label: 'Thực tập' },
    { value: 'TEMPORARY', label: 'Tạm thời' },
    { value: 'FREELANCE', label: 'Freelance' }
];

const SALARY_RANGES = [
    { min: 5000000, max: 10000000, label: '5-10 triệu' },
    { min: 10000000, max: 15000000, label: '10-15 triệu' },
    { min: 15000000, max: 20000000, label: '15-20 triệu' },
    { min: 20000000, max: 30000000, label: '20-30 triệu' },
    { min: 30000000, max: 50000000, label: '30-50 triệu' },
    { min: 50000000, max: 100000000, label: '50-100 triệu' }
];

const EXPERIENCE_LEVELS = [
    { value: 'NO_EXPERIENCE', label: 'Chưa có kinh nghiệm' },
    { value: 'INTERN', label: 'Thực tập sinh' },
    { value: 'FRESHER', label: 'Mới ra trường' },
    { value: 'ENTRY_LEVEL', label: 'Mới đi làm' },
    { value: 'MID_LEVEL', label: 'Trung cấp' },
    { value: 'SENIOR_LEVEL', label: 'Cao cấp' },
    { value: 'EXECUTIVE', label: 'Quản lý/Điều hành' }
];

export const PreferencesSection = ({ profile, onUpdate }) => {
    const queryClient = useQueryClient();
    const [isEditing, setIsEditing] = useState(false);
    const [isUpdating, setIsUpdating] = useState(false);

    const [formData, setFormData] = useState({
        preferredLocations: profile?.preferredLocations || [],
        expectedSalary: profile?.expectedSalary || { min: 0, max: 0, currency: 'VND' },
        workPreferences: profile?.workPreferences || { workTypes: [], contractTypes: [], experienceLevel: '' },
        preferredCategories: profile?.preferredCategories || []
    });

    const [newLocation, setNewLocation] = useState({ province: '', district: '' });

    // Sync formData with profile when not editing
    useEffect(() => {
        if (!isEditing && profile) {
            setFormData({
                preferredLocations: profile?.preferredLocations || [],
                expectedSalary: profile?.expectedSalary || { min: 0, max: 0, currency: 'VND' },
                workPreferences: profile?.workPreferences || { workTypes: [], contractTypes: [] },
                preferredCategories: profile?.preferredCategories || []
            });
        }
    }, [profile, isEditing]);

    const handleEdit = () => {
        setFormData({
            preferredLocations: profile?.preferredLocations || [],
            expectedSalary: profile?.expectedSalary || { min: 0, max: 0, currency: 'VND' },
            workPreferences: profile?.workPreferences || { workTypes: [], contractTypes: [] },
            preferredCategories: profile?.preferredCategories || []
        });
        setIsEditing(true);
    };

    const handleCancel = () => {
        setIsEditing(false);
        setNewLocation({ province: '', district: '' });
    };

    const handleSave = async () => {
        try {
            setIsUpdating(true);
            console.log('Saving preferences:', formData);
            await onUpdate(formData);
            
            // Invalidate related queries to refresh recommendations and completeness
            queryClient.invalidateQueries({ queryKey: ['myProfile'] });
            queryClient.invalidateQueries({ queryKey: ['jobRecommendations'] });
            queryClient.invalidateQueries({ queryKey: ['profileCompleteness'] });
            
            setIsEditing(false);
            toast.success('Cập nhật thông tin thành công');
        } catch (error) {
            console.error('Update error:', error);
            toast.error(error.response?.data?.message || 'Cập nhật thất bại');
        } finally {
            setIsUpdating(false);
        }
    };

    const addLocation = () => {
        if (!newLocation.province) {
            toast.error('Vui lòng chọn tỉnh/thành phố');
            return;
        }

        // Normalize district: empty string → null
        const normalizedDistrict = newLocation.district || null;

        const exists = formData.preferredLocations.some(
            loc => loc.province === newLocation.province && (loc.district || null) === normalizedDistrict
        );

        if (exists) {
            toast.error('Địa điểm này đã được thêm');
            return;
        }

        const newLocationData = { 
            province: newLocation.province, 
            district: normalizedDistrict 
        };

        console.log('Adding location:', newLocationData);
        
        setFormData(prev => {
            const updated = {
                ...prev,
                preferredLocations: [...prev.preferredLocations, newLocationData]
            };
            console.log('Updated formData:', updated);
            return updated;
        });
        
        setNewLocation({ province: '', district: '' });
        toast.success('Đã thêm địa điểm');
    };

    const removeLocation = (index) => {
        setFormData(prev => ({
            ...prev,
            preferredLocations: prev.preferredLocations.filter((_, i) => i !== index)
        }));
    };

    const toggleWorkType = (type) => {
        setFormData(prev => {
            const workTypes = prev.workPreferences?.workTypes || [];
            const newWorkTypes = workTypes.includes(type)
                ? workTypes.filter(t => t !== type)
                : [...workTypes, type];

            return {
                ...prev,
                workPreferences: { ...prev.workPreferences, workTypes: newWorkTypes }
            };
        });
    };

    const toggleContractType = (type) => {
        setFormData(prev => {
            const contractTypes = prev.workPreferences?.contractTypes || [];
            const newContractTypes = contractTypes.includes(type)
                ? contractTypes.filter(t => t !== type)
                : [...contractTypes, type];

            return {
                ...prev,
                workPreferences: { ...prev.workPreferences, contractTypes: newContractTypes }
            };
        });
    };

    const setSalaryRange = (range) => {
        setFormData(prev => ({
            ...prev,
            expectedSalary: { ...prev.expectedSalary, min: range.min, max: range.max }
        }));
    };

    const formatCurrency = (value) => {
        return new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND'
        }).format(value || 0);
    };

    const toggleCategory = (categoryValue) => {
        setFormData(prev => {
            const categories = prev.preferredCategories || [];
            const newCategories = categories.includes(categoryValue)
                ? categories.filter(c => c !== categoryValue)
                : [...categories, categoryValue];
            
            return { ...prev, preferredCategories: newCategories };
        });
    };

    const getProvinceName = (provinceName) => {
        return provinceName;
    };

    const selectedDistricts = newLocation.province ? DISTRICT_MAP.get(newLocation.province) || [] : [];

    return (
        <Card>
            <CardHeader>
                <div className="flex items-center justify-between">
                    <CardTitle className="flex items-center">
                        <MapPin className="w-5 h-5 mr-2 text-primary" />
                        Điều kiện làm việc
                    </CardTitle>
                    {!isEditing && (
                        <Button variant="outline" size="sm" onClick={handleEdit}>
                            <Edit3 className="w-4 h-4 mr-2" />
                            Chỉnh sửa
                        </Button>
                    )}
                </div>
            </CardHeader>

            <CardContent className="space-y-6">
                {/* Preferred Categories */}
                <div>
                    <Label className="text-base font-semibold mb-3 flex items-center">
                        <Layers className="w-4 h-4 mr-2" />
                        Ngành nghề quan tâm
                    </Label>

                    {isEditing ? (
                        <div className="space-y-3">
                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                                {JOB_CATEGORIES.map((category) => (
                                    <Button
                                        key={category.value}
                                        type="button"
                                        variant={
                                            formData.preferredCategories?.includes(category.value)
                                                ? 'default'
                                                : 'outline'
                                        }
                                        size="sm"
                                        onClick={() => toggleCategory(category.value)}
                                        className="justify-start h-auto py-2 px-3"
                                    >
                                        <span className="mr-2 text-lg">{getCategoryIcon(category.value)}</span>
                                        <span className="text-xs">{category.label}</span>
                                    </Button>
                                ))}
                            </div>
                            <p className="text-xs text-muted-foreground">
                                Đã chọn: {formData.preferredCategories?.length || 0} ngành nghề
                                {formData.preferredCategories?.length > 0 && 
                                    formData.preferredCategories.length < 1 && 
                                    ' (Tối thiểu 1 ngành nghề)'}
                                {formData.preferredCategories?.length > 5 && 
                                    ' (Tối đa 5 ngành nghề)'}
                            </p>
                        </div>
                    ) : (
                        <div className="flex flex-wrap gap-2">
                            {profile?.preferredCategories?.length > 0 ? (
                                profile.preferredCategories.map((category) => (
                                    <Badge key={category} variant="secondary" className="px-3 py-1">
                                        <span className="mr-1">{getCategoryIcon(category)}</span>
                                        {getCategoryLabel(category)}
                                    </Badge>
                                ))
                            ) : (
                                <p className="text-muted-foreground text-sm">Chưa cập nhật ngành nghề</p>
                            )}
                        </div>
                    )}
                </div>

                {/* Preferred Locations */}
                <div>
                    <Label className="text-base font-semibold mb-3 flex items-center">
                        <MapPin className="w-4 h-4 mr-2" />
                        Địa điểm làm việc mong muốn
                    </Label>

                    {isEditing ? (
                        <div className="space-y-3">
                            <div className="flex gap-2">
                                <Select
                                    value={newLocation.province}
                                    onValueChange={(value) => setNewLocation({ province: value, district: '' })}
                                >
                                    <SelectTrigger className="flex-1">
                                        <SelectValue placeholder="Chọn tỉnh/thành phố" />
                                    </SelectTrigger>
                                    <SelectContent>
                                        {PROVINCES.map((province) => (
                                            <SelectItem key={province.name} value={province.name}>
                                                {province.name}
                                            </SelectItem>
                                        ))}
                                    </SelectContent>
                                </Select>

                                {newLocation.province && (
                                    <Select
                                        value={newLocation.district || 'ALL_DISTRICTS'}
                                        onValueChange={(value) => setNewLocation(prev => ({
                                            ...prev,
                                            district: value === 'ALL_DISTRICTS' ? '' : value
                                        }))}
                                    >
                                        <SelectTrigger className="flex-1">
                                            <SelectValue placeholder="Tất cả quận/huyện" />
                                        </SelectTrigger>
                                        <SelectContent>
                                            <SelectItem value="ALL_DISTRICTS">Tất cả quận/huyện</SelectItem>
                                            {selectedDistricts.map((district) => (
                                                <SelectItem key={district.name} value={district.name}>
                                                    {district.name}
                                                </SelectItem>
                                            ))}
                                        </SelectContent>
                                    </Select>
                                )}

                                <Button type="button" onClick={addLocation} size="icon">
                                    <Plus className="w-4 h-4" />
                                </Button>
                            </div>

                            <div className="flex flex-wrap gap-2">
                                {formData.preferredLocations.map((location, index) => (
                                    <Badge key={index} variant="secondary" className="px-3 py-1">
                                        {getProvinceName(location.province)}
                                        {location.district && ` - ${location.district}`}
                                        <button
                                            onClick={() => removeLocation(index)}
                                            className="ml-2 hover:text-destructive"
                                        >
                                            <Trash2 className="w-3 h-3" />
                                        </button>
                                    </Badge>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <div className="flex flex-wrap gap-2">
                            {profile?.preferredLocations?.length > 0 ? (
                                profile.preferredLocations.map((location, index) => (
                                    <Badge key={index} variant="secondary" className="px-3 py-1">
                                        {getProvinceName(location.province)}
                                        {location.district && ` - ${location.district}`}
                                    </Badge>
                                ))
                            ) : (
                                <p className="text-muted-foreground text-sm">Chưa cập nhật địa điểm</p>
                            )}
                        </div>
                    )}
                </div>

                {/* Expected Salary */}
                <div>
                    <Label className="text-base font-semibold mb-3 flex items-center">
                        <DollarSign className="w-4 h-4 mr-2" />
                        Mức lương mong muốn
                    </Label>

                    {isEditing ? (
                        <div className="space-y-3">
                            <div className="flex flex-wrap gap-2">
                                {SALARY_RANGES.map((range) => (
                                    <Button
                                        key={range.label}
                                        type="button"
                                        variant={
                                            formData.expectedSalary?.min === range.min &&
                                                formData.expectedSalary?.max === range.max
                                                ? 'default'
                                                : 'outline'
                                        }
                                        size="sm"
                                        onClick={() => setSalaryRange(range)}
                                    >
                                        {range.label}
                                    </Button>
                                ))}
                            </div>

                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <Label htmlFor="minSalary">Tối thiểu</Label>
                                    <Input
                                        id="minSalary"
                                        type="number"
                                        value={formData.expectedSalary?.min || 0}
                                        onChange={(e) => setFormData(prev => ({
                                            ...prev,
                                            expectedSalary: { ...prev.expectedSalary, min: parseInt(e.target.value) || 0 }
                                        }))}
                                        placeholder="5000000"
                                    />
                                    <p className="text-xs text-muted-foreground mt-1">
                                        {formatCurrency(formData.expectedSalary?.min || 0)}
                                    </p>
                                </div>

                                <div>
                                    <Label htmlFor="maxSalary">Tối đa</Label>
                                    <Input
                                        id="maxSalary"
                                        type="number"
                                        value={formData.expectedSalary?.max || 0}
                                        onChange={(e) => setFormData(prev => ({
                                            ...prev,
                                            expectedSalary: { ...prev.expectedSalary, max: parseInt(e.target.value) || 0 }
                                        }))}
                                        placeholder="20000000"
                                    />
                                    <p className="text-xs text-muted-foreground mt-1">
                                        {formatCurrency(formData.expectedSalary?.max || 0)}
                                    </p>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <p className="text-foreground">
                            {profile?.expectedSalary?.min > 0 || profile?.expectedSalary?.max > 0 ? (
                                <>
                                    {formatCurrency(profile.expectedSalary.min)} - {formatCurrency(profile.expectedSalary.max)}
                                </>
                            ) : (
                                <span className="text-muted-foreground text-sm">Chưa cập nhật mức lương</span>
                            )}
                        </p>
                    )}
                </div>

                {/* Work Types */}
                <div>
                    <Label className="text-base font-semibold mb-3 flex items-center">
                        <Briefcase className="w-4 h-4 mr-2" />
                        Hình thức làm việc
                    </Label>

                    {isEditing ? (
                        <div className="flex flex-wrap gap-2">
                            {WORK_TYPES.map((type) => (
                                <Button
                                    key={type.value}
                                    type="button"
                                    variant={
                                        formData.workPreferences?.workTypes?.includes(type.value)
                                            ? 'default'
                                            : 'outline'
                                    }
                                    size="sm"
                                    onClick={() => toggleWorkType(type.value)}
                                >
                                    <span className="mr-2">{type.icon}</span>
                                    {type.label}
                                </Button>
                            ))}
                        </div>
                    ) : (
                        <div className="flex flex-wrap gap-2">
                            {profile?.workPreferences?.workTypes?.length > 0 ? (
                                profile.workPreferences.workTypes.map((type) => {
                                    const workType = WORK_TYPES.find(t => t.value === type);
                                    return (
                                        <Badge key={type} variant="secondary" className="px-3 py-1">
                                            <span className="mr-1">{workType?.icon}</span>
                                            {workType?.label || type}
                                        </Badge>
                                    );
                                })
                            ) : (
                                <p className="text-muted-foreground text-sm">Chưa cập nhật hình thức làm việc</p>
                            )}
                        </div>
                    )}
                </div>

                {/* Contract Types */}
                <div>
                    <Label className="text-base font-semibold mb-3">Loại hợp đồng</Label>

                    {isEditing ? (
                        <div className="flex flex-wrap gap-2">
                            {CONTRACT_TYPES.map((type) => (
                                <Button
                                    key={type.value}
                                    type="button"
                                    variant={
                                        formData.workPreferences?.contractTypes?.includes(type.value)
                                            ? 'default'
                                            : 'outline'
                                    }
                                    size="sm"
                                    onClick={() => toggleContractType(type.value)}
                                >
                                    {type.label}
                                </Button>
                            ))}
                        </div>
                    ) : (
                        <div className="flex flex-wrap gap-2">
                            {profile?.workPreferences?.contractTypes?.length > 0 ? (
                                profile.workPreferences.contractTypes.map((type) => {
                                    const contractType = CONTRACT_TYPES.find(t => t.value === type);
                                    return (
                                        <Badge key={type} variant="secondary" className="px-3 py-1">
                                            {contractType?.label || type}
                                        </Badge>
                                    );
                                })
                            ) : (
                                <p className="text-muted-foreground text-sm">Chưa cập nhật loại hợp đồng</p>
                            )}
                        </div>
                    )}
                </div>

                {/* Experience Level */}
                <div>
                    <Label className="text-base font-semibold mb-3">Mức độ kinh nghiệm</Label>
                    {isEditing ? (
                        <Select
                            value={formData.workPreferences?.experienceLevel || ''}
                            onValueChange={(value) => setFormData(prev => ({
                                ...prev,
                                workPreferences: { ...prev.workPreferences, experienceLevel: value }
                            }))}
                        >
                            <SelectTrigger className="w-[240px]">
                                <SelectValue placeholder="Chọn mức độ kinh nghiệm" />
                            </SelectTrigger>
                            <SelectContent>
                                {EXPERIENCE_LEVELS.map((level) => (
                                    <SelectItem key={level.value} value={level.value}>
                                        {level.label}
                                    </SelectItem>
                                ))}
                            </SelectContent>
                        </Select>
                    ) : (
                        <p className="text-foreground">
                            {profile?.workPreferences?.experienceLevel ? (
                                EXPERIENCE_LEVELS.find(level => level.value === profile.workPreferences.experienceLevel)?.label
                            ) : (
                                <span className="text-muted-foreground text-sm">Chưa cập nhật mức độ kinh nghiệm</span>
                            )}
                        </p>
                    )}
                </div>

                {/* Action Buttons */}
                {isEditing && (
                    <div className="flex gap-2 pt-4 border-t">
                        <Button onClick={handleSave} disabled={isUpdating}>
                            <Save className="w-4 h-4 mr-2" />
                            {isUpdating ? 'Đang lưu...' : 'Lưu thay đổi'}
                        </Button>
                        <Button variant="outline" onClick={handleCancel} disabled={isUpdating}>
                            <X className="w-4 h-4 mr-2" />
                            Hủy
                        </Button>
                    </div>
                )}
            </CardContent>
        </Card>
    );
};
</file>

<file path="src/components/profile/ProfileCompletenessCard.jsx">
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { CheckCircle2, Circle, AlertCircle } from 'lucide-react';
import { cn } from '@/lib/utils';

const COMPLETENESS_ITEMS = [
  {
    key: 'hasBasicInfo',
    label: 'Thông tin cơ bản',
    description: 'Họ tên, số điện thoại, địa điểm làm việc',
    weight: 30
  },
  {
    key: 'hasSkills',
    label: 'Kỹ năng',
    description: 'Ít nhất 3 kỹ năng',
    weight: 30
  },
  {
    key: 'hasPreferences',
    label: 'Điều kiện làm việc',
    description: 'Mức lương và hình thức làm việc',
    weight: 20
  },
  {
    key: 'hasBio',
    label: 'Giới thiệu bản thân',
    description: 'Viết về bản thân',
    weight: 5,
    optional: true
  },
  {
    key: 'hasAvatar',
    label: 'Ảnh đại diện',
    description: 'Tải lên ảnh đại diện',
    weight: 5,
    optional: true
  },
  {
    key: 'hasExperience',
    label: 'Kinh nghiệm làm việc',
    description: 'Tùy chọn - phù hợp cho người có kinh nghiệm',
    weight: 5,
    optional: true
  },
  {
    key: 'hasEducation',
    label: 'Học vấn',
    description: 'Tùy chọn - thêm thông tin học vấn',
    weight: 5,
    optional: true
  }
];

export const ProfileCompletenessCard = ({ profileCompleteness, profile }) => {
  // Debug log
  console.log('ProfileCompletenessCard received:', profileCompleteness);
  
  // If backend doesn't return profileCompleteness, calculate it on frontend
  let data = profileCompleteness;
  
  if (!data && profile) {
    console.log('Calculating profileCompleteness on frontend (backend not ready)');
    
    // Match backend logic
    const hasBasicInfo = !!(profile.fullname && profile.phone && profile.preferredLocations?.length > 0);
    const hasSkills = (profile.skills || []).length >= 3;
    const hasPreferences = !!(
      profile.expectedSalary?.min > 0 &&
      profile.workPreferences?.workTypes?.length > 0
    );
    const hasBio = !!profile.bio;
    const hasAvatar = !!profile.avatar;
    const hasExperience = (profile.experiences || []).length > 0;
    const hasEducation = (profile.educations || []).length > 0;
    
    data = {
      hasBasicInfo,
      hasSkills,
      hasPreferences,
      hasBio,
      hasAvatar,
      hasExperience,
      hasEducation,
      percentage: 0
    };
    
    // Calculate percentage matching backend weights
    const weights = {
      hasBasicInfo: 30,
      hasSkills: 30,
      hasPreferences: 20,
      hasBio: 5,
      hasAvatar: 5,
      hasExperience: 5,
      hasEducation: 5
    };
    
    data.percentage = Math.round(
      (data.hasBasicInfo ? weights.hasBasicInfo : 0) +
      (data.hasSkills ? weights.hasSkills : 0) +
      (data.hasPreferences ? weights.hasPreferences : 0) +
      (data.hasBio ? weights.hasBio : 0) +
      (data.hasAvatar ? weights.hasAvatar : 0) +
      (data.hasExperience ? weights.hasExperience : 0) +
      (data.hasEducation ? weights.hasEducation : 0)
    );
  }
  
  if (!data) {
    console.log('No profileCompleteness data - returning null');
    return null;
  }

  const { percentage = 0 } = data;
  
  // Determine color based on percentage
  const getPercentageColor = (pct) => {
    if (pct >= 85) return 'text-emerald-600';
    if (pct >= 60) return 'text-blue-600';
    if (pct >= 40) return 'text-amber-600';
    return 'text-rose-600';
  };

  const getProgressColor = (pct) => {
    if (pct >= 85) return 'bg-emerald-600';
    if (pct >= 60) return 'bg-blue-600';
    if (pct >= 40) return 'bg-amber-600';
    return 'bg-rose-600';
  };

  const getStatusBadge = (pct) => {
    if (pct === 100) return { label: 'Hoàn hảo', variant: 'default', className: 'bg-emerald-600' };
    if (pct >= 85) return { label: 'Tốt', variant: 'default', className: 'bg-blue-600' };
    if (pct >= 60) return { label: 'Khá', variant: 'default', className: 'bg-amber-600' };
    if (pct >= 40) return { label: 'Trung bình', variant: 'secondary' };
    return { label: 'Cần hoàn thiện', variant: 'destructive' };
  };

  const statusBadge = getStatusBadge(percentage);
  const completedCount = COMPLETENESS_ITEMS.filter(item => data[item.key]).length;
  const totalCount = COMPLETENESS_ITEMS.length;

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg">Độ hoàn thiện hồ sơ</CardTitle>
          <Badge variant={statusBadge.variant} className={statusBadge.className}>
            {statusBadge.label}
          </Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Percentage Circle */}
        <div className="text-center py-4">
          <div className="relative inline-flex items-center justify-center">
            <svg className="w-32 h-32 transform -rotate-90">
              <circle
                cx="64"
                cy="64"
                r="56"
                stroke="currentColor"
                strokeWidth="8"
                fill="transparent"
                className="text-muted"
              />
              <circle
                cx="64"
                cy="64"
                r="56"
                stroke="currentColor"
                strokeWidth="8"
                fill="transparent"
                strokeDasharray={`${2 * Math.PI * 56}`}
                strokeDashoffset={`${2 * Math.PI * 56 * (1 - percentage / 100)}`}
                className={cn(getProgressColor(percentage), "transition-all duration-1000 ease-out")}
                strokeLinecap="round"
              />
            </svg>
            <div className="absolute inset-0 flex flex-col items-center justify-center">
              <span className={cn("text-4xl font-bold", getPercentageColor(percentage))}>
                {percentage}%
              </span>
              <span className="text-xs text-muted-foreground mt-1">
                {completedCount}/{totalCount} mục
              </span>
            </div>
          </div>
        </div>

        {/* Progress Bar (alternative view) */}
        <div className="space-y-2">
          <Progress value={percentage} className="h-3" />
          <p className="text-sm text-muted-foreground text-center">
            {percentage === 100 ? (
              '🎉 Hồ sơ của bạn đã hoàn chỉnh!'
            ) : (
              `Còn ${100 - percentage}% để hoàn thiện`
            )}
          </p>
        </div>

        {/* Completeness Items */}
        <div className="space-y-3 pt-2">
          <p className="text-sm font-semibold text-foreground">Chi tiết:</p>
          {COMPLETENESS_ITEMS.map((item) => {
            const isCompleted = data[item.key];
            return (
              <div
                key={item.key}
                className={cn(
                  "flex items-start gap-3 p-3 rounded-lg transition-colors",
                  isCompleted ? "bg-emerald-50 dark:bg-emerald-950/20" : "bg-muted/50"
                )}
              >
                <div className="flex-shrink-0 mt-0.5">
                  {isCompleted ? (
                    <CheckCircle2 className="w-5 h-5 text-emerald-600" />
                  ) : (
                    <Circle className="w-5 h-5 text-muted-foreground" />
                  )}
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2">
                    <p className={cn(
                      "text-sm font-medium",
                      isCompleted ? "text-foreground" : "text-muted-foreground"
                    )}>
                      {item.label}
                    </p>
                    {item.optional && (
                      <Badge variant="outline" className="text-xs">
                        Tùy chọn
                      </Badge>
                    )}
                  </div>
                  <p className="text-xs text-muted-foreground mt-0.5">
                    {item.description}
                  </p>
                </div>
                <div className="flex-shrink-0 text-xs text-muted-foreground">
                  {item.weight}%
                </div>
              </div>
            );
          })}
        </div>

        {/* Tips Section */}
        {percentage < 100 && (
          <div className="mt-4 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800">
            <div className="flex gap-2">
              <AlertCircle className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-blue-900 dark:text-blue-100">
                  💡 Mẹo tăng % hoàn thiện
                </p>
                <ul className="text-xs text-blue-800 dark:text-blue-200 mt-2 space-y-1">
                  {!data.hasBasicInfo && (
                    <li>• Cập nhật họ tên, số điện thoại và địa điểm làm việc</li>
                  )}
                  {!data.hasSkills && (
                    <li>• Thêm ít nhất 3 kỹ năng của bạn</li>
                  )}
                  {!data.hasPreferences && (
                    <li>• Thiết lập mức lương và hình thức làm việc mong muốn</li>
                  )}
                  {!data.hasBio && (
                    <li>• Viết giới thiệu ngắn về bản thân</li>
                  )}
                  {!data.hasAvatar && (
                    <li>• Tải lên ảnh đại diện</li>
                  )}
                  {percentage >= 80 && percentage < 100 && (
                    <li>• Thêm kinh nghiệm & học vấn để nổi bật hơn</li>
                  )}
                </ul>
              </div>
            </div>
          </div>
        )}

        {/* Success Message */}
        {percentage === 100 && (
          <div className="mt-4 p-3 bg-emerald-50 dark:bg-emerald-950/20 rounded-lg border border-emerald-200 dark:border-emerald-800 text-center">
            <p className="text-sm font-medium text-emerald-900 dark:text-emerald-100">
              🎉 Tuyệt vời! Hồ sơ của bạn đã hoàn chỉnh
            </p>
            <p className="text-xs text-emerald-700 dark:text-emerald-300 mt-1">
              Bạn đã sẵn sàng để ứng tuyển!
            </p>
          </div>
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/profile/SkillsSection.jsx">
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Star, Plus, X, Save } from 'lucide-react';
import { toast } from 'sonner';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { SkillLevelIndicator } from './SkillLevelIndicator';

const SKILL_LEVELS = [
  { value: 'Beginner', label: 'Cơ bản' },
  { value: 'Intermediate', label: 'Trung cấp' },
  { value: 'Advanced', label: 'Nâng cao' },
  { value: 'Expert', label: 'Chuyên gia' }
];

const SKILL_CATEGORIES = [
  { value: 'Technical', label: 'Kỹ thuật' },
  { value: 'Soft Skills', label: 'Kỹ năng mềm' },
  { value: 'Language', label: 'Ngoại ngữ' },
  { value: 'Other', label: 'Khác' }
];

export const SkillsSection = ({ skills = [], onUpdate }) => {
  const [isEditing, setIsEditing] = useState(false);
  const [editSkills, setEditSkills] = useState([]);
  const [newSkill, setNewSkill] = useState({ name: '', level: null, category: null });
  const [isUpdating, setIsUpdating] = useState(false);

  const handleEdit = () => {
    setEditSkills(skills.map(skill => ({ ...skill }))); // Deep copy to avoid direct mutation
    setIsEditing(true);
  };

  const handleCancel = () => {
    setIsEditing(false);
    setNewSkill({ name: '', level: null, category: null });
  };

  const handleAddSkill = () => {
    if (!newSkill.name.trim()) {
      toast.error('Vui lòng nhập tên kỹ năng');
      return;
    }

    if (editSkills.some(skill => skill.name.toLowerCase() === newSkill.name.toLowerCase())) {
      toast.error('Kỹ năng này đã tồn tại');
      return;
    }

    setEditSkills([...editSkills, { ...newSkill, name: newSkill.name.trim() }]);
    setNewSkill({ name: '', level: null, category: null });
  };

  const handleSkillChange = (index, field, value) => {
    const updatedSkills = [...editSkills];
    updatedSkills[index] = { ...updatedSkills[index], [field]: value };
    setEditSkills(updatedSkills);
  };

  const handleRemoveSkill = (index) => {
    setEditSkills(editSkills.filter((_, i) => i !== index));
  };

  const handleSave = async () => {
    if (editSkills.length === 0) {
      toast.error('Vui lòng thêm ít nhất một kỹ năng');
      return;
    }

    try {
      setIsUpdating(true);
      await onUpdate({ skills: editSkills });
      setIsEditing(false);
      setNewSkillName('');
      toast.success('Cập nhật kỹ năng thành công');
    } catch (error) {
      toast.error(error.response?.data?.message || 'Có lỗi xảy ra');
    } finally {
      setIsUpdating(false);
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      handleAddSkill();
    }
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center justify-between">
          <div className="flex items-center">
            <Star className="w-5 h-5 mr-2 text-primary" />
            Kỹ năng
          </div>
          {!isEditing ? (
            <Button size="sm" onClick={handleEdit}>
              <Plus className="w-4 h-4 mr-2" />
              {skills.length === 0 ? 'Thêm' : 'Chỉnh sửa'}
            </Button>
          ) : (
            <div className="flex gap-2">
              <Button size="sm" variant="outline" onClick={handleCancel} disabled={isUpdating}>
                <X className="w-4 h-4 mr-2" />
                Hủy
              </Button>
              <Button size="sm" onClick={handleSave} disabled={isUpdating}>
                <Save className="w-4 h-4 mr-2" />
                {isUpdating ? 'Đang lưu...' : 'Lưu'}
              </Button>
            </div>
          )}
        </CardTitle>
      </CardHeader>
      <CardContent>
        {isEditing ? (
          <div className="space-y-4">
            <div className="grid gap-3">
              <div>
                <Label htmlFor="newSkillName">Tên kỹ năng</Label>
                <Input
                  id="newSkillName"
                  value={newSkill.name}
                  onChange={(e) => setNewSkill(prev => ({ ...prev, name: e.target.value }))}
                  onKeyPress={handleKeyPress}
                  placeholder="Ví dụ: JavaScript, React, Communication..."
                  className="mt-1"
                />
              </div>
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <Label htmlFor="newSkillLevel">Mức độ</Label>
                  <Select
                    value={newSkill.level || ''}
                    onValueChange={(value) => setNewSkill(prev => ({ ...prev, level: value || null }))}
                  >
                    <SelectTrigger id="newSkillLevel" className="mt-1">
                      <SelectValue placeholder="Chọn mức độ" />
                    </SelectTrigger>
                    <SelectContent>
                      {SKILL_LEVELS.map(level => (
                        <SelectItem key={level.value} value={level.value}>{level.label}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div>
                  <Label htmlFor="newSkillCategory">Danh mục</Label>
                  <Select
                    value={newSkill.category || ''}
                    onValueChange={(value) => setNewSkill(prev => ({ ...prev, category: value || null }))}
                  >
                    <SelectTrigger id="newSkillCategory" className="mt-1">
                      <SelectValue placeholder="Chọn danh mục" />
                    </SelectTrigger>
                    <SelectContent>
                      {SKILL_CATEGORIES.map(category => (
                        <SelectItem key={category.value} value={category.value}>{category.label}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
              </div>
              <Button onClick={handleAddSkill} variant="outline" className="w-full">
                <Plus className="w-4 h-4 mr-2" />
                Thêm kỹ năng
              </Button>
            </div>

            {editSkills.length > 0 && (
              <div className="space-y-2 mt-4 pt-4 border-t">
                <p className="text-sm font-medium text-muted-foreground mb-3">
                  Danh sách kỹ năng ({editSkills.length})
                </p>
                {editSkills.map((skill, index) => (
                  <div key={index} className="group relative bg-muted/50 rounded-lg p-3 hover:bg-muted transition-colors">
                    <div className="flex items-start justify-between gap-2">
                      <div className="flex-1 min-w-0">
                        <Input
                          value={skill.name}
                          onChange={(e) => handleSkillChange(index, 'name', e.target.value)}
                          placeholder="Tên kỹ năng..."
                          className="mb-2 font-medium"
                        />
                        <div className="grid grid-cols-2 gap-2">
                          <Select
                            value={skill.level || ''}
                            onValueChange={(value) => handleSkillChange(index, 'level', value || null)}
                          >
                            <SelectTrigger className="h-8 text-xs">
                              <SelectValue placeholder="Mức độ" />
                            </SelectTrigger>
                            <SelectContent>
                              {SKILL_LEVELS.map(level => (
                                <SelectItem key={level.value} value={level.value}>{level.label}</SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                          <Select
                            value={skill.category || ''}
                            onValueChange={(value) => handleSkillChange(index, 'category', value || null)}
                          >
                            <SelectTrigger className="h-8 text-xs">
                              <SelectValue placeholder="Danh mục" />
                            </SelectTrigger>
                            <SelectContent>
                              {SKILL_CATEGORIES.map(category => (
                                <SelectItem key={category.value} value={category.value}>{category.label}</SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                        </div>
                      </div>
                      <Button
                        type="button"
                        variant="ghost"
                        size="icon"
                        onClick={() => handleRemoveSkill(index)}
                        className="shrink-0 h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity"
                      >
                        <X className="w-4 h-4" />
                      </Button>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        ) : (
          <>
            {skills.length > 0 ? (
              <div className="space-y-4">
                {/* Group skills by category */}
                {['Technical', 'Soft Skills', 'Language', 'Other'].map(categoryValue => {
                  const categorySkills = skills.filter(skill => skill.category === categoryValue);
                  if (categorySkills.length === 0) return null;
                  
                  const categoryLabel = SKILL_CATEGORIES.find(c => c.value === categoryValue)?.label || categoryValue;
                  
                  return (
                    <div key={categoryValue} className="space-y-2">
                      <h4 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide">
                        {categoryLabel}
                      </h4>
                      <div className="space-y-2">
                        {categorySkills.map((skill, index) => (
                          <div 
                            key={skill._id || index}
                            className="flex items-center justify-between p-2 rounded-md bg-muted/50 hover:bg-muted transition-colors"
                          >
                            <span className="font-medium text-sm">{skill.name}</span>
                            <SkillLevelIndicator level={skill.level} />
                          </div>
                        ))}
                      </div>
                    </div>
                  );
                })}
                
                {/* Skills without category */}
                {skills.filter(skill => !skill.category).length > 0 && (
                  <div className="space-y-2">
                    <h4 className="text-sm font-semibold text-muted-foreground uppercase tracking-wide">
                      Khác
                    </h4>
                    <div className="space-y-2">
                      {skills.filter(skill => !skill.category).map((skill, index) => (
                        <div 
                          key={skill._id || index}
                          className="flex items-center justify-between p-2 rounded-md bg-muted/50 hover:bg-muted transition-colors"
                        >
                          <span className="font-medium text-sm">{skill.name}</span>
                          <SkillLevelIndicator level={skill.level} />
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            ) : (
              <div className="text-center py-8">
                <div className="inline-flex items-center justify-center w-12 h-12 rounded-full bg-muted mb-3">
                  <Star className="w-6 h-6 text-muted-foreground" />
                </div>
                <p className="text-muted-foreground text-sm">
                  Chưa có kỹ năng nào
                </p>
                <p className="text-muted-foreground text-xs mt-1">
                  Thêm kỹ năng để tăng cơ hội được tuyển dụng
                </p>
              </div>
            )}
          </>
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/components/ui/dropdown-menu.jsx">
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}>
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-32 overflow-hidden rounded-xl p-1 text-popover-foreground",
      // Glass morphism effect
      "bg-popover/95 backdrop-blur-xl",
      // Enhanced border
      "border-2 border-border/50",
      // Enhanced shadow for depth
      "shadow-[0_20px_70px_-15px_rgba(0,0,0,0.3)]",
      "dark:shadow-[0_20px_70px_-15px_rgba(0,0,0,0.6)]",
      // Ring effect
      "ring-1 ring-black/5 dark:ring-white/10",
      // Animations
      "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-dropdown-menu-content-transform-origin)",
      className
    )}
    {...props} />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-32 overflow-y-auto overflow-x-hidden rounded-xl p-1 text-popover-foreground",
        // Glass morphism effect
        "bg-popover/95 backdrop-blur-xl",
        // Enhanced border
        "border-2 border-border/50",
        // Enhanced shadow for depth
        "shadow-[0_20px_70px_-15px_rgba(0,0,0,0.3)]",
        "dark:shadow-[0_20px_70px_-15px_rgba(0,0,0,0.6)]",
        // Ring effect
        "ring-1 ring-black/5 dark:ring-white/10",
        // Animations
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-dropdown-menu-content-transform-origin)",
        className
      )}
      {...props} />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props} />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",
      className
    )}
    checked={checked}
    {...props}>
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-disabled:opacity-50",
      className
    )}
    {...props}>
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn("px-2 py-1.5 text-sm font-semibold", inset && "pl-8", className)}
    {...props} />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props} />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props} />
  );
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}
</file>

<file path="src/hooks/useFirebaseMessaging.js">
import { useState, useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { requestForToken, setupOnMessageListener } from '@/services/firebase';
import { fetchRecentNotifications, fetchUnreadCount, fetchNotifications } from '@/redux/notificationSlice';
import { toast } from 'sonner';

/**
 * A hook to manage Firebase Cloud Messaging.
 * It requests permission, gets the token, and listens for foreground messages.
 */
const useFirebaseMessaging = (options = {}) => {
  const { onPermissionDenied } = options;
  const [notification, setNotification] = useState(null);
  const [permissionDenied, setPermissionDenied] = useState(false);
  const dispatch = useDispatch();
  const { pagination, initialized } = useSelector((state) => state.notifications);

  /**
   * Manually requests notification permission and retrieves the FCM token.
   */
  const requestPermission = async () => {
    try {
      // Reset permission denied state
      setPermissionDenied(false);
      
      const token = await requestForToken();
      if (token) {
        toast.success('Thông báo đã được bật.');
        console.log('FCM token obtained:', token);
      } else {
        // Permission was denied
        const errorMessage = 'Quyền thông báo bị từ chối. Nhấn "Xem hướng dẫn" để biết cách bật.';
        setPermissionDenied(true);
        
        toast.error(errorMessage, {
          duration: 5000,
          action: {
            label: 'Xem hướng dẫn',
            onClick: () => {
              if (onPermissionDenied) {
                onPermissionDenied();
              }
            }
          }
        });
        
        // Auto trigger permission guide callback after delay
        if (onPermissionDenied) {
          setTimeout(() => onPermissionDenied(), 1500);
        }
      }
    } catch (error) {
      console.error('Error requesting notification permission:', error);
      
      // Check if it's a permission error
      const isPermissionError = error.message?.toLowerCase().includes('permission') || 
                                error.message?.toLowerCase().includes('denied');
      
      if (isPermissionError) {
        setPermissionDenied(true);
        const errorMessage = 'Quyền thông báo bị từ chối. Nhấn "Xem hướng dẫn" để biết cách bật.';
        
        toast.error(errorMessage, {
          duration: 5000,
          action: {
            label: 'Xem hướng dẫn',
            onClick: () => {
              if (onPermissionDenied) {
                onPermissionDenied();
              }
            }
          }
        });
        
        if (onPermissionDenied) {
          setTimeout(() => onPermissionDenied(), 1500);
        }
      } else {
        toast.error('Đã xảy ra lỗi khi bật thông báo.');
      }
    }
  };
useEffect(() => {
    // Chỉ thiết lập listener nếu người dùng đã cho phép thông báo
    if (Notification.permission === 'granted') {
      console.log('Setting up Firebase messaging listener...');

      // onMessage trả về một hàm "unsubscribe"
      // Chúng ta sẽ lưu nó lại để gọi khi component unmount
      const unsubscribe = setupOnMessageListener((payload) => {
        setNotification(payload);

        if (payload.notification) {
          toast.info(payload.notification.title, {
            description: payload.notification.body,
            duration: 5000,
            // Thêm action để người dùng có thể click vào
            action: {
              label: 'Xem',
              onClick: () => {
                if (payload.data && payload.data.url) {
                   window.location.href = payload.data.url;
                }
              },
            },
          });

          // Gọi API để cập nhật lại notifications trong Redux
          console.log('Fetching updated notifications after push notification...');
          
          // Cập nhật recent notifications và unread count
          dispatch(fetchRecentNotifications());
          dispatch(fetchUnreadCount());
          
          // Nếu user đã load notifications (đang ở NotificationsPage), refetch lại
          if (initialized) {
            dispatch(fetchNotifications({ 
              page: pagination.page, 
              limit: pagination.limit 
            }));
          }
        }
      });

      // Đây là hàm cleanup của useEffect
      // Nó sẽ được gọi khi component bị unmount (ví dụ: chuyển trang)
      return () => {
        console.log('Unsubscribing from Firebase messaging listener...');
        unsubscribe();
      };
    }
  }, [dispatch, pagination.page, pagination.limit, initialized]);

  // === VISIBILITY CHANGE HANDLER ===
  // Khi user quay lại tab sau khi ở background, refetch notifications
  useEffect(() => {
    const handleVisibilityChange = () => {
      if (document.visibilityState === 'visible' && Notification.permission === 'granted') {
        console.log('Tab became visible, refreshing notifications...');
        
        // Refetch tất cả để đảm bảo sync
        dispatch(fetchRecentNotifications());
        dispatch(fetchUnreadCount());
        
        // Nếu đang ở NotificationsPage, cũng refetch
        if (initialized) {
          dispatch(fetchNotifications({ 
            page: pagination.page, 
            limit: pagination.limit 
          }));
        }
      }
    };

    document.addEventListener('visibilitychange', handleVisibilityChange);

    return () => {
      document.removeEventListener('visibilitychange', handleVisibilityChange);
    };
  }, [dispatch, pagination.page, pagination.limit, initialized]);

  return { 
    notification, 
    requestPermission,
    permissionDenied 
  };
};

export default useFirebaseMessaging;
</file>

<file path="src/hooks/useSonioxSearch.js">
import { useState, useEffect, useRef, useCallback } from 'react';
import { SonioxClient } from '@soniox/speech-to-text-web';
import { toast } from 'sonner';
import { getTemporarySonioxApiKey, refreshSonioxApiKeyIfNeeded } from '@/services/sonioxService';

/**
 * Custom hook cho tìm kiếm bằng giọng nói sử dụng Soniox.
 * @param {object} options - Tùy chọn cấu hình.
 * @param {string} [options.lang='vi'] - Mã ngôn ngữ (ví dụ: 'vi', 'en').
 * @param {function} options.onResult - Callback được gọi khi có kết quả cuối cùng.
 * @returns {object} - Trạng thái và các hàm điều khiển voice search.
 */
export const useSonioxSearch = ({ lang = 'vi', onResult, onPermissionDenied }) => {
  const sonioxClient = useRef(null);
  const [state, setState] = useState("Idle");
  
  // Transcript for real-time display in the input
  const [displayTranscript, setDisplayTranscript] = useState('');
  
  // Ref to accumulate final text parts
  const finalTranscriptRef = useRef('');

  const [error, setError] = useState(null);
  const [permissionDenied, setPermissionDenied] = useState(false);
  
  // Store API key and expiration
  const apiKeyRef = useRef(null);
  const expiresAtRef = useRef(null);

  // Initialize SonioxClient with API key from backend
  useEffect(() => {
    const initializeSoniox = async () => {
      try {
        // Get API key from backend
        const { apiKey, expiresAt } = await getTemporarySonioxApiKey();
        apiKeyRef.current = apiKey;
        expiresAtRef.current = expiresAt;

        // Initialize Soniox client
        if (!sonioxClient.current) {
          sonioxClient.current = new SonioxClient({
            apiKey: apiKey,
          });
        }
      } catch (error) {
        console.error('Failed to initialize Soniox:', error);
        setError('Không thể khởi tạo tìm kiếm bằng giọng nói');
        toast.error('Không thể khởi tạo tìm kiếm bằng giọng nói');
      }
    };

    initializeSoniox();

    // Cleanup on unmount
    return () => {
      sonioxClient.current?.cancel();
    };
  }, []);

  const startSearch = useCallback(async () => {
    // Reset states for a new search
    setDisplayTranscript('');
    finalTranscriptRef.current = '';
    setError(null);
    setPermissionDenied(false);

    if (!sonioxClient.current) return;

    try {
      // Refresh API key if needed (less than 5 minutes until expiry)
      const refreshedKey = await refreshSonioxApiKeyIfNeeded(expiresAtRef.current);
      if (refreshedKey) {
        apiKeyRef.current = refreshedKey.apiKey;
        expiresAtRef.current = refreshedKey.expiresAt;
        
        // Reinitialize client with new key
        sonioxClient.current = new SonioxClient({
          apiKey: refreshedKey.apiKey,
        });
        
        console.log('Soniox API key refreshed');
      }
    } catch (error) {
      console.error('Failed to refresh API key:', error);
      toast.error('Không thể làm mới API key');
      return;
    }

    sonioxClient.current.start({
      model: 'stt-rt-v3',
      // language_hints: [lang],
      enableLanguageIdentification: true,
enableSpeakerDiarization: true,
      enableEndpointDetection: true,
      
      onStarted: () => {
        toast.info('Hãy nói từ khóa tìm kiếm...');
      },

      onStateChange: ({ newState }) => {
        setState(newState);
      },

      onError: (status, message) => {
        console.error(`Lỗi Soniox: ${message}`);
        
        // Check if it's a permission error
        const isPermissionError = message.toLowerCase().includes('permission') || 
                                  message.toLowerCase().includes('denied') ||
                                  message.toLowerCase().includes('notallowed');
        
        if (isPermissionError) {
          const errorMessage = 'Quyền truy cập microphone bị từ chối. Nhấn "Xem hướng dẫn" để biết cách bật.';
          setError(errorMessage);
          setPermissionDenied(true);
          
          toast.error(errorMessage, {
            duration: 5000,
            action: {
              label: 'Xem hướng dẫn',
              onClick: () => {
                if (onPermissionDenied) {
                  onPermissionDenied();
                }
              }
            }
          });
          
          // Auto trigger permission guide callback after delay
          if (onPermissionDenied) {
            setTimeout(() => onPermissionDenied(), 1500);
          }
        } else {
          const errorMessage = `Lỗi: ${message}`;
          setError(errorMessage);
          toast.error(errorMessage);
        }
      },

      onPartialResult: (result) => {
        // Append new final text to our ref
        const newFinalText = result.tokens
            .filter(t => t.is_final)
            .map(t => t.text)
            .join("");
        
        if (newFinalText) {
            finalTranscriptRef.current += newFinalText;
        }

        // Get current non-final text for display
        const nonFinalText = result.tokens
            .filter(t => !t.is_final)
            .map(t => t.text)
            .join("");
        console.log('Non-final text:', nonFinalText);
        console.log(result);
        // Update the display transcript, filtering out the <end> token
        setDisplayTranscript((finalTranscriptRef.current + nonFinalText).replace(/<end>/g, ''));
      },

      onFinished: () => {
        // Use the accumulated final transcript as the definitive result
        const finalTranscript = finalTranscriptRef.current.replace(/<end>/g, '').trim();
        
        // Final update for display
        setDisplayTranscript(finalTranscript);

        if (finalTranscript && onResult) {
          onResult(finalTranscript);
          toast.success(`Đã nhận dạng: ${finalTranscript}`);
        }
      },
    });
  }, [lang, onResult]);

  const stopSearch = useCallback(() => {
    sonioxClient.current?.stop();
  }, []);

  const toggleSearch = useCallback(() => {
    if (state === "Running") {
      stopSearch();
    } else {
      startSearch();
    }
  }, [state, startSearch, stopSearch]);

  return {
    state,
    isListening: state === "Running",
    fullTranscript: displayTranscript, // This is sent to the JobSearchBar input
    error,
    permissionDenied,
    isSupported: !!sonioxClient.current,
    toggleSearch,
  };
};
</file>

<file path="src/pages/dashboard/JobSuggestion.jsx">
import { useEffect, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Skeleton } from "@/components/ui/skeleton";
import { EmptyState } from "@/components/common/EmptyState";
import { ErrorState } from "@/components/common/ErrorState";
import apiClient from "@/services/apiClient";

const JobSuggestion = () => {
  const [jobs, setJobs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");

  const fetchJobs = async () => {
    try {
      setLoading(true);
      setError("");
      const response = await apiClient.get("/jobs");
      setJobs(response.data.data || []);
    } catch (err) {
      setError(err.message || "Không thể tải gợi ý việc làm.");
      console.error('Fetch error:', err);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchJobs();
  }, []);

  if (loading) {
    return (
      <div>
        <div className="flex justify-between items-center mb-6">
          <Skeleton className="h-8 w-64" />
          <Skeleton className="h-6 w-24" />
        </div>
        <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-1">
          {[...Array(3)].map((_, i) => (
            <Card key={i}>
              <CardContent className="p-6">
                <div className="flex justify-between items-start mb-4">
                  <div className="flex-1 space-y-2">
                    <Skeleton className="h-6 w-3/4" />
                    <Skeleton className="h-4 w-1/2" />
                    <Skeleton className="h-4 w-full" />
                  </div>
                  <div className="space-y-2 items-end flex flex-col">
                    <Skeleton className="h-6 w-24" />
                    <Skeleton className="h-4 w-20" />
                  </div>
                </div>
                <Skeleton className="h-12 w-full mb-4" />
                <div className="flex flex-wrap gap-2 mb-4">
                  <Skeleton className="h-6 w-20" />
                  <Skeleton className="h-6 w-24" />
                </div>
                <div className="flex justify-between items-center">
                  <Skeleton className="h-5 w-24" />
                  <div className="space-x-2">
                    <Skeleton className="h-10 w-28" />
                    <Skeleton className="h-10 w-32" />
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>
    );
  }
  
  if (error) {
    return <ErrorState message={error} onRetry={fetchJobs} />;
  }

  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-2xl font-bold text-foreground">Gợi ý việc làm dành cho bạn</h2>
        <div className="text-sm text-muted-foreground">
          Tìm thấy {jobs.length} công việc
        </div>
      </div>
      
      {jobs.length === 0 ? (
        <EmptyState message="Hiện tại không có gợi ý việc làm nào phù hợp với bạn." />
      ) : (
        <div className="grid gap-6 md:grid-cols-2 lg:grid-cols-1">
          {jobs.map((job) => (
            <Card key={job._id}>
              <CardContent className="p-6">
                <div className="flex justify-between items-start mb-4">
                  <div className="flex-1">
                    <h3 className="font-bold text-xl text-foreground mb-2">{job.title}</h3>
                    <div className="flex items-center text-muted-foreground mb-2">
                      <span className="font-medium">{job.company.name}</span>
                    </div>
                    <div className="flex items-center text-muted-foreground text-sm space-x-4">
                      <span>📍 {job.location.province} - {job.location.ward}</span>
                      <span>💼 {job.type === 'FULL_TIME' ? 'Toàn thời gian' : 'Bán thời gian'}</span>
                      <span>🏢 {job.workType === 'ON_SITE' ? 'Tại văn phòng' : job.workType === 'REMOTE' ? 'Từ xa' : 'Hybrid'}</span>
                    </div>
                  </div>
                  <div className="flex flex-col items-end">
                    <div className="text-success font-bold text-lg">
                      {job.minSalary} - {job.maxSalary} Triệu
                    </div>
                    <div className="text-xs text-muted-foreground mt-1">
                      Hạn: {new Date(job.deadline).toLocaleDateString('vi-VN')}
                    </div>
                  </div>
                </div>

                <div className="mb-4">
                  <p className="text-muted-foreground text-sm line-clamp-3">
                    {job.description}
                  </p>
                </div>

                <div className="mb-4">
                  <div className="flex flex-wrap gap-2">
                    <Badge variant="secondary">{job.category}</Badge>
                    <Badge variant="secondary">{job.experience}</Badge>
                    {job.approved && (
                      <Badge variant="outline" className="text-success border-success">
                        ✓ Đã xác thực
                      </Badge>
                    )}
                  </div>
                </div>

                <div className="flex justify-between items-center">
                  <div className="text-xs text-muted-foreground">
                    Đăng {new Date(job.createdAt).toLocaleDateString('vi-VN')}
                  </div>
                  <div className="space-x-2">
                    <Button variant="outline" className="border-gray-300 hover:bg-gray-50">Lưu việc làm</Button>
                    <Button className="bg-green-600 hover:bg-green-700 text-white">Ứng tuyển ngay</Button>
                  </div>
                </div>
              </CardContent>
            </Card>
          ))}
        </div>
      )}
    </div>
  );
};

export default JobSuggestion;
</file>

<file path="src/pages/jobs/components/ApplyJobDialog.jsx">
import { useState, useEffect, useMemo } from 'react';
import { useQuery } from '@tanstack/react-query';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Input } from '@/components/ui/input';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { toast } from 'sonner';
import { applyJob } from '@/services/jobService';
import { getCurrentUserProfile } from '@/services/profileService';
import { AlertCircle, Loader2 } from 'lucide-react';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';

/**
 * @param {{
 *  jobId: string | null;
 *  jobTitle: string;
 *  open: boolean;
 *  onOpenChange: (open: boolean) => void;
 *  onSuccess: () => void;
 * }} props
 */
export const ApplyJobDialog = ({ jobId, jobTitle, open, onOpenChange, onSuccess }) => {
  const [selectedCv, setSelectedCv] = useState('');
  const [coverLetter, setCoverLetter] = useState('');
  const [candidateName, setCandidateName] = useState('');
  const [candidateEmail, setCandidateEmail] = useState('');
  const [candidatePhone, setCandidatePhone] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [submitError, setSubmitError] = useState(null);

  const {
    data: profileData,
    isLoading,
    isError,
    error: queryError,
    refetch,
  } = useQuery({
    queryKey: ['currentUserProfile'],
    queryFn: getCurrentUserProfile,
    enabled: open, // Chỉ fetch khi dialog được mở
  });

  const userProfile = profileData?.data?.profile;
  const user = profileData?.data?.user;
  const cvs = useMemo(() => userProfile?.cvs || [], [userProfile?.cvs]);

  useEffect(() => {
    if (open && userProfile) {
      setCandidateName(userProfile.fullname || '');
      setCandidateEmail(user.email || '');
      setCandidatePhone(userProfile.phone || '');

      const defaultCv = cvs.find(cv => cv.isDefault) || cvs[0];
      if (defaultCv) {
        setSelectedCv(defaultCv._id);
      }

      setCoverLetter(`Kính gửi Quý công ty,\n\nTôi viết đơn này để bày tỏ sự quan tâm sâu sắc đến vị trí ${jobTitle} được đăng trên CareerZone. Với nền tảng, kỹ năng và kinh nghiệm của mình, tôi tin rằng mình là một ứng viên phù hợp cho vai trò này.\n\nTôi rất mong có cơ hội được thảo luận thêm về việc làm thế nào tôi có thể đóng góp cho đội ngũ của quý vị.\n\nXin chân thành cảm ơn.\n\nTrân trọng,\n${userProfile.fullname || ''}`);
    }
    if (!open) {
      // Reset state when dialog closes
      setSubmitError(null);
      setIsSubmitting(false);
    }
  }, [open, userProfile, user, jobTitle, cvs]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!jobId) return;

    if (!selectedCv) {
      setSubmitError("Vui lòng chọn một CV để ứng tuyển.");
      return;
    }

    setIsSubmitting(true);
    setSubmitError(null);

    const applicationData = {
      cvId: selectedCv,
      coverLetter,
      candidateName,
      candidateEmail,
      candidatePhone,
    };

    try {
      await applyJob(jobId, applicationData);
      toast.success('Nộp đơn ứng tuyển thành công!');
      onSuccess();
      onOpenChange(false);
    } catch (err) {
      const errorMessage = err.response?.data?.message || 'Có lỗi xảy ra khi ứng tuyển.';
      setSubmitError(errorMessage);
      toast.error(errorMessage);
    } finally {
      setIsSubmitting(false);
    }
  };

  const renderContent = () => {
    if (isLoading) {
      return (
        <div className="space-y-4 pt-4">
          <div className="grid grid-cols-2 gap-4">
            <Skeleton className="h-10 w-full" />
            <Skeleton className="h-10 w-full" />
          </div>
          <Skeleton className="h-10 w-full" />
          <Skeleton className="h-10 w-full" />
          <Skeleton className="h-24 w-full" />
        </div>
      );
    }

    if (isError) {
      return (
        <ErrorState
          onRetry={refetch}
          message={queryError.response?.data?.message || "Không thể tải thông tin của bạn."}
        />
      );
    }

    return (
      <form onSubmit={handleSubmit} className="space-y-4 pt-4">
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label htmlFor="candidateName">Họ và tên</Label>
            <Input
              id="candidateName"
              value={candidateName}
              onChange={(e) => setCandidateName(e.target.value)}
              required
              className="border-gray-300 focus:border-green-600 focus:ring-green-600"
            />
          </div>
          <div className="space-y-2">
            <Label htmlFor="candidatePhone">Số điện thoại</Label>
            <Input
              id="candidatePhone"
              value={candidatePhone}
              onChange={(e) => setCandidatePhone(e.target.value)}
              required
              className="border-gray-300 focus:border-green-600 focus:ring-green-600"
            />
          </div>
        </div>
        <div className="space-y-2">
          <Label htmlFor="candidateEmail">Email</Label>
          <Input
            id="candidateEmail"
            type="email"
            value={candidateEmail}
            onChange={(e) => setCandidateEmail(e.target.value)}
            required
            className="border-gray-300 focus:border-green-600 focus:ring-green-600"
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor="cv">Chọn CV (đã tải lên)</Label>
          <Select onValueChange={setSelectedCv} value={selectedCv} required>
            <SelectTrigger id="cv" className="w-full border-gray-300 focus:border-green-600 focus:ring-green-600">
              <SelectValue placeholder="Chọn CV để ứng tuyển..." />
            </SelectTrigger>
            <SelectContent className="z-9999 bg-white border border-gray-200 shadow-lg max-h-60 overflow-y-auto" container={document.body}>
              {cvs.length > 0 ? (
                cvs.map((cv) => (
                  <SelectItem key={cv._id} value={cv._id} className="hover:bg-gray-50 focus:bg-gray-50">
                    {cv.name}
                  </SelectItem>
                ))
              ) : (
                <div className="p-4 text-center text-sm text-gray-600">
                  Bạn chưa có CV nào. Vui lòng vào trang cá nhân để tải lên.
                </div>
              )}
            </SelectContent>
          </Select>
        </div>

        <div className="space-y-2">
          <Label htmlFor="coverLetter">Thư giới thiệu (Cover Letter)</Label>
          <Textarea
            id="coverLetter"
            value={coverLetter}
            onChange={(e) => setCoverLetter(e.target.value)}
            rows={10}
            placeholder="Viết một vài lời giới thiệu về bản thân và tại sao bạn phù hợp với vị trí này..."
            className="border-gray-300 focus:border-green-600 focus:ring-green-600"
          />
        </div>

        {submitError && (
          <Alert variant="destructive" className="border-red-200 bg-red-50">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>Lỗi</AlertTitle>
            <AlertDescription>{submitError}</AlertDescription>
          </Alert>
        )}

        <DialogFooter className="gap-3">
          <Button
            type="button"
            variant="outline"
            onClick={() => onOpenChange(false)}
            disabled={isSubmitting}
            className="border-gray-300 hover:bg-gray-50"
          >
            Hủy
          </Button>
          <Button
            type="submit"
            disabled={isSubmitting || cvs.length === 0 || isLoading}
            className="bg-green-600 hover:bg-green-700 text-white"
          >
            {isSubmitting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            {isSubmitting ? 'Đang nộp đơn...' : 'Xác nhận ứng tuyển'}
          </Button>
        </DialogFooter>
      </form>
    );
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-[600px] max-h-[90vh] overflow-y-auto bg-white">
        <DialogHeader>
          <DialogTitle className="text-2xl text-gray-900">Ứng tuyển vị trí</DialogTitle>
          <DialogDescription className="text-gray-600">{jobTitle}</DialogDescription>
        </DialogHeader>
        {renderContent()}
      </DialogContent>
    </Dialog>
  );
};
</file>

<file path="src/pages/jobs/components/MapView/JobMapView.jsx">
import React, { useEffect, useState, useRef, useCallback } from 'react';
import { MapContainer, TileLayer, Marker, Popup, useMap, useMapEvents } from 'react-leaflet';
import MarkerClusterGroup from 'react-leaflet-cluster';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';
import { Card, CardContent } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { MapPin, Navigation, Loader2, RefreshCw } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import JobMarkerPopup from './JobMarkerPopup';
import { cn } from '@/lib/utils';
import { searchJobsOnMap, getJobClusters } from '@/services/jobService';
import { toast } from 'sonner';

// Ngưỡng zoom để chuyển từ cluster sang marker chi tiết
const ZOOM_THRESHOLD = 13;

// Fix Leaflet default icon issue with Vite/Webpack
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
});

// Custom marker icons
const createCustomIcon = (color = '#FF6B35') => {
  return L.divIcon({
    className: 'custom-marker',
    html: `
      <div style="
        background-color: ${color};
        width: 32px;
        height: 32px;
        border-radius: 50% 50% 50% 0;
        transform: rotate(-45deg);
        border: 3px solid white;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        display: flex;
        align-items: center;
        justify-content: center;
      ">
        <div style="
          transform: rotate(45deg);
          color: white;
          font-size: 16px;
          margin-top: -4px;
        ">📍</div>
      </div>
    `,
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -32],
  });
};

const userIcon = L.divIcon({
  className: 'user-marker',
  html: `
    <div style="
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pulse 2s infinite;
    ">
      <div style="color: white; font-size: 20px;">📍</div>
    </div>
    <style>
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }
    </style>
  `,
  iconSize: [40, 40],
  iconAnchor: [20, 20],
  popupAnchor: [0, -20],
});

/**
 * MapEventHandler - Handle map move and fetch data for current viewport
 */
const MapEventHandler = ({ onMapMove, searchFilters }) => {
  const map = useMap();
  const debounceTimerRef = useRef(null);

  useMapEvents({
    moveend: () => {
      // Debounce: Wait 500ms after user stops moving
      if (debounceTimerRef.current) {
        clearTimeout(debounceTimerRef.current);
      }

      debounceTimerRef.current = setTimeout(() => {
        const bounds = map.getBounds();
        const center = map.getCenter();
        const zoom = map.getZoom();

        onMapMove({
          bounds: {
            north: bounds.getNorth(),
            south: bounds.getSouth(),
            east: bounds.getEast(),
            west: bounds.getWest(),
          },
          center: {
            lat: center.lat,
            lng: center.lng,
          },
          zoom,
        });
      }, 500); // 500ms debounce
    },
  });

  return null;
};

/**
 * JobMapView - Interactive map view with marker clustering and dynamic data loading
 * Loads jobs based on current viewport (no pagination needed)
 */
const JobMapView = ({
  initialJobs = [],
  isLoading: initialLoading = false,
  userLocation = null,
  searchFilters = {}, // All search filters from parent
  className
}) => {
  const [mapCenter, setMapCenter] = useState([21.0285, 105.8542]); // Hanoi default
  const [mapZoom, setMapZoom] = useState(12);
  const [jobs, setJobs] = useState(initialJobs);
  const [clusters, setClusters] = useState([]); // State để lưu clusters từ backend
  const [isLoadingJobs, setIsLoadingJobs] = useState(false);
  const [totalJobsInView, setTotalJobsInView] = useState(0);
  const [mapError, setMapError] = useState(null);
  const mapRef = useRef(null);

  // Log để debug
  useEffect(() => {
    console.log('🗺️ JobMapView mounted with:', {
      initialJobs: initialJobs.length,
      isLoading: initialLoading,
      userLocation,
      searchFilters
    });
  }, []);

  // Update jobs when initialJobs changes (first load)
  useEffect(() => {
    if (initialJobs && initialJobs.length > 0) {
      setJobs(initialJobs);
    }
  }, [initialJobs]);

  // Update map center based on user location or first job
  useEffect(() => {
    if (userLocation) {
      try {
        const coords = JSON.parse(userLocation);
        if (coords && coords.length === 2) {
          setMapCenter([coords[1], coords[0]]); // [lat, lng]
          setMapZoom(13);
        }
      } catch (error) {
        console.error('Failed to parse user location:', error);
      }
    } else if (jobs.length > 0) {
      // Lấy coordinates từ nested hoặc flat format
      const firstJob = jobs[0];
      const coords = firstJob.coordinates || firstJob.location?.coordinates?.coordinates;
      if (coords && coords.length === 2) {
        const [lng, lat] = coords;
        setMapCenter([lat, lng]);
        setMapZoom(12);
      }
    }
  }, [userLocation, jobs]);

  /**
   * Fetch jobs or clusters for current viewport based on zoom level
   * Zoom >= 12: Fetch individual jobs (detailed markers)
   * Zoom < 12: Fetch clusters (aggregated data from server)
   */
  const fetchJobsForViewport = useCallback(async (mapState) => {
    setIsLoadingJobs(true);

    try {
      const { bounds, zoom } = mapState;
      
      // ✅ DEBUG: Log zoom level
      console.log(`🔍 [DEBUG] Current Zoom Level: ${zoom}, Threshold: ${ZOOM_THRESHOLD}`);
      
      // Chuẩn bị bounds cho API
      const boundsParams = {
        sw_lat: bounds.south,
        sw_lng: bounds.west,
        ne_lat: bounds.north,
        ne_lng: bounds.east,
        zoom: zoom,
        ...searchFilters // Thêm các filters từ parent (category, experience, etc.)
      };

      let response;
      let processedJobs = [];

      // ✅ ĐỀ XUẤT 2: Tách riêng 2 endpoints - logic đơn giản hơn
      if (zoom < ZOOM_THRESHOLD) {
        // ZOOM XA: Gọi API CHỈ LẤY CLUSTERS (không có singles)
        console.log(`🗺️ Zoom ${zoom} < ${ZOOM_THRESHOLD}: Fetching ONLY clusters...`);
        response = await getJobClusters(boundsParams, zoom);
        
        console.log(`📦 [Clusters API] Response:`, response);
        
        // Response CHỈ chứa clusters: [{ type: 'cluster', count, coordinates, jobIds }]
        if (response && Array.isArray(response)) {
          setClusters(response); // Backend CHỈ trả clusters
          setJobs([]); // KHÔNG có single jobs ở zoom xa
          setTotalJobsInView(response.reduce((sum, c) => sum + c.count, 0));
          console.log(`✅ Loaded ${response.length} clusters with ${response.reduce((sum, c) => sum + c.count, 0)} total jobs`);
        } else {
          console.warn('⚠️ Invalid cluster response format');
          setClusters([]);
          setJobs([]);
          setTotalJobsInView(0);
        }
      } else {
        // ZOOM GẦN: Gọi API CHỈ LẤY JOBS (không có clusters)
        console.log(`📍 Zoom ${zoom} >= ${ZOOM_THRESHOLD}: Fetching ONLY individual jobs...`);
        boundsParams.limit = 50; // Giới hạn 50 jobs
        response = await searchJobsOnMap(boundsParams);
        
        console.log(`📦 [Jobs API] Response:`, response);
        
        // Response CHỈ chứa jobs: { data: [...], meta: {...} }
        if (response && response.data) {
          setClusters([]); // KHÔNG có clusters ở zoom gần
          setJobs(response.data); // Backend CHỈ trả jobs
          setTotalJobsInView(response.meta?.totalItems || response.data.length);
          console.log(`✅ Loaded ${response.data.length} individual jobs`);
        }
      }
    } catch (error) {
      console.error('❌ Error fetching jobs for viewport:', error);
      console.error('❌ [DEBUG] Error details:', error.response?.data);
      const errorMessage = error.response?.data?.message || 'Không thể tải công việc cho khu vực này';
      toast.error(errorMessage);
    } finally {
      setIsLoadingJobs(false);
    }
  }, [searchFilters]);

  /**
   * Handle map move event (debounced)
   */
  const handleMapMove = useCallback((mapState) => {
    console.log('Map moved to:', mapState);
    fetchJobsForViewport(mapState);
  }, [fetchJobsForViewport]);

  /**
   * Manual refresh
   */
  const handleRefresh = () => {
    if (mapRef.current) {
      const map = mapRef.current;
      const bounds = map.getBounds();
      const center = map.getCenter();
      const zoom = map.getZoom();

      handleMapMove({
        bounds: {
          north: bounds.getNorth(),
          south: bounds.getSouth(),
          east: bounds.getEast(),
          west: bounds.getWest(),
        },
        center: {
          lat: center.lat,
          lng: center.lng,
        },
        zoom,
      });
    }
  };

  // Get user coordinates for marker
  const getUserCoords = () => {
    if (!userLocation) return null;
    try {
      const coords = JSON.parse(userLocation);
      if (coords && coords.length === 2) {
        return [coords[1], coords[0]]; // [lat, lng]
      }
    } catch (error) {
      console.error('Failed to parse user location:', error);
    }
    return null;
  };

  // Recenter map to user location
  const handleRecenterToUser = () => {
    const coords = getUserCoords();
    if (coords && mapRef.current) {
      mapRef.current.setView(coords, 13, {
        animate: true,
        duration: 1
      });
    }
  };

  if (initialLoading) {
    return (
      <Card className={cn("h-[700px]", className)}>
        <CardContent className="p-0 h-full flex items-center justify-center">
          <div className="text-center space-y-4">
            <Loader2 className="h-12 w-12 animate-spin text-primary mx-auto" />
            <p className="text-sm text-muted-foreground">Đang tải bản đồ...</p>
          </div>
        </CardContent>
      </Card>
    );
  }

  // Filter jobs with valid coordinates
  // Hỗ trợ 2 format: nested (location.coordinates.coordinates) hoặc flat (coordinates)
  const validJobs = jobs.filter((job) => {
    // Format 1: nested structure từ API thông thường
    if (job.location?.coordinates?.coordinates && 
        Array.isArray(job.location.coordinates.coordinates) &&
        job.location.coordinates.coordinates.length === 2) {
      return true;
    }
    // Format 2: flat structure từ map-search API
    if (job.coordinates && 
        Array.isArray(job.coordinates) && 
        job.coordinates.length === 2) {
      return true;
    }
    return false;
  });

  const userCoords = getUserCoords();

  // Error fallback UI
  if (mapError) {
    return (
      <Card className={cn("h-[700px]", className)}>
        <CardContent className="p-0 h-full flex items-center justify-center">
          <div className="text-center space-y-4 p-8">
            <MapPin className="h-16 w-16 text-muted-foreground mx-auto opacity-50" />
            <div>
              <h3 className="font-semibold text-lg mb-2">Không thể tải bản đồ</h3>
              <p className="text-sm text-muted-foreground mb-4">
                {mapError}
              </p>
              <Button onClick={() => {
                setMapError(null);
                window.location.reload();
              }}>
                <RefreshCw className="h-4 w-4 mr-2" />
                Thử lại
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className={cn(
      "h-[700px] overflow-hidden",
      "border-2 border-border/50 shadow-xl shadow-primary/5",
      "bg-card/95 backdrop-blur-sm",
      className
    )}>
      <CardContent className="p-0 h-full relative">
        {/* Map container */}
        <MapContainer
          center={mapCenter}
          zoom={mapZoom}
          className="h-full w-full rounded-lg"
          ref={mapRef}
          zoomControl={true}
          scrollWheelZoom={true}
          whenReady={() => {
            console.log('✅ Map loaded successfully');
          }}
        >
          {/* OpenStreetMap Tile Layer */}
          <TileLayer
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            maxZoom={19}
          />

          {/* Map Event Handler for viewport-based loading */}
          <MapEventHandler 
            onMapMove={handleMapMove}
            searchFilters={searchFilters}
          />

          {/* User location marker */}
          {userCoords && (
            <Marker position={userCoords} icon={userIcon}>
              <Popup>
                <div className="p-2 text-center">
                  <div className="flex items-center gap-2 mb-1">
                    <Navigation className="h-4 w-4 text-primary" />
                    <span className="font-semibold text-sm">Vị trí của bạn</span>
                  </div>
                  <p className="text-xs text-muted-foreground">
                    {userCoords[0].toFixed(6)}, {userCoords[1].toFixed(6)}
                  </p>
                </div>
              </Popup>
            </Marker>
          )}

          {/* Server-side clusters (when zoom < threshold) */}
          {clusters.length > 0 && clusters.map((cluster, idx) => {
            const [lng, lat] = cluster.coordinates;
            
            // ✅ THỐNG NHẤT: Áp dụng CÙNG logic size với client clusters
            let sizeClass = '';
            let colorClass = '';
            let fontSize = '';
            let iconSize = 40;

            if (cluster.count > 50) {
              sizeClass = 'w-16 h-16'; // 64px - LỚN NHẤT
              colorClass = 'bg-red-500'; // ĐỎ
              fontSize = 'text-lg'; // 18px
              iconSize = 64;
            } else if (cluster.count > 20) {
              sizeClass = 'w-12 h-12'; // 48px - VỪA
              colorClass = 'bg-orange-500'; // CAM
              fontSize = 'text-base'; // 16px
              iconSize = 48;
            } else {
              sizeClass = 'w-10 h-10'; // 40px - NHỎ NHẤT
              colorClass = 'bg-purple-600'; // TÍM (server cluster - phân biệt với client)
              fontSize = 'text-sm'; // 14px
              iconSize = 40;
            }
            
            // Tạo icon cho cluster với số lượng (THỐNG NHẤT với client clusters)
            const clusterIcon = L.divIcon({
              className: 'server-cluster-icon',
              html: `
                <div class="${sizeClass} ${colorClass} ${fontSize} rounded-full flex items-center justify-center text-white font-bold border-4 border-white shadow-lg" style="animation: pulse-cluster 2s infinite; cursor: pointer;">
                  ${cluster.count}
                </div>
                <style>
                  @keyframes pulse-cluster {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                  }
                </style>
              `,
              iconSize: [iconSize, iconSize],
              iconAnchor: [iconSize / 2, iconSize / 2],
            });

            return (
              <Marker
                key={`cluster-${idx}`}
                position={[lat, lng]}
                icon={clusterIcon}
                eventHandlers={{
                  click: (e) => {
                    // Zoom vào cluster khi click
                    const map = mapRef.current;
                    if (map) {
                      map.setView([lat, lng], Math.min(map.getZoom() + 2, 16), {
                        animate: true,
                        duration: 0.5
                      });
                    }
                  }
                }}
              >
                <Popup>
                  <div className="p-3 text-center">
                    <div className="flex items-center gap-2 mb-2 justify-center">
                      <MapPin className="h-5 w-5 text-primary" />
                      <span className="font-bold text-lg">{cluster.count} công việc</span>
                    </div>
                    <p className="text-xs text-muted-foreground mb-2">
                      Click để phóng to và xem chi tiết
                    </p>
                    <Button
                      size="sm"
                      className="btn-gradient text-white w-full"
                      onClick={() => {
                        const map = mapRef.current;
                        if (map) {
                          map.setView([lat, lng], Math.min(map.getZoom() + 2, 16), {
                            animate: true,
                            duration: 0.5
                          });
                        }
                      }}
                    >
                      Xem chi tiết
                    </Button>
                  </div>
                </Popup>
              </Marker>
            );
          })}

          {/* Job markers with clustering - ALWAYS use MarkerClusterGroup for better UX */}
          <MarkerClusterGroup
            chunkedLoading
            maxClusterRadius={60}
            spiderfyOnMaxZoom={true}
            showCoverageOnHover={false}
            zoomToBoundsOnClick={true}
            iconCreateFunction={(cluster) => {
              const count = cluster.getChildCount();
              let sizeClass = '';
              let colorClass = '';
              let fontSize = '';
              let iconSize = 40; // Giá trị mặc định

              // Logic: càng nhiều jobs → càng to + càng đỏ
              if (count > 50) {
                sizeClass = 'w-16 h-16'; // 64px - LỚN NHẤT
                colorClass = 'bg-red-500'; // ĐỎ
                fontSize = 'text-lg'; // 18px
                iconSize = 64; // QUAN TRỌNG: phải khớp với w-16
              } else if (count > 20) {
                sizeClass = 'w-12 h-12'; // 48px - VỪA
                colorClass = 'bg-orange-500'; // CAM
                fontSize = 'text-base'; // 16px
                iconSize = 48; // QUAN TRỌNG: phải khớp với w-12
              } else {
                sizeClass = 'w-10 h-10'; // 40px - NHỎ NHẤT
                colorClass = 'bg-primary'; // XÁM/XANH (primary)
                fontSize = 'text-sm'; // 14px
                iconSize = 40; // QUAN TRỌNG: phải khớp với w-10
              }

              return L.divIcon({
                html: `
                  <div class="${sizeClass} ${colorClass} ${fontSize} rounded-full flex items-center justify-center text-white font-bold border-4 border-white shadow-lg">
                    ${count}
                  </div>
                `,
                className: 'custom-cluster-icon',
                iconSize: L.point(iconSize, iconSize, true), // Động theo size thực tế
              });
            }}
          >
            {validJobs.map((job) => {
              // Lấy coordinates từ nested hoặc flat format
              const coords = job.coordinates || job.location?.coordinates?.coordinates;
              const [lng, lat] = coords;
              return (
                <Marker
                  key={job._id}
                  position={[lat, lng]}
                  icon={createCustomIcon('#FF6B35')}
                >
                  <Popup
                    maxWidth={340}
                    minWidth={320}
                    closeButton={true}
                    className="job-marker-popup"
                  >
                    <JobMarkerPopup job={job} />
                  </Popup>
                </Marker>
              );
            })}
          </MarkerClusterGroup>
        </MapContainer>

        {/* Loading Overlay */}
        {isLoadingJobs && (
          <div className="absolute top-20 left-1/2 -translate-x-1/2 z-[1000]">
            <Badge className="bg-primary/90 text-white px-4 py-2 shadow-lg">
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              Đang tải công việc...
            </Badge>
          </div>
        )}

        {/* Recenter button (floating) */}
        {userCoords && (
          <div className="absolute bottom-6 right-6 z-[1000] flex flex-col gap-2">
            <Button
              onClick={handleRecenterToUser}
              size="icon"
              className={cn(
                "btn-gradient text-white shadow-xl",
                "hover:scale-110 transition-all duration-300",
                "border-2 border-white/20"
              )}
              title="Về vị trí của tôi"
            >
              <Navigation className="h-5 w-5" />
            </Button>
            
            <Button
              onClick={handleRefresh}
              size="icon"
              variant="secondary"
              className={cn(
                "shadow-xl",
                "hover:scale-110 transition-all duration-300",
                "border-2 border-white/20"
              )}
              title="Làm mới khu vực này"
              disabled={isLoadingJobs}
            >
              <RefreshCw className={cn(
                "h-5 w-5",
                isLoadingJobs && "animate-spin"
              )} />
            </Button>
          </div>
        )}

        {/* Job count indicator */}
        <div className="absolute top-4 left-4 z-[1000]">
          <Card className="bg-card/90 backdrop-blur-sm border-2 border-border shadow-lg">
            <CardContent className="p-3 flex items-center gap-2">
              <MapPin className="h-5 w-5 text-primary" />
              <div>
                <p className="text-sm font-semibold text-foreground">
                  {clusters.length > 0 
                    ? `${clusters.reduce((sum, c) => sum + c.count, 0) + validJobs.length} công việc`
                    : `${validJobs.length} công việc`
                  }
                </p>
                <p className="text-xs text-muted-foreground">
                  {clusters.length > 0 
                    ? `${clusters.length} cụm, ${validJobs.length} đơn lẻ`
                    : 'trong khu vực này'
                  }
                </p>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Help text when no filters */}
        {!searchFilters.latitude && !searchFilters.distance && (
          <div className="absolute bottom-6 left-6 z-[1000] max-w-xs">
            <Card className="bg-card/90 backdrop-blur-sm border-2 border-primary/30 shadow-lg">
              <CardContent className="p-3">
                <p className="text-xs text-muted-foreground">
                  💡 <span className="font-semibold">Mẹo:</span> Di chuyển bản đồ để khám phá công việc ở các khu vực khác nhau. Dữ liệu sẽ tự động cập nhật!
                </p>
              </CardContent>
            </Card>
          </div>
        )}
      </CardContent>

      {/* Custom CSS for popup and clustering */}
      <style>{`
        .job-marker-popup .leaflet-popup-content-wrapper {
          padding: 0;
          border-radius: 0.5rem;
          overflow: hidden;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        .job-marker-popup .leaflet-popup-content {
          margin: 0;
          width: 320px !important;
        }
        .job-marker-popup .leaflet-popup-tip {
          background: white;
        }
        .custom-marker {
          background: transparent;
          border: none;
        }
        .user-marker {
          background: transparent;
          border: none;
        }
        .custom-cluster-icon {
          background: transparent;
          border: none;
        }
        .marker-cluster {
          background-color: transparent !important;
        }
      `}</style>
    </Card>
  );
};

export default JobMapView;
</file>

<file path="src/pages/jobs/components/SearchInterface/SearchBar.jsx">
import React, { useRef, useImperativeHandle, forwardRef, useEffect, useState, useCallback } from 'react';
import { Search } from 'lucide-react';
import { useDispatch, useSelector } from 'react-redux';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import SearchHistoryDropdown from '@/components/jobs/SearchHistoryDropdown';
import {
  fetchSearchHistory,
  saveSearchHistory,
  deleteSearchHistory,
  selectSearchHistory
} from '@/redux/searchHistorySlice';
import { getJobTitleSuggestions } from '@/services/jobService';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';

/**
 * Enhanced SearchBar component for the job search page
 * Integrates search history and autocomplete, filter on frontend
 */
const SearchBar = forwardRef(({
  placeholder = "Tìm kiếm công việc, kỹ năng, công ty...",
  initialQuery = "",
  onSearch,
  className,
  inputProps = {}
}, ref) => {
  const dispatch = useDispatch();
  const inputRef = useRef(null);
  const searchHistory = useSelector(selectSearchHistory);

  // State management
  const [query, setQuery] = useState(initialQuery || '');
  const [showDropdown, setShowDropdown] = useState(false);
  const [selectedIndex, setSelectedIndex] = useState(-1);
  const [suggestions, setSuggestions] = useState({
    history: [],
    autocomplete: []
  });
  const [isLoadingAutocomplete, setIsLoadingAutocomplete] = useState(false);

  // Load search history on mount
  useEffect(() => {
    dispatch(fetchSearchHistory({ limit: 10, page: 1 }));
  }, [dispatch]);

  // Set initial value if provided
  useEffect(() => {
    if (initialQuery && initialQuery !== query) {
      setQuery(initialQuery);
    }
  }, [initialQuery]);

  // Effect for history suggestions (no debounce) - Filter on frontend
  useEffect(() => {
    if (query.trim().length > 0) {
      const filteredHistory = Array.isArray(searchHistory)
        ? searchHistory.filter(item => item.query.toLowerCase().includes(query.toLowerCase()))
        : [];
      setSuggestions(prev => ({
        ...prev,
        history: filteredHistory.slice(0, 5)
      }));
    } else {
      // When query is empty, show recent history
      setSuggestions(prev => ({
        ...prev,
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : []
      }));
    }
  }, [query, searchHistory]);

  // Effect for autocomplete suggestions (with debounce)
  useEffect(() => {
    // Clear autocomplete if query is too short
    if (!query || query.trim().length < 2) {
      setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      setIsLoadingAutocomplete(false);
      return;
    }

    // Set loading state immediately
    setIsLoadingAutocomplete(true);

    // Debounce API call
    const timeoutId = setTimeout(async () => {
      try {
        const autocompleteResults = await getJobTitleSuggestions(query, 5).catch(() => ({ data: [] }));
        setSuggestions(prev => ({
          ...prev,
          autocomplete: Array.isArray(autocompleteResults.data) ? autocompleteResults.data : []
        }));
      } catch (error) {
        console.error('Error fetching autocomplete suggestions:', error);
        setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      } finally {
        setIsLoadingAutocomplete(false);
      }
    }, 300); // 300ms debounce delay

    return () => clearTimeout(timeoutId);
  }, [query]);

  /**
   * Handle focus - show history when input is empty
   */
  const handleFocus = useCallback(() => {
    setShowDropdown(true);
    if (!query.trim()) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [query, searchHistory]);

  /**
   * Handle input change
   */
  const handleInputChange = useCallback((value) => {
    setQuery(value);
    setShowDropdown(true);
    if (!value || value.trim().length === 0) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [searchHistory]);

  /**
   * Handle search execution
   * @param {string} searchQuery - The search query to execute
   */
  const handleSearch = useCallback(async (searchQuery = query) => {
    const trimmedQuery = searchQuery.trim();

    setShowDropdown(false);

    // Blur the input to remove focus after search
    if (inputRef.current) {
      inputRef.current.blur();
    }

    // Save to history if not empty
    if (trimmedQuery) {
      try {
        await dispatch(saveSearchHistory({
          query: trimmedQuery
        })).unwrap();
      } catch (error) {
        console.error('Failed to save search history:', error);
      }
    }

    if (onSearch) {
      // Allow empty search to show all jobs
      onSearch(trimmedQuery);
    }
  }, [query, dispatch, onSearch]);

  /**
   * Handle suggestion click
   */
  const handleSuggestionClick = useCallback((suggestion, isHistory) => {
    if (isHistory) {
      // Apply search from history
      setQuery(suggestion.query || '');
      setShowDropdown(false);
      setSelectedIndex(-1);
      handleSearch(suggestion.query || '');
    } else {
      // Just set query for autocomplete
      setQuery(suggestion.title);
      setShowDropdown(false);
      setSelectedIndex(-1);
      handleSearch(suggestion.title);
    }
  }, [handleSearch]);

  /**
   * Handle delete history entry with optimistic update
   */
  const handleDeleteHistory = useCallback(async (e, entryId) => {
    e.stopPropagation();

    // Optimistic update: Xóa ngay trên UI
    setSuggestions(prev => ({
      ...prev,
      history: prev.history.filter(h => h._id !== entryId)
    }));

    try {
      // Gọi API ở background (không cần await)
      dispatch(deleteSearchHistory(entryId));
    } catch (error) {
      // Nếu có lỗi, không cần làm gì vì đã xóa trên UI
      console.error('Error deleting history:', error);
    }
  }, [dispatch]);

  /**
   * Handle keyboard navigation
   */
  const handleKeyDown = useCallback((event) => {
    const totalSuggestions = suggestions.history.length + suggestions.autocomplete.length;

    if (!showDropdown || totalSuggestions === 0) {
      if (event.key === 'Enter') {
        event.preventDefault();
        handleSearch();
      }
      return;
    }

    switch (event.key) {
      case 'ArrowDown':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev < totalSuggestions - 1 ? prev + 1 : 0
        );
        break;

      case 'ArrowUp':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev > 0 ? prev - 1 : totalSuggestions - 1
        );
        break;

      case 'Enter':
        event.preventDefault();
        if (selectedIndex >= 0 && selectedIndex < totalSuggestions) {
          // Determine if it's history or autocomplete
          if (selectedIndex < suggestions.history.length) {
            const selectedSuggestion = suggestions.history[selectedIndex];
            handleSuggestionClick(selectedSuggestion, true);
          } else {
            const autocompleteIndex = selectedIndex - suggestions.history.length;
            const selectedSuggestion = suggestions.autocomplete[autocompleteIndex];
            handleSuggestionClick(selectedSuggestion, false);
          }
        } else {
          handleSearch();
        }
        break;

      case 'Escape':
        event.preventDefault();
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      case 'Tab':
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      default:
        break;
    }
  }, [showDropdown, suggestions, selectedIndex, handleSuggestionClick, handleSearch]);

  const closeDropdown = useCallback(() => {
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, []);

  const clear = useCallback(() => {
    setQuery('');
    setSuggestions({
      history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
      autocomplete: []
    });
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, [searchHistory]);

  /**
   * Handle form submission
   * @param {Event} event - The form submit event
   */
  const handleSubmit = (event) => {
    event.preventDefault();
    handleSearch();
  };

  /**
   * Focus the input
   */
  const focus = () => {
    inputRef.current?.focus();
  };

  /**
   * Expose methods via ref
   */
  useImperativeHandle(ref, () => ({
    focus,
    clear,
    getValue: () => query,
    setValue: handleInputChange
  }));

  return (
    <div className={cn("relative w-full", className)}>
      <form onSubmit={handleSubmit} className="relative flex gap-2">
        <div className="relative flex-1">
          {/* Search Icon */}
          <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-muted-foreground h-5 w-5 z-10" />

          {/* Input Field */}
          <Input
            ref={inputRef}
            type="text"
            placeholder={placeholder}
            value={query}
            onChange={(e) => handleInputChange(e.target.value)}
            onKeyDown={handleKeyDown}
            onFocus={handleFocus}
            className={cn(
              "pl-12 pr-4 h-12 text-base w-full",
              "border-2 border-border focus:border-primary",
              "focus:ring-4 focus:ring-primary/20",
              "bg-background rounded-xl font-medium",
              "placeholder:text-muted-foreground text-foreground",
              "transition-all duration-200",
              showDropdown && "rounded-b-none border-b-0"
            )}
            autoComplete="off"
            role="combobox"
            aria-expanded={showDropdown}
            aria-haspopup="listbox"
            aria-activedescendant={
              selectedIndex >= 0 ? `suggestion-${selectedIndex}` : undefined
            }
            {...inputProps}
          />

          {/* Search History Dropdown */}
          <SearchHistoryDropdown
            historySuggestions={suggestions.history}
            autocompleteSuggestions={suggestions.autocomplete}
            query={query}
            isLoading={isLoadingAutocomplete}
            error={null}
            selectedIndex={selectedIndex}
            isVisible={showDropdown}
            onSuggestionClick={handleSuggestionClick}
            onSuggestionHover={(index) => setSelectedIndex(index)}
            onDeleteHistory={handleDeleteHistory}
            onClose={closeDropdown}
            onRetry={() => { }}
            className={cn(
              // Match input width and positioning
              "absolute top-full left-0 right-0 z-50",
              "border-t-0 rounded-t-none rounded-b-xl",
              "border-2 border-primary focus-within:border-primary"
            )}
          />
        </div>

        {/* Search Button */}
        <Button
          type="submit"
          size="lg"
          className="h-12 px-6 rounded-xl font-medium flex-shrink-0"
          onClick={() => {
            // Blur input when clicking search button
            if (inputRef.current) {
              inputRef.current.blur();
            }
          }}
        >
          <Search className="h-5 w-5 mr-2" />
          Tìm kiếm
        </Button>
      </form>
    </div>
  );
});

SearchBar.displayName = 'SearchBar';

export default SearchBar;
</file>

<file path="src/pages/jobs/components/SearchResults/JobResultsList.jsx">
import React from 'react';
import JobResultCard from './JobResultCard';
import { ErrorState } from '@/components/common/ErrorState';
import { EmptyState } from '@/components/common/EmptyState';
import { Skeleton } from '@/components/ui/skeleton';
import { Card, CardContent } from '@/components/ui/card';
import { cn } from '@/lib/utils';

/**
 * JobResultsList component
 * Handles displaying job results with loading, error, and empty states
 */
const JobResultsList = ({
  jobs = [],
  isLoading = false,
  isError = false,
  error = null,
  onRetry,
  query = '',
  className,
  userLocation,
  searchParameters
}) => {
  /**
   * Render loading skeleton
   */
  const renderLoadingSkeleton = () => {
    return (
      <div className="space-y-6">
        {Array.from({ length: 6 }).map((_, index) => (
          <Card 
            key={index} 
            className={cn(
              "border-2 border-border/50 shadow-lg shadow-primary/5",
              "bg-card/95 backdrop-blur-sm",
              "overflow-hidden relative animate-pulse"
            )}
          >
            {/* Subtle gradient overlay */}
            <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-transparent opacity-50" />
            
            <CardContent className="p-6 relative z-10">
              <div className="flex gap-4">
                {/* Company Logo Skeleton */}
                <Skeleton className={cn(
                  "h-32 w-32 rounded-2xl flex-shrink-0",
                  "bg-gradient-to-br from-primary/20 via-primary/10 to-transparent"
                )} />
                
                <div className="flex-1 space-y-4">
                  {/* Job Title and Company */}
                  <div className="space-y-2">
                    <Skeleton className="h-8 w-3/4 rounded-lg bg-gradient-to-r from-primary/15 to-primary/5" />
                    <Skeleton className="h-5 w-1/2 rounded-lg bg-gradient-to-r from-primary/10 to-transparent" />
                  </div>
                  
                  {/* Badges */}
                  <div className="flex flex-wrap gap-2">
                    <Skeleton className="h-7 w-24 rounded-lg bg-gradient-to-r from-blue-500/15 to-cyan-500/10" />
                    <Skeleton className="h-7 w-28 rounded-lg bg-gradient-to-r from-amber-500/15 to-orange-500/10" />
                    <Skeleton className="h-7 w-32 rounded-lg bg-gradient-to-r from-emerald-500/15 to-green-500/10" />
                    <Skeleton className="h-7 w-28 rounded-lg bg-gradient-to-r from-purple-500/15 to-violet-500/10" />
                  </div>
                  
                  {/* Description */}
                  <div className="space-y-2">
                    <Skeleton className="h-4 w-full rounded bg-gradient-to-r from-primary/10 to-transparent" />
                    <Skeleton className="h-4 w-5/6 rounded bg-gradient-to-r from-primary/10 to-transparent" />
                  </div>
                  
                  {/* Skills badges */}
                  <div className="flex flex-wrap gap-2">
                    <Skeleton className="h-6 w-20 rounded-full bg-gradient-to-r from-primary/15 to-primary/5" />
                    <Skeleton className="h-6 w-24 rounded-full bg-gradient-to-r from-primary/15 to-primary/5" />
                    <Skeleton className="h-6 w-18 rounded-full bg-gradient-to-r from-primary/15 to-primary/5" />
                    <Skeleton className="h-6 w-16 rounded-full bg-gradient-to-r from-primary/15 to-primary/5" />
                  </div>
                  
                  {/* Footer */}
                  <div className="flex justify-between items-center pt-2">
                    <div className="flex gap-4">
                      <Skeleton className="h-4 w-20 rounded bg-gradient-to-r from-primary/10 to-transparent" />
                      <Skeleton className="h-4 w-24 rounded bg-gradient-to-r from-primary/10 to-transparent" />
                    </div>
                    <div className="flex gap-3">
                      <Skeleton className="h-9 w-28 rounded-lg bg-gradient-to-r from-primary/15 to-primary/10" />
                      <Skeleton className="h-9 w-24 rounded-lg bg-gradient-to-r from-primary/20 to-primary/15" />
                    </div>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    );
  };

  /**
   * Render error state
   */
  const renderErrorState = () => {
    const errorMessage = error?.response?.data?.message || 
                        error?.message || 
                        'Có lỗi xảy ra khi tải danh sách việc làm';

    return (
      <ErrorState
        message={errorMessage}
        onRetry={onRetry}
        className="py-12"
      />
    );
  };

  /**
   * Render empty state
   */
  const renderEmptyState = () => {
    if (query) {
      return (
        <EmptyState
          title="Không tìm thấy việc làm nào"
          message={`Không có kết quả phù hợp với từ khóa "${query}". Hãy thử tìm kiếm với từ khóa khác hoặc điều chỉnh bộ lọc.`}
          actionLabel="Xóa bộ lọc"
          onAction={() => {
            // Clear filters functionality would be handled by parent
            window.location.href = '/jobs/search?query=' + encodeURIComponent(query);
          }}
          className="py-12"
        />
      );
    }

    return (
      <EmptyState
        title="Chưa có việc làm nào"
        message="Hiện tại chưa có việc làm nào phù hợp với bộ lọc của bạn. Hãy thử điều chỉnh bộ lọc hoặc quay lại sau."
        actionLabel="Xóa bộ lọc"
        onAction={() => {
          // Clear all filters
          window.location.href = '/jobs/search';
        }}
        className="py-12"
      />
    );
  };

  /**
   * Render job results
   */
  const renderJobResults = () => {
    return (
      <div className="space-y-6">
        {jobs.map((job, index) => (
          <JobResultCard
            key={job.id || job._id || index}
            job={job}
            showSaveButton={true}
            compact={false}
            userLocation={userLocation}
            searchParameters={searchParameters}
          />
        ))}
      </div>
    );
  };

  // Main render logic
  return (
    <div className={cn("", className)}>
      {/* Loading State */}
      {isLoading && renderLoadingSkeleton()}

      {/* Error State */}
      {!isLoading && isError && renderErrorState()}

      {/* Empty State */}
      {!isLoading && !isError && jobs.length === 0 && renderEmptyState()}

      {/* Results */}
      {!isLoading && !isError && jobs.length > 0 && renderJobResults()}
    </div>
  );
};

export default JobResultsList;
</file>

<file path="src/redux/authSlice.js">
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { getMe, getMyProfile } from '../services/profileService';
import { saveAccessToken, clearAccessToken, getAccessToken } from '../utils/token';
import { fetchOnboardingStatus } from './slices/onboardingThunks';

// Async thunk to fetch user data
export const fetchUser = createAsyncThunk('auth/fetchUser', async (_, { rejectWithValue, dispatch }) => {
  const token = getAccessToken();
  if (!token) {
    return rejectWithValue('No token found');
  }
  try {
    const response = await getMe();
    // Fetch onboarding status after successful user fetch
    dispatch(fetchOnboardingStatus());
    // Giả định response.data chứa { user: { ..., coinBalance: 100 }, profile: {...} }
    return response.data;
  } catch (error) {
    clearAccessToken();
    return rejectWithValue(error.response?.data || 'Failed to fetch user');
  }
});

const initialState = {
  user: null,
  isAuthenticated: !!getAccessToken(),
  isInitializing: !!getAccessToken(), // Only initialize if a token exists
  error: null,
};

const authSlice = createSlice({
  name: 'auth',
  initialState,
  reducers: {
    setInitialized: (state) => {
      state.isInitializing = false;
    },
    loginSuccess: (state, action) => {
      const { accessToken } = action.payload;
      saveAccessToken(accessToken);
      state.isAuthenticated = true;
      state.error = null;
      state.isInitializing = false; // On login, initialization is also complete
    },
    logoutSuccess: (state) => {
      clearAccessToken();
      state.user = null;
      state.isAuthenticated = false;
      state.error = null;
      state.isInitializing = false; // On logout, we are also in a stable state
    },
    // Thêm reducer này để cập nhật số dư xu
    updateCoinBalance: (state, action) => {
      if (state.user && state.user.user) {
        state.user.user.coinBalance = action.payload;
      }
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchUser.pending, (state) => {
        state.isInitializing = true;
      })
      .addCase(fetchUser.fulfilled, (state, action) => {
        state.user = action.payload; // The payload is the user object
        state.isAuthenticated = true;
        state.isInitializing = false;
        state.error = null;
      })
      .addCase(fetchUser.rejected, (state, action) => {
        state.user = null;
        state.isAuthenticated = false;
        state.isInitializing = false;
        state.error = action.payload;
      });
  },
});

export const { setInitialized, loginSuccess, logoutSuccess, updateCoinBalance } = authSlice.actions;

export default authSlice.reducer;
</file>

<file path="src/redux/slices/onboardingSlice.js">
import { createSlice } from '@reduxjs/toolkit';

const initialState = {
  currentStep: 1, // Bắt đầu từ step 1 thay vì 0
  completedSteps: [],
  skippedSteps: [],
  isOnboardingComplete: false,
  completionPercentage: 0,
  profileCompleteness: {
    hasBasicInfo: false,
    hasExperience: false,
    hasEducation: false,
    hasSkills: false,
    hasCV: false,
    percentage: 0
  },
  formData: {
    step1: {}, // Basic info
    step2: {}, // Experience
    step3: {}, // Education
    step4: {}, // Skills
    step5: {}  // CV
  },
  isLoading: false,
  error: null,
  lastFetchTime: null, // Track when data was last fetched
  needsOnboarding: false // Track if user needs onboarding
};

const onboardingSlice = createSlice({
  name: 'onboarding',
  initialState,
  reducers: {
    // Set onboarding status from API
    setOnboardingStatus: (state, action) => {
      const { isCompleted, currentStep, completedSteps, skippedSteps, completionPercentage, profileCompleteness } = action.payload;
      state.isOnboardingComplete = isCompleted;
      state.needsOnboarding = !isCompleted;
      state.currentStep = currentStep;
      state.completedSteps = completedSteps;
      state.skippedSteps = skippedSteps;
      state.completionPercentage = completionPercentage;
      state.profileCompleteness = profileCompleteness;
      state.lastFetchTime = Date.now();
      state.error = null;
    },

    // Set current step
    setCurrentStep: (state, action) => {
      state.currentStep = action.payload;
    },

    // Go to next step
    nextStep: (state) => {
      // Cho phép tăng lên 6 để handle logic hoàn thành onboarding
      if (state.currentStep <= 5) {
        state.currentStep += 1;
      }
    },

    // Go to previous step
    previousStep: (state) => {
      if (state.currentStep > 1) {
        state.currentStep -= 1;
      }
    },

    // Mark step as completed
    completeStep: (state, action) => {
      const step = action.payload;
      if (!state.completedSteps.includes(step)) {
        state.completedSteps.push(step);
      }
      // Remove from skipped if it was there
      state.skippedSteps = state.skippedSteps.filter(s => s !== step);

      // Calculate completion percentage
      const totalSteps = 5;
      state.completionPercentage = Math.round((state.completedSteps.length / totalSteps) * 100);
    },

    // Mark step as skipped
    skipStep: (state, action) => {
      const step = action.payload;
      if (!state.skippedSteps.includes(step)) {
        state.skippedSteps.push(step);
      }
    },

    // Update form data for a specific step
    updateStepFormData: (state, action) => {
      const { step, data } = action.payload;
      state.formData[`step${step}`] = { ...state.formData[`step${step}`], ...data };
    },

    // Clear form data for a specific step
    clearStepFormData: (state, action) => {
      const step = action.payload;
      state.formData[`step${step}`] = {};
    },

    // Complete entire onboarding
    completeOnboarding: (state) => {
      state.isOnboardingComplete = true;
      state.currentStep = 5;
    },

    // Skip entire onboarding
    skipAllOnboarding: (state) => {
      state.isOnboardingComplete = true;
      state.currentStep = 5;
      // Mark all uncompleted steps as skipped
      const allSteps = [1, 2, 3, 4, 5];
      state.skippedSteps = allSteps.filter(step => !state.completedSteps.includes(step));
    },

    // Reset onboarding
    resetOnboarding: (state) => {
      return { ...initialState };
    },

    // Set loading state
    setLoading: (state, action) => {
      state.isLoading = action.payload;
    },

    // Set error
    setError: (state, action) => {
      state.error = action.payload;
      state.isLoading = false;
    },

    // Clear error
    clearError: (state) => {
      state.error = null;
    },

    // Update profile completeness
    updateProfileCompleteness: (state, action) => {
      state.profileCompleteness = action.payload;
    }
  }
});

export const {
  setOnboardingStatus,
  setCurrentStep,
  nextStep,
  previousStep,
  completeStep,
  skipStep,
  updateStepFormData,
  clearStepFormData,
  completeOnboarding,
  skipAllOnboarding,
  resetOnboarding,
  setLoading,
  setError,
  clearError,
  updateProfileCompleteness
} = onboardingSlice.actions;

export default onboardingSlice.reducer;
</file>

<file path="src/services/apiClient.js">
import axios from 'axios';
import { getAccessToken, saveAccessToken } from '@/utils/token';

const apiClient = axios.create({
  baseURL:  '/api',
});

const apiRefreshClient = axios.create({
  baseURL:  '/api',
  withCredentials: true,
});

apiClient.interceptors.request.use(
  (config) => {
    const token = getAccessToken();
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

let isRefreshing = false;
let failedQueue = [];

const processQueue = (error, token = null) => {
  failedQueue.forEach(prom => {
    if (error) {
      prom.reject(error);
    } else {
      prom.resolve(token);
    }
  });
  failedQueue = [];
};

apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    if (error.response?.status === 401 && !originalRequest._retry && originalRequest.url !== '/auth/login') {
      if (isRefreshing) {
        return new Promise((resolve, reject) => {
          failedQueue.push({ resolve, reject });
        })
          .then(token => {
            originalRequest.headers['Authorization'] = 'Bearer ' + token;
            return apiClient(originalRequest);
          })
          .catch(err => {
            return Promise.reject(err);
          });
      }

      originalRequest._retry = true;
      isRefreshing = true;

      try {
        const { data } = await apiRefreshClient.post('/auth/refresh');
        const newAccessToken = data.data.accessToken;
        
        saveAccessToken(newAccessToken);
        apiClient.defaults.headers.common['Authorization'] = 'Bearer ' + newAccessToken;
        originalRequest.headers['Authorization'] = 'Bearer ' + newAccessToken;
        
        processQueue(null, newAccessToken);
        return apiClient(originalRequest);
      } catch (refreshError) {
        processQueue(refreshError, null);
        // store.dispatch(logout()); // Let the caller handle logout on critical failure
        return Promise.reject(refreshError);
      } finally {
        isRefreshing = false;
      }
    }

    return Promise.reject(error);
  }
);

// Export cả default và named export để tương thích
export { apiClient };
export default apiClient;
</file>

<file path="src/services/savedJobService.js">
import apiClient from './apiClient';


/**
 * Lưu một công việc
 * @param {string} jobId - ID của công việc cần lưu
 */
export const saveJob = async (jobId) => {
  try {
    const response = await apiClient.post(`/jobs/${jobId}/save`);
    return response;
  } catch (error) {
    console.error('Lỗi khi lưu công việc:', error);
    throw error;
  }
};

/**
 * Bỏ lưu một công việc
 * @param {string} jobId - ID của công việc cần bỏ lưu
 */
export const unsaveJob = async (jobId) => {
  try {
    const response = await apiClient.delete(`/jobs/${jobId}/save`);
    // Xóa cache khi có thay đổi
    return response;
  } catch (error) {
    console.error('Lỗi khi bỏ lưu công việc:', error);
    throw error;
  }
};

/**
 * Lấy danh sách công việc đã lưu
 * @param {object} params - Tham số query
 * @param {number} params.page - Trang hiện tại
 * @param {number} params.limit - Số lượng items mỗi trang
 * @param {string} params.sortBy - Sắp xếp theo
 * @param {string} params.search - Từ khóa tìm kiếm
 */
export const getSavedJobs = async (params = {}) => {
  try {
    const queryParams = {
      page: params.page || 1,
      limit: params.limit || 10,
      sortBy: params.sortBy || 'createdAt:desc',
      ...(params.search && { search: params.search }),
    };

    const response = await apiClient.get('/jobs/saved/list', {
      params: queryParams,
    });

    return response.data;
  } catch (error) {
    console.error('Lỗi khi lấy danh sách công việc đã lưu:', error);
    throw error;
  }
};
</file>

<file path="src/components/common/SearchAutocomplete.jsx">
import React, { useRef, forwardRef, useImperativeHandle, useEffect, useState, useCallback } from 'react';
import { Search } from 'lucide-react';
import { useNavigate } from 'react-router-dom';
import { useDispatch, useSelector } from 'react-redux';
import { Input } from '@/components/ui/input';
import { cn } from '@/lib/utils';
import SearchHistoryDropdown from '@/components/jobs/SearchHistoryDropdown';
import {
  fetchSearchHistory,
  saveSearchHistory,
  deleteSearchHistory,
  selectSearchHistory
} from '@/redux/searchHistorySlice';
import { getJobTitleSuggestions } from '@/services/jobService';
import { toast } from 'sonner';

/**
 * Component tìm kiếm với autocomplete cho job titles
 * Tích hợp search history và autocomplete, filter ở frontend
 * 
 * @param {Object} props
 * @param {string} props.placeholder - Placeholder text cho input
 * @param {string} props.initialValue - Giá trị ban đầu
 * @param {function} props.onSearch - Callback khi search (optional, mặc định là navigate)
 * @param {string} props.className - Additional CSS classes
 * @param {Object} props.inputProps - Additional props cho Input component
 */
const SearchAutocomplete = forwardRef(({
  placeholder = "Vị trí công việc, kỹ năng, công ty...",
  initialValue = "",
  onSearch,
  className,
  inputProps = {}
}, ref) => {
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const inputRef = useRef(null);
  const containerRef = useRef(null);
  const searchHistory = useSelector(selectSearchHistory);

  // State management
  const [query, setQuery] = useState(initialValue || '');
  const [showDropdown, setShowDropdown] = useState(false);
  const [selectedIndex, setSelectedIndex] = useState(-1);
  const [suggestions, setSuggestions] = useState({
    history: [],
    autocomplete: []
  });
  const [isLoadingAutocomplete, setIsLoadingAutocomplete] = useState(false);

  // Load search history on mount
  useEffect(() => {
    dispatch(fetchSearchHistory({ limit: 10, page: 1 }));
  }, [dispatch]);

  // Set initial value if provided
  useEffect(() => {
    if (initialValue && initialValue !== query) {
      setQuery(initialValue);
    }
  }, [initialValue]);

  // Effect for history suggestions (no debounce) - Filter on frontend
  useEffect(() => {
    if (query.trim().length > 0) {
      const filteredHistory = Array.isArray(searchHistory)
        ? searchHistory.filter(item => item.query.toLowerCase().includes(query.toLowerCase()))
        : [];
      setSuggestions(prev => ({
        ...prev,
        history: filteredHistory.slice(0, 5)
      }));
    } else {
      // When query is empty, show recent history
      setSuggestions(prev => ({
        ...prev,
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : []
      }));
    }
  }, [query, searchHistory]);

  // Effect for autocomplete suggestions (with debounce)
  useEffect(() => {
    // Clear autocomplete if query is too short
    if (!query || query.trim().length < 1) {
      setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      setIsLoadingAutocomplete(false);
      return;
    }

    // Set loading state immediately
    setIsLoadingAutocomplete(true);

    // Debounce API call
    const timeoutId = setTimeout(async () => {
      try {
        const autocompleteResults = await getJobTitleSuggestions(query, 5).catch(() => ({ data: [] }));
        setSuggestions(prev => ({
          ...prev,
          autocomplete: Array.isArray(autocompleteResults.data) ? autocompleteResults.data : []
        }));
      } catch (error) {
        console.error('Error fetching autocomplete suggestions:', error);
        setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      } finally {
        setIsLoadingAutocomplete(false);
      }
    }, 300); // 300ms debounce delay

    return () => clearTimeout(timeoutId);
  }, [query]);

  /**
   * Handle focus - show history when input is empty
   */
  const handleFocus = useCallback(() => {
    setShowDropdown(true);
    if (!query.trim()) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [query, searchHistory]);

  /**
   * Handle input change
   */
  const handleInputChange = useCallback((value) => {
    setQuery(value);
    setShowDropdown(true);
    if (!value || value.trim().length === 0) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [searchHistory]);

  /**
   * Xử lý search action - navigate đến trang JobList với query params
   */
  const handleSearch = useCallback(async (searchQuery = query) => {
    const trimmedQuery = searchQuery.trim();
    if (!trimmedQuery) return;

    setShowDropdown(false);

    // Save to history
    try {
      await dispatch(saveSearchHistory({
        query: trimmedQuery
      })).unwrap();
    } catch (error) {
      console.error('Failed to save search history:', error);
    }

    if (onSearch) {
      // Nếu có custom onSearch handler
      onSearch(trimmedQuery, {
        page: 1,
        size: 10,
        query: trimmedQuery
      });
    } else {
      // Mặc định navigate đến /jobs với query parameters
      const searchParams = new URLSearchParams();
      searchParams.set('query', trimmedQuery);
      searchParams.set('page', '1');
      searchParams.set('size', '10');

      navigate(`/jobs?${searchParams.toString()}`);
    }
  }, [query, dispatch, onSearch, navigate]);

  /**
   * Handle suggestion click
   */
  const handleSuggestionClick = useCallback((suggestion, isHistory) => {
    if (isHistory) {
      // Apply search from history
      setQuery(suggestion.query || '');
      setShowDropdown(false);
      setSelectedIndex(-1);
      handleSearch(suggestion.query || '');
    } else {
      // Just set query for autocomplete
      setQuery(suggestion.title);
      setShowDropdown(false);
      setSelectedIndex(-1);
      handleSearch(suggestion.title);
    }
  }, [handleSearch]);

  /**
   * Handle delete history entry with optimistic update
   */
  const handleDeleteHistory = useCallback(async (e, entryId) => {
    e.stopPropagation();

    // Optimistic update: Xóa ngay trên UI
    setSuggestions(prev => ({
      ...prev,
      history: prev.history.filter(h => h._id !== entryId)
    }));

    // Hiển thị toast ngay lập tức
    toast.success('Đã xóa lịch sử tìm kiếm');

    try {
      // Gọi API ở background (không cần await)
      dispatch(deleteSearchHistory(entryId));
    } catch (error) {
      // Nếu có lỗi, không cần làm gì vì đã xóa trên UI
      console.error('Error deleting history:', error);
    }
  }, [dispatch]);

  /**
   * Handle keyboard navigation
   */
  const handleKeyDown = useCallback((event) => {
    const totalSuggestions = suggestions.history.length + suggestions.autocomplete.length;

    if (!showDropdown || totalSuggestions === 0) {
      if (event.key === 'Enter') {
        event.preventDefault();
        handleSearch();
      }
      return;
    }

    switch (event.key) {
      case 'ArrowDown':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev < totalSuggestions - 1 ? prev + 1 : 0
        );
        break;

      case 'ArrowUp':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev > 0 ? prev - 1 : totalSuggestions - 1
        );
        break;

      case 'Enter':
        event.preventDefault();
        if (selectedIndex >= 0 && selectedIndex < totalSuggestions) {
          // Determine if it's history or autocomplete
          if (selectedIndex < suggestions.history.length) {
            const selectedSuggestion = suggestions.history[selectedIndex];
            handleSuggestionClick(selectedSuggestion, true);
          } else {
            const autocompleteIndex = selectedIndex - suggestions.history.length;
            const selectedSuggestion = suggestions.autocomplete[autocompleteIndex];
            handleSuggestionClick(selectedSuggestion, false);
          }
        } else {
          handleSearch();
        }
        break;

      case 'Escape':
        event.preventDefault();
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      case 'Tab':
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      default:
        break;
    }
  }, [showDropdown, suggestions, selectedIndex, handleSuggestionClick, handleSearch]);

  const closeDropdown = useCallback(() => {
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, []);

  const clear = useCallback(() => {
    setQuery('');
    setSuggestions({
      history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
      autocomplete: []
    });
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, [searchHistory]);

  /**
   * Focus vào input
   */
  const focus = () => {
    inputRef.current?.focus();
  };

  /**
   * Expose methods qua ref
   */
  useImperativeHandle(ref, () => ({
    focus,
    clear,
    getValue: () => query,
    setValue: handleInputChange
  }));

  return (
    <div ref={containerRef} className={cn("relative w-full", className)}>
      <div className="relative">
        {/* Search Icon */}
        <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-muted-foreground h-5 w-5 z-10" />

        {/* Input Field */}
        <Input
          ref={inputRef}
          type="text"
          placeholder={placeholder}
          value={query}
          onChange={(e) => handleInputChange(e.target.value)}
          onKeyDown={handleKeyDown}
          onFocus={handleFocus}
          className={cn(
            "pl-12 pr-4 h-12 text-base",
            "border-2 border-border focus:border-primary",
            "focus:ring-4 focus:ring-primary/20",
            "bg-background rounded-xl font-medium",
            "placeholder:text-muted-foreground text-foreground",
            "transition-all duration-200",
            showDropdown && "rounded-b-none border-b-0"
          )}
          autoComplete="off"
          role="combobox"
          aria-expanded={showDropdown}
          aria-haspopup="listbox"
          aria-activedescendant={
            selectedIndex >= 0 ? `suggestion-${selectedIndex}` : undefined
          }
          {...inputProps}
        />

        {/* Search History Dropdown */}
        <SearchHistoryDropdown
          historySuggestions={suggestions.history}
          autocompleteSuggestions={suggestions.autocomplete}
          query={query}
          isLoading={isLoadingAutocomplete}
          error={null}
          selectedIndex={selectedIndex}
          isVisible={showDropdown}
          onSuggestionClick={handleSuggestionClick}
          onSuggestionHover={(index) => setSelectedIndex(index)}
          onDeleteHistory={handleDeleteHistory}
          onClose={closeDropdown}
          onRetry={() => { }}
          className={cn(
            "absolute top-full left-0 z-50 w-full",
            "border-t-0 rounded-t-none rounded-b-xl",
            "border-2 border-primary focus-within:border-primary",
            "shadow-lg shadow-primary/20"
          )}
        />
      </div>
    </div>
  );
});

SearchAutocomplete.displayName = 'SearchAutocomplete';

export default SearchAutocomplete;
</file>

<file path="src/components/CVPreview/CVPreview.jsx">
import React from 'react';
import PaginatedCVPreview from './PaginatedCVPreview';

/**
 * CVPreview Component
 * Main entry point for CV preview with automatic pagination
 */
const CVPreview = React.forwardRef(({ cvData, template, className = '' }, ref) => {
  // Ensure sectionOrder exists for backward compatibility
  const sectionOrder = cvData.sectionOrder || ['summary', 'experience', 'education', 'skills', 'projects', 'certificates'];
  const hiddenSections = cvData.hiddenSections || [];
  
  // Filter out hidden sections from sectionOrder
  const visibleSectionOrder = sectionOrder.filter(section => !hiddenSections.includes(section));
  
  // Create ordered CV data based on sectionOrder and hiddenSections
  const orderedCVData = {
    ...cvData,
    sectionOrder: visibleSectionOrder,
    hiddenSections,
    // Use the template prop if provided, otherwise fall back to cvData.template
    template: template || cvData.template || 'modern-blue'
  };

  return (
    <PaginatedCVPreview
      ref={ref}
      cvData={orderedCVData}
      className={className}
    />
  );
});

CVPreview.displayName = 'CVPreview';

export default CVPreview;
</file>

<file path="src/pages/jobs/Applications.jsx">
import React from 'react';
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';
import { Button } from '../../components/ui/button';
import { Badge } from '../../components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '../../components/ui/avatar';
import { Skeleton } from '../../components/ui/skeleton';
import { Separator } from '../../components/ui/separator';
import {
  FileText,
  Calendar,
  Building,
  Clock,
  Eye,
  CheckCircle,
  XCircle,
  AlertCircle,
  Hourglass,
  ExternalLink,
  ArrowLeft,
  Download,
  User,
} from 'lucide-react';
import { getMyApplications } from '../../services/jobService';
import { ErrorState } from '../../components/common/ErrorState';
import { cn } from '../../lib/utils';

/**
 * Component hiển thị danh sách đơn ứng tuyển của người dùng
 */
const Applications = () => {
  const navigate = useNavigate();
  const [currentPage, setCurrentPage] = useState(1);
  const [selectedStatus, setSelectedStatus] = useState('all');
  const limit = 9;

  // Query để lấy danh sách đơn ứng tuyển
  const { 
    data: applicationsData, 
    isLoading, 
    isError, 
    error,
    refetch 
  } = useQuery({
    queryKey: ['myApplications', currentPage, selectedStatus],
    queryFn: () => getMyApplications({ 
      page: currentPage, 
      limit,
      status: selectedStatus === 'all' ? undefined : selectedStatus
    }),
    staleTime: 5 * 60 * 1000, // 5 minutes
  });

  const applications = applicationsData?.data || [];
  const meta = applicationsData?.meta || {};
  const totalPages = meta.totalPages || 1;
  const totalItems = meta.totalItems || 0;

  // Helper functions
  const getStatusInfo = (status) => {
    const statusMap = {
      'PENDING': {
        label: 'Đang chờ',
        variant: 'secondary',
        icon: <Hourglass className="h-4 w-4" />,
        bgColor: 'bg-yellow-50',
        textColor: 'text-yellow-700',
        borderColor: 'border-yellow-200'
      },
      'REVIEWING': {
        label: 'Đang xem xét',
        variant: 'outline',
        icon: <Eye className="h-4 w-4" />,
        bgColor: 'bg-blue-50',
        textColor: 'text-blue-700',
        borderColor: 'border-blue-200'
      },
      'INTERVIEW': {
        label: 'Phỏng vấn',
        variant: 'default',
        icon: <AlertCircle className="h-4 w-4" />,
        bgColor: 'bg-purple-50',
        textColor: 'text-purple-700',
        borderColor: 'border-purple-200'
      },
      'ACCEPTED': {
        label: 'Đã chấp nhận',
        variant: 'secondary',
        icon: <CheckCircle className="h-4 w-4" />,
        bgColor: 'bg-green-50',
        textColor: 'text-green-700',
        borderColor: 'border-green-200'
      },
      'REJECTED': {
        label: 'Đã từ chối',
        variant: 'destructive',
        icon: <XCircle className="h-4 w-4" />,
        bgColor: 'bg-red-50',
        textColor: 'text-red-700',
        borderColor: 'border-red-200'
      }
    };
    return statusMap[status] || statusMap['PENDING'];
  };

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('vi-VN', {
      day: '2-digit',
      month: '2-digit', 
      year: 'numeric'
    });
  };


  const handlePageChange = (newPage) => {
    if (newPage >= 1 && newPage <= totalPages && newPage !== currentPage) {
      setCurrentPage(newPage);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  };


  const handleDownloadCV = (cvUrl) => {
    window.open(cvUrl, '_blank');
  };

  const handleViewDetail = (application) => {
    navigate(`/dashboard/applications/${application._id}`, { state: { application } });
  };

  // Component Skeleton
  const ApplicationSkeleton = () => (
    <Card className="mb-4">
      <CardContent className="p-6">
        <div className="flex items-start space-x-4">
          <Skeleton className="h-12 w-12 rounded-full" />
          <div className="flex-1 space-y-3">
            <div className="flex items-start justify-between">
              <div className="space-y-2">
                <Skeleton className="h-5 w-64" />
                <Skeleton className="h-4 w-48" />
              </div>
              <Skeleton className="h-6 w-20" />
            </div>
            <div className="flex items-center space-x-4">
              <Skeleton className="h-4 w-32" />
              <Skeleton className="h-4 w-24" />
              <Skeleton className="h-4 w-28" />
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  );


  // Render loading state
  if (isLoading) {
    return (
      <div className="min-h-screen">
        <div className="container mx-auto px-4 py-6 space-y-6">
          <div className="flex items-center justify-between">
            <Skeleton className="h-8 w-64" />
            <Skeleton className="h-10 w-32" />
          </div>
          {Array.from({ length: 5 }).map((_, index) => (
            <ApplicationSkeleton key={index} />
          ))}
        </div>
      </div>
    );
  }

  // Render error state
  if (isError) {
    const errorMessage = error.response?.data?.message || error.message;
    return (
      <div className="min-h-screen">
        <div className="container mx-auto px-4 py-6">
          <ErrorState onRetry={refetch} message={errorMessage} />
        </div>
      </div>
    );
  }

  // Render empty state
  if (!applications.length) {
    return (
      <div className="min-h-screen">
        <div className="container mx-auto px-4 py-6">
          <div className="text-center py-12">
            <FileText className="h-16 w-16 text-gray-400 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900 mb-2">
              Chưa có đơn ứng tuyển nào
            </h3>
            <p className="text-gray-600 mb-6">
              Bạn chưa ứng tuyển vào công việc nào. Hãy khám phá các cơ hội nghề nghiệp!
            </p>
            <Button onClick={() => navigate('/jobs')} className="bg-green-600 hover:bg-green-700">
              <ExternalLink className="h-4 w-4 mr-2" />
              Tìm việc làm
            </Button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen">
      <div className="container mx-auto px-4 py-6 space-y-6">
        {/* Header */}
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">Đơn ứng tuyển của tôi</h1>
            <p className="text-gray-600">
              Theo dõi trạng thái {totalItems} đơn ứng tuyển của bạn
            </p>
          </div>
        
        <Button 
          variant="outline" 
          onClick={() => navigate('/dashboard')}
          className="w-fit border-gray-300 hover:bg-gray-50"
        >
          <ArrowLeft className="h-4 w-4 mr-2" />
          Quay lại Dashboard
        </Button>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
        {[
          { label: 'Tổng số đơn', value: 'all', count: totalItems, icon: FileText, color: 'text-blue-600' },
          {
            label: 'Đang chờ',
            value: 'PENDING',
            count: applications.filter(app => app.status === 'PENDING').length,
            icon: Hourglass,
            color: 'text-yellow-600'
          },
          {
            label: 'Đang xem xét',
            value: 'REVIEWING',
            count: applications.filter(app => app.status === 'REVIEWING').length,
            icon: Eye,
            color: 'text-purple-600'
          },
          {
            label: 'Đã chấp nhận',
            value: 'ACCEPTED',
            count: applications.filter(app => app.status === 'ACCEPTED').length,
            icon: CheckCircle,
            color: 'text-green-600'
          }
        ].map((stat, index) => (
          <Card
            key={index}
            className={cn(
              "bg-white border border-gray-200 transition-all cursor-pointer",
              selectedStatus === stat.value ? "ring-2 ring-green-500 shadow-lg" : "hover:shadow-md"
            )}
            onClick={() => setSelectedStatus(stat.value)}
          >
            <CardContent className="p-4">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-gray-600">{stat.label}</p>
                  <p className="text-2xl font-bold text-gray-900">{stat.count}</p>
                </div>
                <stat.icon className={cn("h-8 w-8", stat.color)} />
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Applications List */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {applications.map((application) => {
          const statusInfo = getStatusInfo(application.status);

          return (
            <Card 
              key={application._id} 
              className={cn(
                "group relative overflow-hidden rounded-2xl border transition-all duration-300 hover:shadow-xl cursor-pointer bg-white",
                statusInfo.bgColor,
                statusInfo.borderColor
              )}
              onClick={() => handleViewDetail(application)}
            >
              {/* Hiệu ứng highlight khi hover */}
              <div className="absolute inset-0 bg-linear-to-r from-transparent via-green-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
              
              <CardContent className="relative p-6">
                <div className="flex items-start space-x-4">
                  {/* Logo công ty trong vòng tròn có shadow */}
                  <Avatar className="h-14 w-14 shadow-md ring-2 ring-gray-200">
                    <AvatarImage 
                      src={application.jobSnapshot?.logo} 
                      alt={application.jobSnapshot?.company} 
                    />
                    <AvatarFallback className="bg-green-100 text-green-600 font-bold">
                      {application.jobSnapshot?.company?.charAt(0) || 'C'}
                    </AvatarFallback>
                  </Avatar>

                  <div className="flex-1 min-w-0">
                    {/* Header */}
                    <div className="flex items-start justify-between mb-3">
                      <div className="min-w-0 flex-1">
                        <h3 className="text-lg font-semibold text-gray-900 truncate group-hover:text-green-600 transition-colors">
                          {application.jobSnapshot?.title}
                        </h3>
                        <p className="text-sm text-gray-600 flex items-center">
                          <Building className="h-4 w-4 mr-1" />
                          {application.jobSnapshot?.company}
                        </p>
                      </div>

                      {/* Badge tròn đẹp hơn */}
                      <Badge 
                        variant="outline" 
                        className={cn(
                          "flex items-center gap-1 px-3 py-1.5 rounded-full shadow-sm font-medium",
                          statusInfo.textColor,
                          statusInfo.borderColor,
                          "bg-white/70 backdrop-blur-sm"
                        )}
                      >
                        {statusInfo.icon}
                        {statusInfo.label}
                      </Badge>
                    </div>

                    {/* Info */}
                    <div className="grid grid-cols-1 gap-2 text-sm text-gray-600 mb-4">
                      <div className="flex items-center">
                        <User className="h-4 w-4 mr-2 text-green-600" />
                        <span className="truncate">{application.candidateName}</span>
                      </div>
                      
                      <div className="flex items-center">
                        <Calendar className="h-4 w-4 mr-2 text-green-600" />
                        <span>Ứng tuyển: {formatDate(application.appliedAt)}</span>
                      </div>
                    </div>

                    {/* Cover Letter Preview */}
                    {application.coverLetter && (
                      <div className="mb-4">
                        <div className="bg-gray-50 p-3 rounded-md border border-gray-200">
                          <p className="text-sm text-gray-600 line-clamp-2 italic">
                            "{application.coverLetter}"
                          </p>
                        </div>
                      </div>
                    )}

                    <Separator className="my-3" />

                    {/* Actions */}
                    <div className="flex items-center justify-between">
                      <div className="flex items-center text-xs text-gray-600">
                        <Clock className="h-3 w-3 mr-1 text-green-600" />
                        <span>{formatDate(application.lastStatusUpdateAt)}</span>
                      </div>

                      <div className="flex items-center gap-2">
                        {application.submittedCV && (
                          <Button 
                            variant="secondary" 
                            size="sm"
                            onClick={(e) => {
                              e.stopPropagation();
                              handleDownloadCV(application.submittedCV.path);
                            }}
                            className="text-xs rounded-full shadow-sm bg-gray-100 hover:bg-gray-200"
                          >
                            <Download className="h-3 w-3 mr-1" />
                            CV
                          </Button>
                        )}

                        <Button 
                          variant="default" 
                          size="sm"
                          onClick={(e) => {
                            e.stopPropagation();
                            handleViewDetail(application)
                          }}
                          className="rounded-full bg-green-600 hover:bg-green-700"
                        >
                          Chi tiết
                          <Eye className="h-4 w-4 ml-1" />
                        </Button>
                      </div>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          );
        })}
      </div>

      {/* Pagination */}
      {totalPages > 1 && (
        <div className="flex items-center justify-center mt-6 gap-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => handlePageChange(currentPage - 1)}
            disabled={currentPage <= 1}
            className="border-gray-300 hover:bg-gray-50"
          >
            Trước
          </Button>

          {/* Hiển thị tối đa 5 trang, có "..." nếu nhiều */}
          {Array.from({ length: totalPages }, (_, i) => i + 1)
            .filter(page => 
              page === 1 || 
              page === totalPages || 
              (page >= currentPage - 1 && page <= currentPage + 1)
            )
            .map((page, index, arr) => {
              const prevPage = arr[index - 1];
              const showDots = prevPage && page - prevPage > 1;

              return (
                <React.Fragment key={page}>
                  {showDots && <span className="px-2">...</span>}
                  <Button
                    variant={currentPage === page ? "default" : "outline"}
                    size="sm"
                    onClick={() => handlePageChange(page)}
                    className={cn(
                      "w-8 h-8 p-0",
                      currentPage === page 
                        ? "bg-green-600 hover:bg-green-700" 
                        : "border-gray-300 hover:bg-gray-50"
                    )}
                  >
                    {page}
                  </Button>
                </React.Fragment>
              );
            })}

          <Button
            variant="outline"
            size="sm"
            onClick={() => handlePageChange(currentPage + 1)}
            disabled={currentPage >= totalPages}
            className="border-gray-300 hover:bg-gray-50"
          >
            Sau
          </Button>
        </div>
      )}

      </div>
    </div>
  );
};

export default Applications;
</file>

<file path="src/pages/news/News.jsx">
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { Button } from '../../components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';
import { Input } from '../../components/ui/input';
import { Badge } from '../../components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '../../components/ui/avatar';
import { Skeleton } from '../../components/ui/skeleton';
import { 
  Search, 
  Calendar, 
  Clock, 
  Eye, 
  User, 
  ChevronRight,
  TrendingUp,
  Filter,
  Newspaper,
  Star,
  BookOpen,
  GraduationCap,
  Award,
  Target,
  Users,
  Briefcase,
  FileText,
  MessageSquare,
  Calculator,
  CheckCircle,
  ArrowRight,
  Sparkles,
  DollarSign
} from 'lucide-react';
import { cn } from '../../lib/utils';

const News = () => {
  const navigate = useNavigate();
  const [searchParams, setSearchParams] = useSearchParams();
  
  // States
  const [news, setNews] = useState([]);
  const [featuredNews, setFeaturedNews] = useState([]);
  const [careerGuides, setCareerGuides] = useState([]);
  const [featuredGuides, setFeaturedGuides] = useState([]);
  const [categories, setCategories] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState(searchParams.get('search') || '');
  const [selectedCategory, setSelectedCategory] = useState(searchParams.get('category') || 'all');
  const [activeTab, setActiveTab] = useState(searchParams.get('tab') || 'news');
  const [currentPage, setCurrentPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);

  // Mock data cho News - giữ nguyên như cũ
  const mockNews = [
    {
      id: 1,
      title: 'Xu hướng tuyển dụng IT 2024: Những kỹ năng được săn đón nhất',
      excerpt: 'Phân tích chi tiết về những xu hướng tuyển dụng mới nhất trong ngành công nghệ thông tin và những kỹ năng cần thiết...',
      content: 'Nội dung đầy đủ bài viết...',
      coverImage: 'https://images.unsplash.com/photo-1551434678-e076c223a692?w=400',
      category: 'Công nghệ',
      categorySlug: 'technology',
      author: {
        name: 'Nguyễn Văn An',
        avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100',
        role: 'Senior HR Manager'
      },
      publishedAt: '2024-01-15T10:00:00Z',
      readTime: '5 phút đọc',
      views: 1250,
      isFeatured: true,
      tags: ['IT', 'Tuyển dụng', 'Kỹ năng', '2024']
    },
    {
      id: 2,
      title: 'Cách viết CV ấn tượng để thu hút nhà tuyển dụng',
      excerpt: 'Hướng dẫn chi tiết cách tạo một bản CV chuyên nghiệp, nổi bật và thu hút được sự chú ý của nhà tuyển dụng...',
      content: 'Nội dung đầy đủ bài viết...',
      coverImage: 'https://images.unsplash.com/photo-1586281380349-632531db7ed4?w=400',
      category: 'Nghề nghiệp',
      categorySlug: 'career',
      author: {
        name: 'Trần Thị Bình',
        avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100',
        role: 'Career Coach'
      },
      publishedAt: '2024-01-12T14:30:00Z',
      readTime: '7 phút đọc',
      views: 980,
      isFeatured: true,
      tags: ['CV', 'Tuyển dụng', 'Nghề nghiệp']
    },
    {
      id: 3,
      title: 'Lương thưởng trong ngành Marketing: Cập nhật mức lương 2024',
      excerpt: 'Báo cáo về mức lương trung bình, thưởng và phúc lợi trong ngành Marketing tại Việt Nam năm 2024...',
      content: 'Nội dung đầy đủ bài viết...',
      coverImage: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400',
      category: 'Lương thưởng',
      categorySlug: 'salary',
      author: {
        name: 'Lê Minh Cường',
        avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100',
        role: 'Marketing Director'
      },
      publishedAt: '2024-01-10T09:15:00Z',
      readTime: '6 phút đọc',
      views: 1450,
      isFeatured: false,
      tags: ['Marketing', 'Lương', 'Báo cáo']
    },
    {
      id: 4,
      title: 'Kinh nghiệm phỏng vấn online: Những điều cần lưu ý',
      excerpt: 'Chia sẻ kinh nghiệm và mẹo hữu ích để có buổi phỏng vấn online thành công và chuyên nghiệp...',
      content: 'Nội dung đầy đủ bài viết...',
      coverImage: 'https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=400',
      category: 'Nghề nghiệp',
      categorySlug: 'career',
      author: {
        name: 'Phạm Thị Dung',
        avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100',
        role: 'HR Specialist'
      },
      publishedAt: '2024-01-08T16:20:00Z',
      readTime: '4 phút đọc',
      views: 890,
      isFeatured: false,
      tags: ['Phỏng vấn', 'Online', 'Kinh nghiệm']
    }
  ];

  // Mock data cho Career Guides - mới thêm
  const mockCareerGuides = [
    {
      id: 1,
      title: 'Nhân viên bán hàng là gì? Bảng mô tả công việc nhân viên bán hàng',
      excerpt: 'Nhân viên bán hàng là một nghề "đẻ ra khó" đang cực kỳ được nhiều người quan tâm theo...',
      content: 'Nội dung đầy đủ hướng dẫn...',
      coverImage: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=400',
      category: 'Bán hàng',
      categorySlug: 'sales',
      difficulty: 'Cơ bản',
      author: {
        name: 'TopCV',
        avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100',
        role: 'Career Expert'
      },
      publishedAt: '2024-06-27T10:00:00Z',
      readTime: '5 phút đọc',
      views: 1250,
      isFeatured: true,
      tags: ['Bán hàng', 'Nhân viên', 'Mô tả công việc'],
      rating: 4.8
    },
    {
      id: 2,
      title: 'Telesales là gì? Những công việc Telesales HOT nhất bạn cần biết',
      excerpt: 'Nhắc tới công việc Telesales, không ít người gần ngay cho nghề này "cái mác" gọi điện...',
      content: 'Nội dung đầy đủ hướng dẫn...',
      coverImage: 'https://images.unsplash.com/photo-1423666639041-f56000c27a9a?w=400',
      category: 'Telesales',
      categorySlug: 'telesales',
      difficulty: 'Trung bình',
      author: {
        name: 'TopCV',
        avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=100',
        role: 'Sales Expert'
      },
      publishedAt: '2024-06-02T14:30:00Z',
      readTime: '7 phút đọc',
      views: 980,
      isFeatured: true,
      tags: ['Telesales', 'Bán hàng qua điện thoại', 'Kỹ năng'],
      rating: 4.6
    },
    {
      id: 3,
      title: 'Các chức danh CEO, CFO, CPO, CCO, CHRO, CMO là gì?',
      excerpt: 'Tại các doanh nghiệp hiện nay, bạn sẽ thường bắt gặp các chức ngữ như CEO, CFO, CPO...',
      content: 'Nội dung đầy đủ hướng dẫn...',
      coverImage: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400',
      category: 'Quản lý',
      categorySlug: 'management',
      difficulty: 'Nâng cao',
      author: {
        name: 'TopCV',
        avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100',
        role: 'Business Expert'
      },
      publishedAt: '2024-06-02T09:15:00Z',
      readTime: '6 phút đọc',
      views: 1450,
      isFeatured: false,
      tags: ['CEO', 'CFO', 'Quản lý', 'Chức danh'],
      rating: 4.9
    },
    {
      id: 4,
      title: 'Ngành Logistics là gì? TOP 11 vị trí công việc ngành Logistics',
      excerpt: 'Trong bối cảnh nền kinh tế cạnh tranh mở rộng và phát triển, ngành Logistics...',
      content: 'Nội dung đầy đủ hướng dẫn...',
      coverImage: 'https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=400',
      category: 'Logistics',
      categorySlug: 'logistics',
      difficulty: 'Trung bình',
      author: {
        name: 'TopCV',
        avatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100',
        role: 'Industry Expert'
      },
      publishedAt: '2024-05-30T16:20:00Z',
      readTime: '8 phút đọc',
      views: 890,
      isFeatured: false,
      tags: ['Logistics', 'Vận chuyển', 'Chuỗi cung ứng'],
      rating: 4.7
    },
    {
      id: 5,
      title: 'Tổng hợp 10 việc làm tiếng Anh siêu HOT cho dân ngoại ngữ',
      excerpt: 'Với xu thế hội nhập như hiện nay, nhu cầu về việc làm cần tiếng Anh của các doanh nghiệp ngày càng cao.',
      content: 'Nội dung đầy đủ hướng dẫn...',
      coverImage: 'https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=400',
      category: 'Ngoại ngữ',
      categorySlug: 'language',
      difficulty: 'Trung bình',
      author: {
        name: 'TopCV',
        avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100',
        role: 'Language Expert'
      },
      publishedAt: '2024-06-02T11:00:00Z',
      readTime: '6 phút đọc',
      views: 1120,
      isFeatured: true,
      tags: ['Tiếng Anh', 'Ngoại ngữ', 'Việc làm'],
      rating: 4.8
    }
  ];

  // Categories cho cả News và Career Guides
  const newsCategories = [
    { id: 'all', name: 'Tất cả', count: 12, color: 'bg-green-600' },
    { id: 'technology', name: 'Công nghệ', count: 5, color: 'bg-blue-500' },
    { id: 'career', name: 'Nghề nghiệp', count: 4, color: 'bg-green-500' },
    { id: 'salary', name: 'Lương thưởng', count: 2, color: 'bg-purple-500' },
    { id: 'interview', name: 'Phỏng vấn', count: 1, color: 'bg-orange-500' }
  ];

  const guideCategories = [
    { id: 'all', name: 'Tất cả', count: 25, color: 'bg-green-600', icon: BookOpen },
    { id: 'sales', name: 'Bán hàng', count: 8, color: 'bg-blue-500', icon: TrendingUp },
    { id: 'telesales', name: 'Telesales', count: 5, color: 'bg-purple-500', icon: Users },
    { id: 'management', name: 'Quản lý', count: 6, color: 'bg-orange-500', icon: Target },
    { id: 'logistics', name: 'Logistics', count: 4, color: 'bg-green-500', icon: Briefcase },
    { id: 'language', name: 'Ngoại ngữ', count: 2, color: 'bg-pink-500', icon: GraduationCap }
  ];

  const difficultyColors = {
    'Cơ bản': 'bg-green-100 text-green-700 border-green-200',
    'Trung bình': 'bg-yellow-100 text-yellow-700 border-yellow-200',
    'Nâng cao': 'bg-red-100 text-red-700 border-red-200'
  };

  // Helper functions
  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('vi-VN', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  };

  const timeAgo = (dateString) => {
    const now = new Date();
    const date = new Date(dateString);
    const diffInMs = now - date;
    const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));
    
    if (diffInDays === 0) return 'Hôm nay';
    if (diffInDays === 1) return 'Hôm qua';
    if (diffInDays < 7) return `${diffInDays} ngày trước`;
    return formatDate(dateString);
  };

  const renderStars = (rating) => {
    return [...Array(5)].map((_, index) => (
      <Star 
        key={index} 
        className={cn(
          "h-3 w-3",
          index < Math.floor(rating) ? "text-yellow-400 fill-current" : "text-gray-300"
        )}
      />
    ));
  };

  // Effects
  useEffect(() => {
    fetchContent();
    setCategories(activeTab === 'news' ? newsCategories : guideCategories);
  }, [selectedCategory, searchTerm, currentPage, activeTab]);

  const fetchContent = async () => {
    setIsLoading(true);
    
  // Simulate API call
    const isNewsTab = activeTab === 'news';
    const sourceData = isNewsTab ? mockNews : mockCareerGuides;
    let filteredData = sourceData;
    
    // Filter by category
    if (selectedCategory !== 'all') {
      filteredData = filteredData.filter(item => item.categorySlug === selectedCategory);
    }
    
    // Filter by search term
    if (searchTerm) {
      filteredData = filteredData.filter(item => 
        item.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
        item.excerpt.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    
    if (isNewsTab) {
      setNews(filteredData);
      setFeaturedNews(filteredData.filter(item => item.isFeatured));
    } else {
      setCareerGuides(filteredData);
      setFeaturedGuides(filteredData.filter(item => item.isFeatured));
    }
    
    setTotalPages(Math.ceil(filteredData.length / 6));
    setIsLoading(false);

  };

  const handleSearch = (value) => {
    setSearchTerm(value);
    const params = new URLSearchParams(searchParams);
    if (value) {
      params.set('search', value);
    } else {
      params.delete('search');
    }
    setSearchParams(params);
    setCurrentPage(1);
  };

  const handleCategoryChange = (category) => {
    setSelectedCategory(category);
    const params = new URLSearchParams(searchParams);
    if (category !== 'all') {
      params.set('category', category);
    } else {
      params.delete('category');
    }
    setSearchParams(params);
    setCurrentPage(1);
  };

  const handleTabChange = (tab) => {
    setActiveTab(tab);
    const params = new URLSearchParams(searchParams);
    params.set('tab', tab);
    setSearchParams(params);
    setSelectedCategory('all');
    setCurrentPage(1);
  };

  const handleReadArticle = (articleId) => {
    const route = activeTab === 'news' ? `/news/${articleId}` : `/career-guide/${articleId}`;
    navigate(route);
  };

  if (isLoading) {
    return (
      <div className="min-h-screen">
        <div className="container mx-auto px-4 py-8">
          <div className="max-w-6xl mx-auto space-y-8">
            {/* Header Skeleton */}
            <div className="text-center space-y-4">
              <Skeleton className="h-12 w-64 mx-auto" />
              <Skeleton className="h-6 w-96 mx-auto" />
            </div>
            
            {/* Tabs Skeleton */}
            <div className="flex justify-center">
              <Skeleton className="h-12 w-80" />
            </div>
            
            {/* Search Skeleton */}
            <Skeleton className="h-12 w-full max-w-md mx-auto" />
            
            {/* Categories Skeleton */}
            <div className="flex flex-wrap justify-center gap-3">
              {[...Array(6)].map((_, i) => (
                <Skeleton key={i} className="h-10 w-24" />
              ))}
            </div>
            
            {/* Content Grid Skeleton */}
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {[...Array(6)].map((_, i) => (
                <Card key={i} className="overflow-hidden">
                  <Skeleton className="h-48 w-full" />
                  <CardContent className="p-4 space-y-3">
                    <Skeleton className="h-6 w-full" />
                    <Skeleton className="h-4 w-3/4" />
                    <div className="flex items-center gap-2">
                      <Skeleton className="h-8 w-8 rounded-full" />
                      <Skeleton className="h-4 w-20" />
                    </div>
                  </CardContent>
                </Card>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  }

  const isNewsTab = activeTab === 'news';
  const currentData = isNewsTab ? news : careerGuides;
  const currentFeatured = isNewsTab ? featuredNews : featuredGuides;

  return (
    <div className="min-h-screen">
      <div className="container mx-auto px-4 py-8">
        <div className="max-w-6xl mx-auto space-y-8">
          
          {/* Header */}
          <div className="text-center space-y-4">
            <div className="flex items-center justify-center gap-3 mb-4">
              <div className={cn(
                "p-3 rounded-full",
                isNewsTab ? "bg-green-600/10" : "bg-emerald-500/10"
              )}>
                {isNewsTab ? (
                  <Newspaper className="h-8 w-8 text-green-600" />
                ) : (
                  <GraduationCap className="h-8 w-8 text-emerald-600" />
                )}
              </div>
              <h1 className="text-4xl font-bold text-black">
                {isNewsTab ? 'Tin tức nghề nghiệp' : 'Kiến thức chuyên ngành'}
              </h1>
            </div>
            <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
              {isNewsTab 
                ? 'Cập nhật những tin tức mới nhất về thị trường việc làm, xu hướng tuyển dụng và các mẹo phát triển sự nghiệp của bạn.'
                : 'Khám phá các hướng dẫn chuyên sâu về nghề nghiệp, kỹ năng và kiến thức cần thiết để phát triển sự nghiệp của bạn trong mọi lĩnh vực.'
              }
            </p>
          </div>

          {/* Tabs */}
          <div className="flex justify-center">
            <div className="bg-muted/50 p-1 rounded-lg">
              <Button
                variant={isNewsTab ? "default" : "ghost"}
                onClick={() => handleTabChange('news')}
                className={cn(
                  "px-6 py-2 rounded-md transition-all duration-300",
                  isNewsTab && "bg-green-600 text-white shadow-md"
                )}
              >
                <Newspaper className="h-4 w-4 mr-2" />
                Tin tức
              </Button>
              <Button
                variant={!isNewsTab ? "default" : "ghost"}
                onClick={() => handleTabChange('career-guide')}
                className={cn(
                  "px-6 py-2 rounded-md transition-all duration-300",
                  !isNewsTab && "bg-emerald-500 text-white shadow-md hover:bg-emerald-600"
                )}
              >
                <GraduationCap className="h-4 w-4 mr-2" />
                Kiến thức chuyên ngành
              </Button>
            </div>
          </div>

          {/* Search */}
          <div className="flex justify-center">
            <div className="relative w-full max-w-md">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-5 w-5" />
              <Input
                placeholder={isNewsTab ? "Tìm kiếm tin tức..." : "Tìm kiếm hướng dẫn..."}
                value={searchTerm}
                onChange={(e) => handleSearch(e.target.value)}
                className={cn(
                  "pl-10 h-12 bg-white/80",
                  isNewsTab 
                    ? "border-green-600/20 focus:border-green-600" 
                    : "border-emerald-200 focus:border-emerald-500"
                )}
              />
            </div>
          </div>

          {/* Categories */}
          <div className="flex flex-wrap justify-center gap-3">
            {categories.map((category) => {
              const IconComponent = category.icon;
              return (
                <Button
                  key={category.id}
                  variant={selectedCategory === category.id ? "default" : "outline"}
                  onClick={() => handleCategoryChange(category.id)}
                  className={cn(
                    "rounded-full h-10 px-6 transition-all duration-300",
                    selectedCategory === category.id 
                      ? `${category.color} text-white hover:opacity-90` 
                      : isNewsTab
                        ? "bg-white/80 border-green-600/20 hover:bg-green-600/10"
                        : "bg-white/80 border-emerald-200 hover:bg-emerald-50"
                  )}
                >
                  {IconComponent && <IconComponent className="h-4 w-4 mr-2" />}
                  {category.name}
                  <Badge variant="secondary" className="ml-2 bg-white/20 text-current">
                    {category.count}
                  </Badge>
                </Button>
              );
            })}
          </div>

          {/* Featured Content */}
          {currentFeatured.length > 0 && selectedCategory === 'all' && (
            <div className="space-y-6">
              <div className="flex items-center gap-2">
                {isNewsTab ? (
                  <Star className="h-5 w-5 text-yellow-500" />
                ) : (
                  <Award className="h-5 w-5 text-yellow-500" />
                )}
                <h2 className="text-2xl font-bold text-foreground">
                  {isNewsTab ? 'Tin nổi bật' : 'Hướng dẫn nổi bật'}
                </h2>
              </div>
              
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {currentFeatured.slice(0, 2).map((item) => (
                  <Card 
                    key={item.id}
                    className={cn(
                      "group overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:-translate-y-1",
                      !isNewsTab && "border-emerald-200"
                    )}
                    onClick={() => handleReadArticle(item.id)}
                  >
                    <div className="relative">
                      <img 
                        src={item.coverImage} 
                        alt={item.title}
                        className="w-full h-64 object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                      <div className="absolute top-4 left-4">
                        <Badge className="bg-yellow-500 text-white">
                          {isNewsTab ? (
                            <>
                              <Star className="h-3 w-3 mr-1" />
                              Nổi bật
                            </>
                          ) : (
                            <>
                              <Award className="h-3 w-3 mr-1" />
                              Nổi bật
                            </>
                          )}
                        </Badge>
                      </div>
                      <div className="absolute top-4 right-4 space-y-2">
                        <Badge variant="secondary" className="bg-white/90 text-foreground block">
                          {item.category}
                        </Badge>
                        {!isNewsTab && item.difficulty && (
                          <Badge className={cn("block", difficultyColors[item.difficulty])}>
                            {item.difficulty}
                          </Badge>
                        )}
                      </div>
                    </div>
                    <CardContent className="p-6">
                      <h3 className={cn(
                        "text-xl font-bold text-foreground mb-3 transition-colors line-clamp-2",
                        isNewsTab ? "group-hover:text-green-600" : "group-hover:text-emerald-600"
                      )}>
                        {item.title}
                      </h3>
                      <p className="text-muted-foreground mb-4 line-clamp-3">
                        {item.excerpt}
                      </p>
                      
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <Avatar className="w-8 h-8">
                            <AvatarImage src={item.author.avatar} alt={item.author.name} />
                            <AvatarFallback>{item.author.name.charAt(0)}</AvatarFallback>
                          </Avatar>
                          <div className="text-sm">
                            <p className="font-medium text-foreground">{item.author.name}</p>
                            <p className="text-muted-foreground">{item.author.role}</p>
                          </div>
                        </div>
                        
                        <div className="text-sm text-muted-foreground text-right">
                          <div className="flex items-center gap-1 mb-1">
                            <Calendar className="h-3 w-3" />
                            <span>{timeAgo(item.publishedAt)}</span>
                          </div>
                          <div className="flex items-center gap-1 mb-1">
                            <Clock className="h-3 w-3" />
                            <span>{item.readTime}</span>
                          </div>
                          {!isNewsTab && item.rating && (
                            <div className="flex items-center gap-1">
                              {renderStars(item.rating)}
                              <span className="ml-1">{item.rating}</span>
                            </div>
                          )}
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            </div>
          )}

          {/* All Content */}
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                {isNewsTab ? (
                  <BookOpen className="h-5 w-5 text-green-600" />
                ) : (
                  <BookOpen className="h-5 w-5 text-emerald-600" />
                )}
                <h2 className="text-2xl font-bold text-foreground">
                  {selectedCategory === 'all' 
                    ? (isNewsTab ? 'Tất cả tin tức' : 'Tất cả hướng dẫn')
                    : `${isNewsTab ? 'Tin tức' : 'Hướng dẫn'} ${categories.find(c => c.id === selectedCategory)?.name}`
                  }
                </h2>
              </div>
              
              {currentData.length > 0 && (
                <div className="text-sm text-muted-foreground">
                  Tìm thấy {currentData.length} {isNewsTab ? 'bài viết' : 'hướng dẫn'}
                </div>
              )}
            </div>

            {currentData.length > 0 ? (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {currentData.map((item) => (
                  <Card 
                    key={item.id}
                    className={cn(
                      "group overflow-hidden cursor-pointer hover:shadow-xl transition-all duration-300 hover:-translate-y-1",
                      !isNewsTab && "border-emerald-200"
                    )}
                    onClick={() => handleReadArticle(item.id)}
                  >
                    <div className="relative">
                      <img 
                        src={item.coverImage} 
                        alt={item.title}
                        className="w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                      <div className="absolute top-4 right-4 space-y-2">
                        <Badge variant="secondary" className="bg-white/90 text-foreground block">
                          {item.category}
                        </Badge>
                        {!isNewsTab && item.difficulty && (
                          <Badge className={cn("block", difficultyColors[item.difficulty])}>
                            {item.difficulty}
                          </Badge>
                        )}
                      </div>
                    </div>
                    <CardContent className="p-4">
                      <h3 className={cn(
                        "text-lg font-bold text-foreground mb-2 transition-colors line-clamp-2",
                        isNewsTab ? "group-hover:text-green-600" : "group-hover:text-emerald-600"
                      )}>
                        {item.title}
                      </h3>
                      <p className="text-muted-foreground text-sm mb-4 line-clamp-3">
                        {item.excerpt}
                      </p>
                      
                      <div className="space-y-3">
                        <div className="flex items-center gap-2">
                          <Avatar className="w-6 h-6">
                            <AvatarImage src={item.author.avatar} alt={item.author.name} />
                            <AvatarFallback className="text-xs">{item.author.name.charAt(0)}</AvatarFallback>
                          </Avatar>
                          <span className="text-sm font-medium text-foreground">{item.author.name}</span>
                        </div>
                        
                        <div className="flex items-center justify-between text-xs text-muted-foreground">
                          <div className="flex items-center gap-1">
                            <Calendar className="h-3 w-3" />
                            <span>{timeAgo(item.publishedAt)}</span>
                          </div>
                          <div className="flex items-center gap-3">
                            <div className="flex items-center gap-1">
                              <Clock className="h-3 w-3" />
                              <span>{item.readTime}</span>
                            </div>
                            <div className="flex items-center gap-1">
                              <Eye className="h-3 w-3" />
                              <span>{item.views}</span>
                            </div>
                          </div>
                        </div>
                        
                        {!isNewsTab && item.rating && (
                          <div className="flex items-center gap-1">
                            {renderStars(item.rating)}
                            <span className="text-xs text-muted-foreground ml-1">{item.rating}</span>
                          </div>
                        )}
                      </div>
                    </CardContent>
                  </Card>
                ))}
              </div>
            ) : (
              <div className="text-center py-12">
                <div className="w-24 h-24 bg-muted/30 rounded-full flex items-center justify-center mx-auto mb-4">
                  {isNewsTab ? (
                    <Newspaper className="h-12 w-12 text-muted-foreground/50" />
                  ) : (
                    <GraduationCap className="h-12 w-12 text-muted-foreground/50" />
                  )}
                </div>
                <h3 className="text-xl font-semibold text-foreground mb-2">
                  {isNewsTab ? 'Không tìm thấy tin tức' : 'Không tìm thấy hướng dẫn'}
                </h3>
                <p className="text-muted-foreground mb-4">
                  {isNewsTab 
                    ? 'Không có bài viết nào phù hợp với tiêu chí tìm kiếm của bạn.'
                    : 'Không có hướng dẫn nào phù hợp với tiêu chí tìm kiếm của bạn.'
                  }
                </p>
                <Button 
                  variant="outline" 
                  onClick={() => {
                    setSearchTerm('');
                    setSelectedCategory('all');
                    setSearchParams({ tab: activeTab });
                  }}
                  className={cn(
                    isNewsTab 
                      ? "border-green-600/20 hover:bg-green-600/10"
                      : "border-emerald-200 hover:bg-emerald-50"
                  )}
                >
                  {isNewsTab ? 'Xem tất cả tin tức' : 'Xem tất cả hướng dẫn'}
                </Button>
              </div>
            )}
          </div>

          {/* Pagination */}
          {totalPages > 1 && (
            <div className="flex justify-center items-center space-x-4">
              <Button
                variant="outline"
                onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}
                disabled={currentPage === 1}
                className={cn(
                  isNewsTab 
                    ? "border-green-600/20 hover:bg-green-600/10"
                    : "border-emerald-200 hover:bg-emerald-50"
                )}
              >
                Trước
              </Button>
              
              <div className="flex space-x-2">
                {[...Array(totalPages)].map((_, i) => (
                  <Button
                    key={i}
                    variant={currentPage === i + 1 ? "default" : "outline"}
                    onClick={() => setCurrentPage(i + 1)}
                    className={cn(
                      "w-10 h-10",
                      currentPage === i + 1 
                        ? (isNewsTab ? "bg-green-600 hover:bg-green-600/90" : "bg-emerald-500 hover:bg-emerald-600")
                        : (isNewsTab ? "border-green-600/20 hover:bg-green-600/10" : "border-emerald-200 hover:bg-emerald-50")
                    )}
                  >
                    {i + 1}
                  </Button>
                ))}
              </div>

              <Button
                variant="outline"
                onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}
                disabled={currentPage === totalPages}
                className={cn(
                  isNewsTab 
                    ? "border-green-600/20 hover:bg-green-600/10"
                    : "border-emerald-200 hover:bg-emerald-50"
                )}
              >
                Sau
              </Button>
            </div>
          )}
        </div>
      </div>

{/* Newsletter Subscription */}
<section className="py-16 bg-linear-to-br from-emerald-500 to-green-600 relative overflow-hidden">
  <div className="absolute inset-0 bg-black/10"></div>
  <div className="relative z-10 max-w-4xl mx-auto px-4 text-center">
    <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-8 md:p-12">
      <div className="inline-flex items-center justify-center w-16 h-16 bg-white/20 rounded-full mb-6">
        <BookOpen className="h-8 w-8 text-white" />
      </div>
      <h2 className="text-3xl md:text-4xl font-bold text-white mb-4">
        Nhận thông báo bài viết mới
      </h2>
      <p className="text-xl text-white/90 mb-8 max-w-2xl mx-auto">
        Đăng ký để nhận những bài viết chất lượng cao về phát triển sự nghiệp 
        và kiến thức chuyên ngành được gửi thẳng đến email của bạn.
      </p>
      
      <div className="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
        <Input
          type="email"
          placeholder="Nhập email của bạn..."
          className="bg-white/20 border-white/30 text-white placeholder:text-white/70 focus:bg-white/30 h-12"
        />
        <Button 
          size="lg" 
          className="bg-white text-emerald-600 hover:bg-white/90 font-semibold h-12 px-8"
        >
          Đăng ký ngay
        </Button>
      </div>
      
      <p className="text-sm text-white/80 mt-4">
        💡 Hoàn toàn miễn phí • 📧 Không spam • 🔒 Bảo mật thông tin
      </p>
    </div>
  </div>
</section>

<div className="container mx-auto px-4">
  <div className="max-w-6xl mx-auto space-y-8">
    {/* Popular Tags */}
    <section className="py-16 bg-background">
  <div className="max-w-6xl mx-auto px-4">
    <div className="text-center mb-12">
      <h2 className="text-3xl font-bold text-foreground mb-4">
        <span className="text-emerald-600">Chủ đề</span> phổ biến
      </h2>
      <p className="text-lg text-muted-foreground">
        Khám phá các chủ đề được quan tâm nhất trong cộng đồng
      </p>
    </div>

    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
      {[
        { name: 'Phát triển sự nghiệp', count: 156, icon: TrendingUp, color: 'bg-blue-500' },
        { name: 'Kỹ năng mềm', count: 134, icon: Users, color: 'bg-purple-500' },
        { name: 'Phỏng vấn', count: 98, icon: Award, color: 'bg-orange-500' },
        { name: 'Lương bổng', count: 87, icon: DollarSign, color: 'bg-green-500' },
        { name: 'Work-life balance', count: 76, icon: Target, color: 'bg-pink-500' },
        { name: 'Chuyển đổi nghề nghiệp', count: 65, icon: Briefcase, color: 'bg-indigo-500' },
        { name: 'Khởi nghiệp', count: 54, icon: Sparkles, color: 'bg-yellow-500' },
        { name: 'Công nghệ mới', count: 43, icon: GraduationCap, color: 'bg-red-500' }
      ].map((tag, index) => (
        <Card 
          key={index}
          className="group cursor-pointer hover:shadow-xl transition-all duration-300 hover:-translate-y-1 bg-background border-0 shadow-md"
          onClick={() => handleSearch(tag.name)}
        >
          <CardContent className="p-6 text-center">
            <div className={`w-12 h-12 ${tag.color}/10 rounded-xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300`}>
              <tag.icon className={`h-6 w-6 ${tag.color.replace('bg-', 'text-')}`} />
            </div>
            <h3 className="font-semibold text-foreground mb-2 group-hover:text-emerald-600 transition-colors">
              {tag.name}
            </h3>
            <Badge variant="secondary" className="text-emerald-600 bg-emerald-100">
              {tag.count} bài viết
            </Badge>
          </CardContent>
        </Card>
      ))}
    </div>

    {/* Popular Tags Cloud */}
    <div className="text-center">
      <h3 className="text-xl font-semibold mb-6 text-foreground">Tags phổ biến khác</h3>
      <div className="flex flex-wrap justify-center gap-3">
        {[
          'React', 'JavaScript', 'UI/UX Design', 'Data Science', 'Product Management',
          'Agile', 'Scrum', 'Digital Marketing', 'SEO', 'Content Writing',
          'Leadership', 'Team Management', 'Remote Work', 'Freelancing', 'Networking'
        ].map((tag, index) => (
          <Badge 
            key={index}
            variant="outline" 
            className="cursor-pointer hover:bg-emerald-500 hover:text-white hover:border-emerald-500 transition-all duration-300 px-4 py-2 text-sm"
            onClick={() => handleSearch(tag)}
          >
            #{tag}
          </Badge>
        ))}
      </div>
    </div>
  </div>
</section>

{/* Career Resources */}
<section className="py-16 bg-linear-to-br from-emerald-50/50 to-blue-50/50">
  <div className="max-w-6xl mx-auto px-4">
    <div className="text-center mb-12">
      <Badge variant="outline" className="px-4 py-2 text-sm font-medium text-emerald-600 border-emerald-300 bg-background mb-4">
        🎯 Tài nguyên nghề nghiệp
      </Badge>
      <h2 className="text-3xl md:text-4xl font-bold text-foreground mb-4">
        Công cụ <span className="text-emerald-600">hỗ trợ</span> sự nghiệp
      </h2>
      <p className="text-lg text-muted-foreground max-w-2xl mx-auto">
        Khám phá các công cụ và tài nguyên miễn phí giúp bạn phát triển sự nghiệp hiệu quả
      </p>
    </div>

    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {[
        {
          icon: FileText,
          title: 'Mẫu CV chuyên nghiệp',
          description: 'Hơn 50 mẫu CV đẹp, hiện đại cho mọi ngành nghề',
          features: ['Dễ chỉnh sửa', 'Định dạng ATS-friendly', 'Hoàn toàn miễn phí'],
          buttonText: 'Tải về ngay',
          color: 'bg-blue-500'
        },
        {
          icon: MessageSquare,
          title: 'Câu hỏi phỏng vấn',
          description: 'Bộ sưu tập 500+ câu hỏi phỏng vấn phổ biến nhất',
          features: ['Có đáp án gợi ý', 'Phân loại theo ngành', 'Cập nhật thường xuyên'],
          buttonText: 'Xem ngay',
          color: 'bg-purple-500'
        },
        {
          icon: Calculator,
          title: 'Tính lương thực lãnh',
          description: 'Công cụ tính toán lương gross/net chính xác',
          features: ['Áp dụng luật mới nhất', 'Tính bảo hiểm', 'Xuất báo cáo'],
          buttonText: 'Sử dụng ngay',
          color: 'bg-green-500'
        },
        {
          icon: Target,
          title: 'Định hướng nghề nghiệp',
          description: 'Bài test tính cách và định hướng nghề nghiệp',
          features: ['Dựa trên khoa học', 'Kết quả chi tiết', 'Tư vấn cá nhân hóa'],
          buttonText: 'Làm bài test',
          color: 'bg-orange-500'
        },
        {
          icon: BookOpen,
          title: 'Khóa học miễn phí',
          description: 'Học kỹ năng mới với các khóa học chất lượng cao',
          features: ['Video HD', 'Có chứng chỉ', 'Học theo lộ trình'],
          buttonText: 'Khám phá',
          color: 'bg-pink-500'
        },
        {
          icon: Users,
          title: 'Cộng đồng nghề nghiệp',
          description: 'Kết nối và chia sẻ kinh nghiệm với cộng đồng',
          features: ['10K+ thành viên', 'Thảo luận sôi nổi', 'Sự kiện định kỳ'],
          buttonText: 'Tham gia',
          color: 'bg-indigo-500'
        }
      ].map((resource, index) => (
        <Card 
          key={index}
          className="group hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 bg-background border-0 shadow-lg overflow-hidden"
        >
          <CardContent className="p-6">
            <div className={`w-16 h-16 ${resource.color}/10 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300`}>
              <resource.icon className={`h-8 w-8 ${resource.color.replace('bg-', 'text-')}`} />
            </div>
            
            <h3 className="text-xl font-bold text-foreground mb-3 group-hover:text-emerald-600 transition-colors">
              {resource.title}
            </h3>
            
            <p className="text-muted-foreground mb-4 leading-relaxed">
              {resource.description}
            </p>
            
            <ul className="space-y-2 mb-6">
              {resource.features.map((feature, featureIndex) => (
                <li key={featureIndex} className="flex items-center text-sm text-muted-foreground">
                  <CheckCircle className="h-4 w-4 text-emerald-500 mr-2 shrink-0" />
                  {feature}
                </li>
              ))}
            </ul>
            
            <Button className="w-full bg-linear-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white font-semibold">
              {resource.buttonText}
              <ArrowRight className="ml-2 h-4 w-4" />
            </Button>
          </CardContent>
        </Card>
      ))}
    </div>
  </div>
</section>

{/* Statistics Section */}
<section className="py-16 bg-background">
  <div className="max-w-6xl mx-auto px-4">
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      {[
        { icon: BookOpen, value: '500+', label: 'Bài viết chuyên sâu', color: 'text-blue-600' },
        { icon: Users, value: '50K+', label: 'Người đọc hàng tháng', color: 'text-purple-600' },
        { icon: Award, value: '95%', label: 'Độ hài lòng của người dùng', color: 'text-green-600' },
        { icon: TrendingUp, value: '10M+', label: 'Lượt xem tổng cộng', color: 'text-orange-600' }
      ].map((stat, index) => (
        <div key={index} className="text-center">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-linear-to-br from-emerald-100 to-green-100 rounded-full mb-4">
            <stat.icon className={`h-8 w-8 ${stat.color}`} />
          </div>
          <div className="text-3xl font-bold text-foreground mb-2">{stat.value}</div>
          <div className="text-muted-foreground">{stat.label}</div>
        </div>
      ))}
    </div>
  </div>
</section>

{/* Call to Action */}
<section className="py-20 bg-linear-to-br from-emerald-600 via-green-600 to-blue-600 relative overflow-hidden">
  <div className="absolute inset-0 bg-black/20"></div>
  <div className="absolute inset-0 bg-linear-to-r from-emerald-600/20 to-transparent"></div>
  
  <div className="relative z-10 max-w-4xl mx-auto px-4 text-center">
    <div className="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full mb-6">
      <Sparkles className="h-10 w-10 text-white" />
    </div>
    
    <h2 className="text-4xl md:text-5xl font-bold text-white mb-6">
      Sẵn sàng để <span className="text-yellow-300">thành công</span>?
    </h2>
    
    <p className="text-xl text-white/90 mb-8 max-w-2xl mx-auto leading-relaxed">
      Bắt đầu hành trình phát triển sự nghiệp của bạn ngay hôm nay. 
      Tìm việc làm phù hợp và xây dựng tương lai mơ ước.
    </p>
    
    <div className="flex flex-col sm:flex-row gap-4 justify-center">
      <Button 
        size="lg" 
        className="bg-white text-emerald-600 hover:bg-white/90 font-semibold px-8 py-4 text-lg"
        onClick={() => navigate('/jobs')}
      >
        <Search className="mr-2 h-5 w-5" />
        Tìm việc làm ngay
      </Button>
      
      <Button 
        size="lg" 
        variant="outline"
        className="border-white/30 text-white hover:bg-white/10 font-semibold px-8 py-4 text-lg backdrop-blur-sm"
        onClick={() => navigate('/profile')}
      >
        <User className="mr-2 h-5 w-5" />
        Tạo hồ sơ
      </Button>
    </div>
    
    <div className="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 text-white/80">
      <div className="flex items-center justify-center gap-3">
        <CheckCircle className="h-6 w-6 text-green-300" />
        <span>Hoàn toàn miễn phí</span>
      </div>
      <div className="flex items-center justify-center gap-3">
        <CheckCircle className="h-6 w-6 text-green-300" />
        <span>Cập nhật liên tục</span>
      </div>
      <div className="flex items-center justify-center gap-3">
        <CheckCircle className="h-6 w-6 text-green-300" />
        <span>Hỗ trợ 24/7</span>
      </div>
    </div>
  </div>
</section>
        </div>
      </div>
    </div>
    
  );
};

export default News;
</file>

<file path="src/pages/onboarding/OnboardingPage.jsx">
import { useEffect, useCallback, memo } from 'react';
import { useNavigate } from 'react-router-dom';
import { useSelector, shallowEqual } from 'react-redux';
import { OnboardingWrapper } from '@/components/onboarding/OnboardingWrapper';
import { BasicInfoStep } from '@/components/onboarding/steps/BasicInfoStep';
import { SkillsStep } from '@/components/onboarding/steps/SkillsStep';
import { SalaryPreferencesStep } from '@/components/onboarding/steps/SalaryPreferencesStep';
import { ExperienceEducationStep } from '@/components/onboarding/steps/ExperienceEducationStep';
import { CertificatesProjectsStep } from '@/components/onboarding/steps/CertificatesProjectsStep';
import { LoadingState } from '@/components/onboarding/LoadingState';
import { ErrorState } from '@/components/onboarding/ErrorState';

const OnboardingPage = memo(() => {
  const navigate = useNavigate();
  const { isAuthenticated } = useSelector((state) => state.auth);
  
  // Chỉ select những giá trị cần thiết + shallowEqual để tránh re-render không cần thiết
  const { needsOnboarding, isLoading, error } = useSelector((state) => ({
    needsOnboarding: state.onboarding.needsOnboarding,
    isLoading: state.onboarding.isLoading,
    error: state.onboarding.error
  }), shallowEqual);

  // ALL HOOKS MUST BE AT THE TOP - BEFORE ANY CONDITIONAL RETURNS
  const handleComplete = useCallback(() => {
    navigate('/dashboard', { replace: true });
  }, [navigate]);

  // Render the appropriate step based on current step
  const renderStep = useCallback(({ currentStep, stepData, onNext, isLoading, error, onLoadingChange }) => {
    switch (currentStep) {
      case 1:
        return (
          <BasicInfoStep
            initialData={stepData}
            onNext={onNext}
            isLoading={isLoading}
            error={error}
            onLoadingChange={onLoadingChange}
          />
        );
      case 2:
        return (
          <SkillsStep
            initialData={stepData}
            onNext={onNext}
            isLoading={isLoading}
            onLoadingChange={onLoadingChange}
          />
        );
      case 3:
        return (
          <SalaryPreferencesStep
            initialData={stepData}
            onNext={onNext}
            isLoading={isLoading}
            onLoadingChange={onLoadingChange}
          />
        );
      case 4:
        return (
          <ExperienceEducationStep
            initialData={stepData}
            onNext={onNext}
            isLoading={isLoading}
            onLoadingChange={onLoadingChange}
          />
        );
      case 5:
        return (
          <CertificatesProjectsStep
            initialData={stepData}
            onNext={onNext}
            isLoading={isLoading}
            onLoadingChange={onLoadingChange}
          />
        );
      default:
        return null;
    }
  }, []);

  // Check if user is authenticated
  useEffect(() => {
    if (!isAuthenticated) {
      navigate('/login', { replace: true });
    }
  }, [isAuthenticated, navigate]);

  // If onboarding is already completed, redirect to dashboard
  useEffect(() => {
    if (!isLoading && !needsOnboarding) {
      navigate('/dashboard', { replace: true });
    }
  }, [needsOnboarding, isLoading, navigate]);

  // CONDITIONAL RETURNS MUST BE AFTER ALL HOOKS
  if (isLoading) {
    return <LoadingState />;
  }

  if (error) {
    return (
      <ErrorState 
        message="Không thể tải trạng thái onboarding"
        onRetry={() => window.location.reload()}
      />
    );
  }

  return (
    <OnboardingWrapper onComplete={handleComplete}>
      {renderStep}
    </OnboardingWrapper>
  );
});

OnboardingPage.displayName = 'OnboardingPage';

export default OnboardingPage;
</file>

<file path="src/components/HomePage.jsx">
import HeroSection from './sections/HeroSection';
import RecommendedJobs from './sections/RecommendedJobs';
import PopularCategories from './sections/PopularCategories';
import TopCompanies from './sections/TopCompanies';
import TrendingCompanies from './sections/TrendingCompanies';
import Testimonials from './sections/Testimonials';
import CareerGuideSection from './sections/CareerGuideSection';
import NewsletterSection from './sections/NewsletterSection';
import StatsSection from './sections/StatsSection';
import HowItWorks from './sections/HowItWorks';

const HomePage = () => {
  return (
    <div className="flex flex-col min-h-full bg-background">
      <HeroSection />
      <StatsSection />
      <RecommendedJobs />
      <HowItWorks />
      <PopularCategories />
      <TopCompanies />
      <TrendingCompanies limit={6} showHeader={true} variant="grid" />
      <Testimonials />
      <CareerGuideSection />
      <NewsletterSection />
    </div>
  );
};

export default HomePage
</file>

<file path="src/components/onboarding/OnboardingWrapper.jsx">
import { useState, useEffect, useCallback, useMemo, useRef } from 'react';
import { useNavigate } from 'react-router-dom';
import { useMutation } from '@tanstack/react-query';
import { useDispatch } from 'react-redux';
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';
import { ChevronLeft, X } from 'lucide-react';
import { updateProfileData, dismissOnboarding, completeOnboarding } from '@/services/onboardingService';
import { InlineErrorAlert } from '@/components/common/FallbackUI';
import { getErrorMessage } from '@/utils/errorHandling';
import { OnboardingBackground } from './OnboardingBackground';
import { useOnboardingStatus } from '@/hooks/useOnboardingStatus';
import { fetchOnboardingStatus } from '@/redux/slices/onboardingThunks';
import { nextStep, previousStep, setCurrentStep } from '@/redux/slices/onboardingSlice';

const ONBOARDING_STORAGE_KEY = 'careerzone_onboarding_progress';

const STEPS = [
  { id: 1, name: 'Thông tin cơ bản', component: 'BasicInfoStep' },
  { id: 2, name: 'Kỹ năng', component: 'SkillsStep' },
  { id: 3, name: 'Mức lương & Điều kiện', component: 'SalaryPreferencesStep' },
  { id: 4, name: 'Kinh nghiệm & Học vấn', component: 'ExperienceEducationStep' },
  { id: 5, name: 'Chứng chỉ & Dự án', component: 'CertificatesProjectsStep' }
];

export const OnboardingWrapper = ({ children, onComplete }) => {
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const [stepData, setStepData] = useState({});
  const [submitError, setSubmitError] = useState(null);
  const [isStepLoading, setIsStepLoading] = useState(false);
  
  // Sử dụng ref để track lần cuối save localStorage (tránh save quá nhiều)
  const lastSaveTimeRef = useRef(0);
  const saveTimeoutRef = useRef(null);
  
  // Sử dụng ref để store stepData - tránh stale closure trong callback
  const stepDataRef = useRef(stepData);
  useEffect(() => {
    stepDataRef.current = stepData;
  }, [stepData]);
  
  // Use Redux hook for onboarding status (cached) - CHỈ lấy lần đầu để init
  const { 
    currentStep: reduxCurrentStep,
  } = useOnboardingStatus();

  // Khởi tạo localCurrentStep từ localStorage hoặc Redux hoặc default = 1
  const getInitialStep = () => {
    try {
      const savedProgress = localStorage.getItem(ONBOARDING_STORAGE_KEY);
      if (savedProgress) {
        const { step } = JSON.parse(savedProgress);
        return step || 1;
      }
    } catch (error) {
      console.error('Failed to load onboarding progress:', error);
    }
    return reduxCurrentStep > 0 ? reduxCurrentStep : 1;
  };

  // Sử dụng local state cho currentStep để tránh re-render khi Redux thay đổi
  const [localCurrentStep, setLocalCurrentStep] = useState(getInitialStep);

  // Load saved progress from localStorage on mount
  useEffect(() => {
    const savedProgress = localStorage.getItem(ONBOARDING_STORAGE_KEY);
    if (savedProgress) {
      try {
        const { step, data } = JSON.parse(savedProgress);
        if (step && step !== localCurrentStep) {
          setLocalCurrentStep(step);
        }
        if (data) {
          setStepData(data);
        }
      } catch (error) {
        console.error('Failed to load onboarding progress:', error);
      }
    }
  }, []); // CHỈ chạy 1 lần khi mount

  // Debounced save to localStorage - CHỈ save sau 500ms không có thay đổi
  useEffect(() => {
    // Clear timeout cũ nếu có
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }

    // Đặt timeout mới
    saveTimeoutRef.current = setTimeout(() => {
      if (localCurrentStep > 0) {
        const progress = {
          step: localCurrentStep,
          data: stepData,
          timestamp: new Date().toISOString()
        };
        localStorage.setItem(ONBOARDING_STORAGE_KEY, JSON.stringify(progress));
        lastSaveTimeRef.current = Date.now();
      }
    }, 500); // Debounce 500ms

    // Cleanup
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [localCurrentStep, stepData]);

  // Update profile mutation with enhanced error handling
  const updateProfileMutation = useMutation({
    mutationFn: (profileData) => updateProfileData(profileData),
    retry: 2,
    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 5000),
    onSuccess: () => {
      setSubmitError(null);
      // KHÔNG fetch lại onboarding status ở đây để tránh re-render
      // Chỉ fetch khi hoàn thành onboarding hoặc khi cần thiết
    },
    onError: (error) => {
      const errorMsg = getErrorMessage(error, 'Lưu tiến trình');
      setSubmitError(errorMsg);
      // Vẫn cho phép chuyển step ngay cả khi lưu thất bại
      toast.error(`${errorMsg}. Bạn có thể tiếp tục và cập nhật lại sau.`);
    }
  });

  // Dismiss onboarding mutation with enhanced error handling
  const dismissMutation = useMutation({
    mutationFn: dismissOnboarding,
    retry: 2,
    retryDelay: (attemptIndex) => Math.min(1000 * 2 ** attemptIndex, 5000),
    onSuccess: () => {
      localStorage.removeItem(ONBOARDING_STORAGE_KEY);
      toast.info('Bạn có thể hoàn thiện hồ sơ bất cứ lúc nào');
      setSubmitError(null);
      dispatch(fetchOnboardingStatus());
      onComplete?.();
      navigate('/dashboard');
    },
    onError: (error) => {
      const errorMsg = getErrorMessage(error, 'Bỏ qua onboarding');
      setSubmitError(errorMsg);
      toast.error(errorMsg);
    }
  });

  // Memoize handlers để tránh tái tạo mỗi lần render
  const handleNext = useCallback(async (data) => {
    try {
      setSubmitError(null);

      // Sử dụng functional update để tránh dependency vào stepData
      setStepData(prevStepData => {
        const updatedStepData = { ...prevStepData, [localCurrentStep]: data };
        return updatedStepData;
      });

      // Luôn chuyển step trước, bất kể API có thành công hay không
      if (localCurrentStep < STEPS.length) {
        setLocalCurrentStep(prev => prev + 1);
        // Cập nhật Redux state trong nền (không gây re-render vì dùng local state)
        dispatch(nextStep());
      }

      // Gọi API để lưu dữ liệu (không blocking UI)
      try {
        await updateProfileMutation.mutateAsync(data);
      } catch (apiError) {
        // API lỗi nhưng vẫn cho phép user tiếp tục
        console.warn('API save failed but allowing user to continue:', apiError);
      }

      // Nếu đây là bước cuối cùng (sau khi đã nextStep), hoàn thành onboarding
      if (localCurrentStep + 1 > STEPS.length) {
        try {
          await completeOnboarding();
          localStorage.removeItem(ONBOARDING_STORAGE_KEY);
          dispatch(fetchOnboardingStatus());
          toast.success('Hoàn thành onboarding! 🎉');
          onComplete?.();
          navigate('/dashboard');
        } catch (completeError) {
          console.error('Complete onboarding error:', completeError);
          toast.error('Có lỗi khi hoàn thành onboarding. Vui lòng thử lại.');
        }
      }
    } catch (error) {
      console.error('Error in handleNext:', error);
      // Fallback: nếu có lỗi bất ngờ, vẫn cho phép chuyển step
      if (localCurrentStep < STEPS.length) {
        setLocalCurrentStep(prev => prev + 1);
        dispatch(nextStep());
        toast.error('Có lỗi xảy ra nhưng bạn có thể tiếp tục. Vui lòng kiểm tra lại thông tin sau.');
      }
    }
  }, [localCurrentStep, updateProfileMutation, dispatch, onComplete, navigate]);

  const handleBack = useCallback(() => {
    setLocalCurrentStep(prev => Math.max(1, prev - 1));
    dispatch(previousStep());
  }, [dispatch]);

  const handleSkipStep = useCallback(async () => {
    try {
      setSubmitError(null);
      const currentStepInfo = STEPS.find(s => s.id === localCurrentStep);
      
      if (localCurrentStep < STEPS.length) {
        setLocalCurrentStep(prev => prev + 1);
        dispatch(nextStep());
        if (currentStepInfo) {
          toast.info(`Đã bỏ qua bước "${currentStepInfo.name}"`);
        }
      }
      
      // Kiểm tra nếu đây là bước cuối cùng (sau khi nextStep)
      if (localCurrentStep + 1 > STEPS.length) {
        try {
          await completeOnboarding();
          localStorage.removeItem(ONBOARDING_STORAGE_KEY);
          dispatch(fetchOnboardingStatus());
          toast.success('Hoàn thành! Bạn có thể cập nhật hồ sơ bất cứ lúc nào');
          onComplete?.();
          navigate('/dashboard');
        } catch (completeError) {
          console.error('Complete onboarding error:', completeError);
          toast.error('Có lỗi khi hoàn thành onboarding. Vui lòng thử lại.');
        }
      }
    } catch (error) {
      console.error('Error in handleSkipStep:', error);
      const errorMsg = getErrorMessage(error, 'Bỏ qua bước');
      setSubmitError(errorMsg);
      toast.error(errorMsg);
    }
  }, [localCurrentStep, dispatch, onComplete, navigate]);

  const handleSkipAll = useCallback(async () => {
    try {
      setSubmitError(null);
      await completeOnboarding();
      localStorage.removeItem(ONBOARDING_STORAGE_KEY);
      dispatch(fetchOnboardingStatus());
      toast.success('Đã bỏ qua onboarding. Bạn có thể hoàn thiện hồ sơ bất cứ lúc nào từ trang cá nhân!');
      onComplete?.();
      navigate('/dashboard');
    } catch (error) {
      console.error('Error in handleSkipAll:', error);
      const errorMsg = getErrorMessage(error, 'Bỏ qua onboarding');
      setSubmitError(errorMsg);
      toast.error(errorMsg);
    }
  }, [dispatch, onComplete, navigate]);

  const handleRetryError = useCallback(() => {
    setSubmitError(null);
  }, []);

  const handleStepLoadingChange = useCallback((loading) => {
    setIsStepLoading(loading);
  }, []);

  const isFirstStep = localCurrentStep === 1;
  const isLoading = updateProfileMutation.isPending || dismissMutation.isPending || isStepLoading;

  const currentStepInfo = STEPS.find(s => s.id === localCurrentStep);

  if (!currentStepInfo) {
    // Trạng thái khởi tạo hoặc lỗi, có thể hiển thị loading hoặc lỗi
    return null; 
  }

  // Memoize child props để tránh tái tạo object mỗi lần render
  // CHỈ phụ thuộc vào localCurrentStep và các handlers (đã được memoize)
  const childProps = useMemo(() => ({
    currentStep: localCurrentStep,
    stepData: stepDataRef.current[localCurrentStep] || {},
    onNext: handleNext,
    isLoading,
    error: submitError,
    onLoadingChange: handleStepLoadingChange
  }), [localCurrentStep, handleNext, isLoading, submitError, handleStepLoadingChange]);

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 animate-in fade-in duration-300">
      <OnboardingBackground />
      <div
        className="absolute inset-0 bg-black/60 backdrop-blur-md"
        onClick={handleSkipAll}
      />
      <div className="relative w-full max-w-4xl max-h-[90vh] flex flex-col bg-card rounded-2xl shadow-2xl border border-border/50 animate-in zoom-in-95 duration-300">
        {submitError && (
          <div className="absolute top-0 left-0 right-0 z-10 rounded-t-2xl overflow-hidden">
            <InlineErrorAlert
              message={submitError}
              onRetry={handleRetryError}
              onDismiss={() => setSubmitError(null)}
            />
          </div>
        )}
        <div className="flex-shrink-0 px-8 pt-8 pb-6 border-b border-border/50">
          <div className="flex items-start justify-between mb-6">
            <div className="flex-1">
              <div className="flex items-center gap-3 mb-2">
                <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                  <span className="text-lg font-bold text-primary">{localCurrentStep}</span>
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-foreground">
                    {currentStepInfo.name}
                  </h2>
                  <p className="text-sm text-muted-foreground mt-0.5">
                    Bước {localCurrentStep} / {STEPS.length}
                  </p>
                </div>
              </div>
            </div>
            <Button
              variant="ghost"
              onClick={handleSkipAll}
              disabled={isLoading}
              className="text-muted-foreground hover:text-foreground hover:bg-destructive/10"
              title="Bỏ qua tất cả và hoàn thành onboarding"
            >
              <X className="w-4 h-4 mr-2" />
              Bỏ qua tất cả
            </Button>
          </div>
          <div className="space-y-3">
            <div className="flex items-center gap-2">
              {STEPS.map((step, index) => (
                <div key={step.id} className="flex items-center flex-1">
                  <div className="flex-1 relative">
                    <div className={`h-2 rounded-full transition-all duration-500 ${step.id < localCurrentStep
                        ? 'bg-emerald-500'
                        : step.id === localCurrentStep
                          ? 'bg-primary'
                          : 'bg-muted'
                      }`}>
                      {step.id === localCurrentStep && (
                        <div className="absolute inset-0 bg-primary rounded-full animate-pulse" />
                      )}
                    </div>
                  </div>
                  {index < STEPS.length - 1 && (
                    <div className="w-2" />
                  )}
                </div>
              ))}
            </div>
            <div className="flex justify-between">
              {STEPS.map((step) => (
                <div
                  key={step.id}
                  className={`flex-1 text-center text-xs font-medium transition-colors duration-300 ${step.id === localCurrentStep
                      ? 'text-primary'
                      : step.id < localCurrentStep
                        ? 'text-emerald-600'
                        : 'text-muted-foreground'
                    }`}
                >
                  {step.name}
                </div>
              ))}
            </div>
          </div>
        </div>
        <div className="flex-1 overflow-y-auto px-8 py-6 custom-scrollbar">
          <div 
            key={localCurrentStep}
            className="animate-in slide-in-from-right-5 duration-200"
          >
            {children(childProps)}
          </div>
        </div>
        <div className="flex-shrink-0 px-8 py-6 border-t border-border/50 bg-muted/30">
          <div className="flex items-center justify-between gap-4">
            <Button
              variant="outline"
              onClick={handleBack}
              disabled={isLoading || isFirstStep}
              className="min-w-[120px]"
            >
              <ChevronLeft className="w-4 h-4 mr-1" />
              Quay lại
            </Button>
            <div className="flex gap-3">
              <Button
                variant="ghost"
                onClick={handleSkipStep}
                disabled={isLoading}
                className="text-muted-foreground hover:text-foreground"
              >
                Bỏ qua bước này
              </Button>
              <Button
                onClick={() => {
                  const form = document.querySelector('form');
                  if (form) {
                    form.requestSubmit();
                  }
                }}
                disabled={isLoading}
                className="min-w-[140px] bg-primary hover:bg-primary/90 shadow-lg shadow-primary/25"
              >
                {isLoading ? (
                  <span className="flex items-center gap-2">
                    <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                    {isStepLoading ? 'Đang tải ảnh...' : 'Đang xử lý...'}
                  </span>
                ) : localCurrentStep >= STEPS.length ? (
                  'Hoàn thành'
                ) : (
                  'Tiếp tục'
                )}
              </Button>
            </div>
          </div>
        </div>
      </div>
      <style jsx>{`
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: hsl(var(--muted-foreground) / 0.3);
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: hsl(var(--muted-foreground) / 0.5);
        }
      `}</style>
    </div>
  );
};
</file>

<file path="src/components/profile/BasicInfoSection.jsx">
import { useState, useCallback } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { User, Mail, Phone, Edit3, Save, X, Upload, Loader2, MapPin, Globe, Linkedin, Github } from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';

export const BasicInfoSection = ({ profile, onUpdate, onAvatarUpdate }) => {
  const [isEditing, setIsEditing] = useState(false);
  const [formData, setFormData] = useState({
    fullname: profile?.fullname || '',
    phone: profile?.phone || '',
    bio: profile?.bio || '',
    address: profile?.address || '',
    website: profile?.website || '',
    linkedin: profile?.linkedin || '',
    github: profile?.github || ''
  });
  const [avatarFile, setAvatarFile] = useState(null);
  const [isUpdating, setIsUpdating] = useState(false);
  const [isUploadingAvatar, setIsUploadingAvatar] = useState(false);

  const handleEdit = () => {
    setFormData({
      fullname: profile?.fullname || '',
      phone: profile?.phone || '',
      bio: profile?.bio || '',
      address: profile?.address || '',
      website: profile?.website || '',
      linkedin: profile?.linkedin || '',
      github: profile?.github || ''
    });
    setIsEditing(true);
  };

  const handleCancel = () => {
    setIsEditing(false);
    setAvatarFile(null);
  };

  // Memoized handler to prevent re-render
  const handleFormChange = useCallback((field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  }, []);

  const handleSave = async () => {
    try {
      setIsUpdating(true);

      if (avatarFile) {
        setIsUploadingAvatar(true);
        toast.loading('Đang tải ảnh lên...', { id: 'avatar-upload' });
        const avatarFormData = new FormData();
        avatarFormData.append('avatar', avatarFile);
        await onAvatarUpdate(avatarFormData);
        toast.success('Tải ảnh lên thành công', { id: 'avatar-upload' });
        setIsUploadingAvatar(false);
      }

      // Normalize phone number to match backend format
      const updateData = { ...formData };
      if (updateData.phone) {
        // Remove all spaces, dashes, parentheses
        updateData.phone = updateData.phone.replace(/[\s\-\(\)]/g, '');
      }
      
      // Remove avatar from updateData (avatar is updated separately)
      delete updateData.avatar;

      await onUpdate(updateData);
      setIsEditing(false);
      setAvatarFile(null);
      toast.success('Cập nhật thông tin thành công');
    } catch (error) {
      if (isUploadingAvatar) {
        toast.error('Tải ảnh lên thất bại', { id: 'avatar-upload' });
      }
      toast.error(error.response?.data?.message || 'Cập nhật thất bại');
      setIsUploadingAvatar(false);
    } finally {
      setIsUpdating(false);
    }
  };

  const handleAvatarChange = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    if (!file.type.startsWith('image/')) {
      toast.error('Vui lòng chọn file ảnh');
      return;
    }

    if (file.size > 5 * 1024 * 1024) {
      toast.error('Kích thước ảnh không được vượt quá 5MB');
      return;
    }

    setAvatarFile(file);
    toast.success('Đã chọn ảnh. Nhấn "Lưu" để cập nhật.');
  };

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('vi-VN');
  };

  return (
    <Card className="overflow-hidden">
      <div className="bg-gradient-primary p-6 text-primary-foreground">
        <div className="flex flex-col md:flex-row items-start md:items-center gap-6">
          <div className="relative">
            <Avatar className="w-24 h-24 border-4 border-primary-foreground shadow-lg">
              <AvatarImage
                src={avatarFile ? URL.createObjectURL(avatarFile) : profile?.avatar}
                alt={profile?.fullname} referrerPolicy="no-referrer"
                crossOrigin="anonymous"
              />
              <AvatarFallback className="bg-primary-foreground text-primary text-2xl font-bold">
                {profile?.fullname?.charAt(0)}
              </AvatarFallback>
            </Avatar>

            {/* Loading overlay khi đang upload avatar */}
            {isUploadingAvatar && (
              <div className="absolute inset-0 bg-background/90 backdrop-blur-sm rounded-full flex items-center justify-center border-4 border-primary-foreground">
                <div className="text-center">
                  <div className="relative">
                    <Loader2 className="w-10 h-10 animate-spin text-primary mx-auto mb-2" />
                    <div className="absolute inset-0 flex items-center justify-center">
                      <Upload className="w-5 h-5 text-primary animate-pulse" />
                    </div>
                  </div>
                  <span className="text-xs text-foreground font-semibold">Đang tải...</span>
                </div>
              </div>
            )}

            {/* Preview badge khi đã chọn ảnh mới */}
            {avatarFile && !isUploadingAvatar && isEditing && (
              <div className="absolute -top-2 -right-2 bg-primary text-primary-foreground text-xs px-2 py-1 rounded-full shadow-lg border-2 border-primary-foreground font-medium">
                Ảnh mới
              </div>
            )}

            {isEditing && !isUploadingAvatar && (
              <label className="absolute bottom-0 right-0 bg-background text-foreground p-2 rounded-full cursor-pointer hover:bg-card transition-colors shadow-lg border border-border">
                <Upload className="w-4 h-4" />
                <input
                  type="file"
                  accept="image/*"
                  onChange={handleAvatarChange}
                  className="hidden"
                  disabled={isUploadingAvatar}
                />
              </label>
            )}
          </div>

          <div className="flex-1">
            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
              <div className="flex-1">
                {isEditing ? (
                  <div className="space-y-3">
                    <Input
                      value={formData.fullname}
                      onChange={(e) => handleFormChange('fullname', e.target.value)}
                      placeholder="Họ và tên"
                      className="bg-primary-foreground text-primary"
                    />
                    <Input
                      value={formData.phone}
                      onChange={(e) => handleFormChange('phone', e.target.value)}
                      placeholder="Số điện thoại"
                      className="bg-primary-foreground text-primary"
                    />
                  </div>
                ) : (
                  <>
                    <h1 className="text-2xl md:text-3xl font-bold mb-2">{profile?.fullname}</h1>
                    <div className="flex items-center text-primary-foreground/80">
                      <Phone className="w-4 h-4 mr-2" />
                      <span>{profile?.phone || 'Chưa cập nhật số điện thoại'}</span>
                    </div>
                  </>
                )}
              </div>

              {!isEditing && (
                <div className="text-right">
                  <div className="text-primary-foreground/80 text-sm mb-1">Thành viên từ</div>
                  <div className="font-semibold">{formatDate(profile?.createdAt)}</div>
                </div>
              )}
            </div>
          </div>

          <div className="flex gap-2">
            {isEditing ? (
              <>
                <Button
                  variant="secondary"
                  className="bg-primary-foreground text-primary hover:bg-primary-foreground/90"
                  onClick={handleSave}
                  disabled={isUpdating || isUploadingAvatar}
                >
                  {isUpdating || isUploadingAvatar ? (
                    <>
                      <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                      {isUploadingAvatar ? 'Đang tải ảnh...' : 'Đang lưu...'}
                    </>
                  ) : (
                    <>
                      <Save className="w-4 h-4 mr-2" />
                      Lưu
                    </>
                  )}
                </Button>
                <Button
                  variant="secondary"
                  className="bg-primary-foreground text-primary hover:bg-primary-foreground/90"
                  onClick={handleCancel}
                  disabled={isUpdating || isUploadingAvatar}
                >
                  <X className="w-4 h-4 mr-2" />
                  Hủy
                </Button>
              </>
            ) : (
              <Button
                variant="secondary"
                className="bg-primary-foreground text-primary hover:bg-primary-foreground/90"
                onClick={handleEdit}
              >
                <Edit3 className="w-4 h-4 mr-2" />
                Chỉnh sửa
              </Button>
            )}
          </div>
        </div>
      </div>

      {/* Bio Section */}
      {(profile?.bio || isEditing) && (
        <CardContent className="pt-6 pb-4 border-b">
          <div className="flex items-center justify-between mb-3">
            <h3 className="font-semibold flex items-center">
              <User className="w-4 h-4 mr-2 text-primary" />
              Giới thiệu
            </h3>
          </div>
          {isEditing ? (
            <Textarea
              value={formData.bio}
              onChange={(e) => handleFormChange('bio', e.target.value)}
              placeholder="Viết về bản thân..."
              rows={4}
              className="resize-none"
            />
          ) : (
            <p className="text-muted-foreground leading-relaxed">{profile?.bio}</p>
          )}
        </CardContent>
      )}

      {/* Contact & Social Links Section */}
      <CardContent className="pt-6">
        {isEditing ? (
          <div className="space-y-4">
            <h3 className="font-semibold text-sm text-muted-foreground uppercase tracking-wide mb-4">
              Thông tin liên hệ & Mạng xã hội
            </h3>
            
            <div className="grid gap-4">
              <div>
                <Label htmlFor="address" className="flex items-center gap-2 mb-2">
                  <MapPin className="w-4 h-4 text-muted-foreground" />
                  Địa chỉ
                </Label>
                <Input
                  id="address"
                  value={formData.address}
                  onChange={(e) => handleFormChange('address', e.target.value)}
                  placeholder="VD: 123 Nguyễn Huệ, Q1, TP.HCM"
                />
              </div>

              <div>
                <Label htmlFor="website" className="flex items-center gap-2 mb-2">
                  <Globe className="w-4 h-4 text-muted-foreground" />
                  Website/Portfolio
                </Label>
                <Input
                  id="website"
                  type="url"
                  value={formData.website}
                  onChange={(e) => handleFormChange('website', e.target.value)}
                  placeholder="https://myportfolio.com"
                />
              </div>

              <div>
                <Label htmlFor="linkedin" className="flex items-center gap-2 mb-2">
                  <Linkedin className="w-4 h-4 text-muted-foreground" />
                  LinkedIn
                </Label>
                <Input
                  id="linkedin"
                  type="url"
                  value={formData.linkedin}
                  onChange={(e) => handleFormChange('linkedin', e.target.value)}
                  placeholder="https://linkedin.com/in/username"
                />
              </div>

              <div>
                <Label htmlFor="github" className="flex items-center gap-2 mb-2">
                  <Github className="w-4 h-4 text-muted-foreground" />
                  Github
                </Label>
                <Input
                  id="github"
                  type="url"
                  value={formData.github}
                  onChange={(e) => handleFormChange('github', e.target.value)}
                  placeholder="https://github.com/username"
                />
              </div>
            </div>
          </div>
        ) : (
          <>
            {(profile?.address || profile?.website || profile?.linkedin || profile?.github) && (
              <div className="space-y-3">
                {profile?.address && (
                  <div className="flex items-start gap-3 text-sm">
                    <MapPin className="w-4 h-4 text-muted-foreground mt-0.5 shrink-0" />
                    <span className="text-foreground">{profile.address}</span>
                  </div>
                )}
                
                {profile?.website && (
                  <div className="flex items-start gap-3 text-sm">
                    <Globe className="w-4 h-4 text-muted-foreground mt-0.5 shrink-0" />
                    <a
                      href={profile.website}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-primary hover:underline break-all"
                    >
                      {profile.website}
                    </a>
                  </div>
                )}
                
                {profile?.linkedin && (
                  <div className="flex items-start gap-3 text-sm">
                    <Linkedin className="w-4 h-4 text-muted-foreground mt-0.5 shrink-0" />
                    <a
                      href={profile.linkedin}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-primary hover:underline break-all"
                    >
                      {profile.linkedin.replace('https://', '').replace('http://', '')}
                    </a>
                  </div>
                )}
                
                {profile?.github && (
                  <div className="flex items-start gap-3 text-sm">
                    <Github className="w-4 h-4 text-muted-foreground mt-0.5 shrink-0" />
                    <a
                      href={profile.github}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-primary hover:underline break-all"
                    >
                      {profile.github.replace('https://', '').replace('http://', '')}
                    </a>
                  </div>
                )}
              </div>
            )}
          </>
        )}
      </CardContent>
    </Card>
  );
};
</file>

<file path="src/pages/auth/Register.jsx">
import { useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { useDispatch } from 'react-redux';
import { toast } from 'sonner';
import { register as registerService } from "@/services/authService";
import { loginSuccess } from '@/redux/authSlice';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import { Eye, EyeOff, Mail, Lock, User } from 'lucide-react';

const Register = () => {
  const [formData, setFormData] = useState({
    fullname: "",
    email: "",
    password: "",
    role: "candidate"
  });
  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState("");
  const [success, setSuccess] = useState("");
  const navigate = useNavigate();
  const dispatch = useDispatch();

  const handleChange = (e) => {
    const { name, value } = e.target;
    if (name === "role") return;
    setFormData((prev) => ({ ...prev, [name]: value }));
    // Clear error when user starts typing
    if (error) setError("");
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    // Validation
    if (!formData.fullname || !formData.email || !formData.password) {
      setError("Vui lòng điền đầy đủ thông tin.");
      return;
    }

    if (formData.password.length < 6) {
      setError("Mật khẩu phải có ít nhất 6 ký tự.");
      return;
    }

    setIsLoading(true);
    setError("");
    setSuccess("");

    try {
      const resp = await registerService(formData);
      console.log(resp);
      
      // Check if registration returns access token (auto-login)
      if (resp.accessToken) {
        // Auto-login after registration
        dispatch(loginSuccess({ accessToken: resp.accessToken }));
        
        setSuccess("Đăng ký thành công! Đang chuyển đến hoàn thiện hồ sơ...");
        toast.success("Đăng ký thành công!");

        // Reset form
        setFormData({
          fullname: "",
          email: "",
          password: "",
          role: "candidate"
        });

        // Redirect to onboarding for new users
        setTimeout(() => {
          navigate('/onboarding');
        }, 1500);
      } else {
        // Email verification required
        setSuccess(resp.message || "Đăng ký thành công! Vui lòng kiểm tra email để xác nhận.");
        toast.success("Đăng ký thành công! Vui lòng kiểm tra email để xác nhận.");

        // Reset form
        setFormData({
          fullname: "",
          email: "",
          password: "",
          role: "candidate"
        });

        // Redirect to login after 2 seconds
        setTimeout(() => {
          navigate('/login');
        }, 2000);
      }

    } catch (err) {
      console.log(err);
      const errorMessage = err.response?.data?.message || "Có lỗi xảy ra. Vui lòng thử lại.";
      setError(errorMessage);
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  const handleBackHome = () => {
    navigate('/');
  };

  return (
    <div className="min-h-screen relative overflow-hidden flex items-center justify-center p-4">
      {/* Multi-layer animated background */}
      <div className="absolute inset-0 bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50"></div>

      {/* Animated gradient orbs */}
      <div className="absolute inset-0 overflow-hidden">
        {/* Large gradient orbs */}
        <div className="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-emerald-400/30 via-teal-400/20 to-cyan-400/30 rounded-full blur-3xl animate-pulse"></div>
        <div className="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-blue-400/25 via-indigo-400/20 to-purple-400/25 rounded-full blur-3xl animate-pulse" style={{ animationDelay: '1s' }}></div>

        {/* Medium gradient orbs */}
        <div className="absolute top-20 right-20 w-72 h-72 bg-gradient-to-bl from-cyan-400/20 via-sky-400/15 to-blue-400/20 rounded-full blur-2xl animate-pulse" style={{ animationDelay: '2s' }}></div>
        <div className="absolute bottom-20 left-20 w-72 h-72 bg-gradient-to-tr from-green-400/20 via-emerald-400/15 to-teal-400/20 rounded-full blur-2xl animate-pulse" style={{ animationDelay: '3s' }}></div>

        {/* Small accent orbs */}
        <div className="absolute top-1/3 left-1/4 w-48 h-48 bg-gradient-to-r from-teal-400/25 to-cyan-400/25 rounded-full blur-xl animate-pulse" style={{ animationDelay: '1.5s' }}></div>
        <div className="absolute bottom-1/3 right-1/4 w-48 h-48 bg-gradient-to-l from-indigo-400/25 to-blue-400/25 rounded-full blur-xl animate-pulse" style={{ animationDelay: '2.5s' }}></div>

        {/* Floating geometric shapes */}
        <div className="absolute top-32 left-32 w-4 h-4 bg-gradient-to-r from-emerald-500/40 to-teal-500/40 rounded-full animate-bounce" style={{ animationDelay: '0.5s' }}></div>
        <div className="absolute top-48 right-48 w-3 h-3 bg-gradient-to-r from-cyan-500/40 to-blue-500/40 rounded-full animate-bounce" style={{ animationDelay: '1.2s' }}></div>
        <div className="absolute bottom-48 left-24 w-5 h-5 bg-gradient-to-r from-teal-500/40 to-emerald-500/40 rounded-full animate-bounce" style={{ animationDelay: '2.1s' }}></div>
        <div className="absolute bottom-32 right-32 w-2 h-2 bg-gradient-to-r from-sky-500/40 to-cyan-500/40 rounded-full animate-bounce" style={{ animationDelay: '3.3s' }}></div>

        {/* Additional small particles */}
        <div className="absolute top-64 left-64 w-1 h-1 bg-teal-500/50 rounded-full animate-ping" style={{ animationDelay: '0.8s' }}></div>
        <div className="absolute top-80 right-80 w-1 h-1 bg-cyan-500/50 rounded-full animate-ping" style={{ animationDelay: '1.6s' }}></div>
        <div className="absolute bottom-64 left-80 w-1 h-1 bg-emerald-500/50 rounded-full animate-ping" style={{ animationDelay: '2.4s' }}></div>
        <div className="absolute bottom-80 right-64 w-1 h-1 bg-blue-500/50 rounded-full animate-ping" style={{ animationDelay: '3.2s' }}></div>
      </div>

      {/* Overlay gradient for depth */}
      <div className="absolute inset-0 bg-gradient-to-t from-white/20 via-transparent to-white/10"></div>

      <div className="w-full max-w-md relative z-10">
        <Card className="border-0 shadow-2xl bg-card/95 backdrop-blur-xl glass transition-all duration-500 hover:shadow-3xl hover:bg-card/98">
          <CardHeader className="text-center pb-8 pt-10">
            <div className="mb-10">
              <Link to="/" className="inline-flex items-center gap-3 text-3xl font-bold text-foreground hover:opacity-80 transition-all duration-300 hover:scale-105">
                <div className="w-12 h-12 bg-gradient-primary rounded-2xl flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 hover:rotate-3">
                  <span className="text-white text-2xl">💼</span>
                </div>
                Career<span className="text-gradient-primary">Zone</span>
              </Link>
            </div>

            <div className="space-y-4" style={{ animationDelay: '0.4s' }}>
              <h1 className="text-4xl font-bold text-foreground bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text">
                Tạo tài khoản mới 🚀
              </h1>
              <p className="text-muted-foreground text-lg leading-relaxed">
                Điền thông tin dưới đây để bắt đầu hành trình sự nghiệp của bạn
              </p>
            </div>
          </CardHeader>

          <CardContent className="space-y-6">
            {/* Thông báo lỗi */}
            {error && (
              <div className="bg-destructive/10 border border-destructive/20 text-destructive px-4 py-3 rounded-lg text-sm">
                {error}
              </div>
            )}

            {/* Thông báo thành công */}
            {success && (
              <div className="bg-success/10 border border-success/20 text-success px-4 py-3 rounded-lg text-sm">
                {success}
              </div>
            )}

            <form onSubmit={handleSubmit} className="space-y-4">
              {/* Họ và tên */}
              <div className="space-y-2">
                <label htmlFor="fullname" className="text-sm font-medium text-foreground">
                  Họ và tên
                </label>
                <div className="relative">
                  <User className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                  <Input
                    id="fullname"
                    name="fullname"
                    type="text"
                    placeholder="r1@gmail.com"
                    value={formData.fullname}
                    onChange={handleChange}
                    required
                    disabled={isLoading}
                    className="pl-10 h-11"
                  />
                </div>
              </div>

              {/* Email */}
              <div className="space-y-2">
                <label htmlFor="email" className="text-sm font-medium text-foreground">
                  Email
                </label>
                <div className="relative">
                  <Mail className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                  <Input
                    id="email"
                    name="email"
                    type="email"
                    placeholder="r1@gmail.com"
                    value={formData.email}
                    onChange={handleChange}
                    required
                    disabled={isLoading}
                    className="pl-10 h-11"
                  />
                </div>
              </div>

              {/* Mật khẩu */}
              <div className="space-y-2">
                <label htmlFor="password" className="text-sm font-medium text-foreground">
                  Mật khẩu
                </label>
                <div className="relative">
                  <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                  <Input
                    id="password"
                    name="password"
                    type={showPassword ? "text" : "password"}
                    placeholder="••••••••••"
                    value={formData.password}
                    onChange={handleChange}
                    required
                    disabled={isLoading}
                    className="pl-10 pr-10 h-11"
                  />
                  <Button
                    type="button"
                    variant="ghost"
                    size="sm"
                    className="absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent"
                    onClick={() => setShowPassword(!showPassword)}
                    disabled={isLoading}
                  >
                    {showPassword ? (
                      <EyeOff className="h-4 w-4 text-muted-foreground" />
                    ) : (
                      <Eye className="h-4 w-4 text-muted-foreground" />
                    )}
                  </Button>
                </div>
              </div>

              {/* Nút đăng ký */}
              <Button
                type="submit"
                disabled={isLoading}
                className="w-full h-11 bg-gradient-primary hover:opacity-90 text-white font-medium transition-all duration-300"
              >
                {isLoading ? (
                  <div className="flex items-center">
                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                    Đang tạo tài khoản...
                  </div>
                ) : (
                  <div className="flex items-center">
                    <User className="mr-2 h-4 w-4" />
                    Tạo tài khoản
                  </div>
                )}
              </Button>
            </form>

    

            {/* Link đăng nhập */}
            <div className="text-center text-sm">
              <span className="text-muted-foreground">Đã có tài khoản? </span>
              <Link
                to="/login"
                className="text-primary hover:text-primary/80 font-medium transition-colors"
              >
                Đăng nhập ngay
              </Link>
            </div>
          </CardContent>
        </Card>

        {/* Nút quay về trang chủ */}
        <div className="mt-6 text-center">
          <Button
            variant="ghost"
            onClick={handleBackHome}
            className="text-muted-foreground hover:text-foreground transition-colors"
          >
            ← Quay về trang chủ
          </Button>
        </div>
      </div>
    </div>
  );
};

export default Register;
</file>

<file path="src/pages/dashboard/Dashboard.jsx">
import { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';
import { Button } from '../../components/ui/button';
import { Badge } from '../../components/ui/badge';
import { 
  Briefcase, 
  Heart, 
  FileText, 
  TrendingUp, 
  Users, 
  Eye,
  Clock,
  ArrowRight,
  Home,
  AlertCircle
} from 'lucide-react';
import { useSelector } from 'react-redux';
import { getSavedJobs } from '../../services/savedJobService';
import { getViewHistoryStats } from '../../services/viewHistoryService';
import { getProfileCompleteness } from '../../services/profileService';
import { ProfileCompletionBanner } from '../../components/profile/ProfileCompletionBanner';
import { getRecommendations } from '../../services/recommendationService';
import { useOnboardingStatus } from '../../hooks/useOnboardingStatus';
import FeaturedCompanies from '../../components/dashboard/FeaturedCompanies';

const Dashboard = () => {
  const navigate = useNavigate();
  const { profile } = useSelector((state) => state.auth);
  const [stats, setStats] = useState({
    appliedJobs: 12,
    savedJobs: 0, // Sẽ được cập nhật từ API
    viewHistory: 0, // Lịch sử xem
    profileViews: 156,
    suggestedJobs: 0
  });
  const [isLoadingStats, setIsLoadingStats] = useState(true);
  const [profileCompleteness, setProfileCompleteness] = useState(null);
  const [isLoadingCompleteness, setIsLoadingCompleteness] = useState(true);
  const [recommendedJobs, setRecommendedJobs] = useState([]);
  const [isLoadingRecommendations, setIsLoadingRecommendations] = useState(true);
  
  // Use Redux hook for onboarding status (cached, no API call needed)
  const { needsOnboarding, profileCompleteness: onboardingProfileCompleteness } = useOnboardingStatus();

  useEffect(() => {
    const fetchStats = async () => {
      try {
        setIsLoadingStats(true);
        // Lấy số lượng công việc đã lưu từ API
        const savedJobsResponse = await getSavedJobs({ page: 1, limit: 1 });
        
        if (savedJobsResponse.data.success) {
          const meta = savedJobsResponse.data.meta;
          const totalSavedJobs = meta.totalItems || 0; // Lấy từ meta.totalItems
          
          setStats(prev => ({
            ...prev,
            savedJobs: totalSavedJobs
          }));
        }

        // Lấy thống kê lịch sử xem
        try {
          const viewHistoryResponse = await getViewHistoryStats();
          if (viewHistoryResponse.data) {
            setStats(prev => ({
              ...prev,
              viewHistory: viewHistoryResponse.data.totalViews || 0
            }));
          }
        } catch (err) {
          console.error('Lỗi khi lấy thống kê lịch sử xem:', err);
          // Không quan trọng nếu API này fail
        }
      } catch (err) {
        console.error('Lỗi khi lấy thống kê:', err);
        // Giữ nguyên giá trị mặc định nếu có lỗi
      } finally {
        setIsLoadingStats(false);
      }
    };

    fetchStats();
  }, []);

  useEffect(() => {
    const fetchProfileCompleteness = async () => {
      try {
        setIsLoadingCompleteness(true);
        const response = await getProfileCompleteness(false);
        if (response.success && response.data) {
          setProfileCompleteness(response.data);
        }
      } catch (err) {
        console.error('Lỗi khi lấy thông tin độ hoàn thiện hồ sơ:', err);
        // Không hiển thị banner nếu có lỗi
      } finally {
        setIsLoadingCompleteness(false);
      }
    };

    fetchProfileCompleteness();
  }, []);

  // Redirect to onboarding if needed (handled by GlobalOnboardingChecker in AppRouter)
  // No need to check here anymore, Redux already has the status

  // Fetch recommended jobs based on profile completeness
  useEffect(() => {
    const fetchRecommendations = async () => {
      // Only fetch if profile completeness is >= 60%
      if (!profileCompleteness || profileCompleteness.percentage < 60) {
        setIsLoadingRecommendations(false);
        return;
      }

      try {
        setIsLoadingRecommendations(true);
        const response = await getRecommendations({ page: 1, limit: 6 });
        if (response.success && response.data) {
          setRecommendedJobs(response.data.jobs || []);
          setStats(prev => ({
            ...prev,
            suggestedJobs: response.data.meta?.totalItems || response.data.jobs?.length || 0
          }));
        }
      } catch (err) {
        console.error('Lỗi khi lấy gợi ý việc làm:', err);
        // Don't show error, just keep empty recommendations
      } finally {
        setIsLoadingRecommendations(false);
      }
    };

    if (!isLoadingCompleteness) {
      fetchRecommendations();
    }
  }, [profileCompleteness, isLoadingCompleteness]);

  const quickActions = [
    {
      title: 'Gợi ý việc làm',
      description: 'Khám phá những cơ hội phù hợp với bạn',
      href: '/dashboard/job-suggestions',
      icon: <Briefcase className="h-6 w-6" />,
      color: 'bg-blue-500',
      count: stats.suggestedJobs
    },
    {
      title: 'Việc làm đã lưu',
      description: 'Xem lại những vị trí bạn quan tâm',
      href: '/dashboard/saved-jobs',
      icon: <Heart className="h-6 w-6" />,
      color: 'bg-red-500',
      count: stats.savedJobs
    },
    {
      title: 'Lịch sử xem',
      description: 'Tin tuyển dụng bạn đã xem gần đây',
      href: '/dashboard/view-history',
      icon: <Clock className="h-6 w-6" />,
      color: 'bg-purple-500',
      count: stats.viewHistory
    },
    {
      title: 'Đơn ứng tuyển',
      description: 'Theo dõi trạng thái ứng tuyển',
      href: '/dashboard/applications',
      icon: <FileText className="h-6 w-6" />,
      color: 'bg-green-500',
      count: stats.appliedJobs
    }
  ];

  return (
    <div className="space-y-6">
      {/* Welcome Section */}
      <div className="bg-linear-to-r from-primary to-primary/80 rounded-lg p-6 text-white">
        <h1 className="text-2xl font-bold mb-2">
          Chào mừng trở lại, {profile?.fullname}! 👋
        </h1>
        <p className="text-primary-foreground/90">
          Hãy khám phá những cơ hội nghề nghiệp mới dành cho bạn
        </p>
      </div>

      {/* Profile Completion Banner */}
      {!isLoadingCompleteness && profileCompleteness && profileCompleteness.percentage < 100 && (
        <ProfileCompletionBanner 
          profileCompleteness={profileCompleteness} 
          profile={profile}
        />
      )}

      {/* Stats Overview */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Đơn ứng tuyển</CardTitle>
            <FileText className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.appliedJobs}</div>
            <p className="text-xs text-muted-foreground">+2 trong tuần này</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Việc làm đã lưu</CardTitle>
            <Heart className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">
              {isLoadingStats ? (
                <div className="animate-pulse bg-gray-200 h-6 w-8 rounded"></div>
              ) : (
                stats.savedJobs
              )}
            </div>
            <p className="text-xs text-muted-foreground">
              {stats.savedJobs > 0 ? 'Cập nhật từ API' : 'Chưa có việc làm nào'}
            </p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Lượt xem hồ sơ</CardTitle>
            <Eye className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.profileViews}</div>
            <p className="text-xs text-muted-foreground">+12% so với tháng trước</p>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
            <CardTitle className="text-sm font-medium">Gợi ý mới</CardTitle>
            <TrendingUp className="h-4 w-4 text-muted-foreground" />
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stats.suggestedJobs}</div>
            <p className="text-xs text-muted-foreground">Cập nhật hôm nay</p>
          </CardContent>
        </Card>
      </div>

      {/* Quick Actions */}
      <div>
        <h2 className="text-2xl font-bold mb-4">Hành động nhanh</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {quickActions.map((action, index) => (
            <Link key={index} to={action.href}>
              <Card className="group hover:shadow-lg transition-all duration-300 cursor-pointer hover:border-primary/50">
                <CardHeader className="flex flex-row items-center space-y-0 pb-2">
                  <div className={`p-2 rounded-lg ${action.color} text-white mr-4`}>
                    {action.icon}
                  </div>
                  <div className="flex-1">
                    <CardTitle className="text-lg group-hover:text-primary transition-colors">
                      {action.title}
                    </CardTitle>
                    <p className="text-sm text-muted-foreground">
                      {action.description}
                    </p>
                  </div>
                  <div className="text-right">
                    <div className="text-2xl font-bold text-primary">
                      {(action.title === 'Việc làm đã lưu' || action.title === 'Lịch sử xem') && isLoadingStats ? (
                        <div className="animate-pulse bg-gray-200 h-6 w-6 rounded"></div>
                      ) : (
                        action.count
                      )}
                    </div>
                    <ArrowRight className="h-4 w-4 text-muted-foreground group-hover:text-primary transition-colors" />
                  </div>
                </CardHeader>
              </Card>
            </Link>
          ))}
        </div>
      </div>

      {/* Featured Companies & Recommended Jobs Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Featured Companies - Takes 1 column */}
        <div className="lg:col-span-1">
          <FeaturedCompanies />
        </div>

        {/* Recommended Jobs - Takes 2 columns */}
        {profileCompleteness && profileCompleteness.percentage >= 60 ? (
          <div className="lg:col-span-2">
            <div className="flex justify-between items-center mb-4">
              <h2 className="text-2xl font-bold">Việc làm được gợi ý cho bạn</h2>
              {recommendedJobs.length > 0 && (
                <Link to="/dashboard/job-suggestions">
                  <Button variant="link" className="text-primary">
                    Xem tất cả <ArrowRight className="ml-2 h-4 w-4" />
                  </Button>
                </Link>
              )}
            </div>
          
          {isLoadingRecommendations ? (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {[1, 2, 3, 4].map((i) => (
                <Card key={i} className="animate-pulse">
                  <CardContent className="p-6">
                    <div className="h-6 bg-gray-200 rounded mb-2"></div>
                    <div className="h-4 bg-gray-200 rounded mb-4"></div>
                    <div className="h-4 bg-gray-200 rounded w-2/3"></div>
                  </CardContent>
                </Card>
              ))}
            </div>
          ) : recommendedJobs.length > 0 ? (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {recommendedJobs.slice(0, 6).map((job) => (
                <Link key={job._id} to={`/jobs/${job._id}`}>
                  <Card className="h-full hover:shadow-lg transition-shadow cursor-pointer">
                    <CardContent className="p-6">
                      <h3 className="font-bold text-lg mb-2 line-clamp-2">{job.title}</h3>
                      <p className="text-sm text-muted-foreground mb-2">{job.company?.name}</p>
                      <div className="flex items-center text-sm text-muted-foreground mb-2">
                        <span>📍 {job.location?.province || job.location?.city}</span>
                      </div>
                      <div className="text-primary font-semibold">
                        {job.minSalary && job.maxSalary 
                          ? `${job.minSalary} - ${job.maxSalary} triệu`
                          : 'Thỏa thuận'}
                      </div>
                      {job.matchReason && (
                        <div className="mt-3 pt-3 border-t">
                          <p className="text-xs text-muted-foreground">
                            <span className="font-medium">Phù hợp:</span> {job.matchReason}
                          </p>
                        </div>
                      )}
                    </CardContent>
                  </Card>
                </Link>
              ))}
            </div>
          ) : (
            <Card>
              <CardContent className="p-6">
                <div className="flex items-center justify-center py-8 text-muted-foreground">
                  <div className="text-center">
                    <Briefcase className="h-12 w-12 mx-auto mb-4 opacity-50" />
                    <p className="font-medium mb-2">Chưa có gợi ý việc làm</p>
                    <p className="text-sm">Hệ thống đang tìm kiếm những công việc phù hợp với bạn</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          )}
          </div>
        ) : (
          <div className="lg:col-span-2">
            <Card className="border-orange-200 bg-orange-50">
              <CardContent className="p-6">
                <div className="flex items-start gap-4">
                  <AlertCircle className="h-6 w-6 text-orange-600 flex-shrink-0 mt-1" />
                  <div className="flex-1">
                    <h3 className="font-semibold text-orange-900 mb-2">
                      Hoàn thiện hồ sơ để nhận gợi ý việc làm
                    </h3>
                    <p className="text-sm text-orange-800 mb-4">
                      Hồ sơ của bạn đang ở mức {profileCompleteness?.percentage || 0}%. 
                      Hoàn thiện tối thiểu 60% để nhận được gợi ý việc làm phù hợp từ hệ thống AI.
                    </p>
                    <Link to="/profile">
                      <Button variant="default" size="sm">
                        Hoàn thiện hồ sơ ngay
                      </Button>
                    </Link>
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        )}
      </div>

      {/* Recent Activity */}
      <div>
        <h2 className="text-2xl font-bold mb-4">Hoạt động gần đây</h2>
        <Card>
          <CardContent className="p-6">
            <div className="flex items-center justify-center py-8 text-muted-foreground">
              <div className="text-center">
                <Home className="h-12 w-12 mx-auto mb-4 opacity-50" />
                <p>Chưa có hoạt động nào gần đây</p>
                <p className="text-sm">Bắt đầu tìm kiếm việc làm để xem hoạt động ở đây</p>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
};

export default Dashboard;
</file>

<file path="src/pages/notification/NotificationsPage.jsx">
import { useState, useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { 
  fetchNotifications, 
  markNotificationAsRead, 
  markAllNotificationsAsRead 
} from '@/redux/notificationSlice';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';
import { EmptyState } from '@/components/common/EmptyState';
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination"
import { toast } from 'sonner';
import { formatDistanceToNow } from 'date-fns';
import { vi } from 'date-fns/locale';
import { cn } from '@/lib/utils';
import { BellRing, CheckCheck, BellPlus } from 'lucide-react';
import useFirebaseMessaging from '@/hooks/useFirebaseMessaging';
import NotificationPermissionGuide from '@/components/common/NotificationPermissionGuide';
import NotificationPermissionAlert from '@/components/common/NotificationPermissionAlert';

const NotificationItem = ({ notification, onMarkAsRead }) => {
  const handleClick = () => {
    if (!notification.isRead) {
      onMarkAsRead(notification._id);
    }
  };

  return (
    <div 
      className={cn(
        "flex items-start gap-4 p-4 border-b last:border-b-0 cursor-pointer hover:bg-muted/50 transition-colors",
        !notification.isRead && "bg-green-50"
      )}
      onClick={handleClick}
    >
      <div className="shrink-0">
        <div className={cn(
          "w-10 h-10 rounded-full flex items-center justify-center",
          !notification.isRead ? "bg-primary text-primary-foreground" : "bg-muted text-muted-foreground"
        )}>
          <BellRing size={20} />
        </div>
      </div>
      <div className="grow">
        <p className="font-semibold">{notification.title}</p>
        <p className="text-sm text-muted-foreground">{notification.message}</p>
        <p className="text-xs text-muted-foreground mt-1">
          {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true, locale: vi })}
        </p>
      </div>
      {!notification.isRead && (
        <div className="shrink-0 self-center">
          <div className="w-2.5 h-2.5 rounded-full bg-primary"></div>
        </div>
      )}
    </div>
  );
};

const NotificationsPage = () => {
  const [page, setPage] = useState(1);
  const limit = 10;
  const [showPermissionGuide, setShowPermissionGuide] = useState(false);
  const dispatch = useDispatch();
  const { notifications, pagination, loading, error } = useSelector((state) => state.notifications);
  const { requestPermission, permissionDenied } = useFirebaseMessaging({
    onPermissionDenied: () => {
      setShowPermissionGuide(true);
    }
  });

  // Load notifications khi component mount hoặc page thay đổi
  useEffect(() => {
    dispatch(fetchNotifications({ page, limit }));
  }, [dispatch, page, limit]);

  const handleMarkAllRead = async () => {
    try {
      await dispatch(markAllNotificationsAsRead()).unwrap();
      toast.success("Đã đánh dấu tất cả là đã đọc.");
    } catch (error) {
      toast.error("Đã có lỗi xảy ra.");
    }
  };

  const handleMarkAsRead = async (notificationId) => {
    try {
      await dispatch(markNotificationAsRead(notificationId)).unwrap();
    } catch (error) {
      toast.error("Không thể đánh dấu đã đọc.");
    }
  };

  const refetch = () => {
    dispatch(fetchNotifications({ page, limit }));
  };

  const renderPagination = () => {
    if (!notifications || pagination.pages <= 1) return null;

    return (
      <Pagination className="mt-6">
        <PaginationContent>
          <PaginationItem>
            <PaginationPrevious
              href="#"
              onClick={(e) => { e.preventDefault(); setPage(p => Math.max(1, p - 1)); }}
              disabled={page === 1}
            />
          </PaginationItem>
          {[...Array(pagination.pages).keys()].map(p => (
            <PaginationItem key={p}>
              <PaginationLink
                href="#"
                onClick={(e) => { e.preventDefault(); setPage(p + 1); }}
                isActive={page === p + 1}
              >
                {p + 1}
              </PaginationLink>
            </PaginationItem>
          ))}
          <PaginationItem>
            <PaginationNext
              href="#"
              onClick={(e) => { e.preventDefault(); setPage(p => Math.min(pagination.pages, p + 1)); }}
              disabled={page === pagination.pages}
            />
          </PaginationItem>
        </PaginationContent>
      </Pagination>
    );
  };

  const renderContent = () => {
    if (loading) {
      return (
        <div className="space-y-4">
          {[...Array(5)].map((_, i) => (
            <div key={i} className="flex items-start gap-4 p-4">
              <Skeleton className="w-10 h-10 rounded-full" />
              <div className="grow space-y-2">
                <Skeleton className="h-4 w-3/4" />
                <Skeleton className="h-4 w-full" />
                <Skeleton className="h-3 w-1/4" />
              </div>
            </div>
          ))}
        </div>
      );
    }

    if (error) {
      return <ErrorState onRetry={refetch} message={error} />;
    }

    if (!notifications || notifications.length === 0) {
      return <EmptyState message="Bạn không có thông báo nào." />;
    }

    return (
      <div>
        {notifications.map(notification => (
          <NotificationItem 
            key={notification._id} 
            notification={notification}
            onMarkAsRead={handleMarkAsRead} 
          />
        ))}
      </div>
    );
  };

  return (
    <div className="container py-8">
        <Card className="max-w-4xl mx-auto">
            <CardHeader className="flex flex-row items-center justify-between">
                <CardTitle className="text-2xl">Thông báo của bạn</CardTitle>
                <div className="flex items-center gap-2">
                  <Button
                      variant="outline"
                      size="sm"
                      onClick={requestPermission}
                  >
                      <BellPlus className="mr-2 h-4 w-4" />
                      Bật thông báo đẩy
                  </Button>
                  <Button
                      variant="ghost"
                      size="sm"
                      onClick={handleMarkAllRead}
                      disabled={loading || (notifications && !notifications.some(n => !n.isRead))}
                  >
                      <CheckCheck className="mr-2 h-4 w-4" />
                      Đánh dấu tất cả đã đọc
                  </Button>
                </div>
            </CardHeader>
            
            {/* Permission Denied Alert */}
            {permissionDenied && (
              <div className="px-6 pb-4">
                <NotificationPermissionAlert 
                  onShowGuide={() => setShowPermissionGuide(true)}
                />
              </div>
            )}
            
            <CardContent className="p-0">
                {renderContent()}
            </CardContent>
        </Card>
        {renderPagination()}
        
        {/* Permission Guide Modal */}
        <NotificationPermissionGuide
          isOpen={showPermissionGuide}
          onClose={() => setShowPermissionGuide(false)}
          onRetry={requestPermission}
        />
    </div>
  );
};

export default NotificationsPage;
</file>

<file path="src/components/sections/PopularCategories.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Cpu, Megaphone, Palette, Landmark, Users, ShoppingCart, BookOpen, Stethoscope, ArrowRight, Briefcase } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '../ui/card';
import { Button } from '../ui/button';
import { Badge } from '../ui/badge';
import { SectionHeader } from '../common/SectionHeader';
import apiClient from '../../services/apiClient';

// Icon mapping cho các category
const categoryIcons = {
  'SOFTWARE_DEVELOPMENT': <Cpu className="h-10 w-10 text-primary" />,
  'MARKETING': <Megaphone className="h-10 w-10 text-primary" />,
  'DESIGN': <Palette className="h-10 w-10 text-primary" />,
  'FINANCE': <Landmark className="h-10 w-10 text-primary" />,
  'HUMAN_RESOURCES': <Users className="h-10 w-10 text-primary" />,
  'SALES': <ShoppingCart className="h-10 w-10 text-primary" />,
  'EDUCATION': <BookOpen className="h-10 w-10 text-primary" />,
  'HEALTHCARE': <Stethoscope className="h-10 w-10 text-primary" />,
};

// Tên tiếng Việt cho categories
const categoryNames = {
  'SOFTWARE_DEVELOPMENT': 'Phát triển phần mềm',
  'MARKETING': 'Marketing & PR',
  'DESIGN': 'Thiết kế',
  'FINANCE': 'Tài chính & Kế toán',
  'HUMAN_RESOURCES': 'Nhân sự',
  'SALES': 'Bán hàng',
  'EDUCATION': 'Giáo dục',
  'HEALTHCARE': 'Y tế',
  'ACCOUNTING': 'Kế toán',
  'DATA_SCIENCE': 'Khoa học dữ liệu',
  'IT': 'Công nghệ thông tin',
  'CUSTOMER_SERVICE': 'Dịch vụ khách hàng',
  'GRAPHIC_DESIGN': 'Thiết kế đồ họa',
  'WEB_DEVELOPMENT': 'Phát triển Web',
};

const PopularCategories = () => {
  const navigate = useNavigate();
  const [categories, setCategories] = useState([]);
  const [loading, setLoading] = useState(true);

  // Handler khi click vào một danh mục
  const handleCategoryClick = (categoryKey) => {
    navigate(`/jobs/search?category=${categoryKey}`);
  };

  // Handler cho nút "Xem tất cả danh mục"
  const handleViewAllCategories = () => {
    navigate('/jobs/search');
  };

  useEffect(() => {
    const fetchCategories = async () => {
      try {
        // Gọi API không cần authentication
        const response = await apiClient.get('/analytics/job-categories');
        console.log(response.data);
        if (response.data.success) {
          const categoryData = response.data.data.map(cat => ({
            name: categoryNames[cat.category] || cat.category,
            jobs: `${cat.count.toLocaleString()} việc làm`,
            icon: categoryIcons[cat.category] || <Briefcase className="h-10 w-10 text-primary" />,
            category: cat.category
          }));
          setCategories(categoryData);
        }
      } catch (error) {
        console.error('Failed to fetch categories:', error);
        // Fallback to empty array or show error
      } finally {
        setLoading(false);
      }
    };

    fetchCategories();
  }, []);
  return (
    <section className="py-20 bg-gradient-to-b from-muted/30 to-background">
      <div className="container">
        <SectionHeader
          badgeText="🎯 Lĩnh vực hot"
          title={<>Danh mục <span className="bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">phổ biến</span></>}
          description="Khám phá các lĩnh vực việc làm hot nhất hiện nay."
          className="mb-12"
        />

        {loading ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {[...Array(8)].map((_, i) => (
              <Card key={i} classNcategoriesame="animate-pulse bg-muted h-48" />
            ))}
          </div>
        ) : categories.length === 0 ? (
          <div className="text-center py-12 text-muted-foreground">
            Không có dữ liệu danh mục
          </div>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {categories.map((category, index) => (
              <Card 
                key={index} 
                className="group bg-card hover:bg-gradient-to-br hover:from-emerald-50 hover:to-teal-50 dark:hover:from-emerald-950/30 dark:hover:to-teal-950/30 shadow-md hover:shadow-xl rounded-2xl p-6 cursor-pointer transition-all duration-300 border hover:border-emerald-200 dark:hover:border-emerald-800"
                onClick={() => handleCategoryClick(category.category)}
              >
                <CardHeader>
                  <div className="mx-auto bg-emerald-50 dark:bg-emerald-950/30 group-hover:bg-gradient-to-br group-hover:from-emerald-500 group-hover:to-teal-500 w-20 h-20 rounded-2xl flex items-center justify-center transition-all duration-300 shadow-sm group-hover:shadow-lg">
                    <div className="text-emerald-600 dark:text-emerald-400 group-hover:text-white transform group-hover:scale-110 transition-all duration-300">
                      {category.icon}
                    </div>
                  </div>
                </CardHeader>
                <CardContent>
                  <CardTitle className="text-lg font-bold text-foreground mb-2 group-hover:text-emerald-700 dark:group-hover:text-emerald-400 transition-colors text-center">
                    {category.name}
                  </CardTitle>
                  <p className="text-muted-foreground font-medium text-center text-sm">
                    {category.jobs}
                  </p>
                </CardContent>
              </Card>
            ))}
          </div>
        )}

        <div className="text-center mt-12">
          <Button 
            size="lg" 
            variant="outline" 
            className="border-2 border-emerald-600 text-emerald-600 hover:bg-emerald-600 hover:text-white px-8 py-6 rounded-2xl font-semibold transition-all duration-300 shadow-md hover:shadow-lg"
            onClick={handleViewAllCategories}
          >
            Xem tất cả danh mục
            <ArrowRight className="ml-2 h-5 w-5" />
          </Button>
        </div>
      </div>
    </section>
  );
};

export default PopularCategories;
</file>

<file path="src/pages/jobs/components/SearchInterface/JobSearchBar.jsx">
import React, { useRef, useImperativeHandle, forwardRef, useEffect, useState, useCallback } from 'react';
import { Search } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { useDispatch, useSelector } from 'react-redux';
import { cn } from '@/lib/utils';
import { useDebounce } from '@/hooks/useDebounce';
// --- THAY ĐỔI 1: Import hook mới ---
import { useSonioxSearch } from '@/hooks/useSonioxSearch';
import VoiceSearchButton from '@/components/common/VoiceSearchButton';
import MicrophonePermissionGuide from '@/components/common/MicrophonePermissionGuide';
import MicrophonePermissionAlert from '@/components/common/MicrophonePermissionAlert';
// Search history imports
import SearchHistoryDropdown from '@/components/jobs/SearchHistoryDropdown';
import {
  fetchSearchHistory,
  saveSearchHistory,
  deleteSearchHistory,
  selectSearchHistory
} from '@/redux/searchHistorySlice';
import { getJobTitleSuggestions } from '@/services/jobService';
import { toast } from 'sonner';

const JobSearchBar = forwardRef(({
  placeholder = "Tìm kiếm công việc, kỹ năng, công ty...",
  initialQuery = "",
  onSearch,
  inputProps = {}
}, ref) => {
  const inputRef = useRef(null);
  const [isActive, setIsActive] = useState(false);
  const dispatch = useDispatch();
  const searchHistory = useSelector(selectSearchHistory);

  // --- THAY ĐỔI 2: State management cho search history ---
  const [query, setQuery] = useState(initialQuery || '');
  const [showDropdown, setShowDropdown] = useState(false);
  const [selectedIndex, setSelectedIndex] = useState(-1);
  const [suggestions, setSuggestions] = useState({
    history: [],
    autocomplete: []
  });
  const [isLoadingAutocomplete, setIsLoadingAutocomplete] = useState(false);

  // Debounce query để tối ưu hóa API calls
  const debouncedQuery = useDebounce(query, 300);

  // --- THAY ĐỔI 3: State cho microphone permission guide ---
  const [showMicPermissionGuide, setShowMicPermissionGuide] = useState(false);
  const [micPermissionDenied, setMicPermissionDenied] = useState(false);

  // --- THAY ĐỔI 4: Khởi tạo hook Soniox ---
  const {
    state: voiceState,
    isListening,
    fullTranscript,
    permissionDenied: voicePermissionDenied,
    isSupported: isVoiceSupported,
    toggleSearch: toggleVoiceSearch
  } = useSonioxSearch({
    onResult: (text) => {
      setQuery(text);
      handleSearch(text);
    },
    onPermissionDenied: () => {
      setMicPermissionDenied(true);
      setShowMicPermissionGuide(true);
    }
  });

  // Sync permission denied state
  useEffect(() => {
    if (voicePermissionDenied) {
      setMicPermissionDenied(true);
    }
  }, [voicePermissionDenied]);

  // Cập nhật input với transcript real-time từ Soniox
  useEffect(() => {
    if (isListening) {
      setQuery(fullTranscript);
    }
  }, [fullTranscript, isListening]);

  // Load search history on mount
  useEffect(() => {
    dispatch(fetchSearchHistory({ limit: 10, page: 1 }));
  }, [dispatch]);

  // Sync with initialQuery
  useEffect(() => {
    if (initialQuery && initialQuery !== query) {
      setQuery(initialQuery);
    }
  }, [initialQuery]);

  // Effect for history suggestions (no debounce) - Filter on frontend
  useEffect(() => {
    if (query.trim().length > 0) {
      const filteredHistory = Array.isArray(searchHistory)
        ? searchHistory.filter(item => item.query.toLowerCase().includes(query.toLowerCase()))
        : [];
      setSuggestions(prev => ({
        ...prev,
        history: filteredHistory.slice(0, 5)
      }));
    } else {
      // When query is empty, show recent history
      setSuggestions(prev => ({
        ...prev,
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : []
      }));
    }
  }, [query, searchHistory]);

  // Effect for autocomplete suggestions (with debounce)
  useEffect(() => {
    // Clear autocomplete if query is too short
    if (!debouncedQuery || debouncedQuery.trim().length < 2) {
      setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      setIsLoadingAutocomplete(false);
      return;
    }

    // Set loading state immediately
    setIsLoadingAutocomplete(true);

    // Debounce API call for autocomplete only
    const fetchAutocomplete = async () => {
      try {
        const autocompleteResults = await getJobTitleSuggestions(debouncedQuery, 5).catch(() => ({ data: [] }));
        setSuggestions(prev => ({
          ...prev,
          autocomplete: Array.isArray(autocompleteResults.data) ? autocompleteResults.data : []
        }));
      } catch (error) {
        console.error('Error fetching autocomplete suggestions:', error);
        setSuggestions(prev => ({ ...prev, autocomplete: [] }));
      } finally {
        setIsLoadingAutocomplete(false);
      }
    };

    fetchAutocomplete();
  }, [debouncedQuery]);

  /**
   * Handle focus - show history when input is empty
   */
  const handleFocus = useCallback(() => {
    setIsActive(true);
    // Always show dropdown on focus
    setShowDropdown(true);
    // Load history immediately if query is empty (even if empty array to show empty state)
    if (!query.trim()) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [query, searchHistory]);

  /**
   * Handle input change
   */
  const handleInputChange = useCallback((value) => {
    setQuery(value);
    setShowDropdown(true);
    if (!value || value.trim().length === 0) {
      setSuggestions({
        history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
        autocomplete: []
      });
    }
  }, [searchHistory]);

  /**
   * Handle search submission
   */
  const handleSearch = useCallback(async (searchQuery = query) => {
    const trimmedQuery = searchQuery.trim();

    setIsActive(false);
    setShowDropdown(false);

    if (inputRef.current) {
      inputRef.current.blur();
    }

    // Save to history (only query, no filters)
    try {
      await dispatch(saveSearchHistory({
        query: trimmedQuery
      })).unwrap();
      // Show success toast for save operation
    } catch (error) {
      // Show error toast but don't interrupt search flow
      toast.error('Không thể lưu lịch sử tìm kiếm');
      console.error('Failed to save search history:', error);
    }

    // Perform search
    if (onSearch) {
      onSearch(trimmedQuery);
    }
  }, [query, dispatch, onSearch]);

  /**
   * Handle suggestion click
   */
  const handleSuggestionClick = useCallback((suggestion, isHistory) => {
    if (isHistory) {
      // Apply search from history (only query)
      setQuery(suggestion.query || '');
      setShowDropdown(false);
      setSelectedIndex(-1);

      // Perform search
      handleSearch(suggestion.query || '');
    } else {
      // Just set query for autocomplete
      setQuery(suggestion.title);
      setShowDropdown(false);
      setSelectedIndex(-1);
      handleSearch(suggestion.title);
    }
  }, [handleSearch]);

  /**
   * Handle delete history entry with optimistic update
   */
  const handleDeleteHistory = useCallback(async (e, entryId) => {
    e.stopPropagation();

    // Optimistic update: Xóa ngay trên UI
    setSuggestions(prev => ({
      ...prev,
      history: prev.history.filter(h => h._id !== entryId)
    }));

    // Hiển thị toast ngay lập tức
    toast.success('Đã xóa lịch sử tìm kiếm');

    try {
      // Gọi API ở background (không cần await)
      dispatch(deleteSearchHistory(entryId));
    } catch (error) {
      // Nếu có lỗi, không cần làm gì vì đã xóa trên UI
      console.error('Error deleting history:', error);
    }
  }, [dispatch]);

  /**
   * Handle keyboard navigation
   */
  const handleKeyDown = useCallback((event) => {
    const totalSuggestions = suggestions.history.length + suggestions.autocomplete.length;

    if (!showDropdown || totalSuggestions === 0) {
      if (event.key === 'Enter') {
        event.preventDefault();
        handleSearch();
      }
      return;
    }

    switch (event.key) {
      case 'ArrowDown':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev < totalSuggestions - 1 ? prev + 1 : 0
        );
        break;

      case 'ArrowUp':
        event.preventDefault();
        setSelectedIndex(prev =>
          prev > 0 ? prev - 1 : totalSuggestions - 1
        );
        break;

      case 'Enter':
        event.preventDefault();
        if (selectedIndex >= 0 && selectedIndex < totalSuggestions) {
          // Determine if it's history or autocomplete
          if (selectedIndex < suggestions.history.length) {
            const selectedSuggestion = suggestions.history[selectedIndex];
            handleSuggestionClick(selectedSuggestion, true);
          } else {
            const autocompleteIndex = selectedIndex - suggestions.history.length;
            const selectedSuggestion = suggestions.autocomplete[autocompleteIndex];
            handleSuggestionClick(selectedSuggestion, false);
          }
        } else {
          handleSearch();
        }
        break;

      case 'Escape':
        event.preventDefault();
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      case 'Tab':
        setShowDropdown(false);
        setSelectedIndex(-1);
        break;

      default:
        break;
    }
  }, [showDropdown, suggestions, selectedIndex, handleSuggestionClick, handleSearch]);

  const handleSubmit = (event) => {
    event.preventDefault();
    handleSearch();
  };

  const handleSearchButtonClick = () => {
    if (inputRef.current) {
      inputRef.current.blur();
    }
    handleSearch();
  };

  const closeDropdown = useCallback(() => {
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, []);

  const clear = useCallback(() => {
    setQuery('');
    setSuggestions({
      history: Array.isArray(searchHistory) ? searchHistory.slice(0, 10) : [],
      autocomplete: []
    });
    setShowDropdown(false);
    setSelectedIndex(-1);
  }, [searchHistory]);

  useImperativeHandle(ref, () => ({
    focus: () => inputRef.current?.focus(),
    clear,
    getValue: () => query,
    setValue: handleInputChange
  }));

  return (
    <div className={cn(
      "relative w-full transition-all duration-500",
      isListening && "scale-105"
    )}>
      <form onSubmit={handleSubmit} className="relative flex gap-3">
        <div className="relative flex-1">
          <Search className={cn(
            "absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 z-10",
            "transition-all duration-300",
            isActive ? "text-primary scale-110" : "text-muted-foreground"
          )} />

          <div className={cn(
            "relative rounded-xl transition-all duration-500",
            isActive && "shadow-lg shadow-primary/20",
            isListening && "shadow-2xl shadow-red-500/50 scale-105"
          )}>
            <Input
              ref={inputRef}
              type="text"
              placeholder={isListening ? "🎤 Đang nghe..." : placeholder}
              value={query}
              onChange={(e) => handleInputChange(e.target.value)}
              onKeyDown={handleKeyDown}
              onFocus={handleFocus}
              disabled={isListening} // Vô hiệu hóa input khi đang nghe
              className={cn(
                "pl-12 pr-16 h-14 text-base w-full", // Tăng padding-right cho nút voice
                "border-2 transition-all duration-500",
                "bg-background rounded-xl font-medium",
                "placeholder:text-muted-foreground text-foreground",
                isListening
                  ? "border-red-500 bg-gradient-to-r from-red-50 via-pink-50 to-red-50 text-red-900 placeholder:text-red-600 shadow-2xl shadow-red-500/50 ring-4 ring-red-500/30"
                  : isActive
                    ? "border-primary focus:ring-4 focus:ring-primary/20 shadow-lg shadow-primary/10"
                    : "border-border hover:border-primary/50",
                (showDropdown && isActive && !isListening) && "rounded-b-none border-b-0"
              )}
              autoComplete="off"
              role="combobox"
              aria-expanded={showDropdown}
              aria-haspopup="listbox"
              aria-activedescendant={
                selectedIndex >= 0 ? `suggestion-${selectedIndex}` : undefined
              }
              {...inputProps}
            />

            {/* --- THAY ĐỔI 4: Thêm VoiceSearchButton vào Input --- */}
            <div className="absolute right-2 top-1/2 -translate-y-1/2">
              <VoiceSearchButton
                state={voiceState}
                isSupported={isVoiceSupported}
                onClick={toggleVoiceSearch}
              />
            </div>
          </div>

          <SearchHistoryDropdown
            historySuggestions={suggestions.history}
            autocompleteSuggestions={suggestions.autocomplete}
            query={query}
            isLoading={isLoadingAutocomplete}
            error={null}
            selectedIndex={selectedIndex}
            isVisible={showDropdown && isActive}
            onSuggestionClick={handleSuggestionClick}
            onSuggestionHover={(index) => setSelectedIndex(index)}
            onDeleteHistory={handleDeleteHistory}
            onClose={closeDropdown}
            onRetry={() => { }}
            className={cn(
              "absolute top-full left-0 right-0 z-50",
              "border-t-0 rounded-t-none rounded-b-xl",
              "border-2 border-primary focus-within:border-primary",
              "shadow-lg shadow-primary/20"
            )}
          />
        </div>

        <Button
          type="button"
          size="lg"
          className={cn(
            "h-14 px-8 rounded-xl font-semibold flex-shrink-0",
            "btn-gradient text-primary-foreground",
            "transition-all duration-500 hover:scale-105 hover:shadow-xl hover:shadow-primary/30",
            "group",
            isListening && "scale-105 shadow-2xl shadow-red-500/50 ring-4 ring-red-500/30"
          )}
          onClick={handleSearchButtonClick}
          disabled={isListening}
        >
          <Search className={cn(
            "h-5 w-5 mr-2 transition-transform duration-300 group-hover:scale-110",
            isListening && "animate-pulse"
          )} />
          {isListening ? "Đang nghe..." : "Tìm kiếm"}
        </Button>
      </form>

      {/* Spotlight glow effect around search bar when listening */}
      {isListening && (
        <>
          {/* Outer glow ring */}
          <div className="absolute -inset-8 rounded-3xl bg-gradient-radial from-red-500/30 via-pink-500/20 to-transparent blur-3xl animate-pulse-glow pointer-events-none" />

          {/* Middle glow ring */}
          <div className="absolute -inset-4 rounded-2xl bg-gradient-radial from-red-400/40 via-pink-400/30 to-transparent blur-2xl animate-pulse-glow pointer-events-none"
            style={{ animationDelay: '0.5s' }} />

          {/* Inner glow ring */}
          <div className="absolute -inset-2 rounded-xl bg-gradient-radial from-red-300/50 via-pink-300/40 to-transparent blur-xl animate-pulse-glow pointer-events-none"
            style={{ animationDelay: '1s' }} />
        </>
      )}

      {/* Custom styles */}
      <style jsx>{`
        @keyframes pulse-glow {
          0%, 100% { opacity: 0.3; transform: scale(1); }
          50% { opacity: 0.8; transform: scale(1.05); }
        }

        .animate-pulse-glow {
          animation: pulse-glow 2s ease-in-out infinite;
        }

        .bg-gradient-radial {
          background: radial-gradient(circle, var(--tw-gradient-stops));
        }
      `}</style>

      {/* Microphone Permission Alert */}
      {micPermissionDenied && !isListening && (
        <div className="mt-4">
          <MicrophonePermissionAlert 
            onShowGuide={() => setShowMicPermissionGuide(true)}
          />
        </div>
      )}

      {/* Microphone Permission Guide Modal */}
      <MicrophonePermissionGuide
        isOpen={showMicPermissionGuide}
        onClose={() => setShowMicPermissionGuide(false)}
        onRetry={() => {
          setMicPermissionDenied(false);
          toggleVoiceSearch();
        }}
      />
    </div>
  );
});

JobSearchBar.displayName = 'JobSearchBar';

export default JobSearchBar;
</file>

<file path="src/pages/jobs/SavedJobs.jsx">
import { useState, useMemo } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';
import { toast } from 'sonner';
import { getSavedJobs, unsaveJob } from '@/services/savedJobService';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Badge } from '@/components/ui/badge';
import { ArrowLeft, Bookmark, Search, ArrowUpDown } from 'lucide-react';
import { Card } from '@/components/ui/card';
import JobResultCard from './components/SearchResults/JobResultCard';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';
import { EmptyState } from '@/components/common/EmptyState';
import ResultsPagination from './components/SearchResults/ResultsPagination';

const SavedJobs = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  const [searchTerm, setSearchTerm] = useState('');
  const [sortBy, setSortBy] = useState('createdAt:desc');
  const [page, setPage] = useState(1);
  const limit = 10;

  const [query, setQuery] = useState('');

  const { data, isLoading, isError, error, refetch } = useQuery({
    queryKey: ['savedJobs', page, limit, sortBy, query],
    queryFn: () => getSavedJobs({ page, limit, sortBy, search: query }),
    keepPreviousData: true,
  });

  const savedJobs = Array.isArray(data?.data) ? data.data : [];
  const meta = data?.meta || {};

  const { mutate: removeJob } = useMutation({
    mutationFn: ({ jobId }) => unsaveJob(jobId),
    onSuccess: (data, { jobId }) => {
      toast.success('Đã bỏ lưu công việc thành công');
      queryClient.invalidateQueries({queryKey: ['savedJobs']});
      queryClient.invalidateQueries({queryKey: ['jobDetail', jobId]});
    },
    onError: (err) => {
      const errorMessage = err.response?.data?.message || 'Có lỗi xảy ra khi bỏ lưu công việc';
      toast.error(errorMessage);
    },
  });

  const handleUnsave = (job) => {
    removeJob({ jobId: job.jobId || job.id });
  };

  const jobResultCards = useMemo(() => {
    return savedJobs.map(job => (
      <JobResultCard
        key={job.jobId}
        job={{ ...job, isSaved: true }}
        showSaveButton={true}
        onSaveToggle={() => handleUnsave(job)}
        onCardClick={() => navigate(`/jobs/${job.jobId}`)}
      />
    ));
  }, [savedJobs]);

  if (isLoading) {
    return (
      <div className="container py-8">
        <Skeleton className="h-10 w-48 mb-8" />
        <div className="space-y-4">
          {Array.from({ length: 5 }).map((_, i) => <Skeleton key={i} className="h-40 w-full" />)}
        </div>
      </div>
    );
  }

  if (isError) {
    return (
      <div className="container py-8">
        <ErrorState onRetry={refetch} message={error.response?.data?.message || error.message} />
      </div>
    );
  }

  return (
    <div className="min-h-screen backdrop-blur-sm relative z-10">
      <div className="container py-8">
        <div className="flex items-center mb-8">
          <Button variant="ghost" size="icon" onClick={() => navigate(-1)} className="mr-4">
            <ArrowLeft className="h-5 w-5" />
          </Button>
          <h1 className="text-3xl font-bold text-foreground">Việc làm đã lưu</h1>
          <Badge variant="secondary" className="ml-4 text-lg">
            <Bookmark className="h-5 w-5 mr-2" />
            {meta.totalItems || 0}
          </Badge>
        </div>

        <Card className="mb-8 p-6 shadow-sm">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="md:col-span-2">
              <form
                onSubmit={(e) => {
                  e.preventDefault();
                  setQuery(searchTerm);
                  setPage(1);
                }}
                className="flex gap-2"
              >
                <div className="relative flex-grow">
                  <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground" />
                  <Input
                    placeholder="Tìm kiếm trong các việc làm đã lưu..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="pl-10 h-12 text-base"
                  />
                </div>
                <Button type="submit" className="h-12">
                  Tìm kiếm
                </Button>
              </form>
            </div>
            <div className="flex items-center gap-2">
              <ArrowUpDown className="h-4 w-4 text-muted-foreground" />
              <Select value={sortBy} onValueChange={setSortBy}>
                <SelectTrigger className="w-full h-12 text-base">
                  <SelectValue placeholder="Sắp xếp theo" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="createdAt:desc">Mới nhất</SelectItem>
                  <SelectItem value="createdAt:asc">Cũ nhất</SelectItem>
                  <SelectItem value="deadline:asc">Hạn nộp gần nhất</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>
        </Card>

        {savedJobs.length > 0 ? (
          <>
            <div className="space-y-4">
              {jobResultCards}
            </div>
            <div className="mt-8">
              <ResultsPagination
                currentPage={page}
                totalPages={meta.totalPages || 1}
                onPageChange={setPage}
                totalResults={meta.totalItems || 0}
                pageSize={limit}
              />
            </div>
          </>
        ) : (
          <EmptyState
            title="Không tìm thấy việc làm đã lưu"
            message={
              query
                ? `Không có kết quả nào phù hợp với từ khóa "${query}".`
                : "Bạn chưa lưu công việc nào. Hãy bắt đầu tìm kiếm và lưu lại những cơ hội tốt nhất!"
            }
            actionLabel="Khám phá việc làm"
            onAction={() => navigate('/jobs/search')}
          />
        )}
      </div>
    </div>
  );
};

export default SavedJobs;
</file>

<file path="src/services/api.js">
import apiClient from './apiClient';

/**
 * Lấy danh sách tất cả các CV từ backend.
 * @returns {Promise<Array>} Danh sách các CV.
 */
export const getCvs = async () => {
  try {
    const response = await apiClient.get('/cvs');
    return response.data;
  } catch (error) {
    console.error('Error fetching all CVs:', error);
    throw error;
  }
};

/**
 * Lấy thông tin chi tiết của một CV bằng ID.
 * @param {string} cvId - ID của CV.
 * @returns {Promise<Object>} Dữ liệu chi tiết của CV.
 */
export const getCvById = async (cvId) => {
  try {
    const response = await apiClient.get(`/cvs/${cvId}`);
    return response.data;
  } catch (error) {
    console.error(`Error fetching CV with ID ${cvId}:`, error);
    throw error;
  }
};

/**
 * Tạo một CV mới với template được chỉ định.
 * Backend sẽ tự tạo một CV trống với template được chỉ định.
 * @param {string} templateId - ID của template để tạo CV mới (e.g., 'modern-blue').
 * @returns {Promise<Object>} Dữ liệu CV vừa được tạo.
 */
export const createCv = async (templateId) => {
  try {
    const response = await apiClient.post('/cvs', { templateId });
    return response.data;
  } catch (error) {
    console.error('Error creating new CV:', error);
    throw error;
  }
};

/**
 * Tạo một CV mới từ một template có sẵn, gửi kèm dữ liệu ban đầu.
 * 
 * NAMING CONVENTION:
 * - Backend uses 'title' field in database
 * - Frontend uses 'name' for display (mapped via virtual field)
 * - When sending to backend, use 'title' in request body
 * - When receiving from backend, use 'name' from response (virtual field)
 * 
 * @param {Object} data - Dữ liệu để tạo CV.
 * @param {string} data.templateId - ID của template.
 * @param {Object} data.cvData - Dữ liệu CV ban đầu.
 * @param {string} data.title - Tên/tiêu đề của CV (backend field).
 * @returns {Promise<Object>} Dữ liệu CV vừa được tạo (includes 'name' virtual field).
 */
export const createCvFromTemplate = async (data) => {
  try {
    const response = await apiClient.post('/cvs/from-template', data);
    return response.data;
  } catch (error) {
    console.error('Error creating CV from template:', error);
    throw error;
  }
};

/**
 * Tạo CV mới từ dữ liệu profile của user.
 * @param {Object} data - Dữ liệu để tạo CV.
 * @param {string} data.templateId - ID của template.
 * @param {string} data.title - Tên/tiêu đề của CV.
 * @returns {Promise<Object>} Dữ liệu CV vừa được tạo với dữ liệu từ profile.
 */
export const createCvFromProfile = async (data) => {
  try {
    const response = await apiClient.post('/cvs/from-profile', data);
    return response.data;
  } catch (error) {
    console.error('Error creating CV from profile:', error);
    throw error;
  }
};

/**
 * Cập nhật một CV đã có.
 * @param {string} cvId - ID của CV cần cập nhật.
 * @param {Object} cvData - Dữ liệu CV cần cập nhật (chỉ bao gồm title và cvData).
 * @returns {Promise<Object>} Dữ liệu CV sau khi đã cập nhật.
 */
export const updateCv = async (cvId, cvData) => {
  try {
    const response = await apiClient.put(`/cvs/${cvId}`, cvData);
    return response.data;
  } catch (error) {
    console.error(`Error updating CV with ID ${cvId}:`, error);
    throw error;
  }
};

/**
 * Gọi API để export CV dưới dạng PDF.
 * @param {string} cvId - ID của CV cần export.
 * @returns {Promise<Blob>} - Dữ liệu PDF dưới dạng Blob.
 */
export const exportPdf = async (cvId) => {
  try {
    const response = await apiClient.get(`/cvs/${cvId}/export-pdf`, {
      responseType: 'blob', // Quan trọng: nhận về dữ liệu dạng file
      timeout: 30000, // 30 seconds timeout for PDF generation
    });
    return response.data;
  } catch (error) {
    console.error('Error exporting PDF:', error);
    console.log('Error details:', error.response ? error.response.data : error.message);
    throw error;
  }
};

/**
 * Lấy URL để xem CV dạng PDF
 * @param {string} cvId - ID của CV
 * @returns {string} URL để xem PDF
 */
export const getCvPdfUrl = (cvId) => {
  const token = localStorage.getItem('token');
  return `${import.meta.env.VITE_API_URL}/cvs/${cvId}/export-pdf?token=${token}`;
};

/**
 * Xóa một CV dựa trên ID.
 * @param {string} cvId - ID của CV cần xóa.
 * @returns {Promise<Object>} - Tin nhắn xác nhận từ backend.
 */
export const deleteCv = async (cvId) => {
  try {
    const response = await apiClient.delete(`/cvs/${cvId}`);
    return response.data;
  } catch (error) {
    console.error(`Error deleting CV with ID ${cvId}:`, error);
    throw error;
  }
};

/**
 * Duplicates a CV.
 * 
 * NAMING CONVENTION:
 * - Sends 'name' to backend
 * - Backend controller saves it as 'title' field
 * - Response includes 'name' virtual field for frontend use
 * 
 * @param {string} cvId - The ID of the CV to duplicate.
 * @param {string} name - The name for the new duplicated CV (will be saved as 'title' in DB).
 * @returns {Promise<Object>} The data of the newly created CV (includes 'name' virtual field).
 */
export const duplicateCv = async (cvId, name) => {
  try {
    const response = await apiClient.post(`/cvs/${cvId}/duplicate`, { name });
    return response.data;
  } catch (error) {
    console.error(`Error duplicating CV with ID ${cvId}:`, error);
    throw error;
  }
};

/**
 * Renames a CV.
 * 
 * NAMING CONVENTION:
 * - Sends 'name' to backend PATCH endpoint
 * - Backend controller maps 'name' to 'title' field
 * - Response includes 'name' virtual field for frontend use
 * 
 * @param {string} cvId - The ID of the CV to rename.
 * @param {string} name - The new name for the CV (will be saved as 'title' in DB).
 * @returns {Promise<Object>} The updated CV data (includes 'name' virtual field).
 */
export const renameCv = async (cvId, name) => {
  try {
    const response = await apiClient.patch(`/cvs/${cvId}`, { name });
    return response.data;
  } catch (error) {
    console.error(`Error renaming CV with ID ${cvId}:`, error);
    throw error;
  }
};
</file>

<file path="src/pages/cv/CVListPage.jsx">
import React, { useState, useEffect, useRef } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import { getCvs, deleteCv, createCvFromTemplate, duplicateCv as duplicateCvApi, renameCv, exportPdf } from '../../services/api';
import { cvTemplates } from '@/data/templates';

import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle, CardFooter } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { ErrorState } from '@/components/common/ErrorState';
import { PlusCircle, Edit, Trash2, Copy, AlertTriangle, ExternalLink, Pencil, Download, Eye } from 'lucide-react';
import TemplateGallery from '@/components/buildCV/TemplateGallery';
import CVPreview from '@/components/cv/CVPreview';
import PDFViewer from '@/components/cv/PDFViewer';

/**
 * CV List Page - Manages user's CV collection
 * 
 * NAMING CONVENTION:
 * - Display: cv.name (virtual field from backend)
 * - API requests: send 'title' for create, 'name' for rename/duplicate
 * - Backend automatically maps between 'name' and 'title'
 */
const CVListPage = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false);
  const [isDuplicateDialogOpen, setIsDuplicateDialogOpen] = useState(false);
  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);
  const [isRenameDialogOpen, setIsRenameDialogOpen] = useState(false);
  const [isPdfViewerOpen, setIsPdfViewerOpen] = useState(false);
  const [selectedTemplate, setSelectedTemplate] = useState(null);
  const [cvToDuplicate, setCvToDuplicate] = useState(null);
  const [cvToDelete, setCvToDelete] = useState(null);
  const [cvToRename, setCvToRename] = useState(null);
  const [cvToView, setCvToView] = useState(null);
  const [pdfBlob, setPdfBlob] = useState(null);
  const [newCvName, setNewCvName] = useState('');
  const [highlightedCvId, setHighlightedCvId] = useState(null);
  const highlightTimeoutRef = useRef(null);

  const { data: cvsData, isLoading: isLoadingCvs, isError: isCvsError, refetch: refetchCvs } = useQuery({
    queryKey: ['my-cvs'],
    queryFn: getCvs,
  });

  const deleteMutation = useMutation({
    mutationFn: deleteCv,
    onSuccess: () => {
      toast.success('CV đã được xóa thành công!');
      queryClient.invalidateQueries({ queryKey: ['my-cvs'] });
      setIsDeleteDialogOpen(false);
      setCvToDelete(null);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể xóa CV.');
    },
  });

  const createMutation = useMutation({
    mutationFn: createCvFromTemplate,
    onSuccess: (data) => {
      toast.success('CV đã được tạo thành công!');
      queryClient.invalidateQueries({ queryKey: ['my-cvs'] });
      setIsCreateDialogOpen(false);
      setNewCvName('');
      // Navigate to editor with showSuggestion flag
      navigate(`/editor/${data.data._id}?showSuggestion=true`);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể tạo CV.');
    },
  });

  const duplicateMutation = useMutation({
    mutationFn: ({ cvId, name }) => duplicateCvApi(cvId, name),
    onSuccess: (data) => {
      toast.success('CV đã được nhân bản thành công!');
      const newCvId = data.data._id;
      
      // Highlight the newly cloned CV
      setHighlightedCvId(newCvId);
      
      // Clear highlight after 5 seconds
      if (highlightTimeoutRef.current) {
        clearTimeout(highlightTimeoutRef.current);
      }
      highlightTimeoutRef.current = setTimeout(() => {
        setHighlightedCvId(null);
      }, 5000);
      
      queryClient.invalidateQueries({ queryKey: ['my-cvs'] });
      setIsDuplicateDialogOpen(false);
      setNewCvName('');
      
      // Scroll to the new CV after a short delay to ensure it's rendered
      setTimeout(() => {
        const cvElement = document.getElementById(`cv-card-${newCvId}`);
        if (cvElement) {
          cvElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }, 300);
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể nhân bản CV.');
    },
  });

  const renameMutation = useMutation({
    mutationFn: ({ cvId, name }) => renameCv(cvId, name),
    onSuccess: () => {
      toast.success('Đổi tên CV thành công!');
      queryClient.invalidateQueries({ queryKey: ['my-cvs'] });
      setIsRenameDialogOpen(false);
      setCvToRename(null);
      setNewCvName('');
    },
    onError: (error) => {
      toast.error(error.response?.data?.message || 'Không thể đổi tên CV.');
    },
  });

  const handleOpenCreateDialog = (template) => {
    setSelectedTemplate(template);
    setNewCvName(`CV ${template.name}`);
    setIsCreateDialogOpen(true);
  };

  const handleOpenDuplicateDialog = (cv) => {
    setCvToDuplicate(cv);
    setNewCvName(`Bản sao của ${cv.title}`);
    setIsDuplicateDialogOpen(true);
  };

  const handleOpenDeleteDialog = (cv) => {
    setCvToDelete(cv);
    setIsDeleteDialogOpen(true);
  };

  const handleDeleteCv = () => {
    if (cvToDelete) {
      deleteMutation.mutate(cvToDelete._id);
    }
  };

  const handleOpenRenameDialog = (cv) => {
    setCvToRename(cv);
    setNewCvName(cv.name || '');
    setIsRenameDialogOpen(true);
  };

  const handleRenameCv = () => {
    if (!newCvName.trim()) {
      toast.error('Vui lòng nhập tên cho CV.');
      return;
    }
    if (cvToRename) {
      renameMutation.mutate({ cvId: cvToRename._id, name: newCvName });
    }
  };

  const handleViewCV = async (cv) => {
    try {
      toast.loading('Đang tải PDF...', { id: 'pdf-loading' });
      const blob = await exportPdf(cv._id);
      const url = URL.createObjectURL(blob);
      setPdfBlob(url);
      setCvToView(cv);
      setIsPdfViewerOpen(true);
      toast.dismiss('pdf-loading');
    } catch (error) {
      toast.dismiss('pdf-loading');
      toast.error('Không thể tải PDF. Vui lòng thử lại.');
      console.error('Error loading PDF:', error);
    }
  };

  const handleDownloadFromViewer = () => {
    if (cvToView && pdfBlob) {
      const link = document.createElement('a');
      link.href = pdfBlob;
      link.download = `${cvToView.title || 'CV'}.pdf`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      toast.success('Tải xuống thành công!');
    }
  };

  const handleClosePdfViewer = () => {
    setIsPdfViewerOpen(false);
    if (pdfBlob) {
      URL.revokeObjectURL(pdfBlob);
      setPdfBlob(null);
    }
    setCvToView(null);
  };

  const handleCreateCv = () => {
    if (!newCvName.trim()) {
      toast.error('Vui lòng nhập tên cho CV.');
      return;
    }
    // Send 'title' to backend (backend uses 'title' field)
    createMutation.mutate({ templateId: selectedTemplate.id, title: newCvName });
  };

  const handleDuplicateCv = () => {
    if (!newCvName.trim()) {
      toast.error('Vui lòng nhập tên cho bản sao CV.');
      return;
    }
    duplicateMutation.mutate({ cvId: cvToDuplicate._id, name: newCvName });
  };

  if (isLoadingCvs) {
    return (
      <div className="container mx-auto p-4 md:p-8">
        <Skeleton className="h-8 w-1/4 mb-6" />
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {[...Array(4)].map((_, i) => <Skeleton key={i} className="h-48 w-full" />)}
        </div>
        <Skeleton className="h-8 w-1/3 mt-12 mb-6" />
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {[...Array(3)].map((_, i) => <Skeleton key={i} className="h-80 w-full" />)}
        </div>
      </div>
    );
  }

  if (isCvsError) {
    return <ErrorState onRetry={refetchCvs} message="Không thể tải dữ liệu." />;
  }

  return (
    <div className="space-y-8">
      <section id="my-cvs">
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-semibold text-gray-900">CV của tôi</h2>
          <Button onClick={() => document.getElementById('templates')?.scrollIntoView({ behavior: 'smooth' })}>
            <PlusCircle className="h-4 w-4 mr-2" />
            Tạo CV mới
          </Button>
        </div>

        {cvsData?.data?.length > 0 ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {cvsData.data.map((cv) => (
              <div
                key={cv._id}
                id={`cv-card-${cv._id}`}
                className="relative"
              >
                {/* Highlight animation for cloned CV */}
                {highlightedCvId === cv._id && (
                  <>
                    {/* Pulsing rings */}
                    <div className="absolute inset-0 -m-2 pointer-events-none z-10">
                      <div className="absolute inset-0 rounded-lg border-4 border-blue-500 animate-ping opacity-75"></div>
                      <div className="absolute inset-0 rounded-lg border-4 border-blue-400 animate-pulse"></div>
                    </div>
                    {/* Glow effect */}
                    <div className="absolute inset-0 -m-1 bg-gradient-to-r from-blue-400 via-cyan-400 to-blue-400 rounded-lg blur-sm opacity-60 animate-pulse pointer-events-none z-0"></div>
                  </>
                )}
                
                <Card className={`flex flex-col hover:shadow-lg hover:-translate-y-1 transition-all duration-200 border-0 shadow-md relative ${highlightedCvId === cv._id ? 'ring-4 ring-blue-500 ring-offset-2' : ''}`}>
                <CardHeader className="pb-3">
                  <div className="flex items-center justify-between gap-2">
                    <CardTitle className="truncate text-lg flex-1">{cv.title || 'CV chưa có tên'}</CardTitle>
                    <Button
                      variant="ghost"
                      size="sm"
                      className="h-8 w-8 p-0"
                      onClick={(e) => {
                        e.stopPropagation();
                        handleOpenRenameDialog(cv);
                      }}
                    >
                      <Pencil className="h-4 w-4 text-gray-500" />
                    </Button>
                  </div>
                </CardHeader>

                <CardContent className="flex-grow space-y-4">
                  {/* CV Preview */}
                  <CVPreview
                    cv={cv}
                    className="w-full"
                  />

                  {/* CV Info */}
                  <div className="space-y-2">
                    <div className="flex items-center justify-between text-sm text-muted-foreground">
                      <span>Cập nhật: {new Date(cv.updatedAt).toLocaleDateString('vi-VN')}</span>
                      {cv.cvData?.personalInfo?.completionPercentage && (
                        <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full">
                          {cv.cvData.personalInfo.completionPercentage}% hoàn thành
                        </span>
                      )}
                    </div>

                    {/* Quick stats */}
                    <div className="flex items-center gap-2 text-xs text-gray-500">
                      {cv.cvData?.experiences?.length > 0 && (
                        <span className="bg-blue-50 text-blue-600 px-2 py-1 rounded">
                          {cv.cvData.experiences.length} kinh nghiệm
                        </span>
                      )}
                      {cv.cvData?.skills?.length > 0 && (
                        <span className="bg-green-50 text-green-600 px-2 py-1 rounded">
                          {cv.cvData.skills.length} kỹ năng
                        </span>
                      )}
                    </div>

                    {cv.templateId && (
                      <p className="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full inline-block">
                        Template: {cv.templateId}
                      </p>
                    )}
                  </div>
                </CardContent>

                <CardFooter className="flex flex-col gap-2 pt-4">
                  {/* Primary Actions */}
                  <div className="flex w-full gap-2">
                    <Button variant="default" size="sm" className="flex-1" asChild>
                      <Link to={`/editor/${cv._id}`}>
                        <Edit className="h-4 w-4 mr-2" />
                        Chỉnh sửa
                      </Link>
                    </Button>
                  </div>

                  {/* Secondary Actions */}
                  <div className="flex w-full gap-2">
        
                    <Button variant="outline" size="sm" onClick={() => handleOpenDuplicateDialog(cv)}>
                      <Copy className="h-4 w-4 mr-2" />
                      Nhân bản
                    </Button>
                    <Button variant="destructive" size="sm" onClick={() => handleOpenDeleteDialog(cv)}>
                      <Trash2 className="h-4 w-4 mr-2" />
                      Xóa
                    </Button>
                  </div>
                </CardFooter>
              </Card>
              </div>
            ))}
          </div>
        ) : (
          <div className="text-center py-12">
            <div className="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
              <PlusCircle className="h-12 w-12 text-gray-400" />
            </div>
            <h3 className="text-lg font-semibold text-gray-900 mb-2">Chưa có CV nào</h3>
            <p className="text-gray-600 mb-6 max-w-md mx-auto">
              Bạn chưa tạo CV nào. Hãy chọn một mẫu CV phù hợp bên dưới để bắt đầu tạo CV chuyên nghiệp của bạn!
            </p>
            <Button onClick={() => document.getElementById('templates')?.scrollIntoView({ behavior: 'smooth' })}>
              <PlusCircle className="h-4 w-4 mr-2" />
              Tạo CV đầu tiên
            </Button>
          </div>
        )}
      </section>

      <section id="templates" className="mt-12">
        <h2 className="text-xl font-semibold text-gray-900 mb-6">Chọn mẫu CV</h2>
        <TemplateGallery selectedTemplate={null} onSelectTemplate={(id) => {
          const template = cvTemplates.find(t => t.id === id);
          if (template) handleOpenCreateDialog(template);
        }} />
      </section>

      {/* Create CV Dialog */}
      <Dialog open={isCreateDialogOpen} onOpenChange={setIsCreateDialogOpen}>
        <DialogContent className="sm:max-w-[500px]">
          <DialogHeader>
            <DialogTitle className="text-xl">Tạo CV mới</DialogTitle>
          </DialogHeader>

          {selectedTemplate && (
            <div className="space-y-4 py-2">
              {/* Template Info */}
              <div className="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg p-4 space-y-2">
                <div className="flex items-center justify-between">
                  <h3 className="font-semibold text-gray-900">{selectedTemplate.name}</h3>
                  <Badge variant="secondary">{selectedTemplate.category}</Badge>
                </div>
                <p className="text-sm text-gray-600">{selectedTemplate.description}</p>
                {selectedTemplate.bestFor && (
                  <div className="flex flex-wrap gap-1 pt-1">
                    <span className="text-xs text-gray-500">Phù hợp:</span>
                    {selectedTemplate.bestFor.map((tag, idx) => (
                      <span
                        key={idx}
                        className="text-xs bg-white text-blue-700 px-2 py-1 rounded shadow-sm"
                      >
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </div>

              {/* CV Name Input */}
              <div className="space-y-2">
                <Label htmlFor="cv-name">Tên CV của bạn</Label>
                <Input
                  id="cv-name"
                  value={newCvName}
                  onChange={(e) => setNewCvName(e.target.value)}
                  placeholder="Ví dụ: CV ứng tuyển Frontend Developer"
                  className="w-full"
                />
                <p className="text-xs text-muted-foreground">
                  Đặt tên giúp bạn dễ dàng quản lý khi có nhiều CV
                </p>
              </div>
            </div>
          )}

          <DialogFooter>
            <Button variant="outline" onClick={() => setIsCreateDialogOpen(false)}>
              Hủy
            </Button>
            <Button onClick={handleCreateCv} disabled={createMutation.isPending}>
              {createMutation.isPending ? 'Đang tạo...' : 'Tạo và Chỉnh sửa'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Duplicate CV Dialog */}
      <Dialog open={isDuplicateDialogOpen} onOpenChange={setIsDuplicateDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Nhân bản CV</DialogTitle>
          </DialogHeader>
          <div className="grid gap-4 py-4">
            <div className="grid grid-cols-4 items-center gap-4">
              <Label htmlFor="duplicate-cv-name" className="text-right">Tên CV mới</Label>
              <Input
                id="duplicate-cv-name"
                value={newCvName}
                onChange={(e) => setNewCvName(e.target.value)}
                className="col-span-3"
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setIsDuplicateDialogOpen(false)}>Hủy</Button>
            <Button onClick={handleDuplicateCv} disabled={duplicateMutation.isPending}>
              {duplicateMutation.isPending ? 'Đang nhân bản...' : 'Nhân bản'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Rename CV Dialog */}
      <Dialog open={isRenameDialogOpen} onOpenChange={setIsRenameDialogOpen}>
        <DialogContent className="sm:max-w-[425px]">
          <DialogHeader>
            <DialogTitle>Đổi tên CV</DialogTitle>
          </DialogHeader>

          <div className="space-y-4 py-4">
            <div className="space-y-2">
              <Label htmlFor="rename-cv-name">Tên CV mới</Label>
              <Input
                id="rename-cv-name"
                value={newCvName}
                onChange={(e) => setNewCvName(e.target.value)}
                placeholder="Nhập tên mới cho CV"
                className="w-full"
                autoFocus
              />
              <p className="text-xs text-muted-foreground">
                Đặt tên rõ ràng giúp bạn dễ dàng tìm kiếm và quản lý CV
              </p>
            </div>
          </div>

          <DialogFooter>
            <Button
              variant="outline"
              onClick={() => setIsRenameDialogOpen(false)}
              disabled={renameMutation.isPending}
            >
              Hủy
            </Button>
            <Button
              onClick={handleRenameCv}
              disabled={renameMutation.isPending}
            >
              {renameMutation.isPending ? 'Đang lưu...' : 'Lưu'}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Delete CV Confirmation Dialog */}
      <Dialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>
        <DialogContent className="sm:max-w-[425px]">
          <DialogHeader>
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-red-100">
                <AlertTriangle className="h-5 w-5 text-red-600" />
              </div>
              <DialogTitle className="text-xl">Xác nhận xóa CV</DialogTitle>
            </div>
          </DialogHeader>

          <div className="space-y-4 py-4">
            <p className="text-sm text-gray-600">
              Bạn có chắc chắn muốn xóa CV <span className="font-semibold text-gray-900">"{cvToDelete?.name}"</span> không?
            </p>
            <div className="bg-red-50 border border-red-200 rounded-lg p-3">
              <p className="text-sm text-red-800">
                <strong>Cảnh báo:</strong> Hành động này không thể hoàn tác. CV sẽ bị xóa vĩnh viễn khỏi hệ thống.
              </p>
            </div>
          </div>

          <DialogFooter>
            <Button
              variant="outline"
              onClick={() => setIsDeleteDialogOpen(false)}
              disabled={deleteMutation.isPending}
            >
              Hủy
            </Button>
            <Button
              variant="destructive"
              onClick={handleDeleteCv}
              disabled={deleteMutation.isPending}
            >
              {deleteMutation.isPending ? (
                <>
                  <span className="animate-spin mr-2">⏳</span>
                  Đang xóa...
                </>
              ) : (
                <>
                  <Trash2 className="h-4 w-4 mr-2" />
                  Xóa CV
                </>
              )}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* PDF Viewer Dialog */}
      <Dialog open={isPdfViewerOpen} onOpenChange={handleClosePdfViewer}>
        <DialogContent className="max-w-[90vw] max-h-[90vh] h-[90vh] p-0">
          <DialogHeader className="px-6 pt-6 pb-2">
            <DialogTitle className="text-xl">
              {cvToView?.title || 'Xem CV'}
            </DialogTitle>
          </DialogHeader>
          <div className="flex-1 overflow-hidden">
            {pdfBlob && (
              <PDFViewer
                pdfUrl={pdfBlob}
                onDownload={handleDownloadFromViewer}
                fileName={`${cvToView?.title || 'CV'}.pdf`}
              />
            )}
          </div>
        </DialogContent>
      </Dialog>
    </div>
  );
};

export default CVListPage;
</file>

<file path="src/services/profileService.js">
import apiClient from './apiClient';

// Lấy thông tin profile của user
export const getMyProfile = async () => {
  const response = await apiClient.get('/candidate/my-profile');
  return response.data;
};
export const getMe = async () => {
  const response = await apiClient.get('/users/me');
  return response.data;
};

// Cập nhật thông tin profile
export const updateProfile = async (profileData) => {
  const response = await apiClient.put('/candidate/my-profile', profileData);
  return response.data;
};

// Upload avatar
export const uploadAvatar = async (formData) => {
  const response = await apiClient.patch('/candidate/avatar', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  return response.data;
};

// Lấy số dư xu của user
export const getMyCoinBalance = async () => {
  const response = await apiClient.get('/users/me/coins');
  return response.data;
};

// Upload CV
export const uploadCV = async (formData) => {
  const response = await apiClient.post('/candidate/cvs', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  return response.data;
};

// Xóa CV
export const deleteCV = async (cvId) => {
  const response = await apiClient.delete(`/candidate/cvs/${cvId}`);
  return response.data;
};

// Set CV mặc định
export const setDefaultCV = async (cvId) => {
  const response = await apiClient.patch(`/candidate/cvs/${cvId}/set-default`);
  return response.data;
};

// Download CV - Note: Backend doesn't have download endpoint, CV path is direct URL
export const downloadCV = async (cvId) => {
  // Since backend returns direct Cloudinary URLs, we can just fetch them
  // This is a placeholder - actual implementation would fetch from cv.path
  const response = await apiClient.get(`/candidate/cvs/${cvId}/download`, {
    responseType: 'blob',
  });
  return response.data;
};
// Lấy danh sách CV profiles
export const getCvProfiles = async () => {
  const response = await apiClient.get('/candidate/cv-profiles');
  return response;
};

// Lấy thông tin user hiện tại (bao gồm profile)
export const getCurrentUserProfile = async () => {
  const response = await apiClient.get('/users/me');
  return response.data;
};

// Lấy thông tin độ hoàn thiện hồ sơ
export const getProfileCompleteness = async (recalculate = false) => {
  const response = await apiClient.get('/candidate/profile/completeness', {
    params: { recalculate }
  });
  return response.data;
};

// Lấy gợi ý cải thiện hồ sơ
export const getProfileRecommendations = async () => {
  const response = await apiClient.get('/candidate/profile/recommendations');
  return response.data;
};

// Cập nhật thông tin ưu tiên (lương, địa điểm, điều kiện làm việc)
export const updateProfilePreferences = async (preferences) => {
  const response = await apiClient.put('/candidate/profile/preferences', preferences);
  return response.data;
};

// Cập nhật cài đặt riêng tư (allowSearch)
export const updatePrivacySettings = async (settings) => {
  const response = await apiClient.patch('/candidate/settings/privacy', settings);
  return response.data;
};

// Lấy cài đặt allow search hiện tại
export const getAllowSearchSettings = async () => {
  const response = await apiClient.get('/candidate/settings/allow-search');
  return response.data;
};

// Toggle allow search với chọn CV
export const toggleAllowSearch = async (data) => {
  const response = await apiClient.patch('/candidate/settings/allow-search', data);
  return response.data;
};
</file>

<file path="src/components/buildCV/CVBuilder.jsx">
import React, { useState, useEffect, useRef } from 'react';
import { useParams, useNavigate, Link, useSearchParams } from 'react-router-dom';
import { useSelector } from 'react-redux';
import { getCvById, createCvFromTemplate, updateCv, exportPdf as exportPdfApi } from '../../services/api';
import { mapToFrontend, mapToBackend } from '../../utils/dataMapper';
import { sampleCVData, creativeSampleData, minimalSampleData } from '../../data/sampleData';
import CVPreview from '../CVPreview/CVPreview';
import CVPaginatedPreview from '../CVPreview/CVPaginatedPreview';
import TemplateGallery from './TemplateGallery';
import PersonalInfoForm from '../forms/PersonalInfoForm';
import WorkExperienceForm from '../forms/WorkExperienceForm';
import SkillsForm from '../forms/SkillsForm';
import EducationForm from '../forms/EducationForm';
import ProjectsForm from '../forms/ProjectsForm';
import CertificatesForm from '../forms/CertificatesForm';
import SimpleSectionOrderManager from './SimpleSectionOrderManager';
import SampleDataSpotlight from './SampleDataSpotlight';
import { 
  User, 
  Briefcase, 
  Award, 
  FileText, 
  Eye, 
  Save, 
  Download, 
  Menu,
  X,
  Palette,
  GraduationCap,
  FolderOpen,
  AlignCenterVertical as Certificate,
  Sparkles,
  Zap,
  Coffee,
  Settings
} from 'lucide-react';
import { toast } from 'sonner';

const CVBuilder = () => {
  const { cvId } = useParams();
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const { isAuthenticated } = useSelector((state) => state.auth);
  const [activeTab, setActiveTab] = useState('template');
  const [selectedTemplate, setSelectedTemplate] = useState('modern-blue');
  const [showPreview, setShowPreview] = useState(true);
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);
  const [isLoading, setIsLoading] = useState(true);
  const [isSaving, setIsSaving] = useState(false);
  const [isExporting, setIsExporting] = useState(false);
  const [scale, setScale] = useState(0.65); // A4 thu nhỏ cho preview
  const cvContentRef = useRef(null); // For paginated preview
  const cvExportRef = useRef(null); // For export (no pagination)
  const [cvData, setCVData] = useState(null);
  const [error, setError] = useState(null);
  const [showSampleSuggestion, setShowSampleSuggestion] = useState(false);

  // Load or create CV
  useEffect(() => {
    const fetchOrCreateCv = async () => {
      setIsLoading(true);
      try {
        if (isAuthenticated && cvId && cvId !== 'new') {
          // Load existing CV
          const dataFromApi = await getCvById(cvId);
          if (dataFromApi && dataFromApi.data) {
            const mappedData = mapToFrontend(dataFromApi.data);
            // Ensure personalInfo exists
            if (!mappedData.personalInfo) {
              mappedData.personalInfo = {};
            }
            setCVData(mappedData);
            setSelectedTemplate(mappedData.template || 'modern-blue');
            
            // Check if we should show suggestion for newly created CV
            if (searchParams.get('showSuggestion') === 'true') {
              setShowSampleSuggestion(true);
            }
          } else {
            navigate('/editor/new', { replace: true });
          }
        } else {
          // Create new CV - Show suggestion dialog first
          const basicCV = {
            id: 'temp-' + Date.now(),
            template: 'modern-blue',
            personalInfo: {
              fullName: isAuthenticated 
                ? 'CV Mới ' + new Date().toLocaleDateString('vi-VN')
                : 'CV Demo ' + new Date().toLocaleDateString('vi-VN')
            },
            professionalSummary: '',
            workExperience: [],
            education: [],
            skills: [],
            projects: [],
            certificates: [],
            sectionOrder: ['summary', 'experience', 'education', 'skills', 'projects', 'certificates'],
            hiddenSections: []
          };
          setCVData(basicCV);
          setSelectedTemplate(basicCV.template || 'modern-blue');
          // Show sample data suggestion for new CVs
          setShowSampleSuggestion(true);
          console.log('✅ New CV created - showing sample data suggestion');
        }
      } catch (error) {
        console.error("Error loading CV:", error);
        setError(error);
        
        // Always fallback to sample data - Works for all users
        const basicCV = {
          ...sampleCVData,
          id: 'temp-' + Date.now(),
          template: 'modern-blue',
          personalInfo: {
            ...sampleCVData.personalInfo,
            fullName: isAuthenticated 
              ? 'CV Mới ' + new Date().toLocaleDateString('vi-VN')
              : 'CV Demo ' + new Date().toLocaleDateString('vi-VN')
          }
        };
        setCVData(basicCV);
        setSelectedTemplate(basicCV.template || 'modern-blue');
        console.log('✅ Fallback to sample data - PDF export available');
      } finally {
        setIsLoading(false);
      }
    };

    fetchOrCreateCv();
  }, [cvId, navigate]);

  // Handle template selection
  const handleTemplateSelect = (templateId) => {
    setSelectedTemplate(templateId);
    if (cvData) {
      setCVData({
        ...cvData,
        template: templateId
      });
    }
  };

  const loadSampleData = (sampleType = 'default') => {
    let sample;
    switch (sampleType) {
      case 'creative':
        sample = creativeSampleData;
        break;
      case 'minimal':
        sample = minimalSampleData;
        break;
      default:
        sample = sampleCVData;
    }
    
    // Keep the core identifiers and structure, but overwrite content
    setCVData(prevData => ({
      ...prevData,
      ...sample,
      id: prevData.id, // Retain original ID
      name: `CV mẫu - ${sample.personalInfo.fullName}`,
      template: sample.template || prevData.template,
    }));
    
    // Close suggestion dialog and switch to personal info tab
    setShowSampleSuggestion(false);
    setActiveTab('personal');
  };

  const handleDismissSuggestion = () => {
    setShowSampleSuggestion(false);
    setActiveTab('personal');
    toast.info('Bạn có thể tải dữ liệu mẫu bất cứ lúc nào từ sidebar!');
  };

  const exportPDF = async () => {
    if (!cvData || !cvData.id || cvData.id.startsWith('temp-')) {
      alert('Vui lòng lưu CV trước khi xuất PDF.');
      return;
    }
    
    setIsExporting(true);
    try {
      // Gọi API từ backend để tạo PDF
      const pdfBlob = await exportPdfApi(cvData.id);

      // Tạo URL tạm thời cho file Blob và kích hoạt tải về
      const url = window.URL.createObjectURL(pdfBlob);
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', `${cvData.personalInfo.fullName || 'CV'}.pdf`);
      document.body.appendChild(link);
      link.click();
      
      // Dọn dẹp
      link.parentNode.removeChild(link);
      window.URL.revokeObjectURL(url);

    } catch (error) {
      console.error('Error exporting PDF:', error);
    } finally {
      setIsExporting(false);
    }
  };

  // Save CV function
  const saveCv = async () => {
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để lưu CV của bạn.');
      return;
    }

    setIsSaving(true);
    try {
      const backendData = mapToBackend(cvData);
      
      if (cvId === 'new' || cvData.id.startsWith('temp-')) {
        // This is a new CV, create it
        const payload = {
          title: backendData.cvData.personalInfo.fullName || 'CV mới',
          templateId: selectedTemplate,
          cvData: backendData.cvData,
        };
        const newCv = await createCvFromTemplate(payload);
        toast.success('CV của bạn đã được tạo thành công!');
        // Navigate to the new CV's edit page
        navigate(`/editor/${newCv.data._id}`, { replace: true });
      } else {
        // This is an existing CV, update it
        await updateCv(cvData.id, backendData);
        toast.success('CV của bạn đã được cập nhật!');
      }
    } catch (error) {
      console.error('Save error:', error);
      const errorMessage = error.response?.data?.message || 'Không thể lưu CV. Vui lòng thử lại.';
      toast.error(errorMessage);
    } finally {
      setIsSaving(false);
    }
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Đang tải CV...</p>
        </div>
      </div>
    );
  }

  return (
    <>
      {/* Sample Data Spotlight - Highlights the sample data section */}
      {showSampleSuggestion && (
        <SampleDataSpotlight
          onSelectSample={loadSampleData}
          onDismiss={handleDismissSuggestion}
        />
      )}

      <div className="min-h-screen bg-gray-50">
      

      
      <div className="flex h-screen">
        {/* Sidebar */}
        <div className={`${isSidebarOpen ? 'w-80' : 'w-16'} bg-white border-r border-gray-200 transition-all duration-300`}>
          <div className="p-4 border-b border-gray-200">
            <div className="flex items-center justify-between">
              {isSidebarOpen && (
                <h2 className="text-lg font-semibold text-gray-800">CV Builder</h2>
              )}
              <button
                onClick={() => setIsSidebarOpen(!isSidebarOpen)}
                className="text-gray-500 hover:text-gray-700"
              >
                <Menu className="w-5 h-5" />
              </button>
            </div>
          </div>
          
          {/* Sample Data Buttons */}
          <div className="mb-4 p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200">
            <h3 className="text-sm font-semibold text-gray-700 mb-2 flex items-center">
              <Sparkles className="w-4 h-4 mr-1 text-blue-600" />
              Dùng dữ liệu mẫu
            </h3>
            <div className="grid grid-cols-1 gap-2">
              <button
                onClick={() => loadSampleData('default')}
                className="flex items-center justify-center px-3 py-2 text-xs font-medium text-blue-700 bg-blue-100 rounded-md hover:bg-blue-200 transition-colors"
              >
                <Zap className="w-3 h-3 mr-1" />
                Kỹ sư phần mềm
              </button>
              <button
                onClick={() => loadSampleData('creative')}
                className="flex items-center justify-center px-3 py-2 text-xs font-medium text-purple-700 bg-purple-100 rounded-md hover:bg-purple-200 transition-colors"
              >
                <Sparkles className="w-3 h-3 mr-1" />
                Nhà thiết kế
              </button>
              <button
                onClick={() => loadSampleData('minimal')}
                className="flex items-center justify-center px-3 py-2 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors"
              >
                <Coffee className="w-3 h-3 mr-1" />
                Marketing
              </button>
            </div>
          </div>

          {/* Action Buttons */}
          <div className="p-4 space-y-2">
            <button
              onClick={saveCv}
              disabled={isSaving}
              className="w-full flex items-center justify-center space-x-2 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 disabled:opacity-50"
            >
              <Save className="w-4 h-4" />
              {isSidebarOpen && <span>{isSaving ? 'Đang lưu...' : 'Lưu CV'}</span>}
            </button>

            <button
              onClick={exportPDF}
              disabled={isExporting}
              className="w-full flex items-center justify-center space-x-2 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 disabled:opacity-50"
            >
              <Download className="w-4 h-4" />
              {isSidebarOpen && <span>{isExporting ? 'Đang export...' : '📄 Export PDF'}</span>}
            </button>

            <button
              onClick={() => setShowPreview(!showPreview)}
              className="w-full flex items-center justify-center space-x-2 bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700"
            >
              <Eye className="w-4 h-4" />
              {isSidebarOpen && <span>{showPreview ? 'Ẩn Preview' : 'Xem Preview'}</span>}
            </button>
          </div>

          {/* Navigation Tabs */}
          {isSidebarOpen && (
            <div className="p-4">
              <div className="space-y-1">
                {[
                  { id: 'template', label: 'Mẫu CV', icon: Palette },
                  { id: 'personal', label: 'Thông tin cá nhân', icon: User },
                  { id: 'summary', label: 'Tóm tắt', icon: FileText },
                  { id: 'work', label: 'Kinh nghiệm', icon: Briefcase },
                  { id: 'education', label: 'Học vấn', icon: GraduationCap },
                  { id: 'skills', label: 'Kỹ năng', icon: Award },
                  { id: 'projects', label: 'Dự án', icon: FolderOpen },
                  { id: 'certificates', label: 'Chứng chỉ', icon: Certificate },
                  { id: 'layout', label: 'Bố cục & Thứ tự', icon: Settings },
                ].map((tab) => {
                  const Icon = tab.icon;
                  return (
                    <button
                      key={tab.id}
                      onClick={() => setActiveTab(tab.id)}
                      className={`w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-left transition-colors ${
                        activeTab === tab.id
                          ? 'bg-blue-100 text-blue-700 border-l-4 border-blue-600'
                          : 'text-gray-600 hover:bg-gray-100'
                      }`}
                    >
                      <Icon className="w-4 h-4" />
                      <span>{tab.label}</span>
                    </button>
                  );
                })}
              </div>
            </div>
          )}
        </div>

        {/* Main Content */}
        <div className={`flex-1 flex ${showPreview ? 'w-1/2' : 'w-full'}`}>
          <div className={`${showPreview ? 'w-1/2' : 'w-full'} overflow-y-auto`}>
            <div className="p-6">
              {cvData && (
                <div>
                  {activeTab === 'template' && (
                    <TemplateGallery
                      selectedTemplate={selectedTemplate}
                      onSelectTemplate={handleTemplateSelect}
                    />
                  )}
                  {activeTab === 'personal' && (
                    <PersonalInfoForm
                      personalInfo={cvData.personalInfo || {
                        fullName: '',
                        email: '',
                        phone: '',
                        address: '',
                        website: '',
                        linkedin: '',
                        github: '',
                        profileImage: ''
                      }}
                      onChange={(data) => setCVData({...cvData, personalInfo: data})}
                    />
                  )}
                  {activeTab === 'summary' && (
                    <div>
                      <h3 className="text-lg font-semibold mb-4">Tóm tắt nghề nghiệp</h3>
                      <textarea
                        value={cvData.professionalSummary || ''}
                        onChange={(e) => setCVData({...cvData, professionalSummary: e.target.value})}
                        rows={6}
                        className="w-full p-3 border border-gray-300 rounded-lg"
                        placeholder="Viết tóm tắt về bản thân và mục tiêu nghề nghiệp..."
                      />
                    </div>
                  )}
                  {activeTab === 'work' && (
                    <WorkExperienceForm
                      workExperience={cvData.workExperience || []}
                      onChange={(data) => setCVData({...cvData, workExperience: data})}
                    />
                  )}
                  {activeTab === 'education' && (
                    <EducationForm
                      education={cvData.education || []}
                      onChange={(data) => setCVData({...cvData, education: data})}
                    />
                  )}
                  {activeTab === 'skills' && (
                    <SkillsForm
                      skills={cvData.skills || []}
                      onChange={(data) => setCVData({...cvData, skills: data})}
                    />
                  )}
                  {activeTab === 'projects' && (
                    <ProjectsForm
                      projects={cvData.projects || []}
                      onChange={(data) => setCVData({...cvData, projects: data})}
                    />
                  )}
                  {activeTab === 'certificates' && (
                    <CertificatesForm
                      certificates={cvData.certificates || []}
                      onChange={(data) => setCVData({...cvData, certificates: data})}
                    />
                  )}
                  {activeTab === 'layout' && (
                    <SimpleSectionOrderManager
                      sectionOrder={cvData.sectionOrder || ['summary', 'experience', 'education', 'skills', 'projects', 'certificates']}
                      hiddenSections={cvData.hiddenSections || []}
                      currentTemplate={cvData.template || selectedTemplate}
                      onChange={(newOrder) => {
                        console.log('Section order changed:', newOrder);
                        setCVData({...cvData, sectionOrder: newOrder});
                      }}
                      onHiddenChange={(newHidden) => {
                        console.log('Hidden sections changed:', newHidden);
                        setCVData({...cvData, hiddenSections: newHidden});
                      }}
                    />
                  )}
                </div>
              )}
            </div>
          </div>

          {/* Preview Panel */}
          {showPreview && (
            <div className="w-1/2 bg-gray-100 border-l border-gray-200 overflow-y-auto">
              <div className="sticky top-0 bg-white border-b border-gray-200 p-4 z-10">
                <div className="flex items-center justify-between">
                  <h3 className="text-lg font-semibold text-gray-800">Preview</h3>
                  <button
                    onClick={() => setShowPreview(false)}
                    className="text-gray-500 hover:text-gray-700"
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              </div>
              <div className="p-6 flex justify-center items-start min-h-screen">
                <div 
                  style={{
                    transform: `scale(${scale})`,
                    transformOrigin: 'top center',
                    transition: 'transform 0.1s ease-out',
                  }}
                  className="shadow-2xl"
                >
                  {/* <CVPaginatedPreview ref={cvContentRef}> */}
                    <CVPreview
                      ref={cvContentRef}
                      cvData={cvData}
                      template={selectedTemplate}
                    />
                  {/* </CVPaginatedPreview> */}
                </div>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Hidden CV for export (no pagination) */}
      <div style={{ position: 'absolute', left: '-9999px', top: '-9999px', visibility: 'hidden' }}>
        <CVPreview
          ref={cvExportRef}
          cvData={cvData}
          template={selectedTemplate}
        />
      </div>
    </div>
    </>
  );
};

export default CVBuilder;
</file>

<file path="src/pages/jobs/components/SearchResults/JobResultCard.jsx">
import React from 'react';
import { useNavigate } from 'react-router-dom';
import { useSelector } from 'react-redux';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { saveJob, unsaveJob } from '@/services/savedJobService';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar';
import {
  MapPin,
  Clock,
  DollarSign,
  Briefcase,
  Building,
  Heart,
  ArrowRight,
  Users,
  Eye
} from 'lucide-react';
import { toast } from 'sonner';
import { cn } from '@/lib/utils';
import { formatSalary, formatTimeAgo, formatDistance, calculateDistance } from '@/utils/formatters';

/**
 * JobResultCard component for displaying individual job search results
 * Includes job details, company info, and action buttons
 */
const JobResultCard = ({
  job,
  onClick,
  className,
  showSaveButton = true,
  compact = false,
  userLocation,
  onSaveToggle,
  searchParameters
}) => {
  const navigate = useNavigate();
  const { isAuthenticated } = useSelector((state) => state.auth);
  const queryClient = useQueryClient();

  const distance = React.useMemo(() => {
    if (!userLocation || !job.location?.coordinates?.coordinates) {
      return null;
    }
    try {
      const userCoords = JSON.parse(userLocation);
      const jobCoords = job.location.coordinates.coordinates;
      const distanceInMeters = calculateDistance(userCoords, jobCoords);
      if (distanceInMeters === null) {
        return null;
      }
      return formatDistance(distanceInMeters);
    } catch (error) {
      console.error("Failed to calculate distance:", error);
      return null;
    }
  }, [userLocation, job.location?.coordinates]);

  /**
   * Handle job card click
   */
  const handleCardClick = () => {
    if (onClick) {
      onClick(job);
    } else {
      navigate(`/jobs/${job._id}`);
    }
  };

  /**
   * Handle save job
   * @param {Event} event - Click event
   */
  const { mutate: toggleSaveJob } = useMutation({
    mutationFn: () => {
      if (onSaveToggle) {
        onSaveToggle(job);
        return Promise.resolve();
      }
      return job.isSaved ? unsaveJob(job._id) : saveJob(job._id);
    },
    onMutate: async () => {
      if (onSaveToggle) return;

      const queryKey = ['jobs', 'search', searchParameters];
      await queryClient.cancelQueries({ queryKey });
      const previousData = queryClient.getQueryData(queryKey);

      queryClient.setQueryData(queryKey, (oldData) => {
        if (!oldData) return;
        const newData = {
          ...oldData,
          data: oldData.data.map(j =>
            j._id === job._id ? { ...j, isSaved: !j.isSaved } : j
          ),
        };
        return newData;
      });

      return { previousData };
    },
    onSuccess: () => {
      if (onSaveToggle) return;
      toast.success(job.isSaved ? 'Đã bỏ lưu việc làm' : 'Đã lưu việc làm thành công');
      queryClient.invalidateQueries({queryKey: ['savedJobs']});
    },
    onError: (err, _vars, context) => {
      if (onSaveToggle) return;
      if (context?.previousData) {
        queryClient.setQueryData(['jobs', 'search', searchParameters], context.previousData);
      }
      toast.error(err.response?.data?.message || 'Đã có lỗi xảy ra.');
    },
  });

  const handleSaveJob = (event) => {
    event.stopPropagation();
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để lưu việc làm.');
      return;
    }
    toggleSaveJob();
  };

  /**
   * Handle apply job
   * @param {Event} event - Click event
   */
  const handleApplyJob = (event) => {
    event.stopPropagation();
    
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để ứng tuyển');
      navigate('/login');
      return;
    }

    navigate(`/jobs/${job.id || job._id}`);
  };

  // Function to get color classes based on job type (FULL_TIME, PART_TIME, etc.)
 const getTypeColorClasses = (type) => {
    const colorMap = {
      'FULL_TIME': {
        bg: 'from-blue-500/10 to-cyan-500/10',
        text: 'text-blue-600',
        border: 'border-blue-500/20',
        hover: 'hover:from-blue-500/20 hover:to-cyan-500/20'
      },
      'PART_TIME': {
        bg: 'from-amber-500/10 to-orange-500/10',
        text: 'text-amber-600',
        border: 'border-amber-500/20',
        hover: 'hover:from-amber-500/20 hover:to-orange-500/20'
      },
      'CONTRACT': {
        bg: 'from-purple-500/10 to-violet-500/10',
        text: 'text-purple-600',
        border: 'border-purple-500/20',
        hover: 'hover:from-purple-50/20 hover:to-violet-500/20'
      },
      'INTERNSHIP': {
        bg: 'from-green-500/10 to-emerald-500/10',
        text: 'text-green-600',
        border: 'border-green-500/20',
        hover: 'hover:from-green-50/20 hover:to-emerald-500/20'
      },
      'FREELANCE': {
        bg: 'from-pink-500/10 to-rose-500/10',
        text: 'text-pink-60',
        border: 'border-pink-500/20',
        hover: 'hover:from-pink-500/20 hover:to-rose-500/20'
      }
    };
    return colorMap[type] || {
      bg: 'from-primary/10 to-info/10',
      text: 'text-primary',
      border: 'border-primary/20',
      hover: 'hover:from-primary/20 hover:to-info/20'
    };
  };

  // Function to get color classes based on work type (ON_SITE, REMOTE, HYBRID)
  const getWorkTypeColorClasses = (workType) => {
    const colorMap = {
      'ON_SITE': {
        bg: 'from-red-500/10 to-rose-500/10',
        text: 'text-red-600',
        border: 'border-red-500/20',
        hover: 'hover:from-red-500/20 hover:to-rose-500/20'
      },
      'REMOTE': {
        bg: 'from-indigo-500/10 to-blue-500/10',
        text: 'text-indigo-600',
        border: 'border-indigo-500/20',
        hover: 'hover:from-indigo-500/20 hover:to-blue-500/20'
      },
      'HYBRID': {
        bg: 'from-orange-500/10 to-amber-500/10',
        text: 'text-orange-600',
        border: 'border-orange-500/20',
        hover: 'hover:from-orange-500/20 hover:to-amber-500/20'
      }
    };
    return colorMap[workType] || {
      bg: 'from-primary/10 to-info/10',
      text: 'text-primary',
      border: 'border-primary/20',
      hover: 'hover:from-primary/20 hover:to-info/20'
    };
  };

  const typeColorClasses = getTypeColorClasses(job.type);
  const workTypeColorClasses = getWorkTypeColorClasses(job.workType);

  // Generate random color classes for other badges to ensure variety
  const getRandomColorClasses = () => {
    const colors = [
      { bg: 'from-blue-500/10 to-cyan-500/10', text: 'text-blue-600', border: 'border-blue-500/20', hover: 'hover:from-blue-500/20 hover:to-cyan-500/20' },
      { bg: 'from-emerald-500/10 to-green-500/10', text: 'text-emerald-600', border: 'border-emerald-500/20', hover: 'hover:from-emerald-500/20 hover:to-green-500/20' },
      { bg: 'from-purple-500/10 to-violet-50/10', text: 'text-purple-600', border: 'border-purple-500/20', hover: 'hover:from-purple-500/20 hover:to-violet-500/20' },
      { bg: 'from-amber-500/10 to-orange-500/10', text: 'text-amber-60', border: 'border-amber-500/20', hover: 'hover:from-amber-500/20 hover:to-orange-500/20' },
      { bg: 'from-pink-500/10 to-rose-500/10', text: 'text-pink-600', border: 'border-pink-50/20', hover: 'hover:from-pink-500/20 hover:to-rose-500/20' },
      { bg: 'from-indigo-500/10 to-blue-500/10', text: 'text-indigo-600', border: 'border-indigo-500/20', hover: 'hover:from-indigo-500/20 hover:to-blue-500/20' },
    ];
    return colors[Math.floor(Math.random() * colors.length)];
  };

  const salaryColorClasses = getRandomColorClasses();
  const locationColorClasses = getRandomColorClasses();

  return (
    <Card
      className={cn(
        "group cursor-pointer border-2 border-border/50",
        "hover:border-primary/50 hover:shadow-2xl hover:shadow-primary/20",
        "transition-all duration-500",
        "bg-card/95 backdrop-blur-sm",
        "overflow-hidden relative",
        className
      )}
      onClick={handleCardClick}
    >
        {/* Subtle gradient overlay on hover */}
        <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
        
        <CardContent className={cn("p-6 relative z-10", compact && "p-4")}>
        <div className="flex gap-4">
          {/* Company Logo */}
          <div className="flex-shrink-0">
            <div className={cn(
              "rounded-2xl border-2 border-primary/30 bg-white shadow-md",
              "group-hover:shadow-xl group-hover:border-primary/60 group-hover:scale-105",
              "transition-all duration-500 overflow-hidden",
              "relative",
              compact ? "h-28 w-28" : "h-32 w-32"
            )}>
              <Avatar className="h-full w-full rounded-2xl">
                <AvatarImage
                  src={job.company?.logo}
                  alt={job.company?.name}
                  className="object-cover"
                  onError={(e) => {
                    console.warn(`⚠️ Logo failed to load for ${job.company?.name}:`, job.company?.logo);
                  }}
                  onLoad={() => {
                    console.log(`✅ Logo loaded for ${job.company?.name}:`, job.company?.logo);
                  }}
                />
                <AvatarFallback className={cn(
                  "bg-gradient-to-br from-primary/20 via-primary/10 to-transparent",
                  "text-primary font-bold rounded-2xl",
                  "group-hover:from-primary/30 group-hover:via-primary/20",
                  "transition-all duration-500",
                  compact ? "text-2xl" : "text-3xl"
                )}>
                  {job.company?.name?.charAt(0) || job.title?.charAt(0) || 'J'}
                </AvatarFallback>
              </Avatar>
              {/* Shine effect on hover */}
              <div className="absolute inset-0 bg-gradient-to-tr from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 transform translate-x-[-100%] group-hover:translate-x-[100%]" />
            </div>
          </div>

          {/* Job Details */}
          <div className="flex-1 min-w-0">
            <div className="flex items-start justify-between gap-4 mb-3">
              <div className="flex-1 min-w-0">
                <h3 className={cn(
                  "font-bold text-foreground line-clamp-2 mb-2",
                  "group-hover:text-primary transition-all duration-300",
                  "leading-tight",
                  compact ? "text-lg" : "text-2xl"
                )}>
                  {job.title}
                </h3>
                <div
                  className={cn(
                    "flex items-center gap-2 text-muted-foreground",
                    "group-hover:text-primary/80 transition-all duration-300",
                    "group-hover:translate-x-1 cursor-pointer"
                  )}
                  onClick={(e) => {
                    e.stopPropagation();
                    if (job.company?._id) {
                      navigate(`/company/${job.company._id}`);
                    }
                  }}
                >
                  <Building className="h-4 w-4 flex-shrink-0 transition-transform duration-300 group-hover:scale-110" />
                  <span className="font-semibold truncate hover:underline">{job.company?.name}</span>
                </div>
              </div>
              
              {/* Save Button */}
              {showSaveButton && (
                <Button
                  variant="ghost"
                  size="icon"
                  onClick={handleSaveJob}
                  className={cn(
                    "flex-shrink-0 rounded-xl transition-all duration-300",
                    "hover:bg-red-50/20 hover:scale-110",
                    job.isSaved 
                      ? "text-red-500 hover:text-red-600" 
                      : "text-muted-foreground hover:text-red-500"
                  )}
                >
                  <Heart className={cn(
                    "h-6 w-6 transition-all duration-300",
                    job.isSaved && "fill-red-500 animate-pulse"
                  )} />
                </Button>
              )}
            </div>

            {/* Job Info Badges */}
            <div className="flex flex-wrap gap-2 mb-4">
              {job.type && (
                <Badge 
                  variant="secondary" 
                  className={cn(
                    "text-xs font-semibold px-3 py-1 rounded-lg",
                    "bg-gradient-to-r", typeColorClasses.bg,
                    typeColorClasses.text,
                    "border border-transparent",
                    "hover:scale-105 hover:shadow-md transition-all duration-300",
                    "group-hover:animate-pulse"
                  )}
                >
                  <Briefcase className="h-3 w-3 mr-1" />
                  {job.type}
                </Badge>
              )}
              
              {job.workType && (
                <Badge 
                  variant="outline" 
                  className={cn(
                    "text-xs font-semibold px-3 py-1 rounded-lg",
                    "bg-gradient-to-r", workTypeColorClasses.bg,
                    workTypeColorClasses.text,
                    "border-2", workTypeColorClasses.border,
                    "hover:scale-105 hover:shadow-md transition-all duration-300"
                  )}
                >
                  {job.workType}
                </Badge>
              )}
              
              <Badge 
                variant="outline" 
                className={cn(
                  "text-xs font-semibold px-3 py-1 rounded-lg",
                  "bg-gradient-to-r from-emerald-500/10 to-green-500/10",
                  "text-emerald-600 border-2 border-emerald-500/30",
                  "hover:scale-105 hover:shadow-md transition-all duration-300"
                )}
              >
                <DollarSign className="h-3 w-3 mr-1" />
                {formatSalary(job.salaryMin || job.minSalary, job.salaryMax || job.maxSalary)}
              </Badge>
              
              {job.location && job.location.province && (
                <Badge 
                  variant="outline" 
                  className={cn(
                    "text-xs font-semibold px-3 py-1 rounded-lg",
                    "bg-gradient-to-r from-blue-500/10 to-cyan-500/10",
                    "text-blue-600 border-2 border-blue-500/30",
                    "hover:scale-105 hover:shadow-md transition-all duration-300"
                  )}
                >
                  <MapPin className="h-3 w-3 mr-1" />
                  {job.location.province}
               </Badge>
             )}

             
             {job.deadline && (
               <Badge 
                 variant="outline" 
                 className={cn(
                   "text-xs font-semibold px-3 py-1 rounded-lg",
                   "bg-gradient-to-r from-red-500/10 to-rose-500/10",
                   "text-red-600 border-2 border-red-500/30",
                   "hover:scale-105 hover:shadow-md transition-all duration-300",
                   "animate-pulse"
                 )}
               >
                  <Clock className="h-3 w-3 mr-1" />
                  Hạn: {new Date(job.deadline).toLocaleDateString('vi-VN')}
                </Badge>
              )}
            </div>

            {/* Job Description */}
            {!compact && job.description && (
              <p className="text-muted-foreground text-sm line-clamp-2 mb-4 group-hover:text-foreground transition-colors duration-300">
                {job.description}
              </p>
            )}

            {/* Job Skills/Requirements */}
            {!compact && job.skills && job.skills.length > 0 && (
              <div className="flex flex-wrap gap-2 mb-4">
                {job.skills.slice(0, 4).map((skill, index) => (
                  <Badge 
                    key={index} 
                    variant="secondary" 
                    className={cn(
                      "text-xs font-medium px-3 py-1 rounded-full",
                      "bg-gradient-to-r from-primary/15 to-primary/5",
                      "text-primary border border-primary/30",
                      "hover:from-primary/25 hover:to-primary/10",
                      "hover:scale-110 hover:shadow-md hover:shadow-primary/20",
                      "transition-all duration-300 cursor-default"
                    )}
                  >
                    {skill}
                  </Badge>
                ))}
                {job.skills.length > 4 && (
                  <Badge 
                    variant="secondary" 
                    className={cn(
                      "text-xs font-bold px-3 py-1 rounded-full",
                      "bg-gradient-to-r from-primary/20 to-primary/10",
                      "text-primary border-2 border-primary/40",
                      "hover:from-primary/30 hover:to-primary/15",
                      "hover:scale-110 hover:shadow-md hover:shadow-primary/20",
                      "transition-all duration-300 cursor-default"
                    )}
                  >
                    +{job.skills.length - 4}
                  </Badge>
                )}
              </div>
            )}

            {/* Footer Info */}
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-4 text-xs text-muted-foreground group-hover:text-foreground transition-colors duration-300">
                <div className="flex items-center gap-1 group-hover:text-primary transition-colors duration-300">
                  <Clock className="h-3 w-3" />
                  {formatTimeAgo(job.createdAt)}
                </div>
                
                {distance && (
                  <div className="flex items-center gap-1 group-hover:text-primary transition-colors duration-300">
                    <MapPin className="h-3 w-3" />
                    {distance}
                  </div>
                )}
                {job.applicantCount && (
                  <div className="flex items-center gap-1 group-hover:text-primary transition-colors duration-300">
                    <Users className="h-3 w-3" />
                    {job.applicantCount} ứng viên
                  </div>
                )}
                
                {job.views && (
                  <div className="flex items-center gap-1 group-hover:text-primary transition-colors duration-300">
                    <Eye className="h-3 w-3" />
                    {job.views} lượt xem
                  </div>
                )}
              </div>

              {/* Action Buttons */}
              <div className="flex items-center gap-3">
                <Button
                  variant="outline"
                  size="sm"
                  onClick={handleCardClick}
                  className={cn(
                    "text-xs font-semibold px-4 py-2 rounded-lg",
                    "border-2 border-primary/40 text-primary",
                    "hover:bg-primary/10 hover:border-primary",
                    "hover:scale-105 hover:shadow-md hover:shadow-primary/20",
                    "transition-all duration-300 group/btn"
                  )}
                >
                  Xem chi tiết
                  <ArrowRight className="h-3 w-3 ml-1 transition-transform duration-300 group-hover/btn:translate-x-1" />
                </Button>
                
                <Button
                  size="sm"
                  onClick={handleApplyJob}
                  className={cn(
                    "btn-gradient text-primary-foreground",
                    "text-xs font-bold px-5 py-2 rounded-lg",
                    "hover:scale-110 hover:shadow-xl hover:shadow-primary/40",
                    "transition-all duration-300 relative overflow-hidden",
                    "group/apply"
                  )}
                >
                  <span className="relative z-10">Ứng tuyển</span>
                  {/* Shine effect */}
                  <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover/apply:opacity-100 transition-opacity duration-300" />
                </Button>
              </div>
            </div>
          </div>
        </div>
        </CardContent>
      </Card>
  );
};

export default JobResultCard;
</file>

<file path="src/pages/jobs/JobSearch.jsx">
import React, { useState } from 'react';
import { useSearchParams, useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Separator } from '@/components/ui/separator';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import { Filter, ArrowLeft, Map, List } from 'lucide-react';
import { searchJobsHybrid } from '@/services/jobService';
import { validateSearchParams, validateHybridSearchRequest } from '@/schemas/searchSchemas';
import { toast } from 'sonner';

// Import search interface components
import JobSearchBar from './components/SearchInterface/JobSearchBar';
import SearchFilters from './components/SearchInterface/SearchFilters';
import JobResultsList from './components/SearchResults/JobResultsList';
import SearchResultsHeader from './components/SearchResults/SearchResultsHeader';
import ResultsPagination from './components/SearchResults/ResultsPagination';
import JobMapView from './components/MapView/JobMapView';
import { cn } from '@/lib/utils';

/**
 * Main JobSearch page component
 * Handles URL parameters, search state management, and layout
 */
const JobSearch = () => {
  const navigate = useNavigate();
  const [searchParams, setSearchParams] = useSearchParams();
  const [isMobileFilterOpen, setIsMobileFilterOpen] = useState(false);
  const [viewMode, setViewMode] = useState('list'); // 'list' or 'map'

  // Extract and validate search parameters from URL
  const rawParams = {
    query: searchParams.get('query') || '',
    page: searchParams.get('page') || 1,
    size: searchParams.get('size') || 10,
    category: searchParams.get('category') || '',
    type: searchParams.get('type') || '',
    workType: searchParams.get('workType') || '',
    experience: searchParams.get('experience') || '',
    province: searchParams.get('province') || '',
    district: searchParams.get('district') || '',
    minSalary: searchParams.get('minSalary') || '',
    maxSalary: searchParams.get('maxSalary') || '',
    latitude: searchParams.get('latitude') || '',
    longitude: searchParams.get('longitude') || '',
    distance: searchParams.get('distance') || ''
  };

  // Validate URL parameters
  const paramValidation = validateSearchParams(rawParams);

  if (!paramValidation.success) {
    console.warn('Invalid search parameters:', paramValidation.errors);
    // Show validation errors to user if needed
    paramValidation.errors?.forEach(error => {
      toast.error(`Lỗi tham số: ${error.message}`);
    });
  }

  // Use validated parameters or defaults
  const validatedParams = paramValidation.data || {};
  const query = validatedParams.query || '';
  const page = validatedParams.page || 1;
  const size = validatedParams.size || 10;
  const category = validatedParams.category || '';
  const type = validatedParams.type || '';
  const workType = validatedParams.workType || '';
  const experience = validatedParams.experience || '';
  const province = validatedParams.province || '';
  const district = validatedParams.district || '';
  const minSalary = validatedParams.minSalary || '';
  const maxSalary = validatedParams.maxSalary || '';
  const latitude = validatedParams.latitude || '';
  const longitude = validatedParams.longitude || '';
  const distance = validatedParams.distance || '';

  // Search parameters object for API calls
  const searchParameters = {
    query: query || '', // Always include query, even if empty string
    page,
    size,
    textWeight: 0.4, // Default weight for text search
    vectorWeight: 0.6, // Default weight for vector search
    ...(category && { category }),
    ...(type && { type }),
    ...(workType && { workType }),
    ...(experience && { experience }),
    ...(province && { province }),
    ...(district && { district }),
    ...(minSalary && { minSalary: parseInt(minSalary) }),
    ...(maxSalary && { maxSalary: parseInt(maxSalary) }),
    ...(latitude && { latitude: parseFloat(latitude) }),
    ...(longitude && { longitude: parseFloat(longitude) }),
    ...(distance && { distance: parseFloat(distance) })
  };

  // Debug: Log search parameters
  console.log('Search Parameters:', searchParameters);

  // Validate API request parameters - always use hybrid search now
  const apiValidation = validateHybridSearchRequest(searchParameters);

  if (!apiValidation.success) {
    console.warn('Invalid API parameters:', apiValidation.errors);
  } else {
    console.log('Validated API Parameters:', apiValidation.data);
  }

  // React Query for search results - always use hybrid search
  const {
    data: searchResults,
    isLoading,
    isError,
    error,
    refetch
  } = useQuery({
    queryKey: ['jobs', 'search', apiValidation.data || searchParameters],
    queryFn: async () => {
      const result = await searchJobsHybrid(apiValidation.data || searchParameters);
      
      // 🔍 DEBUG: Log API response để kiểm tra logo
      console.log('🔍 API Response:', result);
      if (result?.data?.length > 0) {
        console.log('📊 First job sample:', {
          title: result.data[0].title,
          company: result.data[0].company,
          hasLogo: !!result.data[0].company?.logo,
          logoUrl: result.data[0].company?.logo
        });
      }
      
      return result;
    },
    enabled: apiValidation.success, // Always fetch when parameters are valid
    staleTime: 5 * 60 * 1000, // 5 minutes
    cacheTime: 10 * 60 * 1000, // 10 minutes
    refetchOnWindowFocus: false, // Prevent refetch on window focus
    keepPreviousData: true // Keep previous data while loading new data to prevent layout shift
  });

  /**
   * Handle search query changes
   * @param {string} newQuery - New search query
   */
  const handleSearch = (newQuery) => {
    const newParams = new URLSearchParams(searchParams);
    // Always set query, even if empty string
    newParams.set('query', newQuery ? newQuery.trim() : '');
    newParams.set('page', 1); // Reset to first page
    setSearchParams(newParams);
  };

  /**
   * Handle filter changes
   * @param {Object} filters - Filter values object
   */
  const handleFilterChange = (filters) => {
    const newParams = new URLSearchParams(searchParams);

    // Update all filter parameters
    Object.entries(filters).forEach(([key, value]) => {
      if (value) {
        newParams.set(key, value);
      } else {
        newParams.delete(key);
      }
    });

    // Reset to first page when filters change
    newParams.set('page', 1);
    setSearchParams(newParams);
  };

  /**
   * Handle pagination
   * @param {number} newPage - New page number
   */
  const handlePageChange = (newPage) => {
    const newParams = new URLSearchParams(searchParams);
    newParams.set('page', newPage);
    setSearchParams(newParams);

    // Scroll to top when page changes
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  /**
   * Clear all filters
   */
  const handleClearFilters = () => {
    const newParams = new URLSearchParams();
    if (query) newParams.set('query', query);
    newParams.set('page', '1');
    newParams.set('size', size.toString());
    setSearchParams(newParams);
  };

  /**
   * Handle back navigation
   */
  const handleBackNavigation = () => {
    navigate(-1);
  };

  // Current filter values for the filter components
  const currentFilters = {
    category,
    type,
    workType,
    experience,
    province,
    district,
    minSalary,
    maxSalary,
    latitude,
    longitude,
    distance
  };

  // Check if any filters are applied
  const hasActiveFilters = Object.values(currentFilters).some(value => value !== '');
  
  // User location for map view (if distance filter is active)
  const userLocationForMap = (latitude && longitude) ? `[${longitude}, ${latitude}]` : null;

  return (
    <div className="min-h-screen bg-background/80 backdrop-blur-sm relative z-10">
      {/* Header with search bar */}
      <div className={cn(
        "sticky top-0 z-40",
        "bg-background/80 backdrop-blur-xl",
        "border-b-2 border-border/50",
        "shadow-lg shadow-primary/5",
        "transition-all duration-300"
      )}>
        <div className="container py-5">
          <div className="flex items-center gap-4">
            {/* Back Button with enhanced styling */}
            <Button
              variant="ghost"
              size="icon"
              onClick={handleBackNavigation}
              className={cn(
                "flex-shrink-0 rounded-xl",
                "hover:bg-primary/10 hover:scale-105",
                "transition-all duration-300",
                "border-2 border-transparent hover:border-primary/30"
              )}
            >
              <ArrowLeft className="h-5 w-5 text-muted-foreground hover:text-primary transition-colors duration-300" />
            </Button>

            {/* Search Bar */}
            <div className="flex-1">
              <JobSearchBar
                initialQuery={query}
                currentFilters={currentFilters}
                onSearch={handleSearch}
                onFiltersApply={handleFilterChange}
                placeholder="Tìm kiếm công việc, kỹ năng, công ty..."
              />
            </div>

            {/* Mobile Filter Button */}
            <Sheet open={isMobileFilterOpen} onOpenChange={setIsMobileFilterOpen}>
              <SheetTrigger asChild>
                <Button
                  variant="outline"
                  size="icon"
                  className={cn(
                    "lg:hidden flex-shrink-0 rounded-xl",
                    "border-2 border-primary/40 hover:border-primary",
                    "hover:bg-primary/10 hover:scale-105",
                    "transition-all duration-300",
                    hasActiveFilters && "bg-primary/10 border-primary animate-pulse"
                  )}
                >
                  <Filter className={cn(
                    "h-5 w-5 transition-colors duration-300",
                    hasActiveFilters ? "text-primary" : "text-muted-foreground"
                  )} />
                </Button>
              </SheetTrigger>
              <SheetContent side="left" className="w-80 p-0">
                <div className="p-6">
                  <h3 className="text-lg font-semibold mb-4">Bộ lọc tìm kiếm</h3>
                  <SearchFilters
                    filters={currentFilters}
                    onFilterChange={handleFilterChange}
                  />
                </div>
              </SheetContent>
            </Sheet>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="container py-6">
        <div className="grid grid-cols-1 lg:grid-cols-[320px_1fr] gap-6 items-start">
          {/* Desktop Filters Sidebar - Fixed Width */}
          <aside className="hidden lg:block w-[320px]">
            <div className="sticky top-28">
              <Card className={cn(
                "border-2 border-border/50 shadow-xl shadow-primary/5",
                "bg-card/95 backdrop-blur-sm",
                "hover:shadow-2xl hover:shadow-primary/10",
                "transition-shadow duration-500",
                "overflow-hidden relative"
              )}>
                {/* Gradient overlay */}
                <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-transparent opacity-50" />
                
                <CardContent className="p-6 relative z-10">
                  <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-2">
                      <div className="flex items-center justify-center w-8 h-8 rounded-lg bg-gradient-to-br from-primary/20 to-primary/10 border border-primary/30">
                        <Filter className="h-4 w-4 text-primary" />
                      </div>
                      <h3 className="text-lg font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent">
                        Bộ lọc
                      </h3>
                    </div>
                    {hasActiveFilters && (
                      <Button
                        variant="ghost"
                        size="sm"
                        onClick={handleClearFilters}
                        className={cn(
                          "text-xs font-semibold rounded-lg",
                          "text-red-600 hover:text-red-700",
                          "hover:bg-red-50/20 border border-transparent",
                          "hover:border-red-500/30",
                          "transition-all duration-300 hover:scale-105"
                        )}
                      >
                        Xóa bộ lọc
                      </Button>
                    )}
                  </div>
                  <Separator className="mb-4 bg-gradient-to-r from-transparent via-border to-transparent" />
                  <SearchFilters
                    filters={currentFilters}
                    onFilterChange={handleFilterChange}
                  />
                </CardContent>
              </Card>
            </div>
          </aside>

          {/* Search Results - Main Content Area */}
          <main className="min-w-0">
            {/* Results Header with View Mode Toggle */}
            <div className="mb-8">
              <Card className={cn(
                "border-2 border-border/30 shadow-lg shadow-primary/5",
                "bg-card/90 backdrop-blur-sm",
                "transition-all duration-300"
              )}>
                <CardContent className="p-6">
                  <div className="flex flex-col gap-4">
                    {/* Search Results Header */}
                    <div className="flex-1">
                      <SearchResultsHeader
                        query={query}
                        currentPage={page}
                        totalPages={searchResults?.meta?.totalPages || 0}
                        hasActiveFilters={hasActiveFilters}
                        onClearFilters={handleClearFilters}
                      />
                    </div>
                    
                    {/* View Mode Toggle */}
                    <div className="flex items-center justify-center sm:justify-end gap-2">
                      <span className="text-sm text-muted-foreground font-medium mr-2">
                        Hiển thị:
                      </span>
                      <Button
                        variant={viewMode === 'list' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setViewMode('list')}
                        className={cn(
                          "transition-all duration-300",
                          viewMode === 'list' && "btn-gradient text-white shadow-lg shadow-primary/20"
                        )}
                      >
                        <List className="h-4 w-4 mr-2" />
                        Danh sách
                      </Button>
                      <Button
                        variant={viewMode === 'map' ? 'default' : 'outline'}
                        size="sm"
                        onClick={() => setViewMode('map')}
                        className={cn(
                          "transition-all duration-300",
                          viewMode === 'map' && "btn-gradient text-white shadow-lg shadow-primary/20"
                        )}
                      >
                        <Map className="h-4 w-4 mr-2" />
                        Bản đồ
                      </Button>
                    </div>
                  </div>
                </CardContent>
              </Card>
            </div>

            {/* Conditional View - List or Map */}
            {viewMode === 'list' ? (
              /* Results List - Enhanced spacing */
              <div className="min-h-[600px] space-y-4">
                <JobResultsList
                  jobs={searchResults?.data || []}
                  isLoading={isLoading}
                  isError={isError}
                  error={error}
                  onRetry={refetch}
                  query={query}
                  userLocation={userLocationForMap}
                  searchParameters={apiValidation.data || searchParameters}
                />
              </div>
            ) : (
              /* Map View - No Pagination Needed */
              <div className="min-h-[600px]">
                <JobMapView
                  initialJobs={searchResults?.data || []}
                  isLoading={isLoading}
                  userLocation={userLocationForMap}
                  searchFilters={searchParameters}
                />
              </div>
            )}

            {/* Pagination - Only for List View */}
            {viewMode === 'list' && searchResults?.data?.length > 0 && (
              <div className="mt-8 flex justify-center">
                <Card className={cn(
                  "border-2 border-border/30 shadow-lg shadow-primary/5",
                  "bg-card/90 backdrop-blur-sm"
                )}>
                  <CardContent className="p-4">
                    <ResultsPagination
                      currentPage={page}
                      totalPages={searchResults?.meta?.totalPages || 0}
                      totalResults={searchResults?.meta?.total || 0}
                      pageSize={size}
                      onPageChange={handlePageChange}
                    />
                  </CardContent>
                </Card>
              </div>
            )}
          </main>
        </div>
      </div>
    </div>
  );
};

export default JobSearch;
</file>

<file path="src/pages/profile/ProfilePage.jsx">
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import { Skeleton } from '@/components/ui/skeleton';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { BasicInfoSection } from '@/components/profile/BasicInfoSection';
import { PreferencesSection } from '@/components/profile/PreferencesSection';
import { ExperienceSection } from '@/components/profile/ExperienceSection';
import { EducationSection } from '@/components/profile/EducationSection';
import { SkillsSection } from '@/components/profile/SkillsSection';
import { CertificatesSection } from '@/components/profile/CertificatesSection';
import { ProjectsSection } from '@/components/profile/ProjectsSection';
import { ProfileCompletenessCard } from '@/components/profile/ProfileCompletenessCard';
import { ProfileCompletionBanner } from '@/components/profile/ProfileCompletionBanner';
import { CategoryUpdatePrompt } from '@/components/profile/CategoryUpdatePrompt';
import * as profileService from '@/services/profileService';

const ProfilePage = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const { isAuthenticated } = useSelector((state) => state.auth);

  // Fetch profile data
  const { data: profile, isLoading, isError, error, refetch } = useQuery({
    queryKey: ['myProfile'],
    queryFn: async () => {
      const response = await profileService.getMyProfile();
      console.log('Profile data:', response.data);
      console.log('Profile completeness:', response.data?.profileCompleteness);
      return response.data;
    },
    enabled: isAuthenticated
  });

  // Update profile mutation
  const updateProfileMutation = useMutation({
    mutationFn: (updateData) => profileService.updateProfile(updateData),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['myProfile'] });
    }
  });

  // Upload avatar mutation
  const uploadAvatarMutation = useMutation({
    mutationFn: (formData) => profileService.uploadAvatar(formData),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['myProfile'] });
    }
  });

  // Update preferences mutation
  const updatePreferencesMutation = useMutation({
    mutationFn: (preferences) => profileService.updateProfilePreferences(preferences),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['myProfile'] });
    }
  });



  // Redirect if not authenticated
  if (!isAuthenticated) {
    navigate('/login');
    return null;
  }

  // Loading state
  if (isLoading) {
    return (
      <div className="min-h-screen">
        <div className="container mx-auto py-8">
          <div className="max-w-6xl mx-auto space-y-6">
            <Skeleton className="h-48 w-full" />
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <div className="lg:col-span-2 space-y-6">
                <Skeleton className="h-64 w-full" />
                <Skeleton className="h-64 w-full" />
              </div>
              <div className="space-y-6">
                <Skeleton className="h-48 w-full" />
                <Skeleton className="h-48 w-full" />
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // Error state
  if (isError) {
    const errorMessage = error.response?.data?.message || error.message;
    return (
      <div className="min-h-screen bg-background">
        <div className="container mx-auto py-8">
          <div className="max-w-4xl mx-auto">
            <Card className="text-center py-8">
              <CardContent>
                <div className="text-destructive mb-4">
                  <svg className="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <h3 className="text-xl font-semibold text-foreground mb-2">Có lỗi xảy ra</h3>
                <p className="text-muted-foreground mb-4">{errorMessage}</p>
                <Button onClick={() => refetch()} size="lg">
                  Thử lại
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    );
  }

    return (
    <div className="min-h-screen">
      <div className="container mx-auto py-8">
        <div className="max-w-6xl mx-auto space-y-6">
          {/* Profile Completion Banner */}
          <ProfileCompletionBanner 
            profileCompleteness={profile?.profileCompleteness}
            profile={profile}
          />

          {/* Category Update Prompt for existing users */}
          <CategoryUpdatePrompt profile={profile} />

          {/* Basic Info Section */}
          <BasicInfoSection
            profile={profile}
            onUpdate={(data) => updateProfileMutation.mutateAsync(data)}
            onAvatarUpdate={(formData) => uploadAvatarMutation.mutateAsync(formData)}
          />

          {/* Preferences Section */}
          <div data-section="preferences">
            <PreferencesSection
              profile={profile}
              onUpdate={(data) => updatePreferencesMutation.mutateAsync(data)}
            />
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {/* Left Column - Skills, Completeness */}
            <div className="space-y-6">
              {/* Profile Completeness Card */}
              <ProfileCompletenessCard 
                profileCompleteness={profile?.profileCompleteness}
                profile={profile}
              />

              <SkillsSection
                skills={profile?.skills || []}
                onUpdate={(data) => updateProfileMutation.mutateAsync(data)}
              />
            </div>

            {/* Right Column - Experience, Education, Projects, Certificates */}
            <div className="lg:col-span-2 space-y-6">
              <ExperienceSection
                experiences={profile?.experiences || []}
                onUpdate={(data) => updateProfileMutation.mutateAsync(data)}
              />

              <EducationSection
                educations={profile?.educations || []}
                onUpdate={(data) => updateProfileMutation.mutateAsync(data)}
              />

              <ProjectsSection
                projects={profile?.projects || []}
                onUpdate={(data) => updateProfileMutation.mutateAsync(data)}
              />

              <CertificatesSection
                certificates={profile?.certificates || []}
                onUpdate={(data) => updateProfileMutation.mutateAsync(data)}
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ProfilePage;
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react-swc'
import tailwindcss from '@tailwindcss/vite'
import mkcert from 'vite-plugin-mkcert'
import path from 'path'
import { fileURLToPath } from 'url'

const __filename = fileURLToPath(import.meta.url)
const __dirname = path.dirname(__filename)

export default defineConfig({
  plugins: [react(), tailwindcss(), mkcert()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    },
  },
  define: {
    global: 'globalThis',
    'process.env': {},
  },
  build: {
    rollupOptions: {
      input: {
        main: path.resolve(__dirname, 'index.html'),
        render: path.resolve(__dirname, 'render.html'),
      },
    },
  },
  server: {
    // https: true,       // bật https
    https: false,       // bật https
    host: 'localhost', // đảm bảo chạy localhost
    port: 3000,        // giữ nguyên port hiện tại
    proxy: {
      '/api': {
        target: 'http://localhost:5000',
        changeOrigin: true,
      },
    },
    allowedHosts: true
  },
})
</file>

<file path="src/components/sections/FeaturedJobs.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useSelector } from 'react-redux';
import { MapPin, Briefcase, DollarSign, Clock, ArrowRight, Star, Heart, Building, Calendar } from 'lucide-react';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { Avatar, AvatarImage, AvatarFallback } from '../ui/avatar';
import { Skeleton } from '../ui/skeleton';
import { SectionHeader } from '../common/SectionHeader';
import { getAllJobs } from '../../services/jobService';
import { formatSalary, formatSalaryVND, formatLocation, formatWorkType, formatTimeAgo, formatExperience } from '../../utils/formatters';

const FeaturedJobs = () => {
  const navigate = useNavigate();
  const [jobs, setJobs] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    // Only fetch jobs if user is authenticated

    const fetchFeaturedJobs = async () => {
      try {
        setIsLoading(true);
        setError(null);

        console.log('🔄 Fetching featured jobs...');

        const response = await getAllJobs({
          page: 1,
          limit: 6,
          sortBy: 'newest'
        });

        console.log('✅ Featured jobs API response:', response);

        // Check if the API response indicates success
        if (response.data && response.data.success) {
          // Extract jobs data from the response
          let jobsData = [];
          if (Array.isArray(response.data.data)) {
            jobsData = response.data.data;
          } else if (response.data.data && Array.isArray(response.data.data)) {
            jobsData = response.data.data;
          } else {
            jobsData = [];
          }

          console.log('📋 Jobs data extracted:', jobsData);
          setJobs(jobsData);
        } else {
          throw new Error(response.data?.message || 'Không thể tải danh sách việc làm nổi bật');
        }
      } catch (err) {
        console.error('❌ Error fetching featured jobs:', err);
        console.error('❌ Error details:', {
          message: err.message,
          status: err.response?.status,
          statusText: err.response?.statusText,
          data: err.response?.data
        });

        // For network errors or auth issues, show a user-friendly message
        if (err.response?.status === 401 || err.response?.status === 403) {
          setError('Phiên đăng nhập đã hết hạn. Vui lòng đăng nhập lại');
        } else if (err.response?.status >= 500) {
          setError('Máy chủ đang gặp sự cố. Vui lòng thử lại sau');
        } else {
          setError(err.response?.data?.message || err.message || 'Không thể tải danh sách việc làm');
        }

        // Set empty array instead of leaving it undefined
        setJobs([]);
      } finally {
        setIsLoading(false);
      }
    };

    fetchFeaturedJobs();
  }, []);
// ====== Format dữ liệu =======
  // Removed local format functions - now using utils/formatters.js

  const handleViewAll = () => {
    navigate('/jobs/search');
  };

  const handleJobClick = (jobId) => {
    navigate(`/jobs/${jobId}`);
  };

  return (
    <section className="py-20 bg-background">
      <div className="container">
        <SectionHeader
          badgeText="⭐ Việc làm nổi bật"
          title={<>Cơ hội nghề nghiệp <span className="bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">hàng đầu</span></>}
          description="Khám phá những vị trí chất lượng từ các công ty uy tín, với mức lương hấp dẫn và môi trường chuyên nghiệp."
        />

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
          {isLoading ? (
            // Loading skeletons
            [...Array(6)].map((_, i) => (
              <Card key={i} className="h-80 shadow-lg">
                <CardContent className="p-6">
                  <div className="space-y-4">
                    <div className="flex items-start justify-between">
                      <Skeleton className="w-16 h-16 rounded-xl" />
                      <Skeleton className="w-12 h-12 rounded-full" />
                    </div>
                    <div className="space-y-3">
                      <Skeleton className="h-6 w-full" />
                      <Skeleton className="h-4 w-3/4" />
                    </div>
                    <div className="space-y-2">
                      <Skeleton className="h-5 w-1/2" />
                      <Skeleton className="h-4 w-2/3" />
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))
          ) : (
            jobs.slice(0, 6).map((job) => (
              <Card
                key={job._id || job.id}
                className="group relative overflow-hidden border shadow-lg hover:shadow-2xl bg-card cursor-pointer transition-all duration-300 hover:-translate-y-1 rounded-2xl"
                onClick={() => handleJobClick(job._id || job.id)}
              >
               <CardHeader>
  <div className="flex items-center space-x-4">
    <Avatar className="w-16 h-16">
      <AvatarImage src={job.company?.logo || ''} alt={job.company?.name || 'Logo'} />
      <AvatarFallback>{job.company?.name?.[0] || 'C'}</AvatarFallback>
    </Avatar>
    <div>
      <CardTitle>{job.title || 'Không có tiêu đề'}</CardTitle>
      <div className="flex items-center space-x-2 text-sm text-muted-foreground">
        <Building className="w-4 h-4" />
        <span>{job.company?.name || 'Không rõ công ty'}</span>
        <MapPin className="w-4 h-4" />
        <span>{
          job.location?.province 
            ? `${job.location.district ? job.location.district + ', ' : ''}${job.location.province}`
            : 'Không rõ địa điểm'
        }</span>
      </div>
    </div>
  </div>
</CardHeader>

                <CardContent className="pt-2">
                 <div className="flex flex-wrap gap-4">
  <Badge variant="secondary" className="flex items-center gap-1">
    <DollarSign className="w-3 h-3" />
    {formatSalaryVND(job.minSalary, job.maxSalary)}
  </Badge>
  <Badge variant="secondary" className="flex items-center gap-1">
    <Clock className="w-3 h-3" />
    {formatWorkType(job.workType)}
  </Badge>
  <Badge variant="secondary" className="flex items-center gap-1">
    <Briefcase className="w-3 h-3" />
    {formatExperience(job.experience)}
  </Badge>
  <Badge variant="secondary" className="flex items-center gap-1">
    <Calendar className="w-3 h-3" />
    {job.deadline ? `Hạn: ${new Date(job.deadline).toLocaleDateString('vi-VN')}` : 'N/A'}
  </Badge>
</div>
              
                </CardContent>

                <CardFooter className="border-t pt-3 flex justify-end items-center bg-transparent">
                  <Button
                    variant="ghost"
                    className="p-0 h-auto font-semibold text-green-700 group-hover:translate-x-1 transition-all duration-300 hover:text-green-800"
                    onClick={(e) => {
                      e.stopPropagation();
                      handleJobClick(job._id || job.id);
                    }}
                  >
                    Xem chi tiết <ArrowRight className="ml-1 h-4 w-4" />
                  </Button>
                </CardFooter>
              </Card>
            ))
          )}
        </div>

        <div className="text-center">
          <Button
            size="lg"
            className="px-8 py-6 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white transition-all duration-300 shadow-lg hover:shadow-xl rounded-2xl font-semibold"
            onClick={handleViewAll}
          >
            Xem tất cả việc làm
            <ArrowRight className="ml-2 h-5 w-5" />
          </Button>
        </div>
      </div>
    </section>
  );
};

export default FeaturedJobs;
</file>

<file path="src/components/sections/HeroSection.jsx">
import { Search, Briefcase, User, MapPin } from "lucide-react";
import { Input } from "../ui/input";
import { Button } from "../ui/button";
import { useNavigate } from "react-router-dom";
import { useState, useRef } from "react";
import HomeSearchAutocomplete from "../common/HomeSearchAutocomplete";

const HeroSection = () => {
  const navigate = useNavigate();
  const [location, setLocation] = useState("");
  const autocompleteRef = useRef(null);

  /**
   * Handle search from hero section
   */
  const handleHeroSearch = (query) => {
    const searchParams = new URLSearchParams();
    searchParams.set('query', query);
    searchParams.set('page', '1');
    searchParams.set('size', '10');
    
    // Add location if provided
    if (location.trim()) {
      searchParams.set('province', location.trim());
    }
    
    navigate(`/jobs/search?${searchParams.toString()}`);
  };

  /**
   * Handle form submission
   */
  const handleFormSubmit = (e) => {
    e.preventDefault();
    const currentQuery = autocompleteRef.current?.getValue();
    if (currentQuery?.trim()) {
      handleHeroSearch(currentQuery.trim());
    }
  };
  return (
    // Professional Hero với nền gradient sáng như hình
    <section className="relative bg-gradient-to-r from-green-100 via-green-200 to-blue-200 dark:from-green-900/30 dark:via-green-800/30 dark:to-blue-900/30 h-[67vh] flex items-center justify-center -mt-16">
      {/* Background pattern overlay */}
      <div className="absolute inset-0 opacity-10 dark:opacity-5">
        <div
          className="absolute inset-0"
          style={{
            backgroundImage: `radial-gradient(circle at 2px 2px, currentColor 1px, transparent 0)`,
            backgroundSize: "30px 30px",
          }}
        ></div>
      </div>

      <div className="container relative z-10 pt-20 px-4">
        <div className="max-w-6xl mx-auto text-center">
          <div className="flex flex-col sm:flex-row gap-4 justify-center items-center">
  <Button
    size="lg"
    className="bg-card hover:bg-muted text-primary font-bold text-lg px-10 py-5 rounded-full shadow-2xl border-0 transform hover:scale-105 transition-all duration-300 min-w-[180px]"
    onClick={() => window.open('http://localhost:4000/', '_blank')}
  >
    <Briefcase className="mr-3 h-6 w-6" />
    Đăng tuyển
  </Button>

  <Button
    variant="outline"
    size="lg"
    className="bg-gradient-to-r from-green-300 via-green-400 to-blue-500 dark:from-green-600 dark:via-green-500 dark:to-blue-600 hover:opacity-90 text-white font-bold text-lg px-10 py-5 rounded-full border-2 border-white/40 dark:border-white/20 shadow-2xl transform hover:scale-105 transition-all duration-300 min-w-[180px] backdrop-blur-sm"
  >
    <User className="mr-3 h-6 w-6" />
    Ứng tuyển
  </Button>
</div>

         <h1 className="text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight mb-6">
              <span className="text-gradient-primary shimmer-text">Tìm kiếm công việc</span>
              <br />
              <span className="shimmer-text-dark">định hình tương lai của bạn</span>
            </h1>

          <div className="backdrop-blur-md rounded-3xl shadow-2xl p-6 max-w-5xl mx-auto border border-border bg-card/80">
            <form onSubmit={handleFormSubmit} className="grid grid-cols-1 lg:grid-cols-12 gap-4">
              {/* Job Title Input with Autocomplete - Dài hơn */}
              <div className="relative lg:col-span-6">
                <HomeSearchAutocomplete
                  ref={autocompleteRef}
                  placeholder="Vị trí công việc, kỹ năng, công ty..."
                  className="w-full"
                  onSearch={handleHeroSearch}
                  inputProps={{
                    className: "h-12 pl-12 text-base border-2 border-input focus:border-primary focus:ring-4 focus:ring-primary/20 bg-background rounded-xl font-medium placeholder:text-muted-foreground text-foreground"
                  }}
                />
              </div>

              {/* Location Input - Ngắn hơn */}
              <div className="relative lg:col-span-3">
                <MapPin className="absolute left-4 top-1/2 transform -translate-y-1/2 text-muted-foreground h-5 w-5" />
                <Input
                  type="text"
                  placeholder="Địa điểm"
                  value={location}
                  onChange={(e) => setLocation(e.target.value)}
                  className="h-12 pl-12 text-base border-2 border-input focus:border-primary focus:ring-4 focus:ring-primary/20 bg-background rounded-xl font-medium placeholder:text-muted-foreground text-foreground"
                />
              </div>

              {/* Search Button - Đổi màu tương tự nút "Xem tất cả công ty" */}
              <Button
                type="submit"
                size="lg"
                className={"bg-gradient-primary text-white hover:opacity-90 h-12 w-full lg:col-span-3 rounded-xl font-semibold text-lg"}
              >
                <Search className="mr-2 h-5 w-5" />
                Tìm kiếm
              </Button>
            </form>
          </div>
          <div className="mt-16"></div>
        </div>
      </div>
    </section>
  );
};

export default HeroSection;
</file>

<file path="src/components/sections/TopCompanies.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Users, Briefcase, Star, ArrowRight, Building2 } from 'lucide-react';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { SectionHeader } from '../common/SectionHeader';
import apiClient from '../../services/apiClient';

const TopCompanies = () => {
  const navigate = useNavigate();
  const [companies, setCompanies] = useState([]);
  const [loading, setLoading] = useState(true);

  // Format số nhân viên
  const formatEmployees = (employees) => {
    if (!employees) return 'Chưa cập nhật';
    if (employees >= 10000) return `${Math.floor(employees / 1000)}K+ nhân viên`;
    if (employees >= 1000) return `${Math.floor(employees / 1000)}K+ nhân viên`;
    return `${employees}+ nhân viên`;
  };

  // Handler khi click vào công ty
  const handleCompanyClick = (companyId) => {
    navigate(`/company/${companyId}`);
  };

  // Handler cho nút "Xem tất cả công ty"
  const handleViewAllCompanies = () => {
    navigate('/companies');
  };

  useEffect(() => {
    const fetchTopCompanies = async () => {
      try {
        setLoading(true);
        console.log('🔄 Fetching top companies (by jobs)...');
        const response = await apiClient.get('/analytics/top-companies?limit=6');
        console.log('📦 TOP COMPANIES API Response:', response.data);

        if (response.data.success) {
          console.log('✅ Top Companies data:', response.data.data);
          setCompanies(response.data.data);
        } else {
          console.warn('⚠️ API returned success: false');
        }
      } catch (error) {
        console.error('❌ Failed to fetch top companies:', error);
        console.error('Error details:', error.response?.data || error.message);
      } finally {
        setLoading(false);
      }
    };

    fetchTopCompanies();
  }, []);
  return (
    <section className="py-20 bg-background">
      <div className="container">
        <SectionHeader
          badgeText="🏢 Đối tác uy tín"
          title={<>Top công ty <span className="bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">hàng đầu</span></>}
          description="Những công ty tuyển dụng nhiều vị trí nhất. Nơi có nhiều cơ hội việc làm đa dạng và phong phú."
          className="mb-12"
        />

        {loading ? (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {[...Array(6)].map((_, i) => (
              <Card key={i} className="animate-pulse bg-muted h-80" />
            ))}
          </div>
        ) : companies.length === 0 ? (
          <div className="text-center py-12 text-muted-foreground">
            <Building2 className="h-16 w-16 mx-auto mb-4 opacity-50" />
            <p>Chưa có dữ liệu công ty</p>
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {companies.map((company, index) => (
              <Card 
                key={company._id} 
                className="group flex flex-col text-center relative border shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 rounded-2xl bg-card cursor-pointer"
                onClick={() => handleCompanyClick(company._id)}
              >
                <CardHeader>
                  <div className="mb-3 mx-auto">
                    <img
                      src={company.logo || 'https://i.pinimg.com/736x/ec/d9/c2/ecd9c2e8ed0dbbc96ac472a965e4afda.jpg'}
                      alt={company.companyName}
                      className="h-24 w-24 mx-auto object-contain rounded-lg border-2 border-gray-100"
                      onError={(e) => {
                        e.target.src = 'https://i.pinimg.com/736x/ec/d9/c2/ecd9c2e8ed0dbbc96ac472a965e4afda.jpg';
                      }}
                    />
                  </div>
                  <CardTitle className="text-xl font-bold text-foreground line-clamp-1">
                    {company.companyName}
                  </CardTitle>
                  <CardDescription className="text-muted-foreground">
                    {company.industry || 'Đa lĩnh vực'}
                  </CardDescription>

                  {index < 3 && (
                    <Badge className="absolute top-4 right-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white border-0 shadow-md">
                      Top {index + 1}
                    </Badge>
                  )}
                </CardHeader>
                <CardContent className="grow">
                  <div className="space-y-3 text-sm text-muted-foreground">
                    <div className="flex items-center justify-center gap-2">
                      <Users className="h-4 w-4 text-primary" /> 
                      <span className="font-medium">{formatEmployees(company.employees)}</span>
                    </div>
                    <div className="flex items-center justify-center gap-2">
                      <Briefcase className="h-4 w-4 text-emerald-600" /> 
                      <span className="font-medium text-emerald-600 font-semibold">
                        {company.activeJobCount} tin tuyển dụng
                      </span>
                    </div>
                    {company.location?.province && (
                      <div className="flex items-center justify-center gap-2 text-xs">
                        <span>📍 {company.location.province}</span>
                      </div>
                    )}
                  </div>
                </CardContent>
                <CardFooter>
                  <Button 
                    variant="outline" 
                    className="w-full border-2 border-emerald-200 text-emerald-600 hover:bg-emerald-600 hover:text-white hover:border-emerald-600 transition-all duration-300 rounded-xl font-semibold"
                    onClick={(e) => {
                      e.stopPropagation();
                      handleCompanyClick(company._id);
                    }}
                  >
                    Xem công ty <ArrowRight className="ml-2 h-4 w-4" />
                  </Button>
                </CardFooter>
              </Card>
            ))}
          </div>
        )}

        <div className="text-center mt-12">
          <Button 
            size="lg" 
            className="px-8 py-6 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300"
            onClick={handleViewAllCompanies}
          >
            Xem tất cả công ty
            <ArrowRight className="ml-2 h-5 w-5" />
          </Button>
        </div>
      </div>
    </section>
  );
};

export default TopCompanies;
</file>

<file path="src/pages/profile/Profile.jsx">
import { useState, useEffect, useRef, useCallback } from 'react';
import { useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import { Button } from '../../components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '../../components/ui/card';
import { Input } from '../../components/ui/input';
import { Badge } from '../../components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '../../components/ui/avatar';
import { Separator } from '../../components/ui/separator';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from '../../components/ui/dialog';
import { Label } from '../../components/ui/label';
import { Textarea } from '../../components/ui/textarea';
import {
  User,
  Mail,
  Phone,
  Calendar,
  MapPin,
  Building,
  GraduationCap,
  Briefcase,
  FileText,
  Plus,
  Edit3,
  Trash2,
  Download,
  Star,
  Upload
} from 'lucide-react';

import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '../../components/ui/select';
import { getMyProfile, uploadCV, downloadCV, deleteCV, updateProfile, uploadAvatar } from '../../services/profileService';
import ExperienceFormItem from '../../components/profile/ExperienceFormItem';
import EducationFormItem from '../../components/profile/EducationFormItem';

const Profile = () => {
  const navigate = useNavigate();
  const { isAuthenticated } = useSelector((state) => state.auth);
  const [profile, setProfile] = useState(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);

  const fileInputRef = useRef(null);
  const [isUploading, setIsUploading] = useState(false);
  const [deletingCvId, setDeletingCvId] = useState(null);

  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);
  const [editForm, setEditForm] = useState({
    fullname: '',
    phone: '',
    bio: '',
    avatarFile: null,
  });

  const [isEditBioOpen, setIsEditBioOpen] = useState(false);
  const [editBio, setEditBio] = useState('');

  const [isEditExperienceOpen, setIsEditExperienceOpen] = useState(false);
  const [editExperiences, setEditExperiences] = useState([]);

  const [isEditEducationOpen, setIsEditEducationOpen] = useState(false);
  const [editEducations, setEditEducations] = useState([]);

  const [isEditSkillsOpen, setIsEditSkillsOpen] = useState(false);
  const [editSkills, setEditSkills] = useState([]);

  const [isAddExperienceOpen, setIsAddExperienceOpen] = useState(false);
  const [newExperience, setNewExperience] = useState({
    company: '',
    position: '',
    startDate: '',
    endDate: '',
    description: '',
    responsibilities: []
  });

  const [isAddEducationOpen, setIsAddEducationOpen] = useState(false);
  const [newEducation, setNewEducation] = useState({
    school: '',
    major: '',
    degree: '',
    startDate: '',
    endDate: '',
    description: '',
    gpa: '',
    type: ''
  });

  useEffect(() => {
    if (!isAuthenticated) {
      navigate('/login');
      return;
    }
    fetchProfile();
  }, [isAuthenticated, navigate]);

  const fetchProfile = async () => {
    try {
      setIsLoading(true);
      setError(null);

      const response = await getMyProfile();

      if (response.success) {
        setProfile(response.data);
      } else {
        throw new Error(response.message || 'Không thể lấy thông tin hồ sơ');
      }
    } catch (err) {
      console.error('Lỗi khi lấy thông tin hồ sơ:', err);
      setError(err.response?.data?.message || err.message || 'Có lỗi xảy ra khi tải dữ liệu');
    } finally {
      setIsLoading(false);
    }
  };

  const formatDate = (dateString) => {
    return new Date(dateString).toLocaleDateString('vi-VN');
  };

  const calculateExperience = (experiences) => {
    if (!experiences || experiences.length === 0) return '0 năm';

    let totalMonths = 0;
    experiences.forEach(exp => {
      const start = new Date(exp.startDate);
      const end = exp.endDate ? new Date(exp.endDate) : new Date();
      const months = (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());
      totalMonths += months;
    });

    const years = Math.floor(totalMonths / 12);
    const months = totalMonths % 12;

    if (years === 0) return `${months} tháng`;
    if (months === 0) return `${years} năm`;
    return `${years} năm ${months} tháng`;
  };

  if (!isAuthenticated) {
    return null;
  }

  if (isLoading) {
    return (
      <div className="min-h-screen">
        <div className="container mx-auto py-8">
          <div className="max-w-6xl mx-auto">
            <div className="animate-pulse space-y-6">
              <div className="bg-white rounded-lg p-6">
                <div className="flex items-center space-x-4">
                  <div className="w-24 h-24 bg-skeleton rounded-full"></div>
                  <div className="space-y-2">
                    <div className="h-6 bg-skeleton rounded w-48"></div>
                    <div className="h-4 bg-skeleton rounded w-32"></div>
                    <div className="h-4 bg-skeleton rounded w-40"></div>
                  </div>
                </div>
              </div>
              {[1, 2, 3].map((i) => (
                <div key={i} className="bg-white rounded-lg p-6">
                  <div className="h-6 bg-skeleton rounded w-32 mb-4"></div>
                  <div className="space-y-2">
                    <div className="h-4 bg-skeleton rounded w-full"></div>
                    <div className="h-4 bg-skeleton rounded w-3/4"></div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen">
        <div className="container mx-auto py-8">
          <div className="max-w-4xl mx-auto">
            <Card className="text-center py-8 bg-white">
              <CardContent>
                <div className="text-destructive mb-4">
                  <svg className="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <h3 className="text-xl font-semibold text-foreground mb-2">Có lỗi xảy ra</h3>
                <p className="text-muted-foreground mb-4">{error}</p>
                <Button onClick={fetchProfile} size="lg">
                  Thử lại
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    );
  }

  const handleFileSelect = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    // Validate file type
    const allowedTypes = [
      'application/pdf',
      'application/msword',
      'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
    ];
    if (!allowedTypes.includes(file.type)) {
      alert('Chỉ chấp nhận file PDF, DOC, DOCX.');
      return;
    }

    // Validate file size (5MB)
    if (file.size > 5 * 1024 * 1024) {
      alert('Kích thước file không được vượt quá 5MB.');
      return;
    }

    setIsUploading(true);
    try {
      const formData = new FormData();
      formData.append('cv', file);
      // Optionally append name if backend expects it
      // formData.append('name', file.name);

      const response = await uploadCV(formData);
      e.target.value = ''; // Reset input
      setProfile(prev => ({ ...prev, cvs: response.data }));
    } catch (err) {
      console.error('Upload failed:', err);
      alert('Tải lên thất bại: ' + (err.response?.data?.message || err.message));
    } finally {
      setIsUploading(false);
    }
  };

  const handleDownloadCV = async (cvId, cvName) => {
    try {
      const blob = await downloadCV(cvId);
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = cvName || `cv-${cvId}`; // Use cv.name, assume it has extension
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    } catch (err) {
      console.error('Download failed:', err);
      alert('Tải xuống thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  const handleDeleteCV = async (cvId) => {
    if (!window.confirm('Bạn có chắc chắn muốn xóa CV này?')) return;

    try {
      setDeletingCvId(cvId);
      await deleteCV(cvId);
      await fetchProfile();
    } catch (err) {
      console.error('Delete failed:', err);
      alert('Xóa thất bại: ' + (err.response?.data?.message || err.message));
    } finally {
      setDeletingCvId(null);
    }
  };

  const handleOpenEditDialog = () => {
    setEditForm({
      fullname: profile.fullname || '',
      phone: profile.phone || '',
      bio: profile.bio || '',
      avatarFile: null,
    });
    setIsEditDialogOpen(true);
  };

  // Memoized handlers to prevent re-render
  const handleEditFormChange = useCallback((field, value) => {
    setEditForm(prev => ({ ...prev, [field]: value }));
  }, []);

  const handleExperienceChange = useCallback((index, field, value) => {
    setEditExperiences(prev => {
      const newExps = [...prev];
      newExps[index] = { ...newExps[index], [field]: value };
      return newExps;
    });
  }, []);

  const handleEducationChange = useCallback((index, field, value) => {
    setEditEducations(prev => {
      const newEdus = [...prev];
      newEdus[index] = { ...newEdus[index], [field]: value };
      return newEdus;
    });
  }, []);

  const handleNewExperienceChange = useCallback((field, value) => {
    setNewExperience(prev => ({ ...prev, [field]: value }));
  }, []);

  const handleNewEducationChange = useCallback((field, value) => {
    setNewEducation(prev => ({ ...prev, [field]: value }));
  }, []);

  const handleDeleteExperience = useCallback((index) => {
    setEditExperiences(prev => prev.filter((_, i) => i !== index));
  }, []);

  const handleDeleteEducation = useCallback((index) => {
    setEditEducations(prev => prev.filter((_, i) => i !== index));
  }, []);

  const handleSaveProfile = async () => {
    try {
      if (editForm.avatarFile) {
        const formData = new FormData();
        formData.append('avatar', editForm.avatarFile);
        await uploadAvatar(formData);
      }
      const updateData = {
        fullname: editForm.fullname,
        phone: editForm.phone ? editForm.phone.replace(/[\s\-\(\)]/g, '') : editForm.phone,
        bio: editForm.bio,
      };
      await updateProfile(updateData);
      setIsEditDialogOpen(false);
      await fetchProfile();
    } catch (err) {
      console.error('Update failed:', err);
      alert('Cập nhật thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  const handleOpenEditBio = () => {
    setEditBio(profile.bio || '');
    setIsEditBioOpen(true);
  };

  const handleSaveBio = async () => {
    try {
      const updateData = {
        bio: editBio,
      };
      await updateProfile(updateData);
      setIsEditBioOpen(false);
      await fetchProfile();
    } catch (err) {
      console.error('Update bio failed:', err);
      alert('Cập nhật giới thiệu thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  const handleOpenEditExperience = () => {
    setEditExperiences(JSON.parse(JSON.stringify(profile.experiences || [])));
    setIsEditExperienceOpen(true);
  };

  const handleSaveExperience = async () => {
    try {
      const updateData = {
        experiences: editExperiences,
      };
      await updateProfile(updateData);
      setIsEditExperienceOpen(false);
      await fetchProfile();
    } catch (err) {
      console.error('Update experience failed:', err);
      alert('Cập nhật kinh nghiệm thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  const handleOpenEditEducation = () => {
    setEditEducations(JSON.parse(JSON.stringify(profile.educations || [])));
    setIsEditEducationOpen(true);
  };

  const handleSaveEducation = async () => {
    try {
      const updateData = {
        educations: editEducations,
      };
      await updateProfile(updateData);
      setIsEditEducationOpen(false);
      await fetchProfile();
    } catch (err) {
      console.error('Update education failed:', err);
      alert('Cập nhật học vấn thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  const handleOpenEditSkills = () => {
    setEditSkills({
      skills: JSON.parse(JSON.stringify(profile.skills || [])),
      newSkill: ''
    });
    setIsEditSkillsOpen(true);
  };

  const handleSaveSkills = async () => {
    try {
      const updateData = {
        skills: editSkills.skills,
      };
      await updateProfile(updateData);
      setIsEditSkillsOpen(false);
      await fetchProfile();
    } catch (err) {
      console.error('Update skills failed:', err);
      alert('Cập nhật kỹ năng thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  const handleOpenAddExperience = () => {
    setNewExperience({
      company: '',
      position: '',
      startDate: '',
      endDate: '',
      description: '',
      responsibilities: []
    });
    setIsAddExperienceOpen(true);
  };

  const handleSaveAddExperience = async () => {
    try {
      const updatedExperiences = [...(profile.experiences || []), newExperience];
      const updateData = {
        experiences: updatedExperiences,
      };
      await updateProfile(updateData);
      setIsAddExperienceOpen(false);
      await fetchProfile();
    } catch (err) {
      console.error('Add experience failed:', err);
      alert('Thêm kinh nghiệm thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  const handleOpenAddEducation = () => {
    setNewEducation({
      school: '',
      major: '',
      degree: '',
      startDate: '',
      endDate: '',
      description: '',
      gpa: '',
      type: ''
    });
    setIsAddEducationOpen(true);
  };

  const handleSaveAddEducation = async () => {
    try {
      const updatedEducations = [...(profile.educations || []), newEducation];
      const updateData = {
        educations: updatedEducations,
      };
      await updateProfile(updateData);
      setIsAddEducationOpen(false);
      await fetchProfile();
    } catch (err) {
      console.error('Add education failed:', err);
      alert('Thêm học vấn thất bại: ' + (err.response?.data?.message || err.message));
    }
  };

  if (!profile) {
    return null;
  }

  return (
    <div className="min-h-screen">
      <div className="container mx-auto py-8">
        <div className="max-w-6xl mx-auto space-y-6">
          <input
            ref={fileInputRef}
            type="file"
            onChange={handleFileSelect}
            accept=".pdf,.doc,.docx"
            style={{ display: 'none' }}
          />

          {/* Profile Header */}
          <Card className="overflow-hidden bg-white">
            <div className="bg-gradient-primary p-6 text-primary-foreground">
              <div className="flex flex-col md:flex-row items-start md:items-center gap-6">
                <Avatar className="w-24 h-24 border-4 border-primary-foreground shadow-lg">
                  <AvatarImage src={profile.avatar} alt={profile.fullname} />
                  <AvatarFallback className="bg-primary-foreground text-primary text-2xl font-bold">
                    {profile.fullname?.charAt(0)}
                  </AvatarFallback>
                </Avatar>

                <div className="flex-1">
                  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                      <h1 className="text-2xl md:text-3xl font-bold mb-2">{profile.fullname}</h1>
                      <div className="flex items-center text-primary-foreground/80">
                        <Phone className="w-4 h-4 mr-2" />
                        <span>{profile.phone || 'Chưa cập nhật số điện thoại'}</span>
                      </div>
                    </div>

                    <div className="text-right">
                      <div className="text-primary-foreground/80 text-sm mb-1">Thành viên từ</div>
                      <div className="font-semibold">{formatDate(profile.createdAt)}</div>
                    </div>
                  </div>
                </div>

                <Button variant="secondary" className="bg-primary-foreground text-primary hover:bg-primary-foreground/90" onClick={handleOpenEditDialog}>
                  <Edit3 className="w-4 h-4 mr-2" />
                  Chỉnh sửa
                </Button>
              </div>
            </div>
          </Card>

          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">

            {/* Left Column */}
            <div className="lg:col-span-2 space-y-6">

              {/* About */}
              {profile.bio && (
                <Card className="bg-white">
                  <CardHeader>
                    <CardTitle className="flex items-center justify-between">
                      <div className="flex items-center">
                        <User className="w-5 h-5 mr-2 text-primary" />
                        Giới thiệu
                      </div>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={handleOpenEditBio}
                        className="text-muted-foreground hover:text-primary"
                      >
                        <Edit3 className="w-4 h-4" />
                      </Button>
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <p className="text-muted-foreground leading-relaxed">{profile.bio}</p>
                  </CardContent>
                </Card>
              )}

              {/* Experience */}
              {profile.experiences && profile.experiences.length > 0 && (
                <Card className="bg-white">
                  <CardHeader>
                    <CardTitle className="flex items-center justify-between">
                      <div className="flex items-center">
                        <Briefcase className="w-5 h-5 mr-2 text-primary" />
                        Kinh nghiệm làm việc
                      </div>
                      <div className="flex items-center gap-2">
                        <Badge variant="outline">{calculateExperience(profile.experiences)}</Badge>
                        <Button
                          size="sm"
                          variant="ghost"
                          onClick={handleOpenEditExperience}
                          className="text-muted-foreground hover:text-primary"
                        >
                          <Edit3 className="w-4 h-4" />
                        </Button>
                      </div>
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {profile.experiences.map((exp, index) => (
                      <div key={exp._id || index} className="border-l-2 border-primary/20 pl-4 pb-4 last:pb-0">
                        <h3 className="font-semibold text-lg text-foreground">{exp.position}</h3>
                        <div className="flex items-center text-primary font-medium mb-2">
                          <Building className="w-4 h-4 mr-1" />
                          {exp.company}
                        </div>
                        <div className="flex items-center text-muted-foreground text-sm mb-2">
                          <Calendar className="w-4 h-4 mr-1" />
                          {formatDate(exp.startDate)} - {exp.endDate ? formatDate(exp.endDate) : 'Hiện tại'}
                        </div>
                        {exp.description && (
                          <p className="text-muted-foreground mt-2">{exp.description}</p>
                        )}
                      </div>
                    ))}
                  </CardContent>
                </Card>
              )}

              {/* Education */}
              {profile.educations && profile.educations.length > 0 && (
                <Card className="bg-white">
                  <CardHeader>
                    <CardTitle className="flex items-center justify-between">
                      <div className="flex items-center">
                        <GraduationCap className="w-5 h-5 mr-2 text-primary" />
                        Học vấn
                      </div>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={handleOpenEditEducation}
                        className="text-muted-foreground hover:text-primary"
                      >
                        <Edit3 className="w-4 h-4" />
                      </Button>
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-4">
                    {profile.educations.map((edu, index) => (
                      <div key={edu._id || index} className="border-l-2 border-primary/20 pl-4 pb-4 last:pb-0">
                        <h3 className="font-semibold text-lg text-foreground">{edu.school}</h3>
                        <div className="text-primary font-medium mb-1">{edu.major}</div>
                        <div className="flex items-center gap-4 text-sm text-muted-foreground mb-2">
                          <span>{edu.degree}</span>
                          {edu.gpa && <span>GPA: {edu.gpa}</span>}
                        </div>
                        <div className="flex items-center text-muted-foreground text-sm mb-2">
                          <Calendar className="w-4 h-4 mr-1" />
                          {formatDate(edu.startDate)} - {formatDate(edu.endDate)}
                        </div>
                        {edu.description && (
                          <p className="text-muted-foreground mt-2">{edu.description}</p>
                        )}
                      </div>
                    ))}
                  </CardContent>
                </Card>
              )}
            </div>

            {/* Right Column */}
            <div className="space-y-6">

              {/* Skills */}
              {profile.skills && profile.skills.length > 0 && (
                <Card className="bg-white">
                  <CardHeader>
                    <CardTitle className="flex items-center justify-between">
                      <div className="flex items-center">
                        <Star className="w-5 h-5 mr-2 text-primary" />
                        Kỹ năng
                      </div>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={handleOpenEditSkills}
                        className="text-muted-foreground hover:text-primary"
                      >
                        <Edit3 className="w-4 h-4" />
                      </Button>
                    </CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="flex flex-wrap gap-2">
                      {profile.skills.map((skill, index) => (
                        <Badge key={skill._id || index} variant="secondary" className="bg-primary/10 text-primary">
                          {skill.name}
                        </Badge>
                      ))}
                    </div>
                  </CardContent>
                </Card>
              )}

              {/* CVs */}
              {profile.cvs && profile.cvs.length > 0 && (
                <Card className="bg-white">
                  <CardHeader>
                    <CardTitle className="flex items-center justify-between">
                      <div className="flex items-center">
                        <FileText className="w-5 h-5 mr-2 text-primary" />
                        CV của tôi
                      </div>
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => fileInputRef.current?.click()}
                        disabled={isUploading}
                      >
                        {isUploading ? (
                          'Đang tải lên...'
                        ) : (
                          <>
                            <Upload className="w-4 h-4 mr-2" />
                            Tải lên
                          </>
                        )}
                      </Button>
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="space-y-3">
                    {profile.cvs.map((cv) => (
                      <div key={cv._id} className="border rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div className="flex items-center justify-between">
                          <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2">
                              <h4 className="font-medium text-gray-900 truncate">{cv.name}</h4>
                              {cv.isDefault && (
                                <Badge className="bg-primary text-primary-foreground">Mặc định</Badge>
                              )}
                            </div>
                            <p className="text-sm text-gray-500 mt-1">
                              Tải lên: {formatDate(cv.uploadedAt)}
                            </p>
                          </div>
                          <div className="flex items-center gap-2">
                            <Button
                              size="sm"
                              variant="ghost"
                              onClick={() => handleDownloadCV(cv._id, cv.name)}
                            >
                              <Download className="w-4 h-4" />
                            </Button>
                            <Button
                              size="sm"
                              variant="ghost"
                              className="text-red-600 hover:text-red-700"
                              onClick={() => handleDeleteCV(cv._id)}
                              disabled={deletingCvId === cv._id}
                            >
                              {deletingCvId === cv._id ? 'Đang xóa...' : <Trash2 className="w-4 h-4" />}
                            </Button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </CardContent>
                </Card>
              )}

              {/* Quick Actions */}
              <Card className="bg-white">
                <CardHeader>
                  <CardTitle>Hành động nhanh</CardTitle>
                </CardHeader>
                <CardContent className="space-y-3">
                  <Button className="w-full justify-start" variant="outline" onClick={handleOpenEditDialog}>
                    <Edit3 className="w-4 h-4 mr-2" />
                    Chỉnh sửa hồ sơ
                  </Button>
                  <Button
                    className="w-full justify-start"
                    variant="outline"
                    onClick={() => fileInputRef.current?.click()}
                    disabled={isUploading}
                  >
                    <Upload className="w-4 h-4 mr-2" />
                    Tải lên CV mới
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleOpenAddExperience}>
                    <Plus className="w-4 h-4 mr-2" />
                    Thêm kinh nghiệm
                  </Button>
                  <Button className="w-full justify-start" variant="outline" onClick={handleOpenAddEducation}>
                    <GraduationCap className="w-4 h-4 mr-2" />
                    Thêm học vấn
                  </Button>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Edit Profile Dialog */}
          <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>
            <DialogContent className="max-w-md max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Chỉnh sửa hồ sơ</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 py-4">
                <div className="space-y-2">
                  <Label htmlFor="fullname">Họ và tên</Label>
                  <Input
                    id="fullname"
                    value={editForm.fullname}
                    onChange={(e) => handleEditFormChange('fullname', e.target.value)}
                    placeholder="Nhập họ và tên"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="phone">Số điện thoại</Label>
                  <Input
                    id="phone"
                    type="tel"
                    value={editForm.phone}
                    onChange={(e) => handleEditFormChange('phone', e.target.value)}
                    placeholder="Nhập số điện thoại"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="bio">Giới thiệu</Label>
                  <Textarea
                    id="bio"
                    value={editForm.bio}
                    onChange={(e) => handleEditFormChange('bio', e.target.value)}
                    placeholder="Viết về bản thân..."
                    rows={4}
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="avatar">Ảnh đại diện</Label>
                  <Input
                    id="avatar"
                    type="file"
                    accept="image/*"
                    onChange={(e) => handleEditFormChange('avatarFile', e.target.files?.[0] || null)}
                  />
                  {editForm.avatarFile && (
                    <div className="text-sm text-muted-foreground mt-1">
                      Đã chọn: {editForm.avatarFile.name}
                    </div>
                  )}
                </div>
              </div>
              <DialogFooter>
                <Button type="button" variant="outline" onClick={() => setIsEditDialogOpen(false)}>
                  Hủy
                </Button>
                <Button type="button" onClick={handleSaveProfile} disabled={!editForm.fullname.trim()}>
                  Lưu thay đổi
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Edit Bio Dialog */}
          <Dialog open={isEditBioOpen} onOpenChange={setIsEditBioOpen}>
            <DialogContent className="max-w-md max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Chỉnh sửa giới thiệu</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 py-4">
                <div className="space-y-2">
                  <Label htmlFor="editBio">Giới thiệu</Label>
                  <Textarea
                    id="editBio"
                    value={editBio}
                    onChange={(e) => setEditBio(e.target.value)}
                    placeholder="Viết về bản thân..."
                    rows={6}
                  />
                </div>
              </div>
              <DialogFooter>
                <Button type="button" variant="outline" onClick={() => setIsEditBioOpen(false)}>
                  Hủy
                </Button>
                <Button type="button" onClick={handleSaveBio}>
                  Lưu thay đổi
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Edit Skills Dialog */}
          <Dialog open={isEditSkillsOpen} onOpenChange={setIsEditSkillsOpen}>
            <DialogContent className="max-w-md max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Chỉnh sửa kỹ năng</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 py-4">
                <div className="space-y-2">
                  <Label htmlFor="newSkill">Thêm kỹ năng mới</Label>
                  <div className="flex gap-2">
                    <Input
                      id="newSkill"
                      placeholder="Nhập tên kỹ năng"
                      value={editSkills.newSkill || ''}
                      onChange={(e) => setEditSkills({ ...editSkills, newSkill: e.target.value })}
                      onKeyDown={(e) => {
                        if (e.key === 'Enter' && editSkills.newSkill?.trim()) {
                          setEditSkills(prev => ({
                            ...prev,
                            skills: [...(prev.skills || []), { name: prev.newSkill.trim() }],
                            newSkill: ''
                          }));
                        }
                      }}
                    />
                    <Button
                      type="button"
                      size="sm"
                      onClick={() => {
                        if (editSkills.newSkill?.trim()) {
                          setEditSkills(prev => ({
                            ...prev,
                            skills: [...(prev.skills || []), { name: prev.newSkill.trim() }],
                            newSkill: ''
                          }));
                        }
                      }}
                      disabled={!editSkills.newSkill?.trim()}
                    >
                      Thêm
                    </Button>
                  </div>
                </div>
                <div className="space-y-2">
                  <Label>Kỹ năng hiện tại</Label>
                  <div className="space-y-2 max-h-48 overflow-y-auto">
                    {editSkills.skills?.map((skill, index) => (
                      <div key={skill._id || index} className="flex items-center justify-between p-2 bg-muted rounded">
                        <span className="text-sm">{skill.name}</span>
                        <Button
                          type="button"
                          variant="ghost"
                          size="sm"
                          className="text-destructive"
                          onClick={() => {
                            setEditSkills(prev => ({
                              ...prev,
                              skills: prev.skills.filter((_, i) => i !== index)
                            }));
                          }}
                        >
                          <Trash2 className="w-4 h-4" />
                        </Button>
                      </div>
                    )) || <p className="text-sm text-muted-foreground">Chưa có kỹ năng nào</p>}
                  </div>
                </div>
              </div>
              <DialogFooter>
                <Button type="button" variant="outline" onClick={() => setIsEditSkillsOpen(false)}>
                  Hủy
                </Button>
                <Button type="button" onClick={handleSaveSkills}>
                  Lưu thay đổi
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Edit Experience Dialog */}
          <Dialog open={isEditExperienceOpen} onOpenChange={setIsEditExperienceOpen}>
            <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Chỉnh sửa kinh nghiệm làm việc</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 py-4">
                <div className="space-y-4 max-h-96 overflow-y-auto">
                  {editExperiences.map((exp, index) => (
                    <ExperienceFormItem
                      key={`exp-${index}`}
                      exp={exp}
                      index={index}
                      onChange={handleExperienceChange}
                      onDelete={handleDeleteExperience}
                    />
                  ))}
                </div>
                <Button
                  type="button"
                  variant="outline"
                  onClick={() => {
                    setEditExperiences(prev => [...prev, {
                      company: '',
                      position: '',
                      startDate: '',
                      endDate: '',
                      description: '',
                      responsibilities: []
                    }]);
                  }}
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Thêm kinh nghiệm
                </Button>
              </div>
              <DialogFooter>
                <Button type="button" variant="outline" onClick={() => setIsEditExperienceOpen(false)}>
                  Hủy
                </Button>
                <Button type="button" onClick={handleSaveExperience}>
                  Lưu thay đổi
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Edit Education Dialog */}
          <Dialog open={isEditEducationOpen} onOpenChange={setIsEditEducationOpen}>
            <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Chỉnh sửa học vấn</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 py-4">
                <div className="space-y-4 max-h-96 overflow-y-auto">
                  {editEducations.map((edu, index) => (
                    <EducationFormItem
                      key={`edu-${index}`}
                      edu={edu}
                      index={index}
                      onChange={handleEducationChange}
                      onDelete={handleDeleteEducation}
                    />
                  ))}
                </div>
                <Button
                  type="button"
                  variant="outline"
                  onClick={() => {
                    setEditEducations(prev => [...prev, {
                      school: '',
                      major: '',
                      degree: '',
                      startDate: '',
                      endDate: '',
                      description: '',
                      gpa: '',
                      type: ''
                    }]);
                  }}
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Thêm học vấn
                </Button>
              </div>
              <DialogFooter>
                <Button type="button" variant="outline" onClick={() => setIsEditEducationOpen(false)}>
                  Hủy
                </Button>
                <Button type="button" onClick={handleSaveEducation}>
                  Lưu thay đổi
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Add Experience Dialog */}
          <Dialog open={isAddExperienceOpen} onOpenChange={setIsAddExperienceOpen}>
            <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Thêm kinh nghiệm làm việc</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 py-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div className="space-y-2">
                    <Label>Công ty</Label>
                    <Input
                      value={newExperience.company}
                      onChange={(e) => handleNewExperienceChange('company', e.target.value)}
                      placeholder="Tên công ty"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Vị trí</Label>
                    <Input
                      value={newExperience.position}
                      onChange={(e) => handleNewExperienceChange('position', e.target.value)}
                      placeholder="Vị trí công việc"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Ngày bắt đầu</Label>
                    <Input
                      type="date"
                      value={newExperience.startDate}
                      onChange={(e) => handleNewExperienceChange('startDate', e.target.value)}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Ngày kết thúc</Label>
                    <Input
                      type="date"
                      value={newExperience.endDate}
                      onChange={(e) => handleNewExperienceChange('endDate', e.target.value)}
                    />
                  </div>
                </div>
                <div className="space-y-2">
                  <Label>Mô tả công việc</Label>
                  <Textarea
                    value={newExperience.description}
                    onChange={(e) => handleNewExperienceChange('description', e.target.value)}
                    placeholder="Mô tả về công việc..."
                    rows={3}
                  />
                </div>
                <div className="space-y-2">
                  <Label>Trách nhiệm (mỗi dòng một trách nhiệm)</Label>
                  <Textarea
                    value={newExperience.responsibilities.join('\n')}
                    onChange={(e) => handleNewExperienceChange('responsibilities', e.target.value.split('\n').filter(r => r.trim()))}
                    placeholder="Liệt kê các trách nhiệm..."
                    rows={3}
                  />
                </div>
              </div>
              <DialogFooter>
                <Button type="button" variant="outline" onClick={() => setIsAddExperienceOpen(false)}>
                  Hủy
                </Button>
                <Button type="button" onClick={handleSaveAddExperience} disabled={!newExperience.company.trim() || !newExperience.position.trim()}>
                  Thêm kinh nghiệm
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>

          {/* Add Education Dialog */}
          <Dialog open={isAddEducationOpen} onOpenChange={setIsAddEducationOpen}>
            <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
              <DialogHeader>
                <DialogTitle>Thêm học vấn</DialogTitle>
              </DialogHeader>
              <div className="space-y-4 py-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                  <div className="space-y-2">
                    <Label>Trường học</Label>
                    <Input
                      value={newEducation.school}
                      onChange={(e) => handleNewEducationChange('school', e.target.value)}
                      placeholder="Tên trường học"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Chuyên ngành</Label>
                    <Input
                      value={newEducation.major}
                      onChange={(e) => handleNewEducationChange('major', e.target.value)}
                      placeholder="Chuyên ngành học"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Bằng cấp</Label>
                    <Input
                      value={newEducation.degree}
                      onChange={(e) => handleNewEducationChange('degree', e.target.value)}
                      placeholder="Ví dụ: Cử nhân, Thạc sĩ"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Loại hình</Label>
                    <Input
                      value={newEducation.type}
                      onChange={(e) => handleNewEducationChange('type', e.target.value)}
                      placeholder="Ví dụ: Đại học, Cao đẳng"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Ngày bắt đầu</Label>
                    <Input
                      type="date"
                      value={newEducation.startDate}
                      onChange={(e) => handleNewEducationChange('startDate', e.target.value)}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Ngày kết thúc</Label>
                    <Input
                      type="date"
                      value={newEducation.endDate}
                      onChange={(e) => handleNewEducationChange('endDate', e.target.value)}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label>Điểm GPA</Label>
                    <Input
                      value={newEducation.gpa}
                      onChange={(e) => handleNewEducationChange('gpa', e.target.value)}
                      placeholder="Ví dụ: 3.5"
                    />
                  </div>
                </div>
                <div className="space-y-2">
                  <Label>Mô tả</Label>
                  <Textarea
                    value={newEducation.description}
                    onChange={(e) => handleNewEducationChange('description', e.target.value)}
                    placeholder="Mô tả về quá trình học tập..."
                    rows={3}
                  />
                </div>
              </div>
              <DialogFooter>
                <Button type="button" variant="outline" onClick={() => setIsAddEducationOpen(false)}>
                  Hủy
                </Button>
                <Button type="button" onClick={handleSaveAddEducation} disabled={!newEducation.school.trim() || !newEducation.major.trim()}>
                  Thêm học vấn
                </Button>
              </DialogFooter>
            </DialogContent>
          </Dialog>
        </div>
      </div>
    </div>
  );
};

export default Profile;
</file>

<file path="src/pages/auth/Login.jsx">
import { useState, useCallback } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useDispatch } from 'react-redux';
import { toast } from 'sonner';
import { loginSuccess, fetchUser } from '@/redux/authSlice';
import * as authService from '@/services/authService';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardHeader } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import { GoogleLogin, GoogleOAuthProvider } from '@react-oauth/google';
import { Eye, EyeOff, Mail, Lock } from 'lucide-react';

const Login = () => {
  // COMMENT: Giữ nguyên toàn bộ logic state và xử lý form.
  const [email, setEmail] = useState('c1@gmail.com');
  const [password, setPassword] = useState('a');
  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const dispatch = useDispatch();
  const navigate = useNavigate();

  const handleSubmit = useCallback(async (e) => {
    e.preventDefault();
    if (!email || !password) {
      toast.error('Vui lòng nhập đầy đủ email và mật khẩu.');
      return;
    }
    setIsLoading(true);
    try {
      const loginData = await authService.login({ email, password });
      if (loginData && loginData.data.accessToken) {
        dispatch(loginSuccess({ accessToken: loginData.data.accessToken }));
        await dispatch(fetchUser());
      } else {
        throw new Error('Phản hồi đăng nhập không hợp lệ.');
      }
    } catch (err) {
      console.log(err);
      const errorMessage = err.response?.data?.message || 'Email hoặc mật khẩu không đúng.';
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  }, [email, password, dispatch, navigate]);

  // Xử lý đăng nhập Google
  const handleGoogleLoginSuccess = useCallback(async (credentialResponse) => {
    setIsLoading(true);
    try {
      console.log("🔑 Google credential received:", credentialResponse.credential);

      // Gửi token về backend với role candidate
      const loginData = await authService.googleLogin(credentialResponse.credential);
      console.log("✅ Google login response:", loginData);

      if (loginData && loginData.data && loginData.data.accessToken) {
        // Lưu token vào Redux store giống như đăng nhập thường
        dispatch(loginSuccess({ accessToken: loginData.data.accessToken }));

        // Lấy thông tin user và lưu vào Redux
        await dispatch(fetchUser());

        console.log("✅ Google login completed, user data saved to Redux");

      } else {
        throw new Error('Phản hồi đăng nhập không hợp lệ từ máy chủ.');
      }
    } catch (error) {
      console.error("❌ Error during Google login:", error);
      const errorMessage = error.response?.data?.message || 'Đăng nhập Google thất bại. Vui lòng thử lại.';
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  }, [dispatch, navigate]);

  const handleGoogleLoginError = useCallback((error) => {
    console.error("Google login failure:", error);
    toast.error('Đăng nhập Google thất bại. Vui lòng thử lại.');
  }, []);

  return (
    <GoogleOAuthProvider clientId={import.meta.env.VITE_GOOGLE_CLIENT_ID}>
      <div className="min-h-screen relative overflow-hidden flex items-center justify-center p-4">
        {/* Multi-layer background */}
        <div className="absolute inset-0 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50"></div>
        
        {/* Gradient orbs */}
        <div className="absolute inset-0 overflow-hidden">
          <div className="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-blue-400/30 via-purple-400/20 to-pink-400/30 rounded-full blur-3xl"></div>
          <div className="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-tr from-green-400/25 via-teal-400/20 to-blue-400/25 rounded-full blur-3xl"></div>
          <div className="absolute top-20 right-20 w-72 h-72 bg-gradient-to-bl from-purple-400/20 via-pink-400/15 to-red-400/20 rounded-full blur-2xl"></div>
          <div className="absolute bottom-20 left-20 w-72 h-72 bg-gradient-to-tr from-yellow-400/20 via-orange-400/15 to-red-400/20 rounded-full blur-2xl"></div>
          <div className="absolute top-1/3 left-1/4 w-48 h-48 bg-gradient-to-r from-cyan-400/25 to-blue-400/25 rounded-full blur-xl"></div>
          <div className="absolute bottom-1/3 right-1/4 w-48 h-48 bg-gradient-to-l from-violet-400/25 to-purple-400/25 rounded-full blur-xl"></div>
        </div>
        
        {/* Overlay gradient for depth */}
        <div className="absolute inset-0 bg-gradient-to-t from-white/20 via-transparent to-white/10"></div>
        
        <div className="w-full max-w-md relative z-10">
          <Card className="border-0 shadow-2xl bg-card/95 backdrop-blur-xl">
            <CardHeader className="text-center pb-8 pt-10">
              <div className="mb-10">
                <Link to="/" className="inline-flex items-center gap-3 text-3xl font-bold text-foreground hover:opacity-80">
                  <div className="w-12 h-12 bg-gradient-primary rounded-2xl flex items-center justify-center shadow-lg">
                    <span className="text-white text-2xl">💼</span>
                  </div>                
  Career<span className="text-gradient-primary">Zone</span>
                </Link>
              </div>
              
              <div className="space-y-4">
                <h1 className="text-4xl font-bold text-foreground">
                  Chào mừng trở lại! 👋
                </h1>
                <p className="text-muted-foreground text-lg leading-relaxed">
                  Đăng nhập để tiếp tục hành trình sự nghiệp của bạn
                </p>
              </div>
            </CardHeader>

            <CardContent className="space-y-6">
              <form onSubmit={handleSubmit} className="space-y-4">
                <div className="space-y-2">
                  <label htmlFor="email" className="text-sm font-medium text-foreground">Email</label>
                  <div className="relative">
                    <Mail className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                    <Input 
                      id="email" 
                      type="email" 
                      placeholder="email@example.com" 
                      value={email} 
                      onChange={(e) => setEmail(e.target.value)} 
                      required 
                      disabled={isLoading} 
                      className="pl-10 h-10" 
                    />
                  </div>
                </div>

                <div className="space-y-2">
                  <div className="flex items-center justify-between">
                    <label htmlFor="password" className="text-sm font-medium text-foreground">Mật khẩu</label>
                    <Link to="/forgot-password" className="text-sm text-primary hover:text-primary/80">
                      Quên mật khẩu?
                    </Link>
                  </div>
                  <div className="relative">
                    <Lock className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground" />
                    <Input 
                      id="password" 
                      type={showPassword ? "text" : "password"} 
                      placeholder="••••••••••" 
                      value={password} 
                      onChange={(e) => setPassword(e.target.value)} 
                      required 
                      disabled={isLoading} 
                      className="pl-10 pr-10 h-10" 
                    />
                    <Button 
                      type="button" 
                      variant="ghost" 
                      size="sm" 
                      className="absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent" 
                      onClick={() => setShowPassword(!showPassword)} 
                      disabled={isLoading}
                    >
                      {showPassword ? 
                        <EyeOff className="h-4 w-4 text-muted-foreground" /> : 
                        <Eye className="h-4 w-4 text-muted-foreground" />
                      }
                    </Button>
                  </div>
                </div>

                <Button 
                  type="submit" 
                  disabled={isLoading} 
                  className="w-full h-10 bg-gradient-primary hover:bg-primary/90"
                >
                  {isLoading ? (
                    <div className="flex items-center">
                      <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-primary-foreground mr-2"></div> 
                      Đang xử lý...
                    </div>
                  ) : (
                    "Đăng nhập"
                  )}
                </Button>
              </form>

              <div className="relative">
                <div className="absolute inset-0 flex items-center">
                  <Separator className="w-full" />
                </div>
                <div className="relative flex justify-center text-xs uppercase">
                  <span className="bg-card px-2 text-muted-foreground">hoặc</span>
                </div>
              </div>

              <GoogleLogin
                onSuccess={handleGoogleLoginSuccess}
                onError={handleGoogleLoginError}
                disabled={isLoading}
                width="100%"
                theme="outline"
                size="large"
                text="signin_with"
                shape="rectangular"
              />

              <div className="text-center text-sm">
                <span className="text-muted-foreground">Chưa có tài khoản? </span>
                <Link to="/register" className="text-primary hover:text-primary/80 font-medium">
                  Đăng ký ngay
                </Link>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>
    </GoogleOAuthProvider>
  );
};

export default Login;
</file>

<file path="src/App.jsx">
import AppRouter from './routes/AppRouter';
// import { Toaster } from 'sonner';
import { Toaster } from '@/components/ui/sonner';
import AnimatedBackground from '@/components/background/AnimatedBackground';
import { BackgroundProvider } from '@/contexts/BackgroundContext';
import { ThemeProvider } from '@/contexts/ThemeContext';
import useFirebaseMessaging from './hooks/useFirebaseMessaging';
import { Route } from 'lucide-react';
import CVRenderOnlyPage from './pages/cv/CVRenderOnlyPage';
import ScrollToTop from '@/components/common/ScrollToTop';
import TikTokPreloader from '@/components/common/TikTokPreloader';

function App() {
  useFirebaseMessaging();
  // The logic for fetching the user on initial load has been moved to AppRouter.jsx
  // to better handle the initialization state and prevent race conditions with routing.
  // This keeps the App component clean and focused on rendering the router.
  return (
    <>
      {/* <TikTokPreloader minLoadTime={1500} /> */}
      <ThemeProvider>
        <BackgroundProvider>
          <AnimatedBackground />
          <AppRouter />
          <Toaster position="top-center" richColors />
          <ScrollToTop />
        </BackgroundProvider>
      </ThemeProvider>

      <Route path="/render/:cvId" element={<CVRenderOnlyPage />} />
    </>
  );
}

export default App;
</file>

<file path="src/services/jobService.js">
import apiClient from './apiClient';

// Lấy tất cả việc làm với filter và pagination
export const getAllJobs = async (params = {}) => {
  const queryParams = new URLSearchParams();  
  if (params.search) queryParams.append('search', params.search);
  if (params.category) queryParams.append('category', params.category);
  if (params.location) queryParams.append('location', params.location);
  if (params.experience) queryParams.append('experience', params.experience);
  if (params.salary) queryParams.append('salary', params.salary);
  if (params.jobType) queryParams.append('jobType', params.jobType);
  if (params.workType) queryParams.append('workType', params.workType);
  if (params.featured) queryParams.append('featured', params.featured);
  if (params.sortBy) queryParams.append('sortBy', params.sortBy);
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);
  
  const url = `/jobs${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  const response = await apiClient.get(url);
  return response;
};

// Lấy chi tiết một việc làm
export const getJobById = async (jobId) => {
  // The Authorization header is included by the apiClient interceptor
  const response = await apiClient.get(`/jobs/${jobId}`);
  return response;
};

// Lấy việc làm gợi ý cho người dùng
export const getJobSuggestions = async (params = {}) => {
  const response = await apiClient.get('/jobs/suggestions', { params });
  return response;
};

// Lưu việc làm
export const saveJob = async (jobId) => {
  const response = await apiClient.post(`/jobs/${jobId}/save`);
  return response;
};

// Bỏ lưu việc làm
export const unsaveJob = async (jobId) => {
  const response = await apiClient.delete(`/jobs/${jobId}/save`);
  return response;
};

// Ứng tuyển việc làm
export const applyJob = async (jobId, applicationData) => {
  const response = await apiClient.post(`/jobs/${jobId}/apply`, applicationData);
  return response;
};

// Lấy số lượng ứng viên đã apply vào công việc
export const getJobApplicantCount = async (jobId) => {
  const response = await apiClient.post(`/jobs/${jobId}/applicant-count`);
  return response;
};

// Lấy danh sách ID các job đã ứng tuyển
export const getAppliedJobIds = async () => {
  const response = await apiClient.get('/candidate/applied-jobs-ids');
  return response.data;
};

// Lấy danh sách đơn ứng tuyển chi tiết
export const getMyApplications = async (params = {}) => {
  const queryParams = new URLSearchParams();
  
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);
  if (params.status) queryParams.append('status', params.status);
  
  const url = `/candidate/my-applications${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  
  const response = await apiClient.get(url);
  return response.data;
};

// Lấy chi tiết một đơn ứng tuyển
export const getApplicationById = async (applicationId) => {
  const response = await apiClient.get(`/candidate/my-applications/${applicationId}`);
  return response.data.data;
};

// Lấy danh sách công việc đã lưu
export const getSavedJobs = async (params = {}) => {
  const queryParams = new URLSearchParams();
  
  if (params.page) queryParams.append('page', params.page);
  if (params.limit) queryParams.append('limit', params.limit);
  if (params.sortBy) queryParams.append('sortBy', params.sortBy);
  if (params.keyword) queryParams.append('keyword', params.keyword);
  
  const url = `/jobs/saved/list${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
  const response = await apiClient.get(url);
  return response.data;
};

// Lấy gợi ý tự động cho tiêu đề công việc
export const getJobTitleSuggestions = async (query, limit = 10) => {
  try {
    const queryParams = new URLSearchParams();
    if (query) queryParams.append('query', query.trim());
    if (limit) queryParams.append('limit', Math.min(limit, 20)); // Giới hạn tối đa 20
    
    const url = `/jobs/autocomplete/titles${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
    const response = await apiClient.get(url);
    return response.data;
  } catch (error) {
    console.error('Error fetching job title suggestions:', error);
    // Trả về empty array để component có thể hoạt động bình thường
    return {
      success: false,
      data: [],
      message: error.response?.data?.message || 'Không thể tải gợi ý'
    };
  }
};

// Tìm kiếm hybrid với MongoDB Atlas Search
export const searchJobsHybrid = async (params = {}) => {
  try {
    const queryParams = new URLSearchParams();
    
    // Required parameters
    if (params.query !== undefined && params.query !== null) {
      queryParams.append('query', params.query); // Include even if empty string
    }
    if (params.page) queryParams.append('page', params.page);
    if (params.size) queryParams.append('size', params.size);
    
    // Optional filter parameters
    if (params.category) queryParams.append('category', params.category);
    if (params.type) queryParams.append('type', params.type);
    if (params.workType) queryParams.append('workType', params.workType);
    if (params.experience) queryParams.append('experience', params.experience);
    if (params.province) queryParams.append('province', params.province);
    if (params.district) queryParams.append('district', params.district);
    if (params.minSalary) queryParams.append('minSalary', params.minSalary);
    if (params.maxSalary) queryParams.append('maxSalary', params.maxSalary);
    
    // Location distance filter parameters
    if (params.latitude !== undefined && params.latitude !== null) queryParams.append('latitude', params.latitude);
    if (params.longitude !== undefined && params.longitude !== null) queryParams.append('longitude', params.longitude);
    if (params.distance) queryParams.append('distance', params.distance);
    
    const url = `/jobs/search/hybrid${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
    console.log('Final URL:', url);
    console.log('Query params string:', queryParams.toString());
    const response = await apiClient.get(url);
    return response.data;
  } catch (error) {
    console.error('Error performing hybrid search:', error);
    throw error;
  }
};

// Lấy danh sách các lĩnh vực công việc
export const getJobCategories = async () => {
  try {
    const response = await apiClient.get('/jobs/categories');
    return response.data;
  } catch (error) {
    console.error('Error fetching job categories:', error);
    // Return static data as fallback
    return {
      success: true,
      data: [
        { value: 'TECHNOLOGY', label: 'Công nghệ thông tin', count: 0 },
        { value: 'MARKETING', label: 'Marketing & PR', count: 0 },
        { value: 'FINANCE', label: 'Tài chính & Kế toán', count: 0 },
        { value: 'SALES', label: 'Kinh doanh & Bán hàng', count: 0 },
        { value: 'DESIGN', label: 'Thiết kế', count: 0 },
        { value: 'HUMAN_RESOURCES', label: 'Nhân sự', count: 0 },
        { value: 'EDUCATION', label: 'Giáo dục & Đào tạo', count: 0 },
        { value: 'HEALTHCARE', label: 'Y tế & Sức khỏe', count: 0 },
        { value: 'OTHER', label: 'Khác', count: 0 }
      ]
    };
  }
};

// Lấy danh sách loại hình công việc
export const getJobTypes = async () => {
  try {
    const response = await apiClient.get('/jobs/types');
    return response.data;
  } catch (error) {
    console.error('Error fetching job types:', error);
    // Return static data as fallback
    return {
      success: true,
      data: [
        { value: 'FULL_TIME', label: 'Toàn thời gian', count: 0 },
        { value: 'PART_TIME', label: 'Bán thời gian', count: 0 },
        { value: 'CONTRACT', label: 'Hợp đồng', count: 0 },
        { value: 'TEMPORARY', label: 'Tạm thời', count: 0 },
        { value: 'INTERNSHIP', label: 'Thực tập', count: 0 },
        { value: 'FREELANCE', label: 'Tự do', count: 0 }
      ]
    };
  }
};

// Lấy danh sách hình thức làm việc
export const getWorkTypes = async () => {
  try {
    const response = await apiClient.get('/jobs/work-types');
    return response.data;
  } catch (error) {
    console.error('Error fetching work types:', error);
    // Return static data as fallback
    return {
      success: true,
      data: [
        { value: 'ON_SITE', label: 'Tại văn phòng', count: 0 },
        { value: 'REMOTE', label: 'Làm việc từ xa', count: 0 },
        { value: 'HYBRID', label: 'Kết hợp', count: 0 }
      ]
    };
  }
};

// Lấy danh sách mức kinh nghiệm
export const getExperienceLevels = async () => {
  try {
    const response = await apiClient.get('/jobs/experience-levels');
    return response.data;
  } catch (error) {
    console.error('Error fetching experience levels:', error);
    // Return static data as fallback
    return {
      success: true,
      data: [
        { value: 'FRESH', label: 'Sinh viên mới tốt nghiệp', count: 0 },
        { value: 'JUNIOR', label: 'Dưới 1 năm', count: 0 },
        { value: 'MID_LEVEL', label: '1-3 năm', count: 0 },
        { value: 'SENIOR', label: '3-5 năm', count: 0 },
        { value: 'EXPERT', label: 'Trên 5 năm', count: 0 },
        { value: 'MANAGER', label: 'Quản lý', count: 0 },
        { value: 'DIRECTOR', label: 'Giám đốc', count: 0 }
      ]
    };
  }
};

// Lấy thống kê tìm kiếm
export const getSearchStats = async (query) => {
  try {
    const queryParams = new URLSearchParams();
    if (query) queryParams.append('query', query);
    
    const url = `/search/stats${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
    const response = await apiClient.get(url);
    return response.data;
  } catch (error) {
    console.error('Error fetching search stats:', error);
    return {
      success: false,
      data: {
        totalJobs: 0,
        totalCompanies: 0,
        averageSalary: 0,
        topCategories: []
      }
    };
  }
};

// Helper function để format search parameters cho URL
export const formatSearchParams = (params) => {
  const searchParams = new URLSearchParams();
  
  Object.entries(params).forEach(([key, value]) => {
    if (value !== null && value !== undefined && value !== '') {
      searchParams.append(key, value.toString());
    }
  });
  
  return searchParams.toString();
};

// Helper function để parse search parameters từ URL
export const parseSearchParams = (searchString) => {
  const params = new URLSearchParams(searchString);
  const result = {};
  
  for (const [key, value] of params) {
    // Convert numeric parameters
    if (['page', 'size', 'minSalary', 'maxSalary'].includes(key)) {
      result[key] = parseInt(value) || undefined;
    } else {
      result[key] = value || undefined;
    }
  }
  
  return result;
};

// Tìm kiếm công việc theo bounding box trên bản đồ (dùng khi zoom >= 12)
export const searchJobsOnMap = async (bounds) => {
  try {
    const queryParams = new URLSearchParams();
    queryParams.append('sw_lat', bounds.sw_lat);
    queryParams.append('sw_lng', bounds.sw_lng);
    queryParams.append('ne_lat', bounds.ne_lat);
    queryParams.append('ne_lng', bounds.ne_lng);
    
    // Luôn tuân thủ giới hạn của backend (max 50)
    if (bounds.limit && bounds.limit <= 50) {
      queryParams.append('limit', bounds.limit);
    } else {
      queryParams.append('limit', '50'); // Default safe limit
    }
    
    // Thêm các filters bổ sung
    if (bounds.category) queryParams.append('category', bounds.category);
    if (bounds.experience) queryParams.append('experience', bounds.experience);
    if (bounds.jobType) queryParams.append('jobType', bounds.jobType);
    if (bounds.workType) queryParams.append('workType', bounds.workType);
    if (bounds.province) queryParams.append('province', bounds.province);
    if (bounds.district) queryParams.append('district', bounds.district);
    
    const url = `/jobs/map-search?${queryParams.toString()}`;
    const response = await apiClient.get(url);
    
    // Response structure: { success: true, data: [...], meta: {...} }
    return response.data;
  } catch (error) {
    console.error('Error searching jobs on map:', error);
    throw error;
  }
};

// Lấy cụm công việc cho bản đồ (clustering) - dùng khi zoom < 12
// Backend trả về mảng phẳng: [{ type: 'cluster', ... }, { type: 'single', ... }]
export const getJobClusters = async (bounds, zoom) => {
  try {
    const queryParams = new URLSearchParams();
    queryParams.append('sw_lat', bounds.sw_lat);
    queryParams.append('sw_lng', bounds.sw_lng);
    queryParams.append('ne_lat', bounds.ne_lat);
    queryParams.append('ne_lng', bounds.ne_lng);
    queryParams.append('zoom', zoom);
    
    // Thêm các filters bổ sung
    if (bounds.category) queryParams.append('category', bounds.category);
    if (bounds.experience) queryParams.append('experience', bounds.experience);
    if (bounds.jobType) queryParams.append('jobType', bounds.jobType);
    if (bounds.workType) queryParams.append('workType', bounds.workType);
    if (bounds.province) queryParams.append('province', bounds.province);
    if (bounds.district) queryParams.append('district', bounds.district);
    
    const url = `/jobs/map-clusters?${queryParams.toString()}`;
    const response = await apiClient.get(url);
    
    // Response structure: { success: true, data: [...] }
    // data là mảng phẳng chứa cả clusters và single jobs
    return response.data.data;
  } catch (error) {
    console.error('Error fetching job clusters:', error);
    throw error;
  }
};


// Lấy các cụm công việc trên bản đồ
export const getMapClusters = async (bounds) => {
  const { sw_lat, sw_lng, ne_lat, ne_lng, zoom, ...filters } = bounds;
  const queryParams = new URLSearchParams({
    sw_lat: sw_lat.toString(),
    sw_lng: sw_lng.toString(),
    ne_lat: ne_lat.toString(),
    ne_lng: ne_lng.toString(),
    zoom: zoom.toString(),
  });

  // Thêm các filters bổ sung nếu có
  if (filters.category) queryParams.append('category', filters.category);
  if (filters.type) queryParams.append('type', filters.type);
  if (filters.workType) queryParams.append('workType', filters.workType);
  if (filters.experience) queryParams.append('experience', filters.experience);
  if (filters.province) queryParams.append('province', filters.province);
  if (filters.district) queryParams.append('district', filters.district);

  const response = await apiClient.get(`/jobs/map-clusters?${queryParams.toString()}`);
  return response.data;
};

// Lấy danh sách công việc cùng công ty
export const getJobsByCompany = async (companyId, params = {}) => {
  try {
    const queryParams = new URLSearchParams();
    if (params.page) queryParams.append('page', params.page);
    if (params.limit) queryParams.append('limit', params.limit);
    if (params.sortBy) queryParams.append('sortBy', params.sortBy);
    if (params.excludeId) queryParams.append('excludeId', params.excludeId);
    
    const url = `/companies/${companyId}/jobs${queryParams.toString() ? `?${queryParams.toString()}` : ''}`;
    const response = await apiClient.get(url);
    return response.data;
  } catch (error) {
    console.error('Error fetching jobs by company:', error);
    throw error;
  }
};
</file>

<file path="package.json">
{
  "name": "a",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^5.2.2",
    "@radix-ui/react-accordion": "^1.2.12",
    "@radix-ui/react-alert-dialog": "^1.1.15",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-checkbox": "^1.3.3",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-dropdown-menu": "^2.1.16",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-progress": "^1.1.7",
    "@radix-ui/react-radio-group": "^1.3.8",
    "@radix-ui/react-scroll-area": "^1.2.10",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-slider": "^1.3.6",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.2.6",
    "@radix-ui/react-tabs": "^1.1.13",
    "@radix-ui/react-tooltip": "^1.2.8",
    "@react-oauth/google": "^0.12.2",
    "@reduxjs/toolkit": "^2.8.2",
    "@soniox/speech-to-text-web": "^1.2.0",
    "@tailwindcss/vite": "^4.1.13",
    "@tanstack/react-query": "^5.87.1",
    "@vitejs/plugin-react-swc": "^4.0.1",
    "axios": "^1.11.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "firebase": "^12.3.0",
    "framer-motion": "^12.23.22",
    "leaflet": "^1.9.4",
    "lucide-react": "^0.541.0",
    "next-themes": "^0.4.6",
    "pdfjs-dist": "^5.4.296",
    "react": "^19.1.1",
    "react-beautiful-dnd": "^13.1.1",
    "react-dom": "^19.1.1",
    "react-helmet-async": "^2.0.5",
    "react-hook-form": "^7.62.0",
    "react-icons": "^5.5.0",
    "react-leaflet": "^5.0.0",
    "react-leaflet-cluster": "^3.1.1",
    "react-pdf": "^10.2.0",
    "react-redux": "^9.2.0",
    "react-router-dom": "^7.6.3",
    "recharts": "^3.2.1",
    "simple-peer": "^9.11.1",
    "socket.io-client": "^4.8.1",
    "sonner": "^2.0.7",
    "swiper": "^12.0.2",
    "tailwind-merge": "^3.3.1",
    "tailwindcss": "^4.1.13",
    "tailwindcss-animate": "^1.0.7",
    "tw-animate-css": "^1.3.8",
    "zod": "^4.1.8"
  },
  "devDependencies": {
    "@eslint/js": "^9.33.0",
    "@types/react": "^19.1.10",
    "@types/react-dom": "^19.1.7",
    "eslint": "^9.33.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "globals": "^16.3.0",
    "json-server": "^1.0.0-beta.3",
    "vite": "^7.1.2",
    "vite-plugin-mkcert": "^1.17.8"
  }
}
</file>

<file path="src/index.css">
@import "tailwindcss";
@import "tw-animate-css";
@import "./styles/preloader.css";

/* Interview video mirror effect */
.mirror {
  transform: scaleX(-1);
}

@theme inline {
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@custom-variant dark (&:is(.dark *));

:root {
  --background: oklch(100% 0 0);
  --foreground: oklch(20.33% 0.088 261.2);
  --card: oklch(100% 0 0);
  --card-foreground: oklch(20.33% 0.088 261.2);
  --popover: oklch(100% 0 0);
  --popover-foreground: oklch(20.33% 0.088 261.2);
  --primary: oklch(0.7227 0.192 149.58);
  --primary-foreground: oklch(100% 0.0 0);
  --primary-light: oklch(96.39% 0.033 151.2);
  --brand-accent: oklch(46.36% 0.149 151.2);
  --secondary: oklch(98.13% 0.006 257);
  --secondary-foreground: oklch(20.33% 0.088 261.2);
  --muted: oklch(98.13% 0.006 257);
  --muted-foreground: oklch(50.48% 0.023 259.7);
  --accent: oklch(98.13% 0.006 257);
  --accent-foreground: oklch(20.33% 0.088 261.2);
  --destructive: oklch(62.8% 0.224 25.4);
  --destructive-foreground: oklch(98.13% 0.006 257);
  --border: oklch(92.11% 0.016 258.4);
  --input: oklch(92.11% 0.016 258.4);
  --ring: oklch(46.36% 0.149 151.2);
  --radius: 0.75rem;
  --info: oklch(59.94% 0.199 261.8);
  --warning: oklch(79.37% 0.176 83.2);
  --success: oklch(46.36% 0.149 151.2);
  --footer: oklch(91.75% 0.012 260.1);
  --footer-foreground: oklch(25% 0.015 260.6);
  --footer-muted: oklch(61.03% 0.008 260.5);
  --blue-primary: oklch(53.94% 0.142 240.2);
  --blue-secondary: oklch(62.8% 0.224 240.4);
  --purple-primary: oklch(58.4% 0.168 300.8);
  --purple-secondary: oklch(46.36% 0.149 300.2);
  --orange-primary: oklch(72.37% 0.183 60.8);
  --orange-secondary: oklch(62.8% 0.224 60.4);
  --indigo-primary: oklch(53.94% 0.142 270.2);
  --pink-primary: oklch(62.8% 0.224 330.8);
  --cyan-primary: oklch(67.43% 0.174 200.6);
  --amber-primary: oklch(79.37% 0.176 83.2);
  --emerald-primary: oklch(46.36% 0.149 151.2);
}

.dark {
  /* Nền sáng hơn - từ 20% lên 15-18% */
  --background: oklch(15% 0.02 261.2);
  --foreground: oklch(98% 0.005 257);

  /* Card sáng hơn nền một chút để tạo depth */
  --card: oklch(20% 0.025 261.2);
  --card-foreground: oklch(98% 0.005 257);

  /* Popover sáng hơn để nổi bật */
  --popover: oklch(20% 0.03 261.2);
  --popover-foreground: oklch(98% 0.005 257);

  /* Primary sáng và rõ ràng hơn */
  --primary: oklch(65% 0.18 151.2);
  --brand-accent: oklch(65% 0.18 151.2);
  --primary-foreground: oklch(15% 0.02 152.8);
  --primary-light: oklch(25% 0.08 151.2);

  /* Secondary và muted sáng hơn */
  --secondary: oklch(25% 0.04 260.1);
  --secondary-foreground: oklch(98% 0.005 257);
  --muted: oklch(22% 0.03 260.1);
  --muted-foreground: oklch(70% 0.02 259);

  /* Accent */
  --accent: oklch(25% 0.04 260.1);
  --accent-foreground: oklch(98% 0.005 257);

  /* Status colors - sáng và rõ ràng hơn */
  --destructive: oklch(55% 0.2 24.9);
  --destructive-foreground: oklch(98% 0.005 257);
  --info: oklch(70% 0.18 259.6);
  --warning: oklch(78% 0.17 77.2);
  --success: oklch(65% 0.18 151.2);

  /* Border và input sáng hơn để dễ nhìn */
  --border: oklch(28% 0.04 260.1);
  --input: oklch(25% 0.04 260.1);
  --ring: oklch(65% 0.18 151.2);

  /* Footer */
  --footer: oklch(18% 0.025 259.3);
  --footer-foreground: oklch(85% 0.015 259.4);
  --footer-muted: oklch(50% 0.015 259.5);
}

/* Base styles */
* {
  border-color: var(--border);
}

body {
  background-color: var(--background);
  color: var(--foreground);
  font-feature-settings: "rlig" 1, "calt" 1;
  transition: background-color 0.3s ease, color 0.3s ease;
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M3 3l18 9-7 2-2 7z" fill="rgb(22,163,74)" stroke="rgb(0,0,0)" stroke-width="2.5"/></svg>') 3 3, auto;
}

/* Custom cursor styles for interactive elements - Hand pointer */
a, button, [role="button"], input[type="submit"], input[type="button"], 
select, .cursor-pointer {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path d="M10 18v-7c0-1 0.9-2 2-2s2 1 2 2v7 M12 18V9c0-1 0.9-2 2-2s2 1 2 2v9 M14 18v-7c0-1 0.9-2 2-2s2 1 2 2v7 M16 20v-5c0-1 0.9-2 2-2s2 1 2 2v10c0 3-2.2 5-5 5h-4c-2.5 0-4.5-1.5-5.2-3.8L4 22" fill="rgb(34,197,94)" stroke="rgb(0,0,0)" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/></svg>') 16 10, pointer;
  transition: transform 0.1s ease;
}

/* Active state - smaller hand */
a:active, button:active, [role="button"]:active, 
input[type="submit"]:active, input[type="button"]:active {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 32 32"><path d="M10 18v-7c0-1 0.9-2 2-2s2 1 2 2v7 M12 18V9c0-1 0.9-2 2-2s2 1 2 2v9 M14 18v-7c0-1 0.9-2 2-2s2 1 2 2v7 M16 20v-5c0-1 0.9-2 2-2s2 1 2 2v10c0 3-2.2 5-5 5h-4c-2.5 0-4.5-1.5-5.2-3.8L4 22" fill="rgb(74,222,128)" stroke="rgb(0,0,0)" stroke-width="2.2" stroke-linejoin="round" stroke-linecap="round"/></svg>') 15 9, pointer;
  transform: scale(0.98);
}

/* Hover animation */
a:hover, button:hover, [role="button"]:hover {
  animation: cursor-bounce 0.5s ease-in-out;
}

@keyframes cursor-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-2px); }
}

/* Cursor for text inputs - Pen icon */
textarea, input[type="text"], input[type="email"], input[type="password"],
input[type="search"], input[type="tel"], input[type="url"], input[type="number"] {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 24 24" fill="none"><path d="M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" fill="rgb(59,130,246)" stroke="white" stroke-width="2" stroke-linejoin="round"/><path d="M15 5l4 4" stroke="white" stroke-width="1.8"/></svg>') 3 25, text;
}

/* Focus state - brighter pen */
textarea:focus, input[type="text"]:focus, input[type="email"]:focus, 
input[type="password"]:focus, input[type="search"]:focus {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 24 24" fill="none"><path d="M17 3a2.83 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" fill="rgb(96,165,250)" stroke="white" stroke-width="2.2" stroke-linejoin="round"/><path d="M15 5l4 4" stroke="white" stroke-width="2"/></svg>') 3 27, text;
}

/* Cursor for draggable elements - Move arrows */
[draggable="true"], .cursor-grab {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3" stroke="rgb(251,146,60)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="2" fill="rgb(251,146,60)"/></svg>') 12 12, grab;
}

[draggable="true"]:active, .cursor-grabbing {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M5 9l-3 3 3 3M9 5l3-3 3 3M15 19l-3 3-3-3M19 9l3 3-3 3" stroke="rgb(249,115,22)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="rgb(249,115,22)" fill-opacity="0.2"/><circle cx="12" cy="12" r="3" fill="rgb(249,115,22)"/></svg>') 12 12, grabbing;
}

/* Cursor for disabled elements - X mark */
[disabled], .cursor-not-allowed {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="rgb(239,68,68)" stroke-width="2" fill="rgb(254,226,226)"/><path d="M8 8l8 8M16 8l-8 8" stroke="rgb(239,68,68)" stroke-width="2.5" stroke-linecap="round"/></svg>') 10 10, not-allowed;
  opacity: 0.6;
}

/* Cursor for loading states - Clock */
.cursor-wait, .loading {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="rgb(168,85,247)" stroke-width="2" fill="rgb(243,232,255)"/><path d="M12 6v6l4 2" stroke="rgb(168,85,247)" stroke-width="2" stroke-linecap="round"/></svg>') 10 10, wait;
}



/* Cursor for delete/close buttons - Trash icon */
.cursor-delete, button[aria-label*="delete" i], button[aria-label*="remove" i] {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" stroke="rgb(239,68,68)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 11v6M14 11v6" stroke="rgb(239,68,68)" stroke-width="2" stroke-linecap="round"/></svg>') 10 10, pointer;
}

/* Cursor for copy buttons - Copy icon */
.cursor-copy, button[aria-label*="copy" i] {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"><rect x="9" y="9" width="13" height="13" rx="2" stroke="rgb(59,130,246)" stroke-width="2" fill="rgb(219,234,254)"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="rgb(59,130,246)" stroke-width="2"/></svg>') 10 10, pointer;
}

/* Cursor for zoom/magnifier */
.cursor-zoom-in, button[aria-label*="zoom" i] {
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="8" stroke="rgb(16,185,129)" stroke-width="2" fill="rgb(209,250,229)"/><path d="M21 21l-4.35-4.35M11 8v6M8 11h6" stroke="rgb(16,185,129)" stroke-width="2" stroke-linecap="round"/></svg>') 10 10, zoom-in;
}

/* Click ripple effect */
@keyframes click-ripple {
  0% {
    box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7);
  }
  100% {
    box-shadow: 0 0 0 15px rgba(99, 102, 241, 0);
  }
}

button:active, a:active, [role="button"]:active {
  animation: click-ripple 0.3s ease-out;
}

/* Smooth theme transitions */
*,
*::before,
*::after {
  transition-property: background-color, border-color, color, fill, stroke;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}

/* Exclude animations and transforms from theme transition */
* {
  transition-property: background-color, border-color, color, fill, stroke !important;
}

/* Container utility */
.container {
  width: 100%;
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
  padding-left: 1rem;
  padding-right: 1rem;
}

@media (min-width: 640px) {
  .container {
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }
}

@media (min-width: 1024px) {
  .container {
    padding-left: 2rem;
    padding-right: 2rem;
  }
}

@media (min-width: 1280px) {
  .container {
    max-width: 1280px;
  }
}

/* Custom gradient utilities */
.text-gradient-primary {
  background: linear-gradient(135deg, var(--primary) 0%, var(--info) 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 200% 200%;
  animation: gradient-shift 3s ease-in-out infinite;
}

.bg-gradient-primary {
  background: linear-gradient(135deg, rgb(34, 197, 94) 0%, rgb(37, 99, 235) 100%);
  color: white;
}

.bg-gradient-to-primary {
  background: linear-gradient(135deg, var(--primary-light) 0%, var(--background) 100%);
}

/* Enhanced gradient utilities for better visual appeal */
.btn-gradient {
  background: linear-gradient(135deg, rgb(34, 197, 94) 0%, rgb(37, 99, 235) 100%);
  color: white;
  transition: all 0.3s ease;
}

.btn-gradient:hover {
  background: linear-gradient(135deg, rgb(22, 163, 74) 0%, rgb(29, 78, 216) 100%);
  transform: translateY(-1px);
  box-shadow: 0 10px 20px -5px rgba(34, 197, 94, 0.3);
}

/* Skeleton shimmer animation */
@keyframes shimmer {
  0% {
    background-position: -1000px 0;
  }

  100% {
    background-position: 1000px 0;
  }
}

.skeleton-shimmer {
  background: linear-gradient(90deg,
      rgba(255, 255, 255, 0.1) 25%,
      rgba(255, 255, 255, 0.3) 50%,
      rgba(255, 255, 255, 0.1) 75%);
  background-size: 1000px 100%;
  animation: shimmer 2s infinite linear;
}

/* Micro-interactions: subtle entrance and hover animations */
@keyframes enter-up {
  from {
    opacity: 0;
    transform: translateY(6px) scale(0.995);
  }

  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.enter-up {
  animation: enter-up 360ms cubic-bezier(.2, .9, .2, 1) both;
}

.hover-lift {
  transition: transform 200ms ease, box-shadow 200ms ease;
}

.hover-lift:hover {
  transform: translateY(-4px) scale(1.01);
  box-shadow: 0 12px 30px -8px rgba(2, 6, 23, 0.2), 0 6px 12px -6px rgba(2, 6, 23, 0.08);
}

/* Prefer reduced motion: disable non-essential animations */
@media (prefers-reduced-motion: reduce) {
  .skeleton-shimmer {
    animation: none;
  }

  .enter-up {
    animation: none;
  }

  .hover-lift,
  .btn-gradient {
    transition: none;
    transform: none !important;
  }
}

/* Subtle background patterns */
.grainy-background {
  background:
    radial-gradient(circle at 25% 25%, rgba(34, 197, 94, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(37, 99, 235, 0.05) 0%, transparent 50%),
    var(--background);
}

.subtle-gradient-bg {
  background: linear-gradient(135deg,
      var(--background) 0%,
      rgba(248, 250, 252, 0.5) 50%,
      var(--background) 100%);
}


/* Animations */
@keyframes gradient-shift {

  0%,
  100% {
    background-position: 0% 50%;
  }

  50% {
    background-position: 100% 50%;
  }
}

/* Enhanced focus styles */
.focus-ring {
  outline: none;
  box-shadow: 0 0 0 2px var(--ring), 0 0 0 4px var(--background);
}

.focus-ring:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--ring), 0 0 0 4px var(--background);
}

/* Smooth transitions */
.transition-smooth {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--muted);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 4px;
  transition: background 0.2s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--muted-foreground);
}

.dark ::-webkit-scrollbar-track {
  background: var(--background);
}

.dark ::-webkit-scrollbar-thumb {
  background: oklch(35% 0.05 260.1);
}

.dark ::-webkit-scrollbar-thumb:hover {
  background: oklch(45% 0.06 260.1);
}

/* Loading animations */
@keyframes pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.5;
  }
}

.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Card hover effects */
.card-hover {
  transition: all 0.3s ease;
  cursor: pointer;
}

.card-hover:hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  transform: translateY(-4px);
}

.dark .card-hover:hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
}

.card-interactive {
  cursor: pointer;
  transition: all 0.3s ease;
}

.card-interactive:hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  transform: translateY(-4px);
  border-color: color-mix(in oklch, transparent, var(--primary) 20%);
}

.dark .card-interactive:hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
}


/* Button enhancements */
.btn-gradient {
  background: linear-gradient(to right, var(--primary), var(--info));
  color: var(--primary-foreground);
  font-weight: 600;
  transition: all 0.3s ease;
}

.btn-gradient:hover {
  background: linear-gradient(to right,
      color-mix(in oklch, black 10%, var(--primary)),
      color-mix(in oklch, black 10%, var(--info)));
}

.btn-gradient:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--primary), 0 0 0 4px var(--background);
}

/* Glass morphism effect */
.glass {
  background-color: color-mix(in oklch, transparent, var(--background) 80%);
  backdrop-filter: blur(12px);
  border: 1px solid color-mix(in oklch, transparent, var(--border) 50%);
}

.glass-light {
  background-color: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Footer utility classes */
.bg-footer {
  background-color: rgba(235, 255, 232, 0.801);
}

.text-footer-foreground {
  color: var(--footer-foreground);
}

.text-footer-muted {
  color: var(--footer-muted);
}

/* Text selection */
::selection {
  background: oklch(85% 0.08 151.2);
  color: oklch(20% 0.088 261.2);
}

::-moz-selection {
  background: oklch(85% 0.08 151.2);
  color: oklch(20% 0.088 261.2);
}

.dark ::selection {
  background: oklch(40% 0.12 151.2);
  color: oklch(98% 0.005 257);
}

.dark ::-moz-selection {
  background: oklch(40% 0.12 151.2);
  color: oklch(98% 0.005 257);
}


/* Responsive utilities */
@media (max-width: 768px) {
  .mobile-hidden {
    display: none;
  }
}

@media (min-width: 769px) {
  .desktop-hidden {
    display: none;
  }
}

/* Accessibility improvements */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Skip to content link */
.skip-link {
  position: absolute;
  top: 0;
  left: 0;
  background-color: var(--primary);
  color: var(--primary-foreground);
  padding: 0.5rem 1rem;
  transform: translateY(-100%);
  transition: transform 0.2s ease;
  z-index: 50;
}

.skip-link:focus {
  transform: translateY(0);
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .text-muted-foreground {
    color: var(--foreground);
  }
}

/* ===== Fix for Radix UI Components in Dialogs ===== */
/* (Phần này không thay đổi vì sử dụng màu cố định, không dùng biến) */

[data-radix-select-content] {
  z-index: 999999 !important;
  position: fixed !important;
}

[data-radix-dropdown-menu-content] {
  z-index: 999999 !important;
  position: fixed !important;
}

[data-radix-select-content],
[data-radix-dropdown-menu-content] {
  background-color: white !important;
  border: 1px solid var(--border) !important;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
  backdrop-filter: blur(8px) !important;
}

.dark [data-radix-select-content],
.dark [data-radix-dropdown-menu-content] {
  background-color: var(--popover) !important;
  color: var(--popover-foreground) !important;
  border-color: var(--border) !important;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3) !important;
}

body:has([data-radix-dialog-content]) [data-radix-select-content] {
  z-index: 999999 !important;
}

[data-radix-select-viewport] {
  max-height: 200px !important;
  overflow-y: auto !important;
}

[data-radix-select-content],
[data-radix-dropdown-menu-content] {
  opacity: 1 !important;
}

[data-radix-dialog-content] input,
[data-radix-dialog-content] textarea,
[data-radix-dialog-content] [data-radix-select-trigger] {
  border-color: rgb(209 213 219) !important;
  background-color: white !important;
}

.dark [data-radix-dialog-content] input,
.dark [data-radix-dialog-content] textarea,
.dark [data-radix-dialog-content] [data-radix-select-trigger] {
  border-color: var(--border) !important;
  background-color: var(--input) !important;
  color: var(--foreground) !important;
}

[data-radix-dialog-content] input:focus,
[data-radix-dialog-content] textarea:focus,
[data-radix-dialog-content] [data-radix-select-trigger]:focus {
  border-color: rgb(34 197 94) !important;
  box-shadow: 0 0 0 1px rgb(34 197 94) !important;
}

[data-radix-dialog-content] [data-radix-select-content] {
  background-color: white !important;
  border: 1px solid rgb(209 213 219) !important;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
  z-index: 999999 !important;
}

.dark [data-radix-dialog-content] [data-radix-select-content] {
  background-color: var(--popover) !important;
  border-color: var(--border) !important;
}

[data-radix-dialog-content] [data-radix-select-item] {
  color: rgb(17 24 39) !important;
}

.dark [data-radix-dialog-content] [data-radix-select-item] {
  color: var(--foreground) !important;
}

[data-radix-dialog-content] [data-radix-select-item]:hover,
[data-radix-dialog-content] [data-radix-select-item][data-highlighted] {
  background-color: rgb(249 250 251) !important;
}

.dark [data-radix-dialog-content] [data-radix-select-item]:hover,
.dark [data-radix-dialog-content] [data-radix-select-item][data-highlighted] {
  background-color: var(--accent) !important;
}

/* Animated background specific styles */
.animated-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1;
  pointer-events: none;
}

.gradient-layer {
  position: absolute;
  inset: 0;
}

.particle-canvas {
  position: absolute;
  inset: 0;
  opacity: 0.6;
}

/* Performance optimizations for animations */
.will-change-transform {
  will-change: transform;
}

.will-change-opacity {
  will-change: opacity;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .animated-background {
    display: none;
  }

  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground;
  }
}

/* Leaflet Map Styles */
@layer components {
  .leaflet-container {
    @apply rounded-lg;
  }

  .leaflet-popup-content-wrapper {
    @apply rounded-lg shadow-xl;
  }

  .leaflet-popup-tip {
    @apply shadow-lg;
  }

  /* Custom marker animations */
  @keyframes marker-bounce {

    0%,
    100% {
      transform: translateY(0);
    }

    50% {
      transform: translateY(-10px);
    }
  }

  .custom-marker:hover,
  .user-marker:hover {
    animation: marker-bounce 0.5s ease-in-out;
  }
}

/* Enhanced Header Animations */
@layer components {

  /* Smooth fade and slide in animations */
  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }

    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Glow effect for notifications */
  @keyframes glow-pulse {

    0%,
    100% {
      box-shadow: 0 0 5px rgba(34, 197, 94, 0.5), 0 0 10px rgba(34, 197, 94, 0.3);
    }

    50% {
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.8), 0 0 20px rgba(34, 197, 94, 0.5);
    }
  }

  /* Shimmer effect for premium elements */
  @keyframes shimmer-gold {
    0% {
      background-position: -200% center;
    }

    100% {
      background-position: 200% center;
    }
  }

  /* Smooth gradient animation */
  @keyframes gradient-x {

    0%,
    100% {
      background-position: 0% 50%;
    }

    50% {
      background-position: 100% 50%;
    }
  }

  /* Ripple effect */
  @keyframes ripple {
    0% {
      transform: scale(0);
      opacity: 1;
    }

    100% {
      transform: scale(2);
      opacity: 0;
    }
  }

  /* Notification badge bounce */
  @keyframes badge-bounce {

    0%,
    100% {
      transform: scale(1);
    }

    25% {
      transform: scale(1.2);
    }

    50% {
      transform: scale(0.9);
    }

    75% {
      transform: scale(1.1);
    }
  }

  /* Utility classes for header effects */
  .animate-fade-in-down {
    animation: fadeInDown 0.3s ease-out;
  }

  .animate-fade-in-up {
    animation: fadeInUp 0.3s ease-out;
  }

  .animate-scale-in {
    animation: scaleIn 0.2s ease-out;
  }

  .animate-glow-pulse {
    animation: glow-pulse 2s ease-in-out infinite;
  }

  .animate-shimmer-gold {
    background-image: linear-gradient(90deg,
        rgba(250, 204, 21, 0) 0%,
        rgba(250, 204, 21, 0.4) 50%,
        rgba(250, 204, 21, 0) 100%);
    background-size: 200% auto;
    animation: shimmer-gold 3s linear infinite;
  }

  .animate-gradient-x {
    background-size: 200% 100%;
    animation: gradient-x 3s ease infinite;
  }

  /* Glassmorphism enhancements for dropdowns */
  .glass-effect {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  .glass-effect-dark {
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* Smooth transitions for all interactive elements */
  .header-item-transition {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Enhanced hover states */
  .hover-lift {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .hover-lift:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
  }

  /* Gradient text effect */
  .text-gradient {
    background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .text-gradient-animate {
    background: linear-gradient(135deg, #10b981 0%, #3b82f6 50%, #10b981 100%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-x 3s ease infinite;
  }
}


/* Map Cluster Marker Styles */
.marker-cluster-wrapper {
  background: transparent;
  border: none;
}

.marker-cluster-custom {
  background: linear-gradient(135deg, rgb(34, 197, 94) 0%, rgb(37, 99, 235) 100%);
  border-radius: 50%;
  color: white;
  font-weight: bold;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 40px;
  height: 40px;
  border: 3px solid white;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  transition: all 0.3s ease;
  cursor: pointer;
}

.marker-cluster-custom:hover {
  transform: scale(1.1);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
}

.marker-cluster-custom span {
  font-size: 14px;
  font-weight: 700;
}

/* Leaflet popup customization */
.leaflet-popup-content-wrapper {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 0.75rem;
  padding: 0.5rem;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.dark .leaflet-popup-content-wrapper {
  background: rgba(31, 41, 55, 0.95);
  color: white;
}

.leaflet-popup-tip {
  background: rgba(255, 255, 255, 0.95);
}

.dark .leaflet-popup-tip {
  background: rgba(31, 41, 55, 0.95);
}

/* Leaflet control customization */
.leaflet-control-zoom a {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(229, 231, 235, 0.8);
  color: rgb(17, 24, 39);
  transition: all 0.2s ease;
}

.leaflet-control-zoom a:hover {
  background: rgba(255, 255, 255, 1);
  border-color: rgb(34, 197, 94);
}

.dark .leaflet-control-zoom a {
  background: rgba(31, 41, 55, 0.9);
  border-color: rgba(75, 85, 99, 0.8);
  color: white;
}

.dark .leaflet-control-zoom a:hover {
  background: rgba(31, 41, 55, 1);
  border-color: rgb(34, 197, 94);
}

.a4-size {
  width: 210mm;
  min-height: 297mm;
  box-sizing: border-box;
}

.a4-page {
  width: 210mm;
  min-height: 297mm;
  box-sizing: border-box;
  position: relative;
  overflow: hidden;
}

@media print {

  /* Các thiết lập cơ bản cho body */
  body {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* * Đây là quy tắc quan trọng nhất.
   * Nó ép mỗi <div class="a4-page"> (được tạo bởi JS) 
   * phải nằm trọn vẹn trên MỘT trang in.
   */
  .a4-page {
    page-break-after: always !important;
    /* Luôn sang trang mới sau khi hết div này */

    /* Ép kích thước vừa khít 1 trang A4 khi in */
    width: 210mm !important;
    height: 297mm !important;
    min-height: 297mm !important;
    /* Ghi đè style inline của React */

    /* Ẩn bất cứ nội dung nào bị tràn 1-2px do lỗi làm tròn */
    overflow: hidden !important;

    /* Xóa shadow và margin khi in */
    margin: 0 !important;
    box-shadow: none !important;
  }

  /* Ẩn tất cả các phần tử có class no-print */
  .no-print {
    display: none !important;
  }

  /* * VÔ HIỆU HÓA tất cả logic ngắt trang thông minh khác.
   * Chúng ta không cần chúng nữa vì JavaScript đã xử lý rồi.
   */
  .break-inside-avoid,
  .break-after-avoid,
  section,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    page-break-inside: auto !important;
    break-inside: auto !important;
    page-break-after: auto !important;
    break-after: auto !important;
  }
}

/* Landing Page Animations */
@keyframes fade-in {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

@keyframes fade-in-up {
  from {
    opacity: 0;
    transform: translateY(30px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes float {

  0%,
  100% {
    transform: translateY(0px);
  }

  50% {
    transform: translateY(-20px);
  }
}

.animate-fade-in {
  animation: fade-in 0.8s ease-out;
}

.animate-fade-in-up {
  animation: fade-in-up 0.8s ease-out;
}

.delay-200 {
  animation-delay: 0.2s;
  animation-fill-mode: both;
}

.delay-400 {
  animation-delay: 0.4s;
  animation-fill-mode: both;
}

.delay-1000 {
  animation-delay: 1s;
}

/* Smooth scroll behavior */
html {
  scroll-behavior: smooth;
}

/* Enhanced card shadows */
.shadow-card {
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.shadow-card-hover {
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* Shimmer Text Effect - Smooth shine animation like ChatGPT thinking */
@keyframes shimmer-sweep {
  0% {
    background-position: 200% center, 0% center;
  }
  100% {
    background-position: -200% center, 0% center;
  }
}

.shimmer-text {
  background: 
    linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0) 30%,
      rgba(255, 255, 255, 0.8) 50%,
      rgba(255, 255, 255, 0) 70%,
      rgba(255, 255, 255, 0) 100%
    ),
    linear-gradient(135deg, rgb(34, 197, 94) 0%, rgb(37, 99, 235) 100%);
  background-size: 200% 100%, 100% 100%;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmer-sweep 6s ease-in-out infinite;
}

/* Dark mode shimmer - same effect */
.dark .shimmer-text {
  background: 
    linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0) 30%,
      rgba(255, 255, 255, 0.7) 50%,
      rgba(255, 255, 255, 0) 70%,
      rgba(255, 255, 255, 0) 100%
    ),
    linear-gradient(135deg, rgb(34, 197, 94) 0%, rgb(37, 99, 235) 100%);
  background-size: 200% 100%, 100% 100%;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmer-sweep 4s ease-in-out infinite;
}

/* Shimmer for dark/foreground text - keeps original text color */
.shimmer-text-dark {
  background: 
    linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0) 30%,
      rgba(255, 255, 255, 0.6) 50%,
      rgba(255, 255, 255, 0) 70%,
      rgba(255, 255, 255, 0) 100%
    ),
    rgb(0, 0, 0);
  background-size: 200% 100%, 100% 100%;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmer-sweep 5s ease-in-out infinite;
}

.dark .shimmer-text-dark {
  background: 
    linear-gradient(
      90deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0) 30%,
      rgba(255, 255, 255, 0.5) 50%,
      rgba(255, 255, 255, 0) 70%,
      rgba(255, 255, 255, 0) 100%
    ),
    linear-gradient(135deg, rgb(255, 255, 255) 0%, rgb(243, 244, 246) 100%);
  background-size: 200% 100%, 100% 100%;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: shimmer-sweep 4s ease-in-out infinite;
}
</file>

<file path="src/pages/jobs/JobDetail.jsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { useSelector } from 'react-redux';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Helmet, HelmetProvider } from 'react-helmet-async';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { ChevronLeft, ChevronRight } from 'lucide-react';
import {
  MapPin,
  Clock,
  DollarSign,
  Building,
  Calendar,
  Bookmark,
  ArrowLeft,
  CheckCircle,
  Briefcase,
  UserCheck,
  Coins,
  Eye,
  AlertTriangle
} from 'lucide-react';
import { getJobApplicantCount, getJobById, getJobsByCompany } from '../../services/jobService';
import { saveJob, unsaveJob } from '../../services/savedJobService';
import { saveViewHistory } from '../../services/viewHistoryService';
import { toast } from 'sonner';
import { ApplyJobDialog } from './components/ApplyJobDialog';
import { Skeleton } from '@/components/ui/skeleton';
import { ErrorState } from '@/components/common/ErrorState';
import { EmptyState } from '@/components/common/EmptyState';
import JobLocationMap from '@/components/common/JobLocationMap';
import JobDetailHeader from '@/components/common/JobDetail/Header';
import JobDetailSidebar from '@/components/common/JobDetail/Sidebar';

const JobDetail = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { isAuthenticated } = useSelector((state) => state.auth);
  const queryClient = useQueryClient();
  const [showApplyDialog, setShowApplyDialog] = useState(false);
  const [applicantCount, setApplicantCount] = useState(null);
  const [isLoadingApplicants, setIsLoadingApplicants] = useState(false);
  const [hasViewedApplicants, setHasViewedApplicants] = useState(false);
  const [showConfirmDialog, setShowConfirmDialog] = useState(false);
  const [relatedJobsPage, setRelatedJobsPage] = useState(1);
  const jobsPerPage = 6;

  // Fetch job details using React Query
  const { data: job, isLoading, isError, error, refetch } = useQuery({
    queryKey: ['jobDetail', id],
    queryFn: () => getJobById(id),
    enabled: !!id,
    select: (data) => data.data.data,
  });

  // Fetch jobs from the same company
  const { data: relatedJobs, isLoading: isLoadingRelated } = useQuery({
    queryKey: ['companyJobs', job?.company?._id, id],
    queryFn: () => getJobsByCompany(job?.company?._id, {
      limit: 20,
      excludeId: id
    }),
    enabled: !!job?.company?._id,
    select: (data) => data.data?.filter(j => j._id !== id) || [],
  });

  // Tự động lưu lịch sử xem khi vào trang chi tiết job
  useEffect(() => {
    if (job && id && isAuthenticated) {
      // Lưu lịch sử xem (silent - không hiển thị thông báo)
      saveViewHistory(id).catch((error) => {
        // Silent error - không làm gián đoạn trải nghiệm người dùng
        console.error('Failed to save view history:', error);
      });
    }
  }, [job, id, isAuthenticated]);

  const formatWorkType = (type) => {
    const typeMap = {
      'FULL_TIME': 'Toàn thời gian',
      'PART_TIME': 'Bán thời gian',
      'CONTRACT': 'Hợp đồng',
      'FREELANCE': 'Tự do',
      'INTERNSHIP': 'Thực tập'
    };
    return typeMap[type] || type;
  };

  const formatExperience = (level) => {
    const levelMap = {
      'INTERN': 'Thực tập sinh',
      'FRESHER': 'Fresher',
      'JUNIOR_LEVEL': 'Junior',
      'MID_LEVEL': 'Middle',
      'SENIOR_LEVEL': 'Senior',
      'MANAGER_LEVEL': 'Quản lý',
      'DIRECTOR_LEVEL': 'Giám đốc'
    };
    return levelMap[level] || level;
  };

  // Pagination logic for related jobs
  const totalRelatedJobs = relatedJobs?.length || 0;
  const totalPages = Math.ceil(totalRelatedJobs / jobsPerPage);
  const startIndex = (relatedJobsPage - 1) * jobsPerPage;
  const endIndex = startIndex + jobsPerPage;
  const currentJobs = relatedJobs?.slice(startIndex, endIndex) || [];

  const handlePrevPage = () => {
    setRelatedJobsPage(prev => Math.max(prev - 1, 1));
  };

  const handleNextPage = () => {
    setRelatedJobsPage(prev => Math.min(prev + 1, totalPages));
  };

  const handleViewApplicants = () => {
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để sử dụng chức năng này.');
      navigate('/login', { state: { from: location.pathname } });
      return;
    }
    setShowConfirmDialog(true);
  };

  const handleConfirmViewApplicants = async () => {
    try {
      setIsLoadingApplicants(true);
      setShowConfirmDialog(false);
      
      const response = await getJobApplicantCount(id);
      
      if (response.data.success) {
        setApplicantCount(response.data.data.applicantCount);
        setHasViewedApplicants(true);
        if (response.data.message) {
          toast.success(response.data.message);
        }
        queryClient.invalidateQueries(['userProfile']);
      }
    } catch (err) {
      const errorMessage = err.response?.data?.message || 'Có lỗi xảy ra khi lấy thông tin ứng viên';
      toast.error(errorMessage);
    } finally {
      setIsLoadingApplicants(false);
    }
  };

  const handleCancelViewApplicants = () => {
    setShowConfirmDialog(false);
  };

  const handleApply = () => {
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để ứng tuyển.');
      navigate('/login', { state: { from: location.pathname } });
      return;
    }
    setShowApplyDialog(true);
  };

  const handleApplySuccess = () => {
    toast.success("Ứng tuyển thành công! Nhà tuyển dụng sẽ sớm liên hệ với bạn.");
    queryClient.invalidateQueries({ queryKey: ['jobDetail', id] });
    queryClient.invalidateQueries({ queryKey: ['appliedJobs'] });
  };
  
  const { mutate: toggleSaveJob } = useMutation({
    mutationFn: () => {
      return job?.isSaved ? unsaveJob(id) : saveJob(id);
    },
    onMutate: async () => {
      await queryClient.cancelQueries({ queryKey: ['jobDetail', id] });
      const previousJobData = queryClient.getQueryData(['jobDetail', id]);
      queryClient.setQueryData(['jobDetail', id], (oldData) => {
        if (!oldData) return undefined;
        return {
          ...oldData,
          isSaved: !oldData.isSaved,
        };
      });
      return { previousJobData };
    },
    onSuccess: (data) => {
      const message = data.data.message || (job?.isSaved ? 'Đã bỏ lưu công việc' : 'Đã lưu công việc thành công');
      toast.success(message);
      queryClient.invalidateQueries({ queryKey: ['savedJobs'] });
    },
    onError: (err, _newVariables, context) => {
      if (context?.previousJobData) {
        queryClient.setQueryData(['jobDetail', id], context.previousJobData);
      }
      const errorMessage = err.response?.data?.message || 'Có lỗi xảy ra';
      toast.error(errorMessage);
    },
    onSettled: () => {
      queryClient.invalidateQueries({ queryKey: ['jobDetail', id] });
    }
  });

  const handleSave = () => {
    if (!isAuthenticated) {
      toast.error('Vui lòng đăng nhập để lưu việc làm.');
      navigate('/login', { state: { from: location.pathname } });
      return;
    }
    toggleSaveJob();
  };

  // Hàm handleShare đã được thay thế bằng ShareButtons component

  

  const ConfirmDialog = () => {
    if (!showConfirmDialog) return null;

    return (
      <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <Card className="w-full max-w-md mx-auto bg-card ">
          <CardHeader className="text-center">
            <div className="mx-auto w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-4">
              <Coins className="w-6 h-6 text-orange-600" />
            </div>
            <CardTitle className="text-xl">Xem số người đã ứng tuyển</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="text-center space-y-2">
              <p className="text-muted-foreground">
                Để xem số lượng ứng viên đã ứng tuyển vào vị trí này, bạn cần tiêu phí:
              </p>
              <div className="flex items-center justify-center space-x-2 text-lg font-semibold text-orange-600">
                <Coins className="w-5 h-5" />
                <span>50 xu</span>
              </div>
              <p className="text-sm text-muted-foreground">
                Xu sẽ được trừ từ tài khoản của bạn ngay lập tức.
              </p>
            </div>
            
            <div className="bg-muted/50 p-3 rounded-lg">
              <div className="flex items-start space-x-2">
                <AlertTriangle className="w-4 h-4 text-orange-600 mt-0.5 shrink-0" />
                <p className="text-xs text-muted-foreground">
                  Thông tin này chỉ hiển thị một lần. Sau khi xem, bạn không thể hoàn tiền.
                </p>
              </div>
            </div>

            <div className="flex space-x-3">
              <Button 
                variant="outline" 
                onClick={handleCancelViewApplicants}
                className="flex-1"
              >
                Hủy
              </Button>
              <Button 
                onClick={handleConfirmViewApplicants}
                className="flex-1 btn-gradient text-primary-foreground"
                disabled={isLoadingApplicants}
              >
                {isLoadingApplicants ? (
                  <>
                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"></div>
                    Đang xử lý...
                  </>
                ) : (
                  <>
                    <Coins className="w-4 h-4 mr-2" />
                    Đồng ý tiêu 50 xu
                  </>
                )}
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  };

  if (isLoading) {
    return (
      <div className="min-h-screen bg-background">
        <div className="container mx-auto py-8">
          <div className="max-w-4xl mx-auto">
            <Skeleton className="h-8 w-32 mb-6" />
            <Card className="mb-6 overflow-hidden">
              <Skeleton className="h-40 w-full" />
              <CardContent className="p-6">
                <div className="space-y-4">
                  <Skeleton className="h-6 w-3/4" />
                  <Skeleton className="h-4 w-1/2" />
                  <div className="flex gap-2">
                    <Skeleton className="h-6 w-20" />
                    <Skeleton className="h-6 w-20" />
                    <Skeleton className="h-6 w-20" />
                  </div>
                  <div className="flex justify-between items-center">
                    <Skeleton className="h-10 w-32" />
                    <Skeleton className="h-10 w-32" />
                  </div>
                </div>
              </CardContent>
            </Card>
          </div>
        </div>
      </div>
    );
  }

  if (isError) {
    return <ErrorState onRetry={refetch} message={error.response?.data?.message || error.message} />;
  }

  if (!job) {
    return <EmptyState message="Công việc bạn đang tìm có thể đã bị xóa hoặc không tồn tại." />;
  }

  // Lấy URL hiện tại và thông tin cho Open Graph
  const currentUrl = window.location.href;
  const companyLogo = job?.company?.logo || job?.recruiterProfileId?.company?.logo || '/default-job-image.png';
  const jobDescription = job?.description?.replace(/<[^>]*>/g, '').substring(0, 200) || `Cơ hội việc làm tại ${job?.company?.name || 'công ty'}`;

  return (
    <HelmetProvider>
      <Helmet>
        {/* Basic Meta Tags */}
        <title>{job?.title} - {job?.company?.name || 'CareerZone'}</title>
        <meta name="description" content={jobDescription} />
        
        {/* Open Graph Tags cho Facebook */}
        <meta property="og:url" content={currentUrl} />
        <meta property="og:type" content="website" />
        <meta property="og:title" content={`${job?.title} - ${job?.company?.name || 'CareerZone'}`} />
        <meta property="og:description" content={jobDescription} />
        <meta property="og:image" content={companyLogo} />
        
        {/* Twitter Card Tags (bonus) */}
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={`${job?.title} - ${job?.company?.name || 'CareerZone'}`} />
        <meta name="twitter:description" content={jobDescription} />
        <meta name="twitter:image" content={companyLogo} />
      </Helmet>

      <div className="min-h-screen">
        <div className="container mx-auto py-6 px-4">
          <div className="max-w-6xl mx-auto">
            {/* Back Button */}
            <Button
              variant="ghost"
              onClick={() => navigate(-1)}
              className="mb-6 hover:bg-muted transition-all duration-200"
            >
              <ArrowLeft className="w-4 h-4 mr-2" />
              Quay lại
            </Button>

            <JobDetailHeader
              job={job}
              isAuthenticated={isAuthenticated}
              handleApply={handleApply}
              handleSave={handleSave}
              applicantCount={applicantCount}
              hasViewedApplicants={hasViewedApplicants}
              isLoadingApplicants={isLoadingApplicants}
              handleViewApplicants={handleViewApplicants}
            />

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              {/* Left Column */}
              <div className="lg:col-span-2 space-y-8">
                {/* Job Overview */}
                <Card className="border-0 shadow-sm">
                <CardHeader>
                  <CardTitle className="text-lg font-bold">Tổng quan công việc</CardTitle>
                </CardHeader>
                <CardContent className="grid grid-cols-2 gap-6">
                  <div className="flex items-center gap-3">
                    <MapPin className="w-5 h-5 text-muted-foreground" />
                    <div>
                      <p className="text-sm font-medium text-muted-foreground">Địa điểm</p>
                      <p className="text-foreground font-semibold">{job.location?.province}</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <Briefcase className="w-5 h-5 text-muted-foreground" />
                    <div>
                      <p className="text-sm font-medium text-muted-foreground">Hình thức</p>
                      <p className="text-foreground font-semibold">{formatWorkType(job.type)}</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <Calendar className="w-5 h-5 text-muted-foreground" />
                    <div>
                      <p className="text-sm font-medium text-muted-foreground">Ngày đăng</p>
                      <p className="text-foreground font-semibold">{new Date(job.createdAt || job.deadline).toLocaleDateString('vi-VN')}</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-3">
                    <Clock className="w-5 h-5 text-muted-foreground" />
                    <div>
                      <p className="text-sm font-medium text-muted-foreground">Kinh nghiệm</p>
                      <p className="text-foreground font-semibold">{formatExperience(job.experience)}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>

                {/* Job Description */}
                <Card className="border-0 shadow-sm">
                  <CardHeader>
                    <CardTitle className="text-lg font-bold">Mô tả công việc</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="prose max-w-none text-foreground leading-relaxed" dangerouslySetInnerHTML={{ __html: job.description?.replace(/\n/g, '<br />') }} />
                  </CardContent>
                </Card>

                {/* Requirements */}
                {job.requirements && (
                  <Card className="border-0 shadow-sm">
                    <CardHeader>
                      <CardTitle className="text-lg font-bold">Yêu cầu ứng viên</CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="prose max-w-none text-foreground leading-relaxed" dangerouslySetInnerHTML={{ __html: job.requirements?.replace(/\n/g, '<br />') }} />
                    </CardContent>
                  </Card>
                )}

                {/* Benefits */}
                {job.benefits && (
                  <Card className="border-0 shadow-sm">
                    <CardHeader>
                      <CardTitle className="text-lg font-bold">Quyền lợi</CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="prose max-w-none text-foreground leading-relaxed" dangerouslySetInnerHTML={{ __html: job.benefits?.replace(/\n/g, '<br />') }} />
                    </CardContent>
                  </Card>
                )}

                {/* Skills */}
                {job.skills && job.skills.length > 0 && (
                  <Card className="border-0 shadow-sm">
                    <CardHeader>
                      <CardTitle className="text-lg font-bold">Kỹ năng yêu cầu</CardTitle>
                    </CardHeader>
                    <CardContent>
                      <div className="flex flex-wrap gap-2">
                        {job.skills.map((skill, index) => (
                          <Badge key={index} variant="secondary" className="bg-primary/10 text-primary hover:bg-primary/20">
                            {skill}
                          </Badge>
                        ))}
                      </div>
                    </CardContent>
                  </Card>
                )}

                {/* Location Map */}
                <Card className="border-0 shadow-sm">
                  <CardHeader>
                    <CardTitle className="text-lg font-bold">Địa điểm làm việc</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <JobLocationMap
                      location={job.location}
                      address={job.address}
                      companyName={job.recruiterProfileId?.company?.name}
                    />
                  </CardContent>
                </Card>
              </div>

              {/* Right Column (Sidebar) */}
              <div className="lg:col-span-1">
                <JobDetailSidebar
                  relatedJobs={relatedJobs}
                  isLoadingRelated={isLoadingRelated}
                  currentJobs={currentJobs}
                  totalPages={totalPages}
                  relatedJobsPage={relatedJobsPage}
                  handlePrevPage={handlePrevPage}
                  handleNextPage={handleNextPage}
                />
              </div>
            </div>
          </div>
        </div>

        <ConfirmDialog />

        {job && (
          <ApplyJobDialog
            jobId={job._id}
            jobTitle={job.title}
            open={showApplyDialog}
            onOpenChange={setShowApplyDialog}
            onSuccess={handleApplySuccess}
          />
        )}
      </div>
    </HelmetProvider>
  );
};

export default JobDetail;
</file>

<file path="src/routes/AppRouter.jsx">
import { useEffect, useState } from 'react';
import { BrowserRouter, Routes, Route, Navigate, Outlet, useLocation, useNavigate } from 'react-router-dom';
import { useSelector, useDispatch } from 'react-redux';
import { fetchUser } from '../redux/authSlice';

// Layouts
import MainLayout from '../components/layout/MainLayout';
import DashboardLayout from '../components/layout/DashboardLayout';

// Pages
import HomePage from '../components/HomePage';
import Login from '../pages/auth/Login';
import Register from '../pages/auth/Register';
import ForgotPassword from '../pages/auth/ForgotPassword';
import ResetPassword from '../pages/auth/ResetPassword';
import Dashboard from '../pages/dashboard/Dashboard';
import JobSuggestion from '../pages/dashboard/JobSuggestion';
import JobDetail from '../pages/jobs/JobDetail';
import JobSearch from '../pages/jobs/JobSearch';
import RecommendedJobsPage from '../pages/RecommendedJobsPage';
import SavedJobs from '../pages/jobs/SavedJobs';
import ViewHistory from '../pages/jobs/ViewHistory';
import Applications from '../pages/jobs/Applications';
import ApplicationDetailPage from '../pages/jobs/ApplicationDetailPage';
import Profile from '../pages/profile/ProfilePage';
import NotificationsPage from '../pages/notification/NotificationsPage.jsx';
import JobAlertSettings from '../pages/dashboard/settings/JobAlertSettings.jsx';
import PrivacySettings from '../pages/dashboard/settings/PrivacySettings.jsx';
import MessagesPage from '../pages/messages/MessagesPage.jsx';
import News from '../pages/news/News';
import MyInterviews from '../pages/interviews/MyInterviews';
import InterviewRoom from '../pages/interviews/InterviewRoom';
import DeviceTest from '../components/interviews/DeviceTest';
import NotFound from '../pages/NotFound';
import BillingPage from '../pages/billing/Billing';
import Billing from '../pages/billing/Billing'; // Import trang nạp xu
import CreditHistory from '../pages/billing/CreditHistory';
import PaymentSuccess from '../pages/payment/PaymentSuccess';
import PaymentFailure from '../pages/payment/PaymentFailure';
import CompanyDetail from '../pages/company/CompanyDetail';
import CompanyList from '../pages/company/CompanyList';
import CVBuilder from '../components/buildCV/CVBuilder';
import CVBuilderPage from '../pages/cv/CVBuilderPage';
import UploadedCVPage from '../pages/cv/UploadedCVPage';
import OnboardingPage from '../pages/onboarding/OnboardingPage';
import { OnboardingPreview } from '../components/onboarding/OnboardingPreview';
import ScrollToTopOnRouteChange from '../components/common/ScrollToTopOnRouteChange';

// Protected Route Component
const ProtectedRoute = ({ isAuthenticated }) => {
  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }
  return <Outlet />;
};



import { getAccessToken } from '../utils/token';
import { useOnboardingStatus } from '../hooks/useOnboardingStatus';

// This component will perform the onboarding check globally using Redux
const GlobalOnboardingChecker = () => {
  const { isAuthenticated, isInitializing } = useSelector((state) => state.auth);
  const navigate = useNavigate();
  const location = useLocation();
  
  // Use Redux hook to get onboarding status (auto-fetches if needed)
  const { needsOnboarding, isLoading } = useOnboardingStatus(isAuthenticated && !isInitializing);

  useEffect(() => {
    // Check only when authentication is resolved and user is logged in
    if (isAuthenticated && !isInitializing && !isLoading) {
      // Avoid redirect loops or redirecting away from the onboarding process itself
      if (location.pathname.startsWith('/onboarding')) return;

      if (needsOnboarding) {
        console.log('GlobalOnboardingChecker: Redirecting to /onboarding (from Redux)');
        navigate('/onboarding', { replace: true });
      }
    }
  }, [isAuthenticated, isInitializing, needsOnboarding, isLoading, navigate, location.pathname]);

  return null; // This component does not render anything
};

const AppRouter = () => {
  const dispatch = useDispatch();
  const { isAuthenticated, isInitializing } = useSelector((state) => state.auth);

  useEffect(() => {
    // Run once on app startup to check for existing token
    if (getAccessToken()) {
      dispatch(fetchUser());
    }
  }, [dispatch]);

  if (isInitializing) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gray-50">
        <div className="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-primary"></div>
      </div>
    );
  }

  return (
    <BrowserRouter
      future={{
        v7_startTransition: true,
        v7_relativeSplatPath: true,
      }}
    >
      <ScrollToTopOnRouteChange />
      <GlobalOnboardingChecker />
      <Routes>
        {/* Public routes */}
        <Route element={<MainLayout />}>
          <Route path="/" element={<HomePage />} />
          <Route path="/jobs" element={<Navigate to="/jobs/search" replace />} />
          <Route path="/jobs/search" element={<JobSearch />} />
          <Route path="/jobs/recommended" element={<RecommendedJobsPage />} />
          <Route path="/jobs/:id" element={<JobDetail />} />
          <Route path="/companies" element={<CompanyList />} />
          <Route path="/company/:companyId" element={<CompanyDetail />} />
          <Route path="/news" element={<News />} />
          <Route path="/editor" element={<CVBuilder />} />
          <Route path="/editor/:cvId" element={<CVBuilder />} />
        </Route>

        {/* Onboarding Preview - Public route without layout */}
        <Route path="/onboarding-preview" element={<OnboardingPreview />} />

        {/* CV Render Page is now handled by render.html, this route is deprecated */}

        {/* Protected CV Management routes */}
        <Route element={<ProtectedRoute isAuthenticated={isAuthenticated} />}>
          <Route path="/my-cvs" element={<MainLayout />}>
            <Route index element={<Navigate to="/my-cvs/builder" replace />} />
            <Route path="builder" element={<CVBuilderPage />} />
            <Route path="uploaded" element={<UploadedCVPage />} />
          </Route>
        </Route>

        {/* Auth routes */}
        <Route path="/login" element={isAuthenticated ? <Navigate to="/" /> : <Login />} />
        <Route path="/register" element={isAuthenticated ? <Navigate to="/" /> : <Register />} />
        <Route path="/forgot-password" element={isAuthenticated ? <Navigate to="/" /> : <ForgotPassword />} />
        <Route path="/reset-password" element={isAuthenticated ? <Navigate to="/" /> : <ResetPassword />} />

        {/* Protected onboarding route - no onboarding check needed */}
        <Route element={<ProtectedRoute isAuthenticated={isAuthenticated} />}>
          <Route path="/onboarding" element={<OnboardingPage />} />
        </Route>

        {/* Protected dashboard routes - now use standard protected route */}
        <Route element={<ProtectedRoute isAuthenticated={isAuthenticated} />}>
          <Route path="/dashboard" element={<DashboardLayout />}>
            <Route index element={<Dashboard />} />
            <Route path="job-suggestions" element={<JobSuggestion />} />
            <Route path="applications" element={<Applications />} />
            <Route path="applications/:id" element={<ApplicationDetailPage />} />
            <Route path="saved-jobs" element={<SavedJobs />} />
            <Route path="view-history" element={<ViewHistory />} />
            <Route path="settings/job-alerts" element={<JobAlertSettings />} />
            <Route path="settings/privacy" element={<PrivacySettings />} />
            {/* Thêm route cho trang nạp xu */}
            <Route path="billing" element={<BillingPage />} />
            <Route path="top-up" element={<Billing />} />
            <Route path="credit-history" element={<CreditHistory />} />
          </Route>
        </Route>
        {/* Protected profile routes - now use standard protected route */}
        <Route element={<ProtectedRoute isAuthenticated={isAuthenticated} />}>
          <Route path="/profile" element={<MainLayout />}>
            <Route index element={<Profile />} />
          </Route>
        </Route>

        {/* Protected notifications routes - now use standard protected route */}
        <Route element={<ProtectedRoute isAuthenticated={isAuthenticated} />}>
          <Route path="/notifications" element={<MainLayout />}>
            <Route index element={<NotificationsPage />} />
          </Route>
        </Route>

        {/* Protected messages routes - now use standard protected route */}
        <Route element={<ProtectedRoute isAuthenticated={isAuthenticated} />}>
          <Route path="/messages" element={<MainLayout />}>
            <Route index element={<MessagesPage />} />
          </Route>
        </Route>

        {/* Protected interviews routes - now use standard protected route */}
        <Route element={<ProtectedRoute isAuthenticated={isAuthenticated} />}>
          <Route path="/interviews" element={<MainLayout />}>
            <Route index element={<MyInterviews />} />
          </Route>
          {/* Interview room routes - no layout for full-screen experience */}
          <Route path="/interviews/:interviewId/device-test" element={<DeviceTest />} />
          <Route path="/interviews/:interviewId/room" element={<InterviewRoom />} />
        </Route>

        {/* Payment result routes - không cần layout */}
        <Route path="/payment/success" element={<PaymentSuccess />} />
        <Route path="/payment/failure" element={<PaymentFailure />} />
        
        {/* Fallback for any other route */}
        <Route path="*" element={<NotFound />} />
      </Routes>
    </BrowserRouter>
  );
};

export default AppRouter;
</file>

<file path="src/components/layout/Header.jsx">
import { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useDispatch, useSelector } from 'react-redux';
import { Button } from '@/components/ui/button';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import { Card, CardContent } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import {
  Menu,
  Briefcase,
  Building2,
  Newspaper,
  UserPlus,
  LogIn,
  Home,
  User,
  Settings,
  LogOut,
  ChevronDown,
  Bell,
  BellDot,
  Clock,
  MapPin,
  DollarSign,
  Eye,
  ExternalLink,
  MoreHorizontal,
  AlertCircle,
  Bookmark,
  FileText,
  Coins,
  CreditCard,
  History,
  Plus,
  FileEdit,
  Upload,
  Shield,
  MessageCircle,
  Video,
  Calendar
} from 'lucide-react';
import { logoutSuccess } from '@/redux/authSlice';
import { clearNotifications } from '@/redux/notificationSlice';
import { logout as logoutService } from '@/services/authService';
import apiClient from '@/services/apiClient';
import { useHeaderTheme } from '@/hooks/useHeaderTheme';
import { cn } from '@/lib/utils';
import JobsDropdownMenu from './JobsDropdownMenu';
import CVDropdownMenu from './CVDropdownMenu';
import ThemeToggle from '@/components/common/ThemeToggle';
import socketService from '@/services/socketService';
import NotificationDropdown from './NotificationDropdown';

const Header = () => {
  const navigate = useNavigate();
  const dispatch = useDispatch();
  const { user, isAuthenticated } = useSelector((state) => state.auth);
  const { unreadCount: notificationCount } = useSelector((state) => state.notifications);
  const isHeaderWhite = useHeaderTheme(500); // Khoảng 2/3 màn hình

  // User dropdown state
  const [showUserDropdown, setShowUserDropdown] = useState(false);

  // Messages states
  const [unreadMessagesCount, setUnreadMessagesCount] = useState(0);

  // Navigation links (excluding Jobs and CV - handled by dropdown menus)
  const navLinks = [
    { to: "/companies", label: "Công ty", title: 'Công ty', href: '/companies', icon: <Building2 className="h-5 w-5" /> },
    { to: "/news", label: "Tin tức", title: 'Cẩm nang', href: '/news', icon: <Newspaper className="h-5 w-5" /> }
  ];

  // Logic lấy tên viết tắt cho Avatar
  const getUserInitials = (currentUser) => {
    if (!currentUser) return "U";
    const name = currentUser.fullname || currentUser.email || "";
    const nameParts = name.split(" ");
    return nameParts.length > 1
      ? `${nameParts[0][0]}${nameParts[nameParts.length - 1][0]}`
      : name.substring(0, 2).toUpperCase();
  };

  // Fetch unread messages count
  const fetchUnreadMessagesCount = async () => {
    try {
      const response = await apiClient.get('/chat/conversations');
      if (response.data.success) {
        const conversations = response.data.data || [];
        const totalUnread = conversations.reduce((sum, conv) => sum + (conv.unreadCount || 0), 0);
        setUnreadMessagesCount(totalUnread);
      }
    } catch (error) {
      console.error('Error fetching unread messages count:', error);
      setUnreadMessagesCount(0);
    }
  };

  // Check for messages and setup Socket.io for real-time updates
  useEffect(() => {
    if (isAuthenticated) {
      fetchUnreadMessagesCount();

      // Connect to Socket.io for real-time message updates
      socketService.connect().then(() => {
        console.log('[Header] Socket.io connected for real-time updates');
      }).catch((error) => {
        console.error('[Header] Failed to connect to Socket.io:', error);
      });

      // Subscribe to new message events to update unread count
      const handleNewMessage = (message) => {
        console.log('[Header] New message received via Socket.io:', message);
        // Increment unread count if message is not from current user
        if (message.senderId !== user?.user?._id) {
          setUnreadMessagesCount(prev => prev + 1);
        }
      };

      socketService.onNewMessage(handleNewMessage);

      // Kiểm tra tin nhắn mới mỗi 5 phút (fallback)
      const interval = setInterval(() => {
        fetchUnreadMessagesCount();
      }, 5 * 60 * 1000);

      return () => {
        clearInterval(interval);
        // Clean up Socket.io event listener
        socketService.off('onNewMessage', handleNewMessage);
      };
    } else {
      // Reset messages when user logs out
      setUnreadMessagesCount(0);
      
      // Disconnect Socket.io when user logs out
      socketService.disconnect();
    }
  }, [isAuthenticated, user]);

  // Close dropdowns on Escape key
  useEffect(() => {
    const handleEscape = (event) => {
      if (event.key === 'Escape') {
        setShowUserDropdown(false);
      }
    };

    document.addEventListener('keydown', handleEscape);
    return () => document.removeEventListener('keydown', handleEscape);
  }, []);

  // Close dropdowns when clicking outside
  useEffect(() => {
    const handleClickOutside = (event) => {
      // Check if click is outside dropdown
      const isClickInsideDropdown = event.target.closest('[data-dropdown]');
      if (!isClickInsideDropdown) {
        setShowUserDropdown(false);
      }
    };

    if (showUserDropdown) {
      document.addEventListener('mousedown', handleClickOutside);
      return () => document.removeEventListener('mousedown', handleClickOutside);
    }
  }, [showUserDropdown]);

  const handleLogout = async () => {
    try {
      await logoutService();
    } catch (error) {
      console.error("Logout failed", error);
    } finally {
      dispatch(clearNotifications());
      dispatch(logoutSuccess());
      setShowUserDropdown(false);
      navigate('/');
    }
  };

  const handleUserDropdownClick = () => {
    setShowUserDropdown(!showUserDropdown);
  };

  return (
    <header className={cn(
      "sticky top-0 z-50 w-full border-b backdrop-blur-xl transition-all duration-500 shadow-sm",
      isHeaderWhite
        ? "bg-white/10 border-white/20 shadow-white/10"
        : "bg-background/50 border-border shadow-md"
    )}>
      <div className="container flex h-16 items-center justify-between relative">
        {/* Gradient accent line */}
        <div className="absolute bottom-0 left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-primary/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
        <div className="flex items-center gap-6">
          {/* Mobile Menu */}
          <div className="md:hidden">
            <Sheet>
              <SheetTrigger asChild>
                <Button variant="ghost" size="icon" className={cn(
                  "transition-colors",
                  isHeaderWhite ? "text-white hover:bg-white/10" : ""
                )}>
                  <Menu className="h-5 w-5" />
                </Button>
              </SheetTrigger>
              <SheetContent side="left" className="w-full max-w-xs bg-white dark:bg-card">
                <div className="flex items-center justify-between mb-8">
                  <Link to="/" className="flex items-center space-x-2">
                    <span className="font-bold text-xl text-foreground">Career<span className="text-primary">Zone</span></span>
                  </Link>
                  <ThemeToggle variant="ghost" size="icon" />
                </div>
                <nav className="grid gap-3 text-lg font-medium">
                  {/* Jobs Section */}
                  <Link to="/jobs/search" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent">
                    <Briefcase className="h-4 w-4" /> Tìm việc làm
                  </Link>
                  {isAuthenticated && (
                    <>
                      <Link to="/messages" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent ml-4">
                        <MessageCircle className="h-4 w-4" /> Tin nhắn
                        {unreadMessagesCount > 0 && (
                          <Badge className="ml-auto h-5 w-5 flex items-center justify-center p-0 bg-gradient-to-br from-red-500 to-red-600 text-white text-xs">
                            {unreadMessagesCount > 99 ? '99+' : unreadMessagesCount}
                          </Badge>
                        )}
                      </Link>
                      <Link to="/interviews" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent ml-4">
                        <Video className="h-4 w-4" /> Lịch phỏng vấn
                      </Link>
                      <Link to="/dashboard/saved-jobs" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent ml-4">
                        <Bookmark className="h-4 w-4" /> Việc làm đã lưu
                      </Link>
                      <Link to="/dashboard/applications" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent ml-4">
                        <FileText className="h-4 w-4" /> Việc làm đã ứng tuyển
                      </Link>
                      <Link to="/dashboard/settings/job-alerts" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent ml-4">
                        <Bell className="h-4 w-4" /> Quản lý thông báo
                      </Link>
                      <Link to="/dashboard/settings/privacy" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent ml-4">
                        <Shield className="h-4 w-4" /> Cài đặt riêng tư
                      </Link>
                    </>
                  )}

                  {/* Other Links */}
                  {navLinks.map((link) => (
                    <Link key={link.to} to={link.to} className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent">
                      {link.icon} {link.label}
                    </Link>
                  ))}

                  {/* CV Management Section */}
                  {isAuthenticated && (
                    <>
                      <Link to="/my-cvs/builder" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent">
                        <FileEdit className="h-4 w-4" /> CV Builder
                      </Link>
                      <Link to="/my-cvs/uploaded" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent ml-4">
                        <Upload className="h-4 w-4" /> CV đã tải lên
                      </Link>
                    </>
                  )}

                  {isAuthenticated && (
                    <div className="border-t pt-4 mt-4">
                      <Link to="/dashboard" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent">
                        <User className="h-4 w-4" /> Dashboard
                      </Link>
                      <Link to="/profile" className="flex items-center gap-4 px-3 py-2 rounded-lg text-muted-foreground hover:text-foreground hover:bg-accent">
                        <Settings className="h-4 w-4" /> Hồ sơ của tôi
                      </Link>
                      <button onClick={handleLogout} className="flex items-center gap-4 px-3 py-2 rounded-lg text-destructive w-full text-left">
                        <LogOut className="h-4 w-4" /> Đăng xuất
                      </button>
                    </div>
                  )}
                </nav>
              </SheetContent>
            </Sheet>
          </div>

          {/* Desktop Logo & Navigation */}
          <div className="hidden items-center gap-8 md:flex">
            <Link to="/" className="flex items-center space-x-2 group">
              <div className="relative">
                <span className={cn(
                  "font-bold text-2xl transition-all duration-300 group-hover:scale-105",
                  "bg-gradient-to-r from-foreground to-foreground bg-clip-text"
                )}>
                  Career<span className={cn(
                    "transition-all duration-300",
                    "bg-gradient-to-r from-primary via-primary to-blue-600 bg-clip-text text-transparent",
                    "group-hover:from-blue-600 group-hover:via-primary group-hover:to-primary"
                  )}>Zone</span>
                </span>
                {/* Animated underline effect */}
                <div className="absolute -bottom-1 left-0 w-0 h-0.5 bg-gradient-to-r from-primary to-blue-600 group-hover:w-full transition-all duration-500" />
              </div>
            </Link>

            {/* Desktop Navigation */}
            <nav className="hidden md:flex items-center space-x-2">
              {/* Jobs Dropdown Menu */}
              <JobsDropdownMenu isHeaderWhite={isHeaderWhite} />

              {/* Other Navigation Links */}
              {navLinks.map((link) => (
                <Link
                  key={link.title}
                  to={link.href}
                  className={cn(
                    "relative px-4 py-2 rounded-lg transition-all duration-300 font-semibold group",
                    "hover:bg-primary/5 hover:scale-105",
                    isHeaderWhite
                      ? "text-foreground hover:text-primary"
                      : "text-muted-foreground hover:text-primary"
                  )}
                >
                  <span className="relative z-10">{link.title}</span>
                  {/* Hover effect background */}
                  <div className="absolute inset-0 rounded-lg bg-gradient-to-r from-primary/10 to-blue-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                  {/* Bottom border animation */}
                  <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-gradient-to-r from-primary to-blue-600 group-hover:w-3/4 transition-all duration-300" />
                </Link>
              ))}

              {/* CV Dropdown Menu - Only show when authenticated */}
              {isAuthenticated && <CVDropdownMenu isHeaderWhite={isHeaderWhite} />}
            </nav>
          </div>
        </div>

        {/* Auth Buttons */}
        <div className="hidden md:flex items-center space-x-2">
          {isAuthenticated ? (
            <div className="flex items-center space-x-4">
              {/* Theme Toggle */}
              <ThemeToggle />

              {/* Messages Button */}
              <Link to="/messages" className="relative">
                <Button
                  variant="ghost"
                  size="icon"
                  className={cn(
                    "h-10 w-10 rounded-full relative transition-all duration-300 group",
                    "hover:bg-gradient-to-br hover:from-blue-50 hover:to-blue-100/50",
                    "hover:shadow-lg hover:shadow-blue-500/20 hover:scale-110",
                    unreadMessagesCount > 0 && "animate-pulse"
                  )}
                >
                  <MessageCircle className={cn(
                    "h-5 w-5 transition-all",
                    unreadMessagesCount > 0 
                      ? "text-blue-600 group-hover:scale-110" 
                      : "text-muted-foreground group-hover:text-blue-600 group-hover:scale-110"
                  )} />
                  {/* Ring effect for new messages */}
                  {unreadMessagesCount > 0 && (
                    <div className="absolute inset-0 rounded-full bg-blue-500/20 animate-ping" />
                  )}
                </Button>

                {/* Unread Badge */}
                {unreadMessagesCount > 0 && (
                  <Badge
                    className={cn(
                      "absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0",
                      "bg-gradient-to-br from-blue-500 to-blue-600 text-white text-xs font-bold",
                      "rounded-full border-2 border-background shadow-lg",
                      "animate-bounce"
                    )}
                  >
                    {unreadMessagesCount > 99 ? '99+' : unreadMessagesCount}
                  </Badge>
                )}
              </Link>

              {/* Notification Dropdown Component */}
              <NotificationDropdown />

              {/* User Dropdown */}
              <div className="relative" data-dropdown>
                <button
                  onClick={handleUserDropdownClick}
                  className={cn(
                    "flex items-center space-x-3 p-2 rounded-xl transition-all duration-300 group",
                    "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                    "hover:shadow-lg hover:shadow-primary/10 hover:scale-105"
                  )}
                >
                  <div className="relative">
                    <Avatar className="w-8 h-8 ring-2 ring-primary/20 group-hover:ring-primary/50 transition-all duration-300">
                      <AvatarImage src={user?.profile?.avatar} alt={user?.fullname}
                      referrerPolicy="no-referrer"
  crossOrigin="anonymous"
   />
                      <AvatarFallback className="bg-gradient-to-br from-primary/20 to-blue-600/20 text-primary text-sm font-semibold">
                        {getUserInitials(user)}
                      </AvatarFallback>
                    </Avatar>
                    {/* Online indicator */}
                    <div className="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-background shadow-lg" />
                  </div>
                  <div className="text-left">
                    <div className="text-sm font-semibold bg-gradient-to-r from-foreground to-foreground/80 bg-clip-text">
                      Xin chào, {user?.profile?.fullname?.split(' ').slice(-1)[0] || 'bạn'}!
                    </div>
                    <div className="text-xs text-muted-foreground truncate max-w-32 group-hover:text-primary transition-colors">
                      {user?.profile?.fullname || 'Người dùng'}
                    </div>
                  </div>
                  <ChevronDown className={cn(
                    "h-4 w-4 text-muted-foreground transition-all duration-300",
                    "group-hover:text-primary",
                    showUserDropdown && "rotate-180"
                  )} />
                </button>

                {/* Professional Dropdown Menu */}
                {showUserDropdown && (
                  <div
                    className={cn(
                      "absolute right-0 top-full mt-2 w-80",
                      // Glass morphism effect
                      "bg-background/95 backdrop-blur-xl",
                      // Enhanced border with gradient
                      "border-2 border-border/50",
                      "rounded-2xl shadow-2xl z-50 overflow-hidden",
                      // Enhanced shadow for depth
                      "shadow-[0_20px_70px_-15px_rgba(0,0,0,0.3)]",
                      "dark:shadow-[0_20px_70px_-15px_rgba(0,0,0,0.6)]",
                      // Animation
                      "animate-in slide-in-from-top-2 fade-in-0 duration-300",
                      // Ring effect
                      "ring-1 ring-black/5 dark:ring-white/10"
                    )}
                    data-dropdown
                  >
                    {/* User Profile Header */}
                    <div
                      className="relative px-6 py-4 border-b border-border overflow-hidden"
                      style={{
                        backgroundImage: 'linear-gradient(135deg, hsl(var(--primary) / 0.15) 0%, hsl(var(--primary) / 0.05) 100%)'
                      }}
                    >
                      {/* Animated background elements */}
                      <div className="absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2" />
                      <div className="absolute bottom-0 left-0 w-24 h-24 bg-blue-600/5 rounded-full blur-2xl translate-y-1/2 -translate-x-1/2" />

                      <div className="flex items-center space-x-4 relative z-10">
                        <div className="relative">
                          <Avatar className="w-14 h-14 ring-2 ring-primary/30 shadow-lg">
                            <AvatarImage referrerPolicy="no-referrer"
  crossOrigin="anonymous" src={user?.profile?.avatar} alt={user?.profile?.fullname} />
                            <AvatarFallback className="bg-gradient-to-br from-primary/30 to-blue-600/30 text-primary font-bold text-lg">
                              {getUserInitials(user)}
                            </AvatarFallback>
                          </Avatar>
                          {/* Online status with glow */}
                          <div className="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-background shadow-lg">
                            <div className="absolute inset-0 bg-green-500 rounded-full animate-ping opacity-75" />
                          </div>
                        </div>
                        <div className="flex-1">
                          <div className="font-bold text-foreground text-base">{user?.profile?.fullname || 'Người dùng'}</div>
                          <div className="text-xs text-muted-foreground mt-0.5">{user?.user.email || ''}</div>
                        </div>
                      </div>
                    </div>

                    {/* Navigation Menu */}
                    <div className="p-3">
                      <div className="space-y-1">
                        <Link
                          to="/dashboard"
                          className={cn(
                            "flex items-center px-3 py-2.5 text-sm text-foreground rounded-xl transition-all duration-300 group",
                            "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                            "hover:shadow-md hover:scale-105 hover:translate-x-1"
                          )}
                          onClick={() => setShowUserDropdown(false)}
                        >
                          <div className="mr-3 p-1.5 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors">
                            <Home className="h-4 w-4 text-primary" />
                          </div>
                          <span className="font-medium">Tổng quan</span>
                        </Link>

                        <Link
                          to="/profile"
                          className={cn(
                            "flex items-center px-3 py-2.5 text-sm text-foreground rounded-xl transition-all duration-300 group",
                            "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                            "hover:shadow-md hover:scale-105 hover:translate-x-1"
                          )}
                          onClick={() => setShowUserDropdown(false)}
                        >
                          <div className="mr-3 p-1.5 rounded-lg bg-blue-500/10 group-hover:bg-blue-500/20 transition-colors">
                            <User className="h-4 w-4 text-blue-600" />
                          </div>
                          <span className="font-medium">Hồ sơ của tôi</span>
                        </Link>

                        <Link
                          to="/dashboard/saved-jobs"
                          className={cn(
                            "flex items-center px-3 py-2.5 text-sm text-foreground rounded-xl transition-all duration-300 group",
                            "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                            "hover:shadow-md hover:scale-105 hover:translate-x-1"
                          )}
                          onClick={() => setShowUserDropdown(false)}
                        >
                          <div className="mr-3 p-1.5 rounded-lg bg-amber-500/10 group-hover:bg-amber-500/20 transition-colors">
                            <Bookmark className="h-4 w-4 text-amber-600" />
                          </div>
                          <span className="font-medium">Việc làm đã lưu</span>
                        </Link>

                        <Link
                          to="/dashboard/applications"
                          className={cn(
                            "flex items-center px-3 py-2.5 text-sm text-foreground rounded-xl transition-all duration-300 group",
                            "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                            "hover:shadow-md hover:scale-105 hover:translate-x-1"
                          )}
                          onClick={() => setShowUserDropdown(false)}
                        >
                          <div className="mr-3 p-1.5 rounded-lg bg-emerald-500/10 group-hover:bg-emerald-500/20 transition-colors">
                            <FileText className="h-4 w-4 text-emerald-600" />
                          </div>
                          <span className="font-medium">Đơn ứng tuyển</span>
                        </Link>

                        <Link
                          to="/messages"
                          className={cn(
                            "flex items-center px-3 py-2.5 text-sm text-foreground rounded-xl transition-all duration-300 group",
                            "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                            "hover:shadow-md hover:scale-105 hover:translate-x-1"
                          )}
                          onClick={() => setShowUserDropdown(false)}
                        >
                          <div className="mr-3 p-1.5 rounded-lg bg-blue-500/10 group-hover:bg-blue-500/20 transition-colors">
                            <MessageCircle className="h-4 w-4 text-blue-600" />
                          </div>
                          <span className="font-medium">Tin nhắn</span>
                          {unreadMessagesCount > 0 && (
                            <Badge className="ml-auto h-5 w-5 flex items-center justify-center p-0 bg-gradient-to-br from-blue-500 to-blue-600 text-white text-xs animate-pulse">
                              {unreadMessagesCount > 99 ? '99+' : unreadMessagesCount}
                            </Badge>
                          )}
                        </Link>

                        <Link
                          to="/interviews"
                          className={cn(
                            "flex items-center px-3 py-2.5 text-sm text-foreground rounded-xl transition-all duration-300 group",
                            "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                            "hover:shadow-md hover:scale-105 hover:translate-x-1"
                          )}
                          onClick={() => setShowUserDropdown(false)}
                        >
                          <div className="mr-3 p-1.5 rounded-lg bg-green-500/10 group-hover:bg-green-500/20 transition-colors">
                            <Video className="h-4 w-4 text-green-600" />
                          </div>
                          <span className="font-medium">Lịch phỏng vấn</span>
                        </Link>

                        <Link
                          to="/notifications"
                          className={cn(
                            "flex items-center px-3 py-2.5 text-sm text-foreground rounded-xl transition-all duration-300 group",
                            "hover:bg-gradient-to-r hover:from-muted hover:to-muted/50",
                            "hover:shadow-md hover:scale-105 hover:translate-x-1"
                          )}
                          onClick={() => setShowUserDropdown(false)}
                        >
                          <div className="mr-3 p-1.5 rounded-lg bg-purple-500/10 group-hover:bg-purple-500/20 transition-colors">
                            <Bell className="h-4 w-4 text-purple-600" />
                          </div>
                          <span className="font-medium">Quản lý thông báo</span>
                          {notificationCount > 0 && (
                            <Badge className="ml-auto h-5 w-5 flex items-center justify-center p-0 bg-gradient-to-br from-red-500 to-red-600 text-white text-xs animate-pulse">
                              {notificationCount}
                            </Badge>
                          )}
                        </Link>
                      </div>

                      <Separator className="my-2" />

                      {/* Account Balance - Clickable */}
                      <Link
                        to="/dashboard/billing"
                        className="block px-3 py-2 mb-2"
                        onClick={() => setShowUserDropdown(false)}
                      >
                        <div className={cn(
                          "flex items-center justify-between p-3 rounded-xl transition-all duration-300 cursor-pointer group",
                          "bg-gradient-to-r from-amber-50 to-yellow-50 hover:from-amber-100 hover:to-yellow-100",
                          "border border-amber-200/50 hover:border-amber-300",
                          "hover:shadow-lg hover:shadow-amber-500/20 hover:scale-105"
                        )}>
                          <div className="flex items-center space-x-2">
                            <div className="p-1.5 rounded-lg bg-yellow-500/20 group-hover:bg-yellow-500/30 transition-colors">
                              <Coins className="h-4 w-4 text-yellow-600" />
                            </div>
                            <span className="text-sm font-medium text-amber-900">Quản lý số dư</span>
                          </div>
                          <div className="text-sm font-bold text-amber-900 bg-yellow-100 px-2 py-1 rounded-lg">
                            {user?.user?.coinBalance?.toLocaleString() || 0} xu
                          </div>
                        </div>
                      </Link>

                      <button
                        onClick={handleLogout}
                        className={cn(
                          "flex items-center w-full px-3 py-2.5 text-sm text-destructive rounded-xl transition-all duration-300 group",
                          "hover:bg-gradient-to-r hover:from-destructive/10 hover:to-destructive/5",
                          "hover:shadow-md hover:scale-105 hover:translate-x-1"
                        )}
                      >
                        <div className="mr-3 p-1.5 rounded-lg bg-destructive/10 group-hover:bg-destructive/20 transition-colors">
                          <LogOut className="h-4 w-4" />
                        </div>
                        <span className="font-medium">Đăng xuất</span>
                      </button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          ) : (
            <>
              {/* Theme Toggle for non-authenticated users */}
              <ThemeToggle />

              <Button
                variant="ghost"
                asChild
                className={cn(
                  "rounded-xl font-semibold transition-all duration-300 hover:scale-105",
                  "hover:bg-muted hover:shadow-md",
                  isHeaderWhite ? "text-foreground" : ""
                )}
              >
                <Link to="/login" className="flex items-center gap-2">
                  <LogIn className="h-4 w-4" />
                  <span>Đăng nhập</span>
                </Link>
              </Button>
              <Button
                asChild
                className={cn(
                  "rounded-xl font-semibold transition-all duration-300 hover:scale-105",
                  "bg-gradient-to-r from-primary via-primary to-blue-600",
                  "hover:from-blue-600 hover:via-primary hover:to-primary",
                  "hover:shadow-lg hover:shadow-primary/30",
                  isHeaderWhite ? "text-white" : ""
                )}
              >
                <Link to="/register" className="flex items-center gap-2">
                  <UserPlus className="h-4 w-4" />
                  <span>Đăng ký</span>
                </Link>
              </Button>
            </>
          )}
        </div>
      </div>
    </header>
  );
};

export default Header;
</file>

</files>
